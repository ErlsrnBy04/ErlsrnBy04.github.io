<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>[LangChain]Extraction</title>
    <link href="/2025/03/29/LangChain-Extraction/"/>
    <url>/2025/03/29/LangChain-Extraction/</url>
    
    <content type="html"><![CDATA[<h1 id="0-Useful-Docs"><a href="#0-Useful-Docs" class="headerlink" title="0 Useful Docs"></a>0 Useful Docs</h1><ul><li><a href="https://python.langchain.com/docs/concepts/tool_calling/">tool-calling</a></li><li><a href="https://python.langchain.com/docs/concepts/few_shot_prompting/">few-shot prompting</a></li></ul><h1 id="1-The-Schema"><a href="#1-The-Schema" class="headerlink" title="1 The Schema"></a>1 The Schema</h1><p>é¦–å…ˆï¼Œéœ€è¦ä½¿ç”¨Pydanticæ¥å®šä¹‰ä¸€ä¸ªschemaï¼Œæ¥æ˜ç¡®æˆ‘ä»¬å¸Œæœ›æå–ä»€ä¹ˆæ ·çš„ä¿¡æ¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Information about a person.&quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># ^ Doc-string for the entity Person.</span><br>    <span class="hljs-comment"># This doc-string is sent to the LLM as the description of the schema Person,</span><br>    <span class="hljs-comment"># and it can help to improve extraction results.</span><br><br>    <span class="hljs-comment"># Note that:</span><br>    <span class="hljs-comment"># 1. Each field is an `optional` -- this allows the model to decline to extract it!</span><br>    <span class="hljs-comment"># 2. Each field has a `description` -- this description is used by the LLM.</span><br>    <span class="hljs-comment"># Having a good description can help improve extraction results.</span><br>    name: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(default=<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;The name of the person&quot;</span>)<br>    hair_color: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<br>        default=<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;The color of the person&#x27;s hair if known&quot;</span><br>    )<br>    height_in_meters: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<br>        default=<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;Height measured in meters&quot;</span><br>    )<br></code></pre></td></tr></table></figure><p><strong>æœ€ä½³å®è·µ</strong></p><ol><li><strong>ä¸ºå±æ€§å’ŒSchemaæœ¬èº«æ·»åŠ æ–‡æ¡£</strong>ï¼šä¸ºå±æ€§å’ŒSchemaæä¾›è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜ã€‚è¿™äº›ä¿¡æ¯å°†è¢«å‘é€åˆ°è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œä»¥æé«˜ä¿¡æ¯æå–çš„è´¨é‡ã€‚æ¸…æ™°çš„æè¿°æœ‰åŠ©äºæ¨¡å‹å‡†ç¡®ç†è§£å„å±æ€§çš„æ„ä¹‰åŠå…¶é¢„æœŸç”¨é€”ã€‚</li><li><strong>é¿å…å¼ºè¿«LLMç¼–é€ ä¿¡æ¯</strong>ï¼šå¯¹äºä¸ç¡®å®šæˆ–æœªçŸ¥çš„ä¿¡æ¯ï¼Œå…è®¸å±æ€§ä½¿ç”¨<code>Optional</code>ç±»å‹ï¼Œä½¿å¾—LLMå¯ä»¥åœ¨æ²¡æœ‰ç¡®åˆ‡ç­”æ¡ˆæ—¶è¿”å›<code>None</code>ã€‚è¿™é˜²æ­¢äº†æ¨¡å‹å› å¼ºåˆ¶è¦æ±‚è¾“å‡ºè€Œäº§ç”Ÿä¸å‡†ç¡®æˆ–è™šæ„çš„æ•°æ®ã€‚</li></ol><h1 id="2-The-Extractor"><a href="#2-The-Extractor" class="headerlink" title="2 The Extractor"></a>2 The Extractor</h1><p>ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„schemaåˆ›å»ºä¸€ä¸ªä¿¡æ¯extractorã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate, MessagesPlaceholder<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br><span class="hljs-comment"># Define a custom prompt to provide instructions and any additional context.</span><br><span class="hljs-comment"># 1) You can add examples into the prompt template to improve extraction quality</span><br><span class="hljs-comment"># 2) Introduce additional parameters to take context into account (e.g., include metadata</span><br><span class="hljs-comment">#    about the document from which the text was extracted.)</span><br>prompt_template = ChatPromptTemplate.from_messages(<br>    [<br>        (<br>            <span class="hljs-string">&quot;system&quot;</span>,<br>            <span class="hljs-string">&quot;You are an expert extraction algorithm. &quot;</span><br>            <span class="hljs-string">&quot;Only extract relevant information from the text. &quot;</span><br>            <span class="hljs-string">&quot;If you do not know the value of an attribute asked to extract, &quot;</span><br>            <span class="hljs-string">&quot;return null for the attribute&#x27;s value.&quot;</span>,<br>        ),<br>        <span class="hljs-comment"># Please see the how-to about improving performance with</span><br>        <span class="hljs-comment"># reference examples.</span><br>        <span class="hljs-comment"># MessagesPlaceholder(&#x27;examples&#x27;),</span><br>        (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;text&#125;&quot;</span>),<br>    ]<br>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å¤§æ¨¡å‹æ¥æå–ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> getpass<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.environ.get(<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>):<br>  os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = getpass.getpass(<span class="hljs-string">&quot;Enter API key for OpenAI: &quot;</span>)<br><br><span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> init_chat_model<br><br>llm = init_chat_model(<span class="hljs-string">&quot;gpt-4o-mini&quot;</span>, model_provider=<span class="hljs-string">&quot;openai&quot;</span>)<br>structured_llm = llm.with_structured_output(schema=Person)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">text = <span class="hljs-string">&quot;Alan Smith is 6 feet tall and has blond hair.&quot;</span><br>prompt = prompt_template.invoke(&#123;<span class="hljs-string">&quot;text&quot;</span>: text&#125;)<br>structured_llm.invoke(prompt)<br></code></pre></td></tr></table></figure><h1 id="3-Multiple-Entities"><a href="#3-Multiple-Entities" class="headerlink" title="3 Multiple Entities"></a>3 Multiple Entities</h1><p>åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œæå–å®ä½“åˆ—è¡¨è€Œéå•ä¸€å®ä½“æ˜¯æ›´ä¸ºå¸¸è§çš„éœ€æ±‚ã€‚é€šè¿‡Pydanticæ¨¡å‹çš„åµŒå¥—ä½¿ç”¨ï¼Œå¯ä»¥è½»æ¾å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Information about a person.&quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># ^ Doc-string for the entity Person.</span><br>    <span class="hljs-comment"># This doc-string is sent to the LLM as the description of the schema Person,</span><br>    <span class="hljs-comment"># and it can help to improve extraction results.</span><br><br>    <span class="hljs-comment"># Note that:</span><br>    <span class="hljs-comment"># 1. Each field is an `optional` -- this allows the model to decline to extract it!</span><br>    <span class="hljs-comment"># 2. Each field has a `description` -- this description is used by the LLM.</span><br>    <span class="hljs-comment"># Having a good description can help improve extraction results.</span><br>    name: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(default=<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;The name of the person&quot;</span>)<br>    hair_color: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<br>        default=<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;The color of the person&#x27;s hair if known&quot;</span><br>    )<br>    height_in_meters: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(<br>        default=<span class="hljs-literal">None</span>, description=<span class="hljs-string">&quot;Height measured in meters&quot;</span><br>    )<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Extracted data about people.&quot;&quot;&quot;</span><br><br>    <span class="hljs-comment"># Creates a model so that we can extract multiple entities.</span><br>    people: <span class="hljs-type">List</span>[Person]<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">structured_llm = llm.with_structured_output(schema=Data)<br>text = <span class="hljs-string">&quot;My name is Jeff, my hair is black and i am 6 feet tall. Anna has the same color hair as me.&quot;</span><br>prompt = prompt_template.invoke(&#123;<span class="hljs-string">&quot;text&quot;</span>: text&#125;)<br>structured_llm.invoke(prompt)<br></code></pre></td></tr></table></figure><h1 id="4-Reference-examples"><a href="#4-Reference-examples" class="headerlink" title="4 Reference examples"></a>4 Reference examples</h1><p>å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åº”ç”¨çš„è¡Œä¸ºå¯ä»¥é€šè¿‡å°‘é‡æ ·æœ¬æç¤ºï¼ˆ<a href="https://python.langchain.com/docs/concepts/few_shot_prompting/">few-shot prompting</a>ï¼‰æ¥å¼•å¯¼ã€‚å¯¹äºèŠå¤©æ¨¡å‹è€Œè¨€ï¼Œè¿™å¯ä»¥è¡¨ç°ä¸ºä¸€ç³»åˆ—è¾“å…¥ä¸å“åº”æ¶ˆæ¯å¯¹ï¼Œè¿™äº›ä¾‹å­å±•ç¤ºäº†æœŸæœ›çš„è¡Œä¸ºæ¨¡å¼ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡userå’Œassistantæ¶ˆæ¯çš„äº¤æ›¿æ¥ä¼ è¾¾ä¸€ä¸ªç¬¦å·çš„æ„ä¹‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">messages = [<br>    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;2 ğŸ¦œ 2&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;4&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;2 ğŸ¦œ 3&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;assistant&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;5&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;3 ğŸ¦œ 4&quot;</span>&#125;<br>]<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">response = llm.invoke(messages)<br><span class="hljs-built_in">print</span>(response.content)<br></code></pre></td></tr></table></figure><p><a href="https://python.langchain.com/docs/concepts/structured_outputs/">Structured output</a>é€šå¸¸åœ¨åº•å±‚ä½¿ç”¨ <a href="https://python.langchain.com/docs/concepts/tool_calling/">tool calling</a>ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°ç”ŸæˆåŒ…å«å·¥å…·è°ƒç”¨çš„<a href="https://python.langchain.com/docs/concepts/messages/#aimessage">AI messages</a>ï¼Œä»¥åŠåŒ…å«å·¥å…·è°ƒç”¨ç»“æœçš„ <a href="https://python.langchain.com/docs/concepts/messages/#toolmessage">tool messages</a>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯åºåˆ—åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>ä¸åŒçš„èŠå¤©æ¨¡å‹æä¾›å•†å¯¹æœ‰æ•ˆæ¶ˆæ¯åºåˆ—æœ‰ä¸åŒçš„è¦æ±‚ã€‚éƒ¨åˆ†æä¾›å•†æ¥å—å¦‚ä¸‹å½¢å¼çš„ï¼ˆé‡å¤çš„ï¼‰æ¶ˆæ¯åºåˆ—ï¼š</p><ol><li>User message</li><li>AI message with tool call</li><li>Tool message with result</li></ol><p>è€Œå…¶ä»–æä¾›å•†åˆ™å¯èƒ½è¦æ±‚åœ¨ä¸Šè¿°åºåˆ—ä¹‹åæ·»åŠ ä¸€ä¸ªåŒ…å«æŸç§å“åº”çš„æœ€ç»ˆAI messageã€‚</p><p>ä¸ºäº†ç®€åŒ–è¿™ä¸€è¿‡ç¨‹å¹¶ç”Ÿæˆç¬¦åˆå¤§å¤šæ•°æ¨¡å‹æä¾›å•†è¦æ±‚çš„æœ‰æ•ˆæ¶ˆæ¯åºåˆ—ï¼ŒLangChainæä¾›äº†ä¸€ä¸ªåä¸º<a href="%5Btool_example_to_messages%5D(https://python.langchain.com/api_reference/core/utils/langchain_core.utils.function_calling.tool_example_to_messages.html)"><code>tool_example_to_messages</code></a>çš„å®ç”¨å‡½æ•°ã€‚åªéœ€æä¾›ç›¸åº”tool callçš„pydantic representationï¼Œå³å¯åˆ›å»ºstructured few-shot examplesã€‚</p><p>å¯ä»¥ç›´æ¥å°†è¾“å…¥å’ŒæœŸæœ›çš„Pydanticå¯¹è±¡å¯¹è½¬æ¢ä¸ºå¯ä»¥æä¾›ç»™èŠå¤©æ¨¡å‹çš„æ¶ˆæ¯åºåˆ—ã€‚åœ¨åº•å±‚ï¼ŒLangChainä¼šå°†è¿™äº›å·¥å…·è°ƒç”¨æ ¼å¼åŒ–ä¸ºç¬¦åˆæ¯ä¸ªæä¾›å•†è¦æ±‚çš„æ ¼å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.utils.function_calling <span class="hljs-keyword">import</span> tool_example_to_messages<br><br>examples = [<br>    (<br>        <span class="hljs-string">&quot;The ocean is vast and blue. It&#x27;s more than 20,000 feet deep.&quot;</span>,<br>        Data(people=[]),<br>    ),<br>    (<br>        <span class="hljs-string">&quot;Fiona traveled far from France to Spain.&quot;</span>,<br>        Data(people=[Person(name=<span class="hljs-string">&quot;Fiona&quot;</span>, height_in_meters=<span class="hljs-literal">None</span>, hair_color=<span class="hljs-literal">None</span>)]),<br>    ),<br>]<br><br><br>messages = []<br><br><span class="hljs-keyword">for</span> txt, tool_call <span class="hljs-keyword">in</span> examples:<br>    <span class="hljs-keyword">if</span> tool_call.people:<br>        <span class="hljs-comment"># This final message is optional for some providers</span><br>        ai_response = <span class="hljs-string">&quot;Detected people.&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        ai_response = <span class="hljs-string">&quot;Detected no people.&quot;</span><br>    messages.extend(tool_example_to_messages(txt, [tool_call], ai_response=ai_response))<br>    <br><span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> messages:<br>    message.pretty_print()<br></code></pre></td></tr></table></figure><p>API Reference: <a href="https://python.langchain.com/api_reference/core/utils/langchain_core.utils.function_calling.tool_example_to_messages.html">tool_example_to_messages</a></p><p>æ¯”è¾ƒåŠ ä¸Šexampleä¹‹å‰å’Œä¹‹åçš„æ•ˆæœ</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">message_no_extraction = &#123;<br>    <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>    <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;The solar system is large, but earth has only 1 moon.&quot;</span>,<br>&#125;<br><br>structured_llm = model<span class="hljs-selector-class">.with_structured_output</span>(schema=Data)<br>structured_llm<span class="hljs-selector-class">.invoke</span>(<span class="hljs-selector-attr">[message_no_extraction]</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">structured_llm.invoke(messages + [message_no_extraction])<br></code></pre></td></tr></table></figure><p>æ›´å¤šä¿¡æ¯ <a href="https://python.langchain.com/docs/how_to/extraction_examples/">this guide</a></p>]]></content>
    
    
    <categories>
      
      <category>LLM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LangChain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LangChain]Classification</title>
    <link href="/2025/03/29/LangChain-Classification/"/>
    <url>/2025/03/29/LangChain-Classification/</url>
    
    <content type="html"><![CDATA[<h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1 æ¦‚è¿°"></a>1 æ¦‚è¿°</h1><p>æ ‡ç­¾æ˜¯æŒ‡ä½¿ç”¨å„ç±»åˆ†ç±»å¯¹æ–‡æ¡£è¿›è¡Œæ ‡æ³¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>æƒ…æ„Ÿåˆ†æï¼šè¯†åˆ«æ–‡æ¡£ä¸­çš„ä¸»è§‚ä¿¡æ¯ï¼Œåˆ¤æ–­ä½œè€…çš„æ€åº¦æ˜¯ç§¯æã€æ¶ˆæè¿˜æ˜¯ä¸­ç«‹ã€‚</li><li>è¯­è¨€ç±»å‹ï¼šç¡®å®šæ–‡æ¡£æ‰€ä½¿ç”¨çš„è¯­è¨€ï¼Œå¦‚è‹±è¯­ã€æ±‰è¯­ç­‰ã€‚</li><li>æ–‡ä½“ï¼ˆæ­£å¼ã€éæ­£å¼ç­‰ï¼‰ï¼šæ ¹æ®æ–‡æ¡£çš„è¯­è¨€é£æ ¼è¿›è¡Œåˆ†ç±»ï¼Œé€‚ç”¨äºä¸åŒåœºåˆå’Œè¯»è€…ç¾¤ä½“çš„éœ€æ±‚ã€‚</li><li>è¦†ç›–çš„ä¸»é¢˜ï¼šæ ‡è¯†æ–‡æ¡£è®¨è®ºçš„ä¸»è¦è¯é¢˜æˆ–é¢†åŸŸï¼Œæœ‰åŠ©äºå¿«é€Ÿäº†è§£æ–‡æ¡£å†…å®¹çš„æ ¸å¿ƒã€‚</li><li>æ”¿æ²»å€¾å‘ï¼šè¯„ä¼°æ–‡æ¡£å†…å®¹æ˜¯å¦è¡¨ç°å‡ºç‰¹å®šçš„æ”¿æ²»ç«‹åœºæˆ–è§‚ç‚¹ã€‚</li></ul><p>è¿™äº›æ ‡ç­¾èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œç®¡ç†å¤§é‡æ–‡æœ¬æ•°æ®ï¼Œæé«˜ä¿¡æ¯æ£€ç´¢çš„æ•ˆç‡ï¼Œå¹¶æ”¯æŒæ›´ç²¾ç¡®çš„å†…å®¹æ¨èå’Œåˆ†æã€‚ä¾‹å¦‚ï¼Œåœ¨æ„å»ºä¸€ä¸ªæ–°é—»èšåˆå¹³å°æ—¶ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–çš„æ ‡ç­¾æŠ€æœ¯ï¼Œå¯ä»¥å®ç°å¯¹æ–°é—»æ–‡ç« çš„æ™ºèƒ½åˆ†ç±»ä¸ä¸ªæ€§åŒ–æ¨é€ï¼Œä»è€Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚</p><p><img src="/../images/LangChain-Classification/image-20250329200801213.png"></p><p>æ ‡ç­¾æŠ€æœ¯ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><ul><li><p><strong>function</strong>ï¼šç±»ä¼¼äºä¿¡æ¯æŠ½å–ï¼Œæ ‡ç­¾è¿‡ç¨‹ä½¿ç”¨ç‰¹å®šçš„åŠŸèƒ½å‡½æ•°æ¥æŒ‡å®šæ¨¡å‹åº”å¦‚ä½•å¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç±»ã€‚è¿™äº›å‡½æ•°æŒ‡å¯¼æ¨¡å‹è¯†åˆ«å¹¶åº”ç”¨é€‚å½“çš„æ ‡ç­¾åˆ°æ–‡æœ¬æ•°æ®ä¸Šã€‚</p></li><li><p><strong>schema</strong>ï¼šå®šä¹‰äº†æˆ‘ä»¬å¸Œæœ›å¦‚ä½•å¯¹æ–‡æ¡£è¿›è¡Œæ ‡æ³¨çš„ç»“æ„å’Œè§„åˆ™ã€‚æ¨¡å¼è¯¦ç»†è¯´æ˜äº†ä½¿ç”¨çš„æ ‡ç­¾ç±»å‹ã€æ ‡ç­¾ä¹‹é—´çš„å…³ç³»ä»¥åŠå®ƒä»¬åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­çš„åº”ç”¨æ–¹å¼ã€‚</p></li></ul><p><strong>ç¤ºä¾‹</strong></p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªPydanticæ¨¡å‹ï¼ŒåŒ…å«å‡ ä¸ªå±æ€§åŠå…¶é¢„æœŸç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Classification</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    sentiment: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">&quot;The sentiment of the text&quot;</span>)<br>    aggressiveness: <span class="hljs-built_in">int</span> = Field(<br>        description=<span class="hljs-string">&quot;How aggressive the text is on a scale from 1 to 10&quot;</span><br>    )<br>    language: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">&quot;The language the text is written in&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ChatPromptTemplateæ„å»ºæç¤ºæ¨¡æ¿ï¼Œä»¥æå–æ‰€éœ€ä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><br>tagging_prompt = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Extract the desired information from the following passage.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Only extract the properties mentioned in the &#x27;Classification&#x27; function.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Passage:</span><br><span class="hljs-string">&#123;input&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>)<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œç»“åˆè¯­è¨€æ¨¡å‹ä¸å®šä¹‰çš„Pydanticæ¨¡å‹ï¼Œä»¥å®ç°ç»“æ„åŒ–çš„è¾“å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">llm_with_output = ChatOpenAI(temperature=<span class="hljs-number">0</span>, model=<span class="hljs-string">&quot;gpt-4o-mini&quot;</span>).with_structured_output(Classification)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">inp = <span class="hljs-string">&quot;Estoy increiblemente contento de haberte conocido! Creo que seremos muy buenos amigos!&quot;</span><br>prompt = tagging_prompt.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: inp&#125;)<br>response = llm.invoke(prompt)<br><br>response<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦dictæ ¼å¼çš„è¾“å‡ºï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ <code>.model_dump()</code></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">response<span class="hljs-selector-class">.model_dump</span>()<br></code></pre></td></tr></table></figure><h1 id="2-Finer-Control"><a href="#2-Finer-Control" class="headerlink" title="2 Finer Control"></a>2 Finer Control</h1><p>ç²¾ç¡®çš„Schemaå®šä¹‰ä½¿æˆ‘ä»¬å¯¹æ¨¡å‹è¾“å‡ºå…·æœ‰æ›´å¤šçš„æ§åˆ¶åŠ›ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å¢å¼ºå¯¹æ¯ä¸ªå±æ€§çš„æ§åˆ¶ï¼š</p><ul><li>ä¸ºæ¯ä¸ªå±æ€§å®šä¹‰å¯èƒ½çš„å€¼ã€‚</li><li>æä¾›æè¿°ä»¥ç¡®ä¿æ¨¡å‹æ­£ç¡®ç†è§£å„ä¸ªå±æ€§çš„æ„ä¹‰ã€‚</li><li>æŒ‡å®šå¿…é¡»è¿”å›çš„å±æ€§ã€‚</li></ul><p>é‡æ–°å£°æ˜ä¹‹å‰çš„Pydanticæ¨¡å‹ï¼Œå¹¶ä½¿ç”¨æšä¸¾(enum)æ¥æ§åˆ¶å„å±æ€§çš„å–å€¼èŒƒå›´ã€‚</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Classification</span>(BaseModel):<br>    sentiment: <span class="hljs-built_in">str</span> = Field(..., <span class="hljs-built_in">enum</span>=[<span class="hljs-string">&quot;happy&quot;</span>, <span class="hljs-string">&quot;neutral&quot;</span>, <span class="hljs-string">&quot;sad&quot;</span>])<br>    aggressiveness: <span class="hljs-built_in">int</span> = Field(<br>        ...,<br>        description=<span class="hljs-string">&quot;describes how aggressive the statement is, the higher the number the more aggressive&quot;</span>,<br>        <span class="hljs-built_in">enum</span>=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>],<br>    )<br>    language: <span class="hljs-built_in">str</span> = Field(<br>        ..., <span class="hljs-built_in">enum</span>=[<span class="hljs-string">&quot;spanish&quot;</span>, <span class="hljs-string">&quot;english&quot;</span>, <span class="hljs-string">&quot;french&quot;</span>, <span class="hljs-string">&quot;german&quot;</span>, <span class="hljs-string">&quot;italian&quot;</span>]<br>    )<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>...</code> ç”¨æ¥è¡¨ç¤ºè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚</p><h1 id="3-æ›´å¤šä¿¡æ¯"><a href="#3-æ›´å¤šä¿¡æ¯" class="headerlink" title="3 æ›´å¤šä¿¡æ¯"></a>3 æ›´å¤šä¿¡æ¯</h1><p>å¯ä»¥å‚è€ƒ <a href="https://python.langchain.com/docs/integrations/document_transformers/openai_metadata_tagger/">metadata tagger</a> ä»Documentå¯¹è±¡ä¸­æå–metadataã€‚å’Œä¸Šè¿°åŠŸèƒ½ä¸€è‡´ï¼Œåªä¸è¿‡æ”¯æŒ <code>Document</code>å¯¹è±¡.</p>]]></content>
    
    
    <categories>
      
      <category>LLM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LangChain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LangChain]Semantic search</title>
    <link href="/2025/03/29/LangChain-Semantic-search/"/>
    <url>/2025/03/29/LangChain-Semantic-search/</url>
    
    <content type="html"><![CDATA[<h1 id="0-Useful-Docs"><a href="#0-Useful-Docs" class="headerlink" title="0 Useful Docs"></a>0 Useful Docs</h1><ul><li><a href="https://python.langchain.com/docs/concepts/document_loaders/">document loader</a></li><li><a href="https://python.langchain.com/docs/concepts/embedding_models/">embedding</a></li><li><a href="https://python.langchain.com/docs/concepts/vectorstores/">vector store</a></li><li><a href="https://python.langchain.com/docs/concepts/rag/">RAG</a></li></ul><h1 id="1-Setup"><a href="#1-Setup" class="headerlink" title="1 Setup"></a>1 Setup</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> langchain-community pypdf<br></code></pre></td></tr></table></figure><h1 id="2-Documents-and-Document-Loaders"><a href="#2-Documents-and-Document-Loaders" class="headerlink" title="2 Documents and Document Loaders"></a>2 Documents and Document Loaders</h1><p>LangChainå®ç°äº†<a href="https://python.langchain.com/api_reference/core/documents/langchain_core.documents.base.Document.html">Document</a> abstractionï¼Œæ—¨åœ¨è¡¨ç¤ºæ–‡æœ¬å•å…ƒåŠå…¶ç›¸å…³å…ƒæ•°æ®ã€‚å®ƒåŒ…å«ä¸‰ä¸ªå±æ€§ï¼š</p><ul><li><code>page_content</code>: å­—ç¬¦ä¸²å½¢å¼çš„å†…å®¹ï¼›</li><li><code>metadata</code>: åŒ…å«ä»»æ„å…ƒæ•°æ®çš„å­—å…¸ï¼›</li><li><code>id</code>: ï¼ˆå¯é€‰ï¼‰æ–‡æ¡£çš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ã€‚</li></ul><p><code>metadata</code>å±æ€§å¯ä»¥æ•æ‰å…³äºæ–‡æ¡£æ¥æºã€ä¸å…¶ä»–æ–‡æ¡£çš„å…³ç³»åŠå…¶ä»–ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå•ç‹¬çš„<code>Document</code>å¯¹è±¡é€šå¸¸ä»£è¡¨è¾ƒå¤§æ–‡æ¡£ä¸­çš„ä¸€ä¸ªchunkã€‚</p><p>LangChain ecosystemå®ç°äº†ä¸æ•°ç™¾ç§å¸¸è§æ•°æ®æºé›†æˆçš„æ–‡æ¡£åŠ è½½å™¨ã€‚</p><p>API Reference: <a href="https://python.langchain.com/api_reference/core/documents/langchain_core.documents.base.Document.html">Document</a></p><h3 id="Loading-documents"><a href="#Loading-documents" class="headerlink" title="Loading documents"></a>Loading documents</h3><p>åœ¨LangChainä»“åº“ä¸­<a href="https://github.com/langchain-ai/langchain/tree/master/docs/docs/example_data">here</a>ï¼Œæœ‰ä¸€ä¸ªæ ·æœ¬PDFâ€”â€”è¿™æ˜¯è€å…‹å…¬å¸2023å¹´çš„10-KæŠ¥è¡¨ã€‚å¯ä»¥æŸ¥é˜…LangChainæ–‡æ¡£æ¥äº†è§£å¯ç”¨çš„<a href="https://python.langchain.com/docs/integrations/document_loaders/#pdfs">PDFæ–‡æ¡£åŠ è½½å™¨</a>ã€‚è¿™é‡Œé€‰æ‹©ä½¿ç”¨ç›¸å¯¹è½»é‡çº§çš„PyPDFLoaderã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> PyPDFLoader<br><br>file_path = <span class="hljs-string">&quot;./nke-10k-2023.pdf&quot;</span><br>loader = PyPDFLoader(file_path)<br><br>docs = loader.load()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(docs))<br></code></pre></td></tr></table></figure><p>PyPDFLoaderä¸ºæ¯ä¸ªPDFé¡µé¢åŠ è½½ä¸€ä¸ªDocumentå¯¹è±¡ã€‚å¯¹äºæ¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è®¿é—®ï¼š</p><ul><li>é¡µé¢çš„å­—ç¬¦ä¸²å†…å®¹ï¼›</li><li>åŒ…å«æ–‡ä»¶åå’Œé¡µç çš„å…ƒæ•°æ®ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯å¦‚ä½•è®¿é—®å¹¶æ‰“å°ç¬¬ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡çš„å‰200ä¸ªå­—ç¬¦çš„å†…å®¹ä»¥åŠå…¶å…ƒæ•°æ®çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ‰“å°ç¬¬ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡çš„å‰200ä¸ªå­—ç¬¦</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;docs[<span class="hljs-number">0</span>].page_content[:<span class="hljs-number">200</span>]&#125;</span>\n&quot;</span>)<br><br><span class="hljs-comment"># æ‰“å°ç¬¬ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡çš„å…ƒæ•°æ®</span><br><span class="hljs-built_in">print</span>(docs[<span class="hljs-number">0</span>].metadata)<br></code></pre></td></tr></table></figure><h2 id="splitting"><a href="#splitting" class="headerlink" title="splitting"></a>splitting</h2><p>åœ¨ä¿¡æ¯æ£€ç´¢å’Œä¸‹æ¸¸é—®ç­”ä»»åŠ¡ä¸­ï¼Œå°†é¡µé¢ä½œä¸ºå•ç‹¬çš„è¡¨ç¤ºå•ä½å¯èƒ½è¿‡äºç²—ç³™ã€‚æœ€ç»ˆç›®æ ‡æ˜¯æ£€ç´¢èƒ½å¤Ÿå›ç­”è¾“å…¥æŸ¥è¯¢çš„æ–‡æ¡£å¯¹è±¡ï¼Œè¿›ä¸€æ­¥æ‹†åˆ†PDFæ–‡ä»¶æœ‰åŠ©äºç¡®ä¿æ–‡æ¡£ç›¸å…³éƒ¨åˆ†çš„æ„ä¹‰ä¸ä¼šè¢«å‘¨å›´æ–‡æœ¬â€œå†²æ·¡â€ã€‚</p><p>ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨æ–‡æœ¬åˆ†å‰²å™¨ã€‚è¿™é‡Œé‡‡ç”¨åŸºäºå­—ç¬¦çš„ç®€å•åˆ†å‰²æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œå°†æ–‡æ¡£åˆ†å‰²æˆ1000ä¸ªå­—ç¬¦çš„å—ï¼Œå¹¶ä¸”ç›¸é‚»å—ä¹‹é—´æœ‰200ä¸ªå­—ç¬¦çš„é‡å ã€‚è¿™ç§é‡å æœ‰åŠ©äºå‡å°‘å°†é™ˆè¿°ä¸å…¶é‡è¦ä¸Šä¸‹æ–‡åˆ†ç¦»çš„å¯èƒ½æ€§ã€‚</p><p>ä½¿ç”¨<a href="https://python.langchain.com/docs/how_to/recursive_text_splitter/">RecursiveCharacterTextSplitter</a>ï¼Œå®ƒä¼šé€’å½’åœ°ä½¿ç”¨å¸¸è§åˆ†éš”ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦ï¼‰åˆ†å‰²æ–‡æ¡£ï¼Œç›´åˆ°æ¯ä¸ªå—è¾¾åˆ°åˆé€‚çš„å¤§å°ã€‚å¯¹äºé€šç”¨æ–‡æœ¬ç”¨ä¾‹ï¼Œæ¨èä½¿ç”¨æ­¤æ–‡æœ¬åˆ†å‰²å™¨ã€‚</p><p>é€šè¿‡è®¾ç½®<code>add_start_index=True</code>ï¼Œå¯ä»¥ä¿ç•™æ¯ä¸ªåˆ†å‰²åDocumentå¯¹è±¡åœ¨å…¶åŸå§‹æ–‡æ¡£ä¸­çš„èµ·å§‹å­—ç¬¦ç´¢å¼•ï¼Œå¹¶å°†å…¶ä½œä¸ºå…ƒæ•°æ®å±æ€§â€start_indexâ€ä¿å­˜ã€‚</p><p>å‚è€ƒ<a href="https://python.langchain.com/docs/how_to/document_loader_pdf/">here</a>ä»¥è·å–æ›´å¤šå…³äºå¤„ç†PDFæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¦‚ä½•ä»ç‰¹å®šéƒ¨åˆ†å’Œå›¾åƒä¸­æå–æ–‡æœ¬ã€‚</p><p>API Reference: <a href="https://python.langchain.com/api_reference/text_splitters/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html">RecursiveCharacterTextSplitter</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter<br><br>text_splitter = RecursiveCharacterTextSplitter(<br>    chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">200</span>, add_start_index=<span class="hljs-literal">True</span><br>)<br>all_splits = text_splitter.split_documents(docs)<br><br><span class="hljs-built_in">len</span>(all_splits)<br></code></pre></td></tr></table></figure><h1 id="3-Embeddings"><a href="#3-Embeddings" class="headerlink" title="3 Embeddings"></a>3 Embeddings</h1><p>å‘é‡æœç´¢æ˜¯ä¸€ç§å¸¸è§çš„å­˜å‚¨å’Œæœç´¢éç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚éç»“æ„åŒ–æ–‡æœ¬ï¼‰çš„æ–¹æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å­˜å‚¨ä¸æ–‡æœ¬å…³è”çš„æ•°å­—å‘é‡ã€‚ç»™å®šä¸€ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åµŒå…¥ä¸ºç›¸åŒç»´åº¦çš„å‘é‡ï¼Œå¹¶ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦æŒ‡æ ‡ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰æ¥è¯†åˆ«ç›¸å…³çš„æ–‡æœ¬ã€‚</p><p>LangChain æ”¯æŒæ¥è‡ªæ•°åä¸ªä¾›åº”å•†çš„<a href="https://python.langchain.com/docs/integrations/text_embedding/">åµŒå…¥æ¨¡å‹</a>ã€‚è¿™äº›æ¨¡å‹å®šä¹‰äº†å¦‚ä½•å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—å‘é‡ã€‚</p><p>è¿™é‡Œé€‰æ‹©HuggingFaceæ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_huggingface <span class="hljs-keyword">import</span> HuggingFaceEmbeddings<br><br>embeddings = HuggingFaceEmbeddings(model_name=<span class="hljs-string">&quot;sentence-transformers/all-mpnet-base-v2&quot;</span>)<br><br>vector_1 = embeddings.embed_query(all_splits[<span class="hljs-number">0</span>].page_content)<br>vector_2 = embeddings.embed_query(all_splits[<span class="hljs-number">1</span>].page_content)<br><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(vector_1) == <span class="hljs-built_in">len</span>(vector_2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Generated vectors of length <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(vector_1)&#125;</span>\n&quot;</span>)<br><span class="hljs-built_in">print</span>(vector_1[:<span class="hljs-number">10</span>])<br></code></pre></td></tr></table></figure><h1 id="4-Vector-stores"><a href="#4-Vector-stores" class="headerlink" title="4 Vector stores"></a>4 Vector stores</h1><p>LangChainçš„<a href="https://python.langchain.com/api_reference/core/vectorstores/langchain_core.vectorstores.base.VectorStore.html">VectorStore</a>å¯¹è±¡åŒ…å«äº†å‘å­˜å‚¨ä¸­æ·»åŠ æ–‡æœ¬å’ŒDocumentå¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶æ”¯æŒä½¿ç”¨å¤šç§ç›¸ä¼¼åº¦åº¦é‡è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™äº›å¯¹è±¡é€šå¸¸ä¸<a href="https://python.langchain.com/docs/how_to/embed_text/">embedding</a>æ¨¡å‹ä¸€èµ·åˆå§‹åŒ–ï¼Œä»¥ç¡®å®šæ–‡æœ¬æ•°æ®å¦‚ä½•è½¬æ¢ä¸ºæ•°å€¼å‘é‡ã€‚</p><p>LangChainæä¾›äº†ä¸€ç³»åˆ—åŸºäºä¸åŒå‘é‡å­˜å‚¨æŠ€æœ¯çš„<a href="https://python.langchain.com/docs/integrations/vectorstores/">integrations</a> ã€‚ä¸€äº›å‘é‡å­˜å‚¨ç”±ä¾›åº”å•†æ‰˜ç®¡ï¼ˆä¾‹å¦‚ï¼Œä¸åŒçš„äº‘æœåŠ¡æä¾›å•†ï¼‰ï¼Œå¹¶éœ€è¦ç‰¹å®šçš„å‡­æ®æ‰èƒ½è®¿é—®ï¼›æœ‰äº›ï¼ˆå¦‚<a href="https://python.langchain.com/docs/integrations/vectorstores/pgvector/">Postgres</a>ï¼‰åˆ™å¯ä»¥åœ¨ç‹¬ç«‹çš„åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œï¼Œæ—¢å¯æœ¬åœ°éƒ¨ç½²ä¹Ÿå¯é€šè¿‡ç¬¬ä¸‰æ–¹å®ç°ï¼›è¿˜æœ‰äº›å¯ä»¥åœ¨å†…å­˜ä¸­è¿è¡Œï¼Œé€‚ç”¨äºè½»é‡çº§å·¥ä½œè´Ÿè½½ã€‚ </p><p>è¿™é‡Œé€‰æ‹©In-memoryç±»å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.vectorstores <span class="hljs-keyword">import</span> InMemoryVectorStore<br><br>vector_store = InMemoryVectorStore(embeddings)<br></code></pre></td></tr></table></figure><p>åœ¨å®ä¾‹åŒ–äº†æˆ‘ä»¬çš„å‘é‡å­˜å‚¨ä¹‹åï¼Œç°åœ¨å¯ä»¥å¯¹æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ids = vector_store.add_documents(documents=all_splits)<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°å‘é‡å­˜å‚¨å®ç°å…è®¸è¿æ¥åˆ°ç°æœ‰çš„å‘é‡å­˜å‚¨â€”â€”ä¾‹å¦‚ï¼Œé€šè¿‡æä¾›å®¢æˆ·ç«¯ã€ç´¢å¼•åç§°æˆ–å…¶ä»–ä¿¡æ¯è¿›è¡Œè¿æ¥ã€‚æœ‰å…³ç‰¹å®š<a href="https://python.langchain.com/docs/integrations/vectorstores/">integration</a>çš„æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚é˜…ç›¸å…³æ–‡æ¡£ã€‚</p><p>ä¸€æ—¦æˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ªåŒ…å«æ–‡æ¡£çš„VectorStoreï¼Œå°±å¯ä»¥å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢ã€‚VectorStoreæä¾›äº†å¤šç§æŸ¥è¯¢æ–¹æ³•ï¼š</p><ul><li>åŒæ­¥ä¸å¼‚æ­¥æŸ¥è¯¢ï¼›</li><li>é€šè¿‡å­—ç¬¦ä¸²æŸ¥è¯¢å’Œå‘é‡æŸ¥è¯¢ï¼›</li><li>æ”¯æŒè¿”å›æˆ–ä¸è¿”å›ç›¸ä¼¼åº¦åˆ†æ•°ï¼›</li><li>æŒ‰ç›¸ä¼¼åº¦ä»¥åŠ<a href="https://python.langchain.com/api_reference/core/vectorstores/langchain_core.vectorstores.base.VectorStore.html#langchain_core.vectorstores.base.VectorStore.max_marginal_relevance_search">maximum marginal relevance</a>ï¼ˆåœ¨æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§å’Œå¤šæ ·æ€§ä¹‹é—´å–å¾—å¹³è¡¡ï¼‰è¿›è¡ŒæŸ¥è¯¢ã€‚</li></ul><p>è¿™äº›æ–¹æ³•é€šå¸¸åœ¨å…¶è¾“å‡ºä¸­åŒ…å«ä¸€ä¸ªDocumentå¯¹è±¡åˆ—è¡¨ã€‚</p><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>åµŒå…¥é€šå¸¸å°†æ–‡æœ¬è¡¨ç¤ºä¸ºâ€œå¯†é›†â€å‘é‡ï¼Œä½¿å¾—å…·æœ‰ç›¸ä¼¼æ„ä¹‰çš„æ–‡æœ¬åœ¨å‡ ä½•ç©ºé—´ä¸­å½¼æ­¤æ¥è¿‘ã€‚</p><p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ ¹æ®ä¸å­—ç¬¦ä¸²æŸ¥è¯¢çš„ç›¸ä¼¼åº¦æ¥æ£€ç´¢æ–‡æ¡£ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ ¹æ®ç›¸ä¼¼åº¦æœç´¢è¿”å›ç»“æœ</span><br>results = vector_store.similarity_search(<span class="hljs-string">&quot;How many distribution centers does Nike have in the US?&quot;</span>)<br><br><span class="hljs-comment"># è¾“å‡ºç¬¬ä¸€ä¸ªç»“æœ</span><br><span class="hljs-built_in">print</span>(results[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><p>å¼‚æ­¥æŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">results = <span class="hljs-keyword">await</span> vector_store.asimilarity_search(<span class="hljs-string">&quot;When was Nike incorporated?&quot;</span>)<br><br><span class="hljs-built_in">print</span>(results[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><p>è¿”å›åˆ†æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Note that providers implement different scores;</span><br><br>results = vector_store.similarity_search_with_score(<span class="hljs-string">&quot;What was Nike&#x27;s revenue in 2023?&quot;</span>)<br>doc, score = results[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Score: <span class="hljs-subst">&#123;score&#125;</span>\n&quot;</span>)<br><span class="hljs-built_in">print</span>(doc)<br></code></pre></td></tr></table></figure><p>æ ¹æ®å‘é‡æŸ¥è¯¢ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">embedding = embeddings.embed_query(<span class="hljs-string">&quot;How were Nike&#x27;s margins impacted in 2023?&quot;</span>)<br><br>results = vector_store.similarity_search_by_vector(embedding)<br><span class="hljs-built_in">print</span>(results[<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure><p>æ›´å¤šä¿¡æ¯ï¼š</p><ul><li><a href="https://python.langchain.com/api_reference/core/vectorstores/langchain_core.vectorstores.base.VectorStore.html">API reference</a></li><li><a href="https://python.langchain.com/docs/how_to/vectorstores/">How-to guide</a></li><li><a href="https://python.langchain.com/docs/integrations/vectorstores/">Integration-specific docs</a></li></ul><h1 id="5-Retrievers"><a href="#5-Retrievers" class="headerlink" title="5 Retrievers"></a>5 Retrievers</h1><p>LangChainçš„VectorStoreå¯¹è±¡å¹¶ä¸ç»§æ‰¿è‡ªRunnableæ¥å£ï¼Œè€ŒLangChainçš„æ£€ç´¢å™¨ï¼ˆ<a href="https://python.langchain.com/api_reference/core/index.html#langchain-core-retrievers">Retrievers</a>ï¼‰æ˜¯å®ç°äº†Runnableæ¥å£çš„ï¼Œå› æ­¤å®ƒä»¬æ”¯æŒä¸€ç³»åˆ—æ ‡å‡†æ–¹æ³•ï¼Œå¦‚åŒæ­¥å’Œå¼‚æ­¥ <code>invoke</code> åŠ <code>batch</code> æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥ä»vector storesæ„å»ºæ£€ç´¢å™¨ï¼Œæ£€ç´¢å™¨ä¹Ÿæ”¯æŒä¸éå‘é‡å­˜å‚¨çš„æ•°æ®æºæ¥å£äº¤äº’ï¼Œæ¯”å¦‚å¤–éƒ¨APIã€‚</p><p>å³ä¾¿ä¸ç›´æ¥ç»§æ‰¿Retrieverç±»ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½åˆ›å»ºä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬ã€‚åªè¦å®šä¹‰äº†ç”¨äºæ£€ç´¢æ–‡æ¡£çš„æ–¹æ³•ï¼Œå°±å¯ä»¥è½»æ¾åˆ›å»ºä¸€ä¸ªå¯è¿è¡Œçš„å¯¹è±¡ã€‚ä¸‹é¢çš„ä¾‹å­å°†å›´ç»•<code>similarity_search</code>æ–¹æ³•æ¥æ„å»ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><span class="hljs-keyword">from</span> langchain_core.documents <span class="hljs-keyword">import</span> Document<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> chain<br><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªä½¿ç”¨similarity_searchæ–¹æ³•çš„æ£€ç´¢å™¨</span><br><span class="hljs-meta">@chain</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">retriever</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:<br>    <span class="hljs-keyword">return</span> vector_store.similarity_search(query, k=<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># å¯¹å¤šä¸ªæŸ¥è¯¢æ‰§è¡Œæ‰¹å¤„ç†æ“ä½œ</span><br>retriever.batch([<br>    <span class="hljs-string">&quot;How many distribution centers does Nike have in the US?&quot;</span>,<br>    <span class="hljs-string">&quot;When was Nike incorporated?&quot;</span>,<br>])<br></code></pre></td></tr></table></figure><p>API Reference: <a href="https://python.langchain.com/api_reference/core/documents/langchain_core.documents.base.Document.html">Document</a> | <a href="https://python.langchain.com/api_reference/core/runnables/langchain_core.runnables.base.chain.html">chain</a></p><p>å‘é‡å­˜å‚¨ï¼ˆVectorStoreï¼‰å®ç°äº†<code>as_retriever</code>æ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªä¸“é—¨çš„<a href="https://python.langchain.com/api_reference/core/vectorstores/langchain_core.vectorstores.base.VectorStoreRetriever.html">VectorStoreRetriever</a>ã€‚è¿™ç±»æ£€ç´¢å™¨åŒ…å«ç‰¹å®šçš„<code>search_type</code>å’Œ<code>search_kwargs</code>å±æ€§ï¼Œç”¨äºæŒ‡å®šè°ƒç”¨åº•å±‚å‘é‡å­˜å‚¨çš„å“ªäº›æ–¹æ³•åŠå…¶å‚æ•°åŒ–æ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªVectorStoreRetrieverï¼Œè®¾ç½®æœç´¢ç±»å‹ä¸ºç›¸ä¼¼æ€§æœç´¢ï¼Œå¹¶æŒ‡å®šè¿”å›æœ€ç›¸å…³çš„1ä¸ªç»“æœ</span><br>retriever = vector_store.as_retriever(<br>    search_type=<span class="hljs-string">&quot;similarity&quot;</span>,<br>    search_kwargs=&#123;<span class="hljs-string">&quot;k&quot;</span>: <span class="hljs-number">1</span>&#125;,<br>)<br><br><span class="hljs-comment"># å¯¹å¤šä¸ªæŸ¥è¯¢æ‰§è¡Œæ‰¹å¤„ç†æ“ä½œ</span><br>retriever.batch([<br>    <span class="hljs-string">&quot;How many distribution centers does Nike have in the US?&quot;</span>,<br>    <span class="hljs-string">&quot;When was Nike incorporated?&quot;</span>,<br>])<br></code></pre></td></tr></table></figure><p><code>VectorStoreRetriever</code>æ”¯æŒå¤šç§æœç´¢ç±»å‹ï¼ŒåŒ…æ‹¬é»˜è®¤çš„â€similarityâ€ï¼ˆç›¸ä¼¼æ€§ï¼‰ã€â€mmrâ€ï¼ˆæœ€å¤§è¾¹é™…ç›¸å…³æ€§ï¼‰ä»¥åŠâ€similarity_score_thresholdâ€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€similarity_score_thresholdâ€æ ¹æ®ç›¸ä¼¼åº¦åˆ†æ•°å¯¹æ£€ç´¢å™¨è¾“å‡ºçš„æ–‡æ¡£è¿›è¡Œé˜ˆå€¼è®¾å®šï¼Œä»è€Œæ§åˆ¶è¿”å›ç»“æœçš„ç›¸å…³æ€§ç¨‹åº¦ã€‚</p><p>æ£€ç´¢å™¨å¯ä»¥è½»æ¾é›†æˆåˆ°æ›´å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¾‹å¦‚ç»“åˆç‰¹å®šé—®é¢˜ä¸æ£€ç´¢ä¸Šä¸‹æ–‡ä»¥ç”Ÿæˆæç¤ºç»™è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„ <a href="https://python.langchain.com/docs/concepts/rag/">retrieval-augmented generation (RAG)</a>åº”ç”¨ã€‚</p><h1 id="6-æ›´å¤šä¿¡æ¯"><a href="#6-æ›´å¤šä¿¡æ¯" class="headerlink" title="6 æ›´å¤šä¿¡æ¯"></a>6 æ›´å¤šä¿¡æ¯</h1><p>Retrieval strategies can be rich and complex. For example:</p><ul><li>We can <a href="https://python.langchain.com/docs/how_to/self_query/">infer hard rules and filters</a> from a query (e.g., â€œusing documents published after 2020â€);</li><li>We can <a href="https://python.langchain.com/docs/how_to/parent_document_retriever/">return documents that are linked</a> to the retrieved context in some way (e.g., via some document taxonomy);</li><li>We can generate <a href="https://python.langchain.com/docs/how_to/multi_vector/">multiple embeddings</a> for each unit of context;</li><li>We can <a href="https://python.langchain.com/docs/how_to/ensemble_retriever/">ensemble results</a> from multiple retrievers;</li><li>We can assign weights to documents, e.g., to weigh <a href="https://python.langchain.com/docs/how_to/time_weighted_vectorstore/">recent documents</a> higher.</li></ul><p>The <a href="https://python.langchain.com/docs/how_to/#retrievers">retrievers</a> section of the how-to guides covers these and other built-in retrieval strategies.</p><p>It is also straightforward to extend the <a href="https://python.langchain.com/api_reference/core/retrievers/langchain_core.retrievers.BaseRetriever.html">BaseRetriever</a> class in order to implement custom retrievers. See our how-to guide <a href="https://python.langchain.com/docs/how_to/custom_retriever/">here</a>.</p><p>For more on document loaders:</p><ul><li><a href="https://python.langchain.com/docs/concepts/document_loaders/">Conceptual guide</a></li><li><a href="https://python.langchain.com/docs/how_to/#document-loaders">How-to guides</a></li><li><a href="https://python.langchain.com/docs/integrations/document_loaders/">Available integrations</a></li></ul><p>For more on embeddings:</p><ul><li><a href="https://python.langchain.com/docs/concepts/embedding_models/">Conceptual guide</a></li><li><a href="https://python.langchain.com/docs/how_to/#embedding-models">How-to guides</a></li><li><a href="https://python.langchain.com/docs/integrations/text_embedding/">Available integrations</a></li></ul><p>For more on vector stores:</p><ul><li><a href="https://python.langchain.com/docs/concepts/vectorstores/">Conceptual guide</a></li><li><a href="https://python.langchain.com/docs/how_to/#vector-stores">How-to guides</a></li><li><a href="https://python.langchain.com/docs/integrations/vectorstores/">Available integrations</a></li></ul><p>For more on RAG, see:</p><ul><li><a href="https://python.langchain.com/docs/tutorials/rag/">Build a Retrieval Augmented Generation (RAG) App</a></li><li><a href="https://python.langchain.com/docs/how_to/#qa-with-rag">Related how-to guides</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>LLM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LangChain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LangChain]Chat models and prompts</title>
    <link href="/2025/03/29/LangChain-Chat-models-and-prompts/"/>
    <url>/2025/03/29/LangChain-Chat-models-and-prompts/</url>
    
    <content type="html"><![CDATA[<h1 id="0-Useful-Docs"><a href="#0-Useful-Docs" class="headerlink" title="0 Useful Docs"></a>0 Useful Docs</h1><ul><li><a href="https://python.langchain.com/docs/concepts/chat_models/">language models</a></li><li><a href="https://python.langchain.com/docs/concepts/prompt_templates/">prompt templates</a> </li><li><a href="https://docs.smith.langchain.com/">LangSmith</a></li><li><a href="https://python.langchain.com/docs/concepts/">Conceptual Guides</a></li><li><a href="https://python.langchain.com/docs/how_to/#chat-models">Chat models</a></li><li><a href="https://python.langchain.com/docs/how_to/#prompt-templates">Prompt templates</a></li><li>[ChatTongyi](<a href="https://python.langchain.com/docs/integrations/chat/tongyi/">ChatTongyi | ğŸ¦œï¸ğŸ”— LangChain</a>)</li></ul><h1 id="1-Setup"><a href="#1-Setup" class="headerlink" title="1 Setup"></a>1 Setup</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> langchain<br></code></pre></td></tr></table></figure><p><a href="https://python.langchain.com/docs/how_to/installation/">installation guide</a></p><h1 id="2-LangSmith"><a href="#2-LangSmith" class="headerlink" title="2 LangSmith"></a>2 LangSmith</h1><p>åœ¨ä½¿ç”¨LangChainæ„å»ºçš„åº”ç”¨ç¨‹åºä¸­ï¼Œè®¸å¤šéƒ½ä¼šåŒ…å«å¤šä¸ªæ­¥éª¤ä»¥åŠå¤šæ¬¡è°ƒç”¨è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ã€‚LangSmithèƒ½å¤Ÿæ£€æŸ¥é“¾æˆ–agentå†…éƒ¨å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>æ³¨å†Œå¹¶ç™»å½•åï¼Œç¡®ä¿è®¾ç½®ç¯å¢ƒå˜é‡ä»¥å¼€å§‹è®°å½•è·Ÿè¸ªï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> LANGSMITH_TRACING=<span class="hljs-string">&quot;true&quot;</span><br><span class="hljs-built_in">export</span> LANGSMITH_API_KEY=<span class="hljs-string">&quot;...&quot;</span><br><span class="hljs-built_in">export</span> LANGSMITH_PROJECT=<span class="hljs-string">&quot;default&quot;</span> <span class="hljs-comment"># æˆ–è€…ä»»ä½•å…¶ä»–é¡¹ç›®åç§°</span><br></code></pre></td></tr></table></figure><p>è‹¥åœ¨notebookç¯å¢ƒä¸­ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è®¾ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> getpass<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv<br>    load_dotenv()<br><span class="hljs-keyword">except</span> ImportError:<br>    <span class="hljs-keyword">pass</span><br><br>os.environ[<span class="hljs-string">&quot;LANGSMITH_TRACING&quot;</span>] = <span class="hljs-string">&quot;true&quot;</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;LANGSMITH_API_KEY&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> os.environ:<br>    os.environ[<span class="hljs-string">&quot;LANGSMITH_API_KEY&quot;</span>] = getpass.getpass(prompt=<span class="hljs-string">&quot;è¾“å…¥æ‚¨çš„LangSmith APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰ï¼š&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;LANGSMITH_PROJECT&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> os.environ:<br>    project_name = getpass.getpass(prompt=<span class="hljs-string">&#x27;è¾“å…¥æ‚¨çš„LangSmithé¡¹ç›®åç§°ï¼ˆé»˜è®¤ä¸º&quot;default&quot;ï¼‰ï¼š&#x27;</span>)<br>    os.environ[<span class="hljs-string">&quot;LANGSMITH_PROJECT&quot;</span>] = project_name <span class="hljs-keyword">if</span> project_name <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;default&quot;</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> os.environ:<br>    os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = getpass.getpass(prompt=<span class="hljs-string">&quot;è¾“å…¥æ‚¨çš„OpenAI APIå¯†é’¥ï¼ˆå¦‚æœä½¿ç”¨OpenAIåˆ™å¿…é¡»ï¼‰ï¼š&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="3-Using-Language-Models"><a href="#3-Using-Language-Models" class="headerlink" title="3 Using Language Models"></a>3 Using Language Models</h1><p>LangChainæ”¯æŒå¤šç§ä¸åŒçš„è¯­è¨€æ¨¡å‹ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨è¿™äº›è¯­è¨€æ¨¡å‹ï¼Œå®ƒä»¬å¯ä»¥æ ¹æ®éœ€è¦äº’æ¢ä½¿ç”¨ã€‚<a href="https://python.langchain.com/docs/integrations/chat/">chat model</a>ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># install package</span><br>pip <span class="hljs-keyword">install</span> -qU <span class="hljs-string">&quot;langchain[openai]&quot;</span> <span class="hljs-comment"># openai</span><br>pip <span class="hljs-keyword">install</span> -qU dashscope <span class="hljs-comment"># Qwen</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> getpass<br><span class="hljs-keyword">import</span> os<br><span class="hljs-comment"># openai</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.environ.get(<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>):<br>  os.environ[<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>] = getpass.getpass(<span class="hljs-string">&quot;Enter API key for OpenAI: &quot;</span>)<br><br><span class="hljs-keyword">from</span> langchain.chat_models <span class="hljs-keyword">import</span> init_chat_model<br><br>model = init_chat_model(<span class="hljs-string">&quot;gpt-4o-mini&quot;</span>, model_provider=<span class="hljs-string">&quot;openai&quot;</span>)<br><br><span class="hljs-comment"># qwen</span><br><span class="hljs-keyword">from</span> langchain_community.chat_models <span class="hljs-keyword">import</span> ChatTongyi<br><br>tongyi_chat = ChatTongyi(<br>    model=<span class="hljs-string">&quot;qwen-max&quot;</span>,<br>    <span class="hljs-comment"># top_p=&quot;...&quot;,</span><br>    <span class="hljs-comment"># api_key=&quot;...&quot;,</span><br>    <span class="hljs-comment"># other params...</span><br>)<br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å‹ã€‚èŠå¤©æ¨¡å‹ï¼ˆ<a href="https://python.langchain.com/docs/concepts/chat_models/">ChatModels</a>ï¼‰æ˜¯LangChainè¿è¡Œä½“ï¼ˆ<a href="https://python.langchain.com/docs/concepts/runnables/">Runnables</a>ï¼‰çš„å®ä¾‹ï¼Œå®ƒä»¬æä¾›äº†ä¸€ä¸ªæ ‡å‡†æ¥å£ä»¥ä¾›äº¤äº’ã€‚è‹¥è¦ç®€å•è°ƒç”¨æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡.invokeæ–¹æ³•ä¼ å…¥æ¶ˆæ¯åˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage<br><br>messages = [<br>    SystemMessage(<span class="hljs-string">&quot;Translate the following from English into Italian&quot;</span>),<br>    HumanMessage(<span class="hljs-string">&quot;hi!&quot;</span>),<br>]<br><br>model.invoke(messages)<br></code></pre></td></tr></table></figure><p>APIå‚è€ƒï¼š<a href="https://python.langchain.com/api_reference/core/messages/langchain_core.messages.human.HumanMessage.html">HumanMessage</a> | <a href="https://python.langchain.com/api_reference/core/messages/langchain_core.messages.system.SystemMessage.html">SystemMessage</a></p><div class="note note-info">            <p>è‹¥å·²å¯ç”¨LangSmithï¼Œåˆ™èƒ½å¤Ÿçœ‹åˆ°æ­¤æ¬¡è¿è¡Œå·²è¢«è®°å½•åˆ°LangSmithä¸­ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹ç›¸åº”çš„LangSmith traceã€‚LangSmithæŠ¥å‘Šæä¾›äº†tokenä½¿ç”¨æƒ…å†µã€å»¶è¿Ÿæ—¶é—´ã€æ ‡å‡†æ¨¡å‹å‚æ•°ï¼ˆå¦‚temperatureè®¾ç½®ï¼‰åŠå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚</p>          </div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒèŠå¤©æ¨¡å‹æ¥æ”¶ <a href="https://python.langchain.com/docs/concepts/messages/">message</a> å¯¹è±¡ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆæ¶ˆæ¯å¯¹è±¡ä½œä¸ºè¾“å‡ºã€‚é™¤äº†æ–‡æœ¬å†…å®¹å¤–ï¼Œæ¶ˆæ¯å¯¹è±¡è¿˜ä¼ è¾¾äº†å¯¹è¯ <a href="https://python.langchain.com/docs/concepts/messages/#role">roles</a> ï¼Œå¹¶ä¿å­˜äº†é‡è¦æ•°æ®ï¼Œä¾‹å¦‚å·¥å…·è°ƒç”¨å’Œtokenä½¿ç”¨è®¡æ•°ã€‚</p><p>LangChainåŒæ ·æ”¯æŒé€šè¿‡å­—ç¬¦ä¸²æˆ–OpenAIæ ¼å¼è¿›è¡ŒèŠå¤©æ¨¡å‹è¾“å…¥ã€‚ä»¥ä¸‹æ˜¯ç­‰æ•ˆçš„æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">model.invoke(<span class="hljs-string">&quot;Hello&quot;</span>)<br><br>model.invoke([&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Hello&quot;</span>&#125;])<br><br>model.invoke([HumanMessage(<span class="hljs-string">&quot;Hello&quot;</span>)])<br></code></pre></td></tr></table></figure><p><strong>streaming</strong></p><p>ç”±äºèŠå¤©æ¨¡å‹æ˜¯Runnablesï¼Œå®ƒä»¬æä¾›äº†ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œè¯¥æ¥å£åŒ…æ‹¬å¼‚æ­¥å’Œæµæ¨¡å¼è°ƒç”¨ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»èŠå¤©æ¨¡å‹ä¸­æµå¼ä¼ è¾“å•ä¸ªä»¤ç‰Œï¼š</p><ul><li>ä½¿ç”¨è¿™ç§æœºåˆ¶å¯ä»¥å®ç°å®æ—¶ä¿¡æ¯æ›´æ–°ï¼Œå…è®¸åœ¨å¤„ç†å¤æ‚è¯·æ±‚æˆ–é•¿å¯¹è¯æ—¶é€æ­¥æ˜¾ç¤ºç»“æœã€‚</li><li>å¼‚æ­¥å’Œæµå¼å¤„ç†çš„å¼•å…¥æé«˜äº†åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦å’Œæ•ˆç‡ï¼Œå°¤å…¶é€‚åˆéœ€è¦å³æ—¶åé¦ˆçš„åœºæ™¯ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> model.stream(messages):<br>    <span class="hljs-built_in">print</span>(token.content, end=<span class="hljs-string">&quot;|&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ›´å¤šä¿¡æ¯å‚è€ƒ<a href="https://python.langchain.com/docs/how_to/chat_streaming/">https://python.langchain.com/docs/how_to/chat_streaming/</a></p><h1 id="4-Prompt-Templates"><a href="#4-Prompt-Templates" class="headerlink" title="4 Prompt Templates"></a>4 Prompt Templates</h1><p>å½“å‰æˆ‘ä»¬ç›´æ¥å°†æ¶ˆæ¯åˆ—è¡¨ä¼ é€’ç»™è¯­è¨€æ¨¡å‹ã€‚é€šå¸¸ï¼Œæ¶ˆæ¯åˆ—è¡¨æ˜¯ç”±ç”¨æˆ·è¾“å…¥å’Œåº”ç”¨ç¨‹åºé€»è¾‘ç»„åˆæ„å»ºçš„ã€‚åº”ç”¨ç¨‹åºé€»è¾‘é€šå¸¸ä¼šè·å–ç”¨æˆ·çš„åŸå§‹è¾“å…¥ï¼Œå¹¶å°†å…¶è½¬æ¢æˆä¸€ä¸ªå‡†å¤‡ä¼ é€’ç»™è¯­è¨€æ¨¡å‹çš„æ¶ˆæ¯åˆ—è¡¨ã€‚å¸¸è§çš„è½¬æ¢åŒ…æ‹¬æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯æˆ–ä½¿ç”¨ç”¨æˆ·è¾“å…¥æ¥å¡«å……æ¨¡æ¿ã€‚</p><p>åœ¨LangChainä¸­ï¼Œ<a href="https://python.langchain.com/docs/concepts/prompt_templates/">Prompt templates</a>è¿™ä¸€æ¦‚å¿µæ—¨åœ¨å¸®åŠ©è¿›è¡Œæ­¤ç±»è½¬æ¢ã€‚æç¤ºæ¨¡æ¿æ¥æ”¶ç”¨æˆ·çš„åŸå§‹è¾“å…¥ï¼Œå¹¶è¿”å›å‡†å¤‡å¥½ä¼ é€’ç»™è¯­è¨€æ¨¡å‹çš„æ•°æ®ï¼ˆå³promptï¼‰ã€‚</p><p>ä¸‹é¢åˆ›å»ºä¸€ä¸ªæç¤ºæ¨¡æ¿ï¼Œå®ƒå°†æ¥æ”¶ä¸¤ä¸ªç”¨æˆ·å˜é‡ï¼š</p><ul><li>languageï¼šè¦ç¿»è¯‘æ–‡æœ¬çš„ç›®æ ‡è¯­è¨€</li><li>textï¼šè¦ç¿»è¯‘çš„æ–‡æœ¬</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><br>system_template = <span class="hljs-string">&quot;Translate the following text into &#123;language&#125;&quot;</span><br><br>prompt_template = ChatPromptTemplate.from_messages(<br>    [(<span class="hljs-string">&quot;system&quot;</span>, system_template), (<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;&#123;text&#125;&quot;</span>)]<br>)<br></code></pre></td></tr></table></figure><p>APIå‚è€ƒï¼š<a href="https://python.langchain.com/api_reference/core/prompts/langchain_core.prompts.chat.ChatPromptTemplate.html">ChatPromptTemplate</a></p><p>è¯¥æ¨¡æ¿æ¥å—ä¸€ä¸ªå­—å…¸ä½œä¸ºå‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt = prompt_template.invoke(&#123;<span class="hljs-string">&quot;language&quot;</span>: <span class="hljs-string">&quot;Italian&quot;</span>, <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;hi!&quot;</span>&#125;)<br><br>prompt<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt.to_message()<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">response = model.invoke(prompt)<br><span class="hljs-built_in">print</span>(response.content)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>LLM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>LangChain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[CMAKE]tutorial</title>
    <link href="/2025/03/25/CMAKE-tutorial/"/>
    <url>/2025/03/25/CMAKE-tutorial/</url>
    
    <content type="html"><![CDATA[<h1 id="0-æ¦‚è¿°"><a href="#0-æ¦‚è¿°" class="headerlink" title="0 æ¦‚è¿°"></a>0 æ¦‚è¿°</h1><p>åœ¨è½¯ä»¶å¼€å‘çš„ä¸–ç•Œé‡Œï¼Œæ„å»ºç³»ç»Ÿæ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå°¤å…¶æ˜¯å¯¹äºé‚£äº›æ¶‰åŠå¤šä¸ªæºæ–‡ä»¶ã€åº“ä¾èµ–ä»¥åŠè·¨å¹³å°æ”¯æŒçš„å¤æ‚é¡¹ç›®ã€‚éšç€é¡¹ç›®è§„æ¨¡çš„å¢é•¿ï¼Œæ‰‹åŠ¨ç¼–è¯‘å’Œç®¡ç†è¿™äº›ä¾èµ–å…³ç³»å˜å¾—æ—¢è€—æ—¶åˆå®¹æ˜“å‡ºé”™ã€‚è¿™å°±æ˜¯CMakeä½œä¸ºä¸€æ¬¾å¼ºå¤§çš„æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨æ‰€å‘æŒ¥é‡è¦ä½œç”¨çš„åœ°æ–¹ã€‚æœ¬ç¯‡åšå®¢å‚è€ƒ<a href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">Cmakeå®˜æ–¹æ•™ç¨‹</a>ã€‚æ‰€æœ‰çš„ä»£ç æ”¾åœ¨ã€‚</p><h1 id="1-Basic"><a href="#1-Basic" class="headerlink" title="1 Basic"></a>1 Basic</h1><h2 id="åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„-CMake-é¡¹ç›®"><a href="#åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„-CMake-é¡¹ç›®" class="headerlink" title="åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ CMake é¡¹ç›®"></a>åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ CMake é¡¹ç›®</h2><p>æ„å»ºä¸€ä¸ªä»å•ä¸ªæºä»£ç æ–‡ä»¶ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯CMakeé¡¹ç›®çš„æœ€ç®€å½¢å¼ã€‚å¯¹äºè¿™ç±»åŸºç¡€é¡¹ç›®ï¼Œåªéœ€ç¼–å†™ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå‘½ä»¤çš„<code>CMakeLists.txt</code>æ–‡ä»¶å³å¯ã€‚</p><div class="note note-primary">            <p>å°½ç®¡CMakeæ”¯æŒä½¿ç”¨å¤§å†™ã€å°å†™æˆ–æ··åˆå¤§å°å†™çš„å‘½ä»¤ï¼Œä½†æ¨èä½¿ç”¨å°å†™å‘½ä»¤æ ¼å¼ã€‚</p>          </div><p><strong>å…³é”®æ­¥éª¤</strong></p><ul><li><p>æŒ‡å®šCMakeæœ€ä½ç‰ˆæœ¬</p><p>æ¯ä¸ªé¡¹ç›®çš„é¡¶å±‚<code>CMakeLists.txt</code>æ–‡ä»¶é¦–å…ˆéœ€è¦é€šè¿‡<code>cmake_minimum_required()</code>å‘½ä»¤æŒ‡å®šæ‰€éœ€çš„æœ€å°CMakeç‰ˆæœ¬ã€‚è¿™ä¸€æ­¥éª¤ç¡®ä¿äº†æ‰€ä½¿ç”¨çš„CMakeå‡½æ•°ä¸ç›¸åº”ç‰ˆæœ¬å…¼å®¹ï¼Œå¹¶è®¾ç½®äº†ç­–ç•¥ç¯å¢ƒã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.10</span>)<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®é¡¹ç›®åç§°</p><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨<code>project()</code>å‘½ä»¤å®šä¹‰é¡¹ç›®åç§°ã€‚æ­¤å‘½ä»¤åº”åœ¨<code>cmake_minimum_required()</code>ä¹‹åç«‹å³è°ƒç”¨ï¼Œä¸”å¯¹ä»»ä½•é¡¹ç›®éƒ½æ˜¯å¿…éœ€çš„ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ç”¨äºè®¾å®šå…¶ä»–é¡¹ç›®çº§ä¿¡æ¯ï¼Œå¦‚ç¼–ç¨‹è¯­è¨€å’Œç‰ˆæœ¬å·ç­‰ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">project</span>(MyProject)<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶</p><p>æœ€åï¼Œä½¿ç”¨<code>add_executable()</code>å‘½ä»¤å‘ŠçŸ¥CMakeæ ¹æ®æŒ‡å®šçš„æºä»£ç æ–‡ä»¶åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">add_executable</span>(MyExecutable main.cpp)<br></code></pre></td></tr></table></figure></li></ul><p><strong>æ„å»ºå’Œè¿è¡Œé¡¹ç›®</strong></p><p>é¦–å…ˆï¼Œä½¿ç”¨<code>cmake</code>å‘½ä»¤è¡Œå·¥å…·æˆ–<code>cmake-gui</code>æ¥é…ç½®é¡¹ç›®ã€‚ä»¥å‘½ä»¤è¡Œä¸ºä¾‹ï¼Œè¿›å…¥CMakeæºä»£ç æ ‘çš„ç‰¹å®šæ•™ç¨‹ç›®å½•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºæ„å»ºçš„ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> Step1_build<br><span class="hljs-built_in">cd</span> Step1_build<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œåœ¨æ–°å»ºçš„æ„å»ºç›®å½•ä¸­è¿è¡Œ<code>cmake</code>ä»¥é…ç½®é¡¹ç›®å¹¶ç”Ÿæˆæœ¬åœ°æ„å»ºç³»ç»Ÿï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">cmake ../Step1<br></code></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œè°ƒç”¨ç”Ÿæˆçš„æ„å»ºç³»ç»Ÿæ¥ç¼–è¯‘å’Œé“¾æ¥é¡¹ç›®ã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">cmake --build .<br></code></pre></td></tr></table></figure><p>å¯¹äºå¤šé…ç½®ç”Ÿæˆå™¨ï¼ˆå¦‚Visual Studioï¼‰ï¼Œéœ€å…ˆå¯¼èˆªè‡³å¯¹åº”çš„å­ç›®å½•ï¼Œä¾‹å¦‚<code>Debug</code>æˆ–<code>Release</code>ï¼Œå†æ‰§è¡Œç›¸åº”çš„æ„å»ºå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> Debug<br></code></pre></td></tr></table></figure><p>æˆåŠŸæ„å»ºé¡¹ç›®åï¼Œå³å¯å°è¯•è¿è¡Œæ–°æ„å»ºçš„åº”ç”¨ç¨‹åºã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">./Tutorial 4294967296<br>./Tutorial 10<br>./Tutorial<br></code></pre></td></tr></table></figure><h2 id="æŒ‡å®šc-æ ‡å‡†"><a href="#æŒ‡å®šc-æ ‡å‡†" class="headerlink" title="æŒ‡å®šc++æ ‡å‡†"></a>æŒ‡å®šc++æ ‡å‡†</h2><p>åœ¨CMakeä¸­ï¼Œå­˜åœ¨ä¸€ç³»åˆ—ä»¥<code>CMAKE_</code>ä¸ºå‰ç¼€çš„ç‰¹æ®Šå˜é‡ï¼Œå®ƒä»¬æˆ–æ˜¯ç”±CMakeå†…éƒ¨åˆ›å»ºï¼Œæˆ–æ˜¯åœ¨é¡¹ç›®é…ç½®åå¯¹CMakeå…·æœ‰ç‰¹å®šæ„ä¹‰ã€‚ä¸ºäº†é¿å…ä¸è¿™äº›é¢„å®šä¹‰å˜é‡å‘ç”Ÿå†²çªï¼Œåœ¨ä¸ºè‡ªå®šä¹‰é¡¹ç›®åˆ›å»ºæ–°å˜é‡æ—¶ï¼Œåº”é¿å…ä½¿ç”¨<code>CMAKE_</code>ä½œä¸ºå˜é‡åçš„å¼€å¤´ã€‚</p><p>å…¶ä¸­ï¼Œä¸¤ä¸ªé‡è¦çš„ç”¨æˆ·å¯è®¾ç½®å˜é‡æ˜¯<code>CMAKE_CXX_STANDARD</code>å’Œ<code>CMAKE_CXX_STANDARD_REQUIRED</code>ã€‚è¿™ä¸¤ä¸ªå˜é‡ååŒå·¥ä½œï¼Œç”¨äºæŒ‡å®šæ„å»ºé¡¹ç›®æ‰€å¿…éœ€çš„C++æ ‡å‡†ç‰ˆæœ¬ï¼š</p><ul><li><code>CMAKE_CXX_STANDARD</code>ï¼šæŒ‡å®šé¡¹ç›®æ‰€éœ€çš„C++æ ‡å‡†ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼Œ98ã€11ã€14ã€17ç­‰ï¼‰ã€‚</li><li><code>CMAKE_CXX_STANDARD_REQUIRED</code>ï¼šè®¾å®šä¸º<code>TRUE</code>æ—¶ï¼Œè¡¨ç¤ºæ‰€æŒ‡å®šçš„C++æ ‡å‡†æ˜¯å¿…é¡»çš„ã€‚å¦‚æœç¼–è¯‘å™¨ä¸æ”¯æŒè¯¥æ ‡å‡†ï¼Œåˆ™æ„å»ºè¿‡ç¨‹å°†å¤±è´¥ã€‚</li></ul><p>ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(CMAKE_CXX_STANDARD <span class="hljs-number">11</span>)<br><span class="hljs-keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="hljs-keyword">TRUE</span>)<br></code></pre></td></tr></table></figure><h2 id="æ·»åŠ ç‰ˆæœ¬å·å’Œé…ç½®çš„å¤´æ–‡ä»¶"><a href="#æ·»åŠ ç‰ˆæœ¬å·å’Œé…ç½®çš„å¤´æ–‡ä»¶" class="headerlink" title="æ·»åŠ ç‰ˆæœ¬å·å’Œé…ç½®çš„å¤´æ–‡ä»¶"></a>æ·»åŠ ç‰ˆæœ¬å·å’Œé…ç½®çš„å¤´æ–‡ä»¶</h2><p>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå°†CMakeLists.txtä¸­å®šä¹‰çš„å˜é‡åº”ç”¨äºæºä»£ç æ˜¯ååˆ†å¿…è¦çš„ï¼Œä¾‹å¦‚æ‰“å°é¡¹ç›®çš„ç‰ˆæœ¬å·ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥é‡‡ç”¨é…ç½®å¤´æ–‡ä»¶çš„æ–¹æ³•å®ç°ã€‚</p><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«å ä½ç¬¦å˜é‡ï¼ˆå¦‚ <code>@VAR@</code> æ ¼å¼ï¼‰çš„æ¨¡æ¿æ–‡ä»¶ã€‚ç„¶åï¼Œé€šè¿‡CMakeçš„ <code>configure_file()</code> å‘½ä»¤ï¼Œå°†æ­¤æ¨¡æ¿æ–‡ä»¶å¤åˆ¶ä¸ºç›®æ ‡æ–‡ä»¶ï¼Œå¹¶ç”¨CMakeLists.txtä¸­å¯¹åº”å˜é‡çš„å®é™…å€¼æ›¿æ¢æ‰€æœ‰å ä½ç¬¦ã€‚</p><p>è¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºç»´æŠ¤äº†ä¸€ä¸ªå•ä¸€çš„çœŸå®æ•°æ®æºï¼Œé¿å…äº†æ‰‹åŠ¨æ›´æ–°å¤šä¸ªä½ç½®æ‰€å¸¦æ¥çš„é”™è¯¯é£é™©ã€‚</p><h3 id="configure-fileå‘½ä»¤"><a href="#configure-fileå‘½ä»¤" class="headerlink" title="configure_fileå‘½ä»¤"></a>configure_fileå‘½ä»¤</h3><p><code>configure_file</code>å‘½ä»¤ç”¨äºå°†ä¸€ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œå¹¶åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œå¿…è¦çš„è½¬æ¢ã€‚è¯¥å‘½ä»¤å¸¸ç”¨äºç”Ÿæˆé…ç½®å¤´æ–‡ä»¶æˆ–å®šåˆ¶å®‰è£…è„šæœ¬ã€‚</p><h4 id="å‘½ä»¤æ ¼å¼"><a href="#å‘½ä»¤æ ¼å¼" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">configure_file</span>(&lt;input&gt; &lt;output&gt;<br>               [NO_SOURCE_PERMISSIONS | USE_SOURCE_PERMISSIONS |<br>                FILE_PERMISSIONS &lt;permissions&gt;...]<br>               [COPYONLY] [ESCAPE_QUOTES] [@ONLY]<br>               [NEWLINE_STYLE [UNIX|DOS|WIN32|LF|CRLF]])<br></code></pre></td></tr></table></figure><ul><li><code>&lt;input&gt;</code>ï¼šæŒ‡å®šè¦è¯»å–å’Œè½¬æ¢çš„æºæ–‡ä»¶ã€‚</li><li><code>&lt;output&gt;</code>ï¼šæŒ‡å®šç›®æ ‡æ–‡ä»¶çš„ä½ç½®åŠåç§°ã€‚</li></ul><h4 id="é€‰é¡¹è¯´æ˜"><a href="#é€‰é¡¹è¯´æ˜" class="headerlink" title="é€‰é¡¹è¯´æ˜"></a>é€‰é¡¹è¯´æ˜</h4><ul><li><code>NO_SOURCE_PERMISSIONS</code>ï¼šä¸å¤åˆ¶æºæ–‡ä»¶çš„æƒé™ï¼›è¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚</li><li><code>USE_SOURCE_PERMISSIONS</code>ï¼šä½¿ç”¨æºæ–‡ä»¶çš„æƒé™è®¾ç½®ç›®æ ‡æ–‡ä»¶æƒé™ã€‚</li><li><code>FILE_PERMISSIONS</code>ï¼šæ˜ç¡®æŒ‡å®šç›®æ ‡æ–‡ä»¶çš„æƒé™ã€‚</li><li><code>COPYONLY</code>ï¼šä»…æ‰§è¡Œæ–‡ä»¶å¤åˆ¶ï¼Œä¸è¿›è¡Œä»»ä½•å†…å®¹æ›¿æ¢ã€‚</li><li><code>ESCAPE_QUOTES</code>ï¼šè½¬ä¹‰æ–‡æœ¬ä¸­çš„å¼•å·ã€‚</li><li><code>@ONLY</code>ï¼šä»…æ›¿æ¢å½¢å¼ä¸º<code>@VAR@</code>çš„å˜é‡å¼•ç”¨ã€‚</li><li><code>NEWLINE_STYLE</code>ï¼šè®¾ç½®è¾“å‡ºæ–‡ä»¶çš„æ¢è¡Œç¬¦é£æ ¼ï¼Œæ”¯æŒUNIXã€DOSã€WIN32ã€LFã€CRLFã€‚</li></ul><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å½“ä½ éœ€è¦åœ¨é¡¹ç›®æ„å»ºæœŸé—´åŠ¨æ€ç”Ÿæˆé…ç½®æ–‡ä»¶æ—¶ï¼Œ<code>configure_file</code>æ˜¯ç†æƒ³é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ç”¨äºç”ŸæˆåŒ…å«ç‰ˆæœ¬ä¿¡æ¯æˆ–ç¼–è¯‘æ—¶é—´æˆ³çš„å¤´æ–‡ä»¶ï¼Œä»è€Œç¡®ä¿è¿™äº›å€¼åœ¨æ¯æ¬¡æ„å»ºæ—¶éƒ½èƒ½å‡†ç¡®åæ˜ é¡¹ç›®çš„å½“å‰çŠ¶æ€ã€‚</p><p>ä¿®æ”¹è¾“å…¥æ–‡ä»¶åï¼Œæ„å»ºç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°è¿è¡ŒCMakeä»¥æ›´æ–°é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰æ›´æ”¹å¾—åˆ°æ­£ç¡®åº”ç”¨ã€‚åªæœ‰å½“æ–‡ä»¶å†…å®¹å®é™…å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šæ›´æ–°ç›®æ ‡æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°ç¼–è¯‘ã€‚</p><h3 id="VERSION-MAJOR-å’Œ-VERSION-MINOR"><a href="#VERSION-MAJOR-å’Œ-VERSION-MINOR" class="headerlink" title="&lt;PROJECT-NAME&gt;_VERSION_MAJOR å’Œ &lt;PROJECT-NAME&gt;_VERSION_MINOR"></a><code>&lt;PROJECT-NAME&gt;_VERSION_MAJOR</code> å’Œ <code>&lt;PROJECT-NAME&gt;_VERSION_MINOR</code></h3><p><code>&lt;PROJECT-NAME&gt;_VERSION_MAJOR </code>å’Œ <code>&lt;PROJECT-NAME&gt;_VERSION_MINOR</code> æ˜¯é¢„å®šä¹‰å˜é‡ï¼Œç”¨äºè¡¨ç¤ºé¡¹ç›®ä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·ã€‚ç”± <code>project()</code> å‘½ä»¤è®¾ç½®ã€‚</p><h4 id="å®šä¹‰ä¸ä½¿ç”¨"><a href="#å®šä¹‰ä¸ä½¿ç”¨" class="headerlink" title="å®šä¹‰ä¸ä½¿ç”¨"></a>å®šä¹‰ä¸ä½¿ç”¨</h4><p>åœ¨CMakeé¡¹ç›®çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>project()</code>å‘½ä»¤ä¸ä»…åˆå§‹åŒ–äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿˜è®¾ç½®äº†å¤šä¸ªä¸é¡¹ç›®ç›¸å…³çš„å˜é‡ã€‚å…¶ä¸­ï¼Œ<code>&lt;PROJECT-NAME&gt;_VERSION</code> åŒ…å«äº†é¡¹ç›®çš„å®Œæ•´ç‰ˆæœ¬å·ï¼ˆå¦‚â€œ2.5.1â€ï¼‰ï¼Œè€Œ <code>&lt;PROJECT-NAME&gt;_VERSION_MAJOR</code> åˆ™æå–å¹¶å­˜å‚¨è¯¥ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œå³ä¸»ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç‰ˆæœ¬å·â€œ2.5.1â€ä¸­ï¼Œâ€œ2â€ä¸ºä¸»ç‰ˆæœ¬å·ï¼‰ï¼› <code>&lt;PROJECT-NAME&gt;_VERSION_MINOR</code> åˆ™å…·ä½“æŒ‡ä»£è¯¥ç‰ˆæœ¬å·çš„æ¬¡ç‰ˆæœ¬ç¼–å·ï¼ˆä¾‹å¦‚ï¼Œåœ¨ç‰ˆæœ¬å·â€œ2.5.1â€ä¸­ï¼Œâ€œ5â€ä¸ºæ¬¡ç‰ˆæœ¬å·ï¼‰ã€‚</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p>å‡è®¾åœ¨ä¸€ä¸ªCMakeLists.txtæ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹å£°æ˜ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">project</span>(MyProject VERSION <span class="hljs-number">3.2</span>.<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå°†è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹å˜é‡ï¼š</p><ul><li><code>MyProject_VERSION_MAJOR</code> çš„å€¼ä¸º <code>3</code></li><li><code>MyProject_VERSION_MINOR</code> çš„å€¼ä¸º <code>2</code></li></ul><h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><p><code>MyProject_VERSION_MAJOR</code> å¯¹äºéœ€è¦æ ¹æ®é¡¹ç›®çš„ä¸»ç‰ˆæœ¬å·æ¥è°ƒæ•´ç¼–è¯‘é€‰é¡¹ã€é“¾æ¥åº“æˆ–ç”Ÿæˆæ–‡æ¡£ç­‰æ“ä½œç‰¹åˆ«æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®ä¸»ç‰ˆæœ¬å·çš„å˜åŒ–å¼•å…¥ä¸å…¼å®¹çš„APIæ›´æ”¹æˆ–æ˜¯é‡å¤§åŠŸèƒ½æ›´æ–°ï¼Œä»è€Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³»ã€‚</p><p>æ¬¡ç‰ˆæœ¬å·é€šå¸¸ç”¨äºæ ‡è®°æ–°åŠŸèƒ½çš„å¼•å…¥æˆ–æ˜¾è‘—æ”¹è¿›è€Œä¸ç ´åç°æœ‰åŠŸèƒ½çš„å…¼å®¹æ€§ã€‚å› æ­¤ï¼Œ<code>&lt;PROJECT-NAME&gt;_VERSION_MINOR</code> å¯¹äºéœ€è¦æ ¹æ®é¡¹ç›®çš„æ¬¡ç‰ˆæœ¬å·æ¥è°ƒæ•´ç¼–è¯‘é€‰é¡¹ã€ä¾èµ–ç®¡ç†æˆ–æ–‡æ¡£ç”Ÿæˆç­‰æ“ä½œç‰¹åˆ«æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åŸºäºæ¬¡ç‰ˆæœ¬å·çš„å˜åŒ–æ¥å†³å®šæ˜¯å¦å¯ç”¨æŸäº›å®éªŒæ€§åŠŸèƒ½æˆ–è€…æ›´æ–°ç‰¹å®šçš„å¼€å‘å·¥å…·é“¾ã€‚è¿™æœ‰åŠ©äºå¼€å‘è€…æ›´å¥½åœ°ç»´æŠ¤å’Œå‡çº§é¡¹ç›®ã€‚</p><h3 id="target-include-directories-å‡½æ•°"><a href="#target-include-directories-å‡½æ•°" class="headerlink" title="target_include_directories å‡½æ•°"></a><code>target_include_directories</code> å‡½æ•°</h3><p><code>target_include_directories</code> æ˜¯ CMake ä¸­ç”¨äºå‘ç‰¹å®šç›®æ ‡æ·»åŠ åŒ…å«ç›®å½•çš„å‘½ä»¤ã€‚å®ƒå…è®¸å¼€å‘è€…æŒ‡å®šåœ¨ç¼–è¯‘ç»™å®šç›®æ ‡æ—¶åº”ä½¿ç”¨çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„ã€‚</p><h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">target_include_directories</span>(&lt;<span class="hljs-keyword">target</span>&gt; [SYSTEM] [AFTER|BEFORE]<br>  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]<br>  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])<br></code></pre></td></tr></table></figure><ul><li><p><code>&lt;target&gt;</code>: å¿…é¡»æ˜¯ä¹‹å‰é€šè¿‡ <code>add_executable()</code> æˆ– <code>add_library()</code> å®šä¹‰çš„ç›®æ ‡ï¼Œä¸èƒ½ä¸ºåˆ«åç›®æ ‡ã€‚</p></li><li><p><code>[SYSTEM]</code>: æ ‡è¯†è¿™äº›ç›®å½•æ˜¯å¦åº”è¢«è§†ä¸ºç³»ç»ŸåŒ…å«ç›®å½•ï¼Œåœ¨æŸäº›å¹³å°ä¸Šå¯èƒ½å½±å“ç¼–è¯‘å™¨è¡Œä¸ºï¼ˆå¦‚æŠ‘åˆ¶è­¦å‘Šï¼‰ã€‚</p></li><li><p><code>[AFTER|BEFORE]</code>: æ§åˆ¶è¿½åŠ æˆ–å‰ç½®åŒ…å«ç›®å½•çš„æ–¹å¼ã€‚</p></li><li><p><code>&lt;INTERFACE|PUBLIC|PRIVATE&gt;</code>: æŒ‡å®šèŒƒå›´ï¼Œå†³å®šå“ªäº›ä¾èµ–äºè¯¥ç›®æ ‡çš„å…¶ä»–ç›®æ ‡å¯ä»¥è®¿é—®è¿™äº›åŒ…å«ç›®å½•ã€‚</p><ul><li><p><strong>PRIVATE</strong>: ä»…å½“å‰ç›®æ ‡ä½¿ç”¨ã€‚</p></li><li><p><strong>PUBLIC</strong>: å½“å‰ç›®æ ‡åŠå…¶ä¾èµ–è€…å‡å¯è®¿é—®ã€‚</p></li><li><p><strong>INTERFACE</strong>: ä»…å¯¹ä¾èµ–äºè¯¥ç›®æ ‡çš„å…¶ä»–ç›®æ ‡æœ‰æ•ˆï¼Œè‡ªèº«ä¸ä½¿ç”¨ã€‚</p></li></ul></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">target_include_directories</span>(mylib PUBLIC<br>  $&lt;BUILD_INTERFACE:<span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="hljs-keyword">include</span>/mylib&gt;<br>  $&lt;INSTALL_INTERFACE:<span class="hljs-keyword">include</span>/mylib&gt;  <span class="hljs-comment"># &lt;prefix&gt;/include/mylib</span><br>)<br></code></pre></td></tr></table></figure><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li>ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ <code>$&lt;...&gt;</code> å¯ä»¥æ ¹æ®æ„å»ºä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´åŒ…å«ç›®å½•è·¯å¾„ã€‚</li><li>å¯¹äºå¯¼å…¥ç›®æ ‡ï¼Œè‡ª CMake 3.11 èµ·æ”¯æŒè®¾ç½® INTERFACE é¡¹ã€‚</li><li>åœ¨åˆ›å»ºå¯é‡å®šä½çš„è½¯ä»¶åŒ…æ—¶ï¼Œé¿å…ç¡¬ç¼–ç ä¾èµ–é¡¹çš„ç»å¯¹è·¯å¾„åˆ° <code>INTERFACE_INCLUDE_DIRECTORIES</code> å±æ€§ä¸­ï¼Œä»¥å…é™åˆ¶åŒ…çš„çµæ´»æ€§å’Œå¯ç§»æ¤æ€§ã€‚</li></ul><h1 id="2-æ·»åŠ åº“"><a href="#2-æ·»åŠ åº“" class="headerlink" title="2 æ·»åŠ åº“"></a>2 æ·»åŠ åº“</h1><h2 id="åˆ›å»ºä¸€ä¸ªåº“"><a href="#åˆ›å»ºä¸€ä¸ªåº“" class="headerlink" title="åˆ›å»ºä¸€ä¸ªåº“"></a>åˆ›å»ºä¸€ä¸ªåº“</h2><p>åœ¨CMakeé¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªåº“ï¼Œå¯ä»¥é€šè¿‡<code>add_library()</code>å‘½ä»¤æŒ‡å®šæ„æˆè¯¥åº“çš„æºæ–‡ä»¶ã€‚ä¸ºäº†æ›´å¥½åœ°ç»„ç»‡ä»£ç ï¼Œé€šå¸¸ä¼šå°†æºæ–‡ä»¶åˆ†å¸ƒåœ¨å¤šä¸ªå­ç›®å½•ä¸­ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•é«˜æ•ˆåœ°å®Œæˆè¿™äº›æ­¥éª¤çš„æ–¹æ³•ã€‚</p><h4 id="æ·»åŠ åº“"><a href="#æ·»åŠ åº“" class="headerlink" title="æ·»åŠ åº“"></a>æ·»åŠ åº“</h4><p>é¦–å…ˆï¼Œåœ¨åº“æ‰€å±çš„å­ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>CMakeLists.txt</code>æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨<code>add_library()</code>å®šä¹‰åº“ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">add_library</span>(MyLibrary <br>  src/file1.cpp<br>  src/file2.cpp<br>  <span class="hljs-keyword">include</span>/mylib/header1.h<br>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ<code>MyLibrary</code>æ˜¯æ–°åˆ›å»ºåº“çš„åç§°ï¼Œåé¢è·Ÿéšçš„æ˜¯æ„æˆåº“çš„æ‰€æœ‰æºæ–‡ä»¶è·¯å¾„ã€‚</p><h4 id="ç»„ç»‡é¡¹ç›®ç»“æ„"><a href="#ç»„ç»‡é¡¹ç›®ç»“æ„" class="headerlink" title="ç»„ç»‡é¡¹ç›®ç»“æ„"></a>ç»„ç»‡é¡¹ç›®ç»“æ„</h4><p>å¦‚æœé¡¹ç›®åŒ…å«å¤šä¸ªå­ç›®å½•ï¼Œå¯ä»¥åˆ©ç”¨<code>add_subdirectory()</code>å‘½ä»¤ä»é¡¶å±‚<code>CMakeLists.txt</code>æ–‡ä»¶ä¸­æ·»åŠ è¿™äº›å­ç›®å½•ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">add_subdirectory</span>(libs/MyLibrary)<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒCMakeå°±ä¼šå¤„ç†<code>libs/MyLibrary</code>ç›®å½•ä¸‹çš„<code>CMakeLists.txt</code>æ–‡ä»¶ï¼Œä»è€Œå°†è¿™ä¸ªå­é¡¹ç›®é›†æˆåˆ°æ•´ä¸ªæ„å»ºè¿‡ç¨‹ä¸­ã€‚</p><h4 id="é…ç½®åº“çš„åŒ…å«ç›®å½•ä¸é“¾æ¥"><a href="#é…ç½®åº“çš„åŒ…å«ç›®å½•ä¸é“¾æ¥" class="headerlink" title="é…ç½®åº“çš„åŒ…å«ç›®å½•ä¸é“¾æ¥"></a>é…ç½®åº“çš„åŒ…å«ç›®å½•ä¸é“¾æ¥</h4><p>ä¸€æ—¦åº“è¢«åˆ›å»ºï¼Œéœ€è¦é…ç½®å…¶åŒ…å«ç›®å½•ä»¥åŠä¸å…¶ä»–ç›®æ ‡çš„é“¾æ¥å…³ç³»ã€‚è¿™é€šè¿‡<code>target_include_directories()</code>å’Œ<code>target_link_libraries()</code>å®ç°ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># è®¾ç½®å¤´æ–‡ä»¶æœç´¢è·¯å¾„</span><br><span class="hljs-keyword">target_include_directories</span>(MyLibrary <br>  PUBLIC <br>    $&lt;BUILD_INTERFACE:<span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="hljs-keyword">include</span>&gt;<br>    $&lt;INSTALL_INTERFACE:<span class="hljs-keyword">include</span>&gt;  <span class="hljs-comment"># å®‰è£…æ¥å£</span><br>)<br><br><span class="hljs-comment"># å°†åº“é“¾æ¥åˆ°å¯æ‰§è¡Œç›®æ ‡</span><br><span class="hljs-keyword">target_link_libraries</span>(MyExecutable <br>  PRIVATE <br>    MyLibrary<br>)<br></code></pre></td></tr></table></figure><p>æ­¤å¤„ï¼Œ<code>MyExecutable</code>æ˜¯å¸Œæœ›é“¾æ¥<code>MyLibrary</code>çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®æ ‡åç§°ã€‚é€šè¿‡<code>PUBLIC</code>å…³é”®å­—ï¼Œç¡®ä¿äº†ä»»ä½•ä¾èµ–äº<code>MyLibrary</code>çš„ç›®æ ‡éƒ½èƒ½å¤Ÿè®¿é—®æŒ‡å®šçš„åŒ…å«ç›®å½•ï¼›è€Œé€šè¿‡<code>PRIVATE</code>å…³é”®å­—é“¾æ¥<code>MyLibrary</code>ï¼Œè¡¨ç¤ºè¿™ç§é“¾æ¥å…³ç³»ä»…å¯¹<code>MyExecutable</code>æœ‰æ•ˆï¼Œä¸å¯¹å…¶ä»–ä¾èµ–å®ƒçš„ç›®æ ‡å…¬å¼€ã€‚</p><h4 id="add-library"><a href="#add-library" class="headerlink" title="add_library()"></a><code>add_library()</code></h4><p><code>add_library()</code>ç”¨äºå®šä¹‰ä¸€ä¸ªæ–°çš„åº“ç›®æ ‡ã€‚å®ƒå‘Šè¯‰CMakeå¦‚ä½•ä»ä¸€ç»„æºæ–‡ä»¶æ„å»ºå‡ºä¸€ä¸ªåº“ã€‚å…¶åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">add_library</span>(&lt;name&gt; [STATIC | SHARED | MODULE] [&lt;source&gt;...])<br></code></pre></td></tr></table></figure><ul><li><code>&lt;name&gt;</code>æ˜¯åº“çš„åå­—ã€‚</li><li>å¯ä»¥æŒ‡å®šåº“çš„ç±»å‹ï¼šé™æ€åº“(STATIC)ã€å…±äº«åº“(SHARED)æˆ–æ¨¡å—åº“(MODULE)ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºé™æ€åº“ã€‚</li><li><code>[&lt;source&gt;...]</code>è¡¨ç¤ºæ„æˆè¿™ä¸ªåº“çš„æ‰€æœ‰æºæ–‡ä»¶ã€‚</li></ul><h4 id="add-subdirectory"><a href="#add-subdirectory" class="headerlink" title="add_subdirectory()"></a><code>add_subdirectory()</code></h4><p><code>add_subdirectory()</code>å…è®¸å°†å­ç›®å½•æ·»åŠ åˆ°æ„å»ºè¿‡ç¨‹ä¸­ã€‚è¿™å¯¹äºç»„ç»‡å¤§å‹é¡¹ç›®ç‰¹åˆ«æœ‰ç”¨ã€‚å…¶è¯­æ³•ä¸ºï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">add_subdirectory</span>(source_dir [binary_dir] [EXCLUDE_FROM_ALL])<br></code></pre></td></tr></table></figure><ul><li><code>source_dir</code>æ˜¯è¦æ·»åŠ çš„å­ç›®å½•è·¯å¾„ã€‚</li><li><code>binary_dir</code>ï¼ˆå¯é€‰ï¼‰æŒ‡å®šè¾“å‡ºç›®å½•ã€‚å¦‚æœæœªæä¾›ï¼Œåˆ™é»˜è®¤ä¸<code>source_dir</code>ç›¸åŒã€‚</li><li><code>EXCLUDE_FROM_ALL</code>ï¼ˆå¯é€‰ï¼‰æ ‡è®°æ­¤å­ç›®å½•ä¸åŒ…å«åœ¨é»˜è®¤æ„å»ºä¸­ã€‚</li></ul><h4 id="target-link-libraries"><a href="#target-link-libraries" class="headerlink" title="target_link_libraries()"></a><code>target_link_libraries()</code></h4><p><code>target_link_libraries()</code>ç”¨äºæŒ‡å®šå“ªäº›åº“éœ€è¦é“¾æ¥åˆ°æŒ‡å®šçš„ç›®æ ‡ä¸Šã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">target_link_libraries</span>(&lt;<span class="hljs-keyword">target</span>&gt; [item1 [item2 [...]]] [[debug|optimized|general] &lt;item&gt;] ...)<br></code></pre></td></tr></table></figure><ul><li><code>&lt;target&gt;</code>æŒ‡å®šäº†è¦é“¾æ¥çš„åº“çš„ç›®æ ‡åç§°ã€‚</li><li>åç»­å‚æ•°å¯ä»¥æ˜¯åº“åæˆ–å…¶ä»–ç›®æ ‡ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>debug</code>, <code>optimized</code>, æˆ– <code>general</code>å…³é”®å­—æ¥æŒ‡å®šé’ˆå¯¹ä¸åŒæ„å»ºé…ç½®é“¾æ¥ä¸åŒçš„åº“ã€‚</li></ul><h4 id="PROJECT-SOURCE-DIR"><a href="#PROJECT-SOURCE-DIR" class="headerlink" title="PROJECT_SOURCE_DIR"></a><code>PROJECT_SOURCE_DIR</code></h4><p><code>PROJECT_SOURCE_DIR</code>æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„CMakeå˜é‡ï¼ŒæŒ‡å‘å½“å‰å¤„ç†çš„é¡¶å±‚CMakeLists.txtæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚è¿™å¯¹äºå¼•ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="hljs-keyword">include</span>)<br></code></pre></td></tr></table></figure><h2 id="æ·»åŠ é€‰é¡¹"><a href="#æ·»åŠ é€‰é¡¹" class="headerlink" title="æ·»åŠ é€‰é¡¹"></a>æ·»åŠ é€‰é¡¹</h2><p>ä¸ºäº†åœ¨ <code>MathFunctions</code> åº“ä¸­æä¾›ä¸€ä¸ªé€‰é¡¹ï¼Œå…è®¸å¼€å‘äººå‘˜é€‰æ‹©æ˜¯ä½¿ç”¨è‡ªå®šä¹‰å¹³æ–¹æ ¹å®ç°è¿˜æ˜¯æ ‡å‡†å®ç°ï¼Œå¯ä»¥åˆ©ç”¨ CMake çš„ <code>option()</code> å‘½ä»¤ã€‚æ­¤å‘½ä»¤ä¸ä»…æä¾›äº†çµæ´»æ€§ï¼Œè¿˜é€šè¿‡ç¼“å­˜æœºåˆ¶ç®€åŒ–äº†é…ç½®è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…·ä½“æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š</p><h4 id="æ·»åŠ é€‰é¡¹-1"><a href="#æ·»åŠ é€‰é¡¹-1" class="headerlink" title="æ·»åŠ é€‰é¡¹"></a>æ·»åŠ é€‰é¡¹</h4><p>é¦–å…ˆï¼Œåœ¨ <code>CMakeLists.txt</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>option()</code> å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¯é€‰çš„å¸ƒå°”å˜é‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º <code>USE_CUSTOM_SQRT</code> çš„é€‰é¡¹ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">option</span>(USE_CUSTOM_SQRT <span class="hljs-string">&quot;Use custom implementation of square root&quot;</span> <span class="hljs-keyword">ON</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼š</p><ul><li><code>USE_CUSTOM_SQRT</code> æ˜¯é€‰é¡¹çš„åç§°ã€‚</li><li><code>&quot;Use custom implementation of square root&quot;</code> æ˜¯è¯¥é€‰é¡¹çš„å¸®åŠ©å­—ç¬¦ä¸²ï¼Œæè¿°äº†å®ƒçš„ç”¨é€”ã€‚</li><li><code>ON</code> è¡¨ç¤ºé»˜è®¤å¯ç”¨æ­¤é€‰é¡¹ã€‚å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®ä¸º <code>OFF</code>ã€‚</li></ul><h4 id="æ ¹æ®é€‰é¡¹è°ƒæ•´æ„å»ºé€»è¾‘"><a href="#æ ¹æ®é€‰é¡¹è°ƒæ•´æ„å»ºé€»è¾‘" class="headerlink" title="æ ¹æ®é€‰é¡¹è°ƒæ•´æ„å»ºé€»è¾‘"></a>æ ¹æ®é€‰é¡¹è°ƒæ•´æ„å»ºé€»è¾‘</h4><p>æ¥ä¸‹æ¥ï¼ŒåŸºäº <code>USE_CUSTOM_SQRT</code> é€‰é¡¹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ˜¯å¦åŒ…å«è‡ªå®šä¹‰å¹³æ–¹æ ¹å®ç°æˆ–æ ‡å‡†å®ç°ã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">if</span>(USE_CUSTOM_SQRT)<br>    <span class="hljs-keyword">add_library</span>(MathFunctions mysqrt.cxx) <span class="hljs-comment"># è‡ªå®šä¹‰å¹³æ–¹æ ¹å®ç°</span><br><span class="hljs-keyword">else</span>()<br>    <span class="hljs-keyword">add_library</span>(MathFunctions standard_sqrt.cxx) <span class="hljs-comment"># æ ‡å‡†å¹³æ–¹æ ¹å®ç°</span><br><span class="hljs-keyword">endif</span>()<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼š</p><ul><li>å¦‚æœ <code>USE_CUSTOM_SQRT</code> è¢«è®¾ä¸º <code>ON</code>ï¼Œåˆ™å°†ä½¿ç”¨ <code>mysqrt.cxx</code> æ–‡ä»¶ä½œä¸ºå¹³æ–¹æ ¹çš„å®ç°ã€‚</li><li>å¦‚æœ <code>USE_CUSTOM_SQRT</code> è¢«è®¾ä¸º <code>OFF</code>ï¼Œåˆ™ä½¿ç”¨ <code>standard_sqrt.cxx</code> æ–‡ä»¶ä¸­çš„æ ‡å‡†å®ç°ã€‚</li></ul><h4 id="é…ç½®å’Œç”Ÿæˆé¡¹ç›®"><a href="#é…ç½®å’Œç”Ÿæˆé¡¹ç›®" class="headerlink" title="é…ç½®å’Œç”Ÿæˆé¡¹ç›®"></a>é…ç½®å’Œç”Ÿæˆé¡¹ç›®</h4><p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œå¯ä»¥åœ¨é¦–æ¬¡è¿è¡Œ <code>cmake</code> é…ç½®å…¶æ„å»ºç›®å½•æ—¶ï¼Œé€šè¿‡å‘½ä»¤è¡Œå‚æ•° <code>-DUSE_CUSTOM_SQRT=[ON|OFF]</code> æ¥æŒ‡å®šå¸Œæœ›ä½¿ç”¨çš„å¹³æ–¹æ ¹å®ç°æ–¹å¼ã€‚ä¸€æ—¦è®¾ç½®ï¼Œè¿™ä¸ªå€¼ä¼šè¢«å­˜å‚¨åœ¨ CMake ç¼“å­˜ä¸­ï¼Œå› æ­¤ä¸éœ€è¦æ¯æ¬¡é‡æ–°é…ç½®éƒ½è¿›è¡Œè®¾ç½®ã€‚</p><h4 id="if"><a href="#if" class="headerlink" title="if()"></a>if()</h4><p><code>if()</code> å‘½ä»¤ç”¨äºåœ¨ CMake è„šæœ¬ä¸­è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå…è®¸æ ¹æ®ä¸åŒçš„æ¡ä»¶æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚å®ƒæ”¯æŒå¤šç§æ¡ä»¶è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬å˜é‡æ£€æŸ¥ã€å¸ƒå°”è¿ç®—ç­‰ã€‚</p><ul><li><code>if()</code> å¯ä»¥ä¸å˜é‡ã€é€»è¾‘è¿ç®—ç¬¦ï¼ˆå¦‚ <code>AND</code>, <code>OR</code>, <code>NOT</code>ï¼‰ç»“åˆä½¿ç”¨ã€‚</li><li>æ¡ä»¶è¡¨è¾¾å¼å¯ä»¥ç”¨æ¥æ£€æµ‹é€‰é¡¹å€¼ã€ç¯å¢ƒå˜é‡ã€æ–‡ä»¶å­˜åœ¨æ€§ç­‰å¤šç§æƒ…å†µã€‚</li></ul><h4 id="option"><a href="#option" class="headerlink" title="option()"></a>option()</h4><p><code>option()</code> å‘½ä»¤ç”¨äºå®šä¹‰ç”¨æˆ·å¯é€‰çš„é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å¯ä»¥åœ¨é…ç½®é¡¹ç›®æ—¶é€šè¿‡ <code>-D</code> å‚æ•°è®¾å®šï¼Œå¹¶ä¸”å…¶å€¼ä¼šè¢«ç¼“å­˜ä»¥ä¾¿äºåç»­æ„å»ºè¿‡ç¨‹ä¸­å¤ç”¨ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">option</span>(USE_CUSTOM_SQRT <span class="hljs-string">&quot;Use custom implementation of square root&quot;</span> <span class="hljs-keyword">ON</span>)<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰é¡¹åç§°ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¸®åŠ©ä¿¡æ¯ï¼Œæè¿°è¯¥é€‰é¡¹çš„ä½œç”¨ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯é»˜è®¤å€¼ï¼ˆ<code>ON</code> æˆ– <code>OFF</code>ï¼‰ï¼Œè¡¨ç¤ºæ˜¯å¦å¯ç”¨è¯¥é€‰é¡¹ã€‚</li></ul><h4 id="target-compile-definitions"><a href="#target-compile-definitions" class="headerlink" title="target_compile_definitions()"></a>target_compile_definitions()</h4><p><code>target_compile_definitions()</code> å‘½ä»¤ç”¨äºä¸ºç›®æ ‡æ·»åŠ é¢„å¤„ç†å®šä¹‰ï¼Œè¿™ä½¿å¾—å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ ¹æ®ä¸åŒçš„ç›®æ ‡è®¾ç½®ä¸åŒçš„å®å®šä¹‰ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">target_compile_definitions</span>(MathFunctions PRIVATE CUSTOM_SQRT_ENABLED)<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦åº”ç”¨å®šä¹‰çš„ç›®æ ‡åç§°ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šå®šä¹‰çš„åº”ç”¨èŒƒå›´ï¼Œå¯ä»¥æ˜¯ <code>PRIVATE</code>ã€<code>PUBLIC</code> æˆ– <code>INTERFACE</code>ï¼Œåˆ†åˆ«å¯¹åº”ä»…å½“å‰ç›®æ ‡ã€å½“å‰ç›®æ ‡åŠå…¶ä¾èµ–é¡¹ã€ä»¥åŠä»…ä¾èµ–å½“å‰ç›®æ ‡çš„ç›®æ ‡ã€‚</li><li>åç»­å‚æ•°æ˜¯å…·ä½“çš„å®å®šä¹‰åç§°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ å¤šä¸ªå®šä¹‰ã€‚</li></ul><h4 id="ç»“åˆä½¿ç”¨"><a href="#ç»“åˆä½¿ç”¨" class="headerlink" title="ç»“åˆä½¿ç”¨"></a>ç»“åˆä½¿ç”¨</h4><p>è¿™ä¸‰ä¸ªå‘½ä»¤ç»å¸¸è¢«ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œä»¥å®ç°æ›´åŠ çµæ´»å’Œå¯æ§çš„æ„å»ºé…ç½®ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ <code>option()</code> å®šä¹‰ç”¨æˆ·é€‰é¡¹ï¼Œåˆ©ç”¨ <code>if()</code> æ ¹æ®é€‰é¡¹å€¼æ‰§è¡Œä¸åŒåˆ†æ”¯çš„ä»£ç é€»è¾‘ï¼Œæœ€åé€šè¿‡ <code>target_compile_definitions()</code> é’ˆå¯¹ç‰¹å®šç›®æ ‡æ·»åŠ æˆ–ä¿®æ”¹ç¼–è¯‘æœŸå®šä¹‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>CMAKE</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[LLM]ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº</title>
    <link href="/2025/03/23/LLM-%E4%BD%BF%E7%94%A8LangChain%E5%BC%80%E5%8F%91%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/"/>
    <url>/2025/03/23/LLM-%E4%BD%BF%E7%94%A8LangChain%E5%BC%80%E5%8F%91%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="1-æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨"><a href="#1-æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨" class="headerlink" title="1 æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨"></a>1 æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨</h1>]]></content>
    
    
    <categories>
      
      <category>LLM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>langchain</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]DNS</title>
    <link href="/2025/03/22/Linux-DNS/"/>
    <url>/2025/03/22/Linux-DNS/</url>
    
    <content type="html"><![CDATA[<h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><h2 id="1-ä»€ä¹ˆæ˜¯DNSï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯DNSï¼Ÿ" class="headerlink" title="1 ä»€ä¹ˆæ˜¯DNSï¼Ÿ"></a>1 ä»€ä¹ˆæ˜¯DNSï¼Ÿ</h2><p>åº•å±‚ç½‘ç»œä»…é€šè¿‡åŸå§‹IPåœ°å€æ¥è¯†åˆ«ä¸»æœºã€‚DNSä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡åç§°è€ŒéIPåœ°å€æ¥è¿½è¸ªç½‘ç«™å’Œä¸»æœºã€‚</p><p>DNSæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®åº“ï¼Œå°†ä¸»æœºåæ˜ å°„åˆ°IPåœ°å€ã€‚æˆ‘ä»¬ç®¡ç†è‡ªå·±çš„æ•°æ®åº“ä»¥ä¾¿äººä»¬èƒ½å¤Ÿè®¿é—®æˆ‘ä»¬çš„ç«™ç‚¹æˆ–åŸŸåï¼›è€Œåœ¨å…¶ä»–åœ°æ–¹ï¼Œå…¶ä»–äººä¹Ÿåœ¨ç®¡ç†ä»–ä»¬çš„æ•°æ®åº“ï¼Œä»¥ä¾›å¤–ç•Œè®¿é—®å…¶åŸŸåã€‚è¿™äº›åŸŸåä¹‹é—´å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œæ„å»ºèµ·åºå¤§çš„äº’è”ç½‘è”ç³»äººåˆ—è¡¨ã€‚</p><p>DNSä¸ä»…æ”¯æŒåŸºæœ¬çš„åŸŸåè§£æï¼Œè¿˜æä¾›äº†è´Ÿè½½å‡è¡¡ã€å†—ä½™è·¯å¾„ä»¥åŠå®‰å…¨æ€§å¢å¼ºç­‰åŠŸèƒ½ï¼Œæ˜¯ç°ä»£äº’è”ç½‘ä¸å¯æˆ–ç¼ºçš„åŸºç¡€æ¶æ„ä¹‹ä¸€ã€‚</p><h2 id="2-DNSç»„ä»¶"><a href="#2-DNSç»„ä»¶" class="headerlink" title="2 DNSç»„ä»¶"></a>2 DNSç»„ä»¶</h2><p>äº’è”ç½‘çš„DNSæ•°æ®åº“ä¾èµ–äºå„ç«™ç‚¹å’Œç»„ç»‡æä¾›çš„éƒ¨åˆ†æ•°æ®ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦ä»¥ä¸‹å…³é”®ç»„ä»¶ï¼š</p><h4 id="åç§°æœåŠ¡å™¨Name-Server"><a href="#åç§°æœåŠ¡å™¨Name-Server" class="headerlink" title="åç§°æœåŠ¡å™¨Name Server"></a>åç§°æœåŠ¡å™¨Name Server</h4><p>é€šè¿‡â€œåç§°æœåŠ¡å™¨â€è®¾ç½®DNSï¼Œè¿™äº›æœåŠ¡å™¨åŠ è½½æˆ‘ä»¬çš„DNSè®¾ç½®å’Œé…ç½®ï¼Œå¹¶å“åº”æ¥è‡ªå®¢æˆ·ç«¯æˆ–å…¶ä»–æœåŠ¡å™¨çš„æŸ¥è¯¢ï¼Œå¦‚â€œgoogle.comæ˜¯è°ï¼Ÿâ€å¦‚æœåç§°æœåŠ¡å™¨ä¸çŸ¥é“æŸ¥è¯¢çš„ç­”æ¡ˆï¼Œå®ƒä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°å…¶ä»–åç§°æœåŠ¡å™¨ã€‚åç§°æœåŠ¡å™¨å¯ä»¥æ˜¯â€œæƒå¨â€çš„ï¼Œæ„å‘³ç€å®ƒä»¬æŒæœ‰æ­£åœ¨æŸ¥æ‰¾çš„å®é™…DNSè®°å½•ï¼›ä¹Ÿå¯ä»¥æ˜¯â€œé€’å½’â€çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¼šè¯¢é—®å…¶ä»–æœåŠ¡å™¨ï¼Œç›´è‡³æ‰¾åˆ°åŒ…å«æ‰€éœ€DNSè®°å½•çš„æƒå¨æœåŠ¡å™¨ã€‚é€’å½’æœåŠ¡å™¨ä¹Ÿå¯èƒ½ç¼“å­˜äº†æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½è®¿é—®æƒå¨æœåŠ¡å™¨ã€‚</p><h4 id="åŒºåŸŸæ–‡ä»¶Zone-File"><a href="#åŒºåŸŸæ–‡ä»¶Zone-File" class="headerlink" title="åŒºåŸŸæ–‡ä»¶Zone File"></a>åŒºåŸŸæ–‡ä»¶Zone File</h4><p>åç§°æœåŠ¡å™¨ä¸­å­˜å‚¨ç€æ‰€è°“çš„åŒºåŸŸæ–‡ä»¶ã€‚åŒºåŸŸæ–‡ä»¶æ˜¯åç§°æœåŠ¡å™¨ä¿å­˜å…³äºåŸŸåä¿¡æ¯çš„æ–¹å¼ï¼Œæˆ–è€…åœ¨æœªçŸ¥æƒ…å†µä¸‹å¦‚ä½•è·å–è¯¥åŸŸåçš„ä¿¡æ¯ã€‚</p><h4 id="èµ„æºè®°å½•"><a href="#èµ„æºè®°å½•" class="headerlink" title="èµ„æºè®°å½•"></a>èµ„æºè®°å½•</h4><p>åŒºåŸŸæ–‡ä»¶ç”±èµ„æºè®°å½•æ¡ç›®ç»„æˆã€‚æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªè®°å½•ï¼ŒåŒ…å«äº†å…³äºä¸»æœºã€åç§°æœåŠ¡å™¨å’Œå…¶ä»–èµ„æºçš„ä¿¡æ¯ã€‚å­—æ®µåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li><strong>è®°å½•åç§°</strong>ï¼šæŒ‡å®šè®°å½•çš„å¯¹è±¡ã€‚</li><li><strong>TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰</strong>ï¼šå®šä¹‰ä¸¢å¼ƒè®°å½•å¹¶è·å–æ–°è®°å½•çš„æ—¶é—´ï¼Œåœ¨DNSä¸­ä»¥æ—¶é—´è¡¨ç¤ºï¼Œå› æ­¤è®°å½•å¯èƒ½å…·æœ‰ä¸€å°æ—¶çš„TTLã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºäº’è”ç½‘ä¸æ–­å˜åŒ–ï¼Œä¸€ä¸ªä¸»æœºå¯èƒ½å‰ä¸€åˆ†é’Ÿæ˜ å°„åˆ°X IPåœ°å€ï¼Œä¸‹ä¸€åˆ†é’Ÿå°±ç§»åˆ°Y IPåœ°å€ã€‚</li><li><strong>ç±»</strong>ï¼šè®°å½•ä¿¡æ¯çš„å‘½åç©ºé—´ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ä»£è¡¨äº’è”ç½‘çš„INã€‚</li><li><strong>ç±»å‹</strong>ï¼šè®°å½•æ•°æ®ä¸­å­˜å‚¨çš„ä¿¡æ¯ç±»å‹ã€‚å¸¸è§çš„æœ‰Aè®°å½•ï¼ˆåœ°å€ï¼‰ã€MXè®°å½•ï¼ˆé‚®ä»¶äº¤æ¢å™¨ï¼‰ç­‰ã€‚</li><li><strong>æ•°æ®</strong>ï¼šæ ¹æ®è®°å½•ç±»å‹ï¼Œæ­¤å­—æ®µå¯åŒ…å«IPåœ°å€æˆ–å…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">patty    <span class="hljs-keyword">IN</span>  <span class="hljs-keyword">A</span>      <span class="hljs-number">192.168.0.4</span><br></code></pre></td></tr></table></figure><h2 id="3-DNSè§£æè¿‡ç¨‹"><a href="#3-DNSè§£æè¿‡ç¨‹" class="headerlink" title="3 DNSè§£æè¿‡ç¨‹"></a>3 DNSè§£æè¿‡ç¨‹</h2><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥äº†è§£ä¸»æœºå¦‚ä½•é€šè¿‡DNSæŸ¥æ‰¾åŸŸåï¼ˆä¾‹å¦‚cetzontheinterwebz.comï¼‰ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸€ä¸ªé€æ­¥æ·±å…¥æŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°çŸ¥é“è¯¥åŸŸåçš„DNSæœåŠ¡å™¨ã€‚</p><h4 id="æœ¬åœ°DNSæœåŠ¡å™¨"><a href="#æœ¬åœ°DNSæœåŠ¡å™¨" class="headerlink" title="æœ¬åœ°DNSæœåŠ¡å™¨"></a>æœ¬åœ°DNSæœåŠ¡å™¨</h4><p>é¦–å…ˆï¼Œä¸»æœºæå‡ºæŸ¥è¯¢ï¼šâ€œcetzontheinterwebz.comä½äºä½•å¤„ï¼Ÿâ€ å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨æ— æ³•æä¾›ç­”æ¡ˆï¼Œåˆ™ä¼šä»æ ¹æœåŠ¡å™¨å¼€å§‹æŸ¥è¯¢ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°ç”¨æˆ·æ˜¯é€šè¿‡å…¶ISPæä¾›çš„é€’å½’DNSæœåŠ¡å™¨è¿›è¡Œæ­¤ç±»æŸ¥è¯¢çš„ï¼Œè€Œéç›´æ¥ç”±ç”¨æˆ·ä¸»æœºå‘èµ·ã€‚å› æ­¤ï¼Œä»»åŠ¡è½åœ¨äº†ISPçš„é€’å½’DNSæœåŠ¡å™¨ä¸Šï¼Œä»¥æŸ¥æ‰¾cetzontheinterwebz.comçš„ä½ç½®ã€‚</p><h4 id="æ ¹æœåŠ¡å™¨"><a href="#æ ¹æœåŠ¡å™¨" class="headerlink" title="æ ¹æœåŠ¡å™¨"></a>æ ¹æœåŠ¡å™¨</h4><p>äº’è”ç½‘å…±æœ‰13ç»„æ ¹æœåŠ¡å™¨ï¼Œå®ƒä»¬åœ¨å…¨çƒèŒƒå›´å†…è¢«é•œåƒå’Œåˆ†å¸ƒï¼Œä»¥å¤„ç†äº’è”ç½‘çš„DNSè¯·æ±‚ã€‚å®é™…ä¸Šï¼Œæœ‰æ•°ç™¾å°æœåŠ¡å™¨åœ¨è¿ä½œï¼Œå®ƒä»¬ç”±ä¸åŒçš„ç»„ç»‡æ§åˆ¶ï¼Œå¹¶åŒ…å«æœ‰å…³é¡¶çº§åŸŸçš„ä¿¡æ¯ã€‚é¡¶çº§åŸŸå³ä¸ºç†ŸçŸ¥çš„.orgã€.comã€.netç­‰åœ°å€ç±»å‹ã€‚æ ¹æœåŠ¡å™¨å¹¶ä¸çŸ¥é“cetzontheinterwebz.comçš„å…·ä½“ä½ç½®ï¼Œä½†ä¼šå‘ŠçŸ¥æŸ¥è¯¢è€…å‘ç‰¹å®šIPåœ°å€çš„.comé¡¶çº§åŸŸDNSæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ã€‚</p><h4 id="é¡¶çº§åŸŸ"><a href="#é¡¶çº§åŸŸ" class="headerlink" title="é¡¶çº§åŸŸ"></a>é¡¶çº§åŸŸ</h4><p>æ¥ä¸‹æ¥ï¼Œå‘è´Ÿè´£â€œ.comâ€åœ°å€çš„åç§°æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦çŸ¥é“cetzontheinterwebz.comçš„ä½ç½®ã€‚å°½ç®¡é¡¶çº§åŸŸ(TLD)çš„åŒºåŸŸæ–‡ä»¶ä¸­ä¸åŒ…å«cetzontheinterwebz.comçš„å…·ä½“ä¿¡æ¯ï¼Œä½†å®ƒè®°å½•äº†cetzontheinterwebz.comåç§°æœåŠ¡å™¨çš„ä¿¡æ¯ã€‚äºæ˜¯ï¼Œå®ƒæä¾›äº†è¯¥åç§°æœåŠ¡å™¨çš„IPåœ°å€ï¼ŒæŒ‡ç¤ºæŸ¥è¯¢è€…ç»§ç»­å‘æ­¤åœ°å€æŸ¥è¯¢ã€‚</p><h4 id="æƒå¨DNSæœåŠ¡å™¨"><a href="#æƒå¨DNSæœåŠ¡å™¨" class="headerlink" title="æƒå¨DNSæœåŠ¡å™¨"></a>æƒå¨DNSæœåŠ¡å™¨</h4><p>æœ€åä¸€æ­¥ï¼Œå‘æŒæœ‰ç›®æ ‡è®°å½•çš„DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚è¯¥åç§°æœåŠ¡å™¨æ£€æŸ¥å…¶åŒºåŸŸæ–‡ä»¶ï¼Œå‘ç°å…¶ä¸­åŒ…å«äº†cetzontheinterwebz.comçš„ç›¸å…³èµ„æºè®°å½•ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸»æœºâ€œwwwâ€çš„IPåœ°å€ã€‚æ­¤æ—¶ï¼ŒæŸ¥è¯¢æµç¨‹å®Œæˆï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è·å¾—çš„IPåœ°å€è®¿é—®ç½‘ç«™ï¼Œæµè§ˆç½‘é¡µå†…å®¹ã€‚</p><h2 id="4-etc-hosts"><a href="#4-etc-hosts" class="headerlink" title="4 &#x2F;etc&#x2F;hosts"></a>4 &#x2F;etc&#x2F;hosts</h2><p>åœ¨çœŸæ­£è®¿é—®DNSè¿›è¡ŒæŸ¥è¯¢ä¹‹å‰ï¼Œä¼šé¦–å…ˆæ£€æŸ¥æœ¬åœ°çš„&#x2F;etc&#x2F;hostsæ–‡ä»¶ã€‚</p><h4 id="æ–‡ä»¶æ¦‚è¿°"><a href="#æ–‡ä»¶æ¦‚è¿°" class="headerlink" title="æ–‡ä»¶æ¦‚è¿°"></a>æ–‡ä»¶æ¦‚è¿°</h4><p>&#x2F;etc&#x2F;hostsæ–‡ä»¶ä¸­åŒ…å«äº†ä¸»æœºååˆ°IPåœ°å€çš„æ˜ å°„ã€‚å…¶æ ¼å¼ç›´è§‚æ˜“æ‡‚ï¼šæ¯è¡ŒåŒ…å«ä¸€ä¸ªIPåœ°å€ã€å¯¹åº”çš„ä¸»æœºåä»¥åŠå¯é€‰çš„ä¸»æœºåˆ«åã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span>       localhost<br><span class="hljs-number">127.0.1.1</span>       icebox<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ–‡ä»¶é€šå¸¸åŒ…å«æŒ‡å‘localhostçš„æ¡ç›®ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä¿®æ”¹&#x2F;etc&#x2F;hosts.denyæˆ–&#x2F;etc&#x2F;hosts.allowæ–‡ä»¶å¯ä»¥ç®¡ç†å¯¹ä¸»æœºçš„è®¿é—®æ§åˆ¶ã€‚ç„¶è€Œï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç›´æ¥ç¼–è¾‘è¿™äº›æ–‡ä»¶å¹¶ä¸æ˜¯æœ€ä½³å®è·µï¼›æ›´æ¨èçš„æ–¹æ³•æ˜¯è°ƒæ•´é˜²ç«å¢™è§„åˆ™ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚</p><h3 id="etc-resolv-confæ–‡ä»¶"><a href="#etc-resolv-confæ–‡ä»¶" class="headerlink" title="&#x2F;etc&#x2F;resolv.confæ–‡ä»¶"></a>&#x2F;etc&#x2F;resolv.confæ–‡ä»¶</h3><p>&#x2F;etc&#x2F;resolv.confæ–‡ä»¶ç”¨äºæŒ‡å®šDNSæœåŠ¡å™¨ï¼Œä»¥ä¾¿æ›´é«˜æ•ˆåœ°è¿›è¡ŒåŸŸåè§£æã€‚ç„¶è€Œï¼Œéšç€DNSæŠ€æœ¯çš„å‘å±•å’Œæ”¹è¿›ï¼Œè¯¥æ–‡ä»¶çš„é‡è¦æ€§å·²ç»å‡å¼±ï¼Œåœ¨å¾ˆå¤šç°ä»£Linuxå‘è¡Œç‰ˆä¸­ï¼Œå®ƒç”šè‡³ä¸å†éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç”±resolvconfå·¥å…·è‡ªåŠ¨ç”Ÿæˆçš„&#x2F;etc&#x2F;resolv.confæ–‡ä»¶ç¤ºä¾‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#     <span class="hljs-keyword">DO</span> <span class="hljs-keyword">NOT</span> EDIT THIS FILE <span class="hljs-keyword">BY</span> HAND <span class="hljs-comment">-- YOUR CHANGES WILL BE OVERWRITTEN</span><br>nameserver <span class="hljs-number">127.0</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><br><span class="hljs-keyword">search</span> localdomain<br></code></pre></td></tr></table></figure><h2 id="5-DNSå·¥å…·"><a href="#5-DNSå·¥å…·" class="headerlink" title="5 DNSå·¥å…·"></a>5 DNSå·¥å…·</h2><h4 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h4><p>â€œåç§°æœåŠ¡å™¨æŸ¥æ‰¾â€å·¥å…·ç”¨äºæŸ¥è¯¢åç§°æœåŠ¡å™¨ä»¥è·å–å…³äºèµ„æºè®°å½•çš„ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯å¦‚ä½•æŸ¥æ‰¾google.comçš„åç§°æœåŠ¡å™¨ä½ç½®çš„ä¾‹å­ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">pete<span class="hljs-keyword">@icebox</span>:~$ nslookup www.google.com<br><span class="hljs-attribute">Server</span>:         <span class="hljs-number">127.0</span>.<span class="hljs-number">1.1</span><br><span class="hljs-attribute">Address</span>:        <span class="hljs-number">127.0</span>.<span class="hljs-number">1.1</span>#<span class="hljs-number">53</span><br><br>Non-authoritative <span class="hljs-attribute">answer</span>:<br><span class="hljs-attribute">Name</span>:   www.google.com<br><span class="hljs-attribute">Address</span>: <span class="hljs-number">216.58</span>.<span class="hljs-number">192.4</span><br></code></pre></td></tr></table></figure><h4 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h4><p>Digï¼ˆåŸŸåä¿¡æ¯æœç´¢å™¨ï¼‰ç”¨äºè·å–DNSåç§°æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚ç›¸æ¯”nslookupï¼Œå®ƒæ›´åŠ çµæ´»ï¼Œæ˜¯æ’æŸ¥DNSé—®é¢˜çš„ç†æƒ³é€‰æ‹©ã€‚</p><p>ç¤ºä¾‹å‘½ä»¤åŠå…¶è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">pete@icebox:~$</span> <span class="hljs-string">dig</span> <span class="hljs-string">www.google.com</span><br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.9</span><span class="hljs-number">.5</span><span class="hljs-number">-3</span><span class="hljs-string">-Ubuntu</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">www.google.com</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NOERROR,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">42376</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">5</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">1</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">OPT PSEUDOSECTION:</span><br><span class="hljs-string">;</span> <span class="hljs-attr">EDNS: version:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">flags:;</span> <span class="hljs-attr">MBZ:</span> <span class="hljs-number">0005</span> <span class="hljs-string">,</span> <span class="hljs-attr">udp:</span> <span class="hljs-number">512</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;www.google.com.</span>                        <span class="hljs-string">IN</span>      <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">ANSWER SECTION:</span><br><span class="hljs-string">www.google.com.</span>         <span class="hljs-number">5</span>       <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">74.125</span><span class="hljs-number">.239</span><span class="hljs-number">.147</span><br><span class="hljs-string">www.google.com.</span>         <span class="hljs-number">5</span>       <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">74.125</span><span class="hljs-number">.239</span><span class="hljs-number">.144</span><br><span class="hljs-string">www.google.com.</span>         <span class="hljs-number">5</span>       <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">74.125</span><span class="hljs-number">.239</span><span class="hljs-number">.146</span><br><span class="hljs-string">www.google.com.</span>         <span class="hljs-number">5</span>       <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">74.125</span><span class="hljs-number">.239</span><span class="hljs-number">.145</span><br><span class="hljs-string">www.google.com.</span>         <span class="hljs-number">5</span>       <span class="hljs-string">IN</span>      <span class="hljs-string">A</span>       <span class="hljs-number">74.125</span><span class="hljs-number">.239</span><span class="hljs-number">.148</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">27</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><span class="hljs-comment">#53(127.0.1.1)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Sun</span> <span class="hljs-string">Feb</span> <span class="hljs-number">07</span> <span class="hljs-number">10</span><span class="hljs-string">:14:00</span> <span class="hljs-string">PST</span> <span class="hljs-number">2016</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">123</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Network Troubleshooting</title>
    <link href="/2025/03/22/Linux-Network-Troubleshooting/"/>
    <url>/2025/03/22/Linux-Network-Troubleshooting/</url>
    
    <content type="html"><![CDATA[<h1 id="Network-TroubleShooting"><a href="#Network-TroubleShooting" class="headerlink" title="Network TroubleShooting"></a>Network TroubleShooting</h1><h2 id="1-Internet-Control-Message-Protocol-ICMP"><a href="#1-Internet-Control-Message-Protocol-ICMP" class="headerlink" title="1 Internet Control Message Protocol (ICMP)"></a>1 Internet Control Message Protocol (ICMP)</h2><p>Internetæ§åˆ¶æ¶ˆæ¯åè®®ï¼ˆICMPï¼‰æ˜¯TCP&#x2F;IPåè®®ç°‡çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå‘é€æ›´æ–°å’Œé”™è¯¯æ¶ˆæ¯ã€‚å®ƒæ˜¯è°ƒè¯•ç½‘ç»œé—®é¢˜ï¼ˆå¦‚æ•°æ®åŒ…ä¼ è¾“å¤±è´¥ï¼‰çš„æä¸ºæœ‰ç”¨çš„å·¥å…·ã€‚</p><p>æ¯ä¸ªICMPæ¶ˆæ¯åŒ…å«ç±»å‹ã€ä»£ç å’Œæ ¡éªŒå’Œå­—æ®µã€‚ç±»å‹å­—æ®µè¡¨ç¤ºICMPæ¶ˆæ¯çš„ç§ç±»ï¼›ä»£ç ä½œä¸ºå­ç±»å‹ï¼Œæä¾›æœ‰å…³æ¶ˆæ¯çš„æ›´å¤šä¿¡æ¯ï¼›æ ¡éªŒå’Œç”¨äºæ£€æµ‹æ¶ˆæ¯å®Œæ•´æ€§æ–¹é¢çš„é—®é¢˜ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ICMPç±»å‹ï¼š</p><ul><li>ç±»å‹0ï¼šEchoåº”ç­”</li><li>ç±»å‹3ï¼šç›®æ ‡ä¸å¯è¾¾</li><li>ç±»å‹8ï¼šEchoè¯·æ±‚</li><li>ç±»å‹11ï¼šè¶…æ—¶</li></ul><p>å½“æ•°æ®åŒ…æ— æ³•åˆ°è¾¾ç›®çš„åœ°æ—¶ï¼Œä¼šç”Ÿæˆç±»å‹3çš„ICMPæ¶ˆæ¯ã€‚åœ¨ç±»å‹3ä¸­ï¼Œæœ‰16ä¸ªä»£ç å€¼è¿›ä¸€æ­¥æè¿°ä¸ºä½•æ— æ³•åˆ°è¾¾ç›®çš„åœ°ï¼š</p><ul><li>ä»£ç 0ï¼šç½‘ç»œä¸å¯è¾¾</li><li>ä»£ç 1ï¼šä¸»æœºä¸å¯è¾¾</li><li>â€¦</li></ul><h2 id="2-Pingå·¥å…·ä»‹ç»"><a href="#2-Pingå·¥å…·ä»‹ç»" class="headerlink" title="2 Pingå·¥å…·ä»‹ç»"></a>2 Pingå·¥å…·ä»‹ç»</h2><p>Pingæ˜¯ç½‘ç»œè¯Šæ–­ä¸­æœ€åŸºæœ¬çš„å·¥å…·ä¹‹ä¸€ï¼Œç”¨äºæµ‹è¯•æ•°æ®åŒ…æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚å®ƒé€šè¿‡å‘ç›®æ ‡ä¸»æœºå‘é€ICMP Echoè¯·æ±‚ï¼ˆç±»å‹8ï¼‰æ•°æ®åŒ…ï¼Œå¹¶ç­‰å¾…ICMP Echoåº”ç­”ï¼ˆç±»å‹0ï¼‰æ¥å·¥ä½œã€‚å½“ä¸»æœºå‘å‡ºè¯·æ±‚æ•°æ®åŒ…å¹¶æ”¶åˆ°ç›®æ ‡è¿”å›çš„å“åº”æ—¶ï¼ŒPingæ“ä½œæˆåŠŸã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pete@icebox:~$<span class="hljs-built_in"> ping </span>-c 3 www.google.com<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>www.google.com (74.125.239.112) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> nuq05s01-in-f16.1e100.net (74.125.239.112): <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=29.0 ms<br>64 bytes <span class="hljs-keyword">from</span> nuq05s01-in-f16.1e100.net (74.125.239.112): <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=23.7 ms<br>64 bytes <span class="hljs-keyword">from</span> nuq05s01-in-f16.1e100.net (74.125.239.112): <span class="hljs-attribute">icmp_seq</span>=3 <span class="hljs-attribute">ttl</span>=128 <span class="hljs-attribute">time</span>=15.1 ms<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨pingå‘½ä»¤æ£€æŸ¥æ˜¯å¦èƒ½è®¿é—®<a href="http://www.google.com.`-c`æ ‡å¿—(è®¡æ•°)ç”¨äºåœ¨è¾¾åˆ°æŒ‡å®šæ•°é‡ååœæ­¢å‘é€echoè¯·æ±‚æ•°æ®åŒ…./">www.google.comã€‚`-c`æ ‡å¿—ï¼ˆè®¡æ•°ï¼‰ç”¨äºåœ¨è¾¾åˆ°æŒ‡å®šæ•°é‡ååœæ­¢å‘é€Echoè¯·æ±‚æ•°æ®åŒ…ã€‚</a></p><p>è¾“å‡ºçš„ç¬¬ä¸€éƒ¨åˆ†è¡¨ç¤ºæ­£åœ¨å‘74.125.239.112ï¼ˆgoogle.comï¼‰å‘é€64å­—èŠ‚çš„æ•°æ®åŒ…ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¾ç¤ºäº†è¿™äº›æ•°æ®åŒ…å¾€è¿”çš„è¯¦ç»†ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ç§’å‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚</p><h4 id="å…³é”®å­—æ®µè§£é‡Š"><a href="#å…³é”®å­—æ®µè§£é‡Š" class="headerlink" title="å…³é”®å­—æ®µè§£é‡Š"></a>å…³é”®å­—æ®µè§£é‡Š</h4><ul><li><p><strong>icmp_seq</strong>ï¼šæ˜¾ç¤ºå‘é€çš„æ•°æ®åŒ…åºåˆ—å·ã€‚æœ¬ä¾‹ä¸­ï¼Œå…±å‘é€äº†3ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ä¸”æ‰€æœ‰æ•°æ®åŒ…éƒ½å·²è¿”å›ã€‚å¦‚æœPingè¿‡ç¨‹ä¸­å‘ç°æŸäº›åºåˆ—å·ç¼ºå¤±ï¼Œåˆ™è¡¨æ˜å­˜åœ¨è¿æ¥é—®é¢˜ï¼Œä¸æ˜¯æ‰€æœ‰æ•°æ®åŒ…éƒ½èƒ½é¡ºåˆ©é€šè¿‡ã€‚è‹¥åºåˆ—å·ä¹±åºï¼Œå¯èƒ½æ„å‘³ç€è¿æ¥é€Ÿåº¦éå¸¸æ…¢ï¼Œå¯¼è‡´æ•°æ®åŒ…è¶…è¿‡äº†é»˜è®¤çš„ä¸€ç§’é—´éš”ã€‚</p></li><li><p><strong>ttl</strong>ï¼šç”Ÿå­˜æ—¶é—´ï¼ˆTime To Liveï¼‰ï¼Œä½œä¸ºè·³æ•°è®¡æ•°å™¨ã€‚æ¯æ¬¡ç»è¿‡ä¸€è·³ï¼Œè¯¥å€¼å‡ä¸€ï¼Œç›´è‡³å˜ä¸ºé›¶ï¼Œæ­¤æ—¶æ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒã€‚è¿™ç¡®ä¿äº†æ•°æ®åŒ…ä¸ä¼šåœ¨ç½‘ç»œä¸­æ— é™å¾ªç¯ã€‚</p></li><li><p><strong>time</strong>ï¼šä»å‘é€Echoè¯·æ±‚åˆ°æ¥æ”¶Echoåº”ç­”çš„å¾€è¿”æ—¶é—´ã€‚</p></li></ul><p>é€šè¿‡åˆ†æPingå‘½ä»¤çš„ç»“æœï¼Œå¯ä»¥æœ‰æ•ˆåœ°è¯„ä¼°ç½‘ç»œè¿æ¥çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚</p><h2 id="3-Tracerouteå·¥å…·ä»‹ç»"><a href="#3-Tracerouteå·¥å…·ä»‹ç»" class="headerlink" title="3 Tracerouteå·¥å…·ä»‹ç»"></a>3 Tracerouteå·¥å…·ä»‹ç»</h2><p>Tracerouteå‘½ä»¤ç”¨äºæŸ¥çœ‹æ•°æ®åŒ…çš„è·¯ç”±è·¯å¾„ã€‚å®ƒé€šè¿‡å‘é€å…·æœ‰é€’å¢TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰å€¼çš„æ•°æ®åŒ…æ¥å·¥ä½œï¼Œä»1å¼€å§‹ã€‚ç¬¬ä¸€ä¸ªè·¯ç”±å™¨æ¥æ”¶åˆ°æ•°æ®åŒ…æ—¶ä¼šå°†TTLå€¼å‡ä¸€ï¼Œå¯¼è‡´æ•°æ®åŒ…è¢«ä¸¢å¼ƒï¼Œå¹¶å‘æºä¸»æœºè¿”å›ä¸€ä¸ªICMPè¶…æ—¶æ¶ˆæ¯ã€‚ç„¶åï¼Œä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„TTLè®¾ç½®ä¸º2ï¼Œè¿™æ ·å®ƒå°±èƒ½é€šè¿‡ç¬¬ä¸€ä¸ªè·¯ç”±å™¨ï¼Œä½†åˆ°è¾¾ç¬¬äºŒä¸ªè·¯ç”±å™¨æ—¶TTLå†æ¬¡å˜ä¸º0ï¼Œä»è€Œå†æ¬¡è§¦å‘ICMPè¶…æ—¶æ¶ˆæ¯çš„è¿”å›ã€‚Tracerouteä»¥æ­¤æ–¹å¼è¿ä½œï¼Œéšç€æ•°æ®åŒ…çš„å‘é€å’Œä¸¢å¼ƒï¼Œé€æ­¥æ„å»ºå‡ºä¸€æ¡ä»æºåˆ°ç›®çš„åœ°æ‰€ç»è¿‡çš„è·¯ç”±å™¨åˆ—è¡¨ï¼Œç›´åˆ°æœ€ç»ˆæ¥æ”¶åˆ°ç›®æ ‡ä¸»æœºçš„ICMP Echoåº”ç­”ã€‚</p><p>ä»¥ä¸‹æ˜¯Tracerouteçš„ä¸€ä¸ªç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ traceroute google.com<br>traceroute to google.com (<span class="hljs-number">216.58</span>.<span class="hljs-number">216.174</span>), <span class="hljs-number">30</span> hops max, <span class="hljs-number">60</span> byte packets<br> <span class="hljs-number">1</span>  <span class="hljs-number">192.168</span>.<span class="hljs-number">4.254</span> (<span class="hljs-number">192.168</span>.<span class="hljs-number">4.254</span>)  <span class="hljs-number">0.028</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">0</span>.<span class="hljs-number">009</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">0</span>.<span class="hljs-number">008</span> <span class="hljs-keyword">ms</span><br> <span class="hljs-title">2</span>  <span class="hljs-number">100.64</span>.<span class="hljs-number">1.113</span> (<span class="hljs-number">100.64</span>.<span class="hljs-number">1.113</span>)  <span class="hljs-number">1.227</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">1</span>.<span class="hljs-number">226</span> <span class="hljs-keyword">ms</span> <span class="hljs-title">0</span>.<span class="hljs-number">920</span> <span class="hljs-keyword">ms</span><br> <span class="hljs-title">3</span>  <span class="hljs-number">100.64</span>.<span class="hljs-number">0.20</span> (<span class="hljs-number">100.64</span>.<span class="hljs-number">0.20</span>)  <span class="hljs-number">1.501</span> <span class="hljs-keyword">ms</span> <span class="hljs-title">1</span>.<span class="hljs-number">556</span> <span class="hljs-keyword">ms</span>  <span class="hljs-title">0</span>.<span class="hljs-number">855</span> ms<br></code></pre></td></tr></table></figure><p>æ¯è¡Œä»£è¡¨äº†ä»æœ¬åœ°ä¸»æœºåˆ°ç›®æ ‡ä¸»æœºä¹‹é—´çš„ä¸€ä¸ªè·¯ç”±å™¨æˆ–è®¾å¤‡ã€‚å®ƒæ˜¾ç¤ºäº†è¯¥èŠ‚ç‚¹çš„åç§°åŠå…¶IPåœ°å€ï¼Œæœ€åä¸‰åˆ—åˆ†åˆ«å¯¹åº”äº†æ•°æ®åŒ…å¾€è¿”è¯¥èŠ‚ç‚¹æ‰€éœ€çš„æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTracerouteæ²¿è·¯ç”±å‘é€ä¸‰ä¸ªæ•°æ®åŒ…ä»¥è·å–å¹³å‡å¾€è¿”æ—¶é—´ï¼Œä»è€Œå¸®åŠ©è¯„ä¼°ç½‘ç»œè·¯å¾„çš„è´¨é‡ä¸æ•ˆç‡ã€‚é€šè¿‡åˆ†æè¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥è¯†åˆ«ç½‘ç»œå»¶è¿Ÿçš„åŸå› åŠå¯èƒ½å­˜åœ¨çš„ç“¶é¢ˆã€‚</p><h2 id="4-netstat"><a href="#4-netstat" class="headerlink" title="4 netstat"></a>4 netstat</h2><h4 id="å¸¸è§ç«¯å£"><a href="#å¸¸è§ç«¯å£" class="headerlink" title="å¸¸è§ç«¯å£"></a>å¸¸è§ç«¯å£</h4><p>å¯ä»¥é€šè¿‡æŸ¥çœ‹<code>/etc/services</code>æ–‡ä»¶æ¥è·å–å¸¸è§ç«¯å£çš„åˆ—è¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp             21/tcp<br>ssh             22/tcp<br>smtp            25/tcp<br>domain          53/tcp  <span class="hljs-comment"># DNS</span><br>http            80/tcp<br>https           443/tcp<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€åˆ—æ˜¯æœåŠ¡åç§°ï¼Œæ¥ç€æ˜¯ç«¯å£å·å’Œæ‰€ä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ã€‚</p><h4 id="Netstatå·¥å…·è¯¦è§£"><a href="#Netstatå·¥å…·è¯¦è§£" class="headerlink" title="Netstatå·¥å…·è¯¦è§£"></a>Netstatå·¥å…·è¯¦è§£</h4><p>Netstatæ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ï¼Œå¯ä»¥æä¾›è¯¦ç»†çš„ç½‘ç»œä¿¡æ¯ï¼ŒåŒ…æ‹¬ç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€ç½‘ç»œæ¥å£ä¿¡æ¯ç­‰ã€‚</p><p><strong>å¥—æ¥å­—å’Œç«¯å£</strong></p><p>å¥—æ¥å­—æ˜¯å…è®¸ç¨‹åºå‘é€å’Œæ¥æ”¶æ•°æ®çš„æ¥å£ï¼Œè€Œç«¯å£ç”¨äºæ ‡è¯†å“ªä¸ªåº”ç”¨ç¨‹åºåº”å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚å¥—æ¥å­—åœ°å€æ˜¯IPåœ°å€å’Œç«¯å£çš„ç»„åˆã€‚ä¸»æœºä¸ç›®æ ‡ä¹‹é—´çš„æ¯ä¸ªè¿æ¥éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„å¥—æ¥å­—ã€‚ä¾‹å¦‚ï¼ŒHTTPæœåŠ¡è¿è¡Œåœ¨80ç«¯å£ä¸Šï¼Œä½†å¯ä»¥æ‹¥æœ‰å¤šä¸ªHTTPè¿æ¥ï¼Œä¸ºäº†ç»´æŠ¤æ¯ä¸ªè¿æ¥ï¼Œæ¯å»ºç«‹ä¸€ä¸ªè¿æ¥å°±ä¼šåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨<code>netstat -at</code>å‘½ä»¤çš„è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State      <br><span class="hljs-attribute">tcp</span>        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> icebox:domain           *:*                     LISTEN     <br><span class="hljs-attribute">tcp</span>        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost:ipp           *:*                     LISTEN     <br><span class="hljs-attribute">tcp</span>        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> icebox.lan:<span class="hljs-number">44468</span>        <span class="hljs-number">124.28.28.50</span>:http       TIME_WAIT  <br><span class="hljs-attribute">tcp</span>        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> icebox.lan:<span class="hljs-number">34751</span>        <span class="hljs-number">124.28.29.50</span>:http       TIME_WAIT  <br><span class="hljs-attribute">tcp6</span>       <span class="hljs-number">0</span>      <span class="hljs-number">0</span> ip6-localhost:ipp      <span class="hljs-meta"> [::]:*                  LISTEN     </span><br><span class="hljs-meta">tcp6       1      0 ip6-localhost:35094     ip6-localhost:ipp       CLOSE_WAIT </span><br><span class="hljs-meta">tcp6       0      0 ip6-localhost:ipp       ip6-localhost:35094     FIN_WAIT2</span><br></code></pre></td></tr></table></figure><p><code>netstat -a</code>å‘½ä»¤æ˜¾ç¤ºäº†æ‰€æœ‰ç›‘å¬å’Œéç›‘å¬çš„ç½‘ç»œå¥—æ¥å­—ï¼Œ<code>-t</code>æ ‡å¿—ä»…å±•ç¤ºTCPè¿æ¥ã€‚å„åˆ—å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><strong>Proto</strong>ï¼šä½¿ç”¨çš„åè®®ï¼ŒTCPæˆ–UDPã€‚</li><li><strong>Recv-Q</strong>ï¼šå·²æ’é˜Ÿç­‰å¾…æ¥æ”¶çš„æ•°æ®é‡ã€‚</li><li><strong>Send-Q</strong>ï¼šå·²æ’é˜Ÿç­‰å¾…å‘é€çš„æ•°æ®é‡ã€‚</li><li><strong>Local Address</strong>ï¼šæœ¬åœ°è¿æ¥çš„ä¸»æœºåœ°å€ã€‚</li><li><strong>Foreign Address</strong>ï¼šè¿œç¨‹è¿æ¥çš„ä¸»æœºåœ°å€ã€‚</li><li><strong>State</strong>ï¼šå¥—æ¥å­—çš„çŠ¶æ€ã€‚</li></ul><p>å¸¸è§çš„å¥—æ¥å­—çŠ¶æ€åŒ…æ‹¬ï¼š</p><ul><li><strong>LISTENING</strong>ï¼šå¥—æ¥å­—æ­£åœ¨ç›‘å¬ä¼ å…¥è¿æ¥ã€‚</li><li><strong>SYN_SENT</strong>ï¼šå¥—æ¥å­—æ­£å°è¯•ä¸»åŠ¨å»ºç«‹è¿æ¥ã€‚</li><li><strong>ESTABLISHED</strong>ï¼šå¥—æ¥å­—å·²ç»å»ºç«‹äº†è¿æ¥ã€‚</li><li><strong>CLOSE_WAIT</strong>ï¼šè¿œç¨‹ä¸»æœºå·²å…³é—­è¿æ¥ï¼Œç­‰å¾…æœ¬åœ°å¥—æ¥å­—å…³é—­ã€‚</li><li><strong>TIME_WAIT</strong>ï¼šå¥—æ¥å­—åœ¨å…³é—­åä»å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä»¥å¤„ç†ç½‘ç»œä¸­å¯èƒ½æ®‹ç•™çš„æ•°æ®åŒ…ã€‚</li></ul><h2 id="5-æ•°æ®åŒ…åˆ†æç®€ä»‹"><a href="#5-æ•°æ®åŒ…åˆ†æç®€ä»‹" class="headerlink" title="5 æ•°æ®åŒ…åˆ†æç®€ä»‹"></a>5 æ•°æ®åŒ…åˆ†æç®€ä»‹</h2><p>Wiresharkå’Œtcpdumpæ˜¯ä¸¤ç§éå¸¸æµè¡Œçš„æ•°æ®åŒ…åˆ†æå·¥å…·ã€‚å®ƒä»¬èƒ½å¤Ÿæ‰«æç½‘ç»œæ¥å£ã€æ•è·æ•°æ®åŒ…æ´»åŠ¨ã€è§£ææ•°æ®åŒ…å¹¶è¾“å‡ºä¿¡æ¯ä¾›æˆ‘ä»¬æŸ¥çœ‹ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ·±å…¥è¿›è¡Œç½‘ç»œåˆ†æï¼Œè§¦åŠåº•å±‚ç»†èŠ‚ã€‚</p><h4 id="å®‰è£…tcpdump"><a href="#å®‰è£…tcpdump" class="headerlink" title="å®‰è£…tcpdump"></a>å®‰è£…tcpdump</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> apt install tcpdump<br></code></pre></td></tr></table></figure><h4 id="åœ¨æŒ‡å®šæ¥å£ä¸Šæ•è·æ•°æ®åŒ…"><a href="#åœ¨æŒ‡å®šæ¥å£ä¸Šæ•è·æ•°æ®åŒ…" class="headerlink" title="åœ¨æŒ‡å®šæ¥å£ä¸Šæ•è·æ•°æ®åŒ…"></a>åœ¨æŒ‡å®šæ¥å£ä¸Šæ•è·æ•°æ®åŒ…</h4><p>ä»¥ä¸‹æ˜¯åœ¨<code>wlan0</code>æ¥å£ä¸Šæ•è·æ•°æ®åŒ…çš„ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ <span class="hljs-built_in">sudo</span> tcpdump -i wlan0<br><br>tcpdump: verbose output suppressed, use -v or -vv <span class="hljs-keyword">for</span> full protocol decode<br><br>listening on wlan0, link-type EN10MB (Ethernet), capture size 65535 bytes<br><br>11:28:23.958840 IP icebox.lan &gt; nuq04s29-in-f4.1e100.net: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1901, <span class="hljs-built_in">seq</span> 2, length 64<br><br>11:28:23.970928 IP nuq04s29-in-f4.1e100.net &gt; icebox.lan: ICMP <span class="hljs-built_in">echo</span> reply, <span class="hljs-built_in">id</span> 1901, <span class="hljs-built_in">seq</span> 2, length 64<br></code></pre></td></tr></table></figure><p>è¿è¡Œæ•°æ®åŒ…æ•è·æ—¶ï¼Œä¼šæ³¨æ„åˆ°å¤§é‡çš„ç½‘ç»œæ´»åŠ¨ã€‚</p><h4 id="ç†è§£è¾“å‡º"><a href="#ç†è§£è¾“å‡º" class="headerlink" title="ç†è§£è¾“å‡º"></a>ç†è§£è¾“å‡º</h4><ul><li><strong>æ—¶é—´æˆ³</strong>ï¼šè®°å½•ç½‘ç»œæ´»åŠ¨çš„æ—¶é—´ã€‚</li><li><strong>IP</strong>ï¼šåŒ…å«åè®®ä¿¡æ¯ã€‚</li><li><strong>æºåœ°å€ä¸ç›®çš„åœ°å€</strong>ï¼šä¾‹å¦‚<code>icebox.lan &gt; nuq04s29-in-f4.1e100.net</code>ã€‚</li><li><strong>åºåˆ—å·ï¼ˆseqï¼‰</strong>ï¼šTCPæ•°æ®åŒ…çš„èµ·å§‹å’Œç»“æŸåºåˆ—å·ã€‚</li><li><strong>é•¿åº¦</strong>ï¼šæ•°æ®åŒ…é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ã€‚</li></ul><h4 id="å°†tcpdumpè¾“å‡ºå†™å…¥æ–‡ä»¶"><a href="#å°†tcpdumpè¾“å‡ºå†™å…¥æ–‡ä»¶" class="headerlink" title="å°†tcpdumpè¾“å‡ºå†™å…¥æ–‡ä»¶"></a>å°†tcpdumpè¾“å‡ºå†™å…¥æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> tcpdump -w /some/file<br></code></pre></td></tr></table></figure><p>è¿™å°†æŠŠæ•è·çš„æ•°æ®ç›´æ¥å†™å…¥æŒ‡å®šæ–‡ä»¶ï¼Œä¾¿äºåç»­åˆ†æã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Network Config</title>
    <link href="/2025/03/22/Linux-Network-Config/"/>
    <url>/2025/03/22/Linux-Network-Config/</url>
    
    <content type="html"><![CDATA[<h1 id="Network-Config"><a href="#Network-Config" class="headerlink" title="Network Config"></a>Network Config</h1><h2 id="1-ç½‘ç»œæ¥å£ç®€ä»‹"><a href="#1-ç½‘ç»œæ¥å£ç®€ä»‹" class="headerlink" title="1 ç½‘ç»œæ¥å£ç®€ä»‹"></a>1 ç½‘ç»œæ¥å£ç®€ä»‹</h2><p>ç½‘ç»œæ¥å£æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸è¿æ¥ç½‘ç»œè½¯ä»¶éƒ¨åˆ†ä¸ç¡¬ä»¶éƒ¨åˆ†çš„æ¡¥æ¢ã€‚</p><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç½‘ç»œæ¥å£çš„ä¿¡æ¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pete</span>@icebox:~$ ifconfig -a<br><span class="hljs-attribute">eth0</span>      Link encap:Ethernet  HWaddr <span class="hljs-number">1</span>d:<span class="hljs-number">3</span>a:<span class="hljs-number">32</span>:<span class="hljs-number">24</span>:<span class="hljs-number">4</span>d:ce  <br>          <span class="hljs-attribute">inet</span> addr:<span class="hljs-number">192.168.1.129</span>  Bcast:<span class="hljs-number">192.168.1.255</span>  Mask:<span class="hljs-number">255.255.255.0</span><br>          <span class="hljs-attribute">inet6</span> addr: fd60::<span class="hljs-number">21</span>c:<span class="hljs-number">29</span>ff:fe63:<span class="hljs-number">5</span>cdc/<span class="hljs-number">64</span> Scope:Link<br></code></pre></td></tr></table></figure><h4 id="ifconfig-å‘½ä»¤"><a href="#ifconfig-å‘½ä»¤" class="headerlink" title="ifconfig å‘½ä»¤"></a><code>ifconfig</code> å‘½ä»¤</h4><p><code>ifconfig</code> å·¥å…·ç”¨äºé…ç½®ç½‘ç»œæ¥å£ã€‚è‹¥æ— ç½‘ç»œæ¥å£è®¾ç½®ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºä¸ç½‘ç»œå°†æ— æ³•é€šä¿¡ã€‚æ­¤å·¥å…·åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œå¹¶æ ¹æ®é…ç½®æ–‡ä»¶è®¾ç½®æ¥å£ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯æ‰‹åŠ¨ä¿®æ”¹ã€‚è¾“å‡ºç»“æœå·¦ä¾§æ˜¾ç¤ºæ¥å£åç§°ï¼Œå³ä¾§å±•ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚å¸¸è§çš„æ¥å£åŒ…æ‹¬ï¼š<code>eth0</code>ï¼ˆé¦–å¼ ä»¥å¤ªç½‘å¡ï¼‰ã€<code>wlan0</code>ï¼ˆæ— çº¿æ¥å£ï¼‰å’Œ <code>lo</code>ï¼ˆå›ç¯æ¥å£ï¼‰ã€‚å›ç¯æ¥å£ç”¨äºè¡¨ç¤ºæœ¬æœºï¼Œä¾¿äºè°ƒè¯•æˆ–è®¿é—®æœ¬åœ°æœåŠ¡å™¨ã€‚</p><p>æ¥å£çŠ¶æ€å¯åˆ†ä¸ºå¯ç”¨ï¼ˆupï¼‰å’Œç¦ç”¨ï¼ˆdownï¼‰ã€‚è¦å…³é—­æŸä¸ªæ¥å£ï¼Œå¯å°†å…¶è®¾ä¸ºâ€œdownâ€ã€‚å¸¸ç”¨çš„å­—æ®µåŒ…æ‹¬ï¼šHWaddrï¼ˆMACåœ°å€ï¼‰ã€inet addressï¼ˆIPv4åœ°å€ï¼‰å’Œ inet6ï¼ˆIPv6åœ°å€ï¼‰ã€‚æ­¤å¤–ï¼Œå­ç½‘æ©ç å’Œå¹¿æ’­åœ°å€ä¹Ÿä¸€ç›®äº†ç„¶ã€‚å¯é€šè¿‡ <code>/etc/network/interfaces</code> æŸ¥çœ‹æ¥å£ä¿¡æ¯ã€‚</p><p>åˆ›å»ºå¹¶å¯ç”¨æ¥å£ç¤ºä¾‹ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">$ ifconfig eth<span class="hljs-number">0 192.168.2</span>.<span class="hljs-number">1</span> netmask <span class="hljs-number">255.255.255.0</span> up<br></code></pre></td></tr></table></figure><p>å¯ç”¨æˆ–ç¦ç”¨æ¥å£ï¼š</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>ifup eth0<br><span class="hljs-variable">$ </span>ifdown eth0<br></code></pre></td></tr></table></figure><h4 id="ip-å‘½ä»¤"><a href="#ip-å‘½ä»¤" class="headerlink" title="ip å‘½ä»¤"></a><code>ip</code> å‘½ä»¤</h4><p><code>ip</code> å‘½ä»¤åŒæ ·å¯ç”¨äºç®¡ç†ç³»ç»Ÿç½‘ç»œæ ˆã€‚</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><ul><li>æ˜¾ç¤ºæ‰€æœ‰æ¥å£ä¿¡æ¯ï¼š<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ip <span class="hljs-built_in">link</span> show</span><br></code></pre></td></tr></table></figure></li><li>æ˜¾ç¤ºç‰¹å®šæ¥å£ç»Ÿè®¡ä¿¡æ¯ï¼š<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ip -s <span class="hljs-built_in">link</span> show eth0</span><br></code></pre></td></tr></table></figure></li><li>æ˜¾ç¤ºåˆ†é…ç»™å„æ¥å£çš„IPåœ°å€ï¼š<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">$ <span class="hljs-built_in">ip</span> address show<br></code></pre></td></tr></table></figure></li><li>å¯ç”¨æˆ–ç¦ç”¨æ¥å£ï¼š<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$<span class="hljs-built_in"> ip </span>link <span class="hljs-built_in">set</span> eth0 up<br>$<span class="hljs-built_in"> ip </span>link <span class="hljs-built_in">set</span> eth0 down<br></code></pre></td></tr></table></figure></li><li>ä¸ºæ¥å£æ·»åŠ IPåœ°å€ï¼š<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$<span class="hljs-built_in"> ip address </span><span class="hljs-built_in">add</span> 192.168.1.1/24 dev eth0<br></code></pre></td></tr></table></figure></li></ul><h2 id="2-è·¯ç”±ç®¡ç†"><a href="#2-è·¯ç”±ç®¡ç†" class="headerlink" title="2 è·¯ç”±ç®¡ç†"></a>2 è·¯ç”±ç®¡ç†</h2><h4 id="ä½¿ç”¨-route-å‘½ä»¤"><a href="#ä½¿ç”¨-route-å‘½ä»¤" class="headerlink" title="ä½¿ç”¨ route å‘½ä»¤"></a>ä½¿ç”¨ <code>route</code> å‘½ä»¤</h4><p><strong>æ·»åŠ æ–°è·¯ç”±ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> route add -net 192.168.2.1/23 gw 10.11.12.3<br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤è·¯ç”±ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> route del -net 192.168.2.1/23<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-ip-å‘½ä»¤"><a href="#ä½¿ç”¨-ip-å‘½ä»¤" class="headerlink" title="ä½¿ç”¨ ip å‘½ä»¤"></a>ä½¿ç”¨ <code>ip</code> å‘½ä»¤</h4><p>åŒæ ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>ip</code> å‘½ä»¤è¿›è¡Œä¸Šè¿°ä¿®æ”¹ï¼š</p><p><strong>æ·»åŠ è·¯ç”±ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ip route add 192.168.2.1/23 via 10.11.12.3<br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤è·¯ç”±ï¼š</strong></p><p>æŒ‡å®šç½‘å…³åˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ip route delete 192.168.2.1/23 via 10.11.12.3<br></code></pre></td></tr></table></figure><p>ä¸æŒ‡å®šç½‘å…³åˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ip route delete 192.168.2.1/23<br></code></pre></td></tr></table></figure><h2 id="3-DHCP-å®¢æˆ·ç«¯ç®¡ç†"><a href="#3-DHCP-å®¢æˆ·ç«¯ç®¡ç†" class="headerlink" title="3 DHCP å®¢æˆ·ç«¯ç®¡ç†"></a>3 DHCP å®¢æˆ·ç«¯ç®¡ç†</h2><p><code>dhclient</code> æœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼Œå¹¶ä» <code>dhclient.conf</code> æ–‡ä»¶ä¸­è·å–ç½‘ç»œæ¥å£åˆ—è¡¨ã€‚é’ˆå¯¹æ¯ä¸ªåˆ—å‡ºçš„æ¥å£ï¼Œ<code>dhclient</code> å°è¯•ä½¿ç”¨ DHCP åè®®è¿›è¡Œé…ç½®ã€‚</p><p><code>dhclient.leases</code> æ–‡ä»¶è®°å½•äº†è·¨ç³»ç»Ÿé‡å¯åçš„ç§Ÿçº¦åˆ—è¡¨ã€‚åœ¨è¯»å– <code>dhclient.conf</code> æ–‡ä»¶åï¼Œ<code>dhclient</code> ä¼šè¿›ä¸€æ­¥è¯»å– <code>dhclient.leases</code> æ–‡ä»¶ä»¥äº†è§£å·²åˆ†é…çš„ç§Ÿçº¦æƒ…å†µã€‚</p><h4 id="è·å–æ–°çš„-IP-åœ°å€"><a href="#è·å–æ–°çš„-IP-åœ°å€" class="headerlink" title="è·å–æ–°çš„ IP åœ°å€"></a>è·å–æ–°çš„ IP åœ°å€</h4><p>è¦ä¸ºæŒ‡å®šç½‘ç»œæ¥å£è·å–ä¸€ä¸ªæ–°çš„ IP åœ°å€ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> dhclient<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†è§¦å‘ DHCP å®¢æˆ·ç«¯è¯·æ±‚æ–°çš„ç½‘ç»œé…ç½®ï¼Œç¡®ä¿è®¾å¤‡èƒ½å¤Ÿè·å¾—æœ€æ–°çš„ç½‘ç»œå‚æ•°ï¼Œä»è€Œç»´æŒç½‘ç»œè¿æ¥çš„é«˜æ•ˆæ€§å’Œå¯é æ€§ã€‚</p><h2 id="4-ç½‘ç»œç®¡ç†"><a href="#4-ç½‘ç»œç®¡ç†" class="headerlink" title="4 ç½‘ç»œç®¡ç†"></a>4 ç½‘ç»œç®¡ç†</h2><p>ä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„ç½‘ç»œèƒ½å¤Ÿè‡ªåŠ¨å¯åŠ¨å¹¶è¿è¡Œï¼Œå¤§å¤šæ•°å‘è¡Œç‰ˆé‡‡ç”¨ NetworkManager å®ˆæŠ¤è¿›ç¨‹æ¥å®ç°è‡ªåŠ¨åŒ–ç½‘ç»œé…ç½®ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ï¼Œé€šå¸¸å¯ä»¥åœ¨æ¡Œé¢ä»»åŠ¡æ ä¸­æ‰¾åˆ° NetworkManager çš„å°ç¨‹åºå›¾æ ‡ï¼Œå®ƒè´Ÿè´£ç®¡ç†ç½‘ç»œç¡¬ä»¶å’Œè¿æ¥ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼ŒNetworkManager ä¼šæ”¶é›†ç½‘ç»œç¡¬ä»¶ä¿¡æ¯ï¼Œå¹¶æœç´¢æ— çº¿ã€æœ‰çº¿ç­‰è¿æ¥ï¼Œç„¶åæ¿€æ´»è¿™äº›è¿æ¥ã€‚</p><h4 id="å‘½ä»¤è¡Œå·¥å…·"><a href="#å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="å‘½ä»¤è¡Œå·¥å…·"></a>å‘½ä»¤è¡Œå·¥å…·</h4><p>é™¤äº†å›¾å½¢ç•Œé¢å¤–ï¼Œè¿˜æœ‰ä¸€äº›å‘½ä»¤è¡Œå·¥å…·å¯ä»¥ä¸ NetworkManager è¿›è¡Œäº¤äº’ï¼š</p><ul><li><strong>nm-tool</strong></li></ul><p><code>nm-tool</code> å·¥å…·ç”¨äºæŠ¥å‘Š NetworkManager çš„çŠ¶æ€åŠå…¶è®¾å¤‡çš„ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:/$ nm-tool<br><br>NetworkManager Tool<br><br><br>State: connected (global)<br><br><br><br>- Device: eth0  [Wired connection 1] -------------------------------------------<br><br>  Type:              Wired<br><br>  Driver:            pcnet32<br><br>  State:             connected<br><br>  Default:           <span class="hljs-built_in">yes</span><br><br>  HW Address:        12:3D:45:56:7D:CC<br><br><br><br>  Capabilities:<br><br>    Carrier Detect:  <span class="hljs-built_in">yes</span><br><br><br><br>  Wired Properties<br><br>    Carrier:         on<br><br><br><br>  IPv4 Settings:<br><br>    Address:         192.168.22.1<br><br>    Prefix:          24 (255.255.255.0)<br><br>    Gateway:         192.168.22.2<br><br><br><br>    DNS:             192.168.22.2<br><br></code></pre></td></tr></table></figure><ul><li><strong>nmcli</strong></li></ul><p><code>nmcli</code> å‘½ä»¤å…è®¸ç”¨æˆ·æ§åˆ¶å’Œä¿®æ”¹ NetworkManager çš„é…ç½®ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç›¸å…³æ‰‹å†Œé¡µã€‚</p><h2 id="5-arp"><a href="#5-arp" class="headerlink" title="5 arp"></a>5 arp</h2><p>å½“ä½¿ç”¨ARPæŸ¥æ‰¾MACåœ°å€æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆä¼šæ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ARPç¼“å­˜ã€‚å¯ä»¥æŸ¥çœ‹æ­¤ç¼“å­˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ arp<br><br>Address                  HWtype  HWaddress           Flags Mask            Iface<br>192.168.22.1             ether   00:12:24:<span class="hljs-built_in">fc</span>:12:cc   C                     eth0<br>192.168.22.254           ether   00:12:45:f2:84:64   C                     eth0<br></code></pre></td></tr></table></figure><p>åœ¨æœºå™¨å¯åŠ¨æ—¶ï¼ŒARPç¼“å­˜å®é™…ä¸Šæ˜¯ç©ºçš„ã€‚éšç€æ•°æ®åŒ…å‘é€åˆ°å…¶ä»–ä¸»æœºï¼Œç¼“å­˜é€æ¸è¢«å¡«å……ã€‚å¦‚æœå‘ä¸€ä¸ªä¸åœ¨ARPç¼“å­˜ä¸­çš„ç›®æ ‡å‘é€æ•°æ®åŒ…ï¼Œåˆ™ä¼šå‘ç”Ÿä»¥ä¸‹è¿‡ç¨‹ï¼š</p><ol><li>æºä¸»æœºåˆ›å»ºå¸¦æœ‰ARPè¯·æ±‚åŒ…çš„ä»¥å¤ªç½‘å¸§ã€‚</li><li>æºä¸»æœºå°†æ­¤å¸§å¹¿æ’­åˆ°æ•´ä¸ªç½‘ç»œã€‚</li><li>å¦‚æœç½‘ç»œä¸Šçš„æŸä¸ªä¸»æœºçŸ¥é“æ­£ç¡®çš„MACåœ°å€ï¼Œå®ƒå°†é€šè¿‡åŒ…å«è¯¥MACåœ°å€çš„å›å¤åŒ…å’Œå¸§è¿›è¡Œå›åº”ã€‚</li><li>æºä¸»æœºå°†IPåˆ°MACåœ°å€çš„æ˜ å°„æ·»åŠ åˆ°ARPç¼“å­˜ä¸­ï¼Œç„¶åç»§ç»­å‘é€æ•°æ®åŒ…ã€‚</li></ol><p>è¿˜å¯ä»¥é€šè¿‡<code>ip</code>å‘½ä»¤æŸ¥çœ‹ARPç¼“å­˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ip neighbour show<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Routing</title>
    <link href="/2025/03/22/Linux-Routing/"/>
    <url>/2025/03/22/Linux-Routing/</url>
    
    <content type="html"><![CDATA[<h1 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h1><h2 id="1-ä»€ä¹ˆæ˜¯è·¯ç”±å™¨ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯è·¯ç”±å™¨ï¼Ÿ" class="headerlink" title="1 ä»€ä¹ˆæ˜¯è·¯ç”±å™¨ï¼Ÿ"></a>1 ä»€ä¹ˆæ˜¯è·¯ç”±å™¨ï¼Ÿ</h2><p>è·¯ç”±å™¨æ˜¯ç½‘ç»œä¸­ç”¨äºå®ç°è®¾å¤‡é—´é€šä¿¡ä»¥åŠä¸å…¶ä»–ç½‘ç»œè¿æ¥çš„å…³é”®è®¾å¤‡ã€‚é€šå¸¸ï¼Œè·¯ç”±å™¨é…å¤‡æœ‰LANç«¯å£ï¼Œä½¿è®¾å¤‡èƒ½å¤Ÿè¿æ¥åˆ°åŒä¸€å±€åŸŸç½‘ï¼ˆLANï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ‹¥æœ‰ä¸€ä¸ªäº’è”ç½‘ä¸Šè”ç«¯å£ï¼ˆæœ‰æ—¶æ ‡è®°ä¸ºWANç«¯å£ï¼‰ï¼Œè¿æ¥åˆ°æ›´å¹¿æ³›çš„ç½‘ç»œå³äº’è”ç½‘ã€‚åœ¨è¿›è¡Œä»»ä½•ç½‘ç»œæ´»åŠ¨æ—¶ï¼Œæ•°æ®éƒ½éœ€è¦é€šè¿‡è·¯ç”±å™¨æ¥ä¼ è¾“ã€‚è·¯ç”±å™¨è´Ÿè´£å†³å®šç½‘ç»œæ•°æ®åŒ…çš„å»å‘å’Œæ¥æºï¼Œä»è€Œå®ç°åœ¨ä¸åŒç½‘ç»œé—´çš„è·¯ç”±é€‰æ‹©ã€‚</p><h4 id="è·¯ç”±å™¨çš„å·¥ä½œåŸç†"><a href="#è·¯ç”±å™¨çš„å·¥ä½œåŸç†" class="headerlink" title="è·¯ç”±å™¨çš„å·¥ä½œåŸç†"></a>è·¯ç”±å™¨çš„å·¥ä½œåŸç†</h4><p>ç†è§£è·¯ç”±å™¨å·¥ä½œåŸç†çš„ä¸€ç§æ–¹æ³•æ˜¯å°†å…¶ä¸é‚®ä»¶é€’é€ç³»ç»Ÿä½œæ¯”è¾ƒã€‚å½“æˆ‘ä»¬æƒ³å‘é€ä¸€å°ä¿¡ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¼šæ³¨æ˜æ”¶ä»¶åœ°å€ï¼Œé‚®å±€æ ¹æ®ç›®çš„åœ°ï¼ˆå¦‚åŠ å·ï¼‰å°†ä¿¡ä»¶åˆ†é…ç»™ç›¸åº”çš„è¿è¾“å·¥å…·ï¼ˆä¾‹å¦‚å¡è½¦ï¼‰ã€‚ä¿¡ä»¶åˆ°è¾¾ç›®æ ‡åŸå¸‚åï¼Œæ ¹æ®é‚®æ”¿ç¼–ç åŠå…·ä½“åœ°å€è¿›ä¸€æ­¥åˆ†å‘ï¼Œç›´è‡³é€è¾¾æŒ‡å®šåœ°å€ã€‚è‹¥æ”¶ä»¶åœ°å€ä¸å¯„ä»¶åœ°å€ä½äºåŒä¸€åŒºåŸŸï¼Œåˆ™å¯èƒ½ç›´æ¥ç”±å½“åœ°çš„é‚®é€’å‘˜å®ŒæˆæŠ•é€’ã€‚</p><p>åœ¨ç½‘ç»œä¸­è·¯ç”±æ•°æ®åŒ…çš„è¿‡ç¨‹ä¸æ­¤ç±»ä¼¼ï¼Œä½¿ç”¨ç±»ä¼¼çš„â€œè·¯å¾„â€è§„åˆ™å°†æ•°æ®åŒ…ä»æºä¸»æœºè·¯ç”±è‡³ç›®çš„ä¸»æœºã€‚å½“æ²¡æœ‰æ˜ç¡®çš„è·¯å¾„è®¾å®šæ—¶ï¼Œä¼šä½¿ç”¨é»˜è®¤è·¯ç”±ã€‚è¿™äº›è·¯ç”±ä¿¡æ¯å­˜å‚¨åœ¨è·¯ç”±è¡¨ä¸­ï¼Œç”¨äºæŒ‡å¯¼æ•°æ®åŒ…åœ¨ç½‘ç»œé—´å¯¼èˆªã€‚</p><h4 id="Hops"><a href="#Hops" class="headerlink" title="Hops"></a>Hops</h4><p>æ•°æ®åŒ…åœ¨ç½‘ç»œé—´ä¼ è¾“æ—¶ï¼Œå…¶ä¼ è¾“è·ç¦»å¯é€šè¿‡è·³æ•°æ¥å¤§è‡´è¡¡é‡ï¼Œæ¯ä¸€è·³ä»£è¡¨ä¸€æ¬¡ç»è¿‡ä¸­é—´è®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸»æœºAå’Œä¸»æœºBä¹‹é—´é€šè¿‡ä¸¤å°è·¯ç”±å™¨è¿æ¥ï¼Œåˆ™ç§°å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸¤ä¸ªHopã€‚</p><h4 id="äº¤æ¢ã€è·¯ç”±ä¸æ³›æ´ªçš„åŒºåˆ«"><a href="#äº¤æ¢ã€è·¯ç”±ä¸æ³›æ´ªçš„åŒºåˆ«" class="headerlink" title="äº¤æ¢ã€è·¯ç”±ä¸æ³›æ´ªçš„åŒºåˆ«"></a>äº¤æ¢ã€è·¯ç”±ä¸æ³›æ´ªçš„åŒºåˆ«</h4><ul><li><strong>äº¤æ¢</strong>ï¼šæŒ‡çš„æ˜¯æ¥æ”¶ã€å¤„ç†å¹¶å°†æ•°æ®è½¬å‘è‡³ç›®æ ‡è®¾å¤‡çš„è¿‡ç¨‹ã€‚</li><li><strong>è·¯ç”±</strong>ï¼šæ¶‰åŠåˆ›å»ºè·¯ç”±è¡¨çš„è¿‡ç¨‹ï¼Œä»¥ä¼˜åŒ–äº¤æ¢æ“ä½œã€‚</li><li><strong>æ³›æ´ª</strong>ï¼šåœ¨è·¯ç”±æŠ€æœ¯ä¹‹å‰ä½¿ç”¨çš„æ–¹æ³•ã€‚å¦‚æœè·¯ç”±å™¨ä¸çŸ¥é“å¦‚ä½•è½¬å‘æŸä¸ªæ•°æ®åŒ…ï¼Œåˆ™è¯¥æ•°æ®åŒ…ä¼šè¢«å‘é€åˆ°é™¤äº†æ¥æ”¶ç«¯å£å¤–çš„æ‰€æœ‰å‡ºå£é“¾è·¯ã€‚è¿™ç§æ–¹æ³•æ•ˆç‡è¾ƒä½ï¼Œä½†ç¡®ä¿äº†æ•°æ®åŒ…æœ€ç»ˆèƒ½å¤Ÿæ‰¾åˆ°å…¶è·¯å¾„ã€‚éšç€è·¯ç”±æŠ€æœ¯çš„å‘å±•ï¼Œç°åœ¨çš„ç½‘ç»œæ›´åŠ é«˜æ•ˆä¸”ç²¾ç¡®åœ°ç®¡ç†æ•°æ®ä¼ è¾“ã€‚</li></ul><h2 id="2-è·¯ç”±è¡¨"><a href="#2-è·¯ç”±è¡¨" class="headerlink" title="2 è·¯ç”±è¡¨"></a>2 è·¯ç”±è¡¨</h2><p>é€šè¿‡æŸ¥çœ‹è®¡ç®—æœºçš„è·¯ç”±è¡¨ï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£æ•°æ®åŒ…å¦‚ä½•åœ¨ç½‘ç»œä¸­è¢«å®šå‘ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pete</span>@icebox:~$ sudo route -n<br><br><span class="hljs-attribute">Kernel</span> IP routing table<br><span class="hljs-attribute">Destination</span>     Gateway         Genmask         Flags Metric Ref    Use Iface<br><span class="hljs-attribute">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>         <span class="hljs-number">192.168.224.2</span>   <span class="hljs-number">0.0.0.0</span>         UG    <span class="hljs-number">0</span>      <span class="hljs-number">0</span>        <span class="hljs-number">0</span> eth0<br><span class="hljs-attribute">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">224</span>.<span class="hljs-number">0</span>   <span class="hljs-number">0.0.0.0</span>         <span class="hljs-number">255.255.255.0</span>   U     <span class="hljs-number">1</span>      <span class="hljs-number">0</span>        <span class="hljs-number">0</span> eth0<br></code></pre></td></tr></table></figure><h4 id="ç›®æ ‡ï¼ˆDestinationï¼‰"><a href="#ç›®æ ‡ï¼ˆDestinationï¼‰" class="headerlink" title="ç›®æ ‡ï¼ˆDestinationï¼‰"></a>ç›®æ ‡ï¼ˆDestinationï¼‰</h4><p>è·¯ç”±è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç›®æ ‡IPåœ°å€ã€‚ä¾‹å¦‚ï¼Œ<code>192.168.224.0</code>è¡¨ç¤ºä»»ä½•è¯•å›¾è®¿é—®æ­¤ç½‘ç»œçš„æ•°æ®åŒ…éƒ½å°†é€šè¿‡ä»¥å¤ªç½‘æ¥å£ï¼ˆeth0ï¼‰å‘é€å‡ºå»ã€‚å¦‚æœè®¾å¤‡IPä¸º<code>192.168.224.5</code>å¹¶å¸Œæœ›ä¸åŒç½‘ç»œä¸‹çš„<code>192.168.224.7</code>é€šä¿¡ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç½‘ç»œæ¥å£eth0ã€‚</p><p>å½“ç›®æ ‡åœ°å€æ˜¾ç¤ºä¸º<code>0.0.0.0</code>æ—¶ï¼Œè¡¨ç¤ºæ²¡æœ‰æŒ‡å®šå…·ä½“åœ°å€æˆ–åœ°å€æœªçŸ¥ã€‚è¿™æ„å‘³ç€å¯¹äºåƒ<code>151.123.43.6</code>è¿™æ ·çš„å¤–éƒ¨IPåœ°å€ï¼Œç”±äºè·¯ç”±è¡¨æ— æ³•è¯†åˆ«å…¶ç›®çš„åœ°ï¼Œæ‰€ä»¥é€šè¿‡é»˜è®¤è·¯ç”±çš„ç½‘å…³è½¬å‘ã€‚</p><h4 id="ç½‘å…³ï¼ˆGatewayï¼‰"><a href="#ç½‘å…³ï¼ˆGatewayï¼‰" class="headerlink" title="ç½‘å…³ï¼ˆGatewayï¼‰"></a>ç½‘å…³ï¼ˆGatewayï¼‰</h4><p>è‹¥ç›®æ ‡ä¸åœ¨åŒä¸€ç½‘ç»œå†…ï¼Œæ•°æ®åŒ…å°†è¢«å‘é€åˆ°ç½‘å…³åœ°å€ã€‚è¯¥åœ°å€ä½œä¸ºé€šå¾€å…¶ä»–ç½‘ç»œçš„å…¥å£ç‚¹ã€‚</p><h4 id="å­ç½‘æ©ç ï¼ˆGenmaskï¼‰"><a href="#å­ç½‘æ©ç ï¼ˆGenmaskï¼‰" class="headerlink" title="å­ç½‘æ©ç ï¼ˆGenmaskï¼‰"></a>å­ç½‘æ©ç ï¼ˆGenmaskï¼‰</h4><p>å­ç½‘æ©ç ç”¨äºç¡®å®šå“ªäº›IPåœ°å€åŒ¹é…å“ªä¸ªç›®æ ‡ç½‘ç»œã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>255.255.255.0</code>ç”¨äºé™å®š<code>192.168.224.0</code>ç½‘ç»œå†…çš„ä¸»æœºèŒƒå›´ã€‚</p><h4 id="æ ‡å¿—ï¼ˆFlagsï¼‰"><a href="#æ ‡å¿—ï¼ˆFlagsï¼‰" class="headerlink" title="æ ‡å¿—ï¼ˆFlagsï¼‰"></a>æ ‡å¿—ï¼ˆFlagsï¼‰</h4><ul><li><code>UG</code>ï¼šè¡¨ç¤ºç½‘ç»œå·²å¯åŠ¨å¹¶ä¸”è¿æ¥è‡³ç½‘å…³ã€‚</li><li><code>U</code>ï¼šä»…è¡¨ç¤ºç½‘ç»œå·²å¯åŠ¨ã€‚</li></ul><h4 id="æ¥å£ï¼ˆIfaceï¼‰"><a href="#æ¥å£ï¼ˆIfaceï¼‰" class="headerlink" title="æ¥å£ï¼ˆIfaceï¼‰"></a>æ¥å£ï¼ˆIfaceï¼‰</h4><p>æŒ‡ç¤ºæ•°æ®åŒ…å°†é€šè¿‡å“ªä¸ªæ¥å£å‘é€ã€‚é€šå¸¸ï¼Œ<code>eth0</code>ä»£è¡¨ç³»ç»Ÿä¸­çš„é¦–ä¸ªä»¥å¤ªç½‘è®¾å¤‡ã€‚ </p><h2 id="3-æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„ä¼ è¾“è·¯å¾„"><a href="#3-æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„ä¼ è¾“è·¯å¾„" class="headerlink" title="3 æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„ä¼ è¾“è·¯å¾„"></a>3 æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„ä¼ è¾“è·¯å¾„</h2><h4 id="å±€åŸŸç½‘å†…çš„æ•°æ®åŒ…ä¼ è¾“"><a href="#å±€åŸŸç½‘å†…çš„æ•°æ®åŒ…ä¼ è¾“" class="headerlink" title="å±€åŸŸç½‘å†…çš„æ•°æ®åŒ…ä¼ è¾“"></a>å±€åŸŸç½‘å†…çš„æ•°æ®åŒ…ä¼ è¾“</h4><ol><li>å½“æ•°æ®åŒ…åœ¨æœ¬åœ°ç½‘ç»œä¸­ä¼ è¾“æ—¶ï¼Œé¦–å…ˆï¼Œæœ¬åœ°è®¡ç®—æœºä¼šé€šè¿‡æ¯”è¾ƒç›®çš„IPåœ°å€å’Œè‡ªèº«çš„å­ç½‘æ©ç æ¥åˆ¤æ–­ç›®æ ‡æ˜¯å¦ä½äºåŒä¸€å­ç½‘å†…ã€‚</li><li>æ•°æ®åŒ…éœ€è¦åŒ…å«æºMACåœ°å€ã€ç›®çš„MACåœ°å€ã€æºIPåœ°å€å’Œç›®çš„IPåœ°å€ã€‚åœ¨åˆå§‹é˜¶æ®µï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç›®çš„MACåœ°å€ã€‚</li><li>ä¸ºäº†æ‰¾åˆ°ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œå°†ä½¿ç”¨ARPï¼ˆAddress Resolution Protocolï¼‰åè®®ï¼Œåœ¨æœ¬åœ°ç½‘ç»œä¸Šå¹¿æ’­è¯·æ±‚ä»¥è·å–è¯¥ä¿¡æ¯ã€‚ä¸€æ—¦è·å¾—äº†ç›®çš„MACåœ°å€ï¼Œæ•°æ®åŒ…å°±å¯ä»¥æˆåŠŸå‘é€äº†ã€‚</li></ol><h4 id="è·¨ç½‘ç»œçš„æ•°æ®åŒ…ä¼ è¾“"><a href="#è·¨ç½‘ç»œçš„æ•°æ®åŒ…ä¼ è¾“" class="headerlink" title="è·¨ç½‘ç»œçš„æ•°æ®åŒ…ä¼ è¾“"></a>è·¨ç½‘ç»œçš„æ•°æ®åŒ…ä¼ è¾“</h4><ol><li>å½“ç›®æ ‡åœ°å€ä½äºå¤–éƒ¨ç½‘ç»œæ—¶ï¼Œæƒ…å†µç•¥æœ‰ä¸åŒã€‚ç”±äºç›®æ ‡ä¸åœ¨åŒä¸€å­ç½‘å†…ï¼Œæœ¬åœ°è®¡ç®—æœºæ— æ³•ç›´æ¥è·å¾—ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ARPè¿›è¡Œå¹¿æ’­æŸ¥è¯¢ã€‚</li><li>æ­¤æ—¶ï¼Œæ•°æ®åŒ…ä¼šæ ¹æ®è·¯ç”±è¡¨å¯»æ‰¾ä¸‹ä¸€è·³è·¯å¾„ã€‚å¦‚æœè·¯ç”±è¡¨ä¸­æ²¡æœ‰æ˜ç¡®çš„ç›®çš„IPåœ°å€ï¼Œåˆ™æ•°æ®åŒ…å°†è¢«å‘é€åˆ°é»˜è®¤ç½‘å…³ï¼ˆå¦ä¸€å°è·¯ç”±å™¨ï¼‰ã€‚è¿™æ—¶ï¼Œæ•°æ®åŒ…ä¸­åŒ…å«äº†æºIPåœ°å€ã€ç›®çš„IPåœ°å€ä»¥åŠæºMACåœ°å€ï¼Œä½†ä»ç„¶ç¼ºä¹ç›®çš„MACåœ°å€ã€‚å› ä¸ºMACåœ°å€ä»…åœ¨åŒä¸€ç½‘ç»œå†…éƒ¨å¯è¾¾ï¼Œæ‰€ä»¥éœ€è¦å‘é»˜è®¤ç½‘å…³å‘é€ARPè¯·æ±‚æ¥è·å–å…¶MACåœ°å€ã€‚</li><li>è·¯ç”±å™¨æ¥æ”¶æ•°æ®åŒ…åï¼Œä¼šæ£€æŸ¥å¹¶ç¡®è®¤ç›®çš„MACåœ°å€ï¼Œä½†ç”±äºè¿™å¹¶éæœ€ç»ˆç›®çš„åœ°ï¼Œå®ƒå°†ç»§ç»­ä¾æ®è·¯ç”±è¡¨è½¬å‘æ•°æ®åŒ…ï¼Œç›´åˆ°æ‰¾åˆ°èƒ½å¤Ÿå¸®åŠ©æ•°æ®åŒ…åˆ°è¾¾æœ€ç»ˆç›®çš„åœ°çš„ä¸‹ä¸€è·³IPåœ°å€ã€‚æ¯ç»è¿‡ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ—§çš„æºå’Œç›®çš„MACåœ°å€éƒ½ä¼šè¢«ç§»é™¤ï¼Œå¹¶æ›´æ–°ä¸ºæ–°çš„å¯¹åº”åœ°å€ã€‚</li><li>å½“æ•°æ®åŒ…åˆ°è¾¾ä¸ç›®æ ‡ç›¸åŒçš„å­ç½‘æ—¶ï¼Œå†æ¬¡ä½¿ç”¨ARPæ¥æŸ¥æ‰¾ç›®æ ‡ä¸»æœºçš„æœ€ç»ˆMACåœ°å€ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæ•°æ®åŒ…çš„æºIPåœ°å€å’Œç›®çš„IPåœ°å€ä¿æŒä¸å˜ï¼Œåªæœ‰MACåœ°å€éšæ¯æ¬¡è½¬å‘è€Œæ›´æ–°ã€‚</li></ol><h2 id="4-è·¯ç”±åè®®"><a href="#4-è·¯ç”±åè®®" class="headerlink" title="4 è·¯ç”±åè®®"></a>4 è·¯ç”±åè®®</h2><p>æ‰‹åŠ¨ä¸ºç½‘ç»œä¸­çš„æ¯ä¸ªè®¾å¤‡é…ç½®è·¯ç”±è¡¨å°†æ˜¯ç¹é‡çš„å·¥ä½œï¼Œå› æ­¤ä½¿ç”¨è·¯ç”±åè®®æ¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚è·¯ç”±åè®®å¸®åŠ©ç³»ç»Ÿé€‚åº”ç½‘ç»œå˜åŒ–ï¼Œé€šè¿‡å­¦ä¹ ä¸åŒçš„è·¯å¾„å¹¶åœ¨è·¯ç”±è¡¨ä¸­æ„å»ºè¿™äº›è·¯å¾„ï¼Œä»è€Œå®ç°æ•°æ®åŒ…çš„æœ‰æ•ˆè½¬å‘ã€‚ä¸»è¦çš„ä¸¤ç±»è·¯ç”±åè®®æ˜¯è·ç¦»çŸ¢é‡åè®®å’Œé“¾è·¯çŠ¶æ€åè®®ã€‚</p><h4 id="æ”¶æ•›"><a href="#æ”¶æ•›" class="headerlink" title="æ”¶æ•›"></a>æ”¶æ•›</h4><p>åœ¨ç½‘ç»œä¸­ä½¿ç”¨è·¯ç”±åè®®æ—¶ï¼Œè·¯ç”±å™¨ä¹‹é—´ä¼šç›¸äº’äº¤æ¢ä¿¡æ¯ä»¥äº†è§£æ•´ä¸ªç½‘ç»œçš„çŠ¶æ€ã€‚å½“æ‰€æœ‰è·¯ç”±å™¨å°±ç½‘ç»œæ‹“æ‰‘è¾¾æˆä¸€è‡´æ—¶ï¼Œå®ƒä»¬çš„è·¯ç”±è¡¨å°†å®Œæ•´åœ°æ˜ å°„å‡ºè¯¥æ‹“æ‰‘ç»“æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œæ”¶æ•›â€ã€‚ä¸€æ—¦ç½‘ç»œæ‹“æ‰‘å‘ç”Ÿå˜åŒ–ï¼Œæ”¶æ•›çŠ¶æ€ä¼šè¢«æš‚æ—¶æ‰“ç ´ï¼Œç›´åˆ°æ‰€æœ‰è·¯ç”±å™¨éƒ½æ›´æ–°äº†è¿™ä¸€å˜åŒ–ä¸ºæ­¢ã€‚</p><h4 id="è·ç¦»çŸ¢é‡åè®®"><a href="#è·ç¦»çŸ¢é‡åè®®" class="headerlink" title="è·ç¦»çŸ¢é‡åè®®"></a>è·ç¦»çŸ¢é‡åè®®</h4><p>è·ç¦»çŸ¢é‡åè®®é€šè¿‡è®¡ç®—æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­ä¼ è¾“æ‰€ç»è¿‡çš„è·³æ•°æ¥å†³å®šåˆ°è¾¾å…¶ä»–ç½‘ç»œçš„æœ€ä½³è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç½‘ç»œAè·ç¦»ä¸º3è·³ï¼Œè€Œç½‘ç»œBç´§é‚»ç½‘ç»œAï¼Œåˆ™å‡å®šåˆ°è¾¾ç½‘ç»œBçš„è·ç¦»ä¸º4è·³ã€‚åœ¨è·ç¦»çŸ¢é‡åè®®ä¸­ï¼Œæœ€ä½³è·¯å¾„æ˜¯æŒ‡è·³æ•°æœ€å°‘çš„é‚£æ¡è·¯å¾„ã€‚</p><p>å¯¹äºå°å‹ç½‘ç»œè€Œè¨€ï¼Œè·ç¦»çŸ¢é‡åè®®æ˜¯ä¸€ä¸ªç†æƒ³çš„é€‰æ‹©ã€‚ç„¶è€Œï¼Œéšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§ï¼Œè·¯ç”±å™¨éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥æ”¶æ•›ï¼Œå› ä¸ºå®ƒä»¬ä¼šå®šæœŸå‘æ‰€æœ‰è·¯ç”±å™¨å‘é€å®Œæ•´çš„è·¯ç”±è¡¨ã€‚æ­¤å¤–ï¼Œè·ç¦»çŸ¢é‡åè®®çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯æ•ˆç‡é—®é¢˜ï¼šå®ƒé€‰æ‹©çš„æ˜¯è·³æ•°è¾ƒå°‘è€Œéæ€»æ˜¯æœ€æœ‰æ•ˆçš„è·¯å¾„ã€‚</p><p>ä¸€ä¸ªå¸¸è§çš„è·ç¦»çŸ¢é‡åè®®æ˜¯RIPï¼ˆRouting Information Protocolï¼‰ã€‚RIPæ¯30ç§’å‘ç½‘ç»œä¸­çš„æ¯ä¸ªè·¯ç”±å™¨å¹¿æ’­ä¸€æ¬¡è·¯ç”±è¡¨ã€‚å¯¹äºå¤§å‹ç½‘ç»œæ¥è¯´ï¼Œè¿™ç§æ“ä½œå¯èƒ½æ¶ˆè€—å¤§é‡èµ„æºï¼Œå› æ­¤RIPé™åˆ¶äº†å…¶æœ€å¤§è·³æ•°ä¸º15ã€‚</p><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå°å‹ç½‘ç»œç¯å¢ƒã€‚</li><li><strong>å±€é™æ€§</strong>ï¼š<ul><li>æ”¶æ•›é€Ÿåº¦è¾ƒæ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§è§„æ¨¡ç½‘ç»œä¸­ã€‚</li><li>å¯èƒ½ä¸ä¼šé€‰æ‹©æœ€ä¼˜è·¯å¾„ï¼Œè€Œæ˜¯åŸºäºè·³æ•°è¿›è¡Œå†³ç­–ã€‚</li><li>å¦‚RIPè¿™æ ·çš„åè®®ï¼Œç”±äºæ€§èƒ½è€ƒè™‘ï¼Œå¯¹ç½‘ç»œçš„æœ€å¤§å°ºå¯¸å’Œå¤æ‚åº¦æœ‰é™åˆ¶ã€‚</li></ul></li></ul><h4 id="é“¾è·¯çŠ¶æ€åè®®"><a href="#é“¾è·¯çŠ¶æ€åè®®" class="headerlink" title="é“¾è·¯çŠ¶æ€åè®®"></a>é“¾è·¯çŠ¶æ€åè®®</h4><p>é“¾è·¯çŠ¶æ€åè®®éå¸¸é€‚åˆå¤§è§„æ¨¡ç½‘ç»œéƒ¨ç½²ï¼Œå…¶å¤æ‚åº¦é«˜äºè·ç¦»çŸ¢é‡åè®®ã€‚ç„¶è€Œï¼Œä¸€ä¸ªæ˜¾è‘—çš„ä¼˜åŠ¿æ˜¯å®ƒä»¬èƒ½å¤Ÿå¿«é€Ÿæ”¶æ•›ã€‚è¿™æ˜¯å› ä¸ºé“¾è·¯çŠ¶æ€åè®®ä¸æ˜¯å®šæœŸå‘é€æ•´ä¸ªè·¯ç”±è¡¨ï¼Œè€Œæ˜¯ä»…åœ¨é“¾è·¯çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å‘é‚»è¿‘è·¯ç”±å™¨å‘é€æ›´æ–°ä¿¡æ¯ã€‚å®ƒä»¬é‡‡ç”¨ä¸åŒçš„ç®—æ³•æ¥è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œå¹¶ä»¥å›¾å½¢æ–¹å¼æ„å»ºç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œå±•ç¤ºå„è·¯ç”±å™¨é—´çš„è¿æ¥å…³ç³»ã€‚</p><p>å¸¸è§çš„é“¾è·¯çŠ¶æ€åè®®ä¹‹ä¸€æ˜¯OSPFï¼ˆOpen Shortest Path Firstï¼‰ã€‚OSPFä»…åœ¨ç½‘ç»œå‘ç”Ÿå˜åŒ–æ—¶æ›´æ–°è·¯ç”±è¡¨ï¼Œå¹¶ä¸”ä¸è®¾è·³æ•°é™åˆ¶ã€‚</p><ul><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¤§å‹æˆ–é«˜åº¦åŠ¨æ€çš„ç½‘ç»œç¯å¢ƒã€‚</p></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>å¿«é€Ÿæ”¶æ•›ï¼Œæé«˜äº†ç½‘ç»œç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦ã€‚</li><li>é€šè¿‡å±€éƒ¨æ›´æ–°æœºåˆ¶å‡å°‘ç½‘ç»œèµ„æºæ¶ˆè€—ã€‚</li><li>æ„å»ºå®Œæ•´çš„ç½‘ç»œæ‹“æ‰‘å›¾ï¼Œä½¿å¾—è·¯å¾„é€‰æ‹©æ›´åŠ ç²¾å‡†å’Œé«˜æ•ˆã€‚</li></ul></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>åˆ©ç”¨Dijkstraç®—æ³•ç­‰è®¡ç®—æœ€çŸ­è·¯å¾„ã€‚</li><li>ä¸å—è·³æ•°é™åˆ¶ï¼Œå…è®¸æ›´çµæ´»çš„ç½‘ç»œè®¾è®¡å’Œæ‰©å±•ã€‚</li></ul></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼Œé“¾è·¯çŠ¶æ€åè®®ä¸ºå¤„ç†å¤æ‚ã€å¤§è§„æ¨¡ç½‘ç»œæä¾›äº†æœ‰æ•ˆè§£å†³æ–¹æ¡ˆã€‚é€šè¿‡ç²¾ç¡®çš„æ‹“æ‰‘ç»´æŠ¤å’Œé«˜æ•ˆçš„è·¯ç”±æ›´æ–°æœºåˆ¶ã€‚</p><h2 id="5-è¾¹ç•Œç½‘å…³åè®®BGP"><a href="#5-è¾¹ç•Œç½‘å…³åè®®BGP" class="headerlink" title="5 è¾¹ç•Œç½‘å…³åè®®BGP"></a>5 è¾¹ç•Œç½‘å…³åè®®BGP</h2><p>BGPï¼ˆè¾¹ç•Œç½‘å…³åè®®ï¼‰ï¼Œæ˜¯äº’è”ç½‘è¿è¡Œçš„åŸºç¡€ã€‚BGPç”¨äºåœ¨è‡ªæ²»ç³»ç»Ÿé—´æ”¶é›†å’Œäº¤æ¢è·¯ç”±ä¿¡æ¯ã€‚å¯ä»¥å°†è‡ªæ²»ç³»ç»Ÿç†è§£ä¸ºäº’è”ç½‘æœåŠ¡æä¾›å•†ã€å…¬å¸ã€å¤§å­¦æˆ–å…¶ä»–ç»„ç»‡ç­‰å®ä½“ã€‚æ²¡æœ‰BGPï¼Œè¿™äº›ç³»ç»Ÿå°†æ— æ³•ç›¸äº’é€šä¿¡ï¼Œå½¢æˆå­¤ç«‹çš„ä¿¡æ¯å­¤å²›ã€‚ä¸åŒäºåœ¨è‡ªæ²»ç³»ç»Ÿå†…éƒ¨è¿›è¡Œè·¯ç”±ï¼ŒBGPè´Ÿè´£åœ¨ä¸åŒè‡ªæ²»ç³»ç»Ÿä¹‹é—´è¿›è¡Œè·¯ç”±é€‰æ‹©ã€‚</p><p>å‡è®¾Aæ­£åœ¨å®¶ç”¨ç½‘ç»œä¸­ï¼Œè€ŒBåœ¨æ˜Ÿå·´å…‹å·¥ä½œï¼ŒBå¸Œæœ›ä¸Aé€šä¿¡ï¼Œå› æ­¤Bå‘é€ä¸€å°ç”µå­é‚®ä»¶ã€‚è¯¥ç½‘ç»œæ•°æ®åŒ…é¦–å…ˆé€šè¿‡æ˜Ÿå·´å…‹çš„ç½‘ç»œä¼ è¾“ï¼Œåœ¨å…¶å†…éƒ¨æ ¹æ®è·¯ç”±è¡¨è¿›è¡Œè½¬å‘ï¼Œç›´åˆ°åˆ°è¾¾æ˜Ÿå·´å…‹ç½‘ç»œçš„è¾¹ç¼˜ï¼Œå¹¶ä¼ é€’ç»™ä¸€ä¸ªè¾¹ç•Œç½‘å…³è·¯ç”±å™¨ã€‚è¿™å°è·¯ç”±å™¨åŒ…å«äº†è®©æˆ‘çš„æ•°æ®åŒ…ç¦»å¼€æ˜Ÿå·´å…‹ç½‘ç»œå¹¶ç©¿è¶Šå…¶ä»–ç½‘ç»œæ‰€éœ€çš„ä¿¡æ¯ã€‚</p><ul><li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šä¸»è¦ç”¨äºè¿æ¥ä¸åŒçš„è‡ªæ²»ç³»ç»Ÿï¼ˆASï¼‰ã€‚</p></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>æ”¯æŒå¤§è§„æ¨¡ç½‘ç»œäº’è”ï¼Œä¿ƒè¿›å…¨çƒäº’è”ç½‘é€šä¿¡ã€‚</li><li>æä¾›çµæ´»çš„ç­–ç•¥æ§åˆ¶ï¼Œä½¿å¾—ç½‘ç»œç®¡ç†å‘˜èƒ½å¤ŸåŸºäºæ€§èƒ½ã€å®‰å…¨æ€§å’Œæˆæœ¬ç­‰å› ç´ ä¼˜åŒ–è·¯ç”±é€‰æ‹©ã€‚</li></ul></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>BGPä¸ç›´æ¥æŒ‡å¯¼æ•°æ®åŒ…åœ¨è‡ªæ²»ç³»ç»Ÿå†…éƒ¨çš„ä¼ è¾“è·¯å¾„ï¼Œè€Œæ˜¯ç¡®å®šè·¨è‡ªæ²»ç³»ç»Ÿçš„æœ€ä½³è·¯ç”±ã€‚</li><li>ä½¿ç”¨TCPä½œä¸ºä¼ è¾“å±‚åè®®ï¼Œç¡®ä¿äº†è·¯ç”±ä¿¡æ¯äº¤æ¢çš„å¯é æ€§ã€‚</li><li>èƒ½å¤Ÿæºå¸¦ä¸°å¯Œçš„å±æ€§ä¿¡æ¯ï¼Œå¸®åŠ©å®ç°å¤æ‚çš„è·¯ç”±å†³ç­–ã€‚</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Subnetting</title>
    <link href="/2025/03/22/Linux-Subnetting/"/>
    <url>/2025/03/22/Linux-Subnetting/</url>
    
    <content type="html"><![CDATA[<h1 id="Subnetting"><a href="#Subnetting" class="headerlink" title="Subnetting"></a>Subnetting</h1><h2 id="1-IPv4"><a href="#1-IPv4" class="headerlink" title="1 IPv4"></a>1 IPv4</h2><p>åœ¨ç½‘ç»œä¸­ï¼Œæ¯ä¸ªä¸»æœºéƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„åœ°å€ï¼Œå³IPåœ°å€ï¼Œç”¨äºæ ‡è¯†å…¶åœ¨ç½‘ç»œä¸­çš„ä½ç½®ã€‚IPv4åœ°å€çš„å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">204.23.124.23</span><br></code></pre></td></tr></table></figure><p>æ­¤åœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç½‘ç»œéƒ¨åˆ†å’Œä¸»æœºéƒ¨åˆ†ã€‚ç½‘ç»œéƒ¨åˆ†æŒ‡æ˜äº†è¯¥åœ°å€æ‰€å±çš„ç½‘ç»œï¼Œè€Œä¸»æœºéƒ¨åˆ†åˆ™æ ‡è¯†äº†è¯¥ç½‘ç»œä¸­çš„å…·ä½“ä¸»æœºã€‚</p><p>IPv4åœ°å€è¢«ç‚¹å·åˆ†éš”ä¸ºå››ä¸ªå…«ä½å­—èŠ‚ï¼ˆoctetï¼‰ã€‚æ¯ä¸ªå…«ä½å­—èŠ‚åŒ…å«8ä¸ªæ¯”ç‰¹ï¼Œç­‰äº1å­—èŠ‚ã€‚å› æ­¤ï¼ŒIPv4åœ°å€ä¹Ÿå¯ä»¥è§†ä¸ºç”±4ä¸ªå­—èŠ‚æ„æˆã€‚åœ¨å¤„ç†å­ç½‘å’ŒIPåœ°å€æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°æ¯”ç‰¹çš„æ¦‚å¿µã€‚</p><p>è¦æŸ¥çœ‹IPåœ°å€ï¼Œå¯ä»¥ä½¿ç”¨<code>ifconfig -a</code>å‘½ä»¤ï¼š</p><p>ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pete</span>@icebox:~$ ifconfig -a<br><br><span class="hljs-attribute">eth0</span>      Link encap:Ethernet  HWaddr <span class="hljs-number">1</span>d:<span class="hljs-number">3</span>a:<span class="hljs-number">32</span>:<span class="hljs-number">24</span>:<span class="hljs-number">4</span>d:ce  <br><br>          <span class="hljs-attribute">inet</span> addr:<span class="hljs-number">192.168.1.129</span>  Bcast:<span class="hljs-number">192.168.1.255</span>  Mask:<span class="hljs-number">255.255.255.0</span><br><br>          <span class="hljs-attribute">inet6</span> addr: fd60::<span class="hljs-number">21</span>c:<span class="hljs-number">29</span>ff:fe63:<span class="hljs-number">5</span>cdc/<span class="hljs-number">64</span> Scope:Link<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°è¾“å‡ºå¯è§ï¼ŒIPv4åœ°å€æ˜¯ï¼š192.168.1.129ã€‚</p><h2 id="2-å­ç½‘"><a href="#2-å­ç½‘" class="headerlink" title="2 å­ç½‘"></a>2 å­ç½‘</h2><p>è¦åˆ¤æ–­æ˜¯å¦ä¸Pattyä½äºåŒä¸€ç½‘ç»œï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥å­ç½‘ï¼ˆsubnetworkçš„ç®€ç§°ï¼‰ã€‚å­ç½‘æ˜¯ä¸€ç»„IPåœ°å€ç›¸ä¼¼ä¸”é€šå¸¸åœ°ç†ä½ç½®ç›¸è¿‘çš„ä¸»æœºé›†åˆã€‚åœ¨åŒä¸€å­ç½‘å†…çš„ä¸»æœºé—´ä¼ è¾“æ•°æ®æ›´åŠ ç®€ä¾¿ã€‚</p><p>ä¾‹å¦‚ï¼Œæ‰€æœ‰ä»¥123.45.67å¼€å¤´çš„IPåœ°å€éƒ½å±äºåŒä¸€å­ç½‘ã€‚å¦‚æœæˆ‘çš„ä¸»æœºIPä¸º123.45.67.8ï¼Œè€ŒPattyçš„ä¸º123.45.67.9ï¼Œåˆ™å…±åŒçš„éƒ¨åˆ†å³ä¸ºç½‘ç»œå‰ç¼€ï¼Œè€Œæœ«å°¾æ•°å­—ä»£è¡¨å„è‡ªçš„ä¸»æœºæ ‡è¯†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç½‘ç»œæ˜¯ç›¸åŒçš„ã€‚</p><h4 id="å­ç½‘æ©ç "><a href="#å­ç½‘æ©ç " class="headerlink" title="å­ç½‘æ©ç "></a>å­ç½‘æ©ç </h4><p>å­ç½‘æ©ç ç”¨äºåŒºåˆ†IPåœ°å€ä¸­çš„ç½‘ç»œéƒ¨åˆ†å’Œä¸»æœºéƒ¨åˆ†ã€‚ä¸€ä¸ªå…¸å‹çš„å­ç½‘æ©ç å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">255.255.255.0</span><br></code></pre></td></tr></table></figure><p>å¸¸ç”¨ç½‘ç»œå‰ç¼€åè·Ÿæ–œæ åŠå­ç½‘æ©ç æ¥è¡¨ç¤ºå­ç½‘ï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">123.234.0.0</span>/<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h4 id="ä¸ºä½•è¿›è¡Œå­ç½‘åˆ’åˆ†ï¼Ÿ"><a href="#ä¸ºä½•è¿›è¡Œå­ç½‘åˆ’åˆ†ï¼Ÿ" class="headerlink" title="ä¸ºä½•è¿›è¡Œå­ç½‘åˆ’åˆ†ï¼Ÿ"></a>ä¸ºä½•è¿›è¡Œå­ç½‘åˆ’åˆ†ï¼Ÿ</h4><p>å­ç½‘åˆ’åˆ†ç”¨äºåˆ†å‰²ç½‘ç»œå¹¶æ§åˆ¶ç½‘ç»œå†…æµé‡ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç¼“è§£IPv4åœ°å€ç©ºé—´çš„å‹åŠ›ã€‚è¿™æ ·ï¼Œä¸åŒå­ç½‘ä¹‹é—´çš„ä¸»æœºæ— æ³•ç›´æ¥äº¤äº’ã€‚ä½†å¦‚æœæƒ³è¦è¿æ¥è‡³å…¶ä»–å­ç½‘ä¸Šçš„ä¸»æœºï¼Œæ¯”å¦‚yahoo.comï¼Œåˆ™éœ€è¦é€šè¿‡è·¯ç”±å™¨å®ç°äº’è”ã€‚åœ¨å¤§å¤šæ•°ä½¿ç”¨255.255.255.0ä½œä¸ºå­ç½‘æ©ç çš„ç½‘ç»œä¸­ï¼Œè·¯ç”±å™¨é€šå¸¸ä½äºå­ç½‘çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå¦‚192.168.1.1ã€‚æŸäº›IPåœ°å€ï¼ˆç§æœ‰ç½‘ç»œï¼‰ä¸å¯è§äºäº’è”ç½‘ï¼Œä¸ºæ­¤éœ€è¦é‡‡ç”¨NATç­‰æŠ€æœ¯ã€‚</p><h2 id="3-å­ç½‘è®¡ç®—"><a href="#3-å­ç½‘è®¡ç®—" class="headerlink" title="3 å­ç½‘è®¡ç®—"></a>3 å­ç½‘è®¡ç®—</h2><p>ç†è§£å­ç½‘æ©ç å¯¹äºç¡®å®šå­ç½‘ä¸­å¯å®¹çº³çš„ä¸»æœºæ•°é‡è‡³å…³é‡è¦ã€‚ä»¥IPåœ°å€192.168.1.0å’Œå­ç½‘æ©ç 255.255.255.0ä¸ºä¾‹ï¼Œå°†è¿™äº›æ•°å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼ï¼š</p><ul><li>IPåœ°å€ï¼š192.168.1. &#x3D; 11000000.10101000.00000001.00000001</li><li>å­ç½‘æ©ç ï¼š255.255.255.0 &#x3D; 11111111.11111111.11111111.00000000</li></ul><p>å­ç½‘æ©ç æ ‡è®°äº†IPåœ°å€ä¸­çš„ç½‘ç»œéƒ¨åˆ†ï¼ˆå¯¹åº”ä½ä¸º1ï¼‰ï¼Œè€Œä¸»æœºéƒ¨åˆ†åˆ™ç”±æœªè¢«æ ‡è®°çš„éƒ¨åˆ†è¡¨ç¤ºï¼ˆå¯¹åº”ä½ä¸º0ï¼‰ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåªæœ‰æœ€åå…«ä½å¯ä»¥å˜åŒ–ï¼Œä»£è¡¨å¯èƒ½çš„ä¸»æœºåœ°å€èŒƒå›´ã€‚</p><p>ç”±äºä¸€ä¸ªå…«ä½å­—èŠ‚æœ‰256ç§ç»„åˆï¼ˆä»00000000åˆ°11111111ï¼‰ï¼Œç†è®ºä¸Šå­˜åœ¨256ä¸ªå¯èƒ½çš„åœ°å€ã€‚ç„¶è€Œï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ’é™¤ä¸¤ä¸ªç‰¹æ®Šåœ°å€â€”â€”å…¨0å’Œå…¨1çš„åœ°å€åˆ†åˆ«ä»£è¡¨å­ç½‘åœ°å€å’Œå¹¿æ’­åœ°å€ã€‚å› æ­¤ï¼Œæœ‰æ•ˆçš„ä¸»æœºåœ°å€èŒƒå›´æ˜¯254ä¸ªã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šIPåœ°å€192.168.1.0ä¸å­ç½‘æ©ç 255.255.255.0ï¼Œæœ‰æ•ˆä¸»æœºIPåœ°å€èŒƒå›´æ˜¯ä»192.168.1.1è‡³192.168.1.254ã€‚</p><h2 id="4-CIDR"><a href="#4-CIDR" class="headerlink" title="4 CIDR"></a>4 CIDR</h2><p>æ— ç±»åˆ«åŸŸé—´è·¯ç”±ï¼ˆCIDRï¼ŒClassless Inter-Domain Routingï¼‰æä¾›äº†ä¸€ç§æ›´ä¸ºç´§å‡‘çš„å­ç½‘æ©ç è¡¨ç¤ºæ–¹æ³•ã€‚åœ¨CIDRè®°æ³•ä¸­ï¼Œä¸€ä¸ªå¦‚10.42.3.0&#x2F;255.255.255.0çš„å­ç½‘å¯ç®€åŒ–å†™ä½œ10.42.3.0&#x2F;24ï¼Œè¿™é‡Œä¸ä»…åŒ…æ‹¬äº†å­ç½‘å‰ç¼€ï¼Œä¹Ÿéšå«äº†å­ç½‘æ©ç çš„ä¿¡æ¯ã€‚</p><h4 id="IPåœ°å€ä¸CIDR"><a href="#IPåœ°å€ä¸CIDR" class="headerlink" title="IPåœ°å€ä¸CIDR"></a>IPåœ°å€ä¸CIDR</h4><p>IPåœ°å€ç”±4ä¸ªå­—èŠ‚ç»„æˆï¼Œå…±è®¡32ä½ã€‚CIDRå€¼è¡¨æ˜äº†ç”¨äºç½‘ç»œå‰ç¼€çš„ä½æ•°ã€‚ä¾‹å¦‚ï¼Œ123.12.24.0&#x2F;23è¡¨ç¤ºå‰23ä½ç”¨äºç½‘ç»œéƒ¨åˆ†ã€‚é‚£ä¹ˆï¼Œè¿™ä»£è¡¨äº†å¤šå°‘ä¸»æœºå‘¢ï¼Ÿ</p><h5 id="è®¡ç®—å¯ç”¨ä¸»æœºæ•°é‡çš„ç®€æ˜“æ–¹æ³•ï¼š"><a href="#è®¡ç®—å¯ç”¨ä¸»æœºæ•°é‡çš„ç®€æ˜“æ–¹æ³•ï¼š" class="headerlink" title="è®¡ç®—å¯ç”¨ä¸»æœºæ•°é‡çš„ç®€æ˜“æ–¹æ³•ï¼š"></a>è®¡ç®—å¯ç”¨ä¸»æœºæ•°é‡çš„ç®€æ˜“æ–¹æ³•ï¼š</h5><ul><li>ä»æ•´ä¸ªIPåœ°å€çš„æ€»ä½æ•°ï¼ˆ32ä½ï¼‰ä¸­å‡å»CIDRå€¼ï¼ˆå¦‚23ï¼‰ï¼Œå‰©ä½™9ä½ã€‚</li><li>è®¡ç®—(2^9 &#x3D; 512)ï¼Œä½†éœ€æ‰£é™¤ä¸¤ä¸ªç‰¹æ®Šåœ°å€ï¼ˆå­ç½‘åœ°å€å’Œå¹¿æ’­åœ°å€ï¼‰ï¼Œæ•…å®é™…å¯ç”¨ä¸»æœºæ•°ä¸º510ã€‚</li></ul><p>é€šè¿‡CIDRè®°æ³•ï¼Œæˆ‘ä»¬èƒ½æ›´é«˜æ•ˆåœ°è¿›è¡ŒIPåœ°å€è§„åˆ’ä¸ç®¡ç†ï¼ŒåŒæ—¶å‡†ç¡®è®¡ç®—å‡ºæ¯ä¸ªå­ç½‘å†…çš„å¯ç”¨ä¸»æœºæ•°ç›®ã€‚è¿™ç§æ–¹æ³•å¯¹äºä¼˜åŒ–ç½‘ç»œé…ç½®å’Œèµ„æºåˆ†é…è‡³å…³é‡è¦ã€‚</p><h2 id="5-NAT"><a href="#5-NAT" class="headerlink" title="5 NAT"></a>5 NAT</h2><p>ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼ŒNetwork Address Translationï¼‰ä½¿è¯¸å¦‚è·¯ç”±å™¨ä¹‹ç±»çš„è®¾å¤‡å……å½“äº’è”ç½‘ä¸ç§æœ‰ç½‘ç»œä¹‹é—´çš„ä¸­ä»‹ã€‚è¿™æ„å‘³ç€åªéœ€è¦ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€å°±å¯ä»¥ä»£è¡¨æ•´ä¸ªè®¡ç®—æœºç¾¤ç»„å¯¹å¤–è¿›è¡Œé€šä¿¡ã€‚</p><p>å¯ä»¥æŠŠNATæƒ³è±¡æˆå¤§å‹åŠå…¬å®¤ä¸­çš„æ€»æœºæ¥å¾…å‘˜ã€‚å¦‚æœæœ‰äººæƒ³è¦è”ç³»ä½ ï¼Œä»–ä»¬åªçŸ¥é“æ•´ä¸ªåŠå…¬å®¤çš„ç”µè¯å·ç ï¼Œè€Œæ¥å¾…å‘˜åˆ™æ ¹æ®è¿™ä¸ªå·ç æ‰¾åˆ°ä½ çš„åˆ†æœºå·å¹¶è½¬æ¥æ¥ç”µã€‚</p><h4 id="å·¥ä½œæµç¨‹ç¤ºä¾‹ï¼š"><a href="#å·¥ä½œæµç¨‹ç¤ºä¾‹ï¼š" class="headerlink" title="å·¥ä½œæµç¨‹ç¤ºä¾‹ï¼š"></a>å·¥ä½œæµç¨‹ç¤ºä¾‹ï¼š</h4><ul><li>å‡è®¾Pattyæƒ³è¦è¿æ¥<a href="http://www.google.com,å¥¹çš„è®¡ç®—æœºä¼šé€šè¿‡è·¯ç”±å™¨å‘é€è¯·æ±‚./">www.google.comï¼Œå¥¹çš„è®¡ç®—æœºä¼šé€šè¿‡è·¯ç”±å™¨å‘é€è¯·æ±‚ã€‚</a></li><li>è·¯ç”±å™¨æ¥æ”¶è¯¥è¯·æ±‚ï¼Œå¹¶è‡ªè¡Œå»ºç«‹ä¸google.comçš„è¿æ¥ï¼Œç„¶ååœ¨å»ºç«‹è¿æ¥åè½¬å‘Pattyçš„è¯·æ±‚ã€‚</li><li>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œè·¯ç”±å™¨ä½œä¸ºPattyå’Œ<a href="http://www.google.comä¹‹é—´çš„ä¸­ä»‹.googleæœåŠ¡å™¨ä»…èƒ½çœ‹åˆ°è·¯ç”±å™¨çš„ä¿¡æ¯,è€Œæ— æ³•è¯†åˆ«pattyçš„è®¾å¤‡./">www.google.comä¹‹é—´çš„ä¸­ä»‹ã€‚GoogleæœåŠ¡å™¨ä»…èƒ½çœ‹åˆ°è·¯ç”±å™¨çš„ä¿¡æ¯ï¼Œè€Œæ— æ³•è¯†åˆ«Pattyçš„è®¾å¤‡ã€‚</a></li></ul><p>é€šè¿‡é‡‡ç”¨NATæŠ€æœ¯ï¼Œä¸ä»…å¯ä»¥éšè—å†…éƒ¨ç½‘ç»œç»“æ„ï¼Œä¿æŠ¤å†…éƒ¨ç½‘ç»œå®‰å…¨ï¼Œè€Œä¸”æœ‰åŠ©äºèŠ‚çœå…¬ç½‘IPåœ°å€èµ„æºï¼Œä¼˜åŒ–ç½‘ç»œé…ç½®ã€‚</p><h2 id="6-IPv6"><a href="#6-IPv6" class="headerlink" title="6 IPv6"></a>6 IPv6</h2><p>æ¯ä¸€å°æ¥å…¥äº’è”ç½‘çš„è®¾å¤‡éƒ½ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„IPåœ°å€ã€‚ç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ•°å­—åŒ–æ—¶ä»£ï¼Œå¯ç”¨çš„IPåœ°å€æ•°é‡æ˜¯æœ‰é™çš„ï¼ŒIPv6æ­£æ˜¯ä¸ºäº†å…è®¸æ›´å¤šä¸»æœºè¿æ¥åˆ°äº’è”ç½‘è€Œè®¾è®¡çš„ã€‚å®ƒè™½ç„¶å¸¦æ¥äº†æ›´å¤šçš„æ”¹è¿›ï¼Œä½†å…¶é‡‡çº³è¿‡ç¨‹å´ç›¸å¯¹ç¼“æ…¢ã€‚IPv6çš„è®¾è®¡åˆè¡·å¹¶éæ˜¯è¦æ›¿ä»£IPv4ï¼Œè€Œæ˜¯ä¸ä¹‹äº’è¡¥ï¼Œå…±åŒå­˜åœ¨ã€‚</p><p>IPv6å’ŒIPv4åœ¨åè®®å±‚é¢éå¸¸ç›¸ä¼¼ï¼Œè‹¥å·²ç†Ÿæ‚‰IPv4ï¼Œåˆ™ä¸éš¾ç†è§£IPv6ã€‚ä¸¤è€…é—´æœ€æ˜¾è‘—çš„åŒºåˆ«åœ¨äºåœ°å€çš„ä¹¦å†™æ–¹å¼ã€‚å…¸å‹çš„IPv6åœ°å€æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2dde</span>:<span class="hljs-number">1235</span>:<span class="hljs-number">1256</span>:<span class="hljs-number">3</span>:<span class="hljs-number">200</span>:f8ed:fe23:<span class="hljs-number">59</span>cf<br></code></pre></td></tr></table></figure><p>IPv6é€šè¿‡æä¾›å‡ ä¹æ— é™çš„åœ°å€ç©ºé—´ï¼Œè§£å†³äº†IPv4åœ°å€èµ„æºæ¯ç«­çš„é—®é¢˜ã€‚æ­¤å¤–ï¼ŒIPv6è¿˜å¼•å…¥äº†è¯¸å¦‚ç®€åŒ–å¤´éƒ¨æ ¼å¼ã€æ”¯æŒæ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®ï¼ˆSLAACï¼‰ã€å¢å¼ºçš„å®‰å…¨æ€§ç­‰ç‰¹æ€§ï¼Œä¸ºäº’è”ç½‘çš„å‘å±•æä¾›äº†æ›´å¼ºå¤§çš„æ”¯æ’‘ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Network Basics</title>
    <link href="/2025/03/22/Linux-Network-Basics/"/>
    <url>/2025/03/22/Linux-Network-Basics/</url>
    
    <content type="html"><![CDATA[<h1 id="Network-Basics"><a href="#Network-Basics" class="headerlink" title="Network Basics"></a>Network Basics</h1><h2 id="1-ç½‘ç»œåŸºç¡€æ¦‚è¿°"><a href="#1-ç½‘ç»œåŸºç¡€æ¦‚è¿°" class="headerlink" title="1 ç½‘ç»œåŸºç¡€æ¦‚è¿°"></a>1 ç½‘ç»œåŸºç¡€æ¦‚è¿°</h2><p>åœ¨æ¢è®¨å®¶åº­ç½‘ç»œæ—¶ï¼Œæœ‰ä¸€ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š</p><ul><li><strong>ISPï¼ˆäº’è”ç½‘æœåŠ¡æä¾›å•†ï¼‰</strong>ï¼šå³ä¸ºæä¾›å®¶åº­äº’è”ç½‘æ¥å…¥çš„å…¬å¸ã€‚</li><li><strong>è·¯ç”±å™¨</strong>ï¼šè·¯ç”±å™¨ä½¿ç½‘ç»œä¸­çš„æ¯å°è®¾å¤‡éƒ½èƒ½è¿æ¥åˆ°äº’è”ç½‘ã€‚ç°ä»£è·¯ç”±å™¨é€šå¸¸æ”¯æŒæ— çº¿è¿æ¥æˆ–ä»¥å¤ªç½‘ç”µç¼†è¿æ¥ã€‚</li><li><strong>WANï¼ˆå¹¿åŸŸç½‘ï¼‰</strong>ï¼šæŒ‡ä»è·¯ç”±å™¨å»¶ä¼¸è‡³æ›´å¹¿é˜”ç½‘ç»œï¼ˆå¦‚äº’è”ç½‘ï¼‰ä¹‹é—´çš„æ‰€æœ‰ä¸­é—´ç½‘ç»œã€‚</li><li><strong>WLANï¼ˆæ— çº¿å±€åŸŸç½‘ï¼‰</strong>ï¼šè¿™æ˜¯æŒ‡è·¯ç”±å™¨ä¸å„ç§æ— çº¿è®¾å¤‡ï¼ˆä¾‹å¦‚ç¬”è®°æœ¬ç”µè„‘ï¼‰ä¹‹é—´å»ºç«‹çš„ç½‘ç»œã€‚</li><li><strong>LANï¼ˆå±€åŸŸç½‘ï¼‰</strong>ï¼šæŒ‡çš„æ˜¯è·¯ç”±å™¨ä¸æœ‰çº¿è®¾å¤‡ï¼ˆå¦‚å°å¼PCï¼‰ä¹‹é—´å½¢æˆçš„ç½‘ç»œã€‚</li><li><strong>ä¸»æœº</strong>ï¼šç½‘ç»œä¸­çš„æ¯å°è®¾å¤‡éƒ½è¢«ç§°ä¸ºä¸€ä¸ªä¸»æœºã€‚</li></ul><p>åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®å’Œä¿¡æ¯ä»¥æ•°æ®åŒ…çš„å½¢å¼è¿›è¡Œä¼ é€’ã€‚å…·ä½“çš„å‚è€ƒè¯¦ç»†çš„è®¡ç½‘è¯¾ç¨‹ã€‚</p><h2 id="2-TCP-IPæ¨¡å‹"><a href="#2-TCP-IPæ¨¡å‹" class="headerlink" title="2 TCP&#x2F;IPæ¨¡å‹"></a>2 TCP&#x2F;IPæ¨¡å‹</h2><p>TCP&#x2F;IPæ¨¡å‹æ˜¯äº’è”ç½‘çš„åŸºç¡€ï¼Œå…¶å®ç°äº†ç½‘ç»œé€šä¿¡çš„å…·ä½“æ“ä½œã€‚è¯¥æ¨¡å‹åˆ©ç”¨TCP&#x2F;IPåè®®ç°‡ï¼ˆé€šå¸¸ç®€ç§°ä¸ºTCP&#x2F;IPï¼‰æ¥å®šä¹‰æ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸­è¢«æ”¶é›†ã€å¯»å€ã€ä¼ è¾“å’Œè·¯ç”±ã€‚</p><h4 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h4><p>åº”ç”¨å±‚ä½äºTCP&#x2F;IPæ¨¡å‹çš„æœ€é¡¶å±‚ï¼Œå†³å®šäº†è®¡ç®—æœºç¨‹åºï¼ˆå¦‚ç½‘é¡µæµè§ˆå™¨ï¼‰å¦‚ä½•ä¸ä¼ è¾“å±‚æœåŠ¡äº¤äº’ä»¥æŸ¥çœ‹å‘é€æˆ–æ¥æ”¶çš„æ•°æ®ã€‚æ­¤å±‚æ¶‰åŠçš„åè®®ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>HTTP</strong>ï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ï¼šç”¨äºäº’è”ç½‘ä¸Šçš„ç½‘é¡µã€‚</li><li><strong>SMTP</strong>ï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰ï¼šç”¨äºç”µå­é‚®ä»¶çš„ä¼ è¾“ã€‚</li></ul><h4 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h4><p>ä¼ è¾“å±‚è´Ÿè´£ç¡®å®šæ•°æ®å¦‚ä½•ä¼ è¾“ï¼ŒåŒ…æ‹¬æ£€æŸ¥æ­£ç¡®çš„ç«¯å£ã€æ•°æ®å®Œæ•´æ€§ï¼Œå¹¶ç¡®ä¿æ•°æ®åŒ…çš„å‡†ç¡®äº¤ä»˜ã€‚æ­¤å±‚æ¶‰åŠçš„åè®®ä¸»è¦æœ‰ï¼š</p><ul><li><strong>TCP</strong>ï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ï¼šæä¾›å¯é çš„æ•°æ®ä¼ é€’æœåŠ¡ã€‚</li><li><strong>UDP</strong>ï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ï¼šæä¾›ä¸å¯é çš„æ•°æ®ä¼ é€’æœåŠ¡ï¼Œé€‚ç”¨äºå¯¹é€Ÿåº¦è¦æ±‚è¾ƒé«˜è€Œå¯¹å¯é æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</li></ul><h4 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h4><p>ç½‘ç»œå±‚è§„å®šäº†å¦‚ä½•åœ¨ä¸»æœºä¹‹é—´ä»¥åŠè·¨ç½‘ç»œç§»åŠ¨æ•°æ®åŒ…ã€‚å®ƒæ‰€ä½¿ç”¨çš„åè®®ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><strong>IP</strong>ï¼ˆäº’è”ç½‘åè®®ï¼‰ï¼šå¸®åŠ©å°†æ•°æ®åŒ…ä»ä¸€å°æœºå™¨è·¯ç”±åˆ°å¦ä¸€å°ã€‚</li><li><strong>ICMP</strong>ï¼ˆäº’è”ç½‘æ§åˆ¶æ¶ˆæ¯åè®®ï¼‰ï¼šç”¨äºæŠ¥å‘Šé”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©äº†è§£ç½‘ç»œçŠ¶æ€ã€‚</li></ul><h4 id="é“¾è·¯å±‚"><a href="#é“¾è·¯å±‚" class="headerlink" title="é“¾è·¯å±‚"></a>é“¾è·¯å±‚</h4><p>é“¾è·¯å±‚å®šä¹‰äº†å¦‚ä½•é€šè¿‡ç‰©ç†ç¡¬ä»¶å‘é€æ•°æ®ï¼Œä¾‹å¦‚é€šè¿‡ä»¥å¤ªç½‘ã€å…‰çº¤ç­‰åª’ä»‹è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><h2 id="3-Network-Addressing"><a href="#3-Network-Addressing" class="headerlink" title="3 Network Addressing"></a>3 Network Addressing</h2><p>åœ¨ç½‘ç»œä¸­ï¼Œä¸»æœºå’Œå…¶ä»–è®¾å¤‡é€šè¿‡MACï¼ˆåª’ä½“è®¿é—®æ§åˆ¶ï¼‰åœ°å€å’ŒIPåœ°å€æ¥è¯†åˆ«ï¼Œè€Œä¸ºäº†ä¾¿äºäººç±»è®°å¿†ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸»æœºåæ¥æ ‡è¯†ä¸€å°ä¸»æœºã€‚</p><h4 id="MACåœ°å€"><a href="#MACåœ°å€" class="headerlink" title="MACåœ°å€"></a>MACåœ°å€</h4><p>MACåœ°å€ä½œä¸ºç¡¬ä»¶åœ°å€çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåœ¨è®¾å¤‡çš„ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šæ”¹å˜ã€‚å½“æƒ³è¦æ¥å…¥äº’è”ç½‘æ—¶ï¼Œæœºå™¨éœ€è¦ä¸€ä¸ªåä¸ºç½‘ç»œæ¥å£å¡çš„è®¾å¤‡ã€‚æ­¤ç½‘ç»œé€‚é…å™¨æœ‰è‡ªå·±çš„ç¡¬ä»¶åœ°å€ï¼Œç”¨äºæ ‡è¯†æœºå™¨ã€‚ä¾‹å¦‚ï¼Œä»¥å¤ªç½‘è®¾å¤‡çš„MACåœ°å€å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š00:C4:B5:45:B2:43ã€‚MACåœ°å€åœ¨ç”Ÿäº§æ—¶åˆ†é…ç»™ç½‘ç»œé€‚é…å™¨ï¼Œæ¯ä¸ªåˆ¶é€ å•†éƒ½æœ‰ä¸€ä¸ªç»„ç»‡å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆOUIï¼‰ï¼Œç”¨äºæ ‡è¯†åˆ¶é€ å•†èº«ä»½ã€‚OUIç”±MACåœ°å€çš„å‰ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼ŒDellçš„OUIä¸º00-14-22ï¼Œå› æ­¤Dellçš„ç½‘ç»œé€‚é…å™¨å¯èƒ½å…·æœ‰è¿™æ ·çš„MACåœ°å€ï¼š00-14-22-34-B2-C2ã€‚</p><h4 id="IPåœ°å€"><a href="#IPåœ°å€" class="headerlink" title="IPåœ°å€"></a>IPåœ°å€</h4><p>IPåœ°å€ç”¨äºåœ¨ç½‘ç»œä¸­æ ‡è¯†ä¸€å°è®¾å¤‡ï¼Œå®ƒç‹¬ç«‹äºç¡¬ä»¶ï¼Œå¹¶ä¸”æ ¹æ®ä½¿ç”¨çš„æ˜¯IPv4è¿˜æ˜¯IPv6ï¼Œå…¶è¯­æ³•å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å¯¹äºIPv4ï¼Œä¸€ä¸ªå…¸å‹çš„IPåœ°å€å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š10.24.12.4ã€‚IPåœ°å€ä¸ç½‘ç»œçš„è½¯ä»¶éƒ¨åˆ†ä¸€èµ·ä½¿ç”¨ã€‚æ¯å½“ç³»ç»Ÿè¿æ¥åˆ°äº’è”ç½‘æ—¶ï¼Œéƒ½åº”è¯¥æœ‰ä¸€ä¸ªIPåœ°å€ã€‚å¦‚æœç½‘ç»œå‘ç”Ÿå˜åŒ–ï¼ŒIPåœ°å€ä¹Ÿå¯èƒ½éšä¹‹å˜åŒ–ï¼Œå¹¶åœ¨æ•´ä¸ªäº’è”ç½‘èŒƒå›´å†…ä¿æŒå”¯ä¸€æ€§ï¼ˆä½†æ¶‰åŠåˆ°NATçš„è¯ï¼Œå¹¶ä¸æ€»æ˜¯å¦‚æ­¤ï¼‰ã€‚</p><p>è¦åœ¨ç½‘ç»œé—´ä¼ è¾“æ•°æ®åŒ…éœ€è¦è½¯ä»¶å’Œç¡¬ä»¶çš„ååŒå·¥ä½œï¼Œå› æ­¤æœ‰ä¸¤ç§æ ‡è¯†ç¬¦ï¼šMACï¼ˆç¡¬ä»¶ï¼‰å’ŒIPï¼ˆè½¯ä»¶ï¼‰ã€‚</p><h4 id="ä¸»æœºå"><a href="#ä¸»æœºå" class="headerlink" title="ä¸»æœºå"></a>ä¸»æœºå</h4><p>è¯†åˆ«æœºå™¨çš„å¦ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ä¸»æœºåã€‚ä¸»æœºåå°†IPåœ°å€ç»‘å®šåˆ°ä¸€ä¸ªäººç±»å¯è¯»çš„åå­—ä¸Šã€‚è¿™æ„å‘³ç€ï¼Œä¸éœ€è¦è®°ä½å¦‚192.12.41.4è¿™æ ·çš„æ•°å­—åºåˆ—ï¼Œè€Œæ˜¯åªéœ€è¦è®°ä½ç±»ä¼¼myhost.comè¿™æ ·çš„åå­—å³å¯ã€‚è¿™ç§æ–¹å¼å¤§å¤§ç®€åŒ–äº†ç½‘ç»œé…ç½®å’Œç®¡ç†çš„å¤æ‚åº¦ã€‚</p><h2 id="4-åº”ç”¨å±‚"><a href="#4-åº”ç”¨å±‚" class="headerlink" title="4 åº”ç”¨å±‚"></a>4 åº”ç”¨å±‚</h2><p>å‡è®¾éœ€è¦é€šè¿‡ç”µå­é‚®ä»¶å®¢æˆ·ç«¯å‘Pattyå‘é€ä¸€å°é‚®ä»¶ã€‚å°†éå†TCP&#x2F;IPåè®®æ ˆçš„æ¯ä¸€å±‚æ¥æ‰§è¡Œè¿™ä¸€æ“ä½œã€‚</p><p>æ•°æ®åŒ…ç”¨äºåœ¨ç½‘ç»œä¸­ä¼ è¾“æ•°æ®ï¼Œå®ƒç”±å¤´éƒ¨å’Œè´Ÿè½½ç»„æˆã€‚å¤´éƒ¨åŒ…å«äº†å…³äºæ•°æ®åŒ…å»å‘åŠå…¶æ¥æºçš„ä¿¡æ¯ï¼Œè€Œè´Ÿè½½åˆ™æ˜¯å®é™…è¢«ä¼ è¾“çš„æ•°æ®ã€‚å½“æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­ä¼ è¾“æ—¶ï¼Œæ¯ä¸€å±‚éƒ½ä¼šåœ¨æ•°æ®åŒ…çš„å¤´éƒ¨æ·»åŠ ä¸€äº›ä¿¡æ¯ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„å±‚å¯¹äºâ€œæ•°æ®åŒ…â€æœ‰ä¸åŒçš„æœ¯è¯­ã€‚åœ¨ä¼ è¾“å±‚ï¼Œå®é™…ä¸Šå°†æ•°æ®å°è£…æˆæ®µï¼›è€Œåœ¨é“¾è·¯å±‚ï¼Œç§°å…¶ä¸ºå¸§ã€‚ä½†åªéœ€è®°ä½ï¼Œâ€œæ•°æ®åŒ…â€å¯ä»¥æ³›æŒ‡è¿™ä¸€æ¦‚å¿µã€‚</p><h4 id="åº”ç”¨å±‚å·¥ä½œæµç¨‹"><a href="#åº”ç”¨å±‚å·¥ä½œæµç¨‹" class="headerlink" title="åº”ç”¨å±‚å·¥ä½œæµç¨‹"></a>åº”ç”¨å±‚å·¥ä½œæµç¨‹</h4><p>ä¸€åˆ‡å§‹äºåº”ç”¨å±‚ã€‚åº”ç”¨å±‚é€šè¿‡æŒ‡å®šç«¯å£ä¸ä¼ è¾“å±‚é€šä¿¡ï¼Œå¹¶é€šè¿‡æ­¤ç«¯å£å‘é€æ•°æ®ã€‚</p><ul><li><strong>æ•°æ®å°è£…</strong>ï¼šå½“ç”¨æˆ·å°è¯•å‘é€ä¸€å°é‚®ä»¶æ—¶ï¼Œåº”ç”¨å±‚è´Ÿè´£å¯¹é‚®ä»¶å†…å®¹è¿›è¡Œåˆæ­¥å°è£…ã€‚</li><li><strong>ç«¯å£æŒ‡å®š</strong>ï¼šä¸ºäº†å®ç°é‚®ä»¶çš„å‘é€ï¼Œåº”ç”¨å±‚é€‰æ‹©é€šè¿‡æŒ‡å®šç«¯å£ï¼ˆå¦‚SMTPä½¿ç”¨çš„25å·ç«¯å£ï¼‰ä¸ä¸‹ä¸€å±‚ï¼ˆå³ä¼ è¾“å±‚ï¼‰è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>æ•°æ®ä¼ è¾“</strong>ï¼šä¸€æ—¦ç«¯å£è¿æ¥å»ºç«‹ï¼Œé‚®ä»¶æ•°æ®ä¾¿é€šè¿‡è¯¥ç«¯å£å‘ä¸‹ä¼ é€åˆ°ä¼ è¾“å±‚ï¼Œå‡†å¤‡è¿›ä¸€æ­¥å°è£…å¹¶ä¼ è¾“ã€‚</li></ul><h2 id="5-ä¼ è¾“å±‚"><a href="#5-ä¼ è¾“å±‚" class="headerlink" title="5 ä¼ è¾“å±‚"></a>5 ä¼ è¾“å±‚</h2><p>ä¼ è¾“å±‚è´Ÿè´£ä»¥ç½‘ç»œå¯è¯»çš„æ–¹å¼å¸®åŠ©æˆ‘ä»¬ä¼ è¾“æ•°æ®ã€‚å®ƒå°†æ•°æ®åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ä»¥ä¾¿äºåœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¹¶åœ¨æ¥æ”¶ç«¯æŒ‰æ­£ç¡®çš„é¡ºåºé‡ç»„ã€‚è¿™äº›éƒ¨åˆ†è¢«ç§°ä¸ºæ®µï¼Œä½¿å¾—æ•°æ®çš„ä¼ è¾“æ›´ä¸ºä¾¿æ·ã€‚</p><h4 id="ç«¯å£"><a href="#ç«¯å£" class="headerlink" title="ç«¯å£"></a>ç«¯å£</h4><p>å°½ç®¡é€šè¿‡IPåœ°å€å¯ä»¥å°†æ•°æ®å‘é€åˆ°ç‰¹å®šä½ç½®ï¼Œä½†è¿™äº›åœ°å€ä¸è¶³ä»¥å°†æ•°æ®å®šå‘è‡³å…·ä½“çš„è¿›ç¨‹æˆ–æœåŠ¡ã€‚ä¾‹å¦‚ï¼ŒHTTPæœåŠ¡æ˜¯é€šè¿‡ç«¯å£è¿›è¡Œé€šä¿¡çš„ã€‚è‹¥è¦å‘é€ç½‘é¡µæ•°æ®ï¼Œåˆ™éœ€é€šè¿‡HTTPç«¯å£ï¼ˆ80å·ç«¯å£ï¼‰è¿›è¡Œã€‚é™¤äº†å½¢æˆæ®µä¹‹å¤–ï¼Œä¼ è¾“å±‚è¿˜ä¼šå°†æºç«¯å£å’Œç›®çš„ç«¯å£é™„åŠ åˆ°æ®µä¸Šï¼Œè¿™æ ·å½“æ¥æ”¶æ–¹æ¥æ”¶åˆ°æœ€ç»ˆçš„æ•°æ®åŒ…æ—¶ï¼Œå°±çŸ¥é“åº”ä½¿ç”¨å“ªä¸ªç«¯å£ã€‚</p><h4 id="UDPåè®®"><a href="#UDPåè®®" class="headerlink" title="UDPåè®®"></a>UDPåè®®</h4><p>UDPæ˜¯ä¸€ç§ä¸å¯é çš„æ•°æ®ä¼ è¾“æ–¹æ³•ï¼Œå®é™…ä¸Šå®ƒå¹¶ä¸ä¿è¯æ‰€æœ‰åŸå§‹æ•°æ®éƒ½èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚å®ƒä¸»è¦åº”ç”¨åœ¨ä¸€äº›å¯¹é€Ÿåº¦æœ‰è¦æ±‚çš„åº”ç”¨ä¸Šï¼Œä¾‹å¦‚åœ¨åª’ä½“æµä¼ è¾“ä¸­ï¼Œä¸¢å¤±ä¸€äº›å¸§ä»¥æ¢å–æ›´å¿«çš„æ•°æ®ä¼ è¾“é€Ÿåº¦æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p><h4 id="TCPåè®®"><a href="#TCPåè®®" class="headerlink" title="TCPåè®®"></a>TCPåè®®</h4><p>TCPæä¾›äº†ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„æ•°æ®æµã€‚TCPåˆ©ç”¨ç«¯å£åœ¨ä¸»æœºä¹‹é—´å‘é€æ•°æ®ã€‚ä¸€ä¸ªåº”ç”¨ä¼šåœ¨å…¶ä¸»æœºçš„ä¸€ä¸ªç«¯å£ä¸è¿œç¨‹ä¸»æœºä¸Šçš„å¦ä¸€ä¸ªç«¯å£ä¹‹é—´å»ºç«‹è¿æ¥ã€‚ä¸ºäº†å»ºç«‹è¿™ç§è¿æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨TCPä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯ï¼ˆè¿æ¥è¿›ç¨‹ï¼‰å‘æœåŠ¡å™¨å‘é€SYNæ®µè¯·æ±‚è¿æ¥ã€‚</li><li>æœåŠ¡å™¨å‘é€SYN-ACKæ®µç»™å®¢æˆ·ç«¯ï¼Œç¡®è®¤è¿æ¥è¯·æ±‚ã€‚</li><li>å®¢æˆ·ç«¯å‘é€ACKæ®µç»™æœåŠ¡å™¨ï¼Œç¡®è®¤æœåŠ¡å™¨çš„è¿æ¥è¯·æ±‚ã€‚</li></ul><p>ä¸€æ—¦å»ºç«‹äº†è¿æ¥ï¼Œæ•°æ®ä¾¿å¯ä»¥é€šè¿‡TCPè¿æ¥äº¤æ¢ã€‚æ•°æ®è¢«åˆ†æˆä¸åŒçš„æ®µå¹¶é€šè¿‡TCPåºåˆ—å·è¿›è¡Œè¿½è¸ªï¼Œç¡®ä¿å®ƒä»¬åœ¨äº¤ä»˜æ—¶èƒ½å¤Ÿæ­£ç¡®æ’åºã€‚åœ¨ç”µå­é‚®ä»¶ç¤ºä¾‹ä¸­ï¼Œä¼ è¾“å±‚å°†ç›®çš„ç«¯å£ï¼ˆ25å·ç«¯å£ï¼‰é™„åŠ åˆ°æºä¸»æœºçš„æºç«¯å£ä¸Šã€‚</p><h4 id="ä¼ è¾“å±‚å·¥ä½œæµç¨‹"><a href="#ä¼ è¾“å±‚å·¥ä½œæµç¨‹" class="headerlink" title="ä¼ è¾“å±‚å·¥ä½œæµç¨‹"></a>ä¼ è¾“å±‚å·¥ä½œæµç¨‹</h4><ul><li><strong>æ•°æ®åˆ†å‰²</strong>ï¼šä¼ è¾“å±‚å°†åº”ç”¨å±‚ä¼ æ¥çš„æ•°æ®åˆ†å‰²æˆæ˜“äºç®¡ç†çš„éƒ¨åˆ†ï¼ˆæ®µï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªæ®µåˆ†é…ç›¸åº”çš„æºç«¯å£å’Œç›®çš„ç«¯å£ä¿¡æ¯ã€‚</li><li><strong>ç«¯å£é€šä¿¡</strong>ï¼šé€šè¿‡æŒ‡å®šç«¯å£ï¼ˆå¦‚SMTPä½¿ç”¨çš„25å·ç«¯å£ï¼‰ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ— è¯¯åœ°å‘é€è‡³ç›®æ ‡æœåŠ¡æˆ–è¿›ç¨‹ã€‚</li><li><strong>å¯é æ€§ä¿éšœ</strong>ï¼šé‡‡ç”¨TCPåè®®æ—¶ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹å¯é è¿æ¥ï¼Œå¹¶ä½¿ç”¨åºåˆ—å·ä¿è¯æ•°æ®æ®µæŒ‰åºé‡ç»„ï¼Œä»è€Œæ”¯æŒé«˜æ•ˆä¸”æœ‰åºçš„æ•°æ®ä¼ è¾“ã€‚</li></ul><h2 id="6-ç½‘ç»œå±‚"><a href="#6-ç½‘ç»œå±‚" class="headerlink" title="6 ç½‘ç»œå±‚"></a>6 ç½‘ç»œå±‚</h2><p>ç½‘ç»œå±‚è´Ÿè´£å†³å®šä»æºä¸»æœºåˆ°ç›®æ ‡ä¸»æœºçš„æ•°æ®åŒ…è·¯ç”±ã€‚äº’è”ç½‘å®é™…ä¸Šç”±ä¼—å¤šç½‘ç»œç»„æˆã€‚è¿™äº›æ„æˆäº’è”ç½‘çš„å°å‹ç½‘ç»œè¢«ç§°ä¸ºå­ç½‘ã€‚æ‰€æœ‰å­ç½‘ä»¥æŸç§æ–¹å¼ç›¸äº’è¿æ¥ã€‚IPåœ°å€å®šä¹‰äº†é€šå¾€ä¸åŒå­ç½‘çš„è§„åˆ™ã€‚</p><p>åœ¨ç½‘ç»œå±‚ä¸­ï¼Œå®ƒæ¥æ”¶æ¥è‡ªä¼ è¾“å±‚çš„æ®µï¼Œå¹¶å°†æ­¤æ®µå°è£…æˆä¸€ä¸ªIPæ•°æ®åŒ…ï¼Œç„¶ååœ¨æ•°æ®åŒ…å¤´éƒ¨é™„åŠ æºä¸»æœºå’Œç›®æ ‡ä¸»æœºçš„IPåœ°å€ã€‚æ­¤æ—¶ï¼Œæ•°æ®åŒ…åŒ…å«äº†å…¶ç›®çš„åœ°ä¿¡æ¯åŠå…¶æ¥æºä¿¡æ¯ã€‚éšåï¼Œè¯¥æ•°æ®åŒ…è¢«å‘é€è‡³ç‰©ç†ç¡¬ä»¶å±‚ã€‚</p><h4 id="ç½‘ç»œå±‚å·¥ä½œæµç¨‹"><a href="#ç½‘ç»œå±‚å·¥ä½œæµç¨‹" class="headerlink" title="ç½‘ç»œå±‚å·¥ä½œæµç¨‹"></a>ç½‘ç»œå±‚å·¥ä½œæµç¨‹</h4><ul><li><strong>è·¯ç”±é€‰æ‹©</strong>ï¼šç½‘ç»œå±‚ç¡®å®šæ•°æ®åŒ…ä»æºä¸»æœºåˆ°ç›®çš„ä¸»æœºçš„æœ€ä½³è·¯å¾„ï¼Œå³ä½¿è·¨è¶Šå¤šä¸ªå­ç½‘ã€‚</li><li><strong>æ•°æ®å°è£…</strong>ï¼šæ¥æ”¶åˆ°æ¥è‡ªä¼ è¾“å±‚çš„æ®µåï¼Œç½‘ç»œå±‚å°†å…¶å°è£…ä¸ºIPæ•°æ®åŒ…ï¼Œå¹¶åœ¨æ•°æ®åŒ…å¤´æ·»åŠ å¿…è¦çš„æºå’Œç›®çš„IPåœ°å€ä¿¡æ¯ã€‚</li><li><strong>ç‰©ç†å±‚ä¼ é€’</strong>ï¼šå®Œæˆå°è£…å’Œåœ°å€é™„åŠ åï¼Œæ•°æ®åŒ…å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å‘ä¸‹ä¼ é€’è‡³ç‰©ç†å±‚è¿›è¡Œå®é™…ä¼ è¾“ã€‚</li></ul><h2 id="7-é“¾è·¯å±‚"><a href="#7-é“¾è·¯å±‚" class="headerlink" title="7 é“¾è·¯å±‚"></a>7 é“¾è·¯å±‚</h2><p>åœ¨TCP&#x2F;IPæ¨¡å‹çš„æœ€åº•å±‚æ˜¯é“¾è·¯å±‚ï¼Œè¿™ä¸€å±‚ä¸ç¡¬ä»¶ç´§å¯†ç›¸å…³ã€‚</p><p>åœ¨é“¾è·¯å±‚ä¸­ï¼Œæ•°æ®åŒ…è¢«è¿›ä¸€æ­¥å°è£…æˆå¸§ã€‚å¸§å¤´é™„åŠ äº†æºå’Œç›®æ ‡ä¸»æœºçš„MACåœ°å€ã€æ ¡éªŒå’Œä»¥åŠæ•°æ®åŒ…åˆ†éš”ç¬¦ï¼Œä»¥ä¾¿æ¥æ”¶æ–¹èƒ½å¤Ÿè¯†åˆ«æ•°æ®åŒ…çš„ç»“æŸä½ç½®ã€‚</p><p>åœ¨æ•°æ®é“¾è·¯å±‚å°è£…çš„é€‚åˆï¼Œé¦–å…ˆé“¾è·¯å±‚å°†æºMACåœ°å€æ·»åŠ åˆ°å¸§å¤´ï¼Œä½†åŒæ ·éœ€è¦çŸ¥é“ç›®æ ‡ä¸»æœºçš„MACåœ°å€ã€‚ä½¿ç”¨ARPåè®®å¯ä»¥è·å–ç›®æ ‡ä¸»æœºçš„MACåœ°å€ã€‚</p><h4 id="ARPï¼ˆåœ°å€è§£æåè®®ï¼‰"><a href="#ARPï¼ˆåœ°å€è§£æåè®®ï¼‰" class="headerlink" title="ARPï¼ˆåœ°å€è§£æåè®®ï¼‰"></a>ARPï¼ˆåœ°å€è§£æåè®®ï¼‰</h4><p>ARPç”¨äºæŸ¥æ‰¾ä¸IPåœ°å€å…³è”çš„MACåœ°å€ï¼Œå¹¶åœ¨åŒä¸€ç½‘ç»œå†…éƒ¨ä½¿ç”¨ã€‚å¦‚æœç›®æ ‡ä¸åœ¨åŒä¸€ç½‘ç»œä¸Šï¼Œä¼šä½¿ç”¨è·¯ç”±ç³»ç»Ÿç¡®å®šä¸‹ä¸€ä¸ªæ¥æ”¶æ•°æ®åŒ…çš„è·¯ç”±å™¨ã€‚ä¸€æ—¦è¿›å…¥ç›¸åŒç½‘ç»œï¼Œå°±å¯ä»¥ä½¿ç”¨ARPã€‚</p><p>å½“å¤„äºåŒä¸€ç½‘ç»œæ—¶ï¼Œç³»ç»Ÿé¦–å…ˆæŸ¥è¯¢å­˜å‚¨æœ‰IPåœ°å€ä¸MACåœ°å€å¯¹åº”å…³ç³»çš„ARPæŸ¥æ‰¾è¡¨ã€‚å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„å€¼ï¼Œåˆ™ä¼šå‘é€ä¸€ä¸ªå¹¿æ’­æ¶ˆæ¯ï¼Œé€šè¿‡ARPåè®®æŸ¥è¯¢å“ªä¸ªä¸»æœºæ‹¥æœ‰IPåœ°å€10.10.1.4ã€‚å¹¿æ’­æ¶ˆæ¯æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¶ˆæ¯ï¼Œå®ƒä¼šè¢«å‘é€ç»™ç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºã€‚ä»»ä½•å…·æœ‰è¯·æ±‚IPåœ°å€çš„æœºå™¨éƒ½ä¼šä»¥åŒ…å«IPåœ°å€å’ŒMACåœ°å€çš„ARPå“åº”æŠ¥æ–‡å›å¤ã€‚</p><p>æœ‰äº†æ‰€éœ€çš„å…¨éƒ¨æ•°æ®ï¼ŒåŒ…æ‹¬IPåœ°å€å’ŒMACåœ°å€ï¼Œé“¾è·¯å±‚é€šè¿‡ç½‘ç»œæ¥å£å¡è½¬å‘æ­¤å¸§ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡æ‰€åœ¨çš„ç½‘ç»œã€‚</p><h3 id="æ•°æ®åŒ…éå†è¿‡ç¨‹"><a href="#æ•°æ®åŒ…éå†è¿‡ç¨‹" class="headerlink" title="æ•°æ®åŒ…éå†è¿‡ç¨‹"></a>æ•°æ®åŒ…éå†è¿‡ç¨‹</h3><p>ä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆçš„æ•°æ®åŒ…éå†è¿‡ç¨‹ï¼š</p><ul><li><strong>åº”ç”¨å±‚</strong>ï¼šPeteå‘é€ä¸€å°é‚®ä»¶ç»™Pattyï¼Œè¿™äº›æ•°æ®ä¼ é€’è‡³ä¼ è¾“å±‚ã€‚</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šå°†æ•°æ®å°è£…è¿›TCPæˆ–UDPå¤´éƒ¨å½¢æˆæ®µï¼Œå¹¶é™„åŠ ä¸Šç›®æ ‡å’Œæºç«¯å£å·ï¼Œç„¶åä¼ é€’ç»™ç½‘ç»œå±‚ã€‚</li><li><strong>ç½‘ç»œå±‚</strong>ï¼šå°†TCPæ®µå°è£…è¿›IPæ•°æ®åŒ…ï¼Œå¹¶é™„åŠ ä¸Šæºå’Œç›®æ ‡IPåœ°å€ã€‚æ¥ç€ï¼Œæ•°æ®åŒ…è¢«å‘ä¸‹ä¼ é€’è‡³é“¾è·¯å±‚ã€‚</li><li><strong>é“¾è·¯å±‚</strong>ï¼šæ•°æ®åŒ…åˆ°è¾¾ç‰©ç†ç¡¬ä»¶å¹¶è¢«å°è£…è¿›å¸§ä¸­ï¼ŒåŒæ—¶æ·»åŠ æºå’Œç›®æ ‡MACåœ°å€ã€‚</li><li><strong>æ¥æ”¶ç«¯é“¾è·¯å±‚</strong>ï¼šPattyçš„è®¾å¤‡é€šè¿‡ç‰©ç†å±‚æ¥æ”¶åˆ°æ•°æ®å¸§ï¼Œæ£€æŸ¥æ•°æ®å®Œæ•´æ€§åè§£å°è£…å¸§å†…å®¹ï¼Œå¹¶å°†IPæ•°æ®åŒ…ä¼ é€’ç»™ç½‘ç»œå±‚ã€‚</li><li><strong>æ¥æ”¶ç«¯ç½‘ç»œå±‚</strong>ï¼šè¯»å–æ•°æ®åŒ…ä¸­çš„æºå’Œç›®æ ‡IPåœ°å€ä¿¡æ¯ï¼Œç¡®è®¤æ˜¯å¦åŒ¹é…æœ¬åœ°IPåœ°å€ã€‚è‹¥åŒ¹é…ï¼Œåˆ™è§£å°è£…æ•°æ®åŒ…å¹¶å°†æ®µä¼ é€’ç»™ä¼ è¾“å±‚ã€‚</li><li><strong>æ¥æ”¶ç«¯ä¼ è¾“å±‚</strong>ï¼šè§£å°è£…æ®µï¼Œæ ¹æ®TCPæˆ–UDPç«¯å£å·å»ºç«‹ä¸åº”ç”¨å±‚çš„è¿æ¥ã€‚</li><li><strong>æ¥æ”¶ç«¯åº”ç”¨å±‚</strong>ï¼šä»ä¼ è¾“å±‚æ¥æ”¶æŒ‡å®šç«¯å£çš„æ•°æ®ï¼Œå¹¶ä»¥æœ€ç»ˆçš„ç”µå­é‚®ä»¶å½¢å¼å±•ç¤ºç»™Pattyã€‚</li></ul><h2 id="8-DHCPæ¦‚è¿°"><a href="#8-DHCPæ¦‚è¿°" class="headerlink" title="8 DHCPæ¦‚è¿°"></a>8 DHCPæ¦‚è¿°</h2><p>DHCPï¼ˆåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰è´Ÿè´£ä¸ºè®¾å¤‡åˆ†é…IPåœ°å€ã€å­ç½‘æ©ç å’Œç½‘å…³ã€‚ä»¥æ‰‹æœºä¸ºä¾‹ï¼Œè‹¥è¦è·å–ç”µè¯å·ç ä»¥ä¾¿ä¸ä»–äººé€šè¯ï¼Œéœ€è¦è”ç³»è¿è¥å•†å¹¶è·å¾—ä¸€ä¸ªå·ç ã€‚åªè¦æŒ‰æ—¶ç¼´è´¹ï¼Œå°±å¯ä»¥æŒç»­ä½¿ç”¨è¯¥å·ç ã€‚åœ¨æ­¤æ¡ˆä¾‹ä¸­ï¼ŒDHCPæ‰®æ¼”ç€è¿è¥å•†çš„è§’è‰²ï¼Œå®ƒèµ‹äºˆè®¾å¤‡ä¸€ä¸ªIPåœ°å€ï¼Œä½¿å…¶èƒ½å¤Ÿä¸å…¶ä»–IPåœ°å€é€šä¿¡ã€‚æ­¤å¤–ï¼ŒIPåœ°å€æ˜¯ä»¥ç§Ÿç”¨å½¢å¼æä¾›çš„ï¼Œå…·æœ‰ä¸€å®šçš„æœ‰æ•ˆæœŸï¼Œåˆ°æœŸåæ ¹æ®ç§Ÿèµè®¾ç½®è¿›è¡Œç»­æœŸã€‚</p><p>DHCPçš„ä¼˜åŠ¿ä¼—å¤šï¼Œå®ƒä½¿å¾—ç½‘ç»œç®¡ç†å‘˜æ— éœ€æ‰‹åŠ¨åˆ†é…IPåœ°å€ï¼Œå¹¶é˜²æ­¢äº†IPåœ°å€é‡å¤çš„é”™è¯¯é…ç½®ã€‚æ¯ä¸ªç‰©ç†ç½‘ç»œåº”æ‹¥æœ‰è‡ªå·±çš„DHCPæœåŠ¡å™¨ï¼Œä»¥ä¾¿ä¸»æœºè¯·æ±‚IPåœ°å€ã€‚åœ¨å®¶åº­ç¯å¢ƒä¸­ï¼Œè·¯ç”±å™¨é€šå¸¸å……å½“DHCPæœåŠ¡å™¨çš„è§’è‰²ã€‚</p><p>DHCPè·å–åŠ¨æ€ä¸»æœºä¿¡æ¯çš„ç®€åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><strong>DHCPå‘ç°</strong>ï¼šå®¢æˆ·ç«¯å¹¿æ’­ä¸€æ¡æ¶ˆæ¯æœç´¢DHCPæœåŠ¡å™¨ã€‚</li><li><strong>DHCPæä¾›</strong>ï¼šç½‘ç»œä¸­çš„DHCPæœåŠ¡å™¨å›å¤ä¸€æ¡æä¾›æ¶ˆæ¯ï¼ŒåŒ…å«DHCPç§Ÿçº¦æ—¶é—´ã€å­ç½‘æ©ç ã€IPåœ°å€ç­‰ä¿¡æ¯çš„åŒ…ã€‚</li><li><strong>DHCPè¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯å¹¿æ’­å¦ä¸€æ¡æ¶ˆæ¯é€šçŸ¥æ‰€æœ‰DHCPæœåŠ¡å™¨å…¶æ¥å—çš„æè®®ã€‚</li><li><strong>DHCPç¡®è®¤</strong>ï¼šæœåŠ¡å™¨å‘é€ç¡®è®¤ä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Network Sharing</title>
    <link href="/2025/03/22/Linux-Network-Sharing/"/>
    <url>/2025/03/22/Linux-Network-Sharing/</url>
    
    <content type="html"><![CDATA[<h1 id="Networking-Sharing"><a href="#Networking-Sharing" class="headerlink" title="Networking Sharing"></a>Networking Sharing</h1><h2 id="1-æ–‡ä»¶å…±äº«æ¦‚è¿°"><a href="#1-æ–‡ä»¶å…±äº«æ¦‚è¿°" class="headerlink" title="1 æ–‡ä»¶å…±äº«æ¦‚è¿°"></a>1 æ–‡ä»¶å…±äº«æ¦‚è¿°</h2><p>åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œç½‘ç»œä¸­çš„è®¡ç®—æœºé€šå¸¸ä¸æ­¢ä¸€å°ã€‚å½“éœ€è¦åœ¨è¿™äº›è®¾å¤‡é—´ä¼ è¾“æ•°æ®æ—¶ï¼Œç›¸è¾ƒäºä½¿ç”¨USBé©±åŠ¨å™¨æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶ï¼Œåˆ©ç”¨ç½‘ç»œæ–‡ä»¶å…±äº«è¿›è¡Œæ•°æ®ä¼ è¾“é€šå¸¸æ˜¯æ›´ä¸ºé«˜æ•ˆçš„æ–¹æ³•ã€‚</p><h4 id="ç®€å•æ–‡ä»¶å…±äº«å·¥å…·ï¼šSCPå‘½ä»¤"><a href="#ç®€å•æ–‡ä»¶å…±äº«å·¥å…·ï¼šSCPå‘½ä»¤" class="headerlink" title="ç®€å•æ–‡ä»¶å…±äº«å·¥å…·ï¼šSCPå‘½ä»¤"></a>ç®€å•æ–‡ä»¶å…±äº«å·¥å…·ï¼šSCPå‘½ä»¤</h4><p><code>scp</code>ï¼ˆSecure Copyï¼‰å‘½ä»¤æ˜¯ä¸€ç§ç®€ä¾¿çš„æ–‡ä»¶å…±äº«å·¥å…·ã€‚å®ƒä¸<code>cp</code>å‘½ä»¤ç›¸ä¼¼ï¼Œä½†å…è®¸é€šè¿‡ç½‘ç»œåœ¨ä¸åŒçš„ä¸»æœºé—´å®‰å…¨åœ°å¤åˆ¶æ–‡ä»¶ã€‚<code>scp</code>åŸºäºSSHåè®®å·¥ä½œï¼Œæ‰€æœ‰æ“ä½œå‡äº«æœ‰ä¸SSHç›¸åŒçš„è®¤è¯å’Œå®‰å…¨ä¿éšœã€‚</p><ul><li><strong>ä»æœ¬åœ°ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ scp myfile.txt username@remotehost.com:/remote/directory<br></code></pre></td></tr></table></figure><ul><li><strong>ä»è¿œç¨‹ä¸»æœºå¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°ä¸»æœº</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ scp username@remotehost.com:/remote/directory/myfile.txt /local/directory<br></code></pre></td></tr></table></figure><ul><li><strong>é€’å½’å¤åˆ¶æœ¬åœ°ç›®å½•è‡³è¿œç¨‹ä¸»æœº</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ scp -r mydir username@remotehost.com:/remote/directory<br></code></pre></td></tr></table></figure><h2 id="2-æ–‡ä»¶åŒæ­¥å·¥å…·ï¼šRsync"><a href="#2-æ–‡ä»¶åŒæ­¥å·¥å…·ï¼šRsync" class="headerlink" title="2 æ–‡ä»¶åŒæ­¥å·¥å…·ï¼šRsync"></a>2 æ–‡ä»¶åŒæ­¥å·¥å…·ï¼šRsync</h2><p>é™¤äº†<code>scp</code>ä¹‹å¤–ï¼Œå¦ä¸€ç§ç”¨äºåœ¨ä¸åŒä¸»æœºé—´å¤åˆ¶æ•°æ®çš„å·¥å…·æ˜¯<code>rsync</code>ï¼ˆè¿œç¨‹åŒæ­¥ï¼‰ã€‚è™½ç„¶<code>rsync</code>ä¸<code>scp</code>ç±»ä¼¼ï¼Œä½†å®ƒå…·å¤‡ä¸€é¡¹æ˜¾è‘—çš„ä¸åŒï¼š<code>rsync</code>é‡‡ç”¨äº†ä¸€ç§ç‰¹æ®Šç®—æ³•ï¼Œè¯¥ç®—æ³•ä¼šé¢„å…ˆæ£€æŸ¥ç›®æ ‡ä½ç½®æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„æ•°æ®ï¼Œå¹¶ä»…ä¼ è¾“å·®å¼‚éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œåœ¨æ–‡ä»¶ä¼ è¾“è¿‡ç¨‹ä¸­è‹¥ç½‘ç»œä¸­æ–­å¯¼è‡´ä¼ è¾“ä¸­é€”åœæ­¢ï¼Œ<code>rsync</code>ä¸ä¼šé‡æ–°ä¼ è¾“æ‰€æœ‰æ•°æ®ï¼Œè€Œæ˜¯åªä¼ è¾“æœªå®Œæˆçš„éƒ¨åˆ†ã€‚</p><p>æ­¤å¤–ï¼Œ<code>rsync</code>ä½¿ç”¨æ ¡éªŒå’ŒéªŒè¯æ‰€ä¼ è¾“æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œè¿™äº›ä¼˜åŒ–ä½¿å¾—<code>rsync</code>éå¸¸é€‚åˆè¿›è¡Œæœ¬åœ°æˆ–è¿œç¨‹ç›®å½•åŒæ­¥ã€æ•°æ®å¤‡ä»½ä»¥åŠå¤§é‡æ•°æ®ä¼ è¾“ç­‰æ“ä½œã€‚</p><h4 id="å¸¸ç”¨rsyncé€‰é¡¹ï¼š"><a href="#å¸¸ç”¨rsyncé€‰é¡¹ï¼š" class="headerlink" title="å¸¸ç”¨rsyncé€‰é¡¹ï¼š"></a>å¸¸ç”¨<code>rsync</code>é€‰é¡¹ï¼š</h4><ul><li><p><code>v</code> - è¯¦ç»†è¾“å‡º</p></li><li><p><code>r</code> - é€’å½’è¿›å…¥å­ç›®å½•</p></li><li><p><code>h</code> - æ˜¾ç¤ºäººç±»å¯è¯»çš„è¾“å‡º</p></li><li><p><code>z</code> - å‹ç¼©æ–‡ä»¶ä»¥ä¾¿äºä¼ è¾“ï¼Œç‰¹åˆ«é€‚ç”¨äºé€Ÿåº¦è¾ƒæ…¢çš„è¿æ¥</p></li><li><p><strong>åœ¨åŒä¸€ä¸»æœºä¸ŠåŒæ­¥æ–‡ä»¶</strong></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rsync -zvr /my/local/directory/one /my/local/directory/two<br></code></pre></td></tr></table></figure><ul><li><strong>ä»è¿œç¨‹ä¸»æœºåŒæ­¥æ–‡ä»¶åˆ°æœ¬åœ°ä¸»æœº</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rsync username@remotehost.com:/remote/directory /local/directory<br></code></pre></td></tr></table></figure><ul><li><strong>ä»æœ¬åœ°ä¸»æœºåŒæ­¥æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rsync /local/directory username@remotehost.com:/remote/directory<br></code></pre></td></tr></table></figure><h2 id="3-ä½¿ç”¨Pythonåˆ›å»ºç®€æ˜“HTTPæœåŠ¡å™¨"><a href="#3-ä½¿ç”¨Pythonåˆ›å»ºç®€æ˜“HTTPæœåŠ¡å™¨" class="headerlink" title="3 ä½¿ç”¨Pythonåˆ›å»ºç®€æ˜“HTTPæœåŠ¡å™¨"></a>3 ä½¿ç”¨Pythonåˆ›å»ºç®€æ˜“HTTPæœåŠ¡å™¨</h2><p>Pythonæä¾›äº†ä¸€ä¸ªæä¸ºä¾¿æ·çš„å·¥å…·ï¼Œç”¨äºé€šè¿‡HTTPåè®®å…±äº«æ–‡ä»¶ã€‚è¿™å¯¹äºå¿«é€Ÿåˆ›å»ºç½‘ç»œå…±äº«ï¼Œä½¿åŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–è®¾å¤‡èƒ½å¤Ÿè®¿é—®éå¸¸æœ‰ç”¨ã€‚åªéœ€å¯¼èˆªè‡³ä½ å¸Œæœ›å…±äº«çš„ç›®å½•ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python -m http.server<br></code></pre></td></tr></table></figure><p>è¿™å°†å¯åŠ¨ä¸€ä¸ªåŸºç¡€çš„WebæœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºåœ°å€è¿›è¡Œè®¿é—®ã€‚è·å–è¿è¡Œæ­¤å‘½ä»¤çš„æœºå™¨çš„IPåœ°å€ï¼Œåœ¨å¦ä¸€å°è®¾å¤‡ä¸Šï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®<code>http://IP_ADDRESS:8000</code>æ¥æŸ¥çœ‹å…±äº«å†…å®¹ã€‚è‹¥åœ¨æœ¬æœºè®¿é—®ï¼Œåˆ™åªéœ€åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<code>http://localhost:8000</code>å³å¯æµè§ˆå¯ç”¨æ–‡ä»¶ã€‚</p><h2 id="4-ä½¿ç”¨NFSè¿›è¡Œç½‘ç»œæ–‡ä»¶å…±äº«"><a href="#4-ä½¿ç”¨NFSè¿›è¡Œç½‘ç»œæ–‡ä»¶å…±äº«" class="headerlink" title="4 ä½¿ç”¨NFSè¿›è¡Œç½‘ç»œæ–‡ä»¶å…±äº«"></a>4 ä½¿ç”¨NFSè¿›è¡Œç½‘ç»œæ–‡ä»¶å…±äº«</h2><p>åœ¨Linuxç¯å¢ƒä¸­ï¼Œæ ‡å‡†çš„ç½‘ç»œæ–‡ä»¶å…±äº«è§£å†³æ–¹æ¡ˆæ˜¯NFSï¼ˆNetwork File Systemï¼‰ã€‚é€šè¿‡NFSï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿè·¨ç½‘ç»œä¸ä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯å…±äº«ç›®å½•å’Œæ–‡ä»¶ã€‚</p><p>è¿™é‡Œä¸è®¨è®ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªNFSæœåŠ¡å™¨ï¼Œç®€å•ä»‹ç»å¦‚ä½•è®¾ç½®NFSå®¢æˆ·ç«¯ã€‚</p><h4 id="è®¾ç½®NFSå®¢æˆ·ç«¯"><a href="#è®¾ç½®NFSå®¢æˆ·ç«¯" class="headerlink" title="è®¾ç½®NFSå®¢æˆ·ç«¯"></a>è®¾ç½®NFSå®¢æˆ·ç«¯</h4><p>é¦–å…ˆï¼Œå¯åŠ¨NFSå®¢æˆ·ç«¯æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> service nfs-client start<br></code></pre></td></tr></table></figure><p>ç„¶åï¼ŒæŒ‚è½½è¿œç¨‹NFSç›®å½•åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> mount -t nfs server:/directory /mount_directory<br></code></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨æŒ‚è½½"><a href="#è‡ªåŠ¨æŒ‚è½½" class="headerlink" title="è‡ªåŠ¨æŒ‚è½½"></a>è‡ªåŠ¨æŒ‚è½½</h4><p>å¦‚æœé¢‘ç¹ä½¿ç”¨NFSæœåŠ¡å™¨ï¼Œå¹¶å¸Œæœ›å®ç°æ°¸ä¹…æ€§æŒ‚è½½ï¼Œç›´æ¥ç¼–è¾‘<code>/etc/fstab</code>æ–‡ä»¶å¯èƒ½å¯¼è‡´å¼€æœºæ—¶å› æ— æ³•è¿æ¥è‡³æœåŠ¡å™¨è€Œå‡ºç°é—®é¢˜ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œå»ºè®®é…ç½®è‡ªåŠ¨æŒ‚è½½åŠŸèƒ½ã€‚è¿™ä¸€åŠŸèƒ½å¯é€šè¿‡<code>automount</code>å·¥å…·æˆ–è¾ƒæ–°ç‰ˆæœ¬Linuxä¸­çš„<code>amd</code>æ¥å®ç°ã€‚å½“è®¿é—®ç‰¹å®šç›®å½•ä¸‹çš„æ–‡ä»¶æ—¶ï¼Œè‡ªåŠ¨æŒ‚è½½å·¥å…·å°†æŸ¥æ‰¾è¿œç¨‹æœåŠ¡å™¨å¹¶è‡ªåŠ¨å®ŒæˆæŒ‚è½½æ“ä½œã€‚</p><h2 id="5-ä½¿ç”¨Sambaå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«"><a href="#5-ä½¿ç”¨Sambaå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«" class="headerlink" title="5 ä½¿ç”¨Sambaå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«"></a>5 ä½¿ç”¨Sambaå®ç°è·¨å¹³å°æ–‡ä»¶å…±äº«</h2><p>åœ¨è®¡ç®—æŠ€æœ¯å‘å±•çš„æ—©æœŸï¼ŒWindowsä¸Linuxç³»ç»Ÿä¹‹é—´éœ€è¦è¿›è¡Œæ–‡ä»¶å…±äº«ï¼Œè¿™å°±å‚¬ç”Ÿäº†æœåŠ¡å™¨æ¶ˆæ¯å—ï¼ˆServer Message Block, SMBï¼‰åè®®ã€‚è¯¥åè®®æœ€åˆç”¨äºWindowsæ“ä½œç³»ç»Ÿé—´çš„æ–‡ä»¶å…±äº«ï¼ˆMacç³»ç»Ÿä¹Ÿæ”¯æŒé€šè¿‡SMBå…±äº«æ–‡ä»¶ï¼‰ï¼Œéšåæ¼”å˜ä¸ºæ›´ä¼˜åŒ–çš„é€šç”¨äº’è”ç½‘æ–‡ä»¶ç³»ç»Ÿï¼ˆCommon Internet File System, CIFSï¼‰åè®®ã€‚</p><p>Sambaæ˜¯å®ç°Linuxç³»ç»Ÿä¸­CIFSå…¼å®¹æ€§çš„å®ç”¨å·¥å…·é›†ï¼Œé™¤äº†æ–‡ä»¶å…±äº«å¤–ï¼Œè¿˜å¯ä»¥å…±äº«å¦‚æ‰“å°æœºç­‰èµ„æºã€‚</p><h4 id="åˆ›å»ºSambaç½‘ç»œå…±äº«"><a href="#åˆ›å»ºSambaç½‘ç»œå…±äº«" class="headerlink" title="åˆ›å»ºSambaç½‘ç»œå…±äº«"></a>åˆ›å»ºSambaç½‘ç»œå…±äº«</h4><p>ä»¥ä¸‹æ­¥éª¤ç®€è¦ä»‹ç»äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯ä¾›Windowsæœºå™¨è®¿é—®çš„ç½‘ç»œå…±äº«ï¼š</p><ol><li><p><strong>å®‰è£…Samba</strong></p><p>æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£…Sambaï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> apt update<br>$ <span class="hljs-built_in">sudo</span> apt install samba<br></code></pre></td></tr></table></figure></li><li><p><strong>é…ç½®<code>smb.conf</code></strong></p><p>Sambaçš„é…ç½®æ–‡ä»¶ä½äº<code>/etc/samba/smb.conf</code>ï¼Œæ­¤æ–‡ä»¶å®šä¹‰äº†åº”å…±äº«çš„ç›®å½•ã€è®¿é—®æƒé™åŠå…¶ä»–é€‰é¡¹ã€‚é»˜è®¤çš„<code>smb.conf</code>æ–‡ä»¶åŒ…å«å¤§é‡æ³¨é‡Šç¤ºä¾‹ï¼Œå¯ä»¥ä½œä¸ºé…ç½®å‚è€ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> vi /etc/samba/smb.conf<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸ºSambaè®¾ç½®å¯†ç </strong></p><p>ä¸ºç”¨æˆ·æ·»åŠ Sambaå¯†ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> smbpasswd -a [username]<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»ºå…±äº«ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mkdir</span> /my/directory/to/share<br></code></pre></td></tr></table></figure></li><li><p><strong>é‡å¯SambaæœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> service smbd restart<br></code></pre></td></tr></table></figure></li></ol><h4 id="è®¿é—®Sambaå…±äº«"><a href="#è®¿é—®Sambaå…±äº«" class="headerlink" title="è®¿é—®Sambaå…±äº«"></a>è®¿é—®Sambaå…±äº«</h4><ul><li><p><strong>ä»Windowsè®¿é—®</strong></p><p>åœ¨è¿è¡Œå¯¹è¯æ¡†ä¸­è¾“å…¥ç½‘ç»œè·¯å¾„ä»¥è®¿é—®å…±äº«ï¼š<code>\\HOST\sharename</code></p></li><li><p><strong>ä»Linuxè®¿é—®Sambaæˆ–Windowså…±äº«</strong></p><p>ä½¿ç”¨SambaåŒ…ä¸­çš„å‘½ä»¤è¡Œå·¥å…·<code>smbclient</code>è®¿é—®ä»»ä½•Windowsæˆ–SambaæœåŠ¡å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //HOST/directory -U user<br></code></pre></td></tr></table></figure><p>è¿æ¥åˆ°å…±äº«åï¼Œå³å¯æµè§ˆå’Œä¼ è¾“æ–‡ä»¶ã€‚</p></li></ul><h4 id="æŒ‚è½½Sambaå…±äº«"><a href="#æŒ‚è½½Sambaå…±äº«" class="headerlink" title="æŒ‚è½½Sambaå…±äº«"></a>æŒ‚è½½Sambaå…±äº«</h4><p>ä¸ºäº†æ›´é«˜æ•ˆåœ°ç®¡ç†æ–‡ä»¶ï¼Œå¯ä»¥å°†ç½‘ç»œå…±äº«æŒ‚è½½åˆ°æœ¬åœ°ç³»ç»Ÿï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> mount -t cifs servername:directory mountpoint -o username=user,password=pass<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®ç½‘ç»œå…±äº«ä¸­çš„æ–‡ä»¶ï¼Œè€Œæ— éœ€é€ä¸€ä¼ è¾“ï¼Œæå¤§æé«˜äº†å·¥ä½œæ•ˆç‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Logging</title>
    <link href="/2025/03/22/Linux-Logging/"/>
    <url>/2025/03/22/Linux-Logging/</url>
    
    <content type="html"><![CDATA[<h1 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h1><h2 id="1-ç³»ç»Ÿæ—¥å¿—-System-Logging"><a href="#1-ç³»ç»Ÿæ—¥å¿—-System-Logging" class="headerlink" title="1 ç³»ç»Ÿæ—¥å¿—(System Logging)"></a>1 ç³»ç»Ÿæ—¥å¿—(System Logging)</h2><p>ç³»ç»Ÿä¸­çš„æœåŠ¡ã€å†…æ ¸ã€å®ˆæŠ¤è¿›ç¨‹ç­‰ç»„ä»¶ä¸æ–­æ‰§è¡Œå„ç§æ“ä½œï¼Œè¿™äº›æ“ä½œçš„æ•°æ®ä¼šè¢«è®°å½•æˆæ—¥å¿—ä¿å­˜åœ¨ç³»ç»Ÿä¸­ï¼Œä»¥ä¾¿ç”Ÿæˆäººç±»å¯è¯»çš„äº‹ä»¶è®°å½•ã€‚è¿™ç±»æ•°æ®é€šå¸¸å­˜å‚¨äº<code>/var</code>ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•ç”¨äºå­˜æ”¾è¯¸å¦‚æ—¥å¿—ä¹‹ç±»çš„å˜é‡æ•°æ®ã€‚</p><p>syslogçš„æœåŠ¡è´Ÿè´£å°†ä¿¡æ¯å‘é€åˆ°ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ã€‚</p><p>Syslogå®é™…ä¸Šç”±å¤šä¸ªç»„ä»¶æ„æˆï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†æ˜¯è¿è¡Œåä¸ºsyslogdï¼ˆè¾ƒæ–°çš„Linuxå‘è¡Œç‰ˆä½¿ç”¨rsyslogdï¼‰çš„å®ˆæŠ¤è¿›ç¨‹ã€‚æ­¤è¿›ç¨‹ç­‰å¾…äº‹ä»¶æ¶ˆæ¯çš„å‘ç”Ÿï¼Œå¹¶è¿‡æ»¤å‡ºéœ€è¦å…³æ³¨çš„æ¶ˆæ¯ã€‚æ ¹æ®å¯¹ä¸åŒæ¶ˆæ¯çš„å¤„ç†éœ€æ±‚ï¼Œå®ƒå¯èƒ½ä¼šå°†æ¶ˆæ¯å†™å…¥æ–‡ä»¶ã€æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šæˆ–å¿½ç•¥è¯¥æ¶ˆæ¯ã€‚</p><p>ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰æ—¥å¿—éƒ½åœ¨system loggerä¸­è®°å½•ã€‚è®¸å¤šåº”ç”¨ç¨‹åºä¼šè‡ªè¡Œå®šä¹‰æ—¥å¿—è§„åˆ™å¹¶ç”Ÿæˆç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶ã€‚ç„¶è€Œï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæ—¥å¿—æ ¼å¼åº”åŒ…æ‹¬æ—¶é—´æˆ³å’Œäº‹ä»¶è¯¦æƒ…ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªsyslogæ—¥å¿—è¡Œç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ less /var/log/syslog<br><br>Jan 27 07:41:32 icebox anacron[4650]: Job `cron.weekly<span class="hljs-string">&#x27; started</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œåœ¨1æœˆ27æ—¥07:41:32ï¼ŒcronæœåŠ¡å¯åŠ¨äº†<code>cron.weekly</code>ä»»åŠ¡ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹<code>/var/log/syslog</code>æ–‡ä»¶æ¥æµè§ˆsyslogæ”¶é›†çš„æ‰€æœ‰äº‹ä»¶æ¶ˆæ¯ã€‚</p><h2 id="2-syslog"><a href="#2-syslog" class="headerlink" title="2 syslog"></a>2 syslog</h2><p>syslogæœåŠ¡ç®¡ç†ï¼Œå¹¶ä¸”å‘é€æ—¥å¿—åˆ°ç³»ç»Ÿæ—¥å¿—ä¸­ã€‚RsyslogæœåŠ¡æ˜¯syslogçš„é«˜çº§ç‰ˆæœ¬ï¼Œç”¨äºç®¡ç†å’Œå‘é€æ—¥å¿—åˆ°ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ã€‚å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆç°åœ¨éƒ½é‡‡ç”¨è¿™ä¸€æ–°ç‰ˆã€‚é€šè¿‡<code>/var/log/syslog</code>æ–‡ä»¶å¯ä»¥æŸ¥çœ‹ç”±syslogæœåŠ¡æ”¶é›†çš„æ‰€æœ‰éè®¤è¯ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>ä¸ºäº†äº†è§£ç³»ç»Ÿæ—¥å¿—è®°å½•å™¨ç»´æŠ¤å“ªäº›æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹<code>/etc/rsyslog.d/</code>ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ¥è·å–è¯¦ç»†ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ less /etc/rsyslog.d/50-default.conf <br><br><span class="hljs-comment"># é¦–å…ˆæ˜¯ä¸€äº›æ ‡å‡†çš„æ—¥å¿—æ–‡ä»¶ã€‚æŒ‰åŠŸèƒ½è®°å½•æ—¥å¿—ã€‚</span><br><br><span class="hljs-comment">#</span><br><br>auth,authpriv.*                 /var/log/auth.log<br><br>*.*;auth,authpriv.none          -/var/log/syslog<br><br><span class="hljs-comment">#cron.*                         /var/log/cron.log</span><br><br><span class="hljs-comment">#daemon.*                       -/var/log/daemon.log</span><br><br>kern.*                          -/var/log/kern.log<br><br><span class="hljs-comment">#lpr.*                          -/var/log/lpr.log</span><br><br>mail.*                          -/var/log/mail.log<br><br><span class="hljs-comment">#user.*                         -/var/log/user.log</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªé€‰æ‹©å™¨ï¼ˆå·¦åˆ—ï¼‰å’Œä¸€ä¸ªåŠ¨ä½œï¼ˆå³åˆ—ï¼‰ã€‚é€‰æ‹©å™¨å†³å®šäº†å“ªäº›ç±»å‹çš„æ—¥å¿—æ¶ˆæ¯å°†è¢«å¤„ç†ï¼Œè€ŒåŠ¨ä½œåˆ™æŒ‡å®šäº†è¿™äº›æ¶ˆæ¯åº”è¢«å‘é€åˆ°å“ªé‡Œï¼Œå¦‚ç‰¹å®šçš„æ—¥å¿—æ–‡ä»¶ã€æ§åˆ¶å°ç­‰ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¹¶éæ‰€æœ‰åº”ç”¨ç¨‹åºå’ŒæœåŠ¡éƒ½ä½¿ç”¨rsyslogç®¡ç†å…¶æ—¥å¿—ï¼Œå› æ­¤è‹¥è¦è¯¦ç»†äº†è§£å…·ä½“åº”ç”¨çš„æ—¥å¿—è®°å½•æƒ…å†µï¼Œéœ€è¦æŸ¥é˜…ç›¸åº”çš„é…ç½®ã€‚</p><p>ä¸ºç›´è§‚å±•ç¤ºæ—¥å¿—è®°å½•çš„å®é™…æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨<code>logger</code>å‘½ä»¤æ‰‹åŠ¨å‘é€ä¸€æ¡æ—¥å¿—ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">logger -s Hello<br></code></pre></td></tr></table></figure><p>éšåæ£€æŸ¥<code>/var/log/syslog</code>æ–‡ä»¶ï¼Œåœ¨æ—¥å¿—ä¸­æ‰¾åˆ°è¿™æ¡æ–°æ·»åŠ çš„è®°å½•ã€‚</p><h2 id="3-é€šç”¨æ—¥å¿—-General-Logging"><a href="#3-é€šç”¨æ—¥å¿—-General-Logging" class="headerlink" title="3 é€šç”¨æ—¥å¿—(General Logging)"></a>3 é€šç”¨æ—¥å¿—(General Logging)</h2><p>åœ¨ç³»ç»Ÿä¸­ï¼Œå¯ä»¥æŸ¥çœ‹è®¸å¤šæ—¥å¿—æ–‡ä»¶ï¼Œå…¶ä¸­è®¸å¤šé‡è¦çš„æ—¥å¿—ä½äº<code>/var/log</code>ç›®å½•ä¸‹ã€‚è¿™é‡Œä¸»è¦è®¨è®ºä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ã€‚</p><p>æœ‰ä¸¤ä¸ªé€šç”¨çš„æ—¥å¿—æ–‡ä»¶å¯ä»¥å¿«é€Ÿäº†è§£ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼š</p><ul><li><code>/var/log/messages</code></li></ul><p>è¯¥æ—¥å¿—æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰éå…³é”®åŠéè°ƒè¯•æ¶ˆæ¯ï¼ŒåŒ…æ‹¬å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ˆdmesgï¼‰ã€è®¤è¯ï¼ˆauthï¼‰ã€å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰ã€å®ˆæŠ¤è¿›ç¨‹ç­‰è®°å½•çš„ä¿¡æ¯ã€‚è¿™å¯¹äºåˆæ­¥äº†è§£ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µéå¸¸æœ‰ç”¨ã€‚</p><ul><li><code>/var/log/syslog</code></li></ul><p>æ­¤æ—¥å¿—æ–‡ä»¶è®°å½•äº†é™¤è®¤è¯ä¿¡æ¯å¤–çš„æ‰€æœ‰å†…å®¹ï¼Œå¯¹äºè°ƒè¯•ç³»ç»Ÿé”™è¯¯æä¸ºæœ‰ç”¨ã€‚</p><p>è¿™ä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶åœ¨è§£å†³ç³»ç»Ÿé—®é¢˜æ—¶åº”å·²è¶³å¤Ÿã€‚ç„¶è€Œï¼Œå¦‚æœéœ€è¦é’ˆå¯¹ç‰¹å®šç»„ä»¶è¿›è¡Œæ—¥å¿—åˆ†æï¼Œä¹Ÿå­˜åœ¨ç›¸åº”çš„ç‹¬ç«‹æ—¥å¿—æ–‡ä»¶ä¾›æŸ¥é˜…ã€‚</p><h2 id="4-Kernel-Logging"><a href="#4-Kernel-Logging" class="headerlink" title="4 Kernel Logging"></a>4 Kernel Logging</h2><h4 id="var-log-dmesg"><a href="#var-log-dmesg" class="headerlink" title="/var/log/dmesg"></a><code>/var/log/dmesg</code></h4><p>ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ä¼šè®°å½•æœ‰å…³å†…æ ¸ç¯ç¼“å†²åŒºçš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ç¡¬ä»¶é©±åŠ¨ã€å†…æ ¸çŠ¶æ€ä»¥åŠå¯åŠ¨è¿‡ç¨‹ä¸­çš„å…¶ä»–é‡è¦æ•°æ®ã€‚è¯¥æ—¥å¿—æ–‡ä»¶ä½äº<code>/var/log/dmesg</code>ï¼Œå¹¶åœ¨æ¯æ¬¡å¯åŠ¨æ—¶é‡ç½®ã€‚ä½†åœ¨é‡åˆ°å¯åŠ¨é—®é¢˜æˆ–ç¡¬ä»¶é—®é¢˜æ—¶ï¼Œ<code>dmesg</code>æ—¥å¿—æ˜¯æŸ¥æ‰¾çº¿ç´¢çš„æœ€ä½³ä½ç½®ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<code>dmesg</code>å‘½ä»¤æŸ¥çœ‹æ­¤æ—¥å¿—ã€‚</p><h4 id="var-log-kern-log"><a href="#var-log-kern-log" class="headerlink" title="/var/log/kern.log"></a><code>/var/log/kern.log</code></h4><p>å¦ä¸€ä¸ªç”¨äºæŸ¥çœ‹å†…æ ¸ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶æ˜¯<code>/var/log/kern.log</code>ï¼Œå®ƒè®°å½•äº†ç³»ç»Ÿä¸Šçš„å†…æ ¸ä¿¡æ¯å’Œäº‹ä»¶ï¼Œå¹¶ä¸”åŒ…å«äº†<code>dmesg</code>çš„è¾“å‡ºã€‚</p><h2 id="5-Authentication-Logging"><a href="#5-Authentication-Logging" class="headerlink" title="5 Authentication Logging"></a>5 Authentication Logging</h2><p>èº«ä»½éªŒè¯æ—¥å¿—å¯¹äºæ’æŸ¥ç™»å½•é—®é¢˜æä¸ºæœ‰ç”¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç”¨æˆ·ç™»å½•åŠæ‰€ä½¿ç”¨çš„è®¤è¯æ–¹æ³•ç­‰è¯¦ç»†ä¿¡æ¯ã€‚</p><h4 id="var-log-auth-log"><a href="#var-log-auth-log" class="headerlink" title="/var/log/auth.log"></a><code>/var/log/auth.log</code></h4><p>è¯¥æ—¥å¿—æ–‡ä»¶åŒ…å«äº†ç³»ç»Ÿçš„æˆæƒè®°å½•ï¼Œä¾‹å¦‚ç”¨æˆ·çš„ç™»å½•æ´»åŠ¨ä»¥åŠé‡‡ç”¨çš„è®¤è¯æ–¹å¼ã€‚é€šè¿‡åˆ†æ<code>/var/log/auth.log</code>ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç›‘æ§å’Œè§£å†³ä¸èº«ä»½éªŒè¯ç›¸å…³çš„å„ç§é—®é¢˜ã€‚</p><p>ç¤ºä¾‹ç‰‡æ®µï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Jan</span> <span class="hljs-number">31</span> <span class="hljs-number">10</span>:<span class="hljs-number">37</span>:<span class="hljs-number">50</span> icebox pkexec: pam_unix(polkit-<span class="hljs-number">1</span>:session): session opened for user root by (uid=<span class="hljs-number">1000</span>)<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç¤ºä¾‹å±•ç¤ºäº†åœ¨ç‰¹å®šæ—¶é—´ç‚¹ä¸Šï¼ŒæŸä¸ªç”¨æˆ·å¯èƒ½å°è¯•é€šè¿‡<code>pkexec</code>å‘½ä»¤è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”ç³»ç»Ÿä½¿ç”¨äº†PAMï¼ˆå¯æ’æ‹”è®¤è¯æ¨¡å—ï¼‰è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚</p><h2 id="6-æ—¥å¿—æ–‡ä»¶ç®¡ç†"><a href="#6-æ—¥å¿—æ–‡ä»¶ç®¡ç†" class="headerlink" title="6 æ—¥å¿—æ–‡ä»¶ç®¡ç†"></a>6 æ—¥å¿—æ–‡ä»¶ç®¡ç†</h2><p>æ—¥å¿—æ–‡ä»¶ç”Ÿæˆå¤§é‡æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»…éœ€è¦æŸ¥çœ‹è¾ƒæ–°çš„æ—¥å¿—ï¼ŒåŒæ—¶å¸Œæœ›é«˜æ•ˆç®¡ç†ç£ç›˜ç©ºé—´ã€‚</p><h4 id="logrotate"><a href="#logrotate" class="headerlink" title="logrotate"></a><code>logrotate</code></h4><p><code>logrotate</code>æä¾›äº†ä¸€ç«™å¼çš„æ—¥å¿—ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚å®ƒé€šè¿‡é…ç½®æ–‡ä»¶å…è®¸ç”¨æˆ·æŒ‡å®šéœ€ä¿ç•™çš„æ—¥å¿—æ•°é‡åŠç±»å‹ã€å¦‚ä½•å‹ç¼©æ—¥å¿—ä»¥èŠ‚çœç©ºé—´ç­‰ã€‚é€šå¸¸ï¼Œ<code>logrotate</code>æ¯å¤©é€šè¿‡cronä½œä¸šè¿è¡Œä¸€æ¬¡ï¼Œå…¶é…ç½®æ–‡ä»¶ä½äº<code>/etc/logrotate.d</code>ç›®å½•ä¸‹ã€‚</p><ul><li><strong>é…ç½®ä¸åŠŸèƒ½</strong>ï¼šåˆ©ç”¨<code>logrotate</code>çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çµæ´»è®¾å®šæ—¥å¿—çš„è½®æ¢ç­–ç•¥ï¼ŒåŒ…æ‹¬è½®æ¢å‘¨æœŸã€ä¿å­˜çš„å†å²æ—¥å¿—æ•°é‡ä»¥åŠæ˜¯å¦å¯¹æ—§æ—¥å¿—è¿›è¡Œå‹ç¼©å¤„ç†ã€‚</li><li><strong>è‡ªåŠ¨åŒ–æ‰§è¡Œ</strong>ï¼šè¯¥å·¥å…·ä¸€èˆ¬ç”±cronå®šæ—¶ä»»åŠ¡æ¯æ—¥è°ƒåº¦æ‰§è¡Œï¼Œç¡®ä¿æ—¥å¿—ç®¡ç†çš„è‡ªåŠ¨åŒ–å’Œé«˜æ•ˆæ€§ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Process Utilization</title>
    <link href="/2025/03/22/Linux-Process-Utilization/"/>
    <url>/2025/03/22/Linux-Process-Utilization/</url>
    
    <content type="html"><![CDATA[<h1 id="Process-Utilization"><a href="#Process-Utilization" class="headerlink" title="Process Utilization"></a>Process Utilization</h1><h2 id="1-è¿›ç¨‹è·Ÿè¸ªï¼šä½¿ç”¨topå‘½ä»¤"><a href="#1-è¿›ç¨‹è·Ÿè¸ªï¼šä½¿ç”¨topå‘½ä»¤" class="headerlink" title="1 è¿›ç¨‹è·Ÿè¸ªï¼šä½¿ç”¨topå‘½ä»¤"></a>1 è¿›ç¨‹è·Ÿè¸ªï¼šä½¿ç”¨<code>top</code>å‘½ä»¤</h2><h4 id="top-è¾“å‡ºè¯¦è§£"><a href="#top-è¾“å‡ºè¯¦è§£" class="headerlink" title="top è¾“å‡ºè¯¦è§£"></a><code>top</code> è¾“å‡ºè¯¦è§£</h4><p>è¿è¡Œ <code>top</code> å‘½ä»¤åï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">top - 18:06:26 up 6 days,  4:07,  2 <span class="hljs-built_in">users</span>,  load average: 0.92, 0.62, 0.59<br>Tasks: 389 total,   1 running, 387 sleeping,   0 stopped,   1 zombie<br>%Cpu(s):  1.8 us,  0.4 sy,  0.0 ni, 97.6 <span class="hljs-built_in">id</span>,  0.1 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem:  32870888 total, 27467976 used,  5402912 free,   518808 buffers<br>KiB Swap: 33480700 total,    39892 used, 33440808 free. 19454152 cached Mem<br><br>PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                             <br><br> 6675 patty    20   0 1731472 520960  30876 S   8.3  1.6 160:24.79 chrome                             <br><br> 6926 patty    20   0  935888 163456  25576 S   4.3  0.5   5:28.13 chrome <br></code></pre></td></tr></table></figure><ul><li><p><strong>ç¬¬ä¸€è¡Œ</strong>ï¼šæ˜¾ç¤ºå½“å‰æ—¶é—´ã€ç³»ç»Ÿå·²è¿è¡Œæ—¶é•¿ã€å½“å‰ç™»å½•ç”¨æˆ·æ•°åŠç³»ç»Ÿè´Ÿè½½å¹³å‡å€¼ã€‚</p></li><li><p><strong>ç¬¬äºŒè¡Œ</strong>ï¼šå±•ç¤ºäº†ç³»ç»Ÿä¸­ä»»åŠ¡çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡Œä¸­ã€ä¼‘çœ ã€åœæ­¢åŠåƒµå°¸çŠ¶æ€çš„ä»»åŠ¡æ•°é‡ã€‚</p></li><li><p><strong>ç¬¬ä¸‰è¡Œ</strong>ï¼šCPU ä½¿ç”¨æƒ…å†µç»†åˆ†</p><ul><li><p>usï¼šç”¨æˆ·cpuæ—¶é—´</p></li><li><p>syï¼šç³»ç»Ÿcpuæ—¶é—´</p></li><li><p>niï¼šnice cpuæ—¶é—´</p></li><li><p>idï¼šcpuç©ºé—²æ—¶é—´</p></li><li><p>waï¼šcpuç­‰å¾…I&#x2F;Oæ—¶é—´ï¼Œå¦‚æœå¾ˆä½ï¼Œé€šå¸¸ä¸ä¼šæ˜¯ç½‘ç»œæˆ–diské—®é¢˜</p></li><li><p>hiï¼šcpuèŠ±åœ¨å¤„ç†ç¡¬ä»¶ä¸­æ–­ä¸Šçš„æ—¶é—´</p></li><li><p>siï¼šcpuèŠ±åœ¨å¤„ç†è½¯ä¸­æ–­ä¸Šçš„æ—¶é—´</p></li><li><p>stï¼šsteal timeï¼Œå¦‚æœè¿è¡Œäº†è™šæ‹Ÿæœºï¼Œè¿™è¡¨ç¤ºè¢«å…¶ä»–ä»»åŠ¡å·èµ°çš„cpuæ—¶é—´</p></li></ul></li><li><p><strong>ç¬¬å››ä¸ç¬¬äº”è¡Œ</strong>ï¼šåˆ†åˆ«å±•ç¤ºå†…å­˜å’Œäº¤æ¢åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µã€‚éšåæ˜¯è¿›ç¨‹åˆ—è¡¨ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li><p><strong>PID</strong>: è¿›ç¨‹ID</p></li><li><p><strong>USER</strong>: æ‹¥æœ‰è¯¥è¿›ç¨‹çš„ç”¨æˆ·</p></li><li><p><strong>PR</strong>: è¿›ç¨‹ä¼˜å…ˆçº§</p></li><li><p><strong>NI</strong>: niceå€¼</p></li><li><p><strong>VIRT</strong>: è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡</p></li><li><p><strong>RES</strong>: ç‰©ç†å†…å­˜ä½¿ç”¨é‡</p></li><li><p><strong>SHR</strong>: å…±äº«å†…å­˜å¤§å°</p></li><li><p><strong>S</strong>: è¿›ç¨‹çŠ¶æ€ï¼ˆS&#x3D;ç¡çœ ï¼ŒR&#x3D;è¿è¡Œï¼ŒZ&#x3D;åƒµå°¸ï¼ŒD&#x3D;ä¸å¯ä¸­æ–­ï¼ŒT&#x3D;å·²åœæ­¢ï¼‰</p></li><li><p><strong>%CPU</strong>: å ç”¨çš„CPUç™¾åˆ†æ¯”</p></li><li><p><strong>%MEM</strong>: å ç”¨çš„RAMç™¾åˆ†æ¯”</p></li><li><p><strong>TIME+</strong>: æ€»æ´»åŠ¨æ—¶é—´</p></li><li><p><strong>COMMAND</strong>: è¿›ç¨‹åç§°</p></li></ul></li></ul><p>è‹¥åªæƒ³ç›‘æ§ç‰¹å®šè¿›ç¨‹IDä¸º1çš„è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ top -p 1<br></code></pre></td></tr></table></figure><h2 id="2-ä½¿ç”¨-lsof-å’Œ-fuser-å·¥å…·"><a href="#2-ä½¿ç”¨-lsof-å’Œ-fuser-å·¥å…·" class="headerlink" title="2 ä½¿ç”¨ lsof å’Œ fuser å·¥å…·"></a>2 ä½¿ç”¨ <code>lsof</code> å’Œ <code>fuser</code> å·¥å…·</h2><p>å½“å°è¯•å¸è½½ä¸€ä¸ªUSBè®¾å¤‡æ—¶ï¼Œå¦‚æœé‡åˆ°â€œè®¾å¤‡æˆ–èµ„æºå¿™â€çš„é”™è¯¯ï¼Œå¦‚ä½•ç¡®å®šå“ªäº›æ–‡ä»¶æ­£åœ¨è¢«ä½¿ç”¨ï¼Ÿè¿™é‡Œä»‹ç»ä¸¤ä¸ªå®ç”¨å·¥å…·ï¼š<code>lsof</code> å’Œ <code>fuser</code>ã€‚</p><h4 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a><code>lsof</code></h4><p><code>lsof</code>ï¼ˆâ€list open filesâ€çš„ç¼©å†™ï¼‰å‘½ä»¤ç”¨äºåˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶åŠå…¶å…³è”è¿›ç¨‹ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œâ€œæ–‡ä»¶â€ä¸ä»…æŒ‡æ–‡æœ¬æ–‡ä»¶ã€å›¾åƒç­‰ï¼Œè¿˜åŒ…æ‹¬ç£ç›˜ã€ç®¡é“ã€ç½‘ç»œå¥—æ¥å­—ã€è®¾å¤‡ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æœ‰å“ªäº›æ–‡ä»¶è¢«å“ªäº›è¿›ç¨‹æ‰“å¼€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ lsof .<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">COMMAND    PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME<br>lxsession 1491 pete  cwd    DIR    8,6     4096  131 .<br>update-no 1796 pete  cwd    DIR    8,6     4096  131 .<br>nm-applet 1804 pete  cwd    DIR    8,6     4096  131 .<br>indicator 1809 pete  cwd    DIR    8,6     4096  131 .<br>xterm     2205 pete  cwd    DIR    8,6     4096  131 .<br>bash      2207 pete  cwd    DIR    8,6     4096  131 .<br>lsof      5914 pete  cwd    DIR    8,6     4096  131 .<br>lsof      5915 pete  cwd    DIR    8,6     4096  131 .<br></code></pre></td></tr></table></figure><p>è¿™å±•ç¤ºäº†æ¯ä¸ªè¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼ˆcwdï¼‰ï¼Œå¸®åŠ©è¯†åˆ«å ç”¨è®¾å¤‡æˆ–æ–‡ä»¶çš„è¿›ç¨‹ã€‚</p><h4 id="fuser"><a href="#fuser" class="headerlink" title="fuser"></a><code>fuser</code></h4><p><code>fuser</code> å‘½ä»¤æä¾›äº†å¦ä¸€ç§è¿½è¸ªæ–‡ä»¶ä½¿ç”¨çš„æ‰‹æ®µã€‚å®ƒæ˜¾ç¤ºä½¿ç”¨ç‰¹å®šæ–‡ä»¶æˆ–æ–‡ä»¶ç³»ç»Ÿçš„è¿›ç¨‹ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹å“ªä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨ <code>/home/pete</code> ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ fuser -v .<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">                     USER  PID ACCESS COMMAND<br>/home/pete:         pete  1491 ..c.. lxsession<br>                     pete  1796 ..c.. update-notifier<br>                     pete  1804 ..c.. nm-applet<br>                     pete  1809 ..c.. indicator-power<br>                     pete  2205 ..c.. xterm<br>                     pete  2207 ..c.. bash<br></code></pre></td></tr></table></figure><p>æ­¤è¾“å‡ºæ­ç¤ºäº†å“ªäº›è¿›ç¨‹æ­£åœ¨è®¿é—®æŒ‡å®šç›®å½•ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥å†³å®šæ˜¯å¦ç»ˆæ­¢ç›¸å…³è¿›ç¨‹ä»¥é‡Šæ”¾è®¾å¤‡æˆ–æ–‡ä»¶ï¼Œä»è€Œé¡ºåˆ©å®Œæˆå¸è½½æ“ä½œã€‚</p><h2 id="3-çº¿ç¨‹"><a href="#3-çº¿ç¨‹" class="headerlink" title="3 çº¿ç¨‹"></a>3 çº¿ç¨‹</h2><p>çº¿ç¨‹ä¸è¿›ç¨‹ç±»ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯æ‰§è¡Œç¨‹åºçš„å®ä½“ï¼Œå¸¸è¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p><p>è¿›ç¨‹å„è‡ªç‹¬ç«‹è¿ä½œï¼Œå¹¶æ‹¥æœ‰éš”ç¦»çš„ç³»ç»Ÿèµ„æºï¼Œè€Œçº¿ç¨‹åˆ™èƒ½å¤Ÿåœ¨åŒä¸€è¿›ç¨‹ä¸­å…±äº«è¿™äº›èµ„æºï¼Œè¿™ä½¿å¾—çº¿ç¨‹é—´çš„é€šä¿¡æ›´ä¸ºä¾¿æ·ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºæ¯”ä½¿ç”¨å¤šè¿›ç¨‹åº”ç”¨ç¨‹åºæ›´åŠ é«˜æ•ˆã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå½“åŒæ—¶æ‰“å¼€LibreOffice Writerå’ŒChromeæ—¶ï¼Œæ¯ä¸ªåº”ç”¨éƒ½ä½œä¸ºç‹¬ç«‹çš„è¿›ç¨‹è¿è¡Œã€‚åœ¨Writerä¸­ç¼–è¾‘æ–‡æœ¬æ—¶ï¼Œç¼–è¾‘åŠ¨ä½œå’Œè‡ªåŠ¨ä¿å­˜åŠŸèƒ½å¯ä»¥å¹¶è¡Œä½œä¸ºä¸¤ä¸ªâ€œè½»é‡çº§è¿›ç¨‹â€ï¼Œå³çº¿ç¨‹æ¥å®ç°ã€‚</p><h4 id="æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹"><a href="#æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹"></a>æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹</h4><p>è¦æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹åŠå…¶çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨<code>ps m</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ ps m<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"> PID TTY      STAT   TIME COMMAND<br>2207 pts/2    -      0:01 bash<br>   - -        Ss     0:01 -<br>5252 pts/2    -      0:00 ps m<br>   - -        R+     0:00 -<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒPIDè¡¨ç¤ºå„ä¸ªè¿›ç¨‹ï¼Œè€Œåœ¨è¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä»¥â€œâ€“â€æ ‡è¯†ã€‚ä»ä¸Šè¿°è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹å‡ä¸ºå•çº¿ç¨‹è¿›ç¨‹ã€‚</p><h2 id="4-CPUç›‘æ§"><a href="#4-CPUç›‘æ§" class="headerlink" title="4 CPUç›‘æ§"></a>4 CPUç›‘æ§</h2><p><code>uptime</code>å‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿäº†è§£ç³»ç»Ÿçš„è¿è¡Œæ—¶é—´å’Œè´Ÿè½½æƒ…å†µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ <span class="hljs-built_in">uptime</span><br> 17:23:35 up 1 day,  5:59,  2 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.02, 0.05<br></code></pre></td></tr></table></figure><p><code>uptime</code>å‘½ä»¤æä¾›äº†å…³äºç³»ç»Ÿè¿è¡Œæ—¶é—´ã€å½“å‰ç™»å½•ç”¨æˆ·æ•°ä»¥åŠè¿‡å»1åˆ†é’Ÿã€5åˆ†é’Ÿå’Œ15åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½çš„ä¿¡æ¯ã€‚</p><h4 id="å¹³å‡è´Ÿè½½"><a href="#å¹³å‡è´Ÿè½½" class="headerlink" title="å¹³å‡è´Ÿè½½"></a>å¹³å‡è´Ÿè½½</h4><p>å¹³å‡è´Ÿè½½æ˜¯è¡¡é‡CPUè´Ÿè½½çš„ä¸€ä¸ªè‰¯å¥½æŒ‡æ ‡ï¼Œæ‰€è°“CPUè´Ÿè½½ï¼ŒæŒ‡çš„æ˜¯ç­‰å¾…CPUæ‰§è¡Œçš„è¿›ç¨‹æ•°çš„å¹³å‡å€¼ã€‚</p><p>å¯¹äºå¤šæ ¸å¤„ç†å™¨è€Œè¨€ï¼Œæ¯ä¸ªæ ¸å¿ƒå¯ä»¥è¢«è§†ä¸ºä¸€æ¡ç‹¬ç«‹çš„è½¦é“ã€‚ä¾‹å¦‚ï¼Œæ‹¥æœ‰å››æ ¸å¤„ç†å™¨ï¼ˆ4ä¸ªæ ¸å¿ƒï¼‰çš„è®¡ç®—æœºï¼Œå…¶å¹³å‡è´Ÿè½½ä¸º1æ—¶ï¼Œå®é™…ä¸Šåªä½¿ç”¨äº†25%çš„CPUèµ„æºã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹<code>/proc/cpuinfo</code>æ–‡ä»¶æ¥ç¡®è®¤ç³»ç»Ÿä¸­çš„æ ¸å¿ƒæ•°é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /proc/cpuinfo<br></code></pre></td></tr></table></figure><h4 id="ç›‘æ§ä¸åˆ†æ"><a href="#ç›‘æ§ä¸åˆ†æ" class="headerlink" title="ç›‘æ§ä¸åˆ†æ"></a>ç›‘æ§ä¸åˆ†æ</h4><p>è§‚å¯Ÿå¹³å‡è´Ÿè½½æ—¶ï¼Œå¿…é¡»è€ƒè™‘æ ¸å¿ƒæ•°é‡ã€‚å¦‚æœå‘ç°ç³»ç»Ÿçš„å¹³å‡è´Ÿè½½æŒç»­åé«˜ï¼Œå¯èƒ½æ„å‘³ç€å­˜åœ¨éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</p><h2 id="5-I-Oç›‘æ§"><a href="#5-I-Oç›‘æ§" class="headerlink" title="5 I&#x2F;Oç›‘æ§"></a>5 I&#x2F;Oç›‘æ§</h2><p>é™¤äº†CPUä½¿ç”¨æƒ…å†µï¼Œè¿˜å¯ä»¥é€šè¿‡<code>iostat</code>æ¥ç›‘æ§ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ iostat<br><br>Linux 3.13.0-39-lowlatency (icebox)     01/28/2016      _i686_  (1 CPU)<br><br>avg-cpu:  %user   %<span class="hljs-built_in">nice</span> %system %iowait  %steal   %idle<br>           0.13    0.03    0.50    0.01    0.00   99.33<br><br>Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn<br>sda               0.17         3.49         1.92     385106     212417<br></code></pre></td></tr></table></figure><h4 id="ç¬¬ä¸€éƒ¨åˆ†æ˜¯CPUä¿¡æ¯"><a href="#ç¬¬ä¸€éƒ¨åˆ†æ˜¯CPUä¿¡æ¯" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†æ˜¯CPUä¿¡æ¯"></a>ç¬¬ä¸€éƒ¨åˆ†æ˜¯CPUä¿¡æ¯</h4><ul><li><code>%user</code>: æ˜¾ç¤ºæ‰§è¡Œç”¨æˆ·çº§åº”ç”¨ç¨‹åºæ—¶çš„CPUåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ã€‚</li><li><code>%nice</code>: æ˜¾ç¤ºåœ¨æ‰§è¡Œå…·æœ‰ä¼˜å…ˆçº§è°ƒæ•´çš„ç”¨æˆ·çº§è¿›ç¨‹æ—¶çš„CPUåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ã€‚</li><li><code>%system</code>: æ˜¾ç¤ºæ‰§è¡Œç³»ç»Ÿçº§åˆ«ï¼ˆå†…æ ¸ï¼‰ä»»åŠ¡æ—¶çš„CPUåˆ©ç”¨ç‡ç™¾åˆ†æ¯”ã€‚</li><li><code>%iowait</code>: æ˜¾ç¤ºCPUåœ¨æœ‰æœªå®Œæˆç£ç›˜I&#x2F;Oè¯·æ±‚æœŸé—´å¤„äºç©ºé—²çŠ¶æ€çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li><li><code>%steal</code>: æ˜¾ç¤ºè™šæ‹ŸCPUç­‰å¾…å…¶ä»–è™šæ‹Ÿå¤„ç†å™¨æœåŠ¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li><li><code>%idle</code>: æ˜¾ç¤ºCPUåœ¨æ²¡æœ‰æœªå®Œæˆç£ç›˜I&#x2F;Oè¯·æ±‚çš„æƒ…å†µä¸‹å¤„äºç©ºé—²çŠ¶æ€çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚</li></ul><h4 id="ç¬¬äºŒéƒ¨åˆ†æ˜¯ç£ç›˜åˆ©ç”¨ç‡"><a href="#ç¬¬äºŒéƒ¨åˆ†æ˜¯ç£ç›˜åˆ©ç”¨ç‡" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†æ˜¯ç£ç›˜åˆ©ç”¨ç‡"></a>ç¬¬äºŒéƒ¨åˆ†æ˜¯ç£ç›˜åˆ©ç”¨ç‡</h4><ul><li><code>tps</code>: æ¯ç§’ä¼ è¾“åˆ°è®¾å¤‡çš„æ¬¡æ•°ã€‚ä¸€æ¬¡ä¼ è¾“å³ä¸ºå¯¹è®¾å¤‡çš„ä¸€ä¸ªI&#x2F;Oè¯·æ±‚ï¼Œå¤šä¸ªé€»è¾‘è¯·æ±‚å¯ä»¥åˆå¹¶æˆä¸€ä¸ªI&#x2F;Oè¯·æ±‚ã€‚</li><li><code>kB_read/s</code>: æ¯ç§’ä»è®¾å¤‡è¯»å–çš„æ•°æ®é‡ï¼Œä»¥KBè¡¨ç¤ºã€‚</li><li><code>kB_wrtn/s</code>: æ¯ç§’å†™å…¥è®¾å¤‡çš„æ•°æ®é‡ï¼Œä»¥KBè¡¨ç¤ºã€‚</li><li><code>kB_read</code>: ä»è®¾å¤‡è¯»å–çš„æ€»æ•°æ®é‡ï¼Œå•ä½æ˜¯KBã€‚</li><li><code>kB_wrtn</code>: å†™å…¥è®¾å¤‡çš„æ€»æ•°æ®é‡ï¼Œå•ä½æ˜¯KBã€‚</li></ul><h2 id="6-å†…å­˜ç›‘æ§"><a href="#6-å†…å­˜ç›‘æ§" class="headerlink" title="6 å†…å­˜ç›‘æ§"></a>6 å†…å­˜ç›‘æ§</h2><p>å¯ä»¥ä½¿ç”¨<code>vmstat</code>å·¥å…·æ¥ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ vmstat<br><br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   <span class="hljs-keyword">in</span>   cs us sy <span class="hljs-built_in">id</span> wa st<br> 1  0      0 396528  38816 384036    0    0     4     2   38   79  0  0 99  0  0<br></code></pre></td></tr></table></figure><h4 id="è¿›ç¨‹-procs"><a href="#è¿›ç¨‹-procs" class="headerlink" title="è¿›ç¨‹(procs)"></a>è¿›ç¨‹(procs)</h4><ul><li><code>r</code>: å¤„äºè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹æ•°é‡ã€‚</li><li><code>b</code>: å¤„äºä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•°é‡ã€‚</li></ul><h4 id="å†…å­˜-memory"><a href="#å†…å­˜-memory" class="headerlink" title="å†…å­˜(memory)"></a>å†…å­˜(memory)</h4><ul><li><code>swpd</code>: å·²ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜å¤§å°ã€‚</li><li><code>free</code>: ç©ºé—²å†…å­˜å¤§å°ã€‚</li><li><code>buff</code>: ç”¨ä½œç¼“å†²åŒºçš„å†…å­˜å¤§å°ã€‚</li><li><code>cache</code>: ç”¨ä½œç¼“å­˜çš„å†…å­˜å¤§å°ã€‚</li></ul><h4 id="äº¤æ¢-swap"><a href="#äº¤æ¢-swap" class="headerlink" title="äº¤æ¢(swap)"></a>äº¤æ¢(swap)</h4><ul><li><code>si</code>: ä»ç£ç›˜äº¤æ¢è¿›å†…å­˜çš„æ•°æ®é‡ã€‚</li><li><code>so</code>: ä»å†…å­˜äº¤æ¢åˆ°ç£ç›˜çš„æ•°æ®é‡ã€‚</li></ul><h4 id="I-O"><a href="#I-O" class="headerlink" title="I&#x2F;O"></a>I&#x2F;O</h4><ul><li><code>bi</code>: ä»å—è®¾å¤‡æ¥æ”¶åˆ°çš„æ•°æ®å—æ•°é‡ã€‚</li><li><code>bo</code>: å‘é€åˆ°å—è®¾å¤‡çš„æ•°æ®å—æ•°é‡ã€‚</li></ul><h4 id="ç³»ç»Ÿ-system"><a href="#ç³»ç»Ÿ-system" class="headerlink" title="ç³»ç»Ÿ(system)"></a>ç³»ç»Ÿ(system)</h4><ul><li><code>in</code>: æ¯ç§’å‘ç”Ÿçš„ä¸­æ–­æ¬¡æ•°ã€‚</li><li><code>cs</code>: æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚</li></ul><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><ul><li><code>us</code>: ç”¨æˆ·æ€æ—¶é—´å æ¯”ã€‚</li><li><code>sy</code>: å†…æ ¸æ€æ—¶é—´å æ¯”ã€‚</li><li><code>id</code>: ç©ºé—²æ—¶é—´å æ¯”ã€‚</li><li><code>wa</code>: ç­‰å¾…I&#x2F;Oæ“ä½œå®Œæˆçš„æ—¶é—´å æ¯”ã€‚</li></ul><h2 id="7-æŒç»­ç›‘æ§"><a href="#7-æŒç»­ç›‘æ§" class="headerlink" title="7 æŒç»­ç›‘æ§"></a>7 æŒç»­ç›‘æ§</h2><p>å½“ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œä½¿ç”¨ç›‘æ§å·¥å…·è¿›è¡Œæ£€æŸ¥æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ç„¶è€Œï¼Œå¯¹äºé‚£äº›åœ¨ä¸è§‚å¯Ÿæ—¶å‘ç”Ÿçš„é—®é¢˜ï¼Œéœ€è¦ä¾èµ–æŒç»­ç›‘æ§å·¥å…·ã€‚è¿™ç±»å·¥å…·èƒ½å¤Ÿæ”¶é›†ã€æŠ¥å‘Šå¹¶ä¿å­˜ç³»ç»Ÿæ´»åŠ¨ä¿¡æ¯ï¼Œä¾¿äºåç»­åˆ†æã€‚</p><h4 id="å®‰è£…sar"><a href="#å®‰è£…sar" class="headerlink" title="å®‰è£…sar"></a>å®‰è£…<code>sar</code></h4><p><code>sar</code>ç”¨äºå¯¹ç³»ç»Ÿè¿›è¡Œå†å²æ•°æ®åˆ†æã€‚é¦–å…ˆï¼Œè¯·ç¡®ä¿å·²å®‰è£…sysstatåŒ…ï¼Œä»¥ä¾¿ä½¿ç”¨<code>sar</code>ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install sysstat<br></code></pre></td></tr></table></figure><h4 id="è®¾ç½®æ•°æ®æ”¶é›†"><a href="#è®¾ç½®æ•°æ®æ”¶é›†" class="headerlink" title="è®¾ç½®æ•°æ®æ”¶é›†"></a>è®¾ç½®æ•°æ®æ”¶é›†</h4><p>é€šå¸¸ï¼Œåœ¨å®‰è£…sysstatåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¼€å§‹æ”¶é›†æ•°æ®ã€‚å¦‚æœæ²¡æœ‰è‡ªåŠ¨å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>/etc/default/sysstat</code>æ–‡ä»¶ä¸­çš„<code>ENABLED</code>å­—æ®µæ¥å¯ç”¨æ•°æ®æ”¶é›†åŠŸèƒ½ã€‚</p><h4 id="ä½¿ç”¨sar"><a href="#ä½¿ç”¨sar" class="headerlink" title="ä½¿ç”¨sar"></a>ä½¿ç”¨<code>sar</code></h4><ul><li><p>æŸ¥çœ‹å½“å¤©ç³»ç»Ÿè´Ÿè½½è¯¦æƒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> sar -q<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å½“å¤©å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> sar -r<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> sar -P<br></code></pre></td></tr></table></figure></li></ul><p>è¦æŸ¥çœ‹å…¶ä»–æ—¥æœŸçš„æ•°æ®ï¼Œå¯ä»¥è®¿é—®<code>/var/log/sysstat/saXX</code>ç›®å½•ï¼Œå…¶ä¸­<code>XX</code>æ˜¯è¦æŸ¥çœ‹çš„æ—¥æœŸã€‚ä¾‹å¦‚ï¼ŒæŸ¥çœ‹2å·çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sar -q /var/log/sysstat/sa02<br></code></pre></td></tr></table></figure><h2 id="8-å®šæ—¶ä»»åŠ¡-Cron-Jobs"><a href="#8-å®šæ—¶ä»»åŠ¡-Cron-Jobs" class="headerlink" title="8 å®šæ—¶ä»»åŠ¡(Cron Jobs)"></a>8 å®šæ—¶ä»»åŠ¡(Cron Jobs)</h2><p>cronæ˜¯Linuxä¸­ç”¨äºå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„å·¥å…·ã€‚é€šè¿‡cronæœåŠ¡ï¼Œå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´è‡ªåŠ¨è¿è¡Œç¨‹åºï¼Œè¿™å¯¹äºéœ€è¦æ¯æ—¥æˆ–å®šæœŸæ‰§è¡Œçš„è„šæœ¬å°¤å…¶æœ‰ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä½äº<code>/home/pete/scripts/change_wallpaper</code>çš„è„šæœ¬ï¼Œå¸Œæœ›æ¯å¤©æ—©æ™¨ç”¨å®ƒæ¥æ›´æ¢å£çº¸ã€‚ä½†ç›®å‰æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªcronä½œä¸šï¼Œåœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">30 08 * * * /home/pete/scripts/change_wallpaper<br></code></pre></td></tr></table></figure><p>å„å­—æ®µä»å·¦è‡³å³åˆ†åˆ«è¡¨ç¤ºï¼š</p><ul><li>åˆ†é’Ÿï¼ˆ0-59ï¼‰</li><li>å°æ—¶ï¼ˆ0-23ï¼‰</li><li>æœˆä»½ä¸­çš„æŸä¸€å¤©ï¼ˆ1-31ï¼‰</li><li>æœˆï¼ˆ1-12ï¼‰</li><li>æ˜ŸæœŸå‡ ï¼ˆ0-7ï¼‰ï¼Œå…¶ä¸­0å’Œ7å‡ä»£è¡¨æ˜ŸæœŸæ—¥</li></ul><p>æ˜Ÿå·(*)è¡¨ç¤ºåŒ¹é…æ‰€æœ‰å¯èƒ½å€¼ã€‚å› æ­¤ï¼Œä¸Šè¿°ç¤ºä¾‹å°†åœ¨æ¯å¤©çš„ä¸Šåˆ8:30æ‰§è¡Œã€‚</p><p>è¦åˆ›å»ºcronä½œä¸šï¼Œåªéœ€ç¼–è¾‘crontabæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crontab -e<br></code></pre></td></tr></table></figure><p>è¿™å°†æ‰“å¼€å½“å‰ç”¨æˆ·çš„cronä½œä¸šåˆ—è¡¨ï¼Œå¯ä»¥åœ¨æ­¤æ·»åŠ æ–°çš„ä½œä¸šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Init</title>
    <link href="/2025/03/22/Linux-Init/"/>
    <url>/2025/03/22/Linux-Init/</url>
    
    <content type="html"><![CDATA[<h1 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h1><h2 id="1-System-Væ¦‚è¿°"><a href="#1-System-Væ¦‚è¿°" class="headerlink" title="1 System Væ¦‚è¿°"></a>1 System Væ¦‚è¿°</h2><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œinitçš„ä¸»è¦èŒè´£æ˜¯å¯åŠ¨å’Œåœæ­¢å¿…è¦çš„è¿›ç¨‹ã€‚å­˜åœ¨ä¸‰ç§ä¸»è¦çš„initå®ç°ï¼šSystem Vã€Upstartå’Œsystemdã€‚</p><h4 id="å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„æ˜¯Sys-V"><a href="#å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„æ˜¯Sys-V" class="headerlink" title="å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„æ˜¯Sys V"></a>å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„æ˜¯Sys V</h4><p>å¦‚æœç³»ç»ŸåŒ…å«<code>/etc/inittab</code>æ–‡ä»¶ï¼Œåˆ™å¾ˆå¯èƒ½æ­£åœ¨è¿è¡ŒSys V initã€‚</p><h4 id="Sys-Vçš„å·¥ä½œåŸç†"><a href="#Sys-Vçš„å·¥ä½œåŸç†" class="headerlink" title="Sys Vçš„å·¥ä½œåŸç†"></a>Sys Vçš„å·¥ä½œåŸç†</h4><p>Sys Vé€šè¿‡é¡ºåºæ‰§è¡Œè„šæœ¬æ¥å¯åŠ¨æˆ–åœæ­¢æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œè‹¥è¦å¯åŠ¨åä¸ºfoo-açš„æœåŠ¡ï¼Œå¿…é¡»ç¡®ä¿åœ¨æ­¤ä¹‹å‰foo-bæœªè¢«æ¿€æ´»ï¼Œå› ä¸ºfoo-bä¾èµ–äºfoo-açš„è¿è¡ŒçŠ¶æ€ã€‚Sys Våˆ©ç”¨é¢„å…ˆç¼–å†™å¥½çš„è„šæœ¬å®Œæˆè¿™äº›æ“ä½œï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è„šæœ¬ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„è„šæœ¬ä»¥åŠ è½½å…³é”®æœåŠ¡ã€‚</p><p>Sys Vçš„ä¼˜åŠ¿åœ¨äºè§£å†³ä¾èµ–å…³ç³»ç›¸å¯¹ç®€å•ï¼Œç”±äºæ˜ç¡®çŸ¥é“foo-aåº”åœ¨foo-bä¹‹å‰å¯åŠ¨ã€‚ç„¶è€Œï¼Œå…¶ç¼ºç‚¹æ˜¯æ€§èƒ½ä¸ä½³ï¼Œå› ä¸ºé€šå¸¸åªèƒ½é¡ºåºåœ°å¯åŠ¨æˆ–åœæ­¢å•ä¸ªæœåŠ¡ã€‚</p><h4 id="è¿è¡Œçº§åˆ«"><a href="#è¿è¡Œçº§åˆ«" class="headerlink" title="è¿è¡Œçº§åˆ«"></a>è¿è¡Œçº§åˆ«</h4><p>Sys Vä½¿ç”¨ä»0åˆ°6çš„è¿è¡Œçº§åˆ«æ¥å®šä¹‰ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>0: å…³æœº</li><li>1: å•ç”¨æˆ·æ¨¡å¼</li><li>2: å¤šç”¨æˆ·æ¨¡å¼ï¼Œæ— ç½‘ç»œè¿æ¥</li><li>3: å¤šç”¨æˆ·æ¨¡å¼ï¼Œæœ‰ç½‘ç»œè¿æ¥</li><li>4: æœªä½¿ç”¨</li><li>5: å¤šç”¨æˆ·æ¨¡å¼ï¼Œæœ‰ç½‘ç»œè¿æ¥åŠå›¾å½¢ç•Œé¢</li><li>6: é‡å¯</li></ul><p>ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæ ¹æ®è®¾å®šçš„è¿è¡Œçº§åˆ«æ‰§è¡Œç›¸åº”çš„é…ç½®è„šæœ¬ã€‚è¿™äº›è„šæœ¬å­˜æ”¾åœ¨<code>/etc/rc.d/rc[è¿è¡Œçº§åˆ«ç¼–å·].d/</code>æˆ–<code>/etc/init.d</code>ç›®å½•ä¸‹ã€‚ä»¥Sï¼ˆStartï¼‰æˆ–Kï¼ˆKillï¼‰å¼€å¤´çš„è„šæœ¬åˆ†åˆ«åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–å…³é—­æ—¶æ‰§è¡Œï¼Œéšåçš„æ•°å­—è¡¨ç¤ºæ‰§è¡Œé¡ºåºã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æŸ¥çœ‹è¿è¡Œçº§åˆ«0ï¼ˆå…³æœºæ¨¡å¼ï¼‰ä¸‹çš„è„šæœ¬åˆ—è¡¨æ—¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:/etc/rc.d/rc0.d$ <span class="hljs-built_in">ls</span><br>K10updates  K80openvpn<br></code></pre></td></tr></table></figure><p>è¿™è¡¨æ˜ï¼Œåœ¨åˆ‡æ¢è‡³è¿è¡Œçº§åˆ«0æ—¶ï¼Œç³»ç»Ÿå°†å°è¯•é¦–å…ˆç»ˆæ­¢updatesæœåŠ¡ï¼Œç„¶åæ˜¯openvpnæœåŠ¡ã€‚</p><p>é»˜è®¤è¿è¡Œçº§åˆ«å¯ä»¥åœ¨<code>/etc/inittab</code>æ–‡ä»¶ä¸­æŸ¥çœ‹æˆ–ä¿®æ”¹ã€‚</p><h2 id="2-System-VæœåŠ¡"><a href="#2-System-VæœåŠ¡" class="headerlink" title="2 System VæœåŠ¡"></a>2 System VæœåŠ¡</h2><p>åœ¨Sys Vç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šç§å‘½ä»¤è¡Œå·¥å…·æ¥ç®¡ç†æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„æ“ä½œç¤ºä¾‹ï¼š</p><h4 id="åˆ—å‡ºæ‰€æœ‰æœåŠ¡çŠ¶æ€"><a href="#åˆ—å‡ºæ‰€æœ‰æœåŠ¡çŠ¶æ€" class="headerlink" title="åˆ—å‡ºæ‰€æœ‰æœåŠ¡çŠ¶æ€"></a>åˆ—å‡ºæ‰€æœ‰æœåŠ¡çŠ¶æ€</h4><p>ä½¿ç”¨<code>service --status-all</code>å‘½ä»¤å¯ä»¥åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰æœåŠ¡çš„çŠ¶æ€ã€‚æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºæ¯ä¸ªæœåŠ¡çš„å½“å‰çŠ¶æ€ï¼ˆè¿è¡Œä¸­æˆ–å·²åœæ­¢ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ service --status-all<br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h4><p>è¦å¯åŠ¨ä¸€ä¸ªç‰¹å®šçš„æœåŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> service networking start<br></code></pre></td></tr></table></figure><h4 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h4><p>è‹¥éœ€è¦åœæ­¢æŸä¸ªæ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨<code>service</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> service networking stop<br></code></pre></td></tr></table></figure><h4 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h4><p>ä¸ºäº†é‡æ–°åŠ è½½é…ç½®æˆ–åº”ç”¨æ›´æ”¹ï¼Œé€šå¸¸éœ€è¦é‡å¯æœåŠ¡ã€‚è¿™å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> service networking restart<br></code></pre></td></tr></table></figure><p>è¿™äº›å‘½ä»¤ä¸ä»…é€‚ç”¨äºSys V initç³»ç»Ÿï¼Œä¹Ÿå…¼å®¹UpstartæœåŠ¡ç®¡ç†ç³»ç»Ÿã€‚å°½ç®¡Linuxæ­£é€æ­¥æ·˜æ±°ä¼ ç»Ÿçš„Sys Våˆå§‹åŒ–è„šæœ¬ï¼Œä½†ä¸ºäº†å¹³æ»‘è¿‡æ¸¡ï¼Œç›®å‰ä»ä¿ç•™äº†å¯¹è¿™äº›å‘½ä»¤çš„æ”¯æŒã€‚</p><h2 id="3-Upstartæ¦‚è¿°"><a href="#3-Upstartæ¦‚è¿°" class="headerlink" title="3 Upstartæ¦‚è¿°"></a>3 Upstartæ¦‚è¿°</h2><p>Upstartç”±Canonicalå…¬å¸å¼€å‘ï¼Œæ›¾ç»æ˜¯Ubuntuä¸Šçš„åˆå§‹åŒ–å®ç°ã€‚ç„¶è€Œï¼Œåœ¨ç°ä»£çš„Ubuntuå®‰è£…ä¸­ï¼Œsystemdå·²ç»å–ä»£äº†å®ƒã€‚Upstartæ—¨åœ¨è§£å†³Sys Vå­˜åœ¨çš„é—®é¢˜ï¼Œå¦‚ä¸¥æ ¼çš„å¯åŠ¨æµç¨‹ã€ä»»åŠ¡é˜»å¡ç­‰ï¼Œå…¶äº‹ä»¶å’Œä½œä¸šé©±åŠ¨æ¨¡å‹ä½¿å…¶èƒ½å¤Ÿå®æ—¶å“åº”å‘ç”Ÿçš„äº‹ä»¶ã€‚</p><p>è‹¥ç³»ç»ŸåŒ…å«<code>/usr/share/upstart</code>ç›®å½•ï¼Œåˆ™å¾ˆå¯èƒ½æ˜¯ä½¿ç”¨Upstartçš„ç³»ç»Ÿã€‚</p><p>åœ¨Upstartä¸­ï¼Œ<strong>ä½œä¸š</strong>æ˜¯æŒ‡æ‰§è¡Œçš„åŠ¨ä½œï¼Œè€Œ<strong>äº‹ä»¶</strong>åˆ™æ˜¯ä»å…¶ä»–è¿›ç¨‹æ¥æ”¶çš„æ¶ˆæ¯ï¼Œç”¨ä»¥è§¦å‘è¿™äº›ä½œä¸šã€‚è¦æŸ¥çœ‹ä½œä¸šåˆ—è¡¨åŠå…¶é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŸ¥é˜…<code>/etc/init</code>ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox:~$ <span class="hljs-built_in">ls</span> /etc/init<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºå¯èƒ½åŒ…æ‹¬ï¼š</p><ul><li><code>acpid.conf</code></li><li><code>mountnfs.sh.conf</code></li><li><code>alsa-restore.conf</code></li><li><code>networking.conf</code></li><li>â€¦</li></ul><p>åœ¨è¿™äº›é…ç½®æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†å¦‚ä½•ä»¥åŠä½•æ—¶å¯åŠ¨ä½œä¸šã€‚ä¾‹å¦‚ï¼Œåœ¨<code>networking.conf</code>æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">start on runlevel [235]<br>stop on runlevel [0]<br></code></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€åœ¨ç½‘ç»œè¿è¡Œçº§åˆ«2ã€3æˆ–5æ—¶å¯åŠ¨ç½‘ç»œè®¾ç½®ï¼Œå¹¶åœ¨ç½‘ç»œè¿è¡Œçº§åˆ«0æ—¶åœæ­¢ç½‘ç»œæœåŠ¡ã€‚é…ç½®æ–‡ä»¶çš„ç¼–å†™æ–¹å¼å¤šæ ·ï¼Œå…·ä½“å–å†³äºä¸åŒçš„ä½œä¸šéœ€æ±‚ã€‚</p><h4 id="Upstartå·¥ä½œåŸç†"><a href="#Upstartå·¥ä½œåŸç†" class="headerlink" title="Upstartå·¥ä½œåŸç†"></a>Upstartå·¥ä½œåŸç†</h4><ol><li><strong>åŠ è½½ä½œä¸šé…ç½®</strong>ï¼šé¦–å…ˆï¼ŒUpstartä»<code>/etc/init</code>åŠ è½½ä½œä¸šé…ç½®ã€‚</li><li><strong>å“åº”å¯åŠ¨äº‹ä»¶</strong>ï¼šä¸€æ—¦å‘ç”Ÿå¯åŠ¨äº‹ä»¶ï¼Œä¸è¯¥äº‹ä»¶ç›¸å…³çš„ä½œä¸šå°†è¢«æ‰§è¡Œã€‚</li><li><strong>äº‹ä»¶é“¾å¼ååº”</strong>ï¼šæ‰§è¡Œçš„ä½œä¸šä¼šäº§ç”Ÿæ–°çš„äº‹ä»¶ï¼Œè¿›è€Œè§¦å‘æ›´å¤šçš„ä½œä¸šã€‚</li><li><strong>å¾ªç¯ç›´è‡³å®Œæˆ</strong>ï¼šæ­¤è¿‡ç¨‹æŒç»­è¿›è¡Œç›´åˆ°æ‰€æœ‰å¿…è¦çš„ä½œä¸šéƒ½å·²å®Œæˆã€‚</li></ol><h2 id="4-Upstartä½œä¸šç®¡ç†"><a href="#4-Upstartä½œä¸šç®¡ç†" class="headerlink" title="4 Upstartä½œä¸šç®¡ç†"></a>4 Upstartä½œä¸šç®¡ç†</h2><p>å°½ç®¡Upstartèƒ½å¤Ÿè§¦å‘ä¼—å¤šäº‹ä»¶å’Œä½œä¸šçš„è¿è¡Œï¼Œä½†æ²¡æœ‰ç®€ä¾¿çš„æ–¹æ³•å¯ä»¥ç›´æ¥æŸ¥çœ‹æŸä¸€äº‹ä»¶æˆ–ä½œä¸šçš„æ¥æºã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç›´æ¥æŸ¥é˜…<code>/etc/init</code>ä¸­çš„ä½œä¸šé…ç½®æ–‡ä»¶å¹¶éå¿…è¦ï¼Œä½†åœ¨éœ€è¦å¯¹ç‰¹å®šä½œä¸šè¿›è¡Œæ›´ç²¾ç»†æ§åˆ¶æ—¶ï¼Œåˆ™éœ€äº†è§£ä¸€äº›å®ç”¨å‘½ä»¤ã€‚</p><h4 id="æŸ¥çœ‹æ‰€æœ‰ä½œä¸šçŠ¶æ€"><a href="#æŸ¥çœ‹æ‰€æœ‰ä½œä¸šçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰ä½œä¸šçŠ¶æ€"></a>æŸ¥çœ‹æ‰€æœ‰ä½œä¸šçŠ¶æ€</h4><p>ä½¿ç”¨<code>initctl list</code>å‘½ä»¤å¯ä»¥åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰Upstartä½œä¸šåŠå…¶å½“å‰çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">initctl list<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">shutdown stop/waiting<br>console stop/waiting<br>...<br></code></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªä½œä¸šï¼Œå…¶ä¸­ç¬¬ä¸€å€¼ä¸ºä½œä¸šåç§°ï¼Œç¬¬äºŒå­—æ®µï¼ˆæ–œæ å‰ï¼‰è¡¨ç¤ºä½œä¸šçš„ç›®æ ‡çŠ¶æ€ï¼Œç¬¬ä¸‰å€¼ï¼ˆæ–œæ åï¼‰åˆ™æ˜¾ç¤ºå½“å‰çŠ¶æ€ã€‚</p><h4 id="æŸ¥çœ‹ç‰¹å®šä½œä¸šçŠ¶æ€"><a href="#æŸ¥çœ‹ç‰¹å®šä½œä¸šçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ç‰¹å®šä½œä¸šçŠ¶æ€"></a>æŸ¥çœ‹ç‰¹å®šä½œä¸šçŠ¶æ€</h4><p>è¦æ£€æŸ¥æŸä¸ªå…·ä½“ä½œä¸šçš„çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨<code>initctl status</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">initctl status networking<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">networking <span class="hljs-keyword">start</span><span class="hljs-operator">/</span><span class="hljs-keyword">running</span><br></code></pre></td></tr></table></figure><h4 id="ä½œä¸šçš„æ‰‹åŠ¨æ“ä½œ"><a href="#ä½œä¸šçš„æ‰‹åŠ¨æ“ä½œ" class="headerlink" title="ä½œä¸šçš„æ‰‹åŠ¨æ“ä½œ"></a>ä½œä¸šçš„æ‰‹åŠ¨æ“ä½œ</h4><ul><li><strong>å¯åŠ¨ä½œä¸š</strong>ï¼š  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> initctl start networking<br></code></pre></td></tr></table></figure></li><li><strong>åœæ­¢ä½œä¸š</strong>ï¼š  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> initctl stop networking<br></code></pre></td></tr></table></figure></li><li><strong>é‡å¯ä½œä¸š</strong>ï¼š  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> initctl restart networking<br></code></pre></td></tr></table></figure></li></ul><h4 id="æ‰‹åŠ¨å‘å‡ºäº‹ä»¶"><a href="#æ‰‹åŠ¨å‘å‡ºäº‹ä»¶" class="headerlink" title="æ‰‹åŠ¨å‘å‡ºäº‹ä»¶"></a>æ‰‹åŠ¨å‘å‡ºäº‹ä»¶</h4><p>è‹¥è¦æ‰‹åŠ¨è§¦å‘æŸä¸€äº‹ä»¶ä»¥å¯åŠ¨å…¶ä»–ä½œä¸šï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> initctl emit some_event<br></code></pre></td></tr></table></figure><h2 id="5-Systemdæ¦‚è¿°"><a href="#5-Systemdæ¦‚è¿°" class="headerlink" title="5 Systemdæ¦‚è¿°"></a>5 Systemdæ¦‚è¿°</h2><p>Systemdæ­£é€æ¸æˆä¸ºinitç³»ç»Ÿçš„æ–°æ ‡å‡†ã€‚è‹¥ç³»ç»Ÿä¸­å­˜åœ¨<code>/usr/lib/systemd</code>ç›®å½•ï¼Œåˆ™è¡¨æ˜å¾ˆå¯èƒ½æ­£åœ¨ä½¿ç”¨Systemdã€‚</p><h4 id="å·¥ä½œæœºåˆ¶ä¸å¯åŠ¨æµç¨‹"><a href="#å·¥ä½œæœºåˆ¶ä¸å¯åŠ¨æµç¨‹" class="headerlink" title="å·¥ä½œæœºåˆ¶ä¸å¯åŠ¨æµç¨‹"></a>å·¥ä½œæœºåˆ¶ä¸å¯åŠ¨æµç¨‹</h4><p>Systemdé€šè¿‡è®¾å®šç›®æ ‡æ¥å¼•å¯¼ç³»ç»Ÿè¿è¡Œï¼Œæ¯ä¸ªç›®æ ‡éƒ½æœ‰å…¶ä¾èµ–é¡¹ï¼Œè¿™äº›ä¾èµ–é¡¹ä¹Ÿéœ€è¦è¢«æ¿€æ´»ã€‚Systemdçš„çµæ´»æ€§å’Œå¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒä¸éµå¾ªä¸¥æ ¼çš„é¡ºåºæ¥å¯åŠ¨è¿›ç¨‹ã€‚å…¸å‹çš„Systemdå¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>åŠ è½½é…ç½®æ–‡ä»¶</strong>ï¼šé€šå¸¸ä½äº<code>/etc/systemd/system</code>æˆ–<code>/usr/lib/systemd/system</code>ã€‚</li><li><strong>ç¡®å®šå¯åŠ¨ç›®æ ‡</strong>ï¼šé»˜è®¤ä¸º<code>default.target</code>ã€‚</li><li><strong>è§£æå¹¶æ¿€æ´»ä¾èµ–</strong>ï¼šSystemdè¯†åˆ«å¯åŠ¨ç›®æ ‡çš„ä¾èµ–å…³ç³»ï¼Œå¹¶æ¿€æ´»å®ƒä»¬ã€‚</li></ol><p>ç±»ä¼¼äºSys Vçš„è¿è¡Œçº§åˆ«ï¼ŒSystemdå¯ä»¥å¼•å¯¼è¿›å…¥ä¸åŒçš„ç›®æ ‡ï¼š</p><ul><li><code>poweroff.target</code>ï¼šå…³é—­ç³»ç»Ÿ</li><li><code>rescue.target</code>ï¼šå•ç”¨æˆ·æ¨¡å¼</li><li><code>multi-user.target</code>ï¼šå¤šç”¨æˆ·æ¨¡å¼ï¼ˆå¸¦ç½‘ç»œï¼‰</li><li><code>graphical.target</code>ï¼šå›¾å½¢ç•Œé¢ï¼ˆåŸºäºå¤šç”¨æˆ·æ¨¡å¼ï¼‰</li><li><code>reboot.target</code>ï¼šé‡å¯</li></ul><p>å…¶ä¸­ï¼Œé»˜è®¤å¯åŠ¨ç›®æ ‡<code>default.target</code>é€šå¸¸æŒ‡å‘<code>graphical.target</code>ã€‚</p><h4 id="Units"><a href="#Units" class="headerlink" title="Units"></a>Units</h4><p>Systemdæ“ä½œçš„æ ¸å¿ƒå¯¹è±¡ç§°ä¸ºâ€œunitsâ€ã€‚é™¤äº†æœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢å¤–ï¼ŒSystemdè¿˜èƒ½å¤ŸæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€ç›‘æ§ç½‘ç»œå¥—æ¥å­—ç­‰ï¼Œå› æ­¤å®ƒæ”¯æŒå¤šç§ç±»å‹çš„å•å…ƒï¼š</p><ul><li><strong>æœåŠ¡å•å…ƒ</strong>ï¼ˆService unitsï¼‰ï¼šç”¨äºå¯åŠ¨å’Œåœæ­¢æœåŠ¡ï¼Œæ–‡ä»¶æ‰©å±•åä¸º<code>.service</code>ã€‚</li><li><strong>æŒ‚è½½å•å…ƒ</strong>ï¼ˆMount unitsï¼‰ï¼šç”¨äºæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶æ‰©å±•åä¸º<code>.mount</code>ã€‚</li><li><strong>ç›®æ ‡å•å…ƒ</strong>ï¼ˆTarget unitsï¼‰ï¼šç”¨äºç»„ç»‡å…¶ä»–å•å…ƒï¼Œæ–‡ä»¶æ‰©å±•åä¸º<code>.target</code>ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å¯åŠ¨è‡³<code>default.target</code>æ—¶ï¼Œè¯¥ç›®æ ‡ä¼šç»„åˆåŒ…æ‹¬<code>networking.service</code>å’Œ<code>crond.service</code>åœ¨å†…çš„å¤šä¸ªå•å…ƒã€‚è¿™æ„å‘³ç€ä¸€æ—¦æ¿€æ´»ä¸€ä¸ªç‰¹å®šå•å…ƒï¼Œè¯¥å•å…ƒä¸‹çš„æ‰€æœ‰ç›¸å…³è”å•å…ƒä¹Ÿä¼šè¢«æ¿€æ´»ã€‚</p><h2 id="6-Systemdç›®æ ‡"><a href="#6-Systemdç›®æ ‡" class="headerlink" title="6 Systemdç›®æ ‡"></a>6 Systemdç›®æ ‡</h2><h4 id="åŸºæœ¬æœåŠ¡å•å…ƒæ–‡ä»¶ç¤ºä¾‹ï¼šfoobar-service"><a href="#åŸºæœ¬æœåŠ¡å•å…ƒæ–‡ä»¶ç¤ºä¾‹ï¼šfoobar-service" class="headerlink" title="åŸºæœ¬æœåŠ¡å•å…ƒæ–‡ä»¶ç¤ºä¾‹ï¼šfoobar.service"></a>åŸºæœ¬æœåŠ¡å•å…ƒæ–‡ä»¶ç¤ºä¾‹ï¼š<code>foobar.service</code></h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=My Foobar Service<br><span class="hljs-attr">Before</span>=bar.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">ExecStart</span>=/usr/bin/foobar<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æœåŠ¡å•å…ƒæ–‡ä»¶ã€‚åœ¨æ–‡ä»¶å¼€å¤´çš„<code>[Unit]</code>éƒ¨åˆ†ï¼Œå¯ä»¥ä¸ºå•å…ƒæ–‡ä»¶æ·»åŠ æè¿°ï¼Œå¹¶æ§åˆ¶è¯¥å•å…ƒç›¸å¯¹äºå…¶ä»–å•å…ƒçš„æ¿€æ´»é¡ºåºã€‚æ¥ä¸‹æ¥çš„<code>[Service]</code>éƒ¨åˆ†å®šä¹‰äº†å¯åŠ¨ã€åœæ­¢æˆ–é‡æ–°åŠ è½½æœåŠ¡çš„å…·ä½“å‘½ä»¤ã€‚æœ€åï¼Œ<code>[Install]</code>éƒ¨åˆ†ç”¨äºæŒ‡å®šä¾èµ–å…³ç³»ï¼Œå†³å®šåœ¨å“ªäº›ç›®æ ‡ä¸‹è‡ªåŠ¨å¯ç”¨æ­¤å•å…ƒã€‚</p><h4 id="å¸¸ç”¨Systemdå‘½ä»¤"><a href="#å¸¸ç”¨Systemdå‘½ä»¤" class="headerlink" title="å¸¸ç”¨Systemdå‘½ä»¤"></a>å¸¸ç”¨Systemdå‘½ä»¤</h4><p>ä»¥ä¸‹æ˜¯ä¸Systemdå•å…ƒäº¤äº’æ—¶å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤ï¼š</p><ul><li><p><strong>åˆ—å‡ºæ‰€æœ‰å•å…ƒ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ systemctl list-units<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å•å…ƒçŠ¶æ€</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ systemctl status networking.service<br></code></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨æœåŠ¡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> systemctl start networking.service<br></code></pre></td></tr></table></figure></li><li><p><strong>åœæ­¢æœåŠ¡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> systemctl stop networking.service<br></code></pre></td></tr></table></figure></li><li><p><strong>é‡å¯æœåŠ¡</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> systemctl restart networking.service<br></code></pre></td></tr></table></figure></li><li><p><strong>å¯ç”¨å•å…ƒï¼ˆè®¾ç½®ä¸ºå¼€æœºè‡ªå¯ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> networking.service<br></code></pre></td></tr></table></figure></li><li><p><strong>ç¦ç”¨å•å…ƒï¼ˆå–æ¶ˆå¼€æœºè‡ªå¯ï¼‰</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">disable</span> networking.service<br></code></pre></td></tr></table></figure></li></ul><h2 id="7-ç³»ç»Ÿç”µæºçŠ¶æ€ç®¡ç†"><a href="#7-ç³»ç»Ÿç”µæºçŠ¶æ€ç®¡ç†" class="headerlink" title="7 ç³»ç»Ÿç”µæºçŠ¶æ€ç®¡ç†"></a>7 ç³»ç»Ÿç”µæºçŠ¶æ€ç®¡ç†</h2><h4 id="å…³é—­ç³»ç»Ÿ"><a href="#å…³é—­ç³»ç»Ÿ" class="headerlink" title="å…³é—­ç³»ç»Ÿ"></a>å…³é—­ç³»ç»Ÿ</h4><p>è¦ç«‹å³å…³é—­ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> shutdown -h now<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†ä½¿ç³»ç»Ÿåœæœºï¼ˆæ–­ç”µï¼‰ï¼Œå¹¶éœ€è¦æŒ‡å®šæ‰§è¡Œæ—¶é—´ã€‚æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ å…·ä½“åˆ†é’Ÿæ•°æ¥è®¾ç½®ç³»ç»Ÿåœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹è‡ªåŠ¨å…³æœºã€‚</p><p>ä¾‹å¦‚ï¼Œè‹¥è¦åœ¨ä¸¤åˆ†é’Ÿåå…³æœºï¼Œå¯ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> shutdown -h +2<br></code></pre></td></tr></table></figure><h4 id="é‡å¯ç³»ç»Ÿ"><a href="#é‡å¯ç³»ç»Ÿ" class="headerlink" title="é‡å¯ç³»ç»Ÿ"></a>é‡å¯ç³»ç»Ÿ</h4><p>ä½¿ç”¨<code>shutdown</code>å‘½ä»¤é‡å¯ç³»ç»Ÿï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> shutdown -r now<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œç›´æ¥ä½¿ç”¨<code>reboot</code>å‘½ä»¤è¿›è¡Œé‡å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> reboot<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Kernel</title>
    <link href="/2025/03/22/Linux-Kernel/"/>
    <url>/2025/03/22/Linux-Kernel/</url>
    
    <content type="html"><![CDATA[<h1 id="Kernel"><a href="#Kernel" class="headerlink" title="Kernel"></a>Kernel</h1><h2 id="1-å†…æ ¸æ¦‚è¿°"><a href="#1-å†…æ ¸æ¦‚è¿°" class="headerlink" title="1 å†…æ ¸æ¦‚è¿°"></a>1 å†…æ ¸æ¦‚è¿°</h2><p>Linuxæ“ä½œç³»ç»Ÿå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæŠ½è±¡å±‚æ¬¡ã€‚</p><h4 id="ç¡¬ä»¶å±‚"><a href="#ç¡¬ä»¶å±‚" class="headerlink" title="ç¡¬ä»¶å±‚"></a>ç¡¬ä»¶å±‚</h4><p>æœ€åŸºç¡€çš„å±‚æ¬¡æ˜¯ç¡¬ä»¶ï¼ŒåŒ…æ‹¬CPUã€å†…å­˜ã€ç¡¬ç›˜ã€ç½‘ç»œç«¯å£ç­‰ã€‚è¿™æ˜¯å®é™…æ‰§è¡Œè®¡ç®—ä»»åŠ¡çš„ç‰©ç†å±‚ã€‚</p><h4 id="å†…æ ¸å±‚"><a href="#å†…æ ¸å±‚" class="headerlink" title="å†…æ ¸å±‚"></a>å†…æ ¸å±‚</h4><p>ä¸‹ä¸€ä¸ªå±‚æ¬¡æ˜¯å†…æ ¸ï¼Œè´Ÿè´£è¿›ç¨‹ä¸å†…å­˜ç®¡ç†ã€è®¾å¤‡é€šä¿¡ã€ç³»ç»Ÿè°ƒç”¨ã€æ–‡ä»¶ç³»ç»Ÿè®¾ç½®ç­‰å·¥ä½œã€‚å†…æ ¸çš„ä»»åŠ¡æ˜¯ä¸ç¡¬ä»¶äº¤äº’ï¼Œç¡®ä¿ç¡¬ä»¶æŒ‰ç…§æˆ‘ä»¬çš„éœ€æ±‚è¿è¡Œå„ä¸ªè¿›ç¨‹ã€‚</p><h4 id="ç”¨æˆ·ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´"></a>ç”¨æˆ·ç©ºé—´</h4><p>åŒ…å«äº†Shellã€è¿è¡Œçš„å„ç§ç¨‹åºä»¥åŠå›¾å½¢ç•Œé¢ç­‰ã€‚</p><h2 id="2-ç‰¹æƒçº§åˆ«"><a href="#2-ç‰¹æƒçº§åˆ«" class="headerlink" title="2 ç‰¹æƒçº§åˆ«"></a>2 ç‰¹æƒçº§åˆ«</h2><h4 id="ä¸ºä½•åŒºåˆ†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ï¼Ÿ"><a href="#ä¸ºä½•åŒºåˆ†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ï¼Ÿ" class="headerlink" title="ä¸ºä½•åŒºåˆ†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ï¼Ÿ"></a>ä¸ºä½•åŒºåˆ†ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ï¼Ÿ</h4><p>ä¸ºä»€ä¹ˆç”¨æˆ·ç©ºé—´å’Œå†…æ ¸è¦åˆ†ä¸ºä¸åŒçš„æŠ½è±¡å±‚ï¼Ÿä¸ºä½•ä¸èƒ½å°†ä¸¤è€…åˆå¹¶ä¸ºä¸€ä¸ªå±‚æ¬¡ï¼Ÿè¿™ä¸¤ä¸ªå±‚æ¬¡åˆ†å¼€å­˜åœ¨æœ‰å…¶å……åˆ†çš„ç†ç”±ï¼šå®ƒä»¬åœ¨ä¸åŒçš„æ¨¡å¼ä¸‹è¿è¡Œã€‚å†…æ ¸å·¥ä½œäºå†…æ ¸æ¨¡å¼ï¼Œè€Œç”¨æˆ·ç©ºé—´åˆ™å·¥ä½œäºç”¨æˆ·æ¨¡å¼ã€‚</p><p>åœ¨å†…æ ¸æ¨¡å¼ä¸‹ï¼Œå†…æ ¸å¯¹ç¡¬ä»¶æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™ï¼Œå¹¶æ§åˆ¶æ‰€æœ‰æ“ä½œã€‚è€Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œä»…å…è®¸è®¿é—®ä¸€å°éƒ¨åˆ†å®‰å…¨å†…å­˜å’ŒCPUèµ„æºã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“éœ€è¦æ‰§è¡Œæ¶‰åŠç¡¬ä»¶çš„æ“ä½œï¼Œå¦‚ä»ç£ç›˜è¯»å–æ•°æ®ã€å‘ç£ç›˜å†™å…¥æ•°æ®æˆ–æ§åˆ¶ç½‘ç»œç­‰ï¼Œéƒ½éœ€åœ¨å†…æ ¸æ¨¡å¼ä¸‹å®Œæˆã€‚è¿™æ ·åšæ˜¯å¿…è¦çš„ï¼Œä»¥é˜²æ­¢æ¶æ„è½¯ä»¶ç›´æ¥è®¿é—®ç³»ç»Ÿç¡¬ä»¶ï¼Œé¿å…å¯èƒ½çš„æ•°æ®æ³„éœ²æˆ–å…¶ä»–å®‰å…¨éšæ‚£ã€‚</p><h4 id="ç‰¹æƒçº§åˆ«ä¸ä¿æŠ¤ç¯"><a href="#ç‰¹æƒçº§åˆ«ä¸ä¿æŠ¤ç¯" class="headerlink" title="ç‰¹æƒçº§åˆ«ä¸ä¿æŠ¤ç¯"></a>ç‰¹æƒçº§åˆ«ä¸ä¿æŠ¤ç¯</h4><p>è¿™äº›ä¸åŒçš„æ¨¡å¼è¢«ç§°ä¸ºç‰¹æƒçº§åˆ«ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¿æŠ¤ç¯ã€‚æœ€å†…å±‚çš„ç¯å¯¹åº”æœ€é«˜ç‰¹æƒçº§åˆ«ã€‚åœ¨x86æ¶æ„è®¡ç®—æœºä¸­ï¼Œä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼æˆ–çº§åˆ«ï¼šRing #3ä¸ºç”¨æˆ·æ¨¡å¼åº”ç”¨ç¨‹åºçš„ç‰¹æƒçº§åˆ«ï¼ŒRing #0ä¸ºå†…æ ¸çš„ç‰¹æƒçº§åˆ«ã€‚Ring #0èƒ½å¤Ÿæ‰§è¡Œä»»ä½•ç³»ç»ŸæŒ‡ä»¤ï¼Œå¹¶è·å¾—å®Œå…¨ä¿¡ä»»ã€‚</p><h4 id="ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨"></a>ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨</h4><p>ç³»ç»Ÿè°ƒç”¨ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨å†…æ ¸æ¨¡å¼ä¸‹æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œç„¶ååˆ‡æ¢å›ç”¨æˆ·æ¨¡å¼ã€‚è¿™ç§æ–¹å¼æ—¢ä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œåˆæä¾›äº†å¿…è¦çš„çµæ´»æ€§ï¼Œä½¿å¾—ç”¨æˆ·ç¨‹åºèƒ½å¤Ÿåœ¨å¿…è¦æ—¶é€šè¿‡å†…æ ¸ä¸ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚</p><h2 id="3-ç³»ç»Ÿè°ƒç”¨"><a href="#3-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="3 ç³»ç»Ÿè°ƒç”¨"></a>3 ç³»ç»Ÿè°ƒç”¨</h2><h4 id="ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨-1"><a href="#ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨-1" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨"></a>ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨</h4><p>ç³»ç»Ÿè°ƒç”¨ï¼ˆsyscallï¼‰ä¸ºç”¨æˆ·ç©ºé—´è¿›ç¨‹æä¾›äº†ä¸€ç§è¯·æ±‚å†…æ ¸ä¸ºæˆ‘ä»¬æ‰§è¡Œç‰¹å®šæ“ä½œçš„æ–¹æ³•ã€‚å†…æ ¸é€šè¿‡ç³»ç»Ÿè°ƒç”¨APIæä¾›æŸäº›æœåŠ¡ï¼Œè¿™äº›æœåŠ¡åŒ…æ‹¬è¯»å†™æ–‡ä»¶ã€è°ƒæ•´å†…å­˜ä½¿ç”¨é‡ã€ä¿®æ”¹ç½‘ç»œé…ç½®ç­‰ã€‚ç³»ç»Ÿè°ƒç”¨çš„æ•°é‡æ˜¯å›ºå®šçš„ï¼Œå› æ­¤ä¸èƒ½éšæ„æ·»åŠ æ–°çš„ç³»ç»Ÿè°ƒç”¨ï¼›ç³»ç»Ÿä¸­å·²æœ‰ä¸€å¼ åŒ…å«æ‰€æœ‰å¯ç”¨ç³»ç»Ÿè°ƒç”¨çš„è¡¨æ ¼ï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDã€‚</p><p>å½“è¿è¡Œå¦‚<code>ls</code>è¿™æ ·çš„ç¨‹åºæ—¶ï¼Œè¯¥ç¨‹åºå†…éƒ¨åŒ…å«äº†ç³»ç»Ÿè°ƒç”¨wrapperï¼Œå¹¶éç›´æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚æ­¤wrapperä¼šè§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼Œè¿›è€Œæ‰§è¡Œä¸€ä¸ªé™·é˜±ï¼ˆtrapï¼‰ï¼Œè¿™ä¸ªé™·é˜±ä¼šè¢«ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨æ•è·ï¼Œç„¶åæ ¹æ®ç³»ç»Ÿè°ƒç”¨IDåœ¨ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­æŸ¥æ‰¾ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å°è¯•è°ƒç”¨<code>stat()</code>ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå®ƒé€šè¿‡ç³»ç»Ÿè°ƒç”¨IDè¯†åˆ«ï¼Œç›®çš„æ˜¯æŸ¥è¯¢æ–‡ä»¶çŠ¶æ€ã€‚å½“å°è¯•è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ï¼Œå®Œæˆä¸€ç³»åˆ—æ“ä½œï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯æ ¹æ®ç³»ç»Ÿè°ƒç”¨IDæŸ¥æ‰¾å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨å¹¶æ‰§è¡Œæ‰€éœ€åŠŸèƒ½ã€‚å®Œæˆåï¼Œç³»ç»Ÿè¿”å›è‡³ç”¨æˆ·æ¨¡å¼ï¼Œè¿›ç¨‹å°†æ”¶åˆ°æˆåŠŸæˆ–é”™è¯¯çš„çŠ¶æ€ä¿¡æ¯ã€‚</p><h4 id="ä½¿ç”¨straceå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨"><a href="#ä½¿ç”¨straceå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ä½¿ç”¨straceå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨"></a>ä½¿ç”¨<code>strace</code>å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨</h4><p>å¯ä»¥ä½¿ç”¨<code>strace</code>å‘½ä»¤æ¥æŸ¥çœ‹è¿›ç¨‹æ‰€åšçš„ç³»ç»Ÿè°ƒç”¨ã€‚<code>strace</code>å‘½ä»¤å¯¹äºè°ƒè¯•ç¨‹åºæ‰§è¡Œéå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ strace <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>è¿™è¡Œå‘½ä»¤å¯ä»¥å±•ç¤º<code>ls</code>å‘½ä»¤æ‰§è¡ŒæœŸé—´æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨ç»†èŠ‚ï¼Œæœ‰åŠ©äºæ·±å…¥äº†è§£ç¨‹åºçš„è¿è¡Œæœºåˆ¶å’Œæ’æŸ¥é—®é¢˜ã€‚</p><h2 id="4-Kernel-Installation"><a href="#4-Kernel-Installation" class="headerlink" title="4 Kernel Installation"></a>4 Kernel Installation</h2><p>å¯ä»¥åœ¨ç³»ç»Ÿä¸Šå®‰è£…å¤šä¸ªå†…æ ¸ï¼Œå¹¶ä¸”åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­é€šè¿‡GRUBèœå•é€‰æ‹©è¦å¯åŠ¨çš„å†…æ ¸ã€‚</p><h4 id="æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬"><a href="#æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬"></a>æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬</h4><p>è¦æŸ¥çœ‹ç³»ç»Ÿä¸Šå·²å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uname</span> -r<br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤å°†è¾“å‡ºç±»ä¼¼<code>3.19.0-43-generic</code>çš„ä¿¡æ¯ã€‚<code>uname</code>å‘½ä»¤ç”¨äºæ‰“å°ç³»ç»Ÿä¿¡æ¯ï¼Œå‚æ•°<code>-r</code>ç”¨äºæ˜¾ç¤ºå†…æ ¸å‘å¸ƒç‰ˆæœ¬ã€‚</p><h4 id="å®‰è£…Linuxå†…æ ¸"><a href="#å®‰è£…Linuxå†…æ ¸" class="headerlink" title="å®‰è£…Linuxå†…æ ¸"></a>å®‰è£…Linuxå†…æ ¸</h4><p>å®‰è£…Linuxå†…æ ¸æœ‰å¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬ä»æºä»£ç ä¸‹è½½å¹¶ç¼–è¯‘ï¼Œæˆ–ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·è¿›è¡Œå®‰è£…ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡åŒ…ç®¡ç†å·¥å…·å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„å†…æ ¸ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> apt install linux-generic-lts-vivid<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œé‡å¯ç³»ç»Ÿå³å¯è¿›å…¥æ–°å®‰è£…çš„å†…æ ¸ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šå¸¸è¿˜éœ€è¦å®‰è£…å…¶ä»–ç›¸å…³è½¯ä»¶åŒ…ï¼Œå¦‚<code>linux-headers</code>ã€<code>linux-image-generic</code>ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šç¡®åˆ‡çš„ç‰ˆæœ¬å·ï¼Œå¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> apt install 3.19.0-43-generic<br></code></pre></td></tr></table></figure><p>å¦‚æœä»…éœ€æ›´æ–°åˆ°æœ€æ–°å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨<code>dist-upgrade</code>å‘½ä»¤æ¥å‡çº§ç³»ç»Ÿä¸Šçš„æ‰€æœ‰è½¯ä»¶åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> apt dist-upgrade<br></code></pre></td></tr></table></figure><h4 id="é€‰æ‹©åˆé€‚çš„å†…æ ¸ç‰ˆæœ¬"><a href="#é€‰æ‹©åˆé€‚çš„å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="é€‰æ‹©åˆé€‚çš„å†…æ ¸ç‰ˆæœ¬"></a>é€‰æ‹©åˆé€‚çš„å†…æ ¸ç‰ˆæœ¬</h4><p>å­˜åœ¨ä¼—å¤šä¸åŒçš„å†…æ ¸ç‰ˆæœ¬ï¼Œæœ‰äº›æä¾›é•¿æœŸæ”¯æŒï¼ˆLTSï¼Œlong term supportï¼‰ï¼Œè€Œå¦ä¸€äº›åˆ™æ˜¯æœ€æ–°çš„ç¨³å®šç‰ˆã€‚ä¸åŒå†…æ ¸ç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æ€§å¯èƒ½å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚</p><h2 id="5-å†…æ ¸ä½ç½®"><a href="#5-å†…æ ¸ä½ç½®" class="headerlink" title="5 å†…æ ¸ä½ç½®"></a>5 å†…æ ¸ä½ç½®</h2><p>å½“å®‰è£…ä¸€ä¸ªæ–°çš„å†…æ ¸æ—¶ï¼Œå®é™…ä¸Šä¼šåœ¨ç³»ç»Ÿä¸­æ·»åŠ å‡ ä¸ªæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸è¢«æ”¾ç½®åœ¨<code>/boot</code>ç›®å½•ä¸‹ã€‚</p><h4 id="å†…æ ¸ç›¸å…³æ–‡ä»¶"><a href="#å†…æ ¸ç›¸å…³æ–‡ä»¶" class="headerlink" title="å†…æ ¸ç›¸å…³æ–‡ä»¶"></a>å†…æ ¸ç›¸å…³æ–‡ä»¶</h4><p>åœ¨<code>/boot</code>ç›®å½•ä¸‹ï¼Œé’ˆå¯¹ä¸åŒçš„å†…æ ¸ç‰ˆæœ¬ï¼Œä¼šçœ‹åˆ°ä»¥ä¸‹å‡ ç§ç±»å‹çš„æ–‡ä»¶ï¼š</p><ul><li><p><strong>vmlinuz</strong>ï¼šè¿™æ˜¯å®é™…çš„Linuxå†…æ ¸æ˜ åƒã€‚æ¯ä¸ªç‰ˆæœ¬çš„å†…æ ¸éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<code>vmlinuz</code>æ–‡ä»¶ã€‚</p></li><li><p><strong>initrd</strong>ï¼š<code>initrd</code>æ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨åŠ è½½å†…æ ¸ä¹‹å‰ä½¿ç”¨ï¼Œä¸ºå†…æ ¸æä¾›å¿…è¦çš„é©±åŠ¨ç¨‹åºå’Œèµ„æºä»¥è®¿é—®å­˜å‚¨è®¾å¤‡ç­‰å…³é”®æœåŠ¡ã€‚</p></li><li><p><strong>System.map</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç¬¦å·æŸ¥æ‰¾è¡¨ï¼Œç”¨äºå°†å†…æ ¸ç¬¦å·ï¼ˆå¦‚å‡½æ•°åï¼‰æ˜ å°„åˆ°å®ƒä»¬åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚</p></li><li><p><strong>config</strong>ï¼šå†…æ ¸é…ç½®è®¾ç½®æ–‡ä»¶ã€‚å¦‚æœè‡ªå·±ç¼–è¯‘å†…æ ¸ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶è®¾å®šå¯ä»¥åŠ è½½å“ªäº›æ¨¡å—ã€‚</p></li></ul><h4 id="ç®¡ç†-bootç©ºé—´"><a href="#ç®¡ç†-bootç©ºé—´" class="headerlink" title="ç®¡ç†&#x2F;bootç©ºé—´"></a>ç®¡ç†&#x2F;bootç©ºé—´</h4><p>å¦‚æœ<code>/boot</code>ç›®å½•ç©ºé—´ä¸è¶³ï¼Œå¯ä»¥åˆ é™¤æ—§ç‰ˆæœ¬çš„ä¸Šè¿°æ–‡ä»¶æ¥é‡Šæ”¾ç©ºé—´ã€‚ä¸è¿‡ï¼Œåœ¨æ‰§è¡Œæ­¤ç±»ç»´æŠ¤æ“ä½œæ—¶éœ€æ ¼å¤–å°å¿ƒï¼Œç¡®ä¿ä¸ä¼šè¯¯åˆ å½“å‰æ­£åœ¨ä½¿ç”¨çš„å†…æ ¸ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒ…ç®¡ç†å™¨è¿›è¡Œæ¸…ç†å·¥ä½œï¼Œä½†åŒæ ·éœ€è¦æ³¨æ„é¿å…è¯¯æ“ä½œã€‚</p><h2 id="6-å†…æ ¸æ¨¡å—"><a href="#6-å†…æ ¸æ¨¡å—" class="headerlink" title="6 å†…æ ¸æ¨¡å—"></a>6 å†…æ ¸æ¨¡å—</h2><h4 id="å†…æ ¸æ¨¡å—æ¦‚è¿°"><a href="#å†…æ ¸æ¨¡å—æ¦‚è¿°" class="headerlink" title="å†…æ ¸æ¨¡å—æ¦‚è¿°"></a>å†…æ ¸æ¨¡å—æ¦‚è¿°</h4><p>å°½ç®¡å†…æ ¸æœ¬èº«æ˜¯ä¸€ä¸ªåºå¤§çš„è½¯ä»¶ï¼Œä½†å½“éœ€è¦ä¸ºå…¶æ·»åŠ æ–°åŠŸèƒ½ï¼ˆä¾‹å¦‚æ”¯æŒä¸€ç§æ–°å‹é”®ç›˜ï¼‰æ—¶ï¼Œå¹¶ä¸ä¼šç›´æ¥å°†ä»£ç å†™å…¥å†…æ ¸æ ¸å¿ƒä¸­ã€‚å†…æ ¸æ¨¡å—æ˜¯å¯ä»¥åœ¨éœ€è¦æ—¶åŠ è½½åˆ°å†…æ ¸ä¸­çš„ä»£ç ç‰‡æ®µï¼Œå®ƒä»¬æ‰©å±•äº†å†…æ ¸çš„åŠŸèƒ½è€Œä¸å¢åŠ æ ¸å¿ƒä»£ç é‡ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œæ·»åŠ æ¨¡å—æ— éœ€é‡å¯ç³»ç»Ÿã€‚</p><h4 id="æŸ¥çœ‹å’Œç®¡ç†å·²åŠ è½½çš„æ¨¡å—"><a href="#æŸ¥çœ‹å’Œç®¡ç†å·²åŠ è½½çš„æ¨¡å—" class="headerlink" title="æŸ¥çœ‹å’Œç®¡ç†å·²åŠ è½½çš„æ¨¡å—"></a>æŸ¥çœ‹å’Œç®¡ç†å·²åŠ è½½çš„æ¨¡å—</h4><ul><li><p><strong>æŸ¥çœ‹å½“å‰å·²åŠ è½½çš„æ¨¡å—</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ lsmod<br></code></pre></td></tr></table></figure></li><li><p><strong>åŠ è½½ä¸€ä¸ªæ¨¡å—</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> modprobe bluetooth<br></code></pre></td></tr></table></figure><p><code>modprobe</code>å‘½ä»¤å°è¯•ä»<code>/lib/modules/(å†…æ ¸ç‰ˆæœ¬)/kernel/drivers</code>åŠ è½½æ¨¡å—ã€‚å¦‚æœæ¨¡å—æœ‰ä¾èµ–å…³ç³»ï¼Œ<code>modprobe</code>ä¼šè‡ªåŠ¨åŠ è½½æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚</p></li><li><p><strong>å¸è½½ä¸€ä¸ªæ¨¡å—</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> modprobe -r bluetooth<br></code></pre></td></tr></table></figure></li></ul><h4 id="ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ¨¡å—"><a href="#ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ¨¡å—" class="headerlink" title="ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ¨¡å—"></a>ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ¨¡å—</h4><p>è‹¥å¸Œæœ›åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ¨¡å—ï¼Œè€Œéä¸´æ—¶ä½¿ç”¨<code>modprobe</code>åŠ è½½ï¼ˆé‡å¯åå¸è½½ï¼‰ï¼Œå¯ä»¥é€šè¿‡åœ¨<code>/etc/modprobe.d</code>ç›®å½•ä¸‹æ·»åŠ æ–°çš„é…ç½®æ–‡ä»¶å®ç°ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>peanutbutter.conf</code>çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">options peanut_butter type=almond<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æœ‰ä¸€ä¸ªåä¸º<code>peanut_butter</code>çš„æ¨¡å—ï¼Œå¹¶å¸Œæœ›é€šè¿‡è®¾ç½®å‚æ•°<code>type=almond</code>æ¥è°ƒæ•´å…¶è¡Œä¸ºï¼Œåˆ™å¯é€šè¿‡ä¸Šè¿°é…ç½®æ–‡ä»¶ä½¿å…¶åœ¨å¯åŠ¨æ—¶åŠ è½½ã€‚</p><h4 id="é˜»æ­¢æ¨¡å—åœ¨å¯åŠ¨æ—¶åŠ è½½"><a href="#é˜»æ­¢æ¨¡å—åœ¨å¯åŠ¨æ—¶åŠ è½½" class="headerlink" title="é˜»æ­¢æ¨¡å—åœ¨å¯åŠ¨æ—¶åŠ è½½"></a>é˜»æ­¢æ¨¡å—åœ¨å¯åŠ¨æ—¶åŠ è½½</h4><p>åŒæ ·åœ°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨<code>/etc/modprobe.d</code>ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶æ¥é˜»æ­¢ç‰¹å®šæ¨¡å—åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">blacklist peanut_butter<br></code></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥ç¡®ä¿æŒ‡å®šçš„æ¨¡å—ä¸ä¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ã€‚ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Boot the System</title>
    <link href="/2025/03/22/Linux-Boot-the-System/"/>
    <url>/2025/03/22/Linux-Boot-the-System/</url>
    
    <content type="html"><![CDATA[<h1 id="Boot-the-System"><a href="#Boot-the-System" class="headerlink" title="Boot the System"></a>Boot the System</h1><h1 id="1-Linux-å¯åŠ¨è¿‡ç¨‹æ¦‚è¿°"><a href="#1-Linux-å¯åŠ¨è¿‡ç¨‹æ¦‚è¿°" class="headerlink" title="1 Linux å¯åŠ¨è¿‡ç¨‹æ¦‚è¿°"></a>1 Linux å¯åŠ¨è¿‡ç¨‹æ¦‚è¿°</h1><p>å½“æ‰“å¼€è®¡ç®—æœºæ—¶ï¼Œä¼šçœ‹åˆ°ä¸€ç³»åˆ—ä¸åŒçš„æ¶ˆæ¯æ»šåŠ¨ï¼Œæœ€åå‡ºç°ç™»å½•çª—å£ã€‚å®é™…ä¸Šï¼Œä»æŒ‰ä¸‹ç”µæºé”®åˆ°ç™»å½•ç•Œé¢å‘ˆç°ä¹‹å‰ï¼Œç³»ç»Ÿè¿›è¡Œäº†å¤§é‡çš„å·¥ä½œã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¿™ä¸€è¿‡ç¨‹ã€‚</p><p>Linuxçš„å¯åŠ¨è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå››ä¸ªç®€å•é˜¶æ®µï¼š</p><h4 id="1-BIOSï¼ˆbasic-input-output-systemï¼‰"><a href="#1-BIOSï¼ˆbasic-input-output-systemï¼‰" class="headerlink" title="1. BIOSï¼ˆbasic input&#x2F;output systemï¼‰"></a>1. BIOSï¼ˆbasic input&#x2F;output systemï¼‰</h4><p>BIOSè´Ÿè´£åˆå§‹åŒ–ç¡¬ä»¶ï¼Œå¹¶é€šè¿‡å¼€æœºè‡ªæ£€ï¼ˆPOSTï¼‰ç¡®ä¿æ‰€æœ‰ç¡¬ä»¶æ­£å¸¸è¿è¡Œã€‚å…¶ä¸»è¦ä»»åŠ¡æ˜¯åŠ è½½å¼•å¯¼è£…è½½ç¨‹åº(bootloader)ã€‚å¼€æœºæ—¶ï¼ŒBIOSé¦–å…ˆè¿›è¡Œç¡¬ä»¶æ£€æµ‹ï¼Œå¹¶å‡†å¤‡å°±ç»ªåå°†æ§åˆ¶æƒäº¤ç»™å¼•å¯¼è£…è½½ç¨‹åºã€‚</p><h4 id="2-å¼•å¯¼è£…è½½ç¨‹åº-bootloader"><a href="#2-å¼•å¯¼è£…è½½ç¨‹åº-bootloader" class="headerlink" title="2. å¼•å¯¼è£…è½½ç¨‹åº(bootloader)"></a>2. å¼•å¯¼è£…è½½ç¨‹åº(bootloader)</h4><p>å¼•å¯¼è£…è½½ç¨‹åºè´Ÿè´£å°†å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ä½¿ç”¨ä¸€ç»„å†…æ ¸å‚æ•°å¯åŠ¨å†…æ ¸ã€‚æœ€å¸¸è§çš„å¼•å¯¼è£…è½½ç¨‹åºä¹‹ä¸€æ˜¯GRUBï¼Œå®ƒæ˜¯Linuxçš„æ ‡å‡†é€šç”¨å¼•å¯¼è£…è½½ç¨‹åºã€‚GRUBå…è®¸ç”¨æˆ·é€‰æ‹©åŠ è½½å“ªä¸ªæ“ä½œç³»ç»Ÿæˆ–å†…æ ¸ç‰ˆæœ¬ã€‚</p><h4 id="3-å†…æ ¸"><a href="#3-å†…æ ¸" class="headerlink" title="3. å†…æ ¸"></a>3. å†…æ ¸</h4><p>ä¸€æ—¦å†…æ ¸è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒä¼šç«‹å³å¼€å§‹åˆå§‹åŒ–è®¾å¤‡å’Œå†…å­˜ã€‚å†…æ ¸çš„ä¸»è¦èŒè´£æ˜¯å¯åŠ¨initè¿›ç¨‹ã€‚å†…æ ¸ä¸ä»…ç®¡ç†ç¡¬ä»¶èµ„æºï¼Œè¿˜ä¸ºç”¨æˆ·ç©ºé—´åº”ç”¨ç¨‹åºæä¾›ç³»ç»Ÿè°ƒç”¨æ¥å£ã€‚</p><h4 id="4-Initè¿›ç¨‹"><a href="#4-Initè¿›ç¨‹" class="headerlink" title="4. Initè¿›ç¨‹"></a>4. Initè¿›ç¨‹</h4><p>Initè¿›ç¨‹æ˜¯ç³»ç»Ÿå¯åŠ¨åçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œè´Ÿè´£å¯åŠ¨å’Œåœæ­¢ç³»ç»Ÿä¸Šçš„å…³é”®æœåŠ¡è¿›ç¨‹ã€‚åœ¨Linuxå‘è¡Œç‰ˆä¸­æœ‰ä¸‰ç§ä¸»è¦çš„initå®ç°æ–¹å¼ï¼Œåé¢è¯¦ç»†æ¢è®¨å®ƒä»¬ã€‚</p><h2 id="2-BIOS"><a href="#2-BIOS" class="headerlink" title="2 BIOS"></a>2 BIOS</h2><p>Linuxå¯åŠ¨æµç¨‹çš„ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡BIOSæ‰§è¡Œç³»ç»Ÿå®Œæ•´æ€§æ£€æŸ¥ã€‚BIOSæ˜¯ä¸€ç§å›ºä»¶ï¼Œå¹¿æ³›åº”ç”¨äºç°ä»Šä¸»æµçš„IBM PCå…¼å®¹è®¡ç®—æœºä¸­ã€‚ä½¿ç”¨BIOSå›ºä»¶å¯ä»¥æ›´æ”¹ç¡¬ç›˜çš„å¯åŠ¨é¡ºåºã€æ£€æŸ¥ç³»ç»Ÿæ—¶é—´ã€æŸ¥çœ‹æœºå™¨çš„MACåœ°å€ç­‰ã€‚BIOSçš„ä¸»è¦ç›®æ ‡æ˜¯æ‰¾åˆ°ç³»ç»Ÿçš„å¼•å¯¼è£…è½½ç¨‹åºã€‚</p><p>å½“BIOSå¯åŠ¨ç¡¬ç›˜åï¼Œå®ƒä¼šæœç´¢å¼•å¯¼å—ä»¥ç¡®å®šå¦‚ä½•å¯åŠ¨ç³»ç»Ÿã€‚æ ¹æ®ç¡¬ç›˜åˆ†åŒºæ–¹å¼çš„ä¸åŒï¼ŒBIOSä¼šæŸ¥æ‰¾ä¸»å¼•å¯¼è®°å½•ï¼ˆMBRï¼‰æˆ–GPTã€‚MBRä½äºç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œå³å‰512å­—èŠ‚å†…ï¼Œå…¶ä¸­åŒ…å«åŠ è½½ç£ç›˜ä¸Šå¦ä¸€ä¸ªç¨‹åºçš„ä»£ç ï¼Œè€Œè¿™ä¸ªç¨‹åºå®é™…ä¸Šè´Ÿè´£åŠ è½½å¼•å¯¼è£…è½½ç¨‹åºã€‚</p><p>å¦‚æœç¡¬ç›˜ä½¿ç”¨GPTæ–¹å¼è¿›è¡Œåˆ†åŒºï¼Œåˆ™å¼•å¯¼è£…è½½ç¨‹åºçš„ä½ç½®ä¼šæœ‰æ‰€ä¸åŒã€‚</p><h4 id="UEFI"><a href="#UEFI" class="headerlink" title="UEFI"></a>UEFI</h4><p>é™¤äº†BIOSä¹‹å¤–ï¼Œå¦ä¸€ç§å¯åŠ¨ç³»ç»Ÿçš„æ–¹å¼æ˜¯é€šè¿‡UEFIï¼ˆç»Ÿä¸€å¯æ‰©å±•å›ºä»¶æ¥å£ï¼‰ã€‚UEFIæ—¨åœ¨æˆä¸ºBIOSçš„ç»§ä»»è€…ï¼Œç°ä»Šå¤§å¤šæ•°ç¡¬ä»¶éƒ½å†…ç½®äº†UEFIå›ºä»¶ã€‚Macintoshè®¾å¤‡å¤šå¹´æ¥ä¸€ç›´ä½¿ç”¨EFIè¿›è¡Œå¯åŠ¨ï¼ŒWindowsä¹Ÿå‡ ä¹å®Œå…¨è½¬å‘UEFIå¯åŠ¨ã€‚GPTæ ¼å¼è®¾è®¡ç”¨äºä¸EFIé…åˆä½¿ç”¨ã€‚ä½¿ç”¨GPTæ ¼å¼çš„ç¡¬ç›˜å¹¶ä¸ä¸€å®šéœ€è¦EFIï¼Œå…¶ç¬¬ä¸€ä¸ªæ‰‡åŒºä¿ç•™äº†ä¸€ä¸ªâ€œä¿æŠ¤æ€§MBRâ€ï¼Œä»¥ä¾¿åœ¨åŸºäºBIOSçš„æœºå™¨ä¸Šä¹Ÿèƒ½å¯åŠ¨ã€‚</p><p>UEFIå°†æ‰€æœ‰å¯åŠ¨ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ª.EFIæ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶å­˜æ”¾åœ¨ç¡¬ä»¶ä¸Šçš„ä¸€ä¸ªåä¸ºEFIç³»ç»Ÿåˆ†åŒºçš„ç‰¹æ®Šåˆ†åŒºä¸­ï¼Œæ­¤åˆ†åŒºåŒ…å«äº†bootloaderã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„BIOSå›ºä»¶ï¼ŒUEFIå¸¦æ¥äº†è®¸å¤šæ”¹è¿›ã€‚Linuxç³»ç»Ÿåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çš„ä»ç„¶æ˜¯BIOSã€‚</p><h2 id="3-bootloader"><a href="#3-bootloader" class="headerlink" title="3 bootloader"></a>3 bootloader</h2><p>å¼•å¯¼è£…è½½ç¨‹åºçš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š</p><ul><li>å¼•å¯¼è¿›å…¥æ“ä½œç³»ç»Ÿï¼Œä¹Ÿæ”¯æŒå¯åŠ¨éLinuxæ“ä½œç³»ç»Ÿã€‚</li><li>é€‰æ‹©è¦ä½¿ç”¨çš„å†…æ ¸ã€‚</li><li>æŒ‡å®šå†…æ ¸å‚æ•°ã€‚</li></ul><p>Linuxä¸­æœ€å¸¸ç”¨çš„å¼•å¯¼è£…è½½ç¨‹åºæ˜¯GRUBã€‚å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–å¤šç§å¼•å¯¼è£…è½½ç¨‹åºå¯ä¾›é€‰æ‹©ï¼Œå¦‚LILOã€efilinuxã€corebootã€SYSLINUXç­‰ã€‚</p><p>äº†è§£å¼•å¯¼è£…è½½ç¨‹åºçš„ä¸»è¦ç›®æ ‡æ˜¯åŠ è½½å†…æ ¸åï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å®ƒå¦‚ä½•æ‰¾åˆ°å†…æ ¸ã€‚è¿™éœ€è¦æŸ¥çœ‹å†…æ ¸å‚æ•°æ¥ç¡®å®šã€‚å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨æ—¶æŒ‰ä¸‹â€™eâ€™é”®è¿›å…¥GRUBèœå•æ¥æŸ¥çœ‹è¿™äº›å‚æ•°ï¼š</p><ul><li><code>initrd</code>ï¼šæŒ‡å®šåˆå§‹RAMç£ç›˜çš„ä½ç½®ã€‚</li><li><code>BOOT_IMAGE</code>ï¼šæŒ‡ç¤ºå†…æ ¸æ˜ åƒçš„ä½ç½®ã€‚</li><li><code>root</code>ï¼šæŒ‡å‡ºæ ¹æ–‡ä»¶ç³»ç»Ÿçš„æ‰€åœ¨ä½ç½®ï¼Œå†…æ ¸åœ¨æ­¤ä½ç½®æŸ¥æ‰¾initè¿›ç¨‹ã€‚é€šå¸¸ä»¥UUIDæˆ–è®¾å¤‡åç§°ï¼ˆå¦‚&#x2F;dev&#x2F;sda1ï¼‰è¡¨ç¤ºã€‚</li><li><code>ro</code>ï¼šæ­¤å‚æ•°ä¸ºæ ‡å‡†è®¾ç½®ï¼Œä»¥åªè¯»æ¨¡å¼æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚</li><li><code>quiet</code>ï¼šæ·»åŠ æ­¤å‚æ•°æ˜¯ä¸ºäº†é¿å…åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æ˜¾ç¤ºåå°è¿è¡Œçš„æ¶ˆæ¯ã€‚</li><li><code>splash</code>ï¼šå…è®¸æ˜¾ç¤ºå¯åŠ¨ç”»é¢ã€‚</li></ul><h2 id="4-å†…æ ¸"><a href="#4-å†…æ ¸" class="headerlink" title="4 å†…æ ¸"></a>4 å†…æ ¸</h2><h4 id="Initrdä¸Initramfs"><a href="#Initrdä¸Initramfs" class="headerlink" title="Initrdä¸Initramfs"></a>Initrdä¸Initramfs</h4><p>å½“è®¨è®ºå†…æ ¸å¯åŠ¨æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªâ€œå…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹â€çš„é—®é¢˜ã€‚å†…æ ¸ç®¡ç†ç³»ç»Ÿçš„ç¡¬ä»¶ï¼Œä½†åœ¨å¯åŠ¨æœŸé—´ï¼Œå¹¶éæ‰€æœ‰é©±åŠ¨éƒ½å¯¹å†…æ ¸å¯ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸´æ—¶çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä¸­ä»…åŒ…å«å†…æ ¸è®¿é—®å…¶ä½™ç¡¬ä»¶æ‰€éœ€çš„å¿…è¦æ¨¡å—ã€‚åœ¨è¿‡å»ï¼Œè¿™é¡¹ä»»åŠ¡ç”±initrdï¼ˆåˆå§‹RAMç£ç›˜ï¼‰æ‰¿æ‹…ã€‚å†…æ ¸ä¼šæŒ‚è½½initrdï¼ŒåŠ è½½å¿…è¦çš„å¯åŠ¨é©±åŠ¨ï¼Œç„¶ååœ¨åŠ è½½å®Œæ‰€éœ€çš„ä¸€åˆ‡åï¼Œç”¨å®é™…çš„æ ¹æ–‡ä»¶ç³»ç»Ÿæ›¿æ¢initrdã€‚å¦‚ä»Šï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§åä¸ºinitramfsçš„æœºåˆ¶ã€‚è¿™æ˜¯ä¸€ç§å†…ç½®åœ¨å†…æ ¸ä¸­çš„ä¸´æ—¶æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºåŠ è½½çœŸå®æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰€éœ€çš„æ‰€æœ‰é©±åŠ¨ï¼Œä»è€Œä¸å†éœ€è¦å®šä½initrdæ–‡ä»¶ã€‚</p><h4 id="æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ"><a href="#æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ"></a>æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ</h4><p>ç°åœ¨ï¼Œå†…æ ¸æ‹¥æœ‰åˆ›å»ºæ ¹è®¾å¤‡å’ŒæŒ‚è½½æ ¹åˆ†åŒºæ‰€éœ€çš„æ‰€æœ‰æ¨¡å—ã€‚ç„¶è€Œï¼Œæ ¹åˆ†åŒºæœ€åˆæ˜¯ä»¥åªè¯»æ¨¡å¼æŒ‚è½½çš„ï¼Œä»¥ä¾¿fsckå¯ä»¥å®‰å…¨è¿è¡Œå¹¶æ£€æŸ¥ç³»ç»Ÿå®Œæ•´æ€§ã€‚å®Œæˆè¿™äº›æ­¥éª¤åï¼Œå†ä»¥è¯»å†™æ¨¡å¼é‡æ–°æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚éšåï¼Œå†…æ ¸å®šä½initç¨‹åºå¹¶æ‰§è¡Œå®ƒã€‚</p><h2 id="5-Init"><a href="#5-Init" class="headerlink" title="5 Init"></a>5 Init</h2><p>Linuxä¸­æœ‰ä¸‰ç§ä¸»è¦çš„initå®ç°æ–¹å¼ï¼š</p><h4 id="System-V-Initï¼ˆç®€ç§°SysVï¼‰"><a href="#System-V-Initï¼ˆç®€ç§°SysVï¼‰" class="headerlink" title="System V Initï¼ˆç®€ç§°SysVï¼‰"></a>System V Initï¼ˆç®€ç§°SysVï¼‰</h4><p>è¿™æ˜¯ä¼ ç»Ÿçš„initç³»ç»Ÿï¼ŒåŸºäºå¯åŠ¨è„šæœ¬é¡ºåºåœ°å¯åŠ¨å’Œåœæ­¢è¿›ç¨‹ã€‚ç³»ç»Ÿçš„çŠ¶æ€ç”±è¿è¡Œçº§åˆ«ï¼ˆrunlevelsï¼‰è¡¨ç¤ºï¼Œæ¯ä¸ªè¿è¡Œçº§åˆ«ä»¥ä¸åŒçš„æ–¹å¼å¯åŠ¨æˆ–åœæ­¢æœºå™¨ã€‚</p><h4 id="Upstart"><a href="#Upstart" class="headerlink" title="Upstart"></a>Upstart</h4><p>Upstartæ˜¯è¾ƒæ—§ç‰ˆæœ¬Ubuntuä¸Šä½¿ç”¨çš„initç³»ç»Ÿã€‚å®ƒå¼•å…¥äº†ä½œä¸šï¼ˆjobsï¼‰å’Œäº‹ä»¶ï¼ˆeventsï¼‰çš„æ¦‚å¿µï¼Œé€šè¿‡å“åº”ç‰¹å®šäº‹ä»¶æ¥å¯åŠ¨æ‰§è¡ŒæŸäº›åŠ¨ä½œçš„ä½œä¸šã€‚</p><h4 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h4><p>Systemdæ˜¯æ–°çš„initæ ‡å‡†ï¼Œç›®æ ‡å¯¼å‘å‹è®¾è®¡ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ æœ‰ä¸€ä¸ªæƒ³è¦è¾¾æˆçš„ç›®æ ‡ï¼Œè€ŒSystemdè¯•å›¾æ»¡è¶³è¯¥ç›®æ ‡çš„æ‰€æœ‰ä¾èµ–é¡¹ä»¥å®Œæˆç›®æ ‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]The Filesystem</title>
    <link href="/2025/03/21/Linux-The-Filesystem/"/>
    <url>/2025/03/21/Linux-The-Filesystem/</url>
    
    <content type="html"><![CDATA[<h1 id="The-Filesystem"><a href="#The-Filesystem" class="headerlink" title="The Filesystem"></a>The Filesystem</h1><h2 id="1-æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†"><a href="#1-æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†" class="headerlink" title="1 æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†"></a>1 æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†</h2><p>åœ¨Linuxæˆ–Unix-likeç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†ï¼ˆFilesystem Hierarchy Standard, FHSï¼‰ä¸ºç³»ç»Ÿçš„ç›®å½•ç»“æ„æä¾›äº†ä¸€å¥—è§„èŒƒã€‚æ‰§è¡Œ<code>ls -l /</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„å­ç›®å½•åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªä¸»è¦ç›®å½•çš„ç®€è¦ä»‹ç»ï¼š</p><ul><li><code>/</code>ï¼šæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ï¼Œæ‰€æœ‰å…¶ä»–ç›®å½•å’Œæ–‡ä»¶éƒ½ä½äºæ­¤ç›®å½•ä¹‹ä¸‹ã€‚</li><li><code>/bin</code>ï¼šå­˜æ”¾ç³»ç»Ÿå¿…éœ€çš„äºŒè¿›åˆ¶ç¨‹åºï¼ŒåŒ…æ‹¬åŸºç¡€å‘½ä»¤å¦‚<code>ls</code>ã€<code>cp</code>ç­‰ã€‚</li><li><code>/boot</code>ï¼šåŒ…å«å†…æ ¸åŠå¯åŠ¨å¼•å¯¼åŠ è½½å™¨çš„æ–‡ä»¶ã€‚</li><li><code>/dev</code>ï¼šè®¾å¤‡æ–‡ä»¶ï¼Œä»£è¡¨ç³»ç»Ÿä¸­çš„ç¡¬ä»¶è®¾å¤‡ã€‚</li><li><code>/etc</code>ï¼šæ ¸å¿ƒç³»ç»Ÿé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œé€šå¸¸ä»…åŒ…å«é…ç½®æ–‡ä»¶è€Œéå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li><li><code>/home</code>ï¼šç”¨æˆ·ä¸ªäººç›®å½•ï¼Œå­˜å‚¨ç”¨æˆ·çš„æ–‡æ¡£ã€æ–‡ä»¶å’Œä¸ªäººè®¾ç½®ã€‚</li><li><code>/lib</code>ï¼šåº“æ–‡ä»¶ï¼Œä¾›&#x2F;binå’Œ&#x2F;sbinä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨ã€‚</li><li><code>/media</code>ï¼šç”¨äºæŒ‚è½½å¯ç§»åŠ¨åª’ä½“ï¼Œå¦‚USBé©±åŠ¨å™¨çš„æŒ‚è½½ç‚¹ã€‚</li><li><code>/mnt</code>ï¼šä¸´æ—¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ã€‚</li><li><code>/opt</code>ï¼šå¯é€‰çš„åº”ç”¨è½¯ä»¶åŒ…ã€‚</li><li><code>/proc</code>ï¼šå…³äºå½“å‰è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ã€‚</li><li><code>/root</code>ï¼šrootç”¨æˆ·çš„ä¸»ç›®å½•ã€‚</li><li><code>/run</code>ï¼šè‡ªä¸Šæ¬¡å¯åŠ¨ä»¥æ¥å…³äºè¿è¡Œç³»ç»Ÿçš„åŠ¨æ€æ•°æ®ã€‚</li><li><code>/sbin</code>ï¼šç³»ç»Ÿå¿…å¤‡çš„ç®¡ç†å·¥å…·ï¼Œé€šå¸¸åªèƒ½ç”±è¶…çº§ç”¨æˆ·(root)æ‰§è¡Œã€‚</li><li><code>/srv</code>ï¼šç”±ç³»ç»Ÿæä¾›çš„ç‰¹å®šç«™ç‚¹æ•°æ®ã€‚</li><li><code>/tmp</code>ï¼šå­˜å‚¨ä¸´æ—¶æ–‡ä»¶ã€‚</li><li><code>/usr</code>ï¼šç”¨äºç”¨æˆ·å®‰è£…çš„è½¯ä»¶å’Œå®ç”¨å·¥å…·ï¼Œå¹¶éä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç”¨æˆ·æ–‡ä»¶ï¼ˆä¾‹å¦‚&#x2F;homeä¸‹çš„ç”¨æˆ·ç›®å½•ï¼‰ã€‚è¯¥ç›®å½•ä¸‹è¿˜æœ‰è¿›ä¸€æ­¥çš„å­ç›®å½•ï¼Œå¦‚<code>/usr/bin</code>ã€<code>/usr/local</code>ç­‰ã€‚</li><li><code>/var</code>ï¼šå˜é‡æ–‡ä»¶ç›®å½•ï¼Œç”¨äºç³»ç»Ÿæ—¥å¿—ã€ç”¨æˆ·è·Ÿè¸ªã€ç¼“å­˜ç­‰éšæ—¶é—´å˜åŒ–çš„æ•°æ®ã€‚</li></ul><h2 id="2-æ–‡ä»¶ç³»ç»Ÿç±»å‹"><a href="#2-æ–‡ä»¶ç³»ç»Ÿç±»å‹" class="headerlink" title="2 æ–‡ä»¶ç³»ç»Ÿç±»å‹"></a>2 æ–‡ä»¶ç³»ç»Ÿç±»å‹</h2><p>åœ¨è®¡ç®—æœºä¸­ï¼Œå­˜åœ¨å¤šç§æ–‡ä»¶ç³»ç»Ÿå®ç°ï¼Œæ¯ç§éƒ½æœ‰å…¶ç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œä¼˜åŠ¿ã€‚æ–‡ä»¶ç³»ç»Ÿçš„å·®å¼‚ä½“ç°åœ¨<strong>é€Ÿåº¦</strong>ã€æ”¯æŒçš„<strong>å­˜å‚¨å®¹é‡</strong>ä»¥åŠ<strong>æ•°æ®ç»„ç»‡æ–¹å¼</strong>ä¸Šã€‚ä¸ºäº†ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿä¸Šè¿è¡Œï¼Œå¼•å…¥äº†è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVirtual File System, VFSï¼‰æŠ½è±¡å±‚ï¼Œå®ƒä½œä¸ºåº”ç”¨ä¸å…·ä½“æ–‡ä»¶ç³»ç»Ÿé—´çš„ä¸­ä»‹ï¼Œç¡®ä¿åº”ç”¨å¯ä»¥æ— ç¼åœ°æ“ä½œå„ç§æ–‡ä»¶ç³»ç»Ÿã€‚</p><h4 id="æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ"></a>æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ</h4><p>ç°ä»£æ–‡ä»¶ç³»ç»Ÿé€šå¸¸é»˜è®¤æ”¯æŒæ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿé€šè¿‡è®°å½•å³å°†è¿›è¡Œçš„æ“ä½œæ¥é¢„é˜²çªç„¶æ–­ç”µç­‰æƒ…å†µå¯¼è‡´çš„æ•°æ®æŸåæˆ–æ–‡ä»¶ç³»ç»Ÿä¸ä¸€è‡´ã€‚åœ¨éæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œçªå‘æ–­ç”µå¯èƒ½å¯¼è‡´æ–‡ä»¶æŸåï¼Œå¹¶éœ€è¦åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶è¿›è¡Œå…¨é¢æ£€æŸ¥ä»¥ä¿®å¤é—®é¢˜ï¼Œè¿™å¯èƒ½è€—æ—¶è¾ƒé•¿ã€‚è€Œåœ¨æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰æ“ä½œå…ˆè¢«è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œåœ¨æ“ä½œå®Œæˆåæ ‡è®°ä¸ºå®Œæˆï¼Œä»è€Œä¿æŒæ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æ€§å¹¶å‡å°‘é‡å¯æ—¶çš„æ£€æŸ¥æ—¶é—´ã€‚</p><h4 id="å¸¸è§æ¡Œé¢æ–‡ä»¶ç³»ç»Ÿç±»å‹"><a href="#å¸¸è§æ¡Œé¢æ–‡ä»¶ç³»ç»Ÿç±»å‹" class="headerlink" title="å¸¸è§æ¡Œé¢æ–‡ä»¶ç³»ç»Ÿç±»å‹"></a>å¸¸è§æ¡Œé¢æ–‡ä»¶ç³»ç»Ÿç±»å‹</h4><ul><li><strong>ext4</strong>ï¼šLinuxæœ€æ–°çš„åŸç”Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå‘åå…¼å®¹ext2å’Œext3ã€‚æ”¯æŒæœ€å¤§1EBçš„ç£ç›˜å·å’Œæœ€å¤§16TBçš„æ–‡ä»¶å¤§å°ï¼Œæ˜¯Linuxçš„æ ‡å‡†é€‰æ‹©ã€‚</li><li><strong>Btrfs</strong>ï¼šä¸€ç§æ–°çš„Linuxæ–‡ä»¶ç³»ç»Ÿï¼Œæä¾›å¿«ç…§ã€å¢é‡å¤‡ä»½ç­‰åŠŸèƒ½ï¼Œæ€§èƒ½æœ‰æ‰€æå‡ï¼Œä½†ç¨³å®šæ€§å°šå¾…å®Œå–„ã€‚</li><li><strong>XFS</strong>ï¼šé«˜æ€§èƒ½çš„æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆç”¨äºå¤§å‹æ–‡ä»¶å¦‚åª’ä½“æœåŠ¡å™¨ã€‚</li><li><strong>NTFSå’ŒFAT</strong>ï¼šWindowsæ“ä½œç³»ç»Ÿä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>**HFS+**ï¼šè‹¹æœMacintoshç”µè„‘æ‰€ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚</li></ul><p>ä½¿ç”¨<code>df -T</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹åŠå…¶ä½¿ç”¨æƒ…å†µï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">pete@icebox:~$ df -T<br>Filesystem     Type     1K-blocks    Used Available Use% Mounted on<br>/dev/sda1      ext4      <span class="hljs-number"> 6461592 </span>2402708  <span class="hljs-number"> 3707604 </span> 40% /<br>udev           devtmpfs   <span class="hljs-number"> 501356 </span>     <span class="hljs-number"> 4 </span>  <span class="hljs-number"> 501352 </span>  1% /dev<br>tmpfs          tmpfs      <span class="hljs-number"> 102544 </span>  <span class="hljs-number"> 1068 </span>  <span class="hljs-number"> 101476 </span>  2% /run<br>/dev/sda6      xfs      <span class="hljs-number"> 13752320 </span><span class="hljs-number"> 460112 </span><span class="hljs-number"> 13292208 </span>  4% /home<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å±•ç¤ºäº†æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹ã€å—å¤§å°ã€å·²ç”¨ç©ºé—´ã€å¯ç”¨ç©ºé—´åŠæŒ‚è½½ç‚¹ç­‰ä¿¡æ¯ã€‚</p><h2 id="3-ç£ç›˜ç»“æ„è§£æ"><a href="#3-ç£ç›˜ç»“æ„è§£æ" class="headerlink" title="3 ç£ç›˜ç»“æ„è§£æ"></a>3 ç£ç›˜ç»“æ„è§£æ</h2><p>ç¡¬ç›˜å¯ä»¥é€šè¿‡åˆ†åŒºè¢«ç»†åˆ†ä¸ºå¤šä¸ªå—è®¾å¤‡ï¼Œä¾‹å¦‚&#x2F;dev&#x2F;sda1å’Œ&#x2F;dev&#x2F;sda2ã€‚å…¶ä¸­ï¼Œ&#x2F;dev&#x2F;sdaä»£è¡¨æ•´ä¸ªç£ç›˜ï¼Œè€Œ&#x2F;dev&#x2F;sda1è¡¨ç¤ºè¯¥ç£ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºã€‚åˆ†åŒºæœ‰åŠ©äºæ•°æ®åˆ†ç¦»ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºç‰¹å®šæ–‡ä»¶ç³»ç»Ÿçš„åˆ†åŒºï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªç£ç›˜æ ¼å¼åŒ–ä¸ºå•ä¸€ç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><h4 id="åˆ†åŒºè¡¨"><a href="#åˆ†åŒºè¡¨" class="headerlink" title="åˆ†åŒºè¡¨"></a>åˆ†åŒºè¡¨</h4><p>æ¯ä¸ªç£ç›˜éƒ½æœ‰ä¸€ä¸ªåˆ†åŒºè¡¨ï¼Œç”¨äºæè¿°ç£ç›˜æ˜¯å¦‚ä½•åˆ†åŒºçš„ã€‚å®ƒæ ‡æ˜äº†å„ä¸ªåˆ†åŒºçš„èµ·å§‹ä¸ç»“æŸä½ç½®ã€å“ªäº›åˆ†åŒºæ˜¯å¯å¼•å¯¼çš„ä»¥åŠå„åˆ†åŒºæ‰€å çš„æ‰‡åŒºç­‰ä¿¡æ¯ã€‚å¸¸ç”¨çš„åˆ†åŒºè¡¨ç±»å‹æœ‰ä¸¤ç§ï¼šMBRï¼ˆä¸»å¼•å¯¼è®°å½•ï¼‰å’ŒGPTï¼ˆGUIDåˆ†åŒºè¡¨ï¼‰ã€‚</p><h4 id="åˆ†åŒº"><a href="#åˆ†åŒº" class="headerlink" title="åˆ†åŒº"></a>åˆ†åŒº</h4><p>ç£ç›˜ç”±å¤šä¸ªåˆ†åŒºç»„æˆï¼Œè¿™äº›åˆ†åŒºå¸®åŠ©æˆ‘ä»¬ç»„ç»‡æ•°æ®ã€‚ä¸€ä¸ªç£ç›˜ä¸Šå¯ä»¥æœ‰å¤šä¸ªä¸é‡å çš„åˆ†åŒºã€‚æœªåˆ†é…ç»™ä»»ä½•åˆ†åŒºçš„ç©ºé—´è¢«ç§°ä¸ºè‡ªç”±ç©ºé—´ã€‚åˆ†åŒºçš„ç±»å‹å–å†³äºåˆ†åŒºè¡¨ã€‚åˆ†åŒºæ—¢å¯ä»¥åŒ…å«æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä¸“é—¨ç”¨äºå…¶ä»–ç”¨é€”ï¼Œå¦‚äº¤æ¢åˆ†åŒºã€‚</p><h4 id="MBRä¸GPT"><a href="#MBRä¸GPT" class="headerlink" title="MBRä¸GPT"></a>MBRä¸GPT</h4><ul><li><strong>MBR</strong>ï¼šä¼ ç»Ÿåˆ†åŒºè¡¨ï¼Œæœ€å¤šæ”¯æŒå››ä¸ªä¸»åˆ†åŒºã€‚é€šè¿‡åˆ›å»ºæ‰©å±•åˆ†åŒºï¼ˆä»…å…è®¸ä¸€ä¸ªï¼‰ï¼Œå¯ä»¥åœ¨å…¶å†…éƒ¨æ·»åŠ é€»è¾‘åˆ†åŒºï¼Œä»è€Œå®ç°æ›´å¤šçš„åˆ†åŒºã€‚</li><li><strong>GPT</strong>ï¼šä½œä¸ºæ–°çš„æ ‡å‡†é€æ¸å–ä»£MBRï¼Œæ”¯æŒæ›´å¤šçš„åˆ†åŒºæ•°é‡ï¼Œæ¯ä¸ªåˆ†åŒºæ‹¥æœ‰å…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆGUIDï¼‰ã€‚ä¸»è¦ç”¨äºUEFIå¼•å¯¼æ¨¡å¼ä¸‹çš„ç£ç›˜åˆ†åŒºã€‚</li></ul><h4 id="æ–‡ä»¶ç³»ç»Ÿç»“æ„"><a href="#æ–‡ä»¶ç³»ç»Ÿç»“æ„" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç»“æ„"></a>æ–‡ä»¶ç³»ç»Ÿç»“æ„</h4><p>æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªæœ‰åºçš„æ–‡ä»¶å’Œç›®å½•é›†åˆã€‚åŸºæœ¬ç»„æˆéƒ¨åˆ†åŒ…æ‹¬ï¼š</p><ul><li><strong>å¼•å¯¼å—</strong>ï¼šä½äºæ–‡ä»¶ç³»ç»Ÿçš„å‰å‡ ä¸ªæ‰‡åŒºï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿå¯åŠ¨æ‰€éœ€çš„ä¿¡æ¯ã€‚</li><li><strong>è¶…çº§å—</strong>ï¼šç´§è·Ÿå¼•å¯¼å—ä¹‹åï¼ŒåŒ…å«äº†å…³äºæ–‡ä»¶ç³»ç»Ÿçš„é‡è¦ä¿¡æ¯ï¼Œå¦‚inodeè¡¨å¤§å°ã€é€»è¾‘å—å¤§å°åŠæ–‡ä»¶ç³»ç»Ÿçš„æ€»å¤§å°ã€‚</li><li><strong>inodeè¡¨</strong>ï¼šå¯ä»¥çœ‹æˆæ˜¯ç®¡ç†æ–‡ä»¶çš„æ•°æ®åº“ï¼Œæ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•åœ¨inodeè¡¨ä¸­éƒ½æœ‰å”¯ä¸€å…¥å£ï¼ŒåŒ…å«æ–‡ä»¶çš„å„ç§å±æ€§ä¿¡æ¯ã€‚</li><li><strong>æ•°æ®å—</strong>ï¼šå®é™…å­˜å‚¨æ–‡ä»¶å’Œç›®å½•æ•°æ®çš„éƒ¨åˆ†ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¸åŒåˆ†åŒºè¡¨çš„å®é™…ä¾‹å­ï¼š</p><p><strong>MBRåˆ†åŒºè¡¨ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">pete@icebox:~$ sudo parted -l<br><br>Model: Seagate (scsi)<br><br>Disk /dev/sda: 21.5GB<br><br>Sector size (logical/physical): 512B/512B<br><br>Partition Table: msdos<br><br><br>Number  Start   End     Size    Type      File system     Flags<br><br> 1      1049kB  6860MB  6859MB  primary   ext4            boot<br><br> 2      6861MB  21.5GB  14.6GB  extended<br><br> 5      6861MB  7380MB  519MB   logical   linux-swap(v1)<br><br> 6      7381MB  21.5GB  14.1GB  logical   xfs<br></code></pre></td></tr></table></figure><p><strong>GPTåˆ†åŒºè¡¨ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">Model: Thumb Drive (scsi)<br><br>Disk /dev/sdb: 4041MB<br><br>Sector size (logical/physical): 512B/512B<br><br>Partition Table: gpt<br><br><br>Number  Start   End     Size     File system  Name        Flags<br><br> 1      17.4kB  1000MB  1000MB                first<br><br> 2      1000MB  4040MB  3040MB                second<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å±•ç¤ºäº†ç£ç›˜åŠå…¶åˆ†åŒºçš„å…·ä½“æƒ…å†µï¼ŒåŒ…æ‹¬åˆ†åŒºçš„èµ·å§‹ä½ç½®ã€å¤§å°ã€ç±»å‹ã€æ–‡ä»¶ç³»ç»ŸåŠæ ‡å¿—ç­‰ä¿¡æ¯ã€‚</p><h2 id="4-ç£ç›˜åˆ†åŒº"><a href="#4-ç£ç›˜åˆ†åŒº" class="headerlink" title="4 ç£ç›˜åˆ†åŒº"></a>4 ç£ç›˜åˆ†åŒº</h2><h4 id="åˆ†åŒºå·¥å…·é€‰æ‹©"><a href="#åˆ†åŒºå·¥å…·é€‰æ‹©" class="headerlink" title="åˆ†åŒºå·¥å…·é€‰æ‹©"></a>åˆ†åŒºå·¥å…·é€‰æ‹©</h4><p>æœ‰å¤šç§å·¥å…·å¯ç”¨äºç£ç›˜åˆ†åŒºï¼š</p><ul><li><strong>fdisk</strong>ï¼šåŸºç¡€å‘½ä»¤è¡Œåˆ†åŒºå·¥å…·ï¼Œä¸æ”¯æŒGPTã€‚</li><li><strong>parted</strong>ï¼šæ”¯æŒMBRå’ŒGPTçš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li><li><strong>gparted</strong>ï¼špartedçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ç‰ˆæœ¬ã€‚</li><li><strong>gdisk</strong>ï¼šä»…æ”¯æŒGPTçš„fdiskç‰ˆæœ¬ã€‚</li></ul><p>ä½¿ç”¨<code>parted</code>å¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºã€‚å‡è®¾è¿æ¥USBè®¾å¤‡åï¼Œè®¾å¤‡åä¸º<code>/dev/sdb2</code>ã€‚</p><h4 id="ä½¿ç”¨Partedè¿›è¡Œåˆ†åŒº"><a href="#ä½¿ç”¨Partedè¿›è¡Œåˆ†åŒº" class="headerlink" title="ä½¿ç”¨Partedè¿›è¡Œåˆ†åŒº"></a>ä½¿ç”¨Partedè¿›è¡Œåˆ†åŒº</h4><ol><li><p><strong>å¯åŠ¨parted</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> parted</span><br></code></pre></td></tr></table></figure><p>è¿›å…¥partedå·¥å…·åï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤å¯¹è®¾å¤‡è¿›è¡Œåˆ†åŒºæ“ä½œã€‚</p></li><li><p><strong>é€‰æ‹©è®¾å¤‡</strong></p><p>åœ¨partedå·¥å…·ä¸­ï¼Œé¦–å…ˆéœ€è¦é€‰æ‹©è¦æ“ä½œçš„è®¾å¤‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">(parted) select /dev/sdb2<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å½“å‰åˆ†åŒºè¡¨</strong></p><p>ä½¿ç”¨<code>print</code>å‘½ä»¤æŸ¥çœ‹é€‰å®šè®¾å¤‡çš„ç°æœ‰åˆ†åŒºæƒ…å†µï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">(parted) print<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Model</span>: Seagate (scsi)<br><br><span class="hljs-attribute">Disk</span> /dev/sda: <span class="hljs-number">21</span>.<span class="hljs-number">5</span>GB<br><br><span class="hljs-attribute">Sector</span> size (logical/physical): <span class="hljs-number">512</span>B/<span class="hljs-number">512</span>B<br><br><span class="hljs-attribute">Partition</span> Table: msdos<br><br><br><span class="hljs-attribute">Number</span>  Start   End     Size    Type      File system     Flags<br><br> <span class="hljs-attribute">1</span>      <span class="hljs-number">1049</span>kB  <span class="hljs-number">6860</span>MB  <span class="hljs-number">6859</span>MB  primary   ext4            boot<br><br> <span class="hljs-attribute">2</span>      <span class="hljs-number">6861</span>MB  <span class="hljs-number">21</span>.<span class="hljs-number">5</span>GB  <span class="hljs-number">14</span>.<span class="hljs-number">6</span>GB  extended<br><br> <span class="hljs-attribute">5</span>      <span class="hljs-number">6861</span>MB  <span class="hljs-number">7380</span>MB  <span class="hljs-number">519</span>MB   logical   linux-swap(v1)<br><br> <span class="hljs-attribute">6</span>      <span class="hljs-number">7381</span>MB  <span class="hljs-number">21</span>.<span class="hljs-number">5</span>GB  <span class="hljs-number">14</span>.<span class="hljs-number">1</span>GB  logical   xfs<br></code></pre></td></tr></table></figure><p>æ­¤å¤„åˆ—å‡ºäº†è®¾å¤‡ä¸Šçš„æ‰€æœ‰åˆ†åŒºåŠå…¶èµ·å§‹å’Œç»“æŸä½ç½®ã€‚</p></li><li><p><strong>åˆ›å»ºæ–°åˆ†åŒº</strong></p><p>é€‰æ‹©åˆé€‚çš„èµ·å§‹å’Œç»“æŸä½ç½®æ¥åˆ›å»ºæ–°åˆ†åŒºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">(parted) mkpart primary 123 4567<br></code></pre></td></tr></table></figure><p>éœ€è¦æŒ‡å®šåˆ†åŒºç±»å‹ï¼ˆæ ¹æ®ä½¿ç”¨çš„åˆ†åŒºè¡¨ç±»å‹ï¼‰ã€‚</p></li><li><p><strong>è°ƒæ•´åˆ†åŒºå¤§å°</strong></p><p>å¦‚æœç©ºé—´ä¸è¶³ï¼Œå¯ä»¥è°ƒæ•´åˆ†åŒºå¤§å°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">(parted) resize 2 1245 3456<br></code></pre></td></tr></table></figure><p>é€‰æ‹©åˆ†åŒºç¼–å·ï¼Œå¹¶æŒ‡å®šæ–°çš„èµ·å§‹å’Œç»“æŸä½ç½®ã€‚</p></li></ol><h2 id="5-åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ"><a href="#5-åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="5 åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ"></a>5 åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</h2><p>åœ¨å®Œæˆç£ç›˜åˆ†åŒºåï¼Œä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚ä»¥ä¸‹æ˜¯åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿçš„æ­¥éª¤ï¼š</p><h4 id="ä½¿ç”¨mkfså‘½ä»¤åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ"><a href="#ä½¿ç”¨mkfså‘½ä»¤åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨mkfså‘½ä»¤åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ"></a>ä½¿ç”¨mkfså‘½ä»¤åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</h4><p>å‡è®¾å·²å¯¹<code>/dev/sdb2</code>è¿›è¡Œäº†åˆ†åŒºï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ­¤åˆ†åŒºä¸Šåˆ›å»ºä¸€ä¸ªext4æ–‡ä»¶ç³»ç»Ÿï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> mkfs -t ext4 /dev/sdb2</span><br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä½¿ç”¨<code>mkfs</code>ï¼ˆmake filesystemï¼‰å·¥å…·ï¼Œå¹¶é€šè¿‡<code>-t</code>å‚æ•°æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸ºext4å’Œç›®æ ‡è®¾å¤‡è·¯å¾„ã€‚</p><p><strong>é‡è¦æç¤º</strong>ï¼šä»…åº”åœ¨æ–°åˆ†åŒºçš„ç£ç›˜æˆ–é‡æ–°åˆ†åŒºçš„æ—§ç£ç›˜ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚è‹¥åœ¨ä¸€ä¸ªå·²æœ‰æ–‡ä»¶ç³»ç»Ÿçš„åˆ†åŒºä¸Šå†æ¬¡åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶ç³»ç»ŸæŸåã€‚</p><h2 id="6-æŒ‚è½½ä¸å¸è½½æ–‡ä»¶ç³»ç»Ÿ"><a href="#6-æŒ‚è½½ä¸å¸è½½æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="6 æŒ‚è½½ä¸å¸è½½æ–‡ä»¶ç³»ç»Ÿ"></a>6 æŒ‚è½½ä¸å¸è½½æ–‡ä»¶ç³»ç»Ÿ</h2><p>åœ¨æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå†…å®¹ä¹‹å‰ï¼Œå¿…é¡»å…ˆå°†å…¶æŒ‚è½½åˆ°ç³»ç»Ÿä¸Šã€‚è¿™éœ€è¦è®¾å¤‡ä½ç½®ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹ä»¥åŠæŒ‚è½½ç‚¹ï¼Œå…¶ä¸­æŒ‚è½½ç‚¹æ˜¯ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç›®å½•ï¼Œç”¨äºå°†æ–‡ä»¶ç³»ç»Ÿé™„åŠ äºæ­¤ã€‚</p><h4 id="åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ"><a href="#åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ"></a>åˆ›å»ºæŒ‚è½½ç‚¹å¹¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ</h4><p>é¦–å…ˆåˆ›å»ºæŒ‚è½½ç‚¹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> /mydrive</span><br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨<code>mount</code>å‘½ä»¤æŒ‚è½½è®¾å¤‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> mount -t ext4 /dev/sdb2 /mydrive</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>-t</code>å‚æ•°æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œéšåæ˜¯è®¾å¤‡ä½ç½®å’ŒæŒ‚è½½ç‚¹ã€‚</p><h4 id="å¸è½½æ–‡ä»¶ç³»ç»Ÿ"><a href="#å¸è½½æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="å¸è½½æ–‡ä»¶ç³»ç»Ÿ"></a>å¸è½½æ–‡ä»¶ç³»ç»Ÿ</h4><p>è¦ä»æŒ‚è½½ç‚¹å¸è½½è®¾å¤‡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> umount /mydrive</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> umount /dev/sdb2</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå†…æ ¸ä¼šæŒ‰ç…§å‘ç°è®¾å¤‡çš„é¡ºåºå‘½åå®ƒä»¬ã€‚å¦‚æœè®¾å¤‡åç§°åœ¨æŒ‚è½½åå‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨è®¾å¤‡çš„UUIDï¼ˆé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰æ¥ä»£æ›¿åç§°è¿›è¡ŒæŒ‚è½½ã€‚</p><h4 id="æŸ¥çœ‹å’Œä½¿ç”¨UUID"><a href="#æŸ¥çœ‹å’Œä½¿ç”¨UUID" class="headerlink" title="æŸ¥çœ‹å’Œä½¿ç”¨UUID"></a>æŸ¥çœ‹å’Œä½¿ç”¨UUID</h4><p>ä½¿ç”¨<code>blkid</code>å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­å—è®¾å¤‡çš„UUIDï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> blkid</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/dev/sda1: UUID=&quot;130b882f-7d79-436d-a096-1e594c92bb76&quot; TYPE=&quot;ext4&quot;<br>/dev/sda5: UUID=&quot;22c3d34b-467e-467c-b44d-f03803c2c526&quot; TYPE=&quot;swap&quot;<br>/dev/sda6: UUID=&quot;78d203a0-7c18-49bd-9e07-54f44cdb5726&quot; TYPE=&quot;xfs&quot;<br></code></pre></td></tr></table></figure><p>é€šè¿‡UUIDæŒ‚è½½è®¾å¤‡çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> mount UUID=130b882f-7d79-436d-a096-1e594c92bb76 /mydrive</span><br></code></pre></td></tr></table></figure><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ— éœ€é€šè¿‡UUIDæŒ‚è½½è®¾å¤‡ï¼Œç›´æ¥ä½¿ç”¨è®¾å¤‡åæ›´ä¸ºç®€ä¾¿ã€‚ä½†è‹¥éœ€åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚æ·»åŠ äº†ç¬¬äºŒå—ç¡¬ç›˜ï¼Œåˆ™åº”ä½¿ç”¨UUIDã€‚</p><h2 id="7-è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š-etc-fstab"><a href="#7-è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š-etc-fstab" class="headerlink" title="7 è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š&#x2F;etc&#x2F;fstab"></a>7 è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š&#x2F;etc&#x2F;fstab</h2><p>ä¸ºäº†åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥å°†å…¶æ·»åŠ åˆ°<code>/etc/fstab</code>æ–‡ä»¶ä¸­ã€‚è¯¥æ–‡ä»¶æ˜¯æ–‡ä»¶ç³»ç»Ÿè¡¨çš„ç®€ç§°ï¼ŒåŒ…å«äº†ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿçš„æ°¸ä¹…åˆ—è¡¨ã€‚</p><p>ç¤ºä¾‹<code>/etc/fstab</code>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">UUID=130b882f-7d79-436d-a096-1e594c92bb76 /               ext4    relatime,errors=remount-ro 0       1<br>UUID=78d203a0-7c18-49bd-9e07-54f44cdb5726 /home           xfs     relatime        0       2<br>UUID=22c3d34b-467e-467c-b44d-f03803c2c526 none            swap    sw              0       0<br></code></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå­—æ®µå«ä¹‰åˆ†åˆ«ä¸ºï¼š</p><ul><li><strong>UUID</strong>ï¼šè®¾å¤‡æ ‡è¯†ç¬¦ã€‚</li><li><strong>æŒ‚è½½ç‚¹</strong>ï¼šæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°çš„ç›®å½•ã€‚</li><li><strong>æ–‡ä»¶ç³»ç»Ÿç±»å‹</strong>ï¼šå¦‚ext4ã€xfsç­‰ã€‚</li><li><strong>é€‰é¡¹</strong>ï¼šå…¶ä»–æŒ‚è½½é€‰é¡¹ï¼Œè¯¦æƒ…å¯å‚é˜…ç›¸å…³æ‰‹å†Œé¡µã€‚</li><li><strong>è½¬å‚¨æ ‡å¿—</strong>ï¼šç”¨äºè½¬å‚¨å·¥å…·å†³å®šä½•æ—¶è¿›è¡Œå¤‡ä»½ï¼Œé»˜è®¤è®¾ä¸º0å³å¯ã€‚</li><li><strong>æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥é¡ºåº</strong>ï¼šç”±fsckä½¿ç”¨ï¼Œå†³å®šæ–‡ä»¶ç³»ç»Ÿçš„æ£€æŸ¥é¡ºåºã€‚å€¼ä¸º0è¡¨ç¤ºä¸æ£€æŸ¥ã€‚</li></ul><h4 id="æ·»åŠ æ–°æ¡ç›®"><a href="#æ·»åŠ æ–°æ¡ç›®" class="headerlink" title="æ·»åŠ æ–°æ¡ç›®"></a>æ·»åŠ æ–°æ¡ç›®</h4><p>è¦æ·»åŠ æ–°çš„æŒ‚è½½æ¡ç›®ï¼Œç›´æ¥ç¼–è¾‘<code>/etc/fstab</code>æ–‡ä»¶å¹¶æŒ‰ä¸Šè¿°è¯­æ³•æ ¼å¼åŠ å…¥ç›¸åº”çš„ä¿¡æ¯ã€‚ä¿®æ”¹æ­¤æ–‡ä»¶æ—¶éœ€è°¨æ…ï¼Œé”™è¯¯çš„æ›´æ”¹å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿé—®é¢˜ã€‚</p><h2 id="8-äº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰çš„ä½¿ç”¨ä¸ç®¡ç†"><a href="#8-äº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰çš„ä½¿ç”¨ä¸ç®¡ç†" class="headerlink" title="8 äº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰çš„ä½¿ç”¨ä¸ç®¡ç†"></a>8 äº¤æ¢åˆ†åŒºï¼ˆSwapï¼‰çš„ä½¿ç”¨ä¸ç®¡ç†</h2><p>æŸ¥çœ‹åˆ†åŒºè¡¨ã€‚èšç„¦äºå…¶ä¸­ç‰¹å®šçš„ä¸€è¡Œï¼š</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">Number</span>  Start   <span class="hljs-keyword">End</span>    <span class="hljs-built_in">Size</span>    <span class="hljs-keyword">Type</span>       <span class="hljs-keyword">File</span> system    Flags<br><span class="hljs-number">5</span>      <span class="hljs-number">6861</span>MB  <span class="hljs-number">7380</span>MB  <span class="hljs-number">519</span>MB   é€»è¾‘åˆ†åŒº   linux-swap(v1)<br></code></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ˜¯äº¤æ¢åˆ†åŒºï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯äº¤æ¢åˆ†åŒºï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯äº¤æ¢åˆ†åŒºï¼Ÿ"></a>ä»€ä¹ˆæ˜¯äº¤æ¢åˆ†åŒºï¼Ÿ</h4><p>äº¤æ¢åˆ†åŒºï¼ˆswapï¼‰ç”¨äºä¸ºç³»ç»Ÿåˆ†é…è™šæ‹Ÿå†…å­˜ã€‚å½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿä¼šåˆ©ç”¨è¿™ä¸ªåˆ†åŒºå°†éæ´»åŠ¨è¿›ç¨‹çš„éƒ¨åˆ†å†…å­˜â€œäº¤æ¢â€åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</p><h4 id="ä½¿ç”¨åˆ†åŒºä½œä¸ºäº¤æ¢ç©ºé—´"><a href="#ä½¿ç”¨åˆ†åŒºä½œä¸ºäº¤æ¢ç©ºé—´" class="headerlink" title="ä½¿ç”¨åˆ†åŒºä½œä¸ºäº¤æ¢ç©ºé—´"></a>ä½¿ç”¨åˆ†åŒºä½œä¸ºäº¤æ¢ç©ºé—´</h4><p>å‡è®¾æˆ‘ä»¬éœ€è¦å°†<code>/dev/sdb2</code>åˆ†åŒºè®¾ç½®ä¸ºäº¤æ¢ç©ºé—´ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>ç¡®ä¿åˆ†åŒºä¸ºç©º</strong>ï¼šç¡®è®¤ç›®æ ‡åˆ†åŒºæ²¡æœ‰å­˜å‚¨é‡è¦æ•°æ®ã€‚</li><li><strong>åˆå§‹åŒ–äº¤æ¢åŒº</strong>ï¼šè¿è¡Œ<code>mkswap /dev/sdb2</code>å‘½ä»¤ã€‚</li><li><strong>å¯ç”¨äº¤æ¢è®¾å¤‡</strong>ï¼šæ‰§è¡Œ<code>swapon /dev/sdb2</code>ä»¥æ¿€æ´»è¯¥äº¤æ¢åˆ†åŒºã€‚</li><li><strong>æŒä¹…åŒ–è®¾ç½®</strong>ï¼šä¸ºäº†åœ¨ç³»ç»Ÿé‡å¯åä»ç„¶ä¿æŒæ­¤äº¤æ¢åˆ†åŒºæœ‰æ•ˆï¼Œéœ€åœ¨<code>/etc/fstab</code>æ–‡ä»¶ä¸­æ·»åŠ ç›¸åº”çš„æ¡ç›®ï¼Œç±»å‹åº”è®¾ä¸º<code>swap</code>ã€‚</li></ol><p>ç¤ºä¾‹<code>/etc/fstab</code>æ¡ç›®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/dev/sdb2 none swap sw 0 0<br></code></pre></td></tr></table></figure><ul><li><strong>ç¦ç”¨äº¤æ¢</strong>ï¼šè‹¥è¦å…³é—­äº¤æ¢åˆ†åŒºï¼Œå¯ä»¥ä½¿ç”¨<code>swapoff /dev/sdb2</code>å‘½ä»¤ã€‚</li></ul><h4 id="åˆ†é…åŸåˆ™"><a href="#åˆ†é…åŸåˆ™" class="headerlink" title="åˆ†é…åŸåˆ™"></a>åˆ†é…åŸåˆ™</h4><p>é€šå¸¸å»ºè®®åˆ†é…çš„äº¤æ¢ç©ºé—´å¤§å°ä¸ºå®é™…ç‰©ç†å†…å­˜çš„ä¸¤å€ã€‚ç„¶è€Œï¼Œé‰´äºç°ä»Šç³»ç»Ÿçš„å¼ºå¤§æ€§èƒ½åŠå……è¶³çš„RAMå®¹é‡ï¼Œè¿™ä¸€å‡†åˆ™å¯æ ¹æ®å®é™…æƒ…å†µçµæ´»è°ƒæ•´ã€‚å¯¹äºå¤§å¤šæ•°ç°ä»£ç³»ç»Ÿè€Œè¨€ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™ä¸ä¸€å®šéœ€è¦éµå¾ªè¿™ä¸€ä¼ ç»ŸæŒ‡å¯¼åŸåˆ™ã€‚</p><h2 id="9-ç£ç›˜ä½¿ç”¨æƒ…å†µ"><a href="#9-ç£ç›˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="9 ç£ç›˜ä½¿ç”¨æƒ…å†µ"></a>9 ç£ç›˜ä½¿ç”¨æƒ…å†µ</h2><p>ä¸ºäº†ç›‘æ§ç£ç›˜çš„ä½¿ç”¨æƒ…å†µï¼ŒLinux æä¾›äº†å¤šç§å®ç”¨å·¥å…·ã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªæœ€å¸¸ç”¨çš„å‘½ä»¤ï¼š<code>df</code> å’Œ <code>du</code>ã€‚</p><h4 id="ä½¿ç”¨-df-æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿåˆ©ç”¨ç‡"><a href="#ä½¿ç”¨-df-æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿåˆ©ç”¨ç‡" class="headerlink" title="ä½¿ç”¨ df æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿåˆ©ç”¨ç‡"></a>ä½¿ç”¨ <code>df</code> æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿåˆ©ç”¨ç‡</h4><p>é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰å·²æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„åˆ©ç”¨ç‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">df -h<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-keyword">File</span><span class="hljs-params">system</span>     <span class="hljs-number">1</span>K-blocks      Used   Available  Use% Mounted <span class="hljs-literal">on</span><br>/dev/sda1    <span class="hljs-number">6.2</span>G      <span class="hljs-number">2.3</span>G   <span class="hljs-number">3.6</span>G  <span class="hljs-number">40</span>%   /<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>-h</code> æ ‡å¿—ä½¿å¾—è¾“å‡ºç»“æœä»¥äººç±»å¯è¯»çš„æ ¼å¼æ˜¾ç¤ºï¼ˆä¾‹å¦‚ KBã€MBã€GBï¼‰ã€‚è¯¥å‘½ä»¤èƒ½å±•ç¤ºè®¾å¤‡åç§°ã€å®¹é‡ä½¿ç”¨æƒ…å†µåŠå¯ç”¨ç©ºé—´ã€‚</p><h4 id="ä½¿ç”¨-du-åˆ†æç›®å½•å’Œæ–‡ä»¶å¤§å°"><a href="#ä½¿ç”¨-du-åˆ†æç›®å½•å’Œæ–‡ä»¶å¤§å°" class="headerlink" title="ä½¿ç”¨ du åˆ†æç›®å½•å’Œæ–‡ä»¶å¤§å°"></a>ä½¿ç”¨ <code>du</code> åˆ†æç›®å½•å’Œæ–‡ä»¶å¤§å°</h4><p>å¦‚æœéœ€è¦è¿›ä¸€æ­¥äº†è§£å“ªäº›æ–‡ä»¶æˆ–ç›®å½•å ç”¨äº†å¤§é‡ç£ç›˜ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ <code>du</code> å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">du -h<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰æ‰€åœ¨ç›®å½•ä¸‹çš„ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚è‹¥è¦æ£€æŸ¥æ ¹ç›®å½•ä¸‹çš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">du -h /<br></code></pre></td></tr></table></figure><p>ä½†è¯·æ³¨æ„ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡è¾“å‡ºï¼Œå› ä¸ºæ ¹ç›®å½•åŒ…å«äº†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä¿¡æ¯ã€‚</p><h4 id="åŒºåˆ†-df-å’Œ-du"><a href="#åŒºåˆ†-df-å’Œ-du" class="headerlink" title="åŒºåˆ† df å’Œ du"></a>åŒºåˆ† <code>df</code> å’Œ <code>du</code></h4><p>å°½ç®¡è¿™ä¸¤ä¸ªå‘½ä»¤åœ¨è¯­æ³•ä¸Šç›¸ä¼¼ï¼Œå®ƒä»¬çš„åŠŸèƒ½å´æœ‰æ˜æ˜¾åŒºåˆ«ï¼š</p><ul><li><strong>æ£€æŸ¥disk free</strong>ï¼šä½¿ç”¨ <code>df</code>ã€‚</li><li><strong>æ£€æŸ¥disk usage</strong>ï¼šä½¿ç”¨ <code>du</code>ã€‚</li></ul><h2 id="10-æ–‡ä»¶ç³»ç»Ÿä¿®å¤"><a href="#10-æ–‡ä»¶ç³»ç»Ÿä¿®å¤" class="headerlink" title="10 æ–‡ä»¶ç³»ç»Ÿä¿®å¤"></a>10 æ–‡ä»¶ç³»ç»Ÿä¿®å¤</h2><p>åœ¨ä½¿ç”¨è®¡ç®—æœºè¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿå¯èƒ½ä¼šå› ä¸ºçªå‘çš„æ–­ç”µæˆ–å…¶ä»–å¼‚å¸¸æƒ…å†µè€Œå—æŸï¼Œå¯¼è‡´æ•°æ®æŸåã€‚ä¸ºäº†æ¢å¤ç³»ç»Ÿçš„æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œå¯ä»¥åˆ©ç”¨ <code>fsck</code>ï¼ˆæ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼‰å‘½ä»¤æ¥æ£€æŸ¥å¹¶å°è¯•ä¿®å¤æ–‡ä»¶ç³»ç»Ÿçš„é”™è¯¯ã€‚</p><h4 id="ä½¿ç”¨-fsck-å‘½ä»¤"><a href="#ä½¿ç”¨-fsck-å‘½ä»¤" class="headerlink" title="ä½¿ç”¨ fsck å‘½ä»¤"></a>ä½¿ç”¨ <code>fsck</code> å‘½ä»¤</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“å¯åŠ¨ç³»ç»Ÿæ—¶ï¼Œå¦‚æœæ£€æµ‹åˆ°æ–‡ä»¶ç³»ç»Ÿå¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ<code>fsck</code> ä¼šè‡ªåŠ¨è¿è¡Œä»¥ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿåœ¨æŒ‚è½½å‰å¤„äºè‰¯å¥½çŠ¶æ€ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æŸåç¨‹åº¦è¾ƒé«˜ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¹²é¢„è¿›è¡Œä¿®å¤ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æ‰‹åŠ¨æ£€æŸ¥å’Œä¿®å¤æ–‡ä»¶ç³»ç»Ÿï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo fsck /dev/sda<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œæ‰§è¡Œ <code>fsck</code> æ“ä½œæ—¶åº”ç¡®ä¿ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿæœªè¢«æŒ‚è½½ï¼Œä»¥å…é€ æˆè¿›ä¸€æ­¥çš„æ•°æ®æŸåã€‚å»ºè®®åœ¨æ•‘æ´æ¨¡å¼æˆ–é€šè¿‡å…¶ä»–å¯è®¿é—®æ–‡ä»¶ç³»ç»Ÿä½†ä¸æŒ‚è½½çš„æ–¹å¼ä¸‹è¿è¡Œæ­¤å‘½ä»¤ã€‚</p><h2 id="11-ç´¢å¼•èŠ‚ç‚¹ï¼ˆInodesï¼‰"><a href="#11-ç´¢å¼•èŠ‚ç‚¹ï¼ˆInodesï¼‰" class="headerlink" title="11 ç´¢å¼•èŠ‚ç‚¹ï¼ˆInodesï¼‰"></a>11 ç´¢å¼•èŠ‚ç‚¹ï¼ˆInodesï¼‰</h2><p>æ–‡ä»¶ç³»ç»Ÿä¸ä»…åŒ…å«äº†å®é™…çš„æ–‡ä»¶æ•°æ®ï¼Œè¿˜åŒ…å«ä¸€ä¸ªç”¨äºç®¡ç†è¿™äº›æ–‡ä»¶çš„æ•°æ®åº“ï¼Œå³ç´¢å¼•èŠ‚ç‚¹è¡¨ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Ÿ</h4><p>ç´¢å¼•èŠ‚ç‚¹ï¼ˆinodeï¼‰æ˜¯è¯¥è¡¨ä¸­çš„ä¸€ä¸ªæ¡ç›®ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹ã€‚å®ƒè®°å½•äº†é™¤æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å¤–çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ–‡ä»¶ç±»å‹ï¼šæ™®é€šæ–‡ä»¶ã€ç›®å½•ã€å­—ç¬¦è®¾å¤‡ç­‰</li><li>æ‰€æœ‰è€…</li><li>ç”¨æˆ·ç»„</li><li>è®¿é—®æƒé™</li><li>æ—¶é—´æˆ³ï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼ˆmtimeï¼‰ã€æœ€åä¸€æ¬¡å±æ€§æ›´æ”¹æ—¶é—´ï¼ˆctimeï¼‰ã€æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼ˆatimeï¼‰</li><li>æ–‡ä»¶çš„ç¡¬é“¾æ¥æ•°</li><li>æ–‡ä»¶å¤§å°</li><li>åˆ†é…ç»™æ–‡ä»¶çš„æ•°æ®å—æ•°é‡</li><li>æŒ‡å‘æ–‡ä»¶æ•°æ®å—çš„æŒ‡é’ˆâ€”â€”è¿™æ˜¯æœ€ä¸ºå…³é”®çš„éƒ¨åˆ†</li></ul><h4 id="ç´¢å¼•èŠ‚ç‚¹çš„åˆ›å»º"><a href="#ç´¢å¼•èŠ‚ç‚¹çš„åˆ›å»º" class="headerlink" title="ç´¢å¼•èŠ‚ç‚¹çš„åˆ›å»º"></a>ç´¢å¼•èŠ‚ç‚¹çš„åˆ›å»º</h4><p>åœ¨æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºæ—¶ï¼Œä¼šä¸ºç´¢å¼•èŠ‚ç‚¹åˆ†é…ç©ºé—´ã€‚åˆ†é…çš„ç©ºé—´é‡åŸºäºç£ç›˜å®¹é‡å’Œå…¶ä»–å› ç´ é€šè¿‡ç®—æ³•å†³å®šã€‚å°½ç®¡è¾ƒä¸ºå°‘è§ï¼Œä½†ä¸ç£ç›˜ç©ºé—´ä¸€æ ·ï¼Œç´¢å¼•èŠ‚ç‚¹ä¹Ÿå¯èƒ½è€—å°½ï¼Œå¯¼è‡´æ— æ³•åˆ›å»ºæ–°æ–‡ä»¶ã€‚ä½¿ç”¨å‘½ä»¤ <code>df -i</code> å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿä¸­å‰©ä½™çš„ç´¢å¼•èŠ‚ç‚¹æ•°é‡ã€‚</p><h4 id="æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹ä¿¡æ¯"><a href="#æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹ä¿¡æ¯"></a>æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹ä¿¡æ¯</h4><p>ç´¢å¼•èŠ‚ç‚¹é€šè¿‡ç¼–å·è¿›è¡Œæ ‡è¯†ï¼Œæ–°åˆ›å»ºçš„æ–‡ä»¶ä¼šè¢«åˆ†é…ä¸€ä¸ªé¡ºåºé€’å¢çš„ç´¢å¼•èŠ‚ç‚¹å·ã€‚ç„¶è€Œï¼Œå½“åˆ é™¤æ–‡ä»¶åï¼Œå…¶ç´¢å¼•èŠ‚ç‚¹å¯ä»¥è¢«é‡æ–°ä½¿ç”¨ï¼Œå› æ­¤æœ‰æ—¶æ–°æ–‡ä»¶å¯èƒ½ä¼šè·å¾—æ¯”å…¶ä»–ç°æœ‰æ–‡ä»¶æ›´ä½çš„ç´¢å¼•èŠ‚ç‚¹å·ã€‚ä½¿ç”¨ <code>ls -li</code> å‘½ä»¤å¯æŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹å·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">pete@icebox:~$ ls -li<br>140 drwxr-xr-x 2 pete pete 6 Jan 20 20:13 Desktop<br>141 drwxr-xr-x 2 pete pete 6 Jan 20 20:01 Documents<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤çš„ç¬¬ä¸€åˆ—æ˜¾ç¤ºçš„æ˜¯ç´¢å¼•èŠ‚ç‚¹å·ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>stat</code> å‘½ä»¤è·å–æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶ç´¢å¼•èŠ‚ç‚¹ç›¸å…³æ•°æ®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">pete@icebox:~$ stat ~/Desktop/<br>  File: â€˜/home/pete/Desktop/â€™<br>  Size: 6               Blocks: 0          IO Block: 4096   directory<br>Device: 806h/2054d      Inode: 140         Links: 2<br>Access: (0755/drwxr-xr-x)  Uid: ( 1000/   pete)   Gid: ( 1000/   pete)<br>Access: 2016-01-20 20:13:50.647435982 -0800<br>Modify: 2016-01-20 20:13:06.191675843 -0800<br>Change: 2016-01-20 20:13:06.191675843 -0800<br> Birth: -<br></code></pre></td></tr></table></figure><h4 id="ç´¢å¼•èŠ‚ç‚¹å¦‚ä½•å®šä½æ–‡ä»¶ï¼Ÿ"><a href="#ç´¢å¼•èŠ‚ç‚¹å¦‚ä½•å®šä½æ–‡ä»¶ï¼Ÿ" class="headerlink" title="ç´¢å¼•èŠ‚ç‚¹å¦‚ä½•å®šä½æ–‡ä»¶ï¼Ÿ"></a>ç´¢å¼•èŠ‚ç‚¹å¦‚ä½•å®šä½æ–‡ä»¶ï¼Ÿ</h4><p>ç´¢å¼•èŠ‚ç‚¹æŒ‡å‘å®é™…å­˜å‚¨æ–‡ä»¶æ•°æ®çš„æ•°æ®å—ã€‚å…¸å‹çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç´¢å¼•èŠ‚ç‚¹åŒ…å«15ä¸ªæŒ‡é’ˆã€‚å‰12ä¸ªç›´æ¥æŒ‡å‘æ–‡ä»¶çš„æ•°æ®å—ï¼›ç¬¬13ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåŒ…å«æ›´å¤šæŒ‡é’ˆçš„å—ï¼›ç¬¬14ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªåµŒå¥—çš„æŒ‡é’ˆå—ï¼›ç¬¬15ä¸ªæŒ‡é’ˆå†æ¬¡æŒ‡å‘å¦ä¸€ç»„æŒ‡é’ˆå—ã€‚è¿™ç§ç»“æ„ä½¿å¾—æ— è®ºæ–‡ä»¶å¤§å°å¦‚ä½•ï¼Œç´¢å¼•èŠ‚ç‚¹ç»“æ„ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†å’Œå¼•ç”¨ä¸åŒå¤§å°çš„æ–‡ä»¶ã€‚è¾ƒå°çš„æ–‡ä»¶å¯é€šè¿‡å‰12ä¸ªç›´æ¥æŒ‡é’ˆå¿«é€Ÿæ‰¾åˆ°ï¼Œè¾ƒå¤§çš„æ–‡ä»¶åˆ™éœ€é€šè¿‡åµŒå¥—çš„æŒ‡é’ˆé“¾æ¥å®šä½ã€‚</p><h2 id="12-ç¬¦å·é“¾æ¥ï¼ˆSymlinksï¼‰ä¸ç¡¬é“¾æ¥ï¼ˆHardlinksï¼‰"><a href="#12-ç¬¦å·é“¾æ¥ï¼ˆSymlinksï¼‰ä¸ç¡¬é“¾æ¥ï¼ˆHardlinksï¼‰" class="headerlink" title="12 ç¬¦å·é“¾æ¥ï¼ˆSymlinksï¼‰ä¸ç¡¬é“¾æ¥ï¼ˆHardlinksï¼‰"></a>12 ç¬¦å·é“¾æ¥ï¼ˆSymlinksï¼‰ä¸ç¡¬é“¾æ¥ï¼ˆHardlinksï¼‰</h2><p>åœ¨Linuxæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸¤ç§ä¸»è¦ç±»å‹çš„é“¾æ¥ï¼šç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰å’Œç¡¬é“¾æ¥ï¼ˆhardlinksï¼‰ã€‚</p><h4 id="ç¬¦å·é“¾æ¥"><a href="#ç¬¦å·é“¾æ¥" class="headerlink" title="ç¬¦å·é“¾æ¥"></a>ç¬¦å·é“¾æ¥</h4><p>ç¬¦å·é“¾æ¥ç±»ä¼¼äºWindowsæ“ä½œç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ã€‚å®ƒæ˜¯æŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶åçš„åˆ«åã€‚å¦‚æœåŸå§‹æ–‡ä»¶è¢«åˆ é™¤æˆ–ä¿®æ”¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¬¦å·é“¾æ¥å¤±æ•ˆã€‚åˆ›å»ºç¬¦å·é“¾æ¥æ—¶ï¼Œä½¿ç”¨<code>ln -s</code>å‘½ä»¤æŒ‡å®šç›®æ ‡æ–‡ä»¶å’Œé“¾æ¥åç§°ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">pete@icebox:~/Desktop$ echo &#x27;myfile&#x27; &gt; myfile<br>pete@icebox:~/Desktop$ ln -s myfile myfilelink<br><br>pete@icebox:~/Desktop$ ls -li<br>93403 lrwxrwxrwx 1 pete pete 6 Jan 21 21:39 myfilelink -&gt; myfile<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>ls -li</code>åï¼Œ  <code>myfilelink</code> æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>myfile</code> çš„ç¬¦å·é“¾æ¥ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç¬¦å·é“¾æ¥æ‹¥æœ‰ç‹¬ç«‹çš„ç´¢å¼•èŠ‚ç‚¹å·ï¼Œå¹¶ä¸”ä¸ä¾èµ–äºç´¢å¼•èŠ‚ç‚¹æ¥å®ç°è·¨æ–‡ä»¶ç³»ç»Ÿçš„å¼•ç”¨ã€‚</p><h4 id="ç¡¬é“¾æ¥"><a href="#ç¡¬é“¾æ¥" class="headerlink" title="ç¡¬é“¾æ¥"></a>ç¡¬é“¾æ¥</h4><p>ç¡¬é“¾æ¥åˆ™ä¸åŒï¼Œå®ƒæ˜¯ç›´æ¥æŒ‡å‘åŒä¸€ç´¢å¼•èŠ‚ç‚¹çš„å¦ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ é€šè¿‡ä»»ä½•ç¡¬é“¾æ¥ä¹‹ä¸€ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œæ‰€æœ‰ç›¸å…³è”çš„ç¡¬é“¾æ¥éƒ½ä¼šåæ˜ è¿™äº›æ›´æ”¹ã€‚åªæœ‰å½“ä¸æŸä¸ªç´¢å¼•èŠ‚ç‚¹å…³è”çš„æ‰€æœ‰ç¡¬é“¾æ¥éƒ½è¢«åˆ é™¤æ—¶ï¼Œè¯¥ç´¢å¼•èŠ‚ç‚¹åŠå…¶æ•°æ®æ‰ä¼šçœŸæ­£è¢«åˆ é™¤ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">pete@icebox:~/Desktop$ ln myfile2 myhardlink<br><br>pete@icebox:~/Desktop$ ls -li<br>total 16<br><br>  151 -rw-rw-r-- 1 pete pete 7 Jan 21 21:36 myfile<br><br>93401 -rw-rw-r-- 2 pete pete 8 Jan 21 21:36 myfile2<br><br>93402 -rw-rw-r-- 1 pete pete 8 Jan 21 21:36 myfile3<br><br>93403 lrwxrwxrwx 1 pete pete 6 Jan 21 21:39 myfilelink -&gt; myfile<br><br>93401 -rw-rw-r-- 2 pete pete 8 Jan 21 21:36 myhardlink<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>ls -li</code>åï¼Œå¯ä»¥çœ‹åˆ°<code>myfile2</code>å’Œ<code>myhardlink</code>å…±äº«ç›¸åŒçš„ç´¢å¼•èŠ‚ç‚¹å·ã€‚è¿™æ„å‘³ç€æ— è®ºä½ é€šè¿‡å“ªä¸ªç¡¬é“¾æ¥è¿›è¡Œä¿®æ”¹ï¼Œä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½å°†åŒæ­¥æ›´æ–°ã€‚ç¡¬é“¾æ¥çš„æ•°é‡å¯ä»¥é€šè¿‡<code>ls</code>å‘½ä»¤è¾“å‡ºä¸­çš„é“¾æ¥è®¡æ•°å­—æ®µæŸ¥çœ‹ã€‚</p><p>ç¡¬é“¾æ¥çš„ä¸€ä¸ªå…³é”®é™åˆ¶æ˜¯å®ƒä»¬ä¸èƒ½è·¨è¶Šä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•èŠ‚ç‚¹éƒ½æ˜¯å”¯ä¸€çš„ã€‚ç›¸åï¼Œç¬¦å·é“¾æ¥å¯ä»¥è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºæ–‡ä»¶è·¯å¾„è€Œéç´¢å¼•èŠ‚ç‚¹ã€‚</p><h4 id="åˆ›å»ºé“¾æ¥çš„å‘½ä»¤"><a href="#åˆ›å»ºé“¾æ¥çš„å‘½ä»¤" class="headerlink" title="åˆ›å»ºé“¾æ¥çš„å‘½ä»¤"></a>åˆ›å»ºé“¾æ¥çš„å‘½ä»¤</h4><ul><li><p><strong>åˆ›å»ºç¬¦å·é“¾æ¥</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ln</span> -s myfile mylink</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ln</code>å‘½ä»¤åŠ ä¸Š<code>-s</code>é€‰é¡¹æ¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘<code>myfile</code>çš„ç¬¦å·é“¾æ¥<code>mylink</code>ã€‚</p></li><li><p><strong>åˆ›å»ºç¡¬é“¾æ¥</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">ln</span> somefile somelink</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºç¡¬é“¾æ¥æ—¶çœç•¥<code>-s</code>é€‰é¡¹ï¼Œç›´æ¥æŒ‡å®šæºæ–‡ä»¶å’Œé“¾æ¥åç§°å³å¯ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Devices</title>
    <link href="/2025/03/21/Linux-Devices/"/>
    <url>/2025/03/21/Linux-Devices/</url>
    
    <content type="html"><![CDATA[<h1 id="Devices"><a href="#Devices" class="headerlink" title="Devices"></a>Devices</h1><h2 id="1-devç›®å½•"><a href="#1-devç›®å½•" class="headerlink" title="1 &#x2F;devç›®å½•"></a>1 &#x2F;devç›®å½•</h2><p>å½“å°†ä¸€ä¸ªè®¾å¤‡è¿æ¥åˆ°è®¡ç®—æœºæ—¶ï¼Œé€šå¸¸éœ€è¦ä¸€ä¸ªè®¾å¤‡é©±åŠ¨ç¨‹åºä»¥ç¡®ä¿å…¶æ­£å¸¸å·¥ä½œã€‚è®¾å¤‡é©±åŠ¨ç¨‹åºå¯é€šè¿‡è®¾å¤‡æ–‡ä»¶æˆ–è®¾å¤‡èŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œè¿™äº›ç‰¹æ®Šæ–‡ä»¶çœ‹èµ·æ¥å°±åƒæ™®é€šæ–‡ä»¶ä¸€æ ·ã€‚ç”±äºè¿™äº›è®¾å¤‡æ–‡ä»¶ä¸æ™®é€šæ–‡ä»¶ç›¸ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨å¦‚<code>ls</code>ã€<code>cat</code>ç­‰å‘½ä»¤æ¥ä¸å®ƒä»¬äº’åŠ¨ã€‚è¿™äº›è®¾å¤‡æ–‡ä»¶ä¸€èˆ¬å­˜å‚¨åœ¨<code>/dev</code>ç›®å½•ä¸‹ã€‚</p><h4 id="æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è®¾å¤‡æ–‡ä»¶"><a href="#æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è®¾å¤‡æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è®¾å¤‡æ–‡ä»¶"></a>æŸ¥çœ‹ç³»ç»Ÿä¸­çš„è®¾å¤‡æ–‡ä»¶</h4><p>è¦æŸ¥çœ‹æ‚¨çš„ç³»ç»Ÿä¸­æœ‰å“ªäº›è®¾å¤‡æ–‡ä»¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /dev<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œä¼šçœ‹åˆ°å¤§é‡å­˜åœ¨äºç³»ç»Ÿä¸­çš„è®¾å¤‡æ–‡ä»¶ã€‚å…¶ä¸­ä¸€äº›è®¾å¤‡æ–‡ä»¶ï¼Œæ¯”å¦‚<code>/dev/null</code>ï¼Œå½“å‘<code>/dev/null</code>å‘é€è¾“å‡ºæ—¶ï¼Œå†…æ ¸çŸ¥é“è¯¥è®¾å¤‡ä¼šæ¥æ”¶æ‰€æœ‰è¾“å…¥å¹¶ç›´æ¥ä¸¢å¼ƒï¼Œå› æ­¤ä¸ä¼šæœ‰ä»»ä½•è¿”å›å†…å®¹ã€‚</p><h4 id="ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜"><a href="#ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜"></a>ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜</h4><p>åœ¨è¿‡å»ï¼Œå¦‚æœæƒ³è¦å‘ç³»ç»Ÿæ·»åŠ ä¸€ä¸ªè®¾å¤‡ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨<code>/dev</code>ç›®å½•ä¸‹æ·»åŠ ç›¸åº”çš„è®¾å¤‡æ–‡ä»¶ï¼Œç„¶åå¾ˆå¯èƒ½å°±ä¸å†ç†ä¼šå®ƒäº†ã€‚é‡å¤å‡ æ¬¡ä¹‹åï¼Œé—®é¢˜ä¾¿æ˜¾ç°å‡ºæ¥äº†ï¼š<code>/dev</code>ç›®å½•ä¼šè¢«é•¿æœŸæœªä½¿ç”¨æˆ–å·²å‡çº§è®¾å¤‡çš„é™æ€è®¾å¤‡æ–‡ä»¶æ‰€å †ç§¯ã€‚æ­¤å¤–ï¼Œè®¾å¤‡è¿˜ä¼šæ ¹æ®å†…æ ¸å‘ç°å®ƒä»¬çš„é¡ºåºè¢«åˆ†é…è®¾å¤‡æ–‡ä»¶ã€‚è¿™æ„å‘³ç€æ¯æ¬¡ç³»ç»Ÿé‡å¯åï¼Œè®¾å¤‡å¯èƒ½ä¼šå› ä¸ºè¢«å‘ç°çš„æ—¶é—´ä¸åŒè€Œæ‹¥æœ‰ä¸åŒçš„è®¾å¤‡æ–‡ä»¶ã€‚</p><h4 id="åŠ¨æ€ç®¡ç†è®¾å¤‡çš„æ–°æ–¹æ³•"><a href="#åŠ¨æ€ç®¡ç†è®¾å¤‡çš„æ–°æ–¹æ³•" class="headerlink" title="åŠ¨æ€ç®¡ç†è®¾å¤‡çš„æ–°æ–¹æ³•"></a>åŠ¨æ€ç®¡ç†è®¾å¤‡çš„æ–°æ–¹æ³•</h4><p>ç°åœ¨é‡‡ç”¨äº†ä¸€ç§æ–°çš„æœºåˆ¶æ¥åŠ¨æ€åœ°æ·»åŠ å’Œç§»é™¤ç³»ç»Ÿä¸­å½“å‰æ­£åœ¨ä½¿ç”¨çš„è®¾å¤‡ï¼Œä»è€Œé¿å…äº†ä¸Šè¿°é—®é¢˜ã€‚è¿™ç§æ–¹æ³•å°†åœ¨åé¢è¯¦ç»†è®¨è®ºã€‚</p><h2 id="2-è®¾å¤‡ç§ç±»"><a href="#2-è®¾å¤‡ç§ç±»" class="headerlink" title="2 è®¾å¤‡ç§ç±»"></a>2 è®¾å¤‡ç§ç±»</h2><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥åˆ—å‡º<code>/dev</code>ç›®å½•ä¸‹çš„è®¾å¤‡æ–‡ä»¶åŠå…¶è¯¦ç»†ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l /dev<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">brw</span>-rw----   <span class="hljs-number">1</span> root disk      <span class="hljs-number">8</span>,   <span class="hljs-number">0</span> Dec <span class="hljs-number">20</span> <span class="hljs-number">20</span>:<span class="hljs-number">13</span> sda<br><span class="hljs-attribute">crw</span>-rw-rw-   <span class="hljs-number">1</span> root root      <span class="hljs-number">1</span>,   <span class="hljs-number">3</span> Dec <span class="hljs-number">20</span> <span class="hljs-number">20</span>:<span class="hljs-number">13</span> null<br><span class="hljs-attribute">srw</span>-rw-rw-   <span class="hljs-number">1</span> root root           <span class="hljs-number">0</span> Dec <span class="hljs-number">20</span> <span class="hljs-number">20</span>:<span class="hljs-number">13</span> log<br><span class="hljs-attribute">prw</span>-r--r--   <span class="hljs-number">1</span> root root           <span class="hljs-number">0</span> Dec <span class="hljs-number">20</span> <span class="hljs-number">20</span>:<span class="hljs-number">13</span> fdata<br></code></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œä»å·¦è‡³å³åˆ†åˆ«è¡¨ç¤ºæƒé™ã€æ‰€æœ‰è€…ã€æ‰€å±ç»„ã€ä¸»è®¾å¤‡å·ã€æ¬¡è®¾å¤‡å·ã€æ—¶é—´æˆ³å’Œ\åç§°ã€‚</p><h4 id="æ–‡ä»¶ç±»å‹çš„æ ‡è¯†"><a href="#æ–‡ä»¶ç±»å‹çš„æ ‡è¯†" class="headerlink" title="æ–‡ä»¶ç±»å‹çš„æ ‡è¯†"></a>æ–‡ä»¶ç±»å‹çš„æ ‡è¯†</h4><p>ä½¿ç”¨<code>ls</code>å‘½ä»¤æ—¶ï¼Œå¯ä»¥é€šè¿‡æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¯†åˆ«æ–‡ä»¶ç±»å‹ã€‚è®¾å¤‡æ–‡ä»¶çš„æ ‡è¯†ç¬¦å¦‚ä¸‹ï¼š</p><ul><li><code>c</code>ï¼šå­—ç¬¦è®¾å¤‡</li><li><code>b</code>ï¼šå—è®¾å¤‡</li><li><code>p</code>ï¼šç®¡é“è®¾å¤‡</li><li><code>s</code>ï¼šå¥—æ¥å­—è®¾å¤‡</li></ul><h4 id="å­—ç¬¦è®¾å¤‡"><a href="#å­—ç¬¦è®¾å¤‡" class="headerlink" title="å­—ç¬¦è®¾å¤‡"></a>å­—ç¬¦è®¾å¤‡</h4><p>æ­¤ç±»è®¾å¤‡é€å­—ç¬¦ä¼ è¾“æ•°æ®ã€‚å¸¸è§äºä¼ªè®¾å¤‡ï¼ˆå¦‚<code>/dev/null</code>ï¼‰ï¼Œè¿™äº›ä¼ªè®¾å¤‡å¹¶éç‰©ç†è¿æ¥åˆ°æœºå™¨ä¸Šï¼Œä½†å®ƒä»¬æ‰©å±•äº†æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p><h4 id="å—è®¾å¤‡"><a href="#å—è®¾å¤‡" class="headerlink" title="å—è®¾å¤‡"></a>å—è®¾å¤‡</h4><p>æ­¤ç±»è®¾å¤‡ä»¥å¤§è€Œå›ºå®šå¤§å°çš„æ•°æ®å—è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚æœ€å¸¸è§çš„æ˜¯ç¡¬ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿç­‰åˆ©ç”¨æ•°æ®å—çš„è®¾å¤‡ã€‚</p><h4 id="ç®¡é“è®¾å¤‡"><a href="#ç®¡é“è®¾å¤‡" class="headerlink" title="ç®¡é“è®¾å¤‡"></a>ç®¡é“è®¾å¤‡</h4><p>å‘½åç®¡é“å…è®¸ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œä¸å­—ç¬¦è®¾å¤‡ç±»ä¼¼ï¼Œä½†å…¶è¾“å‡ºæ˜¯å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹è€Œéè®¾å¤‡ã€‚</p><h4 id="å¥—æ¥å­—è®¾å¤‡"><a href="#å¥—æ¥å­—è®¾å¤‡" class="headerlink" title="å¥—æ¥å­—è®¾å¤‡"></a>å¥—æ¥å­—è®¾å¤‡</h4><p>å¥—æ¥å­—è®¾å¤‡ä¿ƒè¿›è¿›ç¨‹é—´çš„é€šä¿¡ï¼Œç±»ä¼¼äºç®¡é“è®¾å¤‡ï¼Œä½†èƒ½å¤ŸåŒæ—¶ä¸å¤šä¸ªè¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚</p><h4 id="è®¾å¤‡ç¼–å·"><a href="#è®¾å¤‡ç¼–å·" class="headerlink" title="è®¾å¤‡ç¼–å·"></a>è®¾å¤‡ç¼–å·</h4><p>è®¾å¤‡é€šè¿‡ä¸¤ä¸ªæ•°å­—è¿›è¡Œåˆ†ç±»ï¼šä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å·ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè®¾å¤‡ç¼–å·8, 0ï¼š</p><ul><li>ä¸»è®¾å¤‡å·ï¼ˆ8ï¼‰ä»£è¡¨æ‰€ä½¿ç”¨çš„è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œè¿™é€šå¸¸å¯¹åº”sdå—è®¾å¤‡ã€‚</li><li>æ¬¡è®¾å¤‡å·ï¼ˆ0ï¼‰å‘Šè¯‰å†…æ ¸è¯¥è®¾å¤‡åœ¨æ­¤é©±åŠ¨ç±»åˆ«ä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œä¾‹å¦‚è¿™é‡Œçš„0è¡¨ç¤ºç¬¬ä¸€ä¸ªè®¾å¤‡ï¼ˆaï¼‰ã€‚</li></ul><h2 id="3-è®¾å¤‡åç§°"><a href="#3-è®¾å¤‡åç§°" class="headerlink" title="3 è®¾å¤‡åç§°"></a>3 è®¾å¤‡åç§°</h2><h4 id="SCSIè®¾å¤‡"><a href="#SCSIè®¾å¤‡" class="headerlink" title="SCSIè®¾å¤‡"></a>SCSIè®¾å¤‡</h4><p>å¦‚æœä½¿ç”¨çš„æœºå™¨ä¸Šæœ‰ä»»ä½•å½¢å¼çš„å¤§å®¹é‡å­˜å‚¨ï¼Œå¾ˆæœ‰å¯èƒ½å®ƒä½¿ç”¨çš„æ˜¯SCSIï¼ˆå‘éŸ³ä¸ºâ€scuzzyâ€ï¼‰åè®®ã€‚SCSIä»£è¡¨å°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£ï¼Œæ˜¯ä¸€ç§å…è®¸ç£ç›˜ã€æ‰“å°æœºã€æ‰«æä»ªåŠå…¶ä»–å¤–å›´è®¾å¤‡ä¸ç³»ç»Ÿé€šä¿¡çš„åè®®ã€‚å°½ç®¡å®é™…çš„SCSIè®¾å¤‡å¯èƒ½ä¸å†å¹¿æ³›åº”ç”¨äºç°ä»£ç³»ç»Ÿä¸­ï¼Œä½†åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒSCSIç£ç›˜é€šå¸¸å¯¹åº”äº&#x2F;devç›®å½•ä¸‹çš„ç¡¬ç›˜é©±åŠ¨å™¨ï¼Œå¹¶ä»¥sdï¼ˆSCSI diskï¼‰ä½œä¸ºå‰ç¼€æ ‡è¯†ã€‚</p><ul><li><code>/dev/sda</code>ï¼šç¬¬ä¸€å—ç¡¬ç›˜</li><li><code>/dev/sdb</code>ï¼šç¬¬äºŒå—ç¡¬ç›˜</li><li><code>/dev/sda3</code>ï¼šç¬¬ä¸€å—ç¡¬ç›˜ä¸Šçš„ç¬¬ä¸‰ä¸ªåˆ†åŒº</li></ul><h4 id="ä¼ªè®¾å¤‡"><a href="#ä¼ªè®¾å¤‡" class="headerlink" title="ä¼ªè®¾å¤‡"></a>ä¼ªè®¾å¤‡</h4><p>ä¼ªè®¾å¤‡å¹¶éç‰©ç†è¿æ¥åˆ°ç³»ç»Ÿä¸Šï¼Œå®ƒä»¬å¤šæ•°ä½œä¸ºå­—ç¬¦è®¾å¤‡å­˜åœ¨ï¼š</p><ul><li><code>/dev/zero</code>ï¼šæ¥å—æ‰€æœ‰è¾“å…¥å¹¶ä¸¢å¼ƒä¹‹ï¼Œç”Ÿæˆè¿ç»­çš„NULLï¼ˆé›¶å€¼ï¼‰å­—èŠ‚æµã€‚</li><li><code>/dev/null</code>ï¼šæ¥å—æ‰€æœ‰è¾“å…¥å¹¶ä¸¢å¼ƒä¹‹ï¼Œä¸äº§ç”Ÿä»»ä½•è¾“å‡ºã€‚</li><li><code>/dev/random</code>ï¼šç”Ÿæˆéšæœºæ•°ã€‚</li></ul><h4 id="PATAè®¾å¤‡"><a href="#PATAè®¾å¤‡" class="headerlink" title="PATAè®¾å¤‡"></a>PATAè®¾å¤‡</h4><p>åœ¨ä¸€äº›è¾ƒè€çš„ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä½¿ç”¨hdå‰ç¼€è¡¨ç¤ºçš„ç¡¬ç›˜é©±åŠ¨å™¨ï¼š</p><ul><li><code>/dev/hda</code>ï¼šç¬¬ä¸€å—ç¡¬ç›˜</li><li><code>/dev/hdd2</code>ï¼šç¬¬å››å—ç¡¬ç›˜ä¸Šçš„ç¬¬äºŒä¸ªåˆ†åŒº</li></ul><h2 id="4-sysfs"><a href="#4-sysfs" class="headerlink" title="4 sysfs"></a>4 sysfs</h2><h3 id="Sysfsä¸è®¾å¤‡ç®¡ç†"><a href="#Sysfsä¸è®¾å¤‡ç®¡ç†" class="headerlink" title="Sysfsä¸è®¾å¤‡ç®¡ç†"></a>Sysfsä¸è®¾å¤‡ç®¡ç†</h3><p>Sysfsæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºçš„ç›®çš„åœ¨äºæ›´æœ‰æ•ˆåœ°ç®¡ç†ç³»ç»Ÿä¸­çš„è®¾å¤‡ï¼Œè¡¥å……äº†&#x2F;devç›®å½•æœªèƒ½æä¾›çš„åŠŸèƒ½ã€‚ä½œä¸ºä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ŒSysfsé€šå¸¸æŒ‚è½½äº&#x2F;sysç›®å½•ä¸‹ï¼Œæä¾›äº†æ¯”&#x2F;devç›®å½•æ›´ä¸ºè¯¦å°½çš„è®¾å¤‡ä¿¡æ¯ã€‚å°½ç®¡&#x2F;syså’Œ&#x2F;devç›®å½•åœ¨æŸäº›æ–¹é¢çœ‹èµ·æ¥ç›¸ä¼¼ï¼Œä½†å®ƒä»¬æœ‰ç€æ˜æ˜¾çš„åŒºåˆ«å’Œä¸åŒçš„ç”¨é€”ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ&#x2F;devç›®å½•æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œå…è®¸å…¶ä»–ç¨‹åºç›´æ¥è®¿é—®è®¾å¤‡ï¼›è€Œ&#x2F;sysæ–‡ä»¶ç³»ç»Ÿåˆ™ç”¨äºæŸ¥çœ‹è®¾å¤‡ä¿¡æ¯å’Œè¿›è¡Œè®¾å¤‡ç®¡ç†ã€‚</p><h4 id="Sysfsä¸‹çš„è®¾å¤‡ä¿¡æ¯"><a href="#Sysfsä¸‹çš„è®¾å¤‡ä¿¡æ¯" class="headerlink" title="Sysfsä¸‹çš„è®¾å¤‡ä¿¡æ¯"></a>Sysfsä¸‹çš„è®¾å¤‡ä¿¡æ¯</h4><p>&#x2F;sysæ–‡ä»¶ç³»ç»ŸåŒ…å«äº†ç³»ç»Ÿä¸­æ‰€æœ‰è®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚åˆ¶é€ å•†ã€å‹å·ã€è®¾å¤‡è¿æ¥ä½ç½®ã€è®¾å¤‡çŠ¶æ€ã€è®¾å¤‡å±‚æ¬¡ç»“æ„ç­‰ã€‚ä»¥ä¸‹æ˜¯é€šè¿‡æµè§ˆ&#x2F;sys&#x2F;block&#x2F;sdaç›®å½•å†…å®¹æ‰€å±•ç¤ºçš„éƒ¨åˆ†ç¤ºä¾‹ï¼š</p><ul><li><code>alignment_offset</code>ã€<code>discard_alignment</code>ï¼šå…³äºç£ç›˜å¯¹é½çš„ä¿¡æ¯ã€‚</li><li><code>holders</code>ã€<code>slaves</code>ï¼šæ˜¾ç¤ºæ­¤è®¾å¤‡è¢«å“ªäº›è®¾å¤‡æŒæœ‰æˆ–ä¾èµ–çš„è®¾å¤‡ã€‚</li><li><code>removable</code>ï¼šæŒ‡ç¤ºè®¾å¤‡æ˜¯å¦å¯ç§»é™¤ã€‚</li><li><code>ro</code>ï¼šæŒ‡ç¤ºè®¾å¤‡æ˜¯å¦åªè¯»ã€‚</li><li><code>size</code>ï¼šæ˜¾ç¤ºè®¾å¤‡å¤§å°ã€‚</li><li><code>stat</code>ï¼šæä¾›è®¾å¤‡çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li><code>device</code>ã€<code>subsystem</code>ï¼šåŒ…å«è®¾å¤‡æœ¬èº«åŠå…¶æ‰€å±å­ç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ã€‚</li><li><code>power</code>ã€<code>queue</code>ï¼šåˆ†åˆ«æ¶‰åŠè®¾å¤‡çš„ç”µæºç®¡ç†å’Œé˜Ÿåˆ—è®¾ç½®ã€‚</li></ul><p>è¿™äº›æ–‡ä»¶å¹¶ä¸æ˜¯è®¾å¤‡èŠ‚ç‚¹ï¼Œå› æ­¤ä¸ç”¨äºç›´æ¥ä¸è®¾å¤‡äº¤äº’ã€‚ç›¸åï¼Œå®ƒä»¬ä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§æ‰‹æ®µæ¥ç®¡ç†å’Œç›‘æ§ç³»ç»Ÿä¸Šçš„è®¾å¤‡ã€‚é€šè¿‡æŸ¥é˜…è¿™äº›æ–‡ä»¶ï¼Œç”¨æˆ·èƒ½å¤Ÿè·å–åˆ°è®¾å¤‡çš„è¯¦ç»†å±æ€§ï¼Œå¹¶æ®æ­¤è¿›è¡Œå¿…è¦çš„è°ƒæ•´å’Œä¼˜åŒ–ï¼Œç¡®ä¿ç³»ç»Ÿè¿è¡Œæ•ˆç‡å’Œç¨³å®šæ€§ã€‚</p><h2 id="5-udev"><a href="#5-udev" class="headerlink" title="5 udev"></a>5 udev</h2><p>åœ¨è¿‡å»ï¼Œè‹¥è¦æ‰‹åŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mknod</span> /dev/sdb1 b 8 3<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º&#x2F;dev&#x2F;sdb1çš„è®¾å¤‡èŠ‚ç‚¹ï¼ŒæŒ‡å®šå…¶ä¸ºå—è®¾å¤‡ï¼ˆbï¼‰ï¼Œå¹¶èµ‹äºˆä¸»è®¾å¤‡å·8å’Œæ¬¡è®¾å¤‡å·3ã€‚åŒæ ·åœ°ï¼Œåˆ é™¤è®¾å¤‡ä¹Ÿåªéœ€ç®€å•åœ°ç§»é™¤&#x2F;devç›®å½•ä¸‹çš„å¯¹åº”è®¾å¤‡æ–‡ä»¶ã€‚</p><p>ç„¶è€Œï¼Œå¾—ç›Šäºudevç³»ç»Ÿçš„å‡ºç°ï¼Œç°åœ¨æ— éœ€æ‰‹åŠ¨æ‰§è¡Œè¿™äº›æ“ä½œã€‚udevç³»ç»Ÿèƒ½å¤Ÿæ ¹æ®è®¾å¤‡æ˜¯å¦è¿æ¥åŠ¨æ€åœ°åˆ›å»ºæˆ–ç§»é™¤è®¾å¤‡æ–‡ä»¶ã€‚ç³»ç»Ÿä¸­è¿è¡Œç€ä¸€ä¸ªudevdå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒç›‘å¬æ¥è‡ªå†…æ ¸çš„å…³äºæ–°è¿æ¥è®¾å¤‡çš„æ¶ˆæ¯ã€‚udevdä¼šè§£æè¿™äº›ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¸&#x2F;etc&#x2F;udev&#x2F;rules.dç›®å½•ä¸‹é¢„å®šä¹‰çš„è§„åˆ™è¿›è¡ŒåŒ¹é…ï¼Œè¿›è€Œåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹å’Œç¬¦å·é“¾æ¥ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥ç¼–å†™è‡ªå·±çš„udevè§„åˆ™ï¼Œä½†è¿™é€šå¸¸è¶…å‡ºäº†åŸºæœ¬éœ€æ±‚èŒƒå›´ã€‚ç»Ÿè‡ªå¸¦äº†ä¸°å¯Œçš„udevè§„åˆ™ï¼Œè¶³ä»¥æ»¡è¶³å¤§å¤šæ•°æƒ…å†µçš„éœ€æ±‚ã€‚</p><p><strong>ä½¿ç”¨udevadmå·¥å…·</strong></p><p>é€šè¿‡udevadmå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹udevæ•°æ®åº“å’Œsysfsä¸­çš„ä¿¡æ¯ã€‚è¦è·å–ç‰¹å®šè®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç®€å•å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ udevadm info --query=all --name=/dev/sda<br></code></pre></td></tr></table></figure><h2 id="6-lsusb-lspci-lssci"><a href="#6-lsusb-lspci-lssci" class="headerlink" title="6 lsusb, lspci, lssci"></a>6 lsusb, lspci, lssci</h2><h3 id="åˆ—å‡ºè®¾å¤‡ä¿¡æ¯çš„å·¥å…·"><a href="#åˆ—å‡ºè®¾å¤‡ä¿¡æ¯çš„å·¥å…·" class="headerlink" title="åˆ—å‡ºè®¾å¤‡ä¿¡æ¯çš„å·¥å…·"></a>åˆ—å‡ºè®¾å¤‡ä¿¡æ¯çš„å·¥å…·</h3><p>ç±»ä¼¼äºä½¿ç”¨<code>ls</code>å‘½ä»¤åˆ—å‡ºæ–‡ä»¶å’Œç›®å½•ï¼ŒLinuxç³»ç»Ÿæä¾›äº†å¤šç§å·¥å…·ç”¨äºåˆ—å‡ºä¸åŒç±»å‹çš„è®¾å¤‡ä¿¡æ¯ã€‚</p><h4 id="åˆ—å‡ºUSBè®¾å¤‡"><a href="#åˆ—å‡ºUSBè®¾å¤‡" class="headerlink" title="åˆ—å‡ºUSBè®¾å¤‡"></a>åˆ—å‡ºUSBè®¾å¤‡</h4><p>è¦æŸ¥çœ‹ç³»ç»Ÿä¸­çš„USBè®¾å¤‡ï¼Œå¯ä»¥ä½¿ç”¨<code>lsusb</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ lsusb<br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤å°†æ˜¾ç¤ºæ‰€æœ‰è¿æ¥çš„USBè®¾å¤‡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¾å¤‡IDã€åˆ¶é€ å•†å’Œè®¾å¤‡ç±»å‹ç­‰ã€‚</p><h4 id="åˆ—å‡ºPCIè®¾å¤‡"><a href="#åˆ—å‡ºPCIè®¾å¤‡" class="headerlink" title="åˆ—å‡ºPCIè®¾å¤‡"></a>åˆ—å‡ºPCIè®¾å¤‡</h4><p>å¯¹äºPCIè®¾å¤‡ï¼Œå¯ä»¥ä½¿ç”¨<code>lspci</code>å‘½ä»¤æ¥è·å–ç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ lspci<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œç³»ç»Ÿä¼šåˆ—å‡ºæ‰€æœ‰PCIè®¾å¤‡ï¼Œæä¾›è®¾å¤‡åç§°ã€ç±»åˆ«ä»¥åŠè¿æ¥çš„æ€»çº¿ä½ç½®ç­‰è¯¦æƒ…ã€‚</p><h4 id="åˆ—å‡ºSCSIè®¾å¤‡"><a href="#åˆ—å‡ºSCSIè®¾å¤‡" class="headerlink" title="åˆ—å‡ºSCSIè®¾å¤‡"></a>åˆ—å‡ºSCSIè®¾å¤‡</h4><p>è¦åˆ—å‡ºSCSIè®¾å¤‡çš„ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨<code>lsscsi</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ lsscsi<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†è¾“å‡ºç³»ç»Ÿä¸­æ‰€æœ‰SCSIè®¾å¤‡çš„åˆ—è¡¨ï¼ŒåŒ…å«è®¾å¤‡è·¯å¾„ã€ç±»å‹åŠå‚å•†ç­‰ä¿¡æ¯ã€‚</p><h2 id="7-ä½¿ç”¨ddå·¥å…·è¿›è¡Œæ•°æ®è½¬æ¢å’Œå¤åˆ¶"><a href="#7-ä½¿ç”¨ddå·¥å…·è¿›è¡Œæ•°æ®è½¬æ¢å’Œå¤åˆ¶" class="headerlink" title="7 ä½¿ç”¨ddå·¥å…·è¿›è¡Œæ•°æ®è½¬æ¢å’Œå¤åˆ¶"></a>7 ä½¿ç”¨<code>dd</code>å·¥å…·è¿›è¡Œæ•°æ®è½¬æ¢å’Œå¤åˆ¶</h2><p><code>dd</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€‚ç”¨äºLinuxå’Œå…¶ä»–Unix-likeæ“ä½œç³»ç»Ÿï¼Œç”¨äºæ•°æ®çš„è½¬æ¢å’Œå¤åˆ¶ã€‚å®ƒå¯ä»¥ä»æ–‡ä»¶æˆ–æ•°æ®æµè¯»å–è¾“å…¥ï¼Œå¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶æˆ–æ•°æ®æµã€‚</p><p>è€ƒè™‘ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/home/pete/backup.img of=/dev/sdb bs=1024<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†<code>backup.img</code>çš„å†…å®¹å¤åˆ¶åˆ°<code>/dev/sdb</code>ã€‚å®ƒå°†ä»¥1024å­—èŠ‚ä¸ºå•ä½å—è¿›è¡Œæ•°æ®å¤åˆ¶ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®ä¼ è¾“å®Œæˆä¸ºæ­¢ã€‚</p><ul><li><code>if=file</code>: è¾“å…¥æ–‡ä»¶ï¼Œä»æŒ‡å®šæ–‡ä»¶è€Œéæ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ã€‚</li><li><code>of=file</code>: è¾“å‡ºæ–‡ä»¶ï¼Œå‘æŒ‡å®šæ–‡ä»¶è€Œéæ ‡å‡†è¾“å‡ºå†™å…¥æ•°æ®ã€‚</li><li><code>bs=bytes</code>: å—å¤§å°ï¼Œè¡¨ç¤ºæ¯æ¬¡è¯»å†™çš„å­—èŠ‚æ•°ã€‚å¯ä»¥ä½¿ç”¨ä¸åŒçš„å°ºå¯¸å•ä½ï¼Œä¾‹å¦‚kä»£è¡¨åƒå­—èŠ‚ï¼Œmä»£è¡¨å…†å­—èŠ‚ç­‰ã€‚å› æ­¤ï¼Œ1024å­—èŠ‚ç­‰äº1kã€‚</li><li><code>count=number</code>: å¤åˆ¶çš„å—æ•°ã€‚</li></ul><p><strong>ä½¿ç”¨<code>count</code>é€‰é¡¹</strong></p><p>å‡è®¾æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/home/pete/backup.img of=/dev/sdb bs=1M count=2<br></code></pre></td></tr></table></figure><p>å¦‚æœ<code>backup.img</code>çš„å¤§å°æ˜¯10MBï¼Œä½†æ˜¯ä¸Šè¿°å‘½ä»¤ä»…æŒ‡ç¤ºå¤åˆ¶1MBçš„æ•°æ®ä¸¤æ¬¡ï¼Œå³æ€»å…±åªå¤åˆ¶äº†2MBçš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®ä¸å®Œæ•´ã€‚åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼Œ<code>count</code>å‚æ•°éå¸¸æœ‰ç”¨ï¼Œä½†åœ¨ç®€å•åœ°å¤åˆ¶æ•´ä¸ªæ–‡ä»¶æ—¶ï¼Œé€šå¸¸å¯ä»¥çœç•¥<code>count</code>å’Œ<code>bs</code>å‚æ•°ã€‚è‹¥è¦ä¼˜åŒ–æ•°æ®ä¼ è¾“æ•ˆç‡ï¼Œåˆ™åº”åˆç†é…ç½®è¿™äº›é€‰é¡¹ã€‚</p><p><code>dd</code>å¯ç”¨äºåˆ¶ä½œä»»ä½•ä¸œè¥¿çš„å¤‡ä»½ï¼ŒåŒ…æ‹¬æ•´ä¸ªç£ç›˜é©±åŠ¨å™¨ã€æ¢å¤ç£ç›˜æ˜ åƒç­‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Packages</title>
    <link href="/2025/03/21/Linux-Packages/"/>
    <url>/2025/03/21/Linux-Packages/</url>
    
    <content type="html"><![CDATA[<h1 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h1><h2 id="1-software-distribution"><a href="#1-software-distribution" class="headerlink" title="1 software distribution"></a>1 software distribution</h2><p>åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œä¼—å¤šè½¯ä»¶åŒ…å¦‚äº’è”ç½‘æµè§ˆå™¨ã€æ–‡æœ¬ç¼–è¾‘å™¨å’Œåª’ä½“æ’­æ”¾å™¨ç­‰é€šè¿‡åŒ…ç®¡ç†å™¨è¿›è¡Œç®¡ç†ã€‚åŒ…ç®¡ç†å™¨è´Ÿè´£å®‰è£…å¹¶ç»´æŠ¤ç³»ç»Ÿä¸Šçš„è½¯ä»¶ã€‚å°½ç®¡å¹¶éæ‰€æœ‰è½¯ä»¶åŒ…éƒ½é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œç›´æ¥ä»æºä»£ç å®‰è£…ä¹Ÿæ˜¯ä¸€ç§å¸¸è§æ–¹å¼ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä¾èµ–åŒ…ç®¡ç†å™¨æ¥å®Œæˆè½¯ä»¶çš„å®‰è£…ã€‚å¸¸ç”¨çš„è½¯ä»¶åŒ…æ ¼å¼åŒ…æ‹¬Debianï¼ˆ.debï¼‰å’ŒRed Hatï¼ˆ.rpmï¼‰ã€‚Debiané£æ ¼çš„è½¯ä»¶åŒ…å¹¿æ³›åº”ç”¨äºè¯¸å¦‚Debianã€Ubuntuã€Linux Mintç­‰å‘è¡Œç‰ˆä¸­ï¼›è€ŒRed Haté£æ ¼çš„è½¯ä»¶åŒ…åˆ™ç”¨äºRed Hat Enterprise Linuxã€Fedoraã€CentOSç­‰ã€‚</p><p>è½¯ä»¶åŒ…å¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬ç†ŸçŸ¥çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚Chromeã€Photoshopç­‰ã€‚å®é™…ä¸Šï¼Œå®ƒä»¬æ˜¯ç”±å¤§é‡æ–‡ä»¶ç¼–è¯‘è€Œæˆçš„ä¸€ä¸ªæ•´ä½“ã€‚ç¼–å†™è¿™äº›è½¯ä»¶çš„äººæˆ–å›¢é˜Ÿè¢«ç§°ä¸ºä¸Šæ¸¸æä¾›è€…ï¼Œä»–ä»¬ä¸ä»…ç¼–å†™ä»£ç ï¼Œè¿˜ä¼šç¼–å†™å®‰è£…æŒ‡å—ã€‚ä¸Šæ¸¸æä¾›è€…è‡´åŠ›äºå¼€å‘æ–°è½¯ä»¶åŠæ›´æ–°ç°æœ‰è½¯ä»¶ã€‚å½“å‡†å¤‡å‘å¸ƒæ—¶ï¼Œä»–ä»¬ä¼šå°†è½¯ä»¶åŒ…æäº¤ç»™åŒ…ç»´æŠ¤è€…ã€‚åŒ…ç»´æŠ¤è€…è´Ÿè´£å®¡æ ¸ã€ç®¡ç†å’Œä»¥è½¯ä»¶åŒ…çš„å½¢å¼åˆ†å‘è¿™äº›è½¯ä»¶ï¼Œç¡®ä¿æœ€ç»ˆç”¨æˆ·èƒ½å¤Ÿè·å–å¹¶ä½¿ç”¨è¿™äº›è½¯ä»¶ã€‚</p><h2 id="2-package-repositories"><a href="#2-package-repositories" class="headerlink" title="2 package repositories"></a>2 package repositories</h2><p>è½¯ä»¶åŒ…é€šè¿‡ç½‘ç»œä¸Šä¼ åï¼Œæ˜¯å¦‚ä½•å®‰è£…åˆ°æˆ‘ä»¬çš„è®¡ç®—æœºä¸Šçš„å‘¢ï¼Ÿæ˜¯å¦éœ€è¦è®¿é—®æ¯ä¸ªè½¯ä»¶åŒ…çš„ä¸‹è½½é¡µé¢å¹¶æ‰‹åŠ¨ç‚¹å‡»ä¸‹è½½å’Œå®‰è£…ï¼Ÿå®é™…ä¸Šï¼Œè¿™ç§æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†å­˜åœ¨ä¸€ç§æ›´é«˜æ•ˆçš„æ–¹å¼ï¼šä½¿ç”¨è½¯ä»¶åŒ…ä»“åº“ï¼ˆrepositoriesï¼‰ã€‚ä»“åº“ä½œä¸ºè½¯ä»¶åŒ…çš„é›†ä¸­å­˜å‚¨ä½ç½®ï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡è½¯ä»¶åŒ…ï¼Œå¹¶ä¸”è¿™äº›ä»“åº“å‡ä½äºäº’è”ç½‘ä¸Šï¼Œæ— éœ€ä¼ ç»Ÿçš„å®‰è£…å…‰ç›˜ã€‚ç„¶è€Œï¼Œè®¡ç®—æœºéœ€è¦æ˜ç¡®çŸ¥é“è¿™äº›ä»“åº“çš„ä½ç½®æ‰èƒ½è¿›è¡Œè®¿é—®ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾å¸Œæœ›åœ¨è®¡ç®—æœºä¸Šå®‰è£…WackyWidgetså…¬å¸çš„è½¯ä»¶ã€‚WackyWidgetsç®¡ç†ç€è‡ªå·±çš„ä»“åº“ç”¨äºå­˜æ”¾å…¶è½¯ä»¶åŒ…ï¼Œåœ¨è¿™ä¸ªä»“åº“ä¸­æœ‰10ä¸ªè½¯ä»¶åŒ…ï¼Œå¦‚CoolWidgetã€SuperWidgetç­‰ã€‚WackyWidgetsåœ¨å…¶æœåŠ¡å™¨ä¸Šæ‰˜ç®¡äº†è¯¥ä»“åº“ï¼Œå¯¹åº”çš„æºé“¾æ¥ä¸ºï¼š<a href="http://download.widgets/linux/deb/%E3%80%82">http://download.widgets/linux/deb/ã€‚</a></p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸éœ€è¦è®¿é—®WackyWidgetsçš„å®˜æ–¹ç½‘ç«™ç›´æ¥ä¸‹è½½è½¯ä»¶åŒ…ï¼Œè€Œæ˜¯è®©è®¡ç®—æœºä»æŒ‡å®šçš„æºé“¾æ¥è·å–WackyWidgetsçš„è½¯ä»¶ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿå·²ç»é¢„è®¾äº†ä¸€äº›å¯ä¿¡çš„è½¯ä»¶æºï¼Œè¿™ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿå®‰è£…æ‰€æœ‰åŸºç¡€è½¯ä»¶åŒ…ã€‚åœ¨åŸºäºDebiançš„ç³»ç»Ÿä¸­ï¼Œè¿™äº›æºä¿¡æ¯ä¿å­˜åœ¨<code>/etc/apt/sources.list</code>æ–‡ä»¶ä¸­ã€‚</p><h2 id="3-tarå’Œgzip"><a href="#3-tarå’Œgzip" class="headerlink" title="3 tarå’Œgzip"></a>3 tarå’Œgzip</h2><p><strong>archive</strong></p><p>archiveï¼Œæ¯”å¦‚å¸¸è§çš„.rarå’Œ.zipæ–‡ä»¶æ ¼å¼ã€‚è¿™äº›æ˜¯åŒ…å«å¤šä¸ªæ–‡ä»¶çš„å•ä¸ªarchiveæ–‡ä»¶ï¼Œä¾¿äºå­˜å‚¨å’Œä¼ è¾“ã€‚</p><h4 id="ä½¿ç”¨gzipè¿›è¡Œæ–‡ä»¶å‹ç¼©"><a href="#ä½¿ç”¨gzipè¿›è¡Œæ–‡ä»¶å‹ç¼©" class="headerlink" title="ä½¿ç”¨gzipè¿›è¡Œæ–‡ä»¶å‹ç¼©"></a>ä½¿ç”¨gzipè¿›è¡Œæ–‡ä»¶å‹ç¼©</h4><p><code>gzip</code>æ˜¯Linuxä¸­ç”¨äºå‹ç¼©æ–‡ä»¶çš„ç¨‹åºï¼Œç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶é€šå¸¸å¸¦æœ‰<code>.gz</code>æ‰©å±•åã€‚</p><ul><li><p>å‹ç¼©æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gzip mycoolfile<br></code></pre></td></tr></table></figure></li><li><p>è§£å‹æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gunzip mycoolfile.gz<br></code></pre></td></tr></table></figure></li></ul><h4 id="ä½¿ç”¨taråˆ›å»ºarchiveæ–‡ä»¶"><a href="#ä½¿ç”¨taråˆ›å»ºarchiveæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨taråˆ›å»ºarchiveæ–‡ä»¶"></a>ä½¿ç”¨taråˆ›å»ºarchiveæ–‡ä»¶</h4><p>å°½ç®¡<code>gzip</code>æ— æ³•å°†å¤šä¸ªæ–‡ä»¶åˆå¹¶åˆ°ä¸€ä¸ªå½’æ¡£æ–‡ä»¶ä¸­ï¼Œä½†<code>tar</code>å‘½ä»¤å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ä½¿ç”¨<code>tar</code>åˆ›å»ºçš„å½’æ¡£æ–‡ä»¶é€šå¸¸å¸¦æœ‰<code>.tar</code>æ‰©å±•åã€‚</p><ul><li><p>åˆ›å»ºå½’æ¡£æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar cvf mytarfile.tar mycoolfile1 mycoolfile2<br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>c</code>ï¼šåˆ›å»ºå½’æ¡£ã€‚</li><li><code>v</code>ï¼šæ˜¾ç¤ºå¤„ç†è¿‡ç¨‹ï¼ˆå¯é€‰ï¼‰ã€‚</li><li><code>f</code>ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶åã€‚</li></ul></li><li><p>è§£å¼€å½’æ¡£æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar xvf mytarfile.tar<br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>x</code>ï¼šè§£å‹æ–‡ä»¶ã€‚</li><li><code>v</code>ï¼šæ˜¾ç¤ºå¤„ç†è¿‡ç¨‹ï¼ˆå¯é€‰ï¼‰ã€‚</li><li><code>f</code>ï¼šæŒ‡å®šè¦è§£å‹çš„æ–‡ä»¶ã€‚</li></ul></li></ul><h4 id="ç»“åˆtarå’Œgzipè¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©"><a href="#ç»“åˆtarå’Œgzipè¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©" class="headerlink" title="ç»“åˆtarå’Œgzipè¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©"></a>ç»“åˆtarå’Œgzipè¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©</h4><p>æœ‰æ—¶ä¼šé‡åˆ°è¢«å‹ç¼©çš„taræ–‡ä»¶ï¼Œå¦‚<code>mycompressedarchive.tar.gz</code>ã€‚è¿™æ—¶ï¼Œå¯ä»¥å…ˆç”¨<code>gunzip</code>è§£é™¤å‹ç¼©ï¼Œå†ç”¨<code>tar</code>è§£å¼€å½’æ¡£ï¼›æˆ–è€…ç›´æ¥ä½¿ç”¨<code>tar</code>å‘½ä»¤çš„<code>z</code>é€‰é¡¹æ¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚</p><ul><li><p>åˆ›å»ºå‹ç¼©çš„taræ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar czf myfile.tar.gz [files...]<br></code></pre></td></tr></table></figure></li><li><p>è§£å‹ç¼©å¹¶è§£å½’æ¡£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar xzf file.tar.gz<br></code></pre></td></tr></table></figure></li></ul><p>è®°ä½è¿™ä¸ªç®€å•çš„åŠ©è®°ç¬¦ï¼šâ€œeXtract all Zee Files!â€</p><h4 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h4><p>åœ¨ä½¿ç”¨Linuxçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šé‡åˆ°å…¶ä»–ä¸€äº›å½’æ¡£å’Œå‹ç¼©ç±»å‹ï¼Œä¾‹å¦‚bzip2ã€compressã€zipå’Œunzipç­‰ã€‚</p><h2 id="4-Package-Dependencies"><a href="#4-Package-Dependencies" class="headerlink" title="4 Package Dependencies"></a>4 Package Dependencies</h2><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè½¯ä»¶åŒ…å¾ˆå°‘èƒ½å¤Ÿç‹¬ç«‹å·¥ä½œï¼Œå®ƒä»¬é€šå¸¸éœ€è¦ä¾èµ–å…¶ä»–è½¯ä»¶åŒ…æˆ–å…±äº«åº“æ¥æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸€ç»„é¤å…ä¸ºä¾‹ï¼Œå°½ç®¡æ¯å®¶é¤å…åˆ¶ä½œä¸åŒçš„èœè‚´ï¼Œä½†å®ƒä»¬éƒ½ä»åŒä¸€ä¸ªå†œåœºè·å–é£Ÿæã€‚å¦‚æœè¿™ä¸ªå†œåœºçªç„¶åœæ­¢ä¾›åº”ï¼Œé‚£ä¹ˆè¿™äº›é¤å…å°†ä¼šé™·å…¥å›°å¢ƒã€‚</p><h4 id="ä¾èµ–å…³ç³»çš„é‡è¦æ€§"><a href="#ä¾èµ–å…³ç³»çš„é‡è¦æ€§" class="headerlink" title="ä¾èµ–å…³ç³»çš„é‡è¦æ€§"></a>ä¾èµ–å…³ç³»çš„é‡è¦æ€§</h4><p>ç±»ä¼¼åœ°ï¼Œåœ¨Linuxä¸­ï¼Œè½¯ä»¶åŒ…ä¾èµ–äºå…¶ä»–è½¯ä»¶åŒ…æˆ–å…±äº«åº“ã€‚å…±äº«åº“æ˜¯ç¨‹åºä»£ç åº“ï¼Œå…¶å®ƒç¨‹åºå¯ä»¥ä½¿ç”¨è¿™äº›ä»£ç è€Œæ— éœ€è‡ªè¡Œé‡å†™ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ¯å®¶é¤å…éƒ½éœ€è¦è‡ªå·±ç§æ¤é£Ÿæï¼Œé‚£å°†æ˜¯éå¸¸ä½æ•ˆçš„ã€‚</p><ul><li><strong>å…±äº«åº“</strong>ï¼šè¿™äº›æ˜¯å¤šä¸ªç¨‹åºå¯ä»¥å…±åŒä½¿ç”¨çš„ä»£ç åº“ã€‚</li></ul><h4 id="ç¼ºå¤±ä¾èµ–å¯¼è‡´çš„é—®é¢˜"><a href="#ç¼ºå¤±ä¾èµ–å¯¼è‡´çš„é—®é¢˜" class="headerlink" title="ç¼ºå¤±ä¾èµ–å¯¼è‡´çš„é—®é¢˜"></a>ç¼ºå¤±ä¾èµ–å¯¼è‡´çš„é—®é¢˜</h4><p>å¦‚æœä¸€ä¸ªè½¯ä»¶åŒ…æ‰€éœ€çš„ä¾èµ–é¡¹ä¸å­˜åœ¨ï¼Œè¯¥è½¯ä»¶åŒ…å¯èƒ½æ— æ³•å®‰è£…ï¼Œæˆ–è€…å³ä½¿å®‰è£…æˆåŠŸä¹Ÿå¯èƒ½å¤„äºæŸåçŠ¶æ€ï¼Œæ— æ³•æ­£å¸¸è¿è¡Œã€‚å› æ­¤ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–é¡¹çš„å­˜åœ¨å¯¹äºç»´æŠ¤è½¯ä»¶ç¯å¢ƒçš„ç¨³å®šè‡³å…³é‡è¦ã€‚</p><h2 id="5-rpmå’Œdpkg"><a href="#5-rpmå’Œdpkg" class="headerlink" title="5 rpmå’Œdpkg"></a>5 rpmå’Œdpkg</h2><h4 id="ç‹¬ç«‹è½¯ä»¶åŒ…æ ¼å¼"><a href="#ç‹¬ç«‹è½¯ä»¶åŒ…æ ¼å¼" class="headerlink" title="ç‹¬ç«‹è½¯ä»¶åŒ…æ ¼å¼"></a>ç‹¬ç«‹è½¯ä»¶åŒ…æ ¼å¼</h4><p>ç±»ä¼¼äºWindowsä¸‹çš„.exeæ–‡ä»¶ï¼ŒLinuxç³»ç»Ÿä¸­æœ‰.debå’Œ.rpmæ ¼å¼çš„å•ä¸ªå¯æ‰§è¡ŒåŒ…æ–‡ä»¶ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡è½¯ä»¶ä»“åº“å®‰è£…è½¯ä»¶æ—¶ä¸ä¼šç›´æ¥é‡åˆ°è¿™äº›æ–‡ä»¶ï¼Œä½†å½“ä»ç½‘ç»œä¸Šç›´æ¥ä¸‹è½½è½¯ä»¶åŒ…æ—¶ï¼Œæœ€æœ‰å¯èƒ½è·å¾—çš„å°±æ˜¯è¿™ä¸¤ç§æ ¼å¼ä¹‹ä¸€ã€‚.debæ ¼å¼ä¸“ç”¨äºåŸºäºDebiançš„å‘è¡Œç‰ˆï¼Œè€Œ.rpmæ ¼å¼åˆ™ç”¨äºåŸºäºRed Hatçš„å‘è¡Œç‰ˆã€‚</p><h4 id="å®‰è£…ä¸å¸è½½å‘½ä»¤"><a href="#å®‰è£…ä¸å¸è½½å‘½ä»¤" class="headerlink" title="å®‰è£…ä¸å¸è½½å‘½ä»¤"></a>å®‰è£…ä¸å¸è½½å‘½ä»¤</h4><p>ä¸ºäº†å®‰è£…è¿™äº›å•ç‹¬çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨<code>dpkg</code>å’Œ<code>rpm</code>å‘½ä»¤ï¼š</p><ul><li><p><strong>å®‰è£…è½¯ä»¶åŒ…</strong></p><ul><li>Debianç³»ï¼š<code>$ dpkg -i some_deb_package.deb</code></li><li>RPMç³»ï¼š<code>$ rpm -i some_rpm_package.rpm</code></li></ul><p>è¿™é‡Œçš„<code>i</code>ä»£è¡¨installï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¨å†™<code>--install</code>ã€‚</p></li><li><p><strong>ç§»é™¤è½¯ä»¶åŒ…</strong></p><ul><li>Debianç³»ï¼š<code>$ dpkg -r some_deb_package.deb</code></li><li>RPMç³»ï¼š<code>$ rpm -e some_rpm_package.rpm</code></li></ul><p>Debianç³»ä¸­çš„<code>r</code>è¡¨ç¤ºremoveï¼ŒRPMç³»ä¸­çš„<code>e</code>è¡¨ç¤ºeraseã€‚</p></li></ul><h4 id="æŸ¥è¯¢ä¸éªŒè¯"><a href="#æŸ¥è¯¢ä¸éªŒè¯" class="headerlink" title="æŸ¥è¯¢ä¸éªŒè¯"></a>æŸ¥è¯¢ä¸éªŒè¯</h4><p>ç”±äº<code>dpkg</code>å’Œ<code>rpm</code>ä¸ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ï¼Œå› æ­¤åœ¨ä½¿ç”¨è¿™äº›å·¥å…·å®‰è£…è½¯ä»¶åŒ…ä¹‹å‰ï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³æ‰€æœ‰ä¾èµ–é¡¹é—®é¢˜ã€‚è¿™å‡¸æ˜¾äº†å®Œæ•´åŒ…ç®¡ç†ç³»ç»Ÿçš„é‡è¦æ€§ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰æŸ¥è¯¢å·²å®‰è£…è½¯ä»¶åŒ…çš„å‘½ä»¤ï¼š</p><ul><li><p>Debianç³»ï¼š<code>$ dpkg -l</code></p></li><li><p>RPMç³»ï¼š<code>$ rpm -qa</code></p><p>åœ¨Debianç³»ä¸­ï¼Œ<code>l</code>è¡¨ç¤ºlistï¼›è€Œåœ¨RPMç³»ä¸­ï¼Œ<code>q</code>è¡¨ç¤ºqueryï¼Œ<code>a</code>è¡¨ç¤ºallã€‚</p></li></ul><h2 id="6-yumå’Œapt"><a href="#6-yumå’Œapt" class="headerlink" title="6 yumå’Œapt"></a>6 yumå’Œapt</h2><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒåŒ…ç®¡ç†ç³»ç»Ÿæ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå®ƒä»¬ä¸ä»…ç®€åŒ–äº†è½¯ä»¶çš„å®‰è£…ã€å¸è½½å’Œæ›´æ–°æµç¨‹ï¼Œè¿˜èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ã€‚å½“å‰æœ€æµè¡Œçš„ä¸¤å¤§åŒ…ç®¡ç†ç³»ç»Ÿåˆ†åˆ«æ˜¯é€‚ç”¨äºRed Hatç³»åˆ—çš„YUMå’Œä¸“ç”¨äºDebianç³»åˆ—çš„APTã€‚</p><h4 id="è½¯ä»¶åŒ…æ“ä½œå‘½ä»¤"><a href="#è½¯ä»¶åŒ…æ“ä½œå‘½ä»¤" class="headerlink" title="è½¯ä»¶åŒ…æ“ä½œå‘½ä»¤"></a>è½¯ä»¶åŒ…æ“ä½œå‘½ä»¤</h4><p>ä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œè½¯ä»¶åŒ…çš„æ“ä½œéå¸¸ç›´æ¥ï¼š</p><ul><li><p><strong>ä»ä»“åº“å®‰è£…è½¯ä»¶åŒ…</strong></p><ul><li>Debianç³»ï¼š<code>$ apt install package_name</code></li><li>RPMç³»ï¼š<code>$ yum install package_name</code></li></ul></li><li><p><strong>ç§»é™¤è½¯ä»¶åŒ…</strong></p><ul><li>Debianç³»ï¼š<code>$ apt remove package_name</code></li><li>RPMç³»ï¼š<code>$ yum erase package_name</code></li></ul></li></ul><h4 id="æ›´æ–°ä»“åº“ä¸è½¯ä»¶åŒ…"><a href="#æ›´æ–°ä»“åº“ä¸è½¯ä»¶åŒ…" class="headerlink" title="æ›´æ–°ä»“åº“ä¸è½¯ä»¶åŒ…"></a>æ›´æ–°ä»“åº“ä¸è½¯ä»¶åŒ…</h4><p>ä¸ºäº†ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œåœ¨å®‰è£…æˆ–æ›´æ–°è½¯ä»¶åŒ…ä¹‹å‰ï¼Œå»ºè®®é¦–å…ˆæ›´æ–°ä»“åº“åˆ—è¡¨ï¼Œå¹¶å‡çº§ç°æœ‰è½¯ä»¶åŒ…è‡³æœ€æ–°ç‰ˆæœ¬ï¼š</p><ul><li>Debianç³»ï¼š<code>$ apt update; apt upgrade</code></li><li>RPMç³»ï¼š<code>$ yum update</code></li></ul><p>è¿™ç§åšæ³•å¯ä»¥ä¿è¯æ‚¨è·å–åˆ°æœ€æ–°çš„å®‰å…¨è¡¥ä¸å’ŒåŠŸèƒ½æ”¹è¿›ã€‚</p><h4 id="æŸ¥è¯¢å·²å®‰è£…è½¯ä»¶åŒ…ä¿¡æ¯"><a href="#æŸ¥è¯¢å·²å®‰è£…è½¯ä»¶åŒ…ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢å·²å®‰è£…è½¯ä»¶åŒ…ä¿¡æ¯"></a>æŸ¥è¯¢å·²å®‰è£…è½¯ä»¶åŒ…ä¿¡æ¯</h4><p>äº†è§£å·²å®‰è£…è½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯åŒæ ·é‡è¦ï¼Œè¿™æœ‰åŠ©äºæ’æŸ¥é—®é¢˜æˆ–ç¡®è®¤è½¯ä»¶çš„åŠŸèƒ½ç‰¹æ€§ï¼š</p><ul><li>Debianç³»ï¼š<code>$ apt show package_name</code></li><li>RPMç³»ï¼š<code>$ yum info package_name</code></li></ul><h2 id="7-ç¼–è¯‘æºç "><a href="#7-ç¼–è¯‘æºç " class="headerlink" title="7 ç¼–è¯‘æºç "></a>7 ç¼–è¯‘æºç </h2><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæœ‰æ—¶ä¼šé‡åˆ°ä»…ä»¥çº¯æºä»£ç å½¢å¼æä¾›çš„è½¯ä»¶åŒ…ã€‚ä¸ºäº†å°†è¿™äº›æºä»£ç åŒ…ç¼–è¯‘å¹¶å®‰è£…åˆ°ç³»ç»Ÿä¸­ï¼Œéœ€è¦æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼š</p><h4 id="å®‰è£…ç¼–è¯‘å·¥å…·"><a href="#å®‰è£…ç¼–è¯‘å·¥å…·" class="headerlink" title="å®‰è£…ç¼–è¯‘å·¥å…·"></a>å®‰è£…ç¼–è¯‘å·¥å…·</h4><p>é¦–å…ˆï¼Œç¡®ä¿ç³»ç»Ÿå·²å®‰è£…å¿…è¦çš„ç¼–è¯‘å·¥å…·ã€‚å¯¹äºåŸºäºDebiançš„ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> apt install build-essential<br></code></pre></td></tr></table></figure><h4 id="è§£å‹æºä»£ç åŒ…"><a href="#è§£å‹æºä»£ç åŒ…" class="headerlink" title="è§£å‹æºä»£ç åŒ…"></a>è§£å‹æºä»£ç åŒ…</h4><p>é€šå¸¸ï¼Œæºä»£ç åŒ…ä¸º<code>.tar.gz</code>æ ¼å¼ï¼Œä½¿ç”¨<code>tar</code>å‘½ä»¤è§£å‹ç¼©ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ tar -xzvf package.tar.gz<br></code></pre></td></tr></table></figure><h4 id="é˜…è¯»READMEæˆ–INSTALLæ–‡ä»¶"><a href="#é˜…è¯»READMEæˆ–INSTALLæ–‡ä»¶" class="headerlink" title="é˜…è¯»READMEæˆ–INSTALLæ–‡ä»¶"></a>é˜…è¯»READMEæˆ–INSTALLæ–‡ä»¶</h4><p>è§£å‹åï¼ŒæŸ¥çœ‹åŒ…å†…çš„READMEæˆ–INSTALLæ–‡ä»¶ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å«ç‰¹å®šçš„å®‰è£…æŒ‡å—ã€‚</p><h4 id="ç¼–è¯‘ä¸å®‰è£…"><a href="#ç¼–è¯‘ä¸å®‰è£…" class="headerlink" title="ç¼–è¯‘ä¸å®‰è£…"></a>ç¼–è¯‘ä¸å®‰è£…</h4><p>æ ¹æ®å¼€å‘è€…é‡‡ç”¨çš„ç¼–è¯‘æ–¹æ³•ä¸åŒï¼Œéœ€è¦ä½¿ç”¨çš„å‘½ä»¤ä¹Ÿä¼šæœ‰æ‰€å·®å¼‚ï¼Œå¦‚cmakeç­‰ã€‚ç„¶è€Œï¼Œæœ€å¸¸è§çš„ç¼–è¯‘æ–¹å¼æ˜¯é€šè¿‡<code>make</code>è¿›è¡ŒåŸºæœ¬ç¼–è¯‘ï¼š</p><ol><li><p><strong>è¿è¡Œé…ç½®è„šæœ¬</strong>ï¼šæ£€æŸ¥ç³»ç»Ÿä¾èµ–é¡¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./configure<br></code></pre></td></tr></table></figure></li><li><p><strong>ç¼–è¯‘æºä»£ç </strong>ï¼šä½¿ç”¨Makefileä¸­çš„è§„åˆ™æ„å»ºè½¯ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ make<br></code></pre></td></tr></table></figure></li><li><p><strong>å®‰è£…è½¯ä»¶åŒ…</strong>ï¼šå¤åˆ¶ç¼–è¯‘åçš„æ–‡ä»¶åˆ°ç³»ç»Ÿç›¸åº”ä½ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> make install<br></code></pre></td></tr></table></figure></li><li><p><strong>å¸è½½è½¯ä»¶åŒ…</strong>ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> make uninstall<br></code></pre></td></tr></table></figure></li></ol><h4 id="ä½¿ç”¨checkinstallç®€åŒ–ç®¡ç†"><a href="#ä½¿ç”¨checkinstallç®€åŒ–ç®¡ç†" class="headerlink" title="ä½¿ç”¨checkinstallç®€åŒ–ç®¡ç†"></a>ä½¿ç”¨checkinstallç®€åŒ–ç®¡ç†</h4><p>ç›´æ¥ä½¿ç”¨<code>make install</code>å¯èƒ½ä¼šå¯¼è‡´åç»­éš¾ä»¥å®Œå…¨å¸è½½è½¯ä»¶åŒ…çš„é—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæ¨èä½¿ç”¨<code>checkinstall</code>å‘½ä»¤ï¼Œå®ƒä¼šåœ¨å®‰è£…è¿‡ç¨‹ä¸­ç”Ÿæˆä¸€ä¸ª<code>.deb</code>åŒ…ï¼Œä¾¿äºæ—¥åå®‰è£…å’Œå¸è½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> checkinstall<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Processes</title>
    <link href="/2025/03/21/Linux-Processes/"/>
    <url>/2025/03/21/Linux-Processes/</url>
    
    <content type="html"><![CDATA[<h1 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h1><h2 id="1-ps"><a href="#1-ps" class="headerlink" title="1 ps"></a>1 ps</h2><p>è¿›ç¨‹æ˜¯æŒ‡åœ¨æœºå™¨ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œç”±å†…æ ¸è¿›è¡Œç®¡ç†ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„æ ‡è¯†ç¬¦ï¼Œç§°ä¸ºè¿›ç¨‹IDï¼ˆPIDï¼‰ã€‚PIDæŒ‰ç…§è¿›ç¨‹åˆ›å»ºé¡ºåºåˆ†é…ã€‚</p><p>ä½¿ç”¨<code>ps</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åˆ—è¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ps<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PID</span>        TTY     STAT   TIME          CMD<br><span class="hljs-attribute">41230</span>    pts/<span class="hljs-number">4</span>    Ss        <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>     bash<br><span class="hljs-attribute">51224</span>    pts/<span class="hljs-number">4</span>    R+        <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>     ps<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå„åˆ—å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><strong>PID</strong>ï¼šè¿›ç¨‹IDã€‚</li><li><strong>TTY</strong>ï¼šä¸è¿›ç¨‹ç›¸å…³çš„æ§åˆ¶ç»ˆç«¯ã€‚</li><li><strong>STAT</strong>ï¼šè¿›ç¨‹çŠ¶æ€ä»£ç ã€‚</li><li><strong>TIME</strong>ï¼šæ€»CPUä½¿ç”¨æ—¶é—´ã€‚</li><li><strong>CMD</strong>ï¼šå¯æ‰§è¡Œæ–‡ä»¶æˆ–å‘½ä»¤åç§°ã€‚</li></ul><p><code>ps</code>å‘½ä»¤æœ‰å¤šç§é€‰é¡¹ï¼Œä¸åŒé£æ ¼ï¼ˆBSDã€GNUæˆ–Unixï¼‰æœ‰ä¸åŒçš„å‚æ•°ã€‚å…¶ä¸­ï¼ŒBSDé£æ ¼è¾ƒä¸ºå¸¸ç”¨ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–æ›´è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ps aux<br></code></pre></td></tr></table></figure><ul><li><code>a</code>ï¼šæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„å…¨éƒ¨è¿›ç¨‹ã€‚</li><li><code>u</code>ï¼šæ˜¾ç¤ºå…³äºè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</li><li><code>x</code>ï¼šåˆ—å‡ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹åœ¨TTYå­—æ®µä¸­æ˜¾ç¤ºä¸º<code>?</code>ï¼Œé€šå¸¸ä¸ºç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ã€‚</li></ul><p>è¿™å°†å±•ç¤ºæ›´å¤šçš„å­—æ®µï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><strong>USER</strong>ï¼šæœ‰æ•ˆç”¨æˆ·ã€‚</li><li><strong>%CPU</strong>ï¼šè¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´å æ€»è¿è¡Œæ—¶é—´çš„æ¯”ä¾‹ã€‚</li><li><strong>%MEM</strong>ï¼šè¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ¯”ç‡ã€‚</li><li><strong>VSZ</strong>ï¼šæ•´ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡ã€‚</li><li><strong>RSS</strong>ï¼šå¸¸é©»é›†å¤§å°ï¼Œå³ä»»åŠ¡å·²ä½¿ç”¨çš„éäº¤æ¢ç‰©ç†å†…å­˜ã€‚</li><li><strong>START</strong>ï¼šè¿›ç¨‹å¯åŠ¨æ—¶é—´ã€‚</li></ul><p><strong>ä½¿ç”¨<code>top</code>å‘½ä»¤å®æ—¶ç›‘æ§</strong></p><p><code>top</code>å‘½ä»¤æä¾›äº†ä¸€ä¸ªåŠ¨æ€çš„å®æ—¶è§†å›¾ï¼Œæ˜¾ç¤ºç³»ç»Ÿä¸­å„ä¸ªè¿›ç¨‹èµ„æºä½¿ç”¨æƒ…å†µï¼Œé»˜è®¤æ¯10ç§’åˆ·æ–°ä¸€æ¬¡ã€‚è¿™å¯¹äºç›‘æ§å ç”¨å¤§é‡ç³»ç»Ÿèµ„æºçš„è¿›ç¨‹éå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ top<br></code></pre></td></tr></table></figure><h2 id="2-ç»ˆç«¯ç±»å‹ä¸æ§åˆ¶ç»ˆç«¯"><a href="#2-ç»ˆç«¯ç±»å‹ä¸æ§åˆ¶ç»ˆç«¯" class="headerlink" title="2 ç»ˆç«¯ç±»å‹ä¸æ§åˆ¶ç»ˆç«¯"></a>2 ç»ˆç«¯ç±»å‹ä¸æ§åˆ¶ç»ˆç«¯</h2><p>åœ¨<code>ps</code>å‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªTTYå­—æ®µï¼Œå®ƒè¡¨ç¤ºæ‰§è¡Œå‘½ä»¤çš„ç»ˆç«¯ã€‚ç»ˆç«¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šå¸¸è§„ç»ˆç«¯è®¾å¤‡å’Œä¼ªç»ˆç«¯è®¾å¤‡ã€‚</p><h4 id="å¸¸è§„ç»ˆç«¯è®¾å¤‡-vs-ä¼ªç»ˆç«¯è®¾å¤‡"><a href="#å¸¸è§„ç»ˆç«¯è®¾å¤‡-vs-ä¼ªç»ˆç«¯è®¾å¤‡" class="headerlink" title="å¸¸è§„ç»ˆç«¯è®¾å¤‡ vs ä¼ªç»ˆç«¯è®¾å¤‡"></a>å¸¸è§„ç»ˆç«¯è®¾å¤‡ vs ä¼ªç»ˆç«¯è®¾å¤‡</h4><ul><li><p><strong>å¸¸è§„ç»ˆç«¯è®¾å¤‡</strong>ï¼šæŒ‡çš„æ˜¯å¯ä»¥ç›´æ¥è¾“å…¥å¹¶å‘é€è¾“å‡ºåˆ°ç³»ç»Ÿçš„æœ¬åœ°ç»ˆç«¯è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æŒ‰ä¸‹Ctrl-Alt-F1ç»„åˆé”®è¿›å…¥çš„ç¬¬ä¸€ä¸ªè™šæ‹Ÿæ§åˆ¶å°ï¼ˆTTY1ï¼‰ï¼Œè¿™é‡Œä»…æ˜¾ç¤ºç»ˆç«¯ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢ç­‰ã€‚è¦é€€å‡ºæ­¤æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨Ctrl-Alt-F7ç»„åˆé”®ã€‚</p></li><li><p><strong>ä¼ªç»ˆç«¯è®¾å¤‡</strong>ï¼šæ˜¯æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå¦‚shellçª—å£ä¸­çš„ç»ˆç«¯ï¼Œæ ‡è®°ä¸ºPTSï¼ˆPseudo Terminal Slaveï¼‰ã€‚é€šè¿‡å†æ¬¡è¿è¡Œ<code>ps</code>å‘½ä»¤ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°è‡ªå·±çš„shellè¿›ç¨‹ä½äºpts&#x2F;*ä¹‹ä¸‹ã€‚</p></li></ul><h4 id="æ§åˆ¶ç»ˆç«¯åŠå…¶é‡è¦æ€§"><a href="#æ§åˆ¶ç»ˆç«¯åŠå…¶é‡è¦æ€§" class="headerlink" title="æ§åˆ¶ç»ˆç«¯åŠå…¶é‡è¦æ€§"></a>æ§åˆ¶ç»ˆç«¯åŠå…¶é‡è¦æ€§</h4><p>ä¸€èˆ¬è€Œè¨€ï¼Œè¿›ç¨‹é€šå¸¸ç»‘å®šåˆ°ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ã€‚ä¾‹å¦‚ï¼Œåœ¨shellçª—å£ä¸­è¿è¡Œå¦‚<code>find</code>è¿™æ ·çš„ç¨‹åºæ—¶ï¼Œå¦‚æœå…³é—­äº†è¯¥çª—å£ï¼Œåˆ™ç›¸å…³è¿›ç¨‹ä¹Ÿä¼šéšä¹‹ç»ˆæ­¢ã€‚</p><p>ç„¶è€Œï¼Œæœ‰äº›ç‰¹æ®Šè¿›ç¨‹ï¼Œå¦‚å®ˆæŠ¤è¿›ç¨‹(daemon)ï¼Œå®ƒä»¬å¯¹äºä¿æŒç³»ç»Ÿæ­£å¸¸è¿è¡Œè‡³å…³é‡è¦ã€‚è¿™ç±»è¿›ç¨‹é€šå¸¸åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¼€å§‹è¿è¡Œï¼Œå¹¶åœ¨ç³»ç»Ÿå…³æœºæ—¶ç»ˆæ­¢ã€‚ç”±äºè¿™äº›è¿›ç¨‹åœ¨åå°è¿è¡Œä¸”éœ€è¦æŒç»­å·¥ä½œè€Œä¸å—ç”¨æˆ·æ“ä½œçš„å½±å“ï¼Œå› æ­¤å®ƒä»¬ä¸ç»‘å®šåˆ°ä»»ä½•æ§åˆ¶ç»ˆç«¯ã€‚åœ¨<code>ps</code>å‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œè¿™ç±»è¿›ç¨‹çš„TTYå­—æ®µå°†æ˜¾ç¤ºä¸º<code>?</code>ï¼Œè¡¨ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯ã€‚</p><h2 id="3-æ·±å…¥ç†è§£è¿›ç¨‹"><a href="#3-æ·±å…¥ç†è§£è¿›ç¨‹" class="headerlink" title="3 æ·±å…¥ç†è§£è¿›ç¨‹"></a>3 æ·±å…¥ç†è§£è¿›ç¨‹</h2><h4 id="ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ</h4><p>è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸Šè¿è¡Œçš„ç¨‹åºå®ä¾‹ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿåˆ†é…å†…å­˜ã€CPUå’ŒI&#x2F;Oèµ„æºä»¥ä½¿ç¨‹åºå¾—ä»¥è¿è¡Œçš„ç»“æœã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹å®éªŒï¼šæ‰“å¼€ä¸‰ä¸ªç»ˆç«¯çª—å£ï¼Œåœ¨å…¶ä¸­ä¸¤ä¸ªçª—å£ä¸­è¿è¡Œ<code>cat</code>å‘½ä»¤ï¼ˆä¸å¸¦ä»»ä½•é€‰é¡¹ï¼‰ï¼Œå› ä¸º<code>cat</code>å‘½ä»¤ç­‰å¾…æ ‡å‡†è¾“å…¥(stdin)ï¼Œæ‰€ä»¥å®ƒå°†ä¿æŒè¿›ç¨‹å¼€å¯çŠ¶æ€ã€‚ç„¶åï¼Œåœ¨ç¬¬ä¸‰ä¸ªçª—å£ä¸­æ‰§è¡Œ<code>ps aux | grep cat</code>å‘½ä»¤ã€‚æ‚¨ä¼šå‘ç°æœ‰ä¸¤ä¸ªåä¸º<code>cat</code>çš„è¿›ç¨‹å­˜åœ¨ï¼Œå°½ç®¡å®ƒä»¬è°ƒç”¨çš„æ˜¯ç›¸åŒçš„ç¨‹åºã€‚</p><h4 id="å†…æ ¸çš„è§’è‰²"><a href="#å†…æ ¸çš„è§’è‰²" class="headerlink" title="å†…æ ¸çš„è§’è‰²"></a>å†…æ ¸çš„è§’è‰²</h4><p>å†…æ ¸è´Ÿè´£ç®¡ç†æ‰€æœ‰è¿›ç¨‹ã€‚å½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œå†…æ ¸ä¼šå°†ç¨‹åºä»£ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç¡®å®šå¹¶åˆ†é…å¿…è¦çš„èµ„æºï¼Œå¹¶æŒç»­è·Ÿè¸ªæ¯ä¸ªè¿›ç¨‹çš„çŠ¶æ€ã€‚å†…æ ¸æŒæ¡çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li>è¿›ç¨‹çš„çŠ¶æ€</li><li>è¿›ç¨‹ä½¿ç”¨çš„èµ„æºåŠæ¥æ”¶æƒ…å†µ</li><li>è¿›ç¨‹çš„æ‰€æœ‰è€…</li><li>ä¿¡å·å¤„ç†</li><li>ä»¥åŠå…¶ä»–ç›¸å…³ä¿¡æ¯</li></ul><h4 id="èµ„æºåˆ†é…ä¸ç®¡ç†"><a href="#èµ„æºåˆ†é…ä¸ç®¡ç†" class="headerlink" title="èµ„æºåˆ†é…ä¸ç®¡ç†"></a>èµ„æºåˆ†é…ä¸ç®¡ç†</h4><p>æ‰€æœ‰è¿›ç¨‹éƒ½åœ¨ç«äº‰ç³»ç»Ÿèµ„æºï¼Œè€Œå†…æ ¸çš„ä»»åŠ¡å°±æ˜¯æ ¹æ®è¿›ç¨‹çš„éœ€æ±‚åˆç†åˆ†é…è¿™äº›èµ„æºã€‚å½“ä¸€ä¸ªè¿›ç¨‹ç»“æŸæ—¶ï¼Œå®ƒæ‰€å ç”¨çš„èµ„æºä¼šè¢«é‡Šæ”¾å‡ºæ¥ä¾›å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚å†…æ ¸ç¡®ä¿æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½è·å¾—é€‚å½“æ•°é‡çš„èµ„æºï¼Œä»è€Œç»´æŒç³»ç»Ÿçš„é«˜æ•ˆè¿è¡Œã€‚</p><h2 id="4-è¿›ç¨‹åˆ›å»ºä¸ç®¡ç†"><a href="#4-è¿›ç¨‹åˆ›å»ºä¸ç®¡ç†" class="headerlink" title="4 è¿›ç¨‹åˆ›å»ºä¸ç®¡ç†"></a>4 è¿›ç¨‹åˆ›å»ºä¸ç®¡ç†</h2><h4 id="åˆ›å»ºæ–°è¿›ç¨‹"><a href="#åˆ›å»ºæ–°è¿›ç¨‹" class="headerlink" title="åˆ›å»ºæ–°è¿›ç¨‹"></a>åˆ›å»ºæ–°è¿›ç¨‹</h4><p>å½“åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œç°æœ‰è¿›ç¨‹ä½¿ç”¨æ‰€è°“çš„â€œforkâ€ç³»ç»Ÿè°ƒç”¨ï¼ˆåŸºæœ¬ä¸Šå¤åˆ¶äº†è‡ªå·±ã€‚Forkç³»ç»Ÿè°ƒç”¨ä¼šç”Ÿæˆä¸€ä¸ªå‡ ä¹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œè¯¥å­è¿›ç¨‹å°†è·å¾—ä¸€ä¸ªæ–°çš„è¿›ç¨‹IDï¼ˆPIDï¼‰ï¼Œè€ŒåŸå§‹è¿›ç¨‹åˆ™æˆä¸ºå…¶çˆ¶è¿›ç¨‹ï¼Œå¹¶æ‹¥æœ‰ä¸€ä¸ªç§°ä¸ºçˆ¶è¿›ç¨‹IDï¼ˆPPIDï¼‰çš„æ ‡è¯†ç¬¦ã€‚ä¹‹åï¼Œå­è¿›ç¨‹å¯ä»¥é€‰æ‹©ç»§ç»­ä½¿ç”¨ä¸å…¶çˆ¶è¿›ç¨‹ç›¸åŒçš„ç¨‹åºï¼Œä½†æ›´å¸¸è§çš„æƒ…å†µæ˜¯ä½¿ç”¨execveç³»ç»Ÿè°ƒç”¨æ¥å¯åŠ¨ä¸€ä¸ªæ–°ç¨‹åºã€‚æ­¤ç³»ç»Ÿè°ƒç”¨ä¼šé”€æ¯å†…æ ¸ä¸ºåŸè¿›ç¨‹è®¾ç½®çš„å†…å­˜ç®¡ç†ï¼Œå¹¶ä¸ºæ–°ç¨‹åºå»ºç«‹æ–°çš„å†…å­˜ç®¡ç†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è§‚å¯Ÿè¿™ä¸€è¿‡ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps l<br></code></pre></td></tr></table></figure><p><code>l</code>é€‰é¡¹æä¾›äº†ä¸€ä¸ªâ€œé•¿æ ¼å¼â€æˆ–æ›´åŠ è¯¦ç»†çš„è¿è¡Œè¿›ç¨‹è§†å›¾ã€‚æ‚¨ä¼šçœ‹åˆ°ä¸€åˆ—æ ‡è®°ä¸ºPPIDçš„å­—æ®µï¼Œè¿™æ˜¯çˆ¶è¿›ç¨‹IDã€‚</p><h4 id="æ‰€æœ‰è¿›ç¨‹çš„èµ·æº"><a href="#æ‰€æœ‰è¿›ç¨‹çš„èµ·æº" class="headerlink" title="æ‰€æœ‰è¿›ç¨‹çš„èµ·æº"></a>æ‰€æœ‰è¿›ç¨‹çš„èµ·æº</h4><p>æ—¢ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½æ˜¯é€šè¿‡ç›¸äº’å…‹éš†å½¢æˆçš„ï¼Œé‚£ä¹ˆå¿…ç„¶å­˜åœ¨ä¸€ä¸ªæ‰€æœ‰è¿›ç¨‹çš„æºå¤´ã€‚ç¡®å®å¦‚æ­¤ï¼Œå½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå†…æ ¸ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºinitçš„è¿›ç¨‹ï¼Œå®ƒçš„PIDä¸º1ã€‚é™¤éç³»ç»Ÿå…³é—­ï¼Œå¦åˆ™initè¿›ç¨‹æ— æ³•è¢«ç»ˆæ­¢ã€‚å®ƒä»¥rootæƒé™è¿è¡Œï¼Œè´Ÿè´£æ‰§è¡Œè®¸å¤šç»´æŒç³»ç»Ÿè¿ä½œçš„è¿›ç¨‹ã€‚</p><h2 id="5-è¿›ç¨‹ç»ˆæ­¢ä¸ç®¡ç†"><a href="#5-è¿›ç¨‹ç»ˆæ­¢ä¸ç®¡ç†" class="headerlink" title="5 è¿›ç¨‹ç»ˆæ­¢ä¸ç®¡ç†"></a>5 è¿›ç¨‹ç»ˆæ­¢ä¸ç®¡ç†</h2><h4 id="ç»ˆæ­¢è¿›ç¨‹"><a href="#ç»ˆæ­¢è¿›ç¨‹" class="headerlink" title="ç»ˆæ­¢è¿›ç¨‹"></a>ç»ˆæ­¢è¿›ç¨‹</h4><p>è¿›ç¨‹å¯ä»¥é€šè¿‡_exitç³»ç»Ÿè°ƒç”¨é€€å‡ºï¼Œè¿™å°†é‡Šæ”¾è¯¥è¿›ç¨‹å ç”¨çš„èµ„æºä»¥ä¾›é‡æ–°åˆ†é…ã€‚å½“ä¸€ä¸ªè¿›ç¨‹å‡†å¤‡ç»ˆæ­¢æ—¶ï¼Œå®ƒä¼šé€šè¿‡æ‰€è°“çš„â€œç»ˆæ­¢çŠ¶æ€â€å‘ŠçŸ¥å†…æ ¸å…¶ç»ˆæ­¢åŸå› ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒçŠ¶æ€ç 0è¡¨ç¤ºè¿›ç¨‹æˆåŠŸç»“æŸã€‚ç„¶è€Œï¼Œè¿™è¿˜ä¸è¶³ä»¥å®Œå…¨ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹å¿…é¡»ä½¿ç”¨waitç³»ç»Ÿè°ƒç”¨æ¥ç¡®è®¤å­è¿›ç¨‹çš„ç»ˆæ­¢ï¼Œå¹¶æ£€æŸ¥å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ã€‚</p><p>å¦ä¸€ç§ç»ˆæ­¢è¿›ç¨‹çš„æ–¹å¼æ˜¯é€šè¿‡ä¿¡å·ï¼Œä¹‹åä¼šè®¨è®ºã€‚</p><h4 id="å­¤å„¿è¿›ç¨‹"><a href="#å­¤å„¿è¿›ç¨‹" class="headerlink" title="å­¤å„¿è¿›ç¨‹"></a>å­¤å„¿è¿›ç¨‹</h4><p>å¦‚æœçˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹ä¹‹å‰ç»ˆæ­¢ï¼Œå†…æ ¸ä¼šæ„è¯†åˆ°ä¸ä¼šæ”¶åˆ°å¯¹è¯¥å­è¿›ç¨‹çš„waitè°ƒç”¨ã€‚å› æ­¤ï¼Œè¿™äº›å­è¿›ç¨‹ä¼šè¢«æ ‡è®°ä¸ºâ€œå­¤å„¿â€ï¼Œå¹¶ç”±initè¿›ç¨‹æ¥ç®¡ã€‚æœ€ç»ˆï¼Œinitè¿›ç¨‹ä¼šå¯¹è¿™äº›å­¤å„¿è¿›ç¨‹æ‰§è¡Œwaitç³»ç»Ÿè°ƒç”¨ï¼Œä»¥ä¾¿å®ƒä»¬èƒ½å¤Ÿè¢«å½»åº•æ¸…é™¤ã€‚</p><h4 id="åƒµå°¸è¿›ç¨‹"><a href="#åƒµå°¸è¿›ç¨‹" class="headerlink" title="åƒµå°¸è¿›ç¨‹"></a>åƒµå°¸è¿›ç¨‹</h4><p>å½“å­è¿›ç¨‹ç»ˆæ­¢è€Œçˆ¶è¿›ç¨‹å°šæœªè°ƒç”¨waitæ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå†…æ ¸ä¼šå°†å…¶è½¬æ¢ä¸ºåƒµå°¸è¿›ç¨‹ã€‚å­è¿›ç¨‹ä½¿ç”¨çš„èµ„æºå·²è¢«é‡Šæ”¾ç”¨äºå…¶ä»–è¿›ç¨‹ï¼Œä½†åœ¨è¿›ç¨‹è¡¨ä¸­ä»ä¿ç•™æœ‰è¿™ä¸ªåƒµå°¸è¿›ç¨‹çš„æ¡ç›®ã€‚åƒµå°¸è¿›ç¨‹æ— æ³•è¢«æ€æ­»ï¼Œå› ä¸ºå®ƒä»¬å®é™…ä¸Šå·²ç»æ˜¯â€œæ­»äº¡â€çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ä¿¡å·æ¥æ¶ˆç­å®ƒä»¬ã€‚æœ€ç»ˆï¼Œè‹¥çˆ¶è¿›ç¨‹è°ƒç”¨äº†waitç³»ç»Ÿè°ƒç”¨ï¼Œåƒµå°¸è¿›ç¨‹å°†ä¼šæ¶ˆå¤±ï¼Œè¿™ä¸€è¿‡ç¨‹è¢«ç§°ä¸ºâ€œæ”¶å‰²â€ã€‚å¦‚æœçˆ¶è¿›ç¨‹æ²¡æœ‰æ‰§è¡Œwaitè°ƒç”¨ï¼Œinitè¿›ç¨‹å°†æ”¶å…»è¿™äº›åƒµå°¸è¿›ç¨‹ï¼Œå¹¶è‡ªåŠ¨æ‰§è¡Œwaitæ¥ç§»é™¤å®ƒä»¬ã€‚è¿‡å¤šçš„åƒµå°¸è¿›ç¨‹å¯èƒ½ä¼šå æ®è¿›ç¨‹è¡¨çš„ç©ºé—´ï¼Œå½±å“æ–°è¿›ç¨‹çš„è¿è¡Œï¼Œå› æ­¤è¿™æ˜¯åº”å½“é¿å…çš„æƒ…å†µã€‚</p><h2 id="6-ä¿¡å·"><a href="#6-ä¿¡å·" class="headerlink" title="6 ä¿¡å·"></a>6 ä¿¡å·</h2><p>ä¿¡å·æ˜¯ä¸€ç§é€šçŸ¥æœºåˆ¶ï¼Œç”¨äºå‘ŠçŸ¥è¿›ç¨‹æŸäº‹ä»¶å·²ç»å‘ç”Ÿã€‚</p><h4 id="ä¸ºä½•ä½¿ç”¨ä¿¡å·ï¼Ÿ"><a href="#ä¸ºä½•ä½¿ç”¨ä¿¡å·ï¼Ÿ" class="headerlink" title="ä¸ºä½•ä½¿ç”¨ä¿¡å·ï¼Ÿ"></a>ä¸ºä½•ä½¿ç”¨ä¿¡å·ï¼Ÿ</h4><ul><li>ç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥ç‰¹å®šçš„ç»ˆç«¯å­—ç¬¦ï¼ˆå¦‚Ctrl-Cæˆ–Ctrl-Zï¼‰æ¥ç»ˆæ­¢ã€ä¸­æ–­æˆ–æŒ‚èµ·è¿›ç¨‹ã€‚</li><li>ç¡¬ä»¶é—®é¢˜å‡ºç°æ—¶ï¼Œå†…æ ¸å¯èƒ½éœ€è¦é€šçŸ¥ç›¸å…³è¿›ç¨‹ã€‚</li><li>è½¯ä»¶é—®é¢˜å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¹Ÿå¯èƒ½éœ€è¦é€šçŸ¥è¿›ç¨‹ã€‚</li><li>å®ƒä»¬æ˜¯è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚</li></ul><h4 id="ä¿¡å·å¤„ç†è¿‡ç¨‹"><a href="#ä¿¡å·å¤„ç†è¿‡ç¨‹" class="headerlink" title="ä¿¡å·å¤„ç†è¿‡ç¨‹"></a>ä¿¡å·å¤„ç†è¿‡ç¨‹</h4><p>å½“æŸä¸ªäº‹ä»¶äº§ç”Ÿä¸€ä¸ªä¿¡å·åï¼Œè¯¥ä¿¡å·ä¼šè¢«ä¼ é€’ç»™ç›¸åº”çš„è¿›ç¨‹ï¼Œå¹¶å¤„äºå¾…å¤„ç†çŠ¶æ€ç›´åˆ°è¢«æ¥æ”¶ã€‚å¦‚æœè¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œä¿¡å·å°†ä¼šè¢«ä¼ é€’ã€‚ç„¶è€Œï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡è®¾ç½®ä¿¡å·æ©ç æ¥é˜»æ­¢æŸäº›ä¿¡å·çš„ä¼ é€’ã€‚å½“ä¿¡å·è¢«ä¼ é€’æ—¶ï¼Œè¿›ç¨‹å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š</p><ul><li>å¿½ç•¥è¯¥ä¿¡å·ã€‚</li><li>â€œæ•è·â€ä¿¡å·å¹¶æ‰§è¡Œç‰¹å®šçš„å¤„ç†ç¨‹åºã€‚</li><li>è¿›ç¨‹ç»ˆæ­¢ã€‚</li><li>æ ¹æ®ä¿¡å·æ©ç é˜»å¡ä¿¡å·ã€‚</li></ul><h4 id="å¸¸è§ä¿¡å·"><a href="#å¸¸è§ä¿¡å·" class="headerlink" title="å¸¸è§ä¿¡å·"></a>å¸¸è§ä¿¡å·</h4><p>æ¯ä¸ªä¿¡å·éƒ½ç”±æ•´æ•°å®šä¹‰ï¼Œå¹¶å…·æœ‰å½¢å¼ä¸ºSIGxxxçš„ç¬¦å·åã€‚ä¸€äº›å¸¸è§çš„ä¿¡å·åŒ…æ‹¬ï¼š</p><ul><li>**SIGHUP (1)**ï¼šæŒ‚æ–­</li><li>**SIGINT (2)**ï¼šä¸­æ–­</li><li>**SIGKILL (9)**ï¼šå¼ºåˆ¶ç»“æŸè¿›ç¨‹</li><li>**SIGSEGV (11)**ï¼šæ®µé”™è¯¯</li><li>**SIGTERM (15)**ï¼šè½¯ä»¶ç»ˆæ­¢è¯·æ±‚</li><li><strong>SIGSTOP</strong>ï¼šæš‚åœè¿›ç¨‹</li></ul><p>ä¿¡å·ç¼–å·å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå› æ­¤é€šå¸¸é€šè¿‡å…¶åç§°å¼•ç”¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›ä¿¡å·æ— æ³•è¢«é˜»å¡ï¼Œä¾‹å¦‚SIGKILLï¼Œå®ƒå°†ç›´æ¥é”€æ¯è¿›ç¨‹ã€‚</p><h2 id="7-kill"><a href="#7-kill" class="headerlink" title="7 kill"></a>7 kill</h2><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œ<code>kill</code>å‘½ä»¤ç”¨äºå‘è¿›ç¨‹å‘é€ä¿¡å·ä»¥ç»ˆæ­¢å…¶è¿è¡Œã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">kill</span> 12445<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„12445æ˜¯ç›®æ ‡è¿›ç¨‹çš„PIDï¼ˆè¿›ç¨‹æ ‡è¯†ç¬¦ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>kill</code>å‘½ä»¤å‘é€çš„æ˜¯<code>SIGTERM</code>ä¿¡å·ï¼Œè¯·æ±‚è¿›ç¨‹æ­£å¸¸ç»ˆæ­¢å¹¶é‡Šæ”¾èµ„æºã€ä¿å­˜çŠ¶æ€ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>kill</code>å‘½ä»¤æŒ‡å®šå‘é€ä¸åŒçš„ä¿¡å·ï¼Œå¦‚ä½¿ç”¨<code>-9</code>é€‰é¡¹å‘é€<code>SIGKILL</code>ä¿¡å·æ¥å¼ºåˆ¶ç»“æŸè¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">kill</span> -9 12445<br></code></pre></td></tr></table></figure><p>è¿™å°†ç«‹å³æ€æ­»è¿›ç¨‹ï¼Œä¸ç»™äºˆä»»ä½•æ¸…ç†æœºä¼šã€‚</p><p><strong>å¸¸è§ä¿¡å·åŠå…¶åŒºåˆ«</strong></p><p>å°½ç®¡ä»¥ä¸‹ä¿¡å·å¬èµ·æ¥ç›¸ä¼¼ï¼Œä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼š</p><ul><li>**SIGHUP (æŒ‚æ–­)**ï¼šå½“æ§åˆ¶ç»ˆç«¯å…³é—­æ—¶å‘é€ç»™è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å…³é—­äº†ä¸€ä¸ªæ­£åœ¨è¿è¡ŒæŸä¸ªè¿›ç¨‹çš„ç»ˆç«¯çª—å£ï¼Œåˆ™è¯¥è¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªSIGHUPä¿¡å·ã€‚</li><li>**SIGINT (ä¸­æ–­)**ï¼šå¯é€šè¿‡æŒ‰ä¸‹Ctrl-Cè§¦å‘ï¼Œé€šçŸ¥ç³»ç»Ÿå°è¯•ä¼˜é›…åœ°ç»ˆæ­¢è¿›ç¨‹ã€‚</li><li>**SIGTERM (è½¯ä»¶ç»ˆæ­¢)**ï¼šè¯·æ±‚è¿›ç¨‹ç»ˆæ­¢ï¼Œå¹¶å…è®¸å®ƒè¿›è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œã€‚</li><li>**SIGKILL (å¼ºåˆ¶ç»ˆæ­¢)**ï¼šæ— æ¡ä»¶åœ°ç»ˆæ­¢è¿›ç¨‹ï¼Œä¸åšä»»ä½•æ¸…ç†å·¥ä½œï¼Œå¸¸è¢«ç§°ä¸ºâ€œå¼ºåˆ¶æ€æ­»â€ã€‚</li><li>**SIGSTOP (æš‚åœ)**ï¼šåœæ­¢æˆ–æŒ‚èµ·è¿›ç¨‹çš„æ‰§è¡Œã€‚</li></ul><h2 id="8-niceness"><a href="#8-niceness" class="headerlink" title="8 niceness"></a>8 niceness</h2><p>å½“è®¡ç®—æœºåŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºï¼Œå¦‚Chromeã€Microsoft Wordæˆ–Photoshopæ—¶ï¼Œè¿™äº›ç¨‹åºçœ‹ä¼¼å¹¶è¡Œæ‰§è¡Œï¼Œä½†å®é™…ä¸Šå®ƒä»¬æ˜¯é€šè¿‡åˆ†æ—¶å…±äº«CPUæ¥å®ç°çš„ã€‚æ¯ä¸ªè¿›ç¨‹ä»…åœ¨çŸ­æ—¶é—´å†…â€”â€”å³æ‰€è°“çš„æ—¶é—´ç‰‡å†…ä½¿ç”¨CPUèµ„æºï¼Œç„¶åæš‚åœå‡ æ¯«ç§’ä»¥è®©ä½äºå…¶ä»–è¿›ç¨‹ã€‚æ“ä½œç³»ç»Ÿé»˜è®¤é‡‡ç”¨è½®è¯¢è°ƒåº¦ç®—æ³•åˆ†é…æ—¶é—´ç‰‡ï¼Œç¡®ä¿æ‰€æœ‰è¿›ç¨‹å‡å¾—åˆ°è¶³å¤Ÿçš„å¤„ç†æ—¶é—´ã€‚æ­¤è¿‡ç¨‹ç”±å†…æ ¸ç®¡ç†ï¼Œå¹¶ä¸”å¤§å¤šæ•°æƒ…å†µä¸‹èƒ½å¤Ÿé«˜æ•ˆåœ°å®Œæˆã€‚</p><p><strong>è¿›ç¨‹ä¼˜å…ˆçº§ä¸Niceå€¼</strong></p><p>è¿›ç¨‹æ— æ³•è‡ªè¡Œå†³å®šä½•æ—¶ä»¥åŠå¤šä¹…å¯ä»¥å ç”¨CPUï¼›è‹¥æ— å¹²é¢„ï¼Œå„è¿›ç¨‹å¤§è‡´ä¼šè·å¾—ç›¸ç­‰çš„CPUæ—¶é—´ã€‚ç„¶è€Œï¼ŒLinuxç³»ç»Ÿå…è®¸ç”¨æˆ·é€šè¿‡è®¾ç½®â€œniceâ€å€¼æ¥å½±å“å†…æ ¸çš„è°ƒåº¦å†³ç­–ã€‚â€œNiceâ€å€¼å†³å®šäº†è¿›ç¨‹è·å–CPUèµ„æºçš„ä¼˜å…ˆçº§ï¼šè¾ƒé«˜çš„æ•°å€¼æ„å‘³ç€è¾ƒä½çš„ä¼˜å…ˆçº§ï¼ˆæ›´â€œå‹å–„â€çš„è¿›ç¨‹ï¼‰ï¼Œè€Œè¾ƒä½ç”šè‡³è´Ÿæ•°çš„å€¼åˆ™è¡¨ç¤ºè¾ƒé«˜ä¼˜å…ˆçº§ï¼ˆè¾ƒâ€œä¸å‹å–„â€çš„è¿›ç¨‹ï¼‰ã€‚</p><p>æŸ¥çœ‹è¿›ç¨‹çš„â€œniceâ€å€¼å¯ä»¥é€šè¿‡<code>top</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ top<br></code></pre></td></tr></table></figure><p>åœ¨æ˜¾ç¤ºçš„ç»“æœä¸­ï¼Œâ€œNIâ€åˆ—è¡¨ç¤ºçš„å°±æ˜¯å„ä¸ªè¿›ç¨‹çš„â€œniceâ€çº§åˆ«ã€‚</p><p><strong>è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§</strong></p><p>ä½¿ç”¨<code>nice</code>å’Œ<code>renice</code>å‘½ä»¤å¯è°ƒæ•´è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼š</p><ul><li><p><code>nice</code>å‘½ä»¤ç”¨äºå¯åŠ¨æ–°è¿›ç¨‹æ—¶è®¾å®šå…¶ä¼˜å…ˆçº§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">nice</span> -n 5 apt upgrade<br></code></pre></td></tr></table></figure></li><li><p><code>renice</code>å‘½ä»¤åˆ™ç”¨äºä¿®æ”¹å·²å­˜åœ¨è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ renice 10 -p 3245<br></code></pre></td></tr></table></figure></li></ul><h2 id="9-è¿›ç¨‹çŠ¶æ€"><a href="#9-è¿›ç¨‹çŠ¶æ€" class="headerlink" title="9 è¿›ç¨‹çŠ¶æ€"></a>9 è¿›ç¨‹çŠ¶æ€</h2><p>æ‰§è¡Œ<code>ps aux</code>å‘½ä»¤åï¼Œåœ¨â€œSTATâ€åˆ—ä¸­å¯ä»¥çœ‹åˆ°å„ç§çŠ¶æ€ä»£ç ï¼Œå®ƒä»¬ä»£è¡¨Linuxè¿›ç¨‹ä¸­å¯èƒ½å¤„äºçš„ä¸åŒçŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„çŠ¶æ€ä»£ç åŠå…¶å«ä¹‰ï¼š</p><ul><li><strong>R</strong>ï¼šè¿è¡Œæˆ–å¯è¿è¡ŒçŠ¶æ€ã€‚è¿™æ„å‘³ç€è¿›ç¨‹æ­£åœ¨è¿è¡Œæˆ–ç­‰å¾…CPUå¤„ç†ã€‚</li><li><strong>S</strong>ï¼šä¸­æ–­ä¼‘çœ çŠ¶æ€ã€‚è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶å®Œæˆï¼Œä¾‹å¦‚æ¥è‡ªç»ˆç«¯çš„è¾“å…¥ã€‚</li><li><strong>D</strong>ï¼šä¸å¯ä¸­æ–­ä¼‘çœ çŠ¶æ€ã€‚è¿™äº›è¿›ç¨‹æ— æ³•è¢«ä¿¡å·æ€æ­»æˆ–ä¸­æ–­ï¼Œé€šå¸¸éœ€è¦é€šè¿‡é‡å¯ç³»ç»Ÿæˆ–è§£å†³é—®é¢˜æ¥æ¸…é™¤ã€‚</li><li><strong>Z</strong>ï¼šåƒµå°¸çŠ¶æ€ã€‚è¿™æ˜¯æŒ‡å·²ç»ˆæ­¢ä½†ä»åœ¨ç­‰å¾…å…¶çŠ¶æ€è¢«æ”¶é›†çš„è¿›ç¨‹ã€‚</li><li><strong>T</strong>ï¼šå·²åœæ­¢çŠ¶æ€ã€‚è¡¨ç¤ºè¿›ç¨‹å·²è¢«æŒ‚èµ·æˆ–åœæ­¢ã€‚</li></ul><h2 id="10-proc-æ–‡ä»¶ç³»ç»Ÿ"><a href="#10-proc-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="10 &#x2F;proc æ–‡ä»¶ç³»ç»Ÿ"></a>10 &#x2F;proc æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="Linuxä¸­çš„è¿›ç¨‹ä¸-procæ–‡ä»¶ç³»ç»Ÿ"><a href="#Linuxä¸­çš„è¿›ç¨‹ä¸-procæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="Linuxä¸­çš„è¿›ç¨‹ä¸&#x2F;procæ–‡ä»¶ç³»ç»Ÿ"></a>Linuxä¸­çš„è¿›ç¨‹ä¸&#x2F;procæ–‡ä»¶ç³»ç»Ÿ</h3><p>åœ¨Linuxä¸­ï¼Œæ‰€æœ‰äº‹ç‰©éƒ½è¢«è§†ä¸ºæ–‡ä»¶ï¼Œè¿™åŒ…æ‹¬è¿›ç¨‹ã€‚è¿›ç¨‹ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼š&#x2F;procæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ—å‡º&#x2F;procç›®å½•ä¸‹çš„å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /proc<br></code></pre></td></tr></table></figure><p>è¯¥ç›®å½•ä¸‹åŒ…å«å¤šä¸ªå­ç›®å½•ï¼Œæ¯ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹IDï¼ˆPIDï¼‰éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å­ç›®å½•ã€‚é€šè¿‡æŸ¥çœ‹<code>ps</code>å‘½ä»¤çš„è¾“å‡ºï¼Œå¯ä»¥æ‰¾åˆ°ç‰¹å®šè¿›ç¨‹çš„PIDï¼Œå¹¶åœ¨&#x2F;procç›®å½•ä¸‹å¯¹åº”åœ°è®¿é—®å…¶ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹PIDä¸º12345çš„è¿›ç¨‹çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨<code>cat</code>å‘½ä»¤è¯»å–å…¶çŠ¶æ€æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> /proc/12345/status<br></code></pre></td></tr></table></figure><p>è¿™å°†å±•ç¤ºæœ‰å…³è¯¥è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯åŠæ›´è¯¦ç»†çš„èµ„æ–™ã€‚é€šè¿‡&#x2F;procç›®å½•ï¼Œå†…æ ¸æä¾›äº†å¯¹ç³»ç»ŸçŠ¶æ€çš„è§†å›¾ï¼Œå› æ­¤è¿™é‡Œçš„ä¿¡æ¯æ¯”<code>ps</code>å‘½ä»¤æ˜¾ç¤ºçš„æ›´ä¸ºè¯¦å°½å’Œå…¨é¢ã€‚</p><h2 id="11-job-control"><a href="#11-job-control" class="headerlink" title="11 job control"></a>11 job control</h2><p><strong>åœ¨å•ä¸€ç»ˆç«¯çª—å£ä¸­ç®¡ç†é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹</strong></p><p>å½“åœ¨å•ä¸€ç»ˆç«¯çª—å£ä¸­æ‰§è¡Œä¸€ä¸ªè€—æ—¶è¾ƒé•¿çš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šå ç”¨æ•´ä¸ªshellç›´åˆ°å®Œæˆã€‚ä¸ºäº†ç»§ç»­ä½¿ç”¨æœºå™¨ï¼Œå¯ä»¥å°†è¿›ç¨‹ç½®äºåå°è¿è¡Œã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•é€šè¿‡ä½œä¸šï¼ˆjobsï¼‰æ§åˆ¶è¿›ç¨‹è¿è¡Œçš„æ–¹å¼ï¼š</p><p><strong>å°†ä»»åŠ¡å‘é€åˆ°åå°</strong></p><p>åœ¨å‘½ä»¤åæ·»åŠ ä¸€ä¸ª&amp;ç¬¦å·ï¼Œå¯ä»¥è®©å‘½ä»¤åœ¨åå°è¿è¡Œï¼ŒåŒæ—¶é‡Šæ”¾shellä»¥ä¾¿è¿›è¡Œå…¶ä»–æ“ä½œã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sleep</span> 1000 &amp;<br>$ <span class="hljs-built_in">sleep</span> 1001 &amp;<br>$ <span class="hljs-built_in">sleep</span> 1002 &amp;<br></code></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹æ‰€æœ‰åå°ä½œä¸š</strong></p><p>è¦æŸ¥çœ‹åˆšåˆšå‘é€åˆ°åå°çš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨<code>jobs</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">jobs</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">[<span class="hljs-number">1</span>]    Running     sleep <span class="hljs-number">1000</span> <span class="hljs-meta">&amp;</span><br>[<span class="hljs-number">2</span>]<span class="hljs-punctuation">-</span>   Running     sleep <span class="hljs-number">1001</span> <span class="hljs-meta">&amp;</span><br>[<span class="hljs-number">3</span>]<span class="hljs-punctuation">+</span>   Running     sleep <span class="hljs-number">1002</span> <span class="hljs-meta">&amp;</span><br></code></pre></td></tr></table></figure><p>è¿™æ˜¾ç¤ºäº†æ¯ä¸ªä½œä¸šçš„IDã€çŠ¶æ€åŠæ‰€è¿è¡Œçš„å‘½ä»¤ã€‚å¸¦æœ‰+å·æ ‡è®°çš„ä½œä¸šæ˜¯æœ€æ–°çš„åå°ä½œä¸šï¼Œè€Œ-å·æ ‡è®°çš„åˆ™æ˜¯æ¬¡æ–°ä½œä¸šã€‚</p><p><strong>å°†ç°æœ‰ä½œä¸šå‘é€åˆ°åå°</strong></p><p>å¯¹äºå·²ç»å¯åŠ¨ä½†æœªè®¾ä¸ºåå°è¿è¡Œçš„ä»»åŠ¡ï¼Œæ— éœ€ç»ˆæ­¢å®ƒé‡æ–°å¼€å§‹ã€‚é¦–å…ˆé€šè¿‡Ctrl-Zæš‚åœä½œä¸šï¼Œç„¶åä½¿ç”¨<code>bg</code>å‘½ä»¤å°†å…¶ç½®äºåå°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">pete@icebox ~ $ <span class="hljs-built_in">sleep</span> 1003<br>^Z<br>[4]+    Stopped     <span class="hljs-built_in">sleep</span> 1003<br>pete@icebox ~ $ <span class="hljs-built_in">bg</span><br>[4]+    <span class="hljs-built_in">sleep</span> 1003 &amp;<br></code></pre></td></tr></table></figure><p>å†æ¬¡ä½¿ç”¨<code>jobs</code>å‘½ä»¤ç¡®è®¤æ›´æ–°åçš„çŠ¶æ€ã€‚</p><p><strong>å°†åå°ä½œä¸šç§»è‡³å‰å°</strong></p><p>è¦å°†åå°ä½œä¸šç§»åˆ°å‰å°ï¼ŒæŒ‡å®šç›¸åº”çš„ä½œä¸šIDå³å¯ã€‚å¦‚æœç›´æ¥è¿è¡Œ<code>fg</code>ä¸å¸¦å‚æ•°ï¼Œåˆ™é»˜è®¤å°†æœ€æ–°çš„åå°ä½œä¸šï¼ˆå³å¸¦æœ‰+å·æ ‡è®°çš„ä½œä¸šï¼‰å¸¦å›å‰å°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">fg</span> %1<br></code></pre></td></tr></table></figure><p><strong>ç»ˆæ­¢åå°ä½œä¸š</strong></p><p>ç±»ä¼¼åœ°ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šä½œä¸šIDæ¥ç»ˆæ­¢åå°è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">kill</span> %1<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Permissions</title>
    <link href="/2025/03/21/Linux-Permissions/"/>
    <url>/2025/03/21/Linux-Permissions/</url>
    
    <content type="html"><![CDATA[<h1 id="Permissions"><a href="#Permissions" class="headerlink" title="Permissions"></a>Permissions</h1><h2 id="1-æ–‡ä»¶æƒé™"><a href="#1-æ–‡ä»¶æƒé™" class="headerlink" title="1 æ–‡ä»¶æƒé™"></a>1 æ–‡ä»¶æƒé™</h2><p>å¦‚å…ˆå‰æ‰€å­¦ï¼Œæ–‡ä»¶æœ‰ä¸åŒçš„æƒé™æˆ–æ–‡ä»¶æ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l Desktop/<br>drwxr-xr-x 2 pete penguins 4096 Dec 1 11:45 .<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶æƒé™åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯æ–‡ä»¶ç±»å‹ï¼Œç”±æƒé™å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç”±äºæŸ¥çœ‹çš„æ˜¯ç›®å½•ï¼Œå› æ­¤æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸º<code>d</code>ã€‚æœ€å¸¸è§çš„æ˜¯ç”¨<code>-</code>è¡¨ç¤ºæ™®é€šæ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥çš„ä¸‰ä¸ªéƒ¨åˆ†æ˜¯å®é™…æƒé™ï¼Œæ¯ç»„æƒé™ç”±3ä¸ªæ¯”ç‰¹ä½ç»„æˆï¼Œåˆ†åˆ«ä»£è¡¨ç”¨æˆ·æƒé™ã€ç»„æƒé™å’Œå…¶ä»–ç”¨æˆ·æƒé™ã€‚ä¸ºäº†ä¾¿äºåŒºåˆ†ï¼Œæˆ‘ä»¬åœ¨å„ç»„ä¹‹é—´åŠ ä¸Šç«–çº¿ã€‚</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">d | <span class="hljs-type">rwx</span> | <span class="hljs-type">r</span>-x | <span class="hljs-type">r</span>-x<br></code></pre></td></tr></table></figure><p>æ¯ä¸ªå­—ç¬¦ä»£è¡¨ä¸åŒçš„æƒé™ï¼š</p><ul><li><code>r</code>: å¯è¯»</li><li><code>w</code>: å¯å†™</li><li><code>x</code>: å¯æ‰§è¡Œï¼ˆåŸºæœ¬ä¸Šæ˜¯æŒ‡å¯æ‰§è¡Œç¨‹åºï¼‰</li><li><code>-</code>: æ— æ­¤æƒé™</li></ul><p>æ ¹æ®ä¸Šè¿°ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºç”¨æˆ·<code>pete</code>å¯¹ç›®å½•å…·æœ‰è¯»å–ã€å†™å…¥å’Œæ‰§è¡Œæƒé™ã€‚ç»„<code>penguins</code>æ‹¥æœ‰è¯»å–å’Œæ‰§è¡Œæƒé™ã€‚æœ€åï¼Œå…¶ä»–ç”¨æˆ·ï¼ˆå³å…¶ä½™æ‰€æœ‰äººï¼‰ä¹Ÿå…·æœ‰è¯»å–å’Œæ‰§è¡Œæƒé™ã€‚</p><h2 id="2-ä¿®æ”¹æƒé™"><a href="#2-ä¿®æ”¹æƒé™" class="headerlink" title="2 ä¿®æ”¹æƒé™"></a>2 ä¿®æ”¹æƒé™</h2><p>ä½¿ç”¨<code>chmod</code>å‘½ä»¤å¯ä»¥æ›´æ”¹æƒé™ã€‚</p><p>é¦–å…ˆï¼Œé€‰æ‹©è¦æ›´æ”¹çš„æƒé™é›†ï¼šç”¨æˆ·(user)ã€ç»„(group)æˆ–å…¶ä»–(other)ã€‚ä½ å¯ä»¥é€šè¿‡<code>+</code>æˆ–<code>-</code>æ¥æ·»åŠ æˆ–ç§»é™¤æƒé™ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p><p><strong>ä¸ºæ–‡ä»¶æ·»åŠ æƒé™ä½</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">chmod</span> u+x myfile<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤æ„ä¸ºï¼šå¯¹<code>myfile</code>ä¿®æ”¹æƒé™ï¼Œåœ¨ç”¨æˆ·æƒé™é›†ä¸­æ·»åŠ æ‰§è¡Œæƒé™ã€‚è¿™æ„å‘³ç€ç”¨æˆ·ç°åœ¨å¯¹æ­¤æ–‡ä»¶å…·æœ‰æ‰§è¡Œæƒé™</p><p><strong>ç§»é™¤æ–‡ä»¶çš„æƒé™ä½</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">chmod</span> u-x myfile<br></code></pre></td></tr></table></figure><p><strong>ä¸ºæ–‡ä»¶æ·»åŠ å¤šä¸ªæƒé™ä½</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">chmod</span> ug+w<br></code></pre></td></tr></table></figure><p>å¦ä¸€ç§æ›´æ”¹æƒé™çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ•°å­—æ ¼å¼ã€‚è¿™ç§æ–¹æ³•å…è®¸ä¸€æ¬¡æ€§æ›´æ”¹æƒé™ï¼Œè€Œä¸å¿…ç”¨<code>r</code>ã€<code>w</code>æˆ–<code>x</code>è¡¨ç¤ºæƒé™ï¼Œè€Œæ˜¯é‡‡ç”¨æ•°å­—è¡¨ç¤ºå•ä¸ªæƒé™é›†ï¼Œå› æ­¤æ— éœ€æŒ‡å®šç”¨æˆ·(<code>u</code>)æˆ–ç»„(<code>g</code>)ã€‚</p><p>ä»¥ä¸‹æ˜¯æ•°å­—è¡¨ç¤ºæ³•ï¼š</p><ul><li><code>4</code>ï¼šè¯»å–æƒé™</li><li><code>2</code>ï¼šå†™å…¥æƒé™</li><li><code>1</code>ï¼šæ‰§è¡Œæƒé™</li></ul><p>æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">chmod</span> 755 myfile<br></code></pre></td></tr></table></figure><p>755è¦†ç›–æ‰€æœ‰æƒé™é›†çš„æƒé™ã€‚ç¬¬ä¸€ä¸ªæ•°å­—ï¼ˆ7ï¼‰ä»£è¡¨ç”¨æˆ·çš„æƒé™ï¼Œç¬¬äºŒä¸ªæ•°å­—ï¼ˆ5ï¼‰ä»£è¡¨ç»„çš„æƒé™ï¼Œæœ€åçš„5ä»£è¡¨å…¶ä»–ç”¨æˆ·çš„æƒé™ã€‚</p><h2 id="3-æ‰€æœ‰æƒ"><a href="#3-æ‰€æœ‰æƒ" class="headerlink" title="3 æ‰€æœ‰æƒ"></a>3 æ‰€æœ‰æƒ</h2><p>é™¤äº†ä¿®æ”¹æ–‡ä»¶çš„æƒé™å¤–ï¼Œè¿˜å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„ç”¨æˆ·å’Œç»„æ‰€æœ‰æƒã€‚</p><p><strong>ä¿®æ”¹ç”¨æˆ·æ‰€æœ‰æƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> patty myfile<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†<code>myfile</code>çš„æ‰€æœ‰è€…è®¾ç½®ä¸º<code>patty</code>ã€‚</p><p><strong>ä¿®æ”¹ç»„æ‰€æœ‰æƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chgrp</span> whales myfile<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†<code>myfile</code>çš„ç»„æ‰€æœ‰æƒè®¾ç½®ä¸º<code>whales</code>ã€‚</p><p><strong>åŒæ—¶ä¿®æ”¹ç”¨æˆ·å’Œç»„æ‰€æœ‰æƒ</strong></p><p>è‹¥è¦åœ¨åŒä¸€æ—¶é—´è®¾ç½®ç”¨æˆ·å’Œç»„æ‰€æœ‰æƒï¼Œåªéœ€åœ¨ç”¨æˆ·åååŠ ä¸Šå†’å·å’Œç»„åå³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> patty:whales myfile<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå°±èƒ½ä¸€æ¬¡æ€§è®¾ç½®<code>myfile</code>çš„ç”¨æˆ·æ‰€æœ‰è€…ä¸º<code>patty</code>ï¼Œç»„æ‰€æœ‰è€…ä¸º<code>whales</code>ã€‚</p><h2 id="4-Umask"><a href="#4-Umask" class="headerlink" title="4 Umask"></a>4 Umask</h2><p>æ¯ä¸ªåˆ›å»ºçš„æ–‡ä»¶éƒ½å¸¦æœ‰ä¸€å¥—é»˜è®¤æƒé™ã€‚å¦‚æœéœ€è¦æ›´æ”¹è¿™å¥—é»˜è®¤æƒé™ï¼Œå¯ä»¥ä½¿ç”¨<code>umask</code>å‘½ä»¤æ¥å®ç°ã€‚è¯¥å‘½ä»¤åŸºäºå¸¸è§çš„æ•°å­—æƒé™è¡¨ç¤ºæ³•ä¸­çš„3ä½æƒé™é›†åˆè¿›è¡Œæ“ä½œã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>umask</code>å¹¶éå¢åŠ æƒé™ï¼Œè€Œæ˜¯é€šè¿‡å‡å»æŸäº›æƒé™æ¥è®¾å®šæ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">umask</span> 021<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œè®¾ç½®æ„å‘³ç€å¸Œæœ›æ–°æ–‡ä»¶çš„é»˜è®¤æƒé™ä¸ºï¼šå…è®¸ç”¨æˆ·æ‹¥æœ‰å…¨éƒ¨è®¿é—®æƒé™ï¼Œä½†å¯¹ç»„å–æ¶ˆå†™æƒé™ï¼Œä»¥åŠå…¶ä»–ç”¨æˆ·å–æ¶ˆæ‰§è¡Œæƒé™ã€‚å¤šæ•°å‘è¡Œç‰ˆçš„é»˜è®¤<code>umask</code>å€¼æ˜¯022ï¼Œè¿™è¡¨ç¤ºæ‰€æœ‰è€…æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™ï¼Œä½†æ˜¯ç»„å’Œå…¶ä»–ç”¨æˆ·ä¸å…·æœ‰å†™æƒé™ã€‚</p><p>æ‰§è¡Œ<code>umask</code>å‘½ä»¤åï¼Œå®ƒå°†åº”ç”¨äºæ‚¨åˆ›å»ºçš„æ–°æ–‡ä»¶çš„é»˜è®¤æƒé™é›†ã€‚ç„¶è€Œï¼Œè‹¥è¦ä½¿è¿™ç§è®¾ç½®æŒä¹…åŒ–ï¼Œåˆ™éœ€è¦ä¿®æ”¹å¯åŠ¨æ–‡ä»¶ï¼ˆä¾‹å¦‚<code>.profile</code>ï¼‰ã€‚</p><h2 id="5-Setuid"><a href="#5-Setuid" class="headerlink" title="5 Setuid"></a>5 Setuid</h2><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ™®é€šç”¨æˆ·éœ€è¦æ›´é«˜çš„æƒé™æ¥æ‰§è¡ŒæŸäº›æ“ä½œã€‚ç³»ç»Ÿç®¡ç†å‘˜ä¸å¯èƒ½æ€»æ˜¯åœ¨åœºè¾“å…¥rootå¯†ç ä»¥ä¾›ç”¨æˆ·è®¿é—®å—ä¿æŠ¤çš„æ–‡ä»¶ï¼Œå› æ­¤æœ‰ç‰¹æ®Šçš„æ–‡ä»¶æƒé™ä½å…è®¸è¿™ç§è¡Œä¸ºã€‚è®¾ç½®ç”¨æˆ·IDï¼ˆSet User ID, SUIDï¼‰å…è®¸ç”¨æˆ·ä»¥ç¨‹åºæ–‡ä»¶çš„æ‰€æœ‰è€…èº«ä»½ï¼Œè€Œéè‡ªèº«ç”¨æˆ·èº«ä»½è¿è¡Œç¨‹åºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾æƒ³è¦ä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼Œè¿™å¾ˆç®€å•ï¼Œåªéœ€ä½¿ç”¨<code>passwd</code>å‘½ä»¤å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ passwd<br></code></pre></td></tr></table></figure><p><code>passwd</code> å‘½ä»¤å®é™…ä¼šä¿®æ”¹ä¸€äº›æ–‡ä»¶ï¼Œæœ€é‡è¦çš„æ˜¯ä¿®æ”¹äº†<code>/etc/shadow</code>æ–‡ä»¶ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l /etc/shadow<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-rw-r----- 1 root shadow 1134 Dec 1 11:45 /etc/shadow<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¯¥æ–‡ä»¶æ˜¯ç”±rootç”¨æˆ·æ‹¥æœ‰çš„ã€‚é‚£ä¹ˆï¼Œæ™®é€šç”¨æˆ·å¦‚ä½•èƒ½å¤Ÿä¿®æ”¹ç”±rootæ‹¥æœ‰çš„æ–‡ä»¶å‘¢ï¼Ÿ</p><p>ç°åœ¨æŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æ‰€è¿è¡Œå‘½ä»¤çš„æƒé™è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l /usr/bin/passwd<br></code></pre></td></tr></table></figure><p>è¾“å‡ºæ˜¾ç¤ºä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-rwsr-xr-x 1 root root 47032 Dec 1 11:45 /usr/bin/passwd<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œçš„ç‰¹æ®Šæƒé™ä½<code>s</code>ã€‚è¿™å°±æ˜¯SUIDï¼Œå½“ä¸€ä¸ªæ–‡ä»¶è®¾ç½®äº†æ­¤æƒé™æ—¶ï¼Œå®ƒå…è®¸å¯åŠ¨ç¨‹åºçš„ç”¨æˆ·è·å¾—æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ä»¥åŠæ‰§è¡Œæƒé™ï¼Œåœ¨æœ¬ä¾‹ä¸­å³ä¸ºrootç”¨æˆ·çš„æƒé™ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·è¿è¡Œ<code>passwd</code>å‘½ä»¤æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä»¥rootèº«ä»½è¿è¡Œã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥è®¿é—®åƒ<code>/etc/shadow</code>è¿™æ ·çš„å—ä¿æŠ¤æ–‡ä»¶çš„åŸå› ã€‚å¦‚æœå–æ¶ˆäº†è¿™ä¸€æƒé™ä½ï¼Œåˆ™æ— æ³•ä¿®æ”¹<code>/etc/shadow</code>æ–‡ä»¶ï¼Œä»è€Œä¸èƒ½æ›´æ”¹å¯†ç ã€‚</p><p><strong>ä¿®æ”¹SUID</strong></p><p>ä¸å¸¸è§„æƒé™ä¸€æ ·ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ä¿®æ”¹SUIDæƒé™ã€‚</p><p><strong>ç¬¦å·æ–¹å¼ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> u+s myfile<br></code></pre></td></tr></table></figure><p><strong>æ•°å€¼æ–¹å¼ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 4755 myfile<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼ŒSUIDç”¨æ•°å­—4è¡¨ç¤ºï¼Œå¹¶ä¸”å‰ç½®åˆ°æƒé™è®¾ç½®ä¸­ã€‚æœ‰æ—¶æ‚¨å¯èƒ½ä¼šçœ‹åˆ°å¤§å†™çš„Sï¼Œè¿™æ„å‘³ç€å°½ç®¡å…·æœ‰ç›¸åŒçš„SUIDåŠŸèƒ½ï¼Œä½†è¯¥æ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™ã€‚</p><h2 id="6-setgid"><a href="#6-setgid" class="headerlink" title="6 setgid"></a>6 setgid</h2><p>ç±»ä¼¼äºè®¾ç½®ç”¨æˆ·IDæƒé™ä½ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªè®¾ç½®ç»„IDï¼ˆSGIDï¼‰æƒé™ä½ã€‚å½“æ­¤ä½è¢«è®¾ç½®æ—¶ï¼Œå…è®¸ä¸€ä¸ªç¨‹åºä»¥å…¶æ‰€å±çš„ç»„èº«ä»½è¿è¡Œã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l /usr/bin/wall<br>-rwxr-sr-x 1 root <span class="hljs-built_in">tty</span> 19024 Dec 14 11:45 /usr/bin/wall<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œæƒé™ä½ä½äºç»„æƒé™é›†åˆä¸­ã€‚</p><p>ä¿®æ”¹SGIDçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> g+s myfile<br>$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 2555 myfile<br></code></pre></td></tr></table></figure><p>åœ¨æ•°å€¼è¡¨ç¤ºæ³•ä¸­ï¼ŒSGIDç”¨æ•°å­—2è¡¨ç¤ºã€‚ </p><h2 id="7-è¿›ç¨‹æƒé™"><a href="#7-è¿›ç¨‹æƒé™" class="headerlink" title="7 è¿›ç¨‹æƒé™"></a>7 è¿›ç¨‹æƒé™</h2><p>å¯¹äºè¿›ç¨‹æƒé™ï¼Œæœ‰ä¸€ä¸ªå…³é”®ç‚¹éœ€è¦æ³¨æ„ï¼šå½“ä½¿ç”¨è®¾ç½®äº†SUIDæƒé™ä½çš„<code>passwd</code>å‘½ä»¤æ—¶ï¼Œç¨‹åºå°†ä»¥rootæƒé™è¿è¡Œã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€å¯ä»¥ä¸´æ—¶ä½œä¸ºrootç”¨æˆ·ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç ã€‚è¿™æ˜¯å› ä¸ºLinuxç³»ç»Ÿå®æ–½äº†å¤šç§ç”¨æˆ·æ ‡è¯†ï¼ˆUIDï¼‰ã€‚</p><p>æ¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œå°±æ¶‰åŠåˆ°ä»¥ä¸‹ä¸‰ç§UIDï¼š</p><ul><li><p><strong>æœ‰æ•ˆç”¨æˆ·IDï¼ˆEffective UIDï¼‰</strong>ï¼šå†³å®šè¿›ç¨‹è®¿é—®èµ„æºæ—¶æ‰€ä½¿ç”¨çš„æƒé™ã€‚</p></li><li><p><strong>çœŸå®ç”¨æˆ·IDï¼ˆReal UIDï¼‰</strong>ï¼šæ ‡è¯†å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·èº«ä»½ï¼Œç”¨äºè¿½è¸ªå‘èµ·è¯¥è¿›ç¨‹çš„å®é™…ç”¨æˆ·æ˜¯è°ã€‚</p></li><li><p><strong>ä¿å­˜ç”¨æˆ·IDï¼ˆSaved UIDï¼‰</strong>ï¼šå…è®¸è¿›ç¨‹åœ¨æœ‰æ•ˆUIDå’ŒçœŸå®UIDä¹‹é—´åˆ‡æ¢ï¼Œè¿™å¯¹äºæ§åˆ¶ç‰¹æƒæå‡è‡³å…³é‡è¦ã€‚ä»…åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ç‰¹æ®Šæƒé™æ˜¯ä¸€ç§è‰¯å¥½çš„å®è·µã€‚</p></li></ul><p>ä»¥<code>passwd</code>å‘½ä»¤ä¸ºä¾‹ï¼Œå½“æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æœ‰æ•ˆUIDæ˜¯è‡ªå·±çš„UIDï¼ˆå‡è®¾ä¸º500ï¼‰ã€‚ç„¶è€Œï¼Œç”±äº<code>passwd</code>å‘½ä»¤è®¾ç½®äº†SUIDæƒé™ä½ï¼Œæ‰€ä»¥è¿è¡Œæ—¶å…¶æœ‰æ•ˆUIDå˜ä¸º0ï¼Œå³rootç”¨æˆ·çš„UIDã€‚è¿™ä½¿å¾—ç¨‹åºèƒ½å¤Ÿä»¥rootæƒé™è®¿é—®ç›¸å…³æ–‡ä»¶ã€‚</p><p>å¦‚æœå°è¯•ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç ï¼Œæ¯”å¦‚Sallyï¼ˆUIDä¸º600ï¼‰ï¼Œå³ä½¿æš‚æ—¶æ‹¥æœ‰rootæƒé™ï¼Œä½†ç”±äºè¿›ç¨‹åŒæ—¶æŒæœ‰çœŸå®UIDï¼ˆåœ¨æ­¤ä¾‹ä¸­ä¸º500ï¼‰ï¼Œå› æ­¤æ— æƒä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„å¯†ç ã€‚</p><p>å½“è¿è¡Œ<code>passwd</code>å‘½ä»¤æ—¶ï¼Œå®ƒä¼šé¦–å…ˆæ ¹æ®çœŸå®UIDå¯åŠ¨è¿›ç¨‹ï¼Œå¹¶ä¿å­˜æ–‡ä»¶æ‰€æœ‰è€…çš„UIDï¼ˆå³æœ‰æ•ˆUIDï¼‰ï¼Œä»¥ä¾¿äºä¸¤è€…é—´è¿›è¡Œå¿…è¦çš„åˆ‡æ¢ã€‚è¿™æ ·å°±ä¸éœ€è¦å¯¹æ— éœ€rootè®¿é—®æƒé™çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚</p><h2 id="8-The-Sticky-Bit"><a href="#8-The-Sticky-Bit" class="headerlink" title="8 The Sticky Bit"></a>8 The Sticky Bit</h2><p>ç²˜æ»ä½ï¼ˆSticky Bitï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šæƒé™ä½ï¼Œå®ƒä½¿å¾—æ–‡ä»¶æˆ–ç›®å½•ä»…å…è®¸å…¶æ‰€æœ‰è€…æˆ–rootç”¨æˆ·è¿›è¡Œåˆ é™¤æˆ–ä¿®æ”¹æ“ä½œã€‚è¿™ä¸€æœºåˆ¶åœ¨å…±äº«ç›®å½•ä¸­å°¤ä¸ºé‡è¦ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŸ¥çœ‹ä»¥ä¸‹<code>/tmp</code>ç›®å½•çš„æƒé™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -ld /tmp<br>drwxrwxrwxt 6 root root 4096 Dec 15 11:45 /tmp<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°æƒé™å­—ç¬¦ä¸²æœ«å°¾çš„<code>t</code>æ ‡å¿—ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥åœ¨<code>/tmp</code>ç›®å½•ä¸‹æ·»åŠ ã€å†™å…¥æˆ–ä¿®æ”¹æ–‡ä»¶ï¼Œä½†åªæœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…æˆ–rootç”¨æˆ·æ‰èƒ½åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚</p><p><strong>è®¾ç½®ç²˜æ»ä½</strong></p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¸ºä¸€ä¸ªç›®å½•è®¾ç½®ç²˜æ»ä½ï¼š</p><ul><li><p>ä½¿ç”¨ç¬¦å·è¡¨ç¤ºæ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> +t mydir<br></code></pre></td></tr></table></figure></li><li><p>æˆ–è€…ä½¿ç”¨æ•°å­—è¡¨ç¤ºæ³•ï¼ˆå…¶ä¸­ç²˜æ»ä½ç”±åƒä½çš„<code>1</code>è¡¨ç¤ºï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 1755 mydir<br></code></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œï¼Œæ•°å­—æƒé™<code>1755</code>ä¸­çš„<code>1</code>å³ä»£è¡¨è®¾ç½®äº†ç²˜æ»ä½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]ç”¨æˆ·ç®¡ç†</title>
    <link href="/2025/03/21/Linux-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
    <url>/2025/03/21/Linux-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="Userç®¡ç†"><a href="#Userç®¡ç†" class="headerlink" title="Userç®¡ç†"></a>Userç®¡ç†</h1><h2 id="1-ç”¨æˆ·å’Œç»„"><a href="#1-ç”¨æˆ·å’Œç»„" class="headerlink" title="1 ç”¨æˆ·å’Œç»„"></a>1 ç”¨æˆ·å’Œç»„</h2><p>åœ¨ä»»ä½•ä¼ ç»Ÿçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œéƒ½å­˜åœ¨ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå®ƒä»¬çš„å­˜åœ¨çº¯ç²¹æ˜¯ä¸ºäº†è®¿é—®æ§åˆ¶å’Œæƒé™ç®¡ç†ã€‚å½“è¿è¡Œä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œè¯¥è¿›ç¨‹å°†ä»¥å…¶æ‰€æœ‰è€…çš„èº«ä»½è¿è¡Œã€‚æ–‡ä»¶çš„è®¿é—®å’Œæ‰€æœ‰æƒåŒæ ·ä¾èµ–äºæƒé™è®¾ç½®ã€‚</p><p>æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ä¸»ç›®å½•ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·çš„ç‰¹å®šæ–‡ä»¶ï¼Œé€šå¸¸ä½äº&#x2F;home&#x2F;usernameè·¯å¾„ä¸‹ï¼Œä½†åœ¨ä¸åŒçš„å‘è¡Œç‰ˆä¸­å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p><p>ç³»ç»Ÿä½¿ç”¨ç”¨æˆ·IDï¼ˆUIDï¼‰æ¥ç®¡ç†ç”¨æˆ·ï¼›ç”¨æˆ·åæ˜¯ä¾¿äºè¯†åˆ«ç”¨æˆ·çš„å‹å¥½æ–¹å¼ï¼Œä½†ç³»ç»Ÿé€šè¿‡UIDæ¥æ ‡è¯†ç”¨æˆ·ã€‚ç³»ç»Ÿè¿˜åˆ©ç”¨ç”¨æˆ·ç»„æ¥ç®¡ç†æƒé™ï¼Œè¿™äº›ç»„æ˜¯ç”±å…·æœ‰ç›¸åŒæƒé™è®¾ç½®çš„ç”¨æˆ·ç»„æˆçš„é›†åˆï¼Œå¹¶é€šè¿‡ç»„IDï¼ˆGIDï¼‰è¿›è¡Œæ ‡è¯†ã€‚</p><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé™¤äº†æ™®é€šäººç±»ç”¨æˆ·å¤–ï¼Œè¿˜æœ‰å…¶ä»–ç±»å‹çš„ç”¨æˆ·ã€‚æœ‰æ—¶è¿™äº›ç”¨æˆ·æ˜¯ç³»ç»Ÿå®ˆæŠ¤ç¨‹åºï¼Œè´Ÿè´£æŒç»­è¿è¡Œè¿›ç¨‹ä»¥ç»´æŒç³»ç»Ÿçš„æ­£å¸¸è¿ä½œã€‚å…¶ä¸­æœ€é‡è¦çš„ç”¨æˆ·ä¹‹ä¸€æ˜¯rootæˆ–è¶…çº§ç”¨æˆ·ï¼Œrootæ˜¯ç³»ç»Ÿä¸­æƒé™æœ€å¤§çš„ç”¨æˆ·ï¼Œå¯ä»¥è®¿é—®ä»»ä½•æ–‡ä»¶ã€å¯åŠ¨å’Œç»ˆæ­¢ä»»ä½•è¿›ç¨‹ã€‚å¦‚æœéœ€è¦rootæƒé™ä¸”ç”¨æˆ·æ‹¥æœ‰ç›¸åº”çš„æƒé™ï¼Œåˆ™å¯ä»¥é€šè¿‡sudoå‘½ä»¤ä»¥rootèº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚sudoå‘½ä»¤ï¼ˆä»£è¡¨â€œè¶…çº§ç”¨æˆ·æ‰§è¡Œâ€ï¼‰ç”¨äºä»¥rootæƒé™è¿è¡Œå‘½ä»¤ã€‚å°è¯•æŸ¥çœ‹å—ä¿æŠ¤çš„æ–‡ä»¶ï¼Œä¾‹å¦‚&#x2F;etc&#x2F;shadowï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> /etc/shadow</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¼šæ”¶åˆ°â€œæƒé™è¢«æ‹’ç»â€çš„é”™è¯¯ä¿¡æ¯ã€‚ç°åœ¨æ£€æŸ¥å…¶æƒé™ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">$ <span class="hljs-keyword">ls</span> -la <span class="hljs-string">/etc/shadow</span><br>-rw-r<span class="hljs-params">-----</span> 1 root shadow 1134 Dec 1 11<span class="hljs-function">:45</span> <span class="hljs-string">/etc/shadow</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œrootæ˜¯æ–‡ä»¶çš„æ‰€æœ‰è€…ï¼Œéœ€è¦å…·å¤‡rootæƒé™æˆ–æ˜¯shadowç»„æˆå‘˜æ‰èƒ½è¯»å–å†…å®¹ã€‚ç°åœ¨ä½¿ç”¨sudoå‘½ä»¤è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cat</span> /etc/shadow</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå°†èƒ½å¤ŸæŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹ã€‚</p><h2 id="2-root"><a href="#2-root" class="headerlink" title="2 root"></a>2 root</h2><p>å¯ä»¥ä½¿ç”¨suå‘½ä»¤ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ã€‚è¯¥å‘½ä»¤ä¼šâ€œæ›¿æ¢ç”¨æˆ·â€ï¼Œå¦‚æœæœªæŒ‡å®šç”¨æˆ·åï¼Œåˆ™æ‰“å¼€root shellã€‚åªè¦çŸ¥é“å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤åˆ‡æ¢åˆ°ä»»ä½•ç”¨æˆ·ã€‚</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>su<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ç§æ–¹æ³•å­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼šä»¥rootèº«ä»½æ‰§è¡Œæ‰€æœ‰æ“ä½œæ—¶æ›´å®¹æ˜“å‘ç”Ÿå…³é”®æ€§é”™è¯¯ï¼Œå¹¶ä¸”ä½ å¯¹ç”¨äºæ›´æ”¹ç³»ç»Ÿé…ç½®çš„å‘½ä»¤æ²¡æœ‰è®°å½•ç­‰ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ éœ€è¦ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ï¼Œæœ€å¥½åšæŒä½¿ç”¨sudoã€‚</p><p>ç³»ç»Ÿä¸ä¼šè®©æ¯ä¸ªäººéšæ„ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ã€‚æœ‰ä¸€ä¸ªåä¸º&#x2F;etc&#x2F;sudoersçš„æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº†å¯ä»¥è¿è¡Œsudoå‘½ä»¤çš„ç”¨æˆ·ã€‚</p><p>é€šè¿‡&#x2F;etc&#x2F;sudoersæ–‡ä»¶ï¼Œç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿç²¾ç»†åœ°æ§åˆ¶å“ªäº›ç”¨æˆ·æˆ–ç”¨æˆ·ç»„å¯ä»¥é€šè¿‡sudoå‘½ä»¤è·å¾—è¶…çº§ç”¨æˆ·æƒé™ï¼Œä»è€Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p><h2 id="3-etc-passwd"><a href="#3-etc-passwd" class="headerlink" title="3 &#x2F;etc&#x2F;passwd"></a>3 &#x2F;etc&#x2F;passwd</h2><p>ç³»ç»Ÿä½¿ç”¨ç”¨æˆ·IDï¼ˆUIDï¼‰æ¥è¯†åˆ«ç”¨æˆ·ã€‚è¦æ‰¾å‡ºå“ªäº›ç”¨æˆ·æ˜ å°„åˆ°äº†å“ªä¸ªIDï¼ŒæŸ¥çœ‹&#x2F;etc&#x2F;passwdæ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> /etc/passwd</span><br></code></pre></td></tr></table></figure><p>æ­¤æ–‡ä»¶å±•ç¤ºç”¨æˆ·çš„åˆ—è¡¨åŠå…³äºä»–ä»¬çš„è¯¦ç»†ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè¯¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œå¾ˆå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span><br></code></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œæ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œé€šå¸¸ä½ ä¼šçœ‹åˆ°rootç”¨æˆ·ä½œä¸ºç¬¬ä¸€è¡Œã€‚è¿™äº›ä¿¡æ¯ç”±å†’å·åˆ†éš”çš„å¤šä¸ªå­—æ®µç»„æˆï¼Œæä¾›æœ‰å…³ç”¨æˆ·çš„é¢å¤–ä¿¡æ¯ã€‚</p><p>è¿™äº›å­—æ®µåˆ†åˆ«ä»£è¡¨ï¼š</p><ul><li>ç”¨æˆ·å</li><li>ç”¨æˆ·å¯†ç  - å¯†ç å®é™…ä¸Šå¹¶ä¸å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯é€šå¸¸å­˜å‚¨åœ¨&#x2F;etc&#x2F;shadowæ–‡ä»¶ä¸­ã€‚å®ƒåŒ…å«åŠ å¯†çš„ç”¨æˆ·å¯†ç ã€‚åœ¨è¿™ä¸ªå­—æ®µä¸­ï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„ç¬¦å·ï¼šâ€œxâ€è¡¨ç¤ºå¯†ç å­˜å‚¨åœ¨&#x2F;etc&#x2F;shadowæ–‡ä»¶ä¸­ï¼Œâ€œ*â€è¡¨ç¤ºç”¨æˆ·æ²¡æœ‰ç™»å½•æƒé™ï¼Œå¦‚æœä¸ºç©ºåˆ™è¡¨ç¤ºç”¨æˆ·æ²¡æœ‰è®¾ç½®å¯†ç ã€‚</li><li>ç”¨æˆ·IDï¼ˆUIDï¼‰ - rootçš„UIDä¸º0</li><li>ç»„IDï¼ˆGIDï¼‰</li><li>GECOSå­—æ®µ - ä¸€èˆ¬ç”¨äºå¯¹ç”¨æˆ·æˆ–è´¦å·è¿›è¡Œæ³¨é‡Šï¼Œå¦‚çœŸå®å§“åæˆ–ç”µè¯å·ç ï¼Œä»¥é€—å·åˆ†éš”ã€‚</li><li>ç”¨æˆ·ä¸»ç›®å½•</li><li>ç”¨æˆ·shell - å¤§éƒ¨åˆ†ç”¨æˆ·é»˜è®¤ä½¿ç”¨bashä½œä¸ºå…¶shell</li></ul><p>é€šå¸¸ï¼Œåœ¨ç”¨æˆ·çš„è®¾ç½®é¡µé¢ä¸­ï¼Œåªä¼šçœ‹åˆ°äººç±»ç”¨æˆ·ã€‚ç„¶è€Œï¼Œ&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­è¿˜åŒ…å«äº†å…¶ä»–ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œdaemonç”¨æˆ·ç”¨äºå®ˆæŠ¤è¿›ç¨‹ã€‚</p><h2 id="4-etc-shadow"><a href="#4-etc-shadow" class="headerlink" title="4 &#x2F;etc&#x2F;shadow"></a>4 &#x2F;etc&#x2F;shadow</h2><p>&#x2F;etc&#x2F;shadowæ–‡ä»¶ç”¨äºå­˜å‚¨æœ‰å…³ç”¨æˆ·è®¤è¯çš„ä¿¡æ¯ï¼Œå…¶å†…å®¹éœ€è¦è¶…çº§ç”¨æˆ·çš„è¯»å–æƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cat</span> /etc/shadow<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>:MyEPTEa$<span class="hljs-number">6</span>Nonsense:<span class="hljs-number">15000</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::<br></code></pre></td></tr></table></figure><p>å®ƒçœ‹èµ·æ¥ä¸&#x2F;etc&#x2F;passwdæ–‡ä»¶çš„å†…å®¹éå¸¸ç›¸ä¼¼ï¼Œä½†åœ¨å¯†ç å­—æ®µä¸­ï¼Œå°†çœ‹åˆ°åŠ å¯†åçš„å¯†ç ã€‚å„å­—æ®µç”±å†’å·åˆ†éš”ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·å</li><li>åŠ å¯†å¯†ç </li><li>ä¸Šæ¬¡å¯†ç ä¿®æ”¹æ—¥æœŸ - è¡¨è¾¾ä¸ºè‡ª1970å¹´1æœˆ1æ—¥ä»¥æ¥çš„å¤©æ•°ã€‚è‹¥å€¼ä¸º0ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·ä¸‹æ¬¡ç™»å½•æ—¶åº”æ›´æ”¹å¯†ç ã€‚</li><li>æœ€ä½å¯†ç å¹´é¾„ - ç”¨æˆ·éœ€ç­‰å¾…å¤šå°‘å¤©åæ‰èƒ½å†æ¬¡æ›´æ”¹å¯†ç </li><li>æœ€é«˜å¯†ç å¹´é¾„ - åœ¨å¿…é¡»æ›´æ”¹å¯†ç ä¹‹å‰çš„æœ€å¤§å¤©æ•°</li><li>å¯†ç è­¦å‘ŠæœŸ - å¯†ç å³å°†è¿‡æœŸå‰çš„å¤©æ•°</li><li>å¯†ç éæ´»åŠ¨æœŸ - å¯†ç è¿‡æœŸåå…è®¸ä½¿ç”¨æ—§å¯†ç ç™»å½•çš„å¤©æ•°</li><li>è´¦æˆ·åˆ°æœŸæ—¥æœŸ - ç”¨æˆ·æ— æ³•å†ç™»å½•çš„æ—¥æœŸ</li><li>ä¿ç•™å­—æ®µä¾›å°†æ¥ä½¿ç”¨</li></ul><h2 id="5-etc-group"><a href="#5-etc-group" class="headerlink" title="5 &#x2F;etc&#x2F;group"></a>5 &#x2F;etc&#x2F;group</h2><p>å¦ä¸€ä¸ªåœ¨ç”¨æˆ·ç®¡ç†ä¸­ä½¿ç”¨çš„æ–‡ä»¶æ˜¯&#x2F;etc&#x2F;groupæ–‡ä»¶ï¼Œå®ƒå…è®¸åˆ›å»ºå…·æœ‰ä¸åŒæƒé™çš„ä¸åŒç»„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> /etc/group<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>:*:<span class="hljs-number">0</span>:pete<br></code></pre></td></tr></table></figure><p>ä¸&#x2F;etc&#x2F;passwdæ–‡ä»¶éå¸¸ç›¸ä¼¼ï¼Œ&#x2F;etc&#x2F;groupæ–‡ä»¶çš„å„å­—æ®µå¦‚ä¸‹ï¼š</p><ul><li>ç»„å</li><li>ç»„å¯†ç  - é€šå¸¸æ— éœ€è®¾ç½®ç»„å¯†ç ï¼Œä½¿ç”¨å¦‚sudoè¿™æ ·çš„æå‡æƒé™æ–¹å¼æ˜¯æ ‡å‡†åšæ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ä¼šæ”¾ç½®ä¸€ä¸ªâ€œ*â€ä½œä¸ºå ä½ç¬¦ã€‚</li><li>ç»„ID (GID)</li><li>ç”¨æˆ·åˆ—è¡¨ - å¯ä»¥æ‰‹åŠ¨æŒ‡å®šå¸Œæœ›åŠ å…¥ç‰¹å®šç»„çš„ç”¨æˆ·</li></ul><h2 id="6-User-Management-Tools"><a href="#6-User-Management-Tools" class="headerlink" title="6 User Management Tools"></a>6 User Management Tools</h2><p>åœ¨å¤§å¤šæ•°ä¼ä¸šç¯å¢ƒä¸­ï¼Œé€šå¸¸ä½¿ç”¨ç®¡ç†ç³»ç»Ÿæ¥ç®¡ç†ç”¨æˆ·ã€è´¦å·å’Œå¯†ç ã€‚ç„¶è€Œï¼Œåœ¨å•æœºç¯å¢ƒä¸‹ï¼Œä¹Ÿæœ‰ä¸€äº›å®ç”¨çš„å‘½ä»¤å¯ç”¨äºç”¨æˆ·ç®¡ç†ã€‚</p><p><strong>æ·»åŠ ç”¨æˆ·</strong></p><p>å¯ä»¥ä½¿ç”¨<code>adduser</code>æˆ–<code>useradd</code>å‘½ä»¤æ·»åŠ ç”¨æˆ·ã€‚<code>adduser</code>å‘½ä»¤æä¾›æ›´å‹å¥½çš„åŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨åˆ›å»ºä¸»ç›®å½•ç­‰ã€‚é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰æ–°ç”¨æˆ·çš„é»˜è®¤è®¾ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> useradd bob<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤ä¼šåœ¨<code>/etc/passwd</code>ä¸­ä¸ºbobåˆ›å»ºæ¡ç›®ï¼Œè®¾ç½®é»˜è®¤ç»„ï¼Œå¹¶åœ¨<code>/etc/shadow</code>æ–‡ä»¶ä¸­æ·»åŠ ç›¸åº”è®°å½•ã€‚</p><p><strong>åˆ é™¤ç”¨æˆ·</strong></p><p>è¦åˆ é™¤ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨<code>userdel</code>å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sudo</span> userdel bob<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†å°½å¯èƒ½æ’¤é”€ç”±<code>useradd</code>å‘½ä»¤æ‰€ä½œçš„æ–‡ä»¶æ›´æ”¹ã€‚</p><p><strong>æ›´æ”¹å¯†ç </strong></p><p>ä½¿ç”¨<code>passwd</code>å‘½ä»¤å¯ä»¥æ›´æ”¹è‡ªå·±æˆ–ä»–äººçš„å¯†ç ï¼ˆå¦‚æœå…·æœ‰rootæƒé™ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ passwd bob<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Text-Fu</title>
    <link href="/2025/03/18/Linux-Text-Fu/"/>
    <url>/2025/03/18/Linux-Text-Fu/</url>
    
    <content type="html"><![CDATA[<h1 id="Text-Fu"><a href="#Text-Fu" class="headerlink" title="Text-Fu"></a>Text-Fu</h1><h2 id="1-stdout"><a href="#1-stdout" class="headerlink" title="1 stdout"></a>1 stdout</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> Hello World &gt; peanuts.txt<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¯¥å‘½ä»¤åï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ£€æŸ¥æ‰§è¡Œè¯¥å‘½ä»¤çš„ç›®å½•ï¼Œèƒ½çœ‹åˆ°ä¸€ä¸ªåä¸ºpeanuts.txtçš„æ–‡ä»¶ã€‚æŸ¥çœ‹è¯¥æ–‡ä»¶å†…éƒ¨ï¼Œçœ‹åˆ°æ–‡æœ¬â€œHello Worldâ€ã€‚è¿™ä¸€å‘½ä»¤ä¸­æ¶‰åŠå¤šä¸ªæ¦‚å¿µã€‚</p><p>é¦–å…ˆè§£æç¬¬ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> Hello World<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤ä¼šå°†â€œHello Worldâ€æ‰“å°åˆ°å±å¹•ä¸Šã€‚è¿›ç¨‹é€šè¿‡I&#x2F;Oæµæ¥æ”¶è¾“å…¥å¹¶è¿”å›è¾“å‡ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>echo</code>å‘½ä»¤ä»é”®ç›˜è·å–è¾“å…¥ï¼ˆæ ‡å‡†è¾“å…¥æˆ–stdinï¼‰ï¼Œå¹¶å°†è¾“å‡ºï¼ˆæ ‡å‡†è¾“å‡ºæˆ–stdoutï¼‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å› æ­¤ï¼Œåœ¨shellä¸­è¾“å…¥<code>echo Hello World</code>æ—¶ï¼Œå±å¹•ä¸Šå°±ä¼šæ˜¾ç¤ºâ€œHello Worldâ€ã€‚ç„¶è€Œï¼ŒI&#x2F;Oé‡å®šå‘å…è®¸æˆ‘ä»¬æ”¹å˜è¿™ç§é»˜è®¤è¡Œä¸ºï¼Œæä¾›æ›´å¤§çš„æ–‡ä»¶æ“ä½œçµæ´»æ€§ã€‚</p><p>æ¥ç€è§£æå‘½ä»¤çš„ä¸‹ä¸€éƒ¨åˆ†ï¼š</p><p>ä½¿ç”¨<code>&gt;</code>ä½œä¸ºé‡å®šå‘æ“ä½œç¬¦ï¼Œå®ƒæ”¹å˜äº†æ ‡å‡†è¾“å‡ºçš„ç›®çš„åœ°ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥å°†<code>echo Hello World</code>çš„è¾“å‡ºå‘é€åˆ°æ–‡ä»¶è€Œéå±å¹•ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºï¼›è‹¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–åŸæ–‡ä»¶ï¼ˆæ ¹æ®æ‰€ä½¿ç”¨çš„shellï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªæ ‡å¿—æ¥é˜²æ­¢è¿™ç§æƒ…å†µï¼‰ã€‚</p><p>è¿™å°±æ˜¯åŸºæœ¬çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘çš„å·¥ä½œæ–¹å¼ã€‚</p><p>å‡è®¾æˆ‘ä»¬ä¸å¸Œæœ›è¦†ç›–å·²æœ‰çš„peanuts.txtæ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºè¿½åŠ å†…å®¹çš„é‡å®šå‘æ“ä½œç¬¦<code>&gt;&gt;</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> Hello World &gt;&gt; peanuts.txt<br></code></pre></td></tr></table></figure><p>è¿™å°†æŠŠâ€œHello Worldâ€é™„åŠ åˆ°peanuts.txtæ–‡ä»¶æœ«å°¾ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p><h2 id="2-stdin"><a href="#2-stdin" class="headerlink" title="2 stdin"></a>2 stdin</h2><p>æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿåˆ©ç”¨å¤šç§æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰æµï¼Œå¦‚æ¥è‡ªé”®ç›˜çš„è¾“å…¥ã€æ–‡ä»¶ã€å…¶ä»–è¿›ç¨‹çš„è¾“å‡ºä»¥åŠç»ˆç«¯ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚</p><p>ä½¿ç”¨ä¸Šé¢çš„peanuts.txtæ–‡ä»¶ä½œä¸ºä¾‹å­ï¼Œè®°å¾—é‡Œé¢åŒ…å«äº†â€œHello Worldâ€æ–‡æœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> &lt; peanuts.txt &gt; banana.txt<br></code></pre></td></tr></table></figure><p>æ­£å¦‚æˆ‘ä»¬ä½¿ç”¨<code>&gt;</code>è¿›è¡Œæ ‡å‡†è¾“å‡ºé‡å®šå‘ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç”¨<code>&lt;</code>è¿›è¡Œæ ‡å‡†è¾“å…¥é‡å®šå‘ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨ä½¿ç”¨<code>cat</code>å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†ä¸€ä¸ªæ–‡ä»¶ä¼ é€’ç»™å®ƒï¼Œè¯¥æ–‡ä»¶å³æˆä¸ºæ ‡å‡†è¾“å…¥ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>&lt;</code>æ“ä½œç¬¦å°†peanuts.txté‡å®šå‘ä¸ºæ ‡å‡†è¾“å…¥ã€‚ç„¶åï¼Œ<code>cat peanuts.txt</code>çš„è¾“å‡ºâ€”â€”å³â€œHello Worldâ€ï¼Œè¢«é‡å®šå‘åˆ°å¦ä¸€ä¸ªåä¸ºbanana.txtçš„æ–‡ä»¶ä¸­ã€‚ </p><h2 id="3-stderr"><a href="#3-stderr" class="headerlink" title="3 stderr"></a>3 stderr</h2><p>å°è¯•åˆ—å‡ºç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„ç›®å½•å†…å®¹ï¼Œå¹¶å°†è¾“å‡ºå†æ¬¡é‡å®šå‘åˆ°peanuts.txtæ–‡ä»¶ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /fake/directory &gt; peanuts.txt<br></code></pre></td></tr></table></figure><p>ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">ls: cannot access /fake/<span class="hljs-built_in">directory</span>: No such <span class="hljs-built_in">file</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">directory</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠåˆ°å¦ä¸€ä¸ªè¾“å…¥è¾“å‡ºæµâ€”â€”æ ‡å‡†é”™è¯¯(stderr)ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒstderråŒæ ·ä¼šå°†å…¶è¾“å‡ºæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œå®ƒæ˜¯ä¸stdoutå®Œå…¨ç‹¬ç«‹çš„æµã€‚å› æ­¤ï¼Œéœ€è¦ä»¥ä¸åŒçš„æ–¹å¼é‡å®šå‘å…¶è¾“å‡ºã€‚</p><p>ä¸åŒäºä½¿ç”¨<code>&lt;</code>æˆ–<code>&gt;</code>é‚£æ ·ç›´è§‚ï¼Œstderrçš„é‡å®šå‘éœ€è¦ç”¨åˆ°æ–‡ä»¶æè¿°ç¬¦ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªç”¨äºè®¿é—®æ–‡ä»¶æˆ–æµçš„éè´Ÿæ•´æ•°ã€‚stdinã€stdoutå’Œstderrçš„æ–‡ä»¶æè¿°ç¬¦åˆ†åˆ«æ˜¯0ã€1å’Œ2ã€‚</p><p>è‹¥è¦å°†stderré‡å®šå‘åˆ°æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /fake/directory 2&gt; peanuts.txt<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåªæœ‰stderrçš„ä¿¡æ¯ä¼šè¢«å†™å…¥peanuts.txtæ–‡ä»¶ä¸­ã€‚</p><p>å¦‚æœå¸Œæœ›åŒæ—¶æ•è·stderrå’Œstdoutçš„ä¿¡æ¯åˆ°peanuts.txtæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /fake/directory &gt; peanuts.txt 2&gt;&amp;1<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤é¦–å…ˆå°†<code>ls /fake/directory</code>çš„ç»“æœè¾“å‡ºåˆ°peanuts.txtæ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>2&gt;&amp;1</code>å°†stderré‡å®šå‘åˆ°å½“å‰stdoutæŒ‡å‘çš„ä½ç½®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºstdoutæŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ï¼Œstderrä¹Ÿä¼šè¢«é‡å®šå‘è‡³åŒä¸€æ–‡ä»¶ã€‚å› æ­¤ï¼Œæ‰“å¼€peanuts.txtæ–‡ä»¶æ—¶ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°stderrå’Œstdoutçš„ä¿¡æ¯ã€‚å¯¹äºä¸Šè¿°å‘½ä»¤ï¼Œå®é™…åªä¼šè¾“å‡ºstderrçš„å†…å®¹ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ›´ç®€æ´çš„æ–¹å¼å°†stdoutå’ŒstderråŒæ—¶é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /fake/directory &amp;&gt; peanuts.txt<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ ä¸å¸Œæœ›å¤„ç†ä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶æƒ³å½»åº•å¿½ç•¥stderrçš„æ¶ˆæ¯ï¼Œå¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°ç‰¹æ®Šæ–‡ä»¶<code>/dev/null</code>ï¼Œå®ƒä¼šä¸¢å¼ƒæ‰€æœ‰è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /fake/directory 2&gt; /dev/null<br></code></pre></td></tr></table></figure><h2 id="4-pipe-and-tee"><a href="#4-pipe-and-tee" class="headerlink" title="4 pipe and tee"></a>4 pipe and tee</h2><p>æœ‰ä¸€ä¸ªéå¸¸å®ç”¨çš„æ“ä½œæ˜¯å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚é¦–å…ˆå°è¯•ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -la /etc<br></code></pre></td></tr></table></figure><p>è¿™å°†å±•ç¤º&#x2F;etcç›®å½•ä¸‹çš„è¯¦ç»†æ–‡ä»¶åˆ—è¡¨ï¼Œä½†ç›´æ¥æŸ¥çœ‹å¯èƒ½ä¿¡æ¯é‡è¿‡å¤§éš¾ä»¥é˜…è¯»ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å°†è¾“å‡ºé‡å®šå‘è‡³æ–‡ä»¶ï¼Œè€Œæ˜¯åˆ©ç”¨<code>less</code>ç­‰å‘½ä»¤æ¥ä¼˜åŒ–æŸ¥çœ‹æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -la /etc | less<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨çš„ç®¡é“ç¬¦<code>|</code>èƒ½å¤Ÿå°†å‰ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰è¿æ¥åˆ°ä¸‹ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ã€‚ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç®¡é“å°†<code>ls -la /etc</code>çš„è¾“å‡ºä¼ é€’ç»™äº†<code>less</code>å‘½ä»¤ï¼Œä½¿å¾—æµè§ˆé•¿åˆ—è¡¨å˜å¾—æ›´ä¸ºä¾¿æ·ã€‚ç®¡é“ç¬¦æ˜¯æä¸ºæœ‰ç”¨çš„å·¥å…·ï¼Œåœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ç»å¸¸è¢«ä½¿ç”¨ã€‚</p><p>è‹¥éœ€è¦å°†å‘½ä»¤çš„è¾“å‡ºåŒæ—¶ä¿å­˜åˆ°æ–‡ä»¶å¹¶æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šï¼Œå¯ä»¥é‡‡ç”¨<code>tee</code>å‘½ä»¤å®ç°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> | <span class="hljs-built_in">tee</span> peanuts.txt<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œä¸ä»…èƒ½åœ¨å±å¹•ä¸Šçœ‹åˆ°<code>ls</code>å‘½ä»¤çš„å®æ—¶è¾“å‡ºï¼Œä¹Ÿèƒ½åœ¨åŒä¸€æ—¶é—´å°†è¿™äº›ä¿¡æ¯å†™å…¥peanuts.txtæ–‡ä»¶ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œæ— è®ºæ˜¯åœ¨å³æ—¶æŸ¥çœ‹è¿˜æ˜¯åç»­æŸ¥é˜…è®°å½•æ—¶ï¼Œéƒ½èƒ½è·å–ä¸€è‡´çš„ä¿¡æ¯å†…å®¹ã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆæ—¢éœ€è¦å³æ—¶æŸ¥çœ‹è¾“å‡ºåˆå¸Œæœ›ä¿å­˜å‰¯æœ¬ç”¨äºåç»­å‚è€ƒçš„æƒ…æ™¯ã€‚</p><h2 id="5-env-environment"><a href="#5-env-environment" class="headerlink" title="5 env(environment)"></a>5 env(environment)</h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span><br></code></pre></td></tr></table></figure><p>è¿™å°†æ˜¾ç¤ºç±»ä¼¼<code>/home/pete</code>çš„è·¯å¾„ï¼Œå…·ä½“å–å†³äºç”¨æˆ·åã€‚å†å°è¯•å¦ä¸€æ¡å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤ä¼šè¾“å‡ºç”¨æˆ·åã€‚è¿™äº›ä¿¡æ¯æºè‡ªäºç¯å¢ƒå˜é‡ã€‚</p><p>è¦æŸ¥çœ‹æ‰€æœ‰å½“å‰è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨<code>env</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">env</span><br></code></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šåˆ—å‡ºå¤§é‡å…³äºç¯å¢ƒå˜é‡çš„ä¿¡æ¯ï¼Œè¿™äº›å˜é‡ä¸­åŒ…å«äº†å¯¹shellåŠå…¶ä»–è¿›ç¨‹æœ‰ç”¨çš„æ•°æ®ã€‚ä¸‹</p><p>ç‰¹åˆ«é‡è¦çš„æ˜¯<code>PATH</code>å˜é‡ï¼Œå®ƒæŒ‡å®šäº†ç³»ç»Ÿåœ¨æ‰§è¡Œå‘½ä»¤æ—¶æœç´¢å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¿é—®è¿™ä¸ªå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤è¿”å›ä¸€ç³»åˆ—ç”±å†’å·åˆ†éš”çš„è·¯å¾„ã€‚å‡è®¾ä»äº’è”ç½‘ä¸‹è½½å¹¶å®‰è£…äº†ä¸€ä¸ªè½¯ä»¶åŒ…åˆ°éæ ‡å‡†ç›®å½•ï¼Œå¹¶å¸Œæœ›è¿è¡Œè¯¥å‘½ä»¤ï¼Œä½†è¾“å…¥<code>$ coolcommand</code>åæç¤ºâ€œcommand not foundâ€ã€‚å³ä½¿èƒ½ç›´æ¥çœ‹åˆ°è¯¥äºŒè¿›åˆ¶æ–‡ä»¶å­˜åœ¨äºæŒ‡å®šæ–‡ä»¶å¤¹ä¸­ï¼Œä½†å¦‚æœè¯¥æ–‡ä»¶å¤¹æœªåŒ…å«åœ¨<code>$PATH</code>å˜é‡ä¸­ï¼Œç³»ç»Ÿå°±æ— æ³•æ‰¾åˆ°å¹¶æ‰§è¡Œè¯¥å‘½ä»¤ã€‚</p><p>å¦‚æœéœ€è¦ç»å¸¸ä»ç‰¹å®šç›®å½•è¿è¡Œå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªéœ€ä¿®æ”¹<code>PATH</code>ç¯å¢ƒå˜é‡ï¼Œå°†å…¶æ·»åŠ è‡³æœç´¢è·¯å¾„ä¸­å³å¯ã€‚ä¾‹å¦‚ï¼Œè‹¥è¦æ·»åŠ <code>/custom/path</code>è‡³<code>PATH</code>å˜é‡ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/custom/path<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œå‘½ä»¤æ—¶ä¹Ÿä¼šåœ¨æ–°æ·»åŠ çš„ç›®å½•ä¸­è¿›è¡Œæœç´¢ã€‚</p><p>å½“ä½¿ç”¨<code>export</code>åœ¨ç»ˆç«¯ä¼šè¯ä¸­æ·»åŠ æˆ–ä¿®æ”¹ç¯å¢ƒå˜é‡æ—¶ï¼Œè¿™äº›æ›´æ”¹ä»…å¯¹å½“å‰çš„ç»ˆç«¯ä¼šè¯æœ‰æ•ˆã€‚ä¸€æ—¦å…³é—­äº†è¯¥ç»ˆç«¯ä¼šè¯æˆ–è€…é‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œè¿™äº›æ›´æ”¹å°±ä¼šä¸¢å¤±ã€‚</p><p>å¦‚æœå¸Œæœ›ç¯å¢ƒå˜é‡æ˜¯æ°¸ä¹…æ€§çš„ï¼Œéœ€è¦å°†å…¶æ·»åŠ åˆ°shellé…ç½®æ–‡ä»¶ä¸­ã€‚</p><p>åœ¨Bashä¸­ï¼Œå¯ä»¥æ‰“å¼€<code>~/.bashrc</code>æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹è¡Œæ¥æ°¸ä¹…æ”¹å˜PATHå˜é‡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/your/new/path<br></code></pre></td></tr></table></figure><p>å®Œæˆç¼–è¾‘åä¿å­˜æ–‡ä»¶ï¼Œå¹¶è¿è¡Œ<code>source ~/.bashrc</code>ä½¿æ›´æ”¹ç«‹å³ç”Ÿæ•ˆã€‚</p><h2 id="6-cut"><a href="#6-cut" class="headerlink" title="6 cut"></a>6 cut</h2><p>å…ˆåˆ›å»ºä¸€ä¸ªç”¨äºæ“ä½œçš„æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;The quick brown; fox jumps over the lazydog&#x27;</span> &gt; sample.txt<br></code></pre></td></tr></table></figure><p><code>cut</code>å‘½ä»¤ï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­æå–æ–‡æœ¬ç‰‡æ®µã€‚</p><ul><li>ä½¿ç”¨å­—ç¬¦åˆ—è¡¨æå–å†…å®¹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cut</span> -c 5 sample.txt<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤ä¼šè¾“å‡ºæ–‡ä»¶æ¯è¡Œä¸­çš„ç¬¬5ä¸ªå­—ç¬¦ï¼Œåœ¨æ­¤ä¾‹ä¸­ä¸ºâ€qâ€ã€‚è¯·æ³¨æ„ï¼Œç©ºæ ¼ä¹Ÿè¢«è®¡ä¸ºä¸€ä¸ªå­—ç¬¦ã€‚</p><p><code>-c</code>å‚æ•°å…è®¸æŒ‡å®šè¦æå–çš„å­—ç¬¦åˆ—çš„ä½ç½®ã€‚å¯ä»¥æŒ‡å®šå•ä¸ªå­—ç¬¦ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œ<code>-c 5</code>å°†æå–æ¯è¡Œçš„ç¬¬5ä¸ªå­—ç¬¦ï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªèŒƒå›´ï¼ˆä¾‹å¦‚ï¼Œ<code>-c 1-10</code>å°†æå–æ¯è¡Œçš„å‰10ä¸ªå­—ç¬¦ï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šå¤šä¸ªä¸è¿ç»­çš„å­—ç¬¦ä½ç½®æˆ–èŒƒå›´ï¼Œä¸­é—´ç”¨é€—å·åˆ†éš”ï¼ˆä¾‹å¦‚ï¼Œ<code>-c 1-3,7</code>å°†æå–æ¯è¡Œçš„ç¬¬1åˆ°ç¬¬3ä¸ªå­—ç¬¦ä»¥åŠç¬¬7ä¸ªå­—ç¬¦ï¼‰ã€‚</p><ul><li>æŒ‰ç…§å­—æ®µæå–å†…å®¹ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cut</span> -f 2 sample.txt<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>-f</code>ï¼ˆfieldå­—æ®µï¼‰æ ‡å¿—æ ¹æ®å­—æ®µåˆ‡å‰²æ–‡æœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨TABä½œä¸ºåˆ†éš”ç¬¦ã€‚å› æ­¤ï¼Œç”±TABåˆ†éš”å¼€çš„æ¯ä¸€éƒ¨åˆ†è¢«è§†ä¸ºä¸€ä¸ªå­—æ®µã€‚æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œå°†çœ‹åˆ°è¾“å‡ºä¸ºâ€dogâ€ã€‚</p><p>è¿˜å¯ä»¥ç»“åˆä½¿ç”¨å­—æ®µæ ‡å¿—å’Œå®šç•Œç¬¦æ ‡å¿—æ¥é€šè¿‡è‡ªå®šä¹‰åˆ†éš”ç¬¦æå–å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cut</span> -f 1 -d <span class="hljs-string">&quot;;&quot;</span> sample.txt<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤å°†åˆ†éš”ç¬¦ä»é»˜è®¤çš„TABæ”¹ä¸ºâ€;â€,æ‰€ä»¥ç»“æœåº”ä¸ºâ€The quick brownâ€ã€‚</p><h2 id="7-paste"><a href="#7-paste" class="headerlink" title="7 paste"></a>7 paste</h2><p><code>paste</code>å‘½ä»¤ä¸<code>cat</code>å‘½ä»¤ç±»ä¼¼ï¼Œå®ƒå¯ä»¥å°†æ–‡ä»¶ä¸­çš„å¤šè¡Œåˆå¹¶ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–°æ–‡ä»¶ï¼š</p><p>sample2.txt</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">The</span><br><span class="hljs-attribute">quick</span><br><span class="hljs-attribute">brown</span><br><span class="hljs-attribute">fox</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå°†è¿™äº›è¡Œåˆå¹¶æˆä¸€è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">paste</span> -s sample2.txt<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>paste</code>ä½¿ç”¨çš„åˆ†éš”ç¬¦æ˜¯TABï¼Œå› æ­¤ä¸Šè¿°å‘½ä»¤æ‰§è¡Œåï¼Œæ‰€æœ‰å•è¯ä¼šè¢«TABé”®åˆ†éš”å¹¶æ˜¾ç¤ºåœ¨åŒä¸€è¡Œã€‚</p><p>è‹¥è¦ä½¿åˆ†éš”ç¬¦æ›´æ˜“è¯»ï¼Œå¯ä»¥å°†å…¶ä¿®æ”¹ä¸ºç©ºæ ¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">paste</span> -d <span class="hljs-string">&#x27; &#x27;</span> -s sample2.txt<br></code></pre></td></tr></table></figure><h2 id="8-head"><a href="#8-head" class="headerlink" title="8 head"></a>8 head</h2><p>å‡è®¾æœ‰ä¸€ä¸ªéå¸¸é•¿çš„æ–‡ä»¶ï¼Œå®é™…ä¸Šæœ‰å¾ˆå¤šå¯ä¾›é€‰æ‹©çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>cat /var/log/syslog</code>å‘½ä»¤æŸ¥çœ‹ã€‚ä½ ä¼šçœ‹åˆ°æ–‡æœ¬ä¸€é¡µæ¥ä¸€é¡µåœ°æ˜¾ç¤ºã€‚å¦‚æœåªæƒ³æŸ¥çœ‹è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å‰å‡ è¡Œï¼Œå¯ä»¥ä½¿ç”¨<code>head</code>å‘½ä»¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šæ˜¾ç¤ºæ–‡ä»¶çš„å‰10è¡Œã€‚</p><p>è¦æŸ¥çœ‹<code>/var/log/syslog</code>æ–‡ä»¶çš„å‰10è¡Œï¼Œå¯ä»¥æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">head</span> /var/log/syslog<br></code></pre></td></tr></table></figure><p>è‹¥éœ€è¦æŒ‡å®šè¡Œæ•°ï¼Œæ¯”å¦‚å¸Œæœ›æŸ¥çœ‹å‰15è¡Œï¼Œå¯ä»¥ä½¿ç”¨<code>-n</code>é€‰é¡¹è¿›è¡Œè®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">head</span> -n 15 /var/log/syslog<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>-n</code>æ ‡å¿—ç”¨äºæŒ‡å®šæ˜¾ç¤ºçš„è¡Œæ•°ã€‚</p><h2 id="9-tail"><a href="#9-tail" class="headerlink" title="9 tail"></a>9 tail</h2><p>ç±»ä¼¼äº<code>head</code>å‘½ä»¤ï¼Œ<code>tail</code>å‘½ä»¤é»˜è®¤æƒ…å†µä¸‹æ˜¾ç¤ºæ–‡ä»¶çš„æœ€å10è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">tail</span> /var/log/syslog<br></code></pre></td></tr></table></figure><p>ä¸<code>head</code>å‘½ä»¤ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡<code>-n</code>é€‰é¡¹è‡ªå®šä¹‰å¸Œæœ›æŸ¥çœ‹çš„è¡Œæ•°ã€‚</p><p>æ­¤å¤–ï¼Œ<code>tail</code>å‘½ä»¤æä¾›äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é€‰é¡¹<code>-f</code>ï¼ˆè·Ÿéšï¼‰ï¼Œå®ƒå…è®¸å®æ—¶è·Ÿè¸ªæ–‡ä»¶çš„å¢é•¿ã€‚å½“ä½ åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œæ“ä½œæ—¶ï¼Œå°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§‚å¯Ÿç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">tail</span> -f /var/log/syslog<br></code></pre></td></tr></table></figure><p>å½“ä¸ç³»ç»Ÿäº¤äº’æ—¶ï¼Œsyslogæ–‡ä»¶ä¼šæŒç»­æ›´æ–°ï¼Œè€Œé€šè¿‡<code>tail -f</code>å‘½ä»¤ï¼Œä½ å¯ä»¥å®æ—¶ç›‘æ§æ‰€æœ‰æ–°æ·»åŠ åˆ°è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚è¿™ä¸€åŠŸèƒ½å¯¹äºè°ƒè¯•å’Œç›‘æ§ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h2 id="10-expand-and-unexpand"><a href="#10-expand-and-unexpand" class="headerlink" title="10 expand and unexpand"></a>10 expand and unexpand</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåˆ¶è¡¨ç¬¦ä¼šåœ¨æ–‡æœ¬ä¸­æ˜¾ç¤ºå‡ºæ˜æ˜¾çš„é—´è·å·®å¼‚ï¼Œä½†æŸäº›æ–‡æœ¬æ–‡ä»¶å¯èƒ½æ— æ³•æ¸…æ™°åœ°ä½“ç°è¿™ç§å·®å¼‚ã€‚è‹¥æ–‡ä»¶ä¸­çš„åˆ¶è¡¨ç¬¦æœªèƒ½è¾¾åˆ°é¢„æœŸçš„é—´è·æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨<code>expand</code>å‘½ä»¤å°†åˆ¶è¡¨ç¬¦è½¬æ¢ä¸ºç©ºæ ¼ã€‚</p><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯å°†sample.txtæ–‡ä»¶ä¸­çš„æ¯ä¸ªåˆ¶è¡¨ç¬¦è½¬æ¢ä¸ºä¸€ç»„ç©ºæ ¼å¹¶æ‰“å°è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">expand</span> sample.txt<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å°†æ­¤è¾“å‡ºä¿å­˜åˆ°ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è¾“å‡ºé‡å®šå‘åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">expand</span> sample.txt &gt; result.txt<br></code></pre></td></tr></table></figure><p>ç›¸ååœ°ï¼Œè‹¥éœ€å°†ç©ºæ ¼è½¬æ¢å›åˆ¶è¡¨ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨<code>unexpand</code>å‘½ä»¤ã€‚ç‰¹åˆ«æ˜¯ä½¿ç”¨<code>-a</code>é€‰é¡¹æ—¶ï¼Œå¯ä»¥å°†result.txtæ–‡ä»¶ä¸­çš„æ‰€æœ‰åˆé€‚ç©ºæ ¼ç»„è½¬æ¢ä¸ºåˆ¶è¡¨ç¬¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">unexpand</span> -a result.txt<br></code></pre></td></tr></table></figure><p>è¿™äº›å‘½ä»¤æä¾›äº†è°ƒæ•´æ–‡æœ¬æ–‡ä»¶æ ¼å¼çš„ç®€ä¾¿æ–¹æ³•ï¼Œä½¿å¾—æ–‡æœ¬æ˜¾ç¤ºæ›´åŠ ç¬¦åˆç”¨æˆ·çš„éœ€æ±‚ã€‚</p><h2 id="11-join-and-split"><a href="#11-join-and-split" class="headerlink" title="11 join and split"></a>11 join and split</h2><p><code>join</code>å‘½ä»¤å…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå…±åŒå­—æ®µæ¥åˆå¹¶å¤šä¸ªæ–‡ä»¶ã€‚</p><p>å‡è®¾æœ‰ä¸¤ä¸ªéœ€è¦åˆå¹¶çš„æ–‡ä»¶ï¼Œå®ƒä»¬å†…å®¹å¦‚ä¸‹ï¼š</p><p>file1.txt</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>John<br><span class="hljs-symbol">2 </span>Jane<br><span class="hljs-symbol">3 </span>Mary<br></code></pre></td></tr></table></figure><p>file2.txt</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>Doe<br><span class="hljs-symbol">2 </span>Doe<br><span class="hljs-symbol">3 </span>Sue<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>join</code>å‘½ä»¤ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œåˆå¹¶ï¼Œä¸”è¦æ±‚è¿™äº›å­—æ®µå®Œå…¨ç›¸åŒã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†ä¼šåŸºäºå…±åŒçš„ç¬¬ä¸€ä¸ªå­—æ®µå°†ä¸¤ä¸ªæ–‡ä»¶åˆå¹¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">join</span> file1.txt file2.txt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>John Doe<br><span class="hljs-symbol">2 </span>Jane Doe<br><span class="hljs-symbol">3 </span>Mary Sue<br></code></pre></td></tr></table></figure><p>å¦‚æœæ–‡ä»¶æ ¼å¼ä¸åŒï¼Œä¾‹å¦‚ï¼š</p><p>file1.txt</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">John</span> <span class="hljs-number">1</span><br><span class="hljs-attribute">Jane</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">Mary</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>file2.txt</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1 </span>Doe<br><span class="hljs-symbol">2 </span>Doe<br><span class="hljs-symbol">3 </span>Sue<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®æŒ‡å®šè¦åˆå¹¶çš„å­—æ®µã€‚å¯¹äºä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬å°†file1.txtçš„ç¬¬äºŒä¸ªå­—æ®µä¸file2.txtçš„ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œåˆå¹¶ã€‚å¯¹åº”çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">join</span> -1 2 -2 1 file1.txt file2.txt<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>-1 2</code>æŒ‡å®šäº†file1.txtä¸­ç”¨äºåˆå¹¶çš„å­—æ®µæ˜¯ç¬¬2ä¸ªå­—æ®µï¼Œè€Œ<code>-2 1</code>åˆ™æŒ‡å®šäº†file2.txtä¸­ç”¨äºåˆå¹¶çš„æ˜¯ç¬¬1ä¸ªå­—æ®µã€‚ç»“æœå°†ä¸å‰ä¾‹ç›¸åŒã€‚</p><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨<code>split</code>å‘½ä»¤å°†ä¸€ä¸ªå¤§æ–‡ä»¶åˆ†å‰²æˆè‹¥å¹²ä¸ªå°æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥å°†somefileæŒ‰æ¯1000è¡Œåˆ†å‰²ä¸ºæ–°æ–‡ä»¶ï¼Œé»˜è®¤å‘½åæ ¼å¼ä¸ºx**ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">split</span> somefile<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ <code>-l</code> å‚æ•°æ¥ä¿®æ”¹æ¯ä¸ªæ–‡ä»¶çš„è¡Œæ•°ã€‚</p><h2 id="12-sort"><a href="#12-sort" class="headerlink" title="12 sort"></a>12 sort</h2><p><code>sort</code>å‘½ä»¤ç”¨äºå¯¹æ–‡ä»¶ä¸­çš„è¡Œè¿›è¡Œæ’åºã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨è¯¥å‘½ä»¤çš„ä¸€äº›ç¤ºä¾‹ï¼š</p><p>å‡è®¾æœ‰ä¸€ä¸ªåä¸ºfile1.txtçš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">dog<br>cow<br><span class="hljs-built_in">cat</span><br>elephant<br>bird<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æ ¹æ®å­—æ¯é¡ºåºå¯¹è¿™äº›è¡Œè¿›è¡Œæ’åºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sort</span> file1.txt<br></code></pre></td></tr></table></figure><p>æ’åºåçš„è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">bird<br><span class="hljs-built_in">cat</span><br>cow<br>dog<br>elephant<br></code></pre></td></tr></table></figure><p>è‹¥è¦è¿›è¡Œé€†åºæ’åºï¼Œå¯ä»¥ä½¿ç”¨<code>-r</code>é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sort</span> -r file1.txt<br></code></pre></td></tr></table></figure><p>é€†åºæ’åºçš„ç»“æœä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">elephant<br>dog<br>cow<br><span class="hljs-built_in">cat</span><br>bird<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œå¯¹äºåŒ…å«æ•°å€¼çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<code>-n</code>é€‰é¡¹æŒ‰ç…§æ•°å€¼å¤§å°è¿›è¡Œæ’åºã€‚</p><h2 id="13-tr-translate"><a href="#13-tr-translate" class="headerlink" title="13 tr(translate)"></a>13 tr(translate)</h2><p><code>tr</code>å‘½ä»¤ï¼ˆtranslateçš„ç¼©å†™ï¼‰ç”¨äºå°†ä¸€ç»„å­—ç¬¦è½¬æ¢ä¸ºå¦ä¸€ç»„å­—ç¬¦ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå°†æ‰€æœ‰å°å†™å­—æ¯è½¬æ¢ä¸ºå¤§å†™çš„ç¤ºä¾‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> hello | <span class="hljs-built_in">tr</span> a-z A-Z<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">HELLO</span><br></code></pre></td></tr></table></figure><h2 id="14-uniq-unique"><a href="#14-uniq-unique" class="headerlink" title="14 uniq(unique)"></a>14 uniq(unique)</h2><p><code>uniq</code>ï¼ˆuniqueçš„ç¼©å†™ï¼‰å‘½ä»¤å¯ä»¥ä»æ–‡æœ¬æ–‡ä»¶ä¸­åˆ é™¤é‡å¤çš„è¡Œï¼Œæˆ–è€…å¯¹é‡å¤è¡Œè¿›è¡Œè®¡æ•°ç­‰æ“ä½œã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªåä¸º<code>reading.txt</code>çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css">book<br>book<br>paper<br>paper<br><span class="hljs-selector-tag">article</span><br><span class="hljs-selector-tag">article</span><br>magazine<br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤é‡å¤è¡Œ"><a href="#åˆ é™¤é‡å¤è¡Œ" class="headerlink" title="åˆ é™¤é‡å¤è¡Œ"></a><strong>åˆ é™¤é‡å¤è¡Œ</strong></h4><p>è¦åˆ é™¤ä¸Šè¿°æ–‡ä»¶ä¸­çš„é‡å¤é¡¹ï¼Œå¯ä»¥ä½¿ç”¨<code>uniq</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uniq</span> reading.txt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">book<br>paper<br><span class="hljs-selector-tag">article</span><br>magazine<br></code></pre></td></tr></table></figure><p><strong>è·å–é‡å¤è¡Œçš„è®¡æ•°</strong></p><p>è‹¥è¦ç»Ÿè®¡æ¯è¡Œå‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>-c</code>é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uniq</span> -c reading.txt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">2 </span>book<br><span class="hljs-symbol">2 </span>paper<br><span class="hljs-symbol">2 </span>article<br><span class="hljs-symbol">1 </span>magazine<br></code></pre></td></tr></table></figure><p><strong>ä»…è·å–å”¯ä¸€çš„è¡Œ</strong></p><p>å¦‚æœåªå¯¹å”¯ä¸€å‡ºç°çš„è¡Œæ„Ÿå…´è¶£ï¼Œå¯ä»¥ä½¿ç”¨<code>-u</code>é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uniq</span> -u reading.txt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">magazine</span><br></code></pre></td></tr></table></figure><p><strong>ä»…è·å–é‡å¤çš„è¡Œ</strong></p><p>åŒæ ·åœ°ï¼Œè‹¥åªæƒ³æŸ¥çœ‹é‚£äº›å‡ºç°äº†ä¸æ­¢ä¸€æ¬¡çš„è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>-d</code>é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">uniq</span> -d reading.txt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">book<br>paper<br><span class="hljs-selector-tag">article</span><br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p><code>uniq</code>å‘½ä»¤ä¸ä¼šæ£€æµ‹éç›¸é‚»çš„é‡å¤è¡Œã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹ä¸ç›¸é‚»çš„é‡å¤è¡Œï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css">book<br>paper<br>book<br>paper<br><span class="hljs-selector-tag">article</span><br>magazine<br><span class="hljs-selector-tag">article</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨<code>uniq reading.txt</code>å°†æ— æ³•ç§»é™¤éç›¸é‚»çš„é‡å¤é¡¹ã€‚ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¯ç»“åˆ<code>sort</code>ä¸<code>uniq</code>å‘½ä»¤ä¸€èµ·ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">sort</span> reading.txt | <span class="hljs-built_in">uniq</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½å¾—åˆ°æ— é‡å¤çš„æ’åºåçš„è¾“å‡ºï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">article</span><br>book<br>magazine<br>paper<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å»é™¤æ–‡æœ¬æ–‡ä»¶ä¸­çš„é‡å¤è¡Œï¼Œå¹¶æŒ‰éœ€è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p><h2 id="15-wc-and-nl"><a href="#15-wc-and-nl" class="headerlink" title="15 wc and nl"></a>15 wc and nl</h2><p><code>wc</code>ï¼ˆword countï¼‰å‘½ä»¤ç”¨äºæ˜¾ç¤ºæ–‡ä»¶ä¸­å­—èŠ‚ã€å•è¯å’Œè¡Œçš„æ€»æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">wc</span> /etc/passwd<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">96 </span><span class="hljs-number">265</span> <span class="hljs-number">5925</span> /etc/passwd<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç»“æœåˆ†åˆ«è¡¨ç¤ºï¼šè¡Œæ•°ã€å•è¯æ•°ä»¥åŠå­—èŠ‚æ•°ã€‚</p><p><strong>é€‰æ‹©ç‰¹å®šè®¡æ•°</strong></p><p>è‹¥ä»…éœ€è·å–ç‰¹å®šé¡¹çš„è®¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—é€‰é¡¹ï¼š</p><ul><li><code>-l</code>ï¼šä»…æ˜¾ç¤ºè¡Œæ•°ã€‚</li><li><code>-w</code>ï¼šä»…æ˜¾ç¤ºå•è¯æ•°ã€‚</li><li><code>-c</code>ï¼šä»…æ˜¾ç¤ºå­—èŠ‚æ•°ã€‚</li></ul><p> <strong><code>nl</code> å‘½ä»¤</strong></p><p>å¦ä¸€ä¸ªç”¨äºç»Ÿè®¡æ–‡ä»¶è¡Œæ•°çš„å·¥å…·æ˜¯<code>nl</code>ï¼ˆnumber linesï¼‰å‘½ä»¤ã€‚å®ƒä¸ä»…èƒ½å¤Ÿè®¡ç®—è¡Œæ•°ï¼Œè¿˜èƒ½ä¸ºæ¯ä¸€è¡Œæ·»åŠ è¡Œå·ã€‚</p><p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªåä¸º<code>file1.txt</code>çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs axapta">i<br><span class="hljs-keyword">like</span><br>turtles<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>nl</code>å‘½ä»¤å¤„ç†è¯¥æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">nl</span> file1.txt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå°†ä¸ºï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> i<br><span class="hljs-bullet">2.</span> like<br><span class="hljs-bullet">3.</span> turtles<br></code></pre></td></tr></table></figure><h2 id="16-grep"><a href="#16-grep" class="headerlink" title="16 grep"></a>16 grep</h2><p>grepå‘½ä»¤å…è®¸åœ¨æ–‡ä»¶ä¸­æœç´¢ç¬¦åˆç‰¹å®šæ¨¡å¼çš„å­—ç¬¦ã€‚å¦‚æœæƒ³çŸ¥é“æŸä¸ªç›®å½•ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªæ–‡ä»¶ï¼Œæˆ–è€…æƒ³æŸ¥çœ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦å‡ºç°åœ¨æŸä¸ªæ–‡ä»¶ä¸­ï¼Œæ— éœ€é€è¡Œæ£€æŸ¥æ–‡æœ¬ï¼Œåªéœ€ä½¿ç”¨grepå‘½ä»¤å³å¯ã€‚</p><p>ä»¥sample.txtæ–‡ä»¶ä¸ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ grep fox sample.txt<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤å°†ä¼šæŸ¥æ‰¾å¹¶æ˜¾ç¤ºsample.txtæ–‡ä»¶ä¸­åŒ…å«â€foxâ€çš„æ‰€æœ‰è¡Œã€‚</p><p>è‹¥è¦è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æ¨¡å¼åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨-ié€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ grep -i somepattern somefile<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿grepæ›´åŠ çµæ´»ï¼Œå¯ä»¥å°†å…¶ä¸å…¶ä»–å‘½ä»¤ç»“åˆä½¿ç”¨ï¼Œé€šè¿‡ç®¡é“ç¬¦â€œ|â€å®ç°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">env</span> | grep -i User<br></code></pre></td></tr></table></figure><p>ç”šè‡³å¯ä»¥åœ¨æ¨¡å¼ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /somedir | grep <span class="hljs-string">&#x27;.txt$&#x27;</span><br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å°†è¿”å›æŒ‡å®šç›®å½•â€&#x2F;somedirâ€ä¸‹æ‰€æœ‰ä»¥â€.txtâ€ç»“å°¾çš„æ–‡ä»¶ã€‚</p><h2 id="17-regex"><a href="#17-regex" class="headerlink" title="17 regex"></a>17 regex</h2><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ç§å¼ºå¤§çš„æ¨¡å¼åŒ¹é…å·¥å…·ï¼Œå®ƒä½¿ç”¨ç‰¹æ®Šç¬¦å·è¿›è¡Œé€‰æ‹©ï¼Œç±»ä¼¼äºæˆ‘ä»¬å·²ç»é‡åˆ°çš„é€šé…ç¬¦*ç­‰ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å‡ ä¹åœ¨æ‰€æœ‰ç¼–ç¨‹è¯­è¨€ä¸­éƒ½é€šç”¨çš„å¸¸è§æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹çŸ­è¯­ä½œä¸ºæµ‹è¯•å­—ç¬¦ä¸²ï¼š</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">sally sells seashells <br><span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> seashore<br></code></pre></td></tr></table></figure><ol><li>ä½¿ç”¨^è¡¨ç¤ºè¡Œçš„å¼€å§‹</li></ol><p>ä¾‹å¦‚ï¼Œ<code>^by</code>å°†åŒ¹é…â€œby the seashoreâ€è¿™ä¸€è¡Œã€‚</p><ol start="2"><li>ä½¿ç”¨$è¡¨ç¤ºè¡Œçš„ç»“æŸ</li></ol><p>ä¾‹å¦‚ï¼Œ<code>seashore$</code>åŒæ ·åŒ¹é…â€œby the seashoreâ€è¿™ä¸€è¡Œã€‚</p><ol start="3"><li>ä½¿ç”¨.åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</li></ol><p>ä¾‹å¦‚ï¼Œ<code>b.</code>èƒ½å¤ŸåŒ¹é…â€œbyâ€ã€‚</p><ol start="4"><li>ä½¿ç”¨[]è¿›è¡Œæ‹¬å·æ ‡è®°</li></ol><p>è¿™å¯èƒ½ç¨å¾®å¤æ‚ä¸€äº›ã€‚æ–¹æ‹¬å·å…è®¸æˆ‘ä»¬æŒ‡å®šå‡ºç°åœ¨å…¶ä¸­çš„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ</p><ul><li><code>d[iou]g</code>å¯ä»¥åŒ¹é…â€œdigâ€ã€â€œdogâ€ã€â€œdugâ€ã€‚</li><li>å½“^ä½äºæ–¹æ‹¬å·å†…æ—¶ï¼Œè¡¨ç¤ºåŒ¹é…ä¸åœ¨æ–¹æ‹¬å·å†…çš„ä»»ä½•å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>d[^i]g</code>èƒ½åŒ¹é…â€œdogâ€å’Œâ€œdugâ€ï¼Œä½†ä¸åŒ¹é…â€œdigâ€ã€‚</li><li>æ–¹æ‹¬å·è¿˜æ”¯æŒèŒƒå›´æ¥æ‰©å±•å¯åŒ¹é…å­—ç¬¦çš„æ•°é‡ã€‚å¦‚<code>d[a-c]g</code>å°†åŒ¹é…â€œdagâ€ã€â€œdbgâ€å’Œâ€œdcgâ€ã€‚</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–¹æ‹¬å·æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼š</p><ul><li><code>d[A-C]g</code>å°†åŒ¹é…â€œdAgâ€ã€â€œdBgâ€å’Œâ€œdCgâ€ï¼Œä½†ä¸åŒ¹é…â€œdagâ€ã€â€œdbgâ€å’Œâ€œdcgâ€ã€‚</li></ul><p>ä»¥ä¸Šæ˜¯ä¸€äº›åŸºç¡€çš„æ­£åˆ™è¡¨è¾¾å¼çš„åº”ç”¨ã€‚</p><h2 id="18-vim"><a href="#18-vim" class="headerlink" title="18 vim"></a>18 vim</h2><h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><p>åœ¨ Vim ç¼–è¾‘å™¨ä¸­æ‰§è¡Œæœç´¢æ—¶ï¼Œåªéœ€é”®å…¥æ–œæ ï¼ˆ&#x2F;ï¼‰ç„¶åè¾“å…¥ä½ çš„æœç´¢å†…å®¹å³å¯ã€‚æŒ‰ä¸‹å›è½¦åï¼Œå¯ä»¥æŒ‰â€œnâ€é”®å‘å‰æˆ–â€œNâ€é”®å‘åæµè§ˆæœç´¢ç»“æœã€‚</p><p>ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹æ–‡æœ¬ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">My pretty <span class="hljs-built_in">file</span> <span class="hljs-keyword">is</span> very pretty.<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>/pretty</code> å°†ä¼šæ‰¾åˆ°æ–‡æœ¬ä¸­çš„ â€œprettyâ€ ä¸€è¯ã€‚</p><p>å¦å¤–ï¼Œä½¿ç”¨ <code>?</code> å‘½ä»¤å¯ä»¥åå‘æœç´¢æ–‡æ¡£ã€‚</p><h3 id="ç¼–è¾‘"><a href="#ç¼–è¾‘" class="headerlink" title="ç¼–è¾‘"></a>ç¼–è¾‘</h3><p>ä¸€äº›å¸¸ç”¨çš„è¿›å…¥æ’å…¥æ¨¡å¼çš„æ–¹æ³•ï¼š</p><ul><li><code>i</code>: åœ¨å…‰æ ‡å‰æ’å…¥æ–‡æœ¬ã€‚</li><li><code>O</code>: åœ¨ä¸Šä¸€è¡Œæ’å…¥æ–‡æœ¬ã€‚</li><li><code>o</code>: åœ¨ä¸‹ä¸€è¡Œæ’å…¥æ–‡æœ¬ã€‚</li><li><code>a</code>: åœ¨å…‰æ ‡åè¿½åŠ æ–‡æœ¬ã€‚</li><li><code>A</code>: åœ¨è¡Œå°¾è¿½åŠ æ–‡æœ¬ã€‚</li></ul><p>å‡ ä¸ªå¸¸ç”¨çš„ç¼–è¾‘å‘½ä»¤ï¼š</p><ul><li><code>x</code>ï¼šç”¨äºåˆ é™¤å…‰æ ‡æ‰€åœ¨ä½ç½®çš„å­—ç¬¦ï¼Œä¹Ÿå¯ç”¨äºåˆ é™¤å·²é€‰ä¸­çš„æ–‡æœ¬ã€‚</li><li><code>dd</code>ï¼šåˆ é™¤å½“å‰è¡Œã€‚</li><li><code>y</code>ï¼šå¤åˆ¶é€‰ä¸­çš„æ–‡æœ¬ã€‚ä½¿ç”¨æ—¶ï¼Œå…ˆé€šè¿‡å…¶ä»–å‘½ä»¤ï¼ˆå¦‚ <code>v</code> è§†è§‰æ¨¡å¼ï¼‰é€‰æ‹©æ–‡æœ¬ï¼Œç„¶åæŒ‰ <code>y</code> å¤åˆ¶ã€‚</li><li><code>yy</code>ï¼šç›´æ¥å¤åˆ¶å½“å‰è¡Œã€‚</li><li><code>p</code>ï¼šåœ¨å…‰æ ‡ä½ç½®ä¹‹å‰ç²˜è´´å·²å¤åˆ¶çš„æ–‡æœ¬ã€‚</li></ul><h3 id="ä¿å­˜"><a href="#ä¿å­˜" class="headerlink" title="ä¿å­˜"></a>ä¿å­˜</h3><p>ä½¿ç”¨ <code>ZZ</code> ä»£æ›¿ <code>:wq</code></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[Linux]Command Line</title>
    <link href="/2025/03/18/Linux-Command-Line/"/>
    <url>/2025/03/18/Linux-Command-Line/</url>
    
    <content type="html"><![CDATA[<h1 id="Command-Line"><a href="#Command-Line" class="headerlink" title="Command Line"></a>Command Line</h1><h2 id="1-The-shell"><a href="#1-The-shell" class="headerlink" title="1 The shell"></a>1 The shell</h2><p>ShellåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç¨‹åºï¼Œå®ƒæ¥æ”¶æ¥è‡ªé”®ç›˜çš„å‘½ä»¤å¹¶å‘é€ç»™æ“ä½œç³»ç»Ÿå»æ‰§è¡Œã€‚</p><p>å‡ ä¹æ‰€æœ‰çš„Linuxå‘è¡Œç‰ˆéƒ½ä¼šé»˜è®¤ä½¿ç”¨bash shellã€‚è¿˜æœ‰å…¶ä»–å¯ç”¨çš„shellï¼Œå¦‚kshã€zshã€tschç­‰ã€‚</p><h2 id="2-Linux-å‘½ä»¤"><a href="#2-Linux-å‘½ä»¤" class="headerlink" title="2 Linux å‘½ä»¤"></a>2 Linux å‘½ä»¤</h2><h3 id="pwd-print-working-directory"><a href="#pwd-print-working-directory" class="headerlink" title="pwd(print working directory)"></a><strong>pwd(print working directory)</strong></h3><p>åœ¨Linuxä¸­ï¼Œæ‰€æœ‰çš„ä¸€åˆ‡éƒ½è¢«è§†ä¸ºæ–‡ä»¶ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æ˜¯ä»¥å±‚æ¬¡ç›®å½•æ ‘çš„å½¢å¼ç»„ç»‡çš„ã€‚æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªç›®å½•è¢«ç§°ä¸ºæ ¹ç›®å½•ã€‚æ ¹ç›®å½•åŒ…å«è®¸å¤šæ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼Œä½ å¯ä»¥å­˜å‚¨æ›´å¤šçš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ç­‰ã€‚</p><p>æŸ¥çœ‹å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨pwdå‘½ä»¤ï¼Œå®ƒä¼šæ˜¾ç¤ºæ‰€åœ¨çš„ç›®å½•ï¼Œæ³¨æ„è·¯å¾„æ˜¯ä»æ ¹ç›®å½•å¼€å§‹çš„ã€‚</p><p><img src="/../images/Linux-Command-Line/image-20250318212300940.png"></p><h3 id="cd-change-directory"><a href="#cd-change-directory" class="headerlink" title="cd(change directory)"></a><strong>cd(change directory)</strong></h3><p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æŒ‡å®šè·¯å¾„ï¼šç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ã€‚</p><p><strong>ç»å¯¹è·¯å¾„</strong>ï¼šè¿™æ˜¯ä»æ ¹ç›®å½•å¼€å§‹çš„è·¯å¾„ã€‚æ ¹ç›®å½•æ˜¯èµ·ç‚¹ï¼Œé€šå¸¸ç”¨ä¸€ä¸ªæ–œæ è¡¨ç¤ºã€‚æ¯å½“çœ‹åˆ°è·¯å¾„ä»¥&#x2F;å¼€å¤´ï¼Œå°±æ„å‘³ç€æ˜¯ä»æ ¹ç›®å½•å¼€å§‹çš„ã€‚</p><p><strong>ç›¸å¯¹è·¯å¾„</strong>ï¼šè¿™æ˜¯æ ¹æ®å½“å‰åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®è€Œå®šçš„è·¯å¾„ã€‚</p><p>ä¸€äº›å¿«æ·æ–¹å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">.  # å½“å‰ç›®å½• <br>.. # ä¸Šçº§ç›®å½•<br>~  # ä¸»ç›®å½•<br>-  # ä¹‹å‰çš„ç›®å½•<br></code></pre></td></tr></table></figure><h3 id="ls-list-directories"><a href="#ls-list-directories" class="headerlink" title="ls(list directories)"></a>ls(list directories)</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ls</code>å‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼Œä½†ä½ ä¹Ÿå¯ä»¥æŒ‡å®šæƒ³è¦æŸ¥çœ‹çš„è·¯å¾„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹<code>/home/pete</code>ç›®å½•ä¸‹çš„å†…å®¹ï¼Œå¯ä»¥è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> /home/pete<br></code></pre></td></tr></table></figure><p><code>ls</code>æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·ï¼Œå®ƒä¸ä»…åˆ—å‡ºäº†æ–‡ä»¶å’Œç›®å½•ï¼Œè¿˜èƒ½å±•ç¤ºå…³äºå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶éæ‰€æœ‰æ–‡ä»¶éƒ½ç›´æ¥å¯è§ã€‚ä»¥<code>.</code>å¼€å¤´çš„æ–‡ä»¶åè¢«è§†ä¸ºéšè—æ–‡ä»¶ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ <code>-a</code>æ ‡å¿—ï¼ˆä»£è¡¨â€œallâ€ï¼‰æ¥æŸ¥çœ‹è¿™äº›éšè—æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -a<br></code></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªæœ‰ç”¨çš„é€‰é¡¹æ˜¯<code>-l</code>ï¼ˆä»£è¡¨â€œlongâ€ï¼‰ï¼Œå®ƒä»¥é•¿æ ¼å¼å±•ç¤ºæ–‡ä»¶çš„è¯¦ç»†åˆ—è¡¨ã€‚è¿™åŒ…æ‹¬ä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼šæ–‡ä»¶æƒé™ã€é“¾æ¥æ•°ã€æ‰€æœ‰è€…åç§°ã€æ‰€å±ç¾¤ç»„ã€æ–‡ä»¶å¤§å°ã€æœ€åä¿®æ”¹æ—¶é—´æˆ³ä»¥åŠæ–‡ä»¶æˆ–ç›®å½•åç§°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="/../images/Linux-Command-Line/image-20250318213022267.png"></p><p>å‘½ä»¤é€šå¸¸åŒ…å«ä¸€äº›æ ‡å¿—ï¼ˆä¹Ÿç§°ä¸ºå‚æ•°æˆ–é€‰é¡¹ï¼‰ï¼Œç”¨ä»¥å¢åŠ å…¶åŠŸèƒ½ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>-a</code>å’Œ<code>-l</code>ç»“åˆä½¿ç”¨ï¼Œæ— è®ºæ˜¯<code>-la</code>è¿˜æ˜¯<code>-al</code>ï¼Œé¡ºåºå¹¶ä¸é‡è¦ï¼Œä¸¤è€…éƒ½ä¼šç”Ÿæ•ˆã€‚</p><h3 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h3><p>ä½¿ç”¨<code>touch</code>å‘½ä»¤ï¼Œå¯ä»¥åˆ›å»ºæ–°çš„ç©ºæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">touch</span> mysuperduperfile<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œ<code>touch</code>å‘½ä»¤è¿˜å¯ä»¥ç”¨äºæ›´æ–°ç°æœ‰æ–‡ä»¶æˆ–ç›®å½•çš„æ—¶é—´æˆ³ã€‚</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>åœ¨Linuxä¸­ï¼Œæ–‡ä»¶åä¸éœ€è¦åæ˜ æ–‡ä»¶çš„å®é™…å†…å®¹ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>funny.gif</code>çš„æ–‡ä»¶ï¼Œä½†å®é™…ä¸Šå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªGIFæ ¼å¼çš„æ–‡ä»¶ã€‚</p><p>ä¸ºäº†ç¡®å®šä¸€ä¸ªæ–‡ä»¶çš„çœŸå®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨<code>file</code>å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºæ–‡ä»¶å†…å®¹çš„æè¿°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ file banana.jpg<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å‡†ç¡®åœ°äº†è§£æ–‡ä»¶çš„å®é™…ç±»å‹ï¼Œé¿å…å› ä¸ºæ–‡ä»¶åçš„è¯¯å¯¼è€Œäº§ç”Ÿæ··æ·†ã€‚</p><h3 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h3><p><code>cat</code>å‘½ä»¤ï¼Œå®ƒæ˜¯â€œconcatenateâ€çš„ç¼©å†™ã€‚æ­¤å‘½ä»¤ä¸ä»…å¯ä»¥æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼Œè¿˜èƒ½åˆå¹¶å¤šä¸ªæ–‡ä»¶å¹¶å±•ç¤ºå®ƒä»¬çš„è¾“å‡ºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> dogfile birdfile<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>cat</code>å‘½ä»¤ä¸é€‚ç”¨äºæŸ¥çœ‹å¤§å‹æ–‡ä»¶ï¼Œå®ƒä¸»è¦é’ˆå¯¹ç®€çŸ­çš„å†…å®¹ã€‚</p><h3 id="less"><a href="#less" class="headerlink" title="less"></a>less</h3><p>å½“æŸ¥çœ‹çš„å†…å®¹è¶…å‡ºç®€å•çš„è¾“å‡ºèŒƒå›´æ—¶ï¼Œ<code>less</code>æ¯”<code>more</code>æ›´ä¸ºé€‚ç”¨ã€‚æ–‡æœ¬ä»¥åˆ†é¡µæ–¹å¼æ˜¾ç¤ºï¼Œå…è®¸ç”¨æˆ·é€é¡µæµè§ˆæ–‡ä»¶å†…å®¹ã€‚</p><p>ä½¿ç”¨<code>less</code>æŸ¥çœ‹æ–‡ä»¶å†…å®¹æ—¶ï¼Œå¯ä»¥é€šè¿‡å¤šç§é”®ç›˜å‘½ä»¤åœ¨æ–‡ä»¶å†…è¿›è¡Œå¯¼èˆªï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ less /home/pete/Documents/text1<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯åœ¨<code>less</code>ä¸­å¯¼èˆªçš„æ“ä½œæŒ‡ä»¤ï¼š</p><ul><li><code>q</code>ï¼šé€€å‡º<code>less</code>è¿”å›shellã€‚</li><li>æ–¹å‘é”®ä¸Šä¸‹ã€Page Upã€Page Downï¼šé€šè¿‡ç®­å¤´æˆ–ç¿»é¡µé”®è¿›è¡Œä¸Šä¸‹æ»šåŠ¨ã€‚</li><li><code>g</code>ï¼šç§»è‡³æ–‡æœ¬æ–‡ä»¶å¼€å¤´ã€‚</li><li><code>G</code>ï¼šç§»è‡³æ–‡æœ¬æ–‡ä»¶æœ«å°¾ã€‚</li><li><code>/æœç´¢è¯</code>ï¼šå¯åœ¨æ–‡æ¡£å†…æŸ¥æ‰¾ç‰¹å®šæ–‡æœ¬ï¼Œè¾“å…¥æ–œæ åç´§è·Ÿæƒ³è¦æŸ¥æ‰¾çš„è¯è¯­ã€‚</li><li><code>h</code>ï¼šè‹¥éœ€è¦å…³äºå¦‚ä½•ä½¿ç”¨<code>less</code>çš„å¸®åŠ©ï¼Œå¯ä»¥åœ¨<code>less</code>ä¸­è°ƒç”¨å¸®åŠ©ä¿¡æ¯ã€‚</li></ul><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>åœ¨Shellä¸­ï¼Œæœ‰ä¸€ä¸ªä¹‹å‰æ‰§è¡Œå‘½ä»¤çš„å†å²è®°å½•ï¼Œå¯ä»¥ç”¨æ¥æŸ¥æ‰¾å¹¶é‡æ–°è¿è¡Œä¹‹å‰çš„å‘½ä»¤ï¼Œè€Œæ— éœ€å†æ¬¡æ‰‹åŠ¨è¾“å…¥ã€‚</p><ul><li>æŸ¥çœ‹å‘½ä»¤å†å²ï¼šé€šè¿‡<code>history</code>å‘½ä»¤æŸ¥çœ‹å·²æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚</li><li>é‡å¤ä¸Šä¸€ä¸ªå‘½ä»¤ï¼šåªéœ€æŒ‰å‘ä¸Šç®­å¤´é”®å³å¯æµè§ˆå¹¶é€‰æ‹©ä¹‹å‰çš„å‘½ä»¤æ‰§è¡Œã€‚</li><li>å¿«é€Ÿæ‰§è¡Œæœ€åä¸€æ¡å‘½ä»¤ï¼šä½¿ç”¨<code>!!</code>æ¥å¿«é€Ÿæ‰§è¡Œæœ€è¿‘ä¸€æ¬¡æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¹‹å‰æ‰§è¡Œäº†<code>cat file1</code>ï¼Œç°åœ¨æƒ³å†æ¬¡æ‰§è¡Œï¼Œåªéœ€è¾“å…¥<code>!!</code>å³å¯ã€‚</li></ul><p>å¦ä¸€ä¸ªå¿«æ·æ–¹å¼æ˜¯ä½¿ç”¨<code>Ctrl+R</code>è¿›è¡Œåå‘æœç´¢ã€‚å½“æŒ‰ä¸‹<code>Ctrl+R</code>åå¼€å§‹è¾“å…¥å‘½ä»¤çš„éƒ¨åˆ†å†…å®¹ï¼Œå®ƒä¼šæ˜¾ç¤ºåŒ¹é…é¡¹ï¼Œå¹¶å¯ä»¥é€šè¿‡å†æ¬¡æŒ‰ä¸‹<code>Ctrl+R</code>æ¥å¾ªç¯æµè§ˆè¿™äº›åŒ¹é…é¡¹ã€‚æ‰¾åˆ°ç›®æ ‡å‘½ä»¤åï¼ŒæŒ‰Enteré”®å³å¯æ‰§è¡Œã€‚</p><h3 id="cp-copy"><a href="#cp-copy" class="headerlink" title="cp(copy)"></a>cp(copy)</h3><ul><li><p>å¤åˆ¶å•ä¸ªæ–‡ä»¶ï¼šä½¿ç”¨<code>cp</code>å‘½ä»¤å°†æ–‡ä»¶ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚ä¾‹å¦‚ï¼Œè¦å°†<code>mycoolfile</code>å¤åˆ¶åˆ°<code>/home/pete/Documents/cooldocs</code>ç›®å½•ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cp</span> mycoolfile /home/pete/Documents/cooldocs<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨é€šé…ç¬¦æ‰¹é‡å¤åˆ¶ï¼šé€šé…ç¬¦å…è®¸åŸºäºæ¨¡å¼åŒ¹é…é€‰æ‹©æ–‡ä»¶ï¼Œå¢åŠ äº†æœç´¢çš„çµæ´»æ€§ã€‚å¸¸è§é€šé…ç¬¦åŒ…æ‹¬ï¼š</p><ul><li><code>*</code>ï¼šä»£è¡¨ä»»æ„é•¿åº¦çš„å­—ç¬¦ã€‚</li><li><code>?</code>ï¼šä»£è¡¨å•ä¸€å­—ç¬¦ã€‚</li><li><code>[]</code>ï¼šä»£è¡¨æ–¹æ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå¤åˆ¶å½“å‰ç›®å½•ä¸‹æ‰€æœ‰<code>.jpg</code>æ–‡ä»¶åˆ°<code>Pictures</code>ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cp</span> *.jpg /home/pete/Pictures<br></code></pre></td></tr></table></figure></li><li><p>é€’å½’å¤åˆ¶ï¼šä½¿ç”¨<code>-r</code>æ ‡å¿—å¯ä»¥é€’å½’åœ°å¤åˆ¶æ–‡ä»¶å’Œç›®å½•ã€‚è¿™å¯¹äºéœ€è¦å°†æ•´ä¸ªç›®å½•åŠå…¶å†…å®¹ä¸€å¹¶å¤åˆ¶çš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå°†<code>Pumpkin</code>ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹å¤åˆ¶åˆ°<code>Documents</code>ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cp</span> -r Pumpkin/ /home/pete/Documents<br></code></pre></td></tr></table></figure></li></ul><p>æ³¨æ„ï¼Œåœ¨å‘å·²æœ‰åŒåæ–‡ä»¶çš„ç›®å½•ä¸­å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œè‹¥ä¸å¸Œæœ›æ„å¤–è¦†ç›–åŸæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>-i</code>æ ‡å¿—ï¼Œå®ƒä¼šåœ¨è¦†ç›–å‰æç¤ºç¡®è®¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cp</span> -i mycoolfile /home/pete/Pictures<br></code></pre></td></tr></table></figure><h3 id="mv-move"><a href="#mv-move" class="headerlink" title="mv(move)"></a>mv(move)</h3><p><code>mv</code>å‘½ä»¤ç”¨äºç§»åŠ¨æ–‡ä»¶æˆ–é‡å‘½åæ–‡ä»¶ï¼Œå…¶æ ‡å¿—å’ŒåŠŸèƒ½ä¸<code>cp</code>å‘½ä»¤ç›¸ä¼¼ã€‚</p><ul><li><p>é‡å‘½åæ–‡ä»¶ï¼šä½¿ç”¨<code>mv</code>å‘½ä»¤å¯ä»¥å°†æ–‡ä»¶é‡å‘½åã€‚ä¾‹å¦‚ï¼Œå°†<code>oldfile</code>é‡å‘½åä¸º<code>newfile</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mv</span> oldfile newfile<br></code></pre></td></tr></table></figure></li><li><p>ç§»åŠ¨æ–‡ä»¶ï¼šä¹Ÿå¯ä»¥ä½¿ç”¨<code>mv</code>å‘½ä»¤å°†æ–‡ä»¶ç§»åŠ¨åˆ°ä¸åŒçš„ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå°†<code>file2</code>ç§»åŠ¨åˆ°<code>/home/pete/Documents</code>ç›®å½•ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mv</span> file2 /home/pete/Documents<br></code></pre></td></tr></table></figure></li><li><p>ç§»åŠ¨å¤šä¸ªæ–‡ä»¶ï¼šä¸€æ¬¡ç§»åŠ¨å¤šä¸ªæ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ã€‚ä¾‹å¦‚ï¼Œå°†<code>file_1</code>å’Œ<code>file_2</code>ç§»åŠ¨åˆ°<code>somedirectory</code>ç›®å½•ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mv</span> file_1 file_2 /somedirectory<br></code></pre></td></tr></table></figure></li><li><p>é‡å‘½åç›®å½•ï¼šåŒæ ·é€‚ç”¨äºç›®å½•çš„é‡å‘½åã€‚ä¾‹å¦‚ï¼Œå°†<code>directory1</code>é‡å‘½åä¸º<code>directory2</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mv</span> directory1 directory2<br></code></pre></td></tr></table></figure></li></ul><p>æ³¨æ„ï¼Œå½“ç›®æ ‡ç›®å½•ä¸­å·²å­˜åœ¨åŒåæ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œ<code>mv</code>å‘½ä»¤ä¼šè¦†ç›–å®ƒä»¬ã€‚ä¸ºäº†é¿å…è¯¯æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨<code>-i</code>æ ‡å¿—åœ¨è¦†ç›–å‰è¿›è¡Œæç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mv</span> -i directory1 directory2<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè‹¥å¸Œæœ›åœ¨è¦†ç›–æ–‡ä»¶æ—¶åˆ›å»ºå¤‡ä»½ï¼Œå¯ä»¥ä½¿ç”¨<code>-b</code>æ ‡å¿—ï¼Œè¿™æ ·æ—§ç‰ˆæœ¬çš„æ–‡ä»¶å°†ä¼šè¢«è‡ªåŠ¨é‡å‘½åä¸ºå¸¦æœ‰æ³¢æµªå·ï¼ˆ~ï¼‰åç¼€çš„å½¢å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mv</span> -b directory1 directory2<br></code></pre></td></tr></table></figure><p>è¿™ç§æœºåˆ¶ç¡®ä¿äº†æ•°æ®çš„å®‰å…¨æ€§ï¼Œå³ä½¿åœ¨æ‰§è¡Œå¯èƒ½è¦†ç›–ç°æœ‰æ–‡ä»¶çš„æ“ä½œæ—¶ä¹Ÿèƒ½ä¿ç•™åŸå§‹æ–‡ä»¶çš„å‰¯æœ¬ã€‚</p><h3 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h3><p><code>mkdir</code>å‘½ä»¤ï¼ˆMake Directoryï¼‰åœ¨ä¸å­˜åœ¨æ—¶åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚å¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªç›®å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mkdir</span> books paintings<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>-p</code>é€‰é¡¹ï¼ˆçˆ¶ç›®å½•æ ‡å¿—ï¼‰ï¼Œè¿˜å¯ä»¥ä¸€æ¬¡æ€§åˆ›å»ºå­ç›®å½•ç»“æ„ã€‚è¿™å¯¹äºåˆ›å»ºæ·±å±‚åµŒå¥—çš„ç›®å½•å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸º<code>-p</code>é€‰é¡¹ä¼šè‡ªåŠ¨åˆ›å»ºæ‰€æœ‰å¿…è¦çš„çˆ¶ç›®å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mkdir</span> -p books/hemingway/favorites<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤å°†åˆ›å»º<code>books</code>ç›®å½•ï¼ˆå¦‚æœå®ƒå°šä¸å­˜åœ¨ï¼‰ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»º<code>hemingway</code>å­ç›®å½•ï¼Œå¹¶æœ€ç»ˆåœ¨<code>hemingway</code>ç›®å½•ä¸­åˆ›å»º<code>favorites</code>å­ç›®å½•ã€‚æ­¤æ–¹æ³•ç¡®ä¿äº†å³ä½¿æŒ‡å®šè·¯å¾„ä¸­çš„æŸäº›ç›®å½•å·²å­˜åœ¨ï¼Œä¹Ÿä¸ä¼šå¼•å‘é”™è¯¯ï¼Œä½¿å¾—ç›®å½•åˆ›å»ºè¿‡ç¨‹æ›´åŠ æµç•…å’Œé«˜æ•ˆã€‚</p><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><p><code>rm</code>ï¼ˆremoveï¼‰å‘½ä»¤ç”¨äºåˆ é™¤æ–‡ä»¶å’Œç›®å½•ã€‚</p><p>åŸºç¡€çš„æ–‡ä»¶åˆ é™¤æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">rm</span> file1<br></code></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨<code>rm</code>å‘½ä»¤æ—¶éœ€æ ¼å¤–å°å¿ƒï¼Œå› ä¸ºä¸€æ—¦æ–‡ä»¶è¢«åˆ é™¤ï¼Œå®ƒä»¬å°†ä¸å¯æ¢å¤ã€‚å› æ­¤ï¼Œæ“ä½œæ—¶åŠ¡å¿…è°¨æ…ã€‚</p><p>ç³»ç»Ÿä¸ºé˜²æ­¢è¯¯åˆ é‡è¦æ–‡ä»¶ï¼Œå·²å†…ç½®äº†ä¸€äº›å®‰å…¨æªæ–½ã€‚ä¾‹å¦‚ï¼Œå†™ä¿æŠ¤çš„æ–‡ä»¶åœ¨åˆ é™¤å‰ä¼šæç¤ºç¡®è®¤ï¼›åŒæ ·åœ°ï¼Œå†™ä¿æŠ¤çš„ç›®å½•ä¹Ÿä¸ä¼šè½»æ˜“è¢«ç§»é™¤ã€‚</p><p>å¦‚æœç¡®å®éœ€è¦å¼ºåˆ¶åˆ é™¤æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¸¦æœ‰<code>-f</code>ï¼ˆforceï¼‰é€‰é¡¹çš„å‘½ä»¤ï¼Œå®ƒä¼šå¿½ç•¥å†™ä¿æŠ¤ï¼Œä¸æç¤ºç”¨æˆ·ç›´æ¥åˆ é™¤æ–‡ä»¶ï¼ˆåªè¦æ‹¥æœ‰ç›¸åº”çš„æƒé™ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">rm</span> -f file1<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>-i</code>é€‰é¡¹å¯ä½¿åˆ é™¤è¿‡ç¨‹æ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå®ƒä¼šåœ¨åˆ é™¤æ¯ä¸ªæ–‡ä»¶å‰æç¤ºç¡®è®¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">rm</span> -i file<br></code></pre></td></tr></table></figure><p>è¦åˆ é™¤ä¸€ä¸ªåŒ…å«æ–‡ä»¶æˆ–å­ç›®å½•çš„ç›®å½•ï¼Œåˆ™éœ€è¦æ·»åŠ <code>-r</code>ï¼ˆrecursiveï¼‰æ ‡å¿—ä»¥é€’å½’æ–¹å¼åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">rm</span> -r directory<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå¯¹äºç©ºç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨<code>rmdir</code>å‘½ä»¤è¿›è¡Œåˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">rmdir</span> directory<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>rmdir</code>ä»…èƒ½åˆ é™¤ç©ºç›®å½•ï¼Œè‹¥ç›®å½•ä¸­åŒ…å«ä»»ä½•æ–‡ä»¶æˆ–å…¶ä»–å­ç›®å½•ï¼Œåˆ™å¿…é¡»ä½¿ç”¨<code>rm -r</code>å‘½ä»¤è¿›è¡Œåˆ é™¤ã€‚è¿™äº›æ–¹æ³•ç¡®ä¿äº†æ–‡ä»¶ç³»ç»Ÿçš„æ•´æ´ä¸ç®¡ç†çš„æœ‰æ•ˆæ€§ã€‚</p><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><p>åœ¨ç³»ç»Ÿä¸­ç®¡ç†å¤§é‡æ–‡ä»¶æ—¶ï¼ŒæŸ¥æ‰¾ç‰¹å®šæ–‡ä»¶å¯èƒ½ä¼šå˜å¾—æœ‰äº›æ£˜æ‰‹ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>find</code>å‘½ä»¤æ¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚</p><p>è¦æŸ¥æ‰¾ä¸€ä¸ªåä¸º<code>puppies.jpg</code>çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ find /home -name puppies.jpg<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤å…è®¸æŒ‡å®šè¦æœç´¢çš„ç›®å½•ï¼ˆåœ¨æ­¤ä¾‹ä¸­ä¸º<code>/home</code>ï¼‰ï¼Œä»¥åŠæ­£åœ¨å¯»æ‰¾çš„æ–‡ä»¶åï¼ˆ<code>puppies.jpg</code>ï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡æŒ‡å®šæ–‡ä»¶ç±»å‹æ¥ç²¾ç¡®æŸ¥æ‰¾ç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œè‹¥è¦æŸ¥æ‰¾åä¸º<code>MyFolder</code>çš„ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ find /home -<span class="hljs-built_in">type</span> d -name MyFolder<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®<code>-type</code>é€‰é¡¹ä¸º<code>d</code>æ¥æŒ‡æ˜æ­£åœ¨å¯»æ‰¾çš„æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¹¶ç»§ç»­æŒ‰åç§°<code>MyFolder</code>è¿›è¡Œæœç´¢ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>find</code>å‘½ä»¤ä¸ä»…ä¼šåœ¨æŒ‡å®šç›®å½•ä¸­æŸ¥æ‰¾ï¼Œè¿˜ä¼šé€’å½’åœ°æ£€æŸ¥è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•ã€‚</p><h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><p>Linuxç³»ç»Ÿå†…ç½®äº†ä¸€äº›ä¼˜ç§€çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·äº†è§£å¦‚ä½•ä½¿ç”¨å‘½ä»¤æˆ–æ£€æŸ¥å‘½ä»¤å¯ç”¨çš„æ ‡å¿—é€‰é¡¹ã€‚å…¶ä¸­ä¸€ä¸ªå·¥å…·æ˜¯<code>help</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå†…ç½®åœ¨bashä¸­çš„å‘½ä»¤ï¼Œä¸ºå…¶ä»–bashå‘½ä»¤ï¼ˆå¦‚<code>echo</code>ã€<code>logout</code>ã€<code>pwd</code>ç­‰ï¼‰æä¾›å¸®åŠ©ä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦è·å–<code>echo</code>å‘½ä»¤çš„å¸®åŠ©ï¼Œå¯ä»¥è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">help</span> <span class="hljs-built_in">echo</span><br></code></pre></td></tr></table></figure><p>è¿™å°†æä¾›å…³äº<code>echo</code>å‘½ä»¤çš„æè¿°ä»¥åŠå¯ä»¥ä½¿ç”¨çš„é€‰é¡¹ã€‚å¯¹äºå…¶ä»–çš„å¯æ‰§è¡Œç¨‹åºï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªç§°ä¸º<code>--help</code>çš„é€‰é¡¹æˆ–å…¶ä»–ç±»ä¼¼é€‰é¡¹æ¥æä¾›å¸®åŠ©ä¿¡æ¯ã€‚</p><p>ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰å¼€å‘è€…å‘å¸ƒçš„å¯æ‰§è¡Œæ–‡ä»¶éƒ½ä¼šéµå¾ªè¿™ä¸€çº¦å®šã€‚å°½ç®¡å¦‚æ­¤ï¼Œå°è¯•ä½¿ç”¨<code>--help</code>ä»ç„¶æ˜¯æŸ¥æ‰¾ç¨‹åºå¸®åŠ©ä¿¡æ¯çš„æœ€ä½³æ–¹å¼ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> --<span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure><h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><p>åœ¨Linuxä¸­ï¼Œè®¸å¤šç¨‹åºé…æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥é˜…ã€‚è¿™äº›æ–‡æ¡£è¢«ç§°ä¸ºæ‰‹å†Œé¡µï¼ˆman pagesï¼‰ï¼Œé€šè¿‡<code>man</code>å‘½ä»¤å¯ä»¥è®¿é—®å…³äºæŸä¸ªå‘½ä»¤çš„æ‰‹å†Œã€‚</p><p>ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹<code>ls</code>å‘½ä»¤çš„æ‰‹å†Œï¼Œå¯ä»¥è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ man <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>æ‰‹å†Œé¡µæ˜¯é»˜è®¤é›†æˆåˆ°å¤§å¤šæ•°Linuxæ“ä½œç³»ç»Ÿä¸­çš„æ–‡æ¡£ï¼Œæä¾›äº†å…³äºå‘½ä»¤åŠå…¶ä»–ç³»ç»Ÿæ–¹é¢çš„è¯¦ç»†è¯´æ˜ã€‚</p><h3 id="whatis"><a href="#whatis" class="headerlink" title="whatis"></a>whatis</h3><p>å¦‚æœå¯¹æŸä¸ªå‘½ä»¤çš„åŠŸèƒ½æ„Ÿåˆ°ä¸ç¡®å®šï¼Œå¯ä»¥ä½¿ç”¨<code>whatis</code>å‘½ä»¤æ¥è·å–å¸®åŠ©ã€‚<code>whatis</code>å‘½ä»¤æä¾›äº†å…³äºå‘½ä»¤è¡Œç¨‹åºçš„ç®€çŸ­æè¿°ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦æŸ¥çœ‹<code>cat</code>å‘½ä»¤çš„ç›¸å…³æè¿°ï¼Œå¯ä»¥è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatis <span class="hljs-built_in">cat</span><br></code></pre></td></tr></table></figure><p>è¯¥æè¿°æºè‡ªæ¯ä¸ªå‘½ä»¤çš„æ‰‹å†Œé¡µã€‚æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œæ‚¨å°†çœ‹åˆ°ä¸€æ®µç®€æ´çš„æè¿°ï¼Œä»‹ç»<code>cat</code>å‘½ä»¤çš„ä½œç”¨ã€‚</p><h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><p>è¦ä¸ºå‘½ä»¤åˆ›å»ºåˆ«åï¼Œåªéœ€æŒ‡å®šä¸€ä¸ªåˆ«åå¹¶å°†å…¶è®¾ç½®ä¸ºç›¸åº”çš„å‘½ä»¤å³å¯ã€‚</p><p>ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>foobar</code>çš„åˆ«åç”¨äºæ‰§è¡Œ<code>ls -la</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">alias</span> foobar=<span class="hljs-string">&#x27;ls -la&#x27;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥<code>foobar</code>æ¥æ‰§è¡Œ<code>ls -la</code>å‘½ä»¤ã€‚æ³¨æ„ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºçš„åˆ«ååœ¨ç³»ç»Ÿé‡å¯åä¸ä¼šä¿å­˜ï¼Œå› æ­¤å¦‚æœå¸Œæœ›åˆ«åæŒä¹…åŒ–ï¼Œéœ€è¦å°†å®ƒä»¬æ·»åŠ åˆ°ä»¥ä¸‹æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/.bashrc<br></code></pre></td></tr></table></figure><p>æˆ–ç±»ä¼¼çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä»¥ç¡®ä¿é‡å¯ååˆ«åä¾ç„¶æœ‰æ•ˆã€‚</p><p>è‹¥è¦åˆ é™¤åˆ«åï¼Œå¯ä»¥ä½¿ç”¨<code>unalias</code>å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">unalias</span> foobar<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[argo]Inputs and Outputs</title>
    <link href="/2025/03/17/argo-Inputs-and-Outputs/"/>
    <url>/2025/03/17/argo-Inputs-and-Outputs/</url>
    
    <content type="html"><![CDATA[<h1 id="Inputs-and-Outputs"><a href="#Inputs-and-Outputs" class="headerlink" title="Inputs and Outputs"></a>Inputs and Outputs</h1><h2 id="1-Parameters"><a href="#1-Parameters" class="headerlink" title="1 Parameters"></a>1 Parameters</h2><p>ä¸€ç§è¾“å…¥æˆ–è¾“å‡ºæ˜¯å‚æ•°ã€‚ä¸artifactsä¸åŒï¼Œè¿™äº›æ˜¯ç®€å•çš„å­—ç¬¦ä¸²å€¼ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç®€å•åœºæ™¯ã€‚</p><h3 id="1-1-Input-Parameters"><a href="#1-1-Input-Parameters" class="headerlink" title="1.1 Input Parameters"></a>1.1 Input Parameters</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">input-parameters-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">arguments:</span><br>    <span class="hljs-attr">parameters:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>        <span class="hljs-attr">value:</span> <span class="hljs-string">hello</span> <span class="hljs-string">world</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">inputs:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;inputs.parameters.message&#125;&#125;</span>&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¯¥ä¾‹å­è¡¨æ˜main templateæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°â€messageâ€</p><p>å¦‚æœä¸€ä¸ªworkflowæœ‰å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨-pæ¥æ›´æ”¹å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">argo submit --serviceaccount argo-workflow --watch input-parameters-workflow.yaml -p message=&#x27;Welcome to Argo!&#x27;<br></code></pre></td></tr></table></figure><h3 id="1-2-Output-Parameters"><a href="#1-2-Output-Parameters" class="headerlink" title="1.2 Output Parameters"></a>1.2 Output Parameters</h3><p>è¾“å‡ºå‚æ•°å¯ä»¥æ¥è‡ªå‡ ä¸ªåœ°æ–¹ï¼Œä½†é€šå¸¸æœ€çµæ´»çš„æ˜¯æ¥è‡ªæ–‡ä»¶ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå®¹å™¨åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«æ¶ˆæ¯çš„æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">parameters-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">generate-parameter</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">consume-parameter</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">print-message</span><br>            <span class="hljs-attr">dependencies:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">generate-parameter</span><br>            <span class="hljs-attr">arguments:</span><br>              <span class="hljs-attr">parameters:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>                  <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;tasks.generate-parameter.outputs.parameters.hello-param&#125;&#125;</span>&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">sh</span>, <span class="hljs-string">-c</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;echo -n hello world &gt; /tmp/hello_world.txt&quot;</span>]<br>      <span class="hljs-attr">outputs:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hello-param</span><br>            <span class="hljs-attr">valueFrom:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/hello_world.txt</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">print-message</span><br>      <span class="hljs-attr">inputs:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;inputs.parameters.message&#125;&#125;</span>&quot;</span>]<br></code></pre></td></tr></table></figure><p>åœ¨DAGæ¨¡æ¿å’Œstepæ¨¡æ¿ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ¿æ ‡ç­¾ï¼ˆtemplate tagï¼‰å°†ä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªä»»åŠ¡çš„è¾“å…¥è¿›è¡Œå¼•ç”¨ã€‚</p><p><a href="https://argoproj.github.io/argo-workflows/walk-through/parameters/">Parameters overview</a></p><p><a href="https://argoproj.github.io/argo-workflows/workflow-inputs/">Workflow input parameters</a></p><h2 id="2-Artifacts"><a href="#2-Artifacts" class="headerlink" title="2 Artifacts"></a>2 Artifacts</h2><p>Artifactï¼ˆå·¥ä»¶ï¼‰æ˜¯å¯¹å‹ç¼©å¹¶å­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚S3ã€MinIOã€GCSç­‰ï¼‰ä¸­çš„æ–‡ä»¶çš„ä¸€ç§ç§°å‘¼ã€‚</p><p>Argoä¸­æœ‰ä¸¤ç§ç±»å‹çš„å·¥ä»¶ï¼š</p><ul><li>è¾“å…¥å·¥ä»¶ï¼šæŒ‡çš„æ˜¯ä»å­˜å‚¨ï¼ˆä¾‹å¦‚S3ï¼‰ä¸‹è½½å¹¶ä½œä¸ºå·æŒ‚è½½åˆ°å®¹å™¨å†…çš„æ–‡ä»¶ã€‚</li><li>è¾“å‡ºå·¥ä»¶ï¼šæŒ‡çš„æ˜¯åœ¨å®¹å™¨å†…åˆ›å»ºå¹¶ä¸Šä¼ åˆ°å­˜å‚¨çš„æ–‡ä»¶ã€‚</li></ul><p>å·¥ä»¶é€šå¸¸ä¼šè¢«ä¸Šä¼ åˆ°è¯¸å¦‚AWS S3æˆ–GCP GCSä¹‹ç±»å­˜å‚¨æœåŠ¡ä¸­çš„ä¸€ä¸ªæ¡¶é‡Œã€‚æˆ‘ä»¬å°†è¿™ç§å­˜å‚¨ç§°ä¸ºå·¥ä»¶ä»“åº“(artifact repository)ã€‚</p><h3 id="2-1-Output-Artifacts"><a href="#2-1-Output-Artifacts" class="headerlink" title="2.1 Output Artifacts"></a>2.1 Output Artifacts</h3><p>å·¥ä½œæµä¸­çš„æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥äº§ç”Ÿè¾“å‡ºå·¥ä»¶ã€‚è¦æŒ‡å®šä¸€ä¸ªè¾“å‡ºå·¥ä»¶ï¼Œä½ å¿…é¡»åœ¨æ¸…å•ä¸­åŒ…å«<code>outputs</code>ã€‚</p><p>æ¯ä¸ªè¾“å‡ºå·¥ä»¶å£°æ˜ï¼š</p><ul><li>åœ¨å®¹å™¨å†…çš„<strong>è·¯å¾„</strong>ï¼Œç”¨äºå®šä½è¯¥å·¥ä»¶ã€‚</li><li>ä¸€ä¸ª<strong>åç§°</strong>ï¼Œä»¥ä¾¿äºå¼•ç”¨è¯¥å·¥ä»¶ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">save-message</span><br>  <span class="hljs-attr">container:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">command:</span> [ <span class="hljs-string">sh</span>, <span class="hljs-string">-c</span> ]<br>    <span class="hljs-attr">args:</span> [ <span class="hljs-string">&quot;echo hello world &gt; /tmp/hello_world.txt&quot;</span> ]<br>  <span class="hljs-attr">outputs:</span><br>    <span class="hljs-attr">artifacts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hello-art</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/hello_world.txt</span><br></code></pre></td></tr></table></figure><p>å½“å®¹å™¨æ‰§è¡Œå®Œæ¯•åï¼Œæ–‡ä»¶å°†ä»å®¹å™¨ä¸­è¢«å¤åˆ¶å‡ºæ¥ï¼Œå‹ç¼©ï¼Œå¹¶å­˜å‚¨èµ·æ¥ã€‚</p><p>æ–‡ä»¶ä¹Ÿå¯ä»¥æ˜¯ç›®å½•å½¢å¼ï¼Œå› æ­¤å¦‚æœæ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™ä¼šå°†è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å‹ç¼©æˆä¸€ä¸ªå½’æ¡£æ–‡ä»¶è¿›è¡Œå­˜å‚¨ã€‚</p><h3 id="2-2-Input-Artifacts"><a href="#2-2-Input-Artifacts" class="headerlink" title="2.2 Input Artifacts"></a>2.2 Input Artifacts</h3><p>è¦å£°æ˜ä¸€ä¸ªè¾“å…¥å·¥ä»¶ï¼Œä½ å¿…é¡»åœ¨æ¸…å•ä¸­åŒ…å«<code>inputs</code>ã€‚æ¯ä¸ªè¾“å…¥å·¥ä»¶å¿…é¡»å£°æ˜ï¼š</p><ul><li><strong>åç§°</strong></li><li>åˆ›å»ºè¯¥artifactçš„<strong>è·¯å¾„</strong></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">print-message</span><br>  <span class="hljs-attr">inputs:</span><br>    <span class="hljs-attr">artifacts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>        <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/message</span><br>  <span class="hljs-attr">container:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>    <span class="hljs-attr">command:</span> [ <span class="hljs-string">sh</span>, <span class="hljs-string">-c</span> ]<br>    <span class="hljs-attr">args:</span> [ <span class="hljs-string">&quot;cat /tmp/message&quot;</span> ]<br></code></pre></td></tr></table></figure><p>å¦‚æœå·¥ä»¶æ˜¯ä¸€ä¸ªå‹ç¼©ç›®å½•ï¼Œåˆ™å®ƒä¼šè¢«è§£å‹å¹¶è§£åŒ…åˆ°æŒ‡å®šè·¯å¾„ä¸­ã€‚</p><h3 id="2-3-Inputs-and-Outputs"><a href="#2-3-Inputs-and-Outputs" class="headerlink" title="2.3 Inputs and Outputs"></a>2.3 Inputs and Outputs</h3><p>ä¸èƒ½å•ç‹¬ä½¿ç”¨è¾“å…¥æˆ–è¾“å‡ºï¼Œéœ€è¦é€šè¿‡stepæˆ–DAGæ¨¡æ¿å°†å®ƒä»¬ç»“åˆèµ·æ¥ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">dag:</span><br>    <span class="hljs-attr">tasks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">generate-artifact</span><br>        <span class="hljs-attr">template:</span> <span class="hljs-string">save-message</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">consume-artifact</span><br>        <span class="hljs-attr">template:</span> <span class="hljs-string">print-message</span><br>        <span class="hljs-attr">dependencies:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">generate-artifact</span><br>        <span class="hljs-attr">arguments:</span><br>          <span class="hljs-attr">artifacts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>              <span class="hljs-attr">from:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;tasks.generate-artifact.outputs.artifacts.hello-art&#125;&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>arguments</code>ç”¨äºå£°æ˜å·¥ä»¶è¾“å…¥çš„å€¼ã€‚è¿™é‡Œä½¿ç”¨äº†æ¨¡æ¿æ ‡ç­¾ï¼Œ<code>&#123;&#123;tasks.generate-artifact.outputs.artifacts.hello-art&#125;&#125;</code>æˆä¸ºäº†ä»“åº“ä¸­å·¥ä»¶çš„è·¯å¾„ã€‚</p><p>ä»»åŠ¡<code>consume-artifact</code>å¿…é¡»åœ¨<code>generate-artifact</code>ä¹‹åè¿è¡Œï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨<code>dependencies</code>æ¥å£°æ˜è¿™ç§å…³ç³»ã€‚</p><p>å®Œæ•´çš„DAGå·¥ä½œæµï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">artifacts-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">generate-artifact</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">save-message</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">consume-artifact</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">print-message</span><br>            <span class="hljs-attr">dependencies:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">generate-artifact</span><br>            <span class="hljs-attr">arguments:</span><br>              <span class="hljs-attr">artifacts:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>                  <span class="hljs-attr">from:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;tasks.generate-artifact.outputs.artifacts.hello-art&#125;&#125;</span>&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">save-message</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">sh</span>, <span class="hljs-string">-c</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;echo hello world &gt; /tmp/hello_world.txt&quot;</span>]<br>      <span class="hljs-attr">outputs:</span><br>        <span class="hljs-attr">artifacts:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hello-art</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/hello_world.txt</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">print-message</span><br>      <span class="hljs-attr">inputs:</span><br>        <span class="hljs-attr">artifacts:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/tmp/message</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">sh</span>, <span class="hljs-string">-c</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;cat /tmp/message&quot;</span>]<br></code></pre></td></tr></table></figure><p><img src="/../images/argo-Inputs-and-Outputs/image-20250317232329244.png"></p><p><img src="/../images/argo-Inputs-and-Outputs/image-20250317232337318.png"></p>]]></content>
    
    
    <categories>
      
      <category>argo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[argo]argo templates</title>
    <link href="/2025/03/17/argo-argo-templates/"/>
    <url>/2025/03/17/argo-argo-templates/</url>
    
    <content type="html"><![CDATA[<h1 id="Argo-Templates"><a href="#Argo-Templates" class="headerlink" title="Argo Templates"></a>Argo Templates</h1><h2 id="1-Template-Types"><a href="#1-Template-Types" class="headerlink" title="1 Template Types"></a>1 Template Types</h2><p>æ¨¡æ¿æœ‰å‡ ç§ç±»å‹ï¼Œåˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„ç±»åˆ«ï¼šå·¥ä½œ(work)å’Œç¼–æ’(orchestration)ã€‚</p><p>ç¬¬ä¸€ç±»å®šä¹‰äº†éœ€è¦å®Œæˆçš„å·¥ä½œã€‚è¿™åŒ…æ‹¬ï¼š</p><ul><li>å®¹å™¨(container)</li><li>å®¹å™¨é›†(container set)</li><li>æ•°æ®(data)</li><li>èµ„æº(resource)</li><li>è„šæœ¬(script)</li></ul><p>ç¬¬äºŒç±»ç¼–æ’å·¥ä½œï¼š</p><ul><li>æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰</li><li>æ­¥éª¤(steps)</li><li>æš‚åœ(suspend)</li></ul><h2 id="2-Container-Template"><a href="#2-Container-Template" class="headerlink" title="2 Container Template"></a>2 Container Template</h2><p>ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">container-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>    <span class="hljs-attr">container:</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>      <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>      <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;hello world&quot;</span>]<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šé¢å®šä¹‰çš„å·¥ä½œæµ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">argo submit --serviceaccount argo-workflow --watch container-workflow.yaml<br></code></pre></td></tr></table></figure><h2 id="3-Template-Tags"><a href="#3-Template-Tags" class="headerlink" title="3 Template Tags"></a>3 Template Tags</h2><p>æ¨¡æ¿æ ‡ç­¾ï¼ˆä¹Ÿç§°ä¸ºæ¨¡æ¿å˜é‡ï¼‰æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶å°†æ•°æ®æ›¿æ¢åˆ°å·¥ä½œæµä¸­çš„æ–¹å¼ã€‚æ¨¡æ¿æ ‡ç­¾ç”±åˆ†éš”ï¼Œå¹¶åœ¨æ¨¡æ¿æ‰§è¡Œæ—¶è¢«æ›¿æ¢ã€‚</p><p>å¯ä½¿ç”¨çš„æ ‡ç­¾å–å†³äºæ¨¡æ¿ç±»å‹ï¼ŒåŒæ—¶å­˜åœ¨ä¸€äº›å…¨å±€æ ‡ç­¾å¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>&#123;&#123;workflow.name&#125;&#125;</code> ï¼Œå®ƒä¼šè¢«å·¥ä½œæµçš„åç§°æ‰€æ›¿æ¢ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">template-tag-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;hello <span class="hljs-template-variable">&#123;&#123;workflow.name&#125;&#125;</span>&quot;</span>]<br></code></pre></td></tr></table></figure><p><a href="https://argo-workflows.readthedocs.io/en/latest/variables/">Workflow Variables - Argo Workflows - The workflow engine for Kubernetes</a></p><h2 id="4-Work-Templates"><a href="#4-Work-Templates" class="headerlink" title="4 Work Templates"></a>4 Work Templates</h2><p>è¿˜æœ‰å“ªäº›ç±»å‹çš„å·¥ä½œæ¨¡æ¿ï¼Ÿ</p><ul><li>å®¹å™¨é›†(container set)å…è®¸æ‚¨åœ¨å•ä¸ªPodä¸­è¿è¡Œå¤šä¸ªå®¹å™¨ã€‚å½“æ‚¨å¸Œæœ›è¿™äº›å®¹å™¨å…±äº«ä¸€ä¸ªå…±åŒçš„å·¥ä½œç©ºé—´ï¼Œæˆ–è€…å¸Œæœ›å°†Podçš„å¯åŠ¨æ—¶é—´æ•´åˆåˆ°å·¥ä½œæµä¸­çš„ä¸€ä¸ªæ­¥éª¤æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚</li><li>æ•°æ®(data)æ¨¡æ¿å…è®¸æ‚¨ä»å­˜å‚¨ï¼ˆä¾‹å¦‚S3ï¼‰ä¸­è·å–æ•°æ®ã€‚å½“æ¯é¡¹æ•°æ®ä»£è¡¨ä¸€é¡¹éœ€è¦å®Œæˆçš„å·¥ä½œæ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚</li><li>èµ„æº(resource)æ¨¡æ¿å…è®¸æ‚¨åˆ›å»ºä¸€ä¸ªKubernetesèµ„æºå¹¶ç­‰å¾…å…¶æ»¡è¶³æŸä¸ªæ¡ä»¶ï¼ˆä¾‹å¦‚æˆåŠŸçŠ¶æ€ï¼‰ã€‚å¦‚æœæ‚¨å¸Œæœ›ä¸å¦ä¸€ä¸ªKubernetesç³»ç»Ÿï¼ˆå¦‚AWS Spark EMRï¼‰è¿›è¡Œäº’æ“ä½œï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</li><li>è„šæœ¬(script)æ¨¡æ¿å…è®¸æ‚¨åœ¨å®¹å™¨ä¸­è¿è¡Œè„šæœ¬ã€‚è¿™ä¸å®¹å™¨æ¨¡æ¿éå¸¸ç›¸ä¼¼ï¼Œä½†åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†è„šæœ¬ã€‚</li></ul><p>æ¯ç§æ‰§è¡Œå·¥ä½œçš„æ¨¡æ¿éƒ½æ˜¯é€šè¿‡è¿è¡Œä¸€ä¸ªPodæ¥å®Œæˆçš„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨kubectlæŸ¥çœ‹è¿™äº›Podï¼š</p><pre><code class="hljs">kubectl get pods -l workflows.argoproj.io/workflow</code></pre><p>å¯ä»¥é€šè¿‡workflows.argoproj.io&#x2F;workflowæ ‡ç­¾è¯†åˆ«å·¥ä½œæµPodã€‚</p><h2 id="5-DAG-Template"><a href="#5-DAG-Template" class="headerlink" title="5 DAG Template"></a>5 DAG Template</h2><p>DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰æ¨¡æ¿æ˜¯ä¸€ç§å¸¸è§çš„ç¼–æ’æ¨¡æ¿ã€‚ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">dag-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">a</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">b</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>            <span class="hljs-attr">dependencies:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">a</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [ <span class="hljs-string">echo</span> ]<br>        <span class="hljs-attr">args:</span> [ <span class="hljs-string">&quot;hello world&quot;</span> ]<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ¨¡æ¿ï¼š</p><ul><li>â€œmainâ€ æ¨¡æ¿æ˜¯DAGã€‚</li><li>â€œechoâ€ æ¨¡æ¿ä¸å®¹å™¨ç¤ºä¾‹ä¸­çš„æ¨¡æ¿ç›¸åŒã€‚</li></ul><p>è¿™ä¸ªDAGåŒ…å«ä¸¤ä¸ªä»»åŠ¡ï¼šâ€aâ€ å’Œ â€œbâ€ã€‚ä¸¤è€…éƒ½è¿è¡Œ â€œechoâ€ æ¨¡æ¿ï¼Œä½†ç”±äº â€œbâ€ ä¾èµ–äº â€œaâ€ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå¯åŠ¨ï¼Œç›´åˆ° â€œaâ€ æˆåŠŸå®Œæˆã€‚</p><p>å¢åŠ ä¸€ä¸ªcï¼Œä¾èµ–aå’Œb</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">dag-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">a</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">b</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">c</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>            <span class="hljs-attr">dependencies:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">a</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">b</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;hello world&quot;</span>]<br></code></pre></td></tr></table></figure><p><img src="/../images/argo-argo-templates/image-20250317221347027.png"></p><p><img src="/../images/argo-argo-templates/image-20250317221354633.png"></p><p><img src="/../images/argo-argo-templates/image-20250317221359497.png"></p><p><img src="/../images/argo-argo-templates/image-20250317221429454.png"></p><h2 id="6-Loops"><a href="#6-Loops" class="headerlink" title="6 Loops"></a>6 Loops</h2><h3 id="6-1-withItems"><a href="#6-1-withItems" class="headerlink" title="6.1 withItems"></a>6.1 withItems</h3><p>DAGå…è®¸ä½¿ç”¨<code>withItems</code>æ¥éå†å¤šä¸ªé¡¹ç›®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dag:</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">print-message</span><br>      <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">arguments:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;item&#125;&#125;</span>&quot;</span><br>      <span class="hljs-attr">withItems:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;hello world&quot;</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;goodbye world&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒå°†ä¸ºåˆ—å‡ºçš„æ¯ä¸ªé¡¹ç›®æ‰§è¡Œä¸€æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ä¸€ä¸ªæ¨¡æ¿æ ‡ç­¾<code>&#123;&#123;item&#125;&#125;</code>ï¼Œå®ƒå°†è¢«æ›¿æ¢ä¸ºâ€hello worldâ€å’Œâ€goodbye worldâ€ã€‚DAGå¹¶è¡Œæ‰§è¡Œï¼Œä¼šåŒæ—¶å¼€å§‹æ‰§è¡Œä¸¤ä¸ªä»»åŠ¡ã€‚</p><p>æäº¤å·¥ä½œæµçš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">argo submit --serviceaccount argo-workflow --watch with-items-workflow.yaml<br></code></pre></td></tr></table></figure><p><img src="/../images/argo-argo-templates/image-20250317221849654.png"></p><p><img src="/../images/argo-argo-templates/image-20250317221908396.png"></p><h3 id="6-2-withSequence"><a href="#6-2-withSequence" class="headerlink" title="6.2 withSequence"></a>6.2 withSequence</h3><p>å¯ä»¥ä½¿ç”¨<code>withSequence</code>æ¥éå†ä¸€ç³»åˆ—æ•°å­—ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dag:</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">print-message</span><br>      <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">arguments:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;item&#125;&#125;</span>&quot;</span><br>      <span class="hljs-attr">withSequence:</span><br>        <span class="hljs-attr">count:</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">argo submit --serviceaccount argo-workflow --watch with-sequence-workflow.yaml<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¿™é‡Œæ˜¾ç¤ºæœ‰5ä¸ªPodåŒæ—¶è¿è¡Œï¼Œå¹¶ä¸”å®ƒä»¬çš„åå­—ä¸­åŒ…å«äº†ç´¢å¼•å€¼ï¼ˆä»é›¶å¼€å§‹è®¡æ•°ï¼‰ã€‚</p><p><img src="/../images/argo-argo-templates/image-20250317222051127.png"></p><p><img src="/../images/argo-argo-templates/image-20250317222127563.png"></p><p><strong>åŸºæœ¬è¯­æ³•</strong></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">withSequence:</span><br><span class="hljs-symbol">  count:</span> <span class="hljs-params">&lt;number&gt;</span> <span class="hljs-meta"># æˆ–è€…ä½¿ç”¨ start å’Œ end æ¥æŒ‡å®šèŒƒå›´</span><br><span class="hljs-symbol">  start:</span> <span class="hljs-params">&lt;start_number&gt;</span><br><span class="hljs-symbol">  end:</span> <span class="hljs-params">&lt;end_number&gt;</span><br><span class="hljs-symbol">  format:</span> <span class="hljs-params">&lt;format_string&gt;</span> <span class="hljs-meta"># å¯é€‰ï¼Œæ ¼å¼åŒ–è¾“å‡º</span><br></code></pre></td></tr></table></figure><ul><li><code>count</code>: å¦‚æœåªæŒ‡å®š <code>count</code>ï¼Œå®ƒä¼šä»0å¼€å§‹ç”ŸæˆæŒ‡å®šæ•°é‡çš„æ•´æ•°ã€‚</li><li><code>start</code> å’Œ <code>end</code>: æŒ‡å®šåºåˆ—çš„èµ·å§‹å€¼å’Œç»“æŸå€¼ï¼ˆåŒ…æ‹¬è¾¹ç•Œï¼‰ã€‚å¦‚æœæŒ‡å®šäº† <code>start</code> å’Œ <code>end</code>ï¼Œåˆ™ <code>count</code> å°†è¢«å¿½ç•¥ã€‚</li><li><code>format</code>: å¯é€‰å‚æ•°ï¼Œç”¨äºæ ¼å¼åŒ–è¾“å‡ºçš„å­—ç¬¦ä¸²ã€‚å¯ä»¥ä½¿ç”¨Goè¯­è¨€çš„æ ¼å¼åŒ–è§„åˆ™ï¼ˆå¦‚ <code>%v</code>ï¼‰ã€‚</li></ul><p>æŒ‡å®šèŒƒå›´</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">with-sequence-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">print-message</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>            <span class="hljs-attr">arguments:</span><br>              <span class="hljs-attr">parameters:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>                  <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;item&#125;&#125;</span>&quot;</span><br>            <span class="hljs-attr">withSequence:</span><br>              <span class="hljs-attr">start:</span> <span class="hljs-number">10</span><br>              <span class="hljs-attr">end:</span> <span class="hljs-number">20</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">inputs:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;inputs.parameters.message&#125;&#125;</span>&quot;</span>]<br></code></pre></td></tr></table></figure><p><img src="/../images/argo-argo-templates/image-20250317222639696.png"></p><h2 id="7-Exit-Handler"><a href="#7-Exit-Handler" class="headerlink" title="7 Exit Handler"></a>7 Exit Handler</h2><p>å¦‚æœéœ€è¦åœ¨æŸä¸ªä»»åŠ¡å®Œæˆåæ‰§è¡Œå¦ä¸€é¡¹ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨é€€å‡ºå¤„ç†å™¨ã€‚é€€å‡ºå¤„ç†å™¨é€šè¿‡<code>onExit</code>æŒ‡å®šï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dag:</span><br>  <span class="hljs-attr">tasks:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">a</span><br>      <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">onExit:</span> <span class="hljs-string">tidy-up</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œåªæ˜¯æŒ‡å®šäº†åœ¨é€€å‡ºæ—¶åº”è¿è¡Œçš„æ¨¡æ¿åç§°ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">exit-handler-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">a</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo</span><br>            <span class="hljs-attr">onExit:</span> <span class="hljs-string">tidy-up</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">echo</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;hello world&quot;</span>]<br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">tidy-up</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;tidy up!&quot;</span>]<br></code></pre></td></tr></table></figure><p><strong>workflow onExit</strong></p><p>è¦å°†é€€å‡ºå¤„ç†å™¨æ”¹ä¸ºåœ¨å·¥ä½œæµç»“æŸæ—¶è¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨å•ä¸ªæ¨¡æ¿ç»“æŸåè¿è¡Œï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨å·¥ä½œæµçš„é¡¶çº§å®šä¹‰<code>onExit</code>å¤„ç†å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨å·¥ä½œæµç»“æŸæ—¶æ‰§è¡Œä¸€ä¸ªé€€å‡ºå¤„ç†å™¨ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Workflow</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">generateName:</span> <span class="hljs-string">exit-handler-workflow-</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">entrypoint:</span> <span class="hljs-string">main</span><br>  <span class="hljs-attr">onExit:</span> <span class="hljs-string">workflow-exit-handler</span><br>  <span class="hljs-attr">templates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">main</span><br>      <span class="hljs-attr">dag:</span><br>        <span class="hljs-attr">tasks:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">a</span><br>            <span class="hljs-attr">template:</span> <span class="hljs-string">echo-message</span><br>            <span class="hljs-attr">arguments:</span><br>              <span class="hljs-attr">parameters:</span> [&#123;<span class="hljs-attr">name:</span> <span class="hljs-string">message</span>, <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;Hello World&quot;</span>&#125;]<br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">echo-message</span><br>      <span class="hljs-attr">inputs:</span><br>        <span class="hljs-attr">parameters:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">message</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">alpine:latest</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">echo</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123;inputs.parameters.message&#125;&#125;</span>&quot;</span>]<br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">workflow-exit-handler</span><br>      <span class="hljs-attr">container:</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">alpine:latest</span><br>        <span class="hljs-attr">command:</span> [<span class="hljs-string">sh</span>, <span class="hljs-string">-c</span>]<br>        <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;echo &#x27;Workflow cleanup done.&#x27;&quot;</span>]<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¿®æ”¹åçš„ç¤ºä¾‹ä¸­ï¼Œ<code>onExit</code>å­—æ®µè¢«ç§»åŠ¨åˆ°äº†å·¥ä½œæµçš„é¡¶çº§ï¼ˆå³ä¸<code>entrypoint</code>åŒçº§ï¼‰ï¼Œå¹¶æŒ‡å®šä¸º<code>workflow-exit-handler</code>æ¨¡æ¿ã€‚è¿™æ„å‘³ç€æ— è®º<code>main</code>å…¥å£ç‚¹å†…çš„ä»»åŠ¡æ˜¯æˆåŠŸå®Œæˆè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šåœ¨å·¥ä½œæµç»“æŸæ—¶è¿è¡Œè¿™ä¸ªé€€å‡ºå¤„ç†å™¨ã€‚</p><p>é€€å‡ºå¤„ç†å™¨ï¼ˆ<a href="https://argo-workflows.readthedocs.io/en/latest/walk-through/exit-handlers/">Exit handlers - Argo Workflows - The workflow engine for Kubernetes</a>ï¼‰ä»¥åŠç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆlifecycle hooksï¼‰ï¼ˆ<a href="https://argo-workflows.readthedocs.io/en/latest/lifecyclehook/">Lifecycle-Hook - Argo Workflows - The workflow engine for Kubernetes</a>ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>argo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[argo]argoåŸºç¡€</title>
    <link href="/2025/03/17/argo-argo%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/03/17/argo-argo%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="argoåŸºç¡€"><a href="#argoåŸºç¡€" class="headerlink" title="argoåŸºç¡€"></a>argoåŸºç¡€</h1><h2 id="1-å®‰è£…argo-workflows"><a href="#1-å®‰è£…argo-workflows" class="headerlink" title="1 å®‰è£…argo workflows"></a>1 å®‰è£…argo workflows</h2><p>argoä¸€èˆ¬å®‰è£…åœ¨å‘½åç©ºé—´argoä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create ns argo<br></code></pre></td></tr></table></figure><p>åœ¨<a href="https://github.com/argoproj/argo-workflows/releases/tag/v3.6.5">Release v3.6.5 Â· argoproj&#x2F;argo-workflows</a>ä¸­æ‰¾åˆ°è¦å®‰è£…çš„ç‰ˆæœ¬ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -n argo -f https://github.com/argoproj/argo-workflows/releases/download/v3.6.5/install.yaml<br></code></pre></td></tr></table></figure><p><strong>Workflow Controller</strong>è´Ÿè´£è¿è¡Œworkflowã€‚</p><p><strong>Argo Server</strong>è´Ÿè´£æä¾›ç”¨æˆ·æ¥å£å’ŒAPIã€‚</p><h2 id="2-ç®¡ç†RBAC"><a href="#2-ç®¡ç†RBAC" class="headerlink" title="2 ç®¡ç†RBAC"></a>2 ç®¡ç†RBAC</h2><p>å·¥ä½œæµä¸­çš„æ‰€æœ‰Podéƒ½ä½¿ç”¨åœ¨workflow.spec.serviceAccountNameä¸­æŒ‡å®šçš„service accountè¿è¡Œï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨å·¥ä½œæµæ‰€åœ¨å‘½åç©ºé—´çš„é»˜è®¤service accountã€‚å·¥ä½œæµæ‰€éœ€çš„è®¿é—®æƒé™å–å†³äºå®ƒéœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„å·¥ä½œæµéœ€è¦éƒ¨ç½²ä¸€ä¸ªèµ„æºï¼Œé‚£ä¹ˆå·¥ä½œæµçš„æœåŠ¡è´¦æˆ·å°±éœ€è¦å¯¹è¯¥èµ„æºå…·æœ‰â€˜åˆ›å»ºâ€™æƒé™ã€‚</p><p>ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é»˜è®¤æœåŠ¡è´¦æˆ·ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå…±äº«è´¦æˆ·ï¼Œå¯èƒ½ä¼šæ·»åŠ ä½ ä¸å¸Œæœ›æ‹¥æœ‰çš„æƒé™ã€‚ç›¸åï¼Œåº”è¯¥ä¸ºå·¥ä½œæµåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æœåŠ¡è´¦æˆ·ã€‚</p><p>åœ¨argoå‘½åç©ºé—´ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºargo-workflowçš„æœåŠ¡è´¦æˆ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create serviceaccount argo-workflow -n argo<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªClusterRoleï¼Œå…è®¸Argoå·¥ä½œæµæ‰§è¡Œå™¨åˆ›å»ºå’Œä¿®æ”¹å·¥ä½œæµä»»åŠ¡ç»“æœ(workflow task result)ï¼ˆè¿™æ˜¯æˆåŠŸæ‰§è¡Œå·¥ä½œæµæ‰€éœ€çš„æœ€å°æƒé™ï¼‰ã€‚å·¥ä½œæµä»»åŠ¡ç»“æœç”¨äºç®¡ç†å·¥ä½œæµåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­çš„è¿›åº¦ã€‚</p><p>ç„¶åå°†ClusterRoleç»‘å®šåˆ°argo service accountã€‚</p><h2 id="3-Workflow"><a href="#3-Workflow" class="headerlink" title="3 Workflow"></a>3 Workflow</h2><p>å·¥ä½œæµè¢«å®šä¹‰ä¸ºKubernetesèµ„æºã€‚æ¯ä¸ªå·¥ä½œæµåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿ï¼Œå…¶ä¸­ä¸€ä¸ªè¢«å®šä¹‰ä¸ºå…¥å£ç‚¹ï¼ˆentrypointï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">hello-workflow.yaml</span><br>apiVersion: argoproj.io/v1alpha1<br>kind: Workflow<br>metadata:<br>  name: hello<br>spec:<br>  serviceAccountName: argo-workflow # this is the service account that the workflow will run with<br>  entrypoint: main # the first template to run in the workflows<br>  templates:<br>  - name: main<br>    container: # this is a container template<br>      image: busybox # this is the image to run<br>      command: [&quot;echo&quot;]<br>      args: [&quot;hello world&quot;]<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªworkflow</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl -n argo apply -f hello-workflow.yaml<br></code></pre></td></tr></table></figure><h2 id="4-ä½¿ç”¨UI"><a href="#4-ä½¿ç”¨UI" class="headerlink" title="4 ä½¿ç”¨UI"></a>4 ä½¿ç”¨UI</h2><p>å¯ä»¥é€šè¿‡è¿è¡Œç«¯å£è½¬å‘æ¥æŸ¥çœ‹ç”¨æˆ·ç•Œé¢ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl -n argo port-forward --address 0.0.0.0 svc/argo-server 2746:2746 &gt; /dev/null &amp;<br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œå¯ä»¥è®¿é—®UIã€‚</p><h2 id="5-ä½¿ç”¨CLI"><a href="#5-ä½¿ç”¨CLI" class="headerlink" title="5 ä½¿ç”¨CLI"></a>5 ä½¿ç”¨CLI</h2><p>å®‰è£…Argo CLI</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -sLO https://github.com/argoproj/argo-workflows/releases/download/v3.6.2/argo-linux-amd64.gz<br>gunzip argo-linux-amd64.gz<br>chmod +x argo-linux-amd64<br>mv ./argo-linux-amd64 /usr/local/bin/argo<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸ªworkflow</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">argo submit -n argo --serviceaccount argo-workflow --watch https://raw.githubusercontent.com/argoproj/argo-workflows/master/examples/hello-world.yaml<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å·¥ä½œæµ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">argo list -n argo<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æŸä¸ªå·¥ä½œæµçš„è¯¦ç»†ä¿¡æ¯ï¼Œ<code>@latest</code> æ˜¯æœ€åä¸€ä¸ªå·¥ä½œæµçš„åˆ«å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">argo get -n argo @latest<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å·¥ä½œæµçš„æ—¥å¿—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">argo logs -n argo @latest<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>argo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[k8s]k8såŸºç¡€</title>
    <link href="/2025/03/15/k8s-k8s%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/03/15/k8s-k8s%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ä½¿ç”¨minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤"><a href="#1-ä½¿ç”¨minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤" class="headerlink" title="1 ä½¿ç”¨minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤"></a>1 ä½¿ç”¨minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤</h1><h2 id="1-1-kubernetesé›†ç¾¤"><a href="#1-1-kubernetesé›†ç¾¤" class="headerlink" title="1.1 kubernetesé›†ç¾¤"></a>1.1 kubernetesé›†ç¾¤</h2><p>Kubernetesåè°ƒä¸€ç»„é«˜åº¦å¯ç”¨çš„è®¡ç®—æœºï¼Œè¿™äº›è®¡ç®—æœºè¿æ¥åœ¨ä¸€èµ·ä»¥ä½œä¸ºä¸€ä¸ªå•ä¸€å•å…ƒå·¥ä½œã€‚k8sæä¾›çš„æŠ½è±¡å¯ä»¥æŠŠå®¹å™¨åŒ–çš„åº”ç”¨éƒ¨ç½²åˆ°é›†ç¾¤ä¸Šï¼Œè€Œæ— éœ€å°†åº”ç”¨æŒ‡å®šåˆ°å…·ä½“çš„æœºå™¨ä¸Šã€‚<strong>åº”ç”¨å¿…é¡»å®¹å™¨åŒ–</strong>ã€‚k8sä¼šè‡ªåŠ¨è´Ÿè´£åº”ç”¨å®¹å™¨åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒå’Œè°ƒåº¦ã€‚</p><p>k8sé›†ç¾¤åŒ…å«ä¸¤ç§èµ„æºï¼š</p><ul><li>æ§åˆ¶å¹³é¢è´Ÿè´£åè°ƒæ•´ä¸ªé›†ç¾¤</li><li>Nodeè´Ÿè´£è¿è¡Œåº”ç”¨ã€‚<ul><li>Nodeæ˜¯ä¸€ä¸ªå®é™…çš„ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºã€‚</li><li>æ¯ä¸ªNodeæœ‰kubeletï¼Œè´Ÿè´£é€šæ§åˆ¶å¹³é¢é€šä¿¡ä»¥åŠç®¡ç†nodeã€‚</li><li>æ¯ä¸ªNodeè¿˜æœ‰è´Ÿè´£å¤„ç†å®¹å™¨è¿è¡Œçš„å·¥å…·ï¼Œä¾‹å¦‚containerd&#x2F;CRI-Oã€‚</li></ul></li></ul><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315152209662.png"></p><p>é€šè¿‡æ§åˆ¶å¹³é¢æ¥éƒ¨ç½²åº”ç”¨ï¼Œæ§åˆ¶å¹³é¢ä¼šè´Ÿè´£è°ƒåº¦åº”ç”¨å®¹å™¨åœ¨nodeä¸Šè¿è¡Œã€‚</p><p>å¯ä»¥é€šè¿‡æ§åˆ¶å¹³é¢æš´éœ²çš„kubernetes APIå’Œæ§åˆ¶å¹³é¢é€šä¿¡ã€‚Nodeä¸Šçš„kubeletå’Œç»ˆç«¯ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼åŒæ§åˆ¶å¹³é¢é€šä¿¡ã€‚</p><h2 id="1-2-é€šè¿‡minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤"><a href="#1-2-é€šè¿‡minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤" class="headerlink" title="1.2 é€šè¿‡minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤"></a>1.2 é€šè¿‡minikubeåˆ›å»ºä¸€ä¸ªé›†ç¾¤</h2><h3 id="1-2-1-åˆ›å»ºä¸€ä¸ªminikubeé›†ç¾¤"><a href="#1-2-1-åˆ›å»ºä¸€ä¸ªminikubeé›†ç¾¤" class="headerlink" title="1.2.1 åˆ›å»ºä¸€ä¸ªminikubeé›†ç¾¤"></a>1.2.1 åˆ›å»ºä¸€ä¸ªminikubeé›†ç¾¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube start<br></code></pre></td></tr></table></figure><h3 id="1-2-2-æ‰“å¼€Dashboard"><a href="#1-2-2-æ‰“å¼€Dashboard" class="headerlink" title="1.2.2 æ‰“å¼€Dashboard"></a>1.2.2 æ‰“å¼€Dashboard</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube dashboard<br>minikube dashboard --url<br></code></pre></td></tr></table></figure><p>dashboardå‘½ä»¤å¯ç”¨dashboardæ’ä»¶å¹¶åœ¨é»˜è®¤çš„ç½‘é¡µæµè§ˆå™¨ä¸­æ‰“å¼€ä»£ç†ã€‚ä½ å¯ä»¥é€šè¿‡dashboardåˆ›å»ºKubernetesèµ„æºï¼Œå¦‚éƒ¨ç½²å’ŒæœåŠ¡ã€‚</p><p>é€šè¿‡ <code>--url</code> å‚æ•°ï¼Œå¯ä»¥ä¸è‡ªåŠ¨æ‰“å¼€dashboardï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªurlã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œdashboardåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨çš„è™šæ‹Ÿç½‘ç»œä¸­è®¿é—®ï¼Œdashboardå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶çš„ä»£ç†ï¼Œä½¿dashboardå¯ä»¥ä»å¤–éƒ¨è®¿é—®ã€‚</p><p><code>ctrl+c</code> å¯ä»¥å…³é—­è¿™ä¸ªä¸´æ—¶ä»£ç†ï¼Œä½†æ˜¯dashboardè¿˜æ˜¯åœ¨é›†ç¾¤å†…éƒ¨è¿è¡Œï¼Œåé¢å¯ä»¥é‡æ–°ç”¨ <code>dashboard</code> å‘½ä»¤åˆ›å»ºä»£ç†ã€‚</p><h3 id="1-2-3-åˆ›å»ºä¸€ä¸ªdeployment"><a href="#1-2-3-åˆ›å»ºä¸€ä¸ªdeployment" class="headerlink" title="1.2.3 åˆ›å»ºä¸€ä¸ªdeployment"></a>1.2.3 åˆ›å»ºä¸€ä¸ªdeployment</h3><p>deploymentä¼šæ£€æŸ¥podçš„çŠ¶æ€ï¼Œå¹¶ä¸”ç»´æŠ¤å®¹å™¨çš„è¿è¡Œï¼Œå¦‚æœå®¹å™¨æŒ‚äº†ï¼Œä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ã€‚</p><ol><li><p>ç”¨ <code>kubectl create</code> å‘½ä»¤åˆ›å»ºä¸€ä¸ªdeploymentè´Ÿè´£ç®¡ç†podã€‚podæ ¹æ®æä¾›çš„å®¹å™¨é•œåƒè¿è¡Œå®¹å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create deployment hello-node --image=registry.k8s.io/e2e-test-images/agnhost:2.39 -- /agnhost netexec --http-port=8080<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹deployment</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get deployments<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹pod</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pods<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é›†ç¾¤äº‹ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get events<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹kubectlé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config view<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹podä¸­å®¹å™¨çš„åº”ç”¨æ—¥å¿—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl logs hello-node-5f76cf6ccf-br9b5<br></code></pre></td></tr></table></figure></li></ol><h2 id="1-3-åˆ›å»ºä¸€ä¸ªservice"><a href="#1-3-åˆ›å»ºä¸€ä¸ªservice" class="headerlink" title="1.3 åˆ›å»ºä¸€ä¸ªservice"></a>1.3 åˆ›å»ºä¸€ä¸ªservice</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpodåªèƒ½é€šè¿‡é›†ç¾¤å†…éƒ¨ipåœ°å€åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚å¿…é¡»å°†podä½œä¸ºk8s serviceæš´éœ²å‡ºæ¥ï¼Œæ‰èƒ½åœ¨å¤–éƒ¨è®¿é—®è¯¥podä¸­çš„å®¹å™¨ã€‚</p><ol><li><p>å°†podæš´éœ²åœ¨å¤–éƒ¨ç½‘ç»œä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl expose deployment hello-node --type=LoadBalancer --port=8080<br></code></pre></td></tr></table></figure><p><code>--type=LoadBalancer</code> é€‰é¡¹è¡¨æ˜å¸Œæœ›å°†æœåŠ¡æš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ã€‚</p></li><li><p>æŸ¥çœ‹æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get services<br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œä¸‹åˆ—å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube service hello-node<br></code></pre></td></tr></table></figure></li></ol><h2 id="1-4-æ‰“å¼€æ’ä»¶-addons"><a href="#1-4-æ‰“å¼€æ’ä»¶-addons" class="headerlink" title="1.4 æ‰“å¼€æ’ä»¶(addons)"></a>1.4 æ‰“å¼€æ’ä»¶(addons)</h2><ol><li><p>æ˜¾ç¤ºç›®å‰æ”¯æŒçš„æ’ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube addons list<br></code></pre></td></tr></table></figure></li><li><p>æ‰“å¼€æŸä¸ªæ’ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube addons enable metrics-server<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å®‰è£…è¯¥æ’ä»¶åï¼Œåˆ›å»ºçš„podå’ŒæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pod,svc -n kube-system<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤æŸ¥çœ‹åœ¨kube-systemå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰podå’Œserviceèµ„æºçš„çŠ¶æ€ã€‚</p></li><li><p>æŸ¥çœ‹metrics-serverçš„è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl top pods<br></code></pre></td></tr></table></figure><p><code>kubectl top pods</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºKubernetesé›†ç¾¤ä¸­å„ä¸ªPodçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæ¯”å¦‚CPUå’Œå†…å­˜çš„æ¶ˆè€—ã€‚</p><ul><li><code>top</code> æ˜¯ <code>kubectl</code> çš„ä¸€ä¸ªå­å‘½ä»¤ï¼Œç”¨æ¥å®æ—¶æŸ¥çœ‹é›†ç¾¤ä¸­èµ„æºå¯¹è±¡ï¼ˆå¦‚Podæˆ–èŠ‚ç‚¹ï¼‰çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚</li><li><code>pods</code> æŒ‡å®šäº†æŸ¥è¯¢çš„å¯¹è±¡ç±»å‹æ˜¯Podã€‚è¿™æ¡å‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰å‘½åç©ºé—´ä¸‹çš„PodåŠå…¶å¯¹åº”çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œé™¤éé€šè¿‡ <code>-n</code> å‚æ•°æŒ‡å®šäº†ç‰¹å®šçš„å‘½åç©ºé—´ã€‚</li></ul><p>ä¸ºäº†ä½¿ <code>kubectl top pods</code> å‘½ä»¤èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œé›†ç¾¤å¿…é¡»éƒ¨ç½²äº†Metric Serverã€‚ä¸”æ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·éœ€è¦æœ‰è®¿é—®Metric Serveræä¾›çš„èµ„æºæŒ‡æ ‡APIçš„æƒé™ã€‚</p></li><li><p>å…³é—­metrics-serveræ’ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube addons disable metrics-server<br></code></pre></td></tr></table></figure></li></ol><h2 id="1-5æ¸…ç†"><a href="#1-5æ¸…ç†" class="headerlink" title="1.5æ¸…ç†"></a>1.5æ¸…ç†</h2><ol><li><p>æ¸…ç†åœ¨é›†ç¾¤ä¸­åˆ›å»ºçš„èµ„æº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl delete service hello-node<br>kubectl delete deployment hello-node<br></code></pre></td></tr></table></figure></li><li><p>å…³é—­minikubeé›†ç¾¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube stop<br></code></pre></td></tr></table></figure></li></ol><h2 id="2-ä½¿ç”¨kubectlåˆ›å»ºä¸€ä¸ªdeployment"><a href="#2-ä½¿ç”¨kubectlåˆ›å»ºä¸€ä¸ªdeployment" class="headerlink" title="2 ä½¿ç”¨kubectlåˆ›å»ºä¸€ä¸ªdeployment"></a>2 ä½¿ç”¨kubectlåˆ›å»ºä¸€ä¸ªdeployment</h2><h3 id="2-1-Kubernetes-Deployments"><a href="#2-1-Kubernetes-Deployments" class="headerlink" title="2.1 Kubernetes Deployments"></a>2.1 Kubernetes Deployments</h3><p>ä¸€æ—¦æœ‰äº†ä¸€ä¸ªè¿è¡Œä¸­çš„Kubernetesé›†ç¾¤ï¼Œå°±å¯ä»¥åœ¨ä¸Šé¢éƒ¨ç½²å®¹å™¨åŒ–åº”ç”¨ã€‚ä¸ºæ­¤ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªKubernetes Deploymentã€‚è¯¥éƒ¨ç½²ä¼šæŒ‡ç¤ºKuberneteså¦‚ä½•åˆ›å»ºå’Œæ›´æ–°åº”ç”¨å®ä¾‹ã€‚åˆ›å»ºéƒ¨ç½²åï¼ŒKubernetesæ§åˆ¶å¹³é¢ä¼šè°ƒåº¦è¯¥éƒ¨ç½²ä¸­åŒ…å«çš„åº”ç”¨å®ä¾‹åœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</p><p>ä¸€æ—¦åº”ç”¨å®ä¾‹è¢«åˆ›å»ºï¼ŒKuberneteséƒ¨ç½²æ§åˆ¶å™¨ä¼šæŒç»­ç›‘æ§è¿™äº›å®ä¾‹ã€‚å¦‚æœæ‰˜ç®¡å®ä¾‹çš„èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæˆ–è¢«åˆ é™¤ï¼Œéƒ¨ç½²æ§åˆ¶å™¨ä¼šç”¨é›†ç¾¤ä¸­å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„å®ä¾‹æ›¿æ¢è¯¥å®ä¾‹ã€‚è¿™æä¾›äº†ä¸€ç§è‡ªæˆ‘ä¿®å¤æœºåˆ¶ï¼Œä»¥åº”å¯¹æœºå™¨æ•…éšœæˆ–ç»´æŠ¤ã€‚</p><h3 id="2-2-åœ¨k8sä¸Šéƒ¨ç½²åº”ç”¨"><a href="#2-2-åœ¨k8sä¸Šéƒ¨ç½²åº”ç”¨" class="headerlink" title="2.2 åœ¨k8sä¸Šéƒ¨ç½²åº”ç”¨"></a>2.2 åœ¨k8sä¸Šéƒ¨ç½²åº”ç”¨</h3><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315163724086.png"></p><p>å¯ä»¥ä½¿ç”¨Kuberneteså‘½ä»¤è¡Œç•Œé¢kubectlæ¥åˆ›å»ºå’Œç®¡ç†deploymentã€‚Kubectlåˆ©ç”¨Kubernetes APIä¸é›†ç¾¤è¿›è¡Œäº¤äº’ã€‚</p><p>å½“åˆ›å»ºä¸€ä¸ªdeploymentæ—¶ï¼Œéœ€è¦æŒ‡å®šåº”ç”¨çš„å®¹å™¨é•œåƒå’Œå¸Œæœ›è¿è¡Œçš„å‰¯æœ¬æ•°é‡ã€‚ä¹Ÿå¯ä»¥åç»­é€šè¿‡æ›´æ–°deploymentæ¥æ›´æ”¹è¿™äº›ä¿¡æ¯ã€‚</p><h3 id="2-3-kubectlåŸºç¡€"><a href="#2-3-kubectlåŸºç¡€" class="headerlink" title="2.3 kubectlåŸºç¡€"></a>2.3 kubectlåŸºç¡€</h3><p>kubectlå‘½ä»¤é€šç”¨æ ¼å¼ï¼š<code>kubectl action resource</code></p><p>è¿™ä¼šåœ¨æŒ‡å®šçš„èµ„æº(node,deploymentâ€¦)ä¸Šæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œ(create, describe, deleteâ€¦)ã€‚å¯ä»¥ç”¨ <code>--help</code> å‘½ä»¤æ¥æŸ¥çœ‹å¯èƒ½çš„å‚æ•°(<code>kubectl get nodes --help</code>)ã€‚</p><h3 id="2-4-éƒ¨ç½²ä¸€ä¸ªåº”ç”¨"><a href="#2-4-éƒ¨ç½²ä¸€ä¸ªåº”ç”¨" class="headerlink" title="2.4 éƒ¨ç½²ä¸€ä¸ªåº”ç”¨"></a>2.4 éƒ¨ç½²ä¸€ä¸ªåº”ç”¨</h3><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤éƒ¨ç½²åº”ç”¨ã€‚éœ€è¦æŒ‡æ˜deploymentçš„åå­—ä»¥åŠåº”ç”¨é•œåƒçš„ä½ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šè¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š</p><ul><li>æŸ¥æ‰¾åˆé€‚çš„nodeæ¥è¿è¡Œåº”ç”¨</li><li>è°ƒåº¦åº”ç”¨åœ¨è¯¥nodeä¸Šè¿è¡Œ</li><li>é…ç½®é›†ç¾¤ï¼Œå½“éœ€è¦çš„æ—¶å€™é‡æ–°è°ƒåº¦å®ä¾‹è¿è¡Œ</li></ul><p>ä½¿ç”¨ <code>kubectl get deployments</code> å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„deploymentã€‚</p><h3 id="2-5-æŸ¥çœ‹åº”ç”¨"><a href="#2-5-æŸ¥çœ‹åº”ç”¨" class="headerlink" title="2.5 æŸ¥çœ‹åº”ç”¨"></a>2.5 æŸ¥çœ‹åº”ç”¨</h3><p>åœ¨Kuberneteså†…éƒ¨è¿è¡Œçš„Podä½äºä¸€ä¸ªç§æœ‰çš„ã€éš”ç¦»çš„ç½‘ç»œä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬åªèƒ½è¢«åŒä¸€ä¸ªKubernetesé›†ç¾¤å†…çš„å…¶ä»–Podå’ŒæœåŠ¡çœ‹åˆ°ï¼Œè€Œä¸èƒ½ä»å¤–éƒ¨ç½‘ç»œè®¿é—®ã€‚å½“ä½¿ç”¨kubectlæ—¶ï¼Œæ˜¯é€šè¿‡APIç«¯ç‚¹ä¸åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’çš„ã€‚</p><p>kubectl proxyå‘½ä»¤å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£ç†ï¼Œå°†é€šä¿¡è½¬å‘åˆ°é›†ç¾¤èŒƒå›´çš„ç§æœ‰ç½‘ç»œä¸­ã€‚ä»£ç†å¯ä»¥é€šè¿‡æŒ‰ä¸‹Control+Cç»ˆæ­¢ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶ä¸ä¼šæ˜¾ç¤ºä»»ä½•è¾“å‡ºã€‚</p><p>éœ€è¦æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯çª—å£æ¥è¿è¡Œè¿™ä¸ªä»£ç†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl proxy<br></code></pre></td></tr></table></figure><p>ç°åœ¨å·²ç»åœ¨ä¸»æœºï¼ˆç»ˆç«¯ï¼‰å’ŒKubernetesé›†ç¾¤ä¹‹é—´å»ºç«‹äº†è¿æ¥ã€‚è¿™ä¸ªä»£ç†å…è®¸ä»è¿™äº›ç»ˆç«¯ç›´æ¥è®¿é—®APIã€‚</p><p>å¯ä»¥é€šè¿‡ä»£ç†ç«¯ç‚¹æŸ¥çœ‹æ‰€æœ‰è¿™äº›APIã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨curlå‘½ä»¤ç›´æ¥é€šè¿‡APIæŸ¥è¯¢ç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl http://localhost:8001/version<br></code></pre></td></tr></table></figure><p>APIæœåŠ¡å™¨ä¼šæ ¹æ®Podçš„åç§°è‡ªåŠ¨ä¸ºæ¯ä¸ªPodåˆ›å»ºä¸€ä¸ªç«¯ç‚¹ï¼Œè¿™äº›ç«¯ç‚¹ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç†è®¿é—®ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦è·å–Podçš„åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pods -o go-template --template &#x27;&#123;&#123;range .items&#125;&#125;&#123;&#123;.metadata.name&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;<br></code></pre></td></tr></table></figure><p>ä½ å¯ä»¥é€šè¿‡ä»£ç†APIè®¿é—®Podï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl http://localhost:8001/api/v1/namespaces/default/pods/kubernetes-bootcamp-9bc58d867-kcmfc:8080/proxy/<br></code></pre></td></tr></table></figure><h2 id="3-æŸ¥çœ‹Podså’ŒNodesçš„ä¿¡æ¯"><a href="#3-æŸ¥çœ‹Podså’ŒNodesçš„ä¿¡æ¯" class="headerlink" title="3 æŸ¥çœ‹Podså’ŒNodesçš„ä¿¡æ¯"></a>3 æŸ¥çœ‹Podså’ŒNodesçš„ä¿¡æ¯</h2><h3 id="3-1-Pods"><a href="#3-1-Pods" class="headerlink" title="3.1 Pods"></a>3.1 Pods</h3><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315191951488.png"></p><p>å½“åˆ›å»ºä¸€ä¸ªdeploymentæ—¶ï¼ŒKubernetesåˆ›å»ºäº†ä¸€ä¸ªPodæ¥æ‰¿è½½åº”ç”¨å®ä¾‹ã€‚Podæ˜¯Kubernetesçš„ä¸€ç§æŠ½è±¡ï¼Œä»£è¡¨äº†ä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç¨‹åºå®¹å™¨ï¼ˆå¦‚Dockerå®¹å™¨ï¼‰ï¼Œä»¥åŠè¿™äº›å®¹å™¨å…±äº«çš„ä¸€äº›èµ„æºã€‚è¿™äº›èµ„æºåŒ…æ‹¬ï¼š</p><ul><li><strong>å…±äº«å­˜å‚¨</strong>ï¼Œä»¥volumeçš„å½¢å¼æä¾›</li><li><strong>ç½‘ç»œ</strong>ï¼Œæä¾›å”¯ä¸€çš„é›†ç¾¤IPåœ°å€</li><li><strong>è¿è¡Œæ¯ä¸ªå®¹å™¨çš„ä¿¡æ¯</strong>ï¼Œä¾‹å¦‚å®¹å™¨é•œåƒç‰ˆæœ¬æˆ–è¦ä½¿ç”¨çš„ç‰¹å®šç«¯å£</li></ul><p>Podæ¨¡å‹åŒ–äº†ä¸€ä¸ªåº”ç”¨ç‰¹å®šçš„â€œé€»è¾‘ä¸»æœºâ€ï¼Œå®ƒå¯ä»¥åŒ…å«ä¸åŒçš„åº”ç”¨ç¨‹åºå®¹å™¨ï¼Œè¿™äº›å®¹å™¨ä¹‹é—´çš„è€¦åˆç›¸å¯¹ç´§å¯†ã€‚Podä¸­çš„å®¹å™¨<strong>å…±äº«åŒä¸€ä¸ªIPåœ°å€å’Œç«¯å£ç©ºé—´</strong>ï¼Œæ€»æ˜¯<strong>å…±åŒä½äºä¸€å¤„å¹¶ä¸€åŒè°ƒåº¦</strong>ï¼Œå¹¶<strong>åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šä»¥å…±äº«çš„ä¸Šä¸‹æ–‡è¿è¡Œ</strong>ã€‚</p><p>åœ¨Kuberneteså¹³å°ä¸Šï¼Œ<strong>Podæ˜¯æœ€å°çš„éƒ¨ç½²å•å…ƒ</strong>ã€‚å½“åˆ›å»ºä¸€ä¸ªdeploymentæ—¶ï¼Œè¯¥deploymentä¼šåˆ›å»ºåŒ…å«å®¹å™¨çš„Podï¼ˆè€Œä¸æ˜¯ç›´æ¥åˆ›å»ºå®¹å™¨ï¼‰ã€‚æ¯ä¸ªPodéƒ½ç»‘å®šåˆ°å®ƒè¢«è°ƒåº¦çš„nodeä¸Šï¼Œå¹¶ä¸€ç›´ç•™åœ¨é‚£é‡Œç›´åˆ°ç»ˆæ­¢ï¼ˆæ ¹æ®é‡å¯ç­–ç•¥ï¼‰æˆ–åˆ é™¤ã€‚å¦‚æœèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œç›¸åŒçš„Podä¼šè¢«è°ƒåº¦åˆ°é›†ç¾¤ä¸­å…¶ä»–å¯ç”¨çš„èŠ‚ç‚¹ä¸Šã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åº”ç”¨çš„é«˜å¯ç”¨æ€§å’Œå¯é æ€§ã€‚</p><h3 id="3-2-Nodes"><a href="#3-2-Nodes" class="headerlink" title="3.2 Nodes"></a>3.2 Nodes</h3><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315192252168.png"></p><p>Podè¿è¡Œåœ¨ä¸€ä¸ªNodeä¸Šã€‚Nodeæ˜¯Kubernetesä¸­çš„å·¥ä½œæœºå™¨ï¼Œå¯ä»¥æ˜¯è™šæ‹Ÿæœºä¹Ÿå¯ä»¥æ˜¯ç‰©ç†æœºã€‚æ¯ä¸ªNodeéƒ½ç”±æ§åˆ¶å¹³é¢ç®¡ç†ã€‚ä¸€ä¸ªNodeå¯ä»¥è¿è¡Œå¤šä¸ªPodï¼ŒKubernetesæ§åˆ¶å¹³é¢ä¼šæ ¹æ®nodeçš„å¯ç”¨èµ„æºåœ¨é›†ç¾¤çš„Nodesä¹‹é—´è°ƒåº¦è¿™äº›Podã€‚</p><p>æ¯ä¸ªKubernetes Nodeè‡³å°‘è¿è¡Œä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li><strong>Kubelet</strong>ï¼šæ˜¯è´Ÿè´£Kubernetesæ§åˆ¶å¹³é¢ä¸Nodeä¹‹é—´é€šä¿¡çš„è¿›ç¨‹ï¼›å®ƒç®¡ç†è¿è¡Œåœ¨è¯¥æœºå™¨ä¸Šçš„Podå’Œå®¹å™¨ã€‚</li><li><strong>å®¹å™¨è¿è¡Œæ—¶</strong>ï¼ˆå¦‚Dockerï¼‰ï¼šè´Ÿè´£ä»æ³¨å†Œè¡¨ä¸­æ‹‰å–å®¹å™¨é•œåƒã€è§£åŒ…å®¹å™¨å¹¶è¿è¡Œåº”ç”¨ç¨‹åºã€‚</li></ul><p>åªæœ‰å®¹å™¨ä¹‹é—´æ˜¯é«˜åº¦è€¦åˆçš„å¹¶ä¸”éœ€è¦å…±äº«èµ„æºï¼ˆç¡¬ç›˜ï¼‰çš„æ—¶å€™ï¼Œå®ƒä»¬æ‰åº”è¯¥è¢«è§„åˆ’åˆ°åŒä¸€ä¸ªpodä¸­ã€‚</p><h3 id="3-3-Troubleshooting-with-kubectl"><a href="#3-3-Troubleshooting-with-kubectl" class="headerlink" title="3.3 Troubleshooting with kubectl"></a>3.3 Troubleshooting with kubectl</h3><p>æœ€å¸¸è§çš„æ“ä½œå¯ä»¥é€šè¿‡ä»¥ä¸‹kubectlå‘½ä»¤å®Œæˆï¼š</p><ul><li><p><strong>kubectl get</strong>ï¼šåˆ—å‡ºèµ„æºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨æ¥åˆ—å‡ºPodsã€Servicesç­‰èµ„æºã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> pods<br></code></pre></td></tr></table></figure></li><li><p><strong>kubectl describe</strong>ï¼šæ˜¾ç¤ºèµ„æºçš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™å¯¹äºè·å–æœ‰å…³ç‰¹å®šèµ„æºï¼ˆå¦‚Podï¼Œnodeï¼Œdeploymentï¼‰çš„æ·±å…¥ä¿¡æ¯éå¸¸æœ‰ç”¨ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€äº‹ä»¶ç­‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">kubectl describe pod <span class="hljs-tag">&lt;<span class="hljs-name">pod-name</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>kubectl logs</strong>ï¼šä»Podä¸­çš„å®¹å™¨æ‰“å°æ—¥å¿—ã€‚è¿™å¯¹äºè°ƒè¯•è¿è¡Œä¸­çš„åº”ç”¨å’Œæ£€æŸ¥é”™è¯¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">kubectl logs <span class="hljs-tag">&lt;<span class="hljs-name">pod-name</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>kubectl exec</strong>ï¼šåœ¨Podä¸­çš„å®¹å™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚è¿™å¯¹äºè¿›å…¥å®¹å™¨å†…éƒ¨è¿›è¡Œè°ƒè¯•æˆ–ç›´æ¥æ“ä½œéå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">kubectl exec -<span class="hljs-keyword">it</span> &lt;pod-<span class="hljs-built_in">name</span>&gt; <span class="hljs-comment">-- /bin/sh</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-3-1-æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—"><a href="#3-3-1-æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—" class="headerlink" title="3.3.1 æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—"></a>3.3.1 æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—</h4><p>åº”ç”¨ç¨‹åºé€šå¸¸ä¼šå°†å…¶æ ‡å‡†è¾“å‡ºå‘é€åˆ°å®¹å™¨å†…çš„æ—¥å¿—ä¸­ã€‚å¯ä»¥ä½¿ç”¨<code>kubectl logs</code>å‘½ä»¤æ£€ç´¢è¿™äº›æ—¥å¿—ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">kubectl</span> logs <span class="hljs-string">&quot;<span class="hljs-variable">$POD_NAME</span>&quot;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå½“åœ¨Podä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œæ— éœ€æŒ‡å®šå®¹å™¨åç§°ã€‚å¦‚æœPodä¸­æœ‰å¤šä¸ªå®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨<code>-c</code>é€‰é¡¹æŒ‡å®šå®¹å™¨åç§°æ¥æŸ¥çœ‹ç‰¹å®šå®¹å™¨çš„æ—¥å¿—ã€‚</p><p><strong>æŸ¥çœ‹ç‰¹å®šPodä¸­æ‰€æœ‰å®¹å™¨çš„åç§°</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;<br></code></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºçš„ä¿¡æ¯ä¸­ï¼Œæ‰¾åˆ° <code>Containers:</code> éƒ¨åˆ†ï¼Œè¿™é‡Œåˆ—å‡ºäº†è¯¥Podä¸­æ‰€æœ‰å®¹å™¨çš„åç§°åŠå…¶ç›¸å…³ä¿¡æ¯ã€‚</p><p>åœ¨è¾“å‡ºç»“æœä¸­ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„éƒ¨åˆ†ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">Containers</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">container-one</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">Image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">        nginx</span><br>    <span class="hljs-attribute">...</span><br><span class="hljs-attribute">  container-two</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">Image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">        redis</span><br>    ...<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>container-one</code> å’Œ <code>container-two</code> å°±æ˜¯Podä¸­å®¹å™¨çš„åç§°ã€‚</p><h4 id="3-3-2-åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤"><a href="#3-3-2-åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤" class="headerlink" title="3.3.2 åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤"></a>3.3.2 åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</h4><p>å¯ä»¥ç›´æ¥åœ¨Podå¯åŠ¨å¹¶è¿è¡Œåï¼Œåœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ã€‚</p><p>ä½¿ç”¨<code>exec</code>å­å‘½ä»¤ï¼Œå¹¶å°†Podçš„åç§°ä½œä¸ºå‚æ•°ã€‚è®©æˆ‘ä»¬åˆ—å‡ºç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;<span class="hljs-variable">$POD_NAME</span>&quot;</span> -- <span class="hljs-built_in">env</span><br></code></pre></td></tr></table></figure><p>åœ¨Podçš„å®¹å™¨ä¸­å¯åŠ¨ä¸€ä¸ªbashä¼šè¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">exec</span> -ti <span class="hljs-string">&quot;<span class="hljs-variable">$POD_NAME</span>&quot;</span> -- bash<br></code></pre></td></tr></table></figure><p>å·²ç»æ‰“å¼€äº†è¿è¡Œåº”ç”¨çš„å®¹å™¨æ§åˆ¶å°ã€‚åº”ç”¨çš„æºä»£ç ä½äº<code>server.js</code>æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">cat <span class="hljs-keyword">server</span>.js<br></code></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹curlå‘½ä»¤æ¥æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">curl http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:8080</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥<code>exit</code> æ¥å…³é—­ä¸å®¹å™¨çš„è¿æ¥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥é€€å‡ºbashä¼šè¯ï¼Œè¿”å›åˆ°æœ¬åœ°ç»ˆç«¯ã€‚</p><h2 id="4-é€šè¿‡serviceæ¥å°†åº”ç”¨æš´éœ²ç»™å¤–éƒ¨ç½‘ç»œ"><a href="#4-é€šè¿‡serviceæ¥å°†åº”ç”¨æš´éœ²ç»™å¤–éƒ¨ç½‘ç»œ" class="headerlink" title="4 é€šè¿‡serviceæ¥å°†åº”ç”¨æš´éœ²ç»™å¤–éƒ¨ç½‘ç»œ"></a>4 é€šè¿‡serviceæ¥å°†åº”ç”¨æš´éœ²ç»™å¤–éƒ¨ç½‘ç»œ</h2><h3 id="4-1-kubernetes-services"><a href="#4-1-kubernetes-services" class="headerlink" title="4.1 kubernetes services"></a>4.1 kubernetes services</h3><p>åœ¨Kubernetesä¸­ï¼ŒPodæ˜¯ä¸´æ—¶çš„ï¼Œå¹¶ä¸”æœ‰å…¶ç”Ÿå‘½å‘¨æœŸã€‚å½“ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œè¿è¡Œåœ¨å…¶ä¸Šçš„Podä¹Ÿä¼šä¸¢å¤±ã€‚è¿™æ—¶ï¼ŒReplicaSetå¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°é€šè¿‡åˆ›å»ºæ–°çš„Podæ¥ä½¿é›†ç¾¤å›åˆ°æœŸæœ›çš„çŠ¶æ€ï¼Œä»¥ä¿æŒåº”ç”¨ç¨‹åºçš„æŒç»­è¿è¡Œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªæœ‰3ä¸ªå‰¯æœ¬çš„å›¾åƒå¤„ç†åç«¯åº”ç”¨ã€‚è¿™äº›å‰¯æœ¬æ˜¯å¯ä»¥äº’æ¢çš„ï¼›å‰ç«¯ç³»ç»Ÿä¸åº”è¯¥å…³å¿ƒåç«¯å‰¯æœ¬çš„å…·ä½“æƒ…å†µï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“æŸä¸ªPodä¸¢å¤±å¹¶è¢«é‡æ–°åˆ›å»ºçš„æƒ…å†µã€‚ç„¶è€Œï¼Œæ¯ä¸ªPodåœ¨Kubernetesé›†ç¾¤ä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå³ä½¿æ˜¯ä½äºåŒä¸€Nodeä¸Šçš„Podä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› æ­¤éœ€è¦ä¸€ç§æ–¹æ³•è‡ªåŠ¨åè°ƒPodä¹‹é—´çš„å˜åŒ–ï¼Œä»¥ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºç»§ç»­æ­£å¸¸è¿è¡Œã€‚</p><p><strong>Service</strong>æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„é€»è¾‘ä¸Šçš„Podä»¥åŠè®¿é—®å®ƒä»¬çš„ç­–ç•¥ã€‚Serviceä½¿å¾—äº’ç›¸ä¾èµ–çš„Podä¹‹é—´å¯ä»¥æ¾æ•£è€¦åˆã€‚Serviceå¯ä»¥é€šè¿‡YAMLæˆ–JSONè¿›è¡Œå®šä¹‰ã€‚</p><ul><li><p><strong>ç›®æ ‡Podé›†</strong>ï¼šé€šå¸¸ç”±<strong>label selector</strong>å†³å®šï¼ˆä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›åˆ›å»ºä¸€ä¸ªæ²¡æœ‰é€‰æ‹©å™¨çš„Serviceï¼‰ã€‚</p></li><li><p><strong>IPæš´éœ²é—®é¢˜</strong>ï¼šå°½ç®¡æ¯ä¸ªPodéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä½†å¦‚æœæ²¡æœ‰Serviceï¼Œè¿™äº›IPåœ°å€ä¸ä¼šæš´éœ²åˆ°é›†ç¾¤å¤–éƒ¨ã€‚Serviceå…è®¸ä½ çš„åº”ç”¨ç¨‹åºæ¥æ”¶æµé‡ã€‚</p></li></ul><p><strong>Serviceç±»å‹</strong></p><p>æ ¹æ®ä½ åœ¨Serviceçš„specä¸­æŒ‡å®šçš„ç±»å‹ï¼ŒServiceå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼æš´éœ²ï¼š</p><ul><li><p><strong>ClusterIPï¼ˆé»˜è®¤ï¼‰</strong>ï¼šåœ¨é›†ç¾¤å†…éƒ¨IPä¸Šæš´éœ²Serviceã€‚è¿™ç§ç±»å‹ä½¿å¾—Serviceåªèƒ½ä»é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚</p></li><li><p><strong>NodePort</strong>ï¼šé€šè¿‡NATåœ¨é›†ç¾¤ä¸­æ¯ä¸ªé€‰å®šnodeçš„ç›¸åŒç«¯å£ä¸Šæš´éœ²Serviceã€‚è¿™ä½¿å¾—ä½ å¯ä»¥ä½¿ç”¨<code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>ä»é›†ç¾¤å¤–éƒ¨è®¿é—®Serviceã€‚å®ƒæ˜¯ClusterIPçš„è¶…é›†ã€‚</p></li><li><p><strong>LoadBalancer</strong>ï¼šåœ¨å½“å‰äº‘ç¯å¢ƒä¸­åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚æœæ”¯æŒï¼‰ï¼Œå¹¶ä¸ºServiceåˆ†é…ä¸€ä¸ªå›ºå®šçš„å¤–éƒ¨IPã€‚å®ƒæ˜¯NodePortçš„è¶…é›†ã€‚</p></li><li><p><strong>ExternalName</strong>ï¼šå°†Serviceæ˜ å°„åˆ°externalNameå­—æ®µçš„å†…å®¹ï¼ˆå¦‚foo.bar.example.comï¼‰ã€‚ä¸è®¾ç½®ä»»ä½•å½¢å¼çš„ä»£ç†ã€‚</p></li></ul><p><strong>å…¶ä»–æ³¨æ„äº‹é¡¹</strong></p><p>æœ‰æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›ä¸éœ€è¦åœ¨Serviceçš„specä¸­å®šä¹‰é€‰æ‹©å™¨çš„ç”¨ä¾‹ã€‚ä¸€ä¸ªæ²¡æœ‰é€‰æ‹©å™¨çš„Serviceä¹Ÿä¸ä¼šåˆ›å»ºç›¸åº”çš„Endpointså¯¹è±¡ã€‚è¿™å…è®¸ç”¨æˆ·æ‰‹åŠ¨å°†Serviceæ˜ å°„åˆ°ç‰¹å®šçš„ç«¯ç‚¹ã€‚å¦ä¸€ç§å¯èƒ½æ˜¯ä¸¥æ ¼ä½¿ç”¨<code>type: ExternalName</code>çš„æƒ…å†µã€‚</p><h3 id="4-2-serviceå’Œlabels"><a href="#4-2-serviceå’Œlabels" class="headerlink" title="4.2 serviceå’Œlabels"></a>4.2 serviceå’Œlabels</h3><p>åœ¨Kubernetesä¸­ï¼ŒServiceç”¨äºå°†æµé‡è·¯ç”±åˆ°ä¸€ç»„Podã€‚ä¾èµ–Podä¹‹é—´çš„å‘ç°å’Œè·¯ç”±ï¼ˆä¾‹å¦‚åº”ç”¨ä¸­çš„å‰ç«¯å’Œåç«¯ç»„ä»¶ï¼‰æ˜¯ç”±Kubernetes Serviceså¤„ç†çš„ã€‚</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315195515618.png"></p><p><strong>Serviceå¦‚ä½•åŒ¹é…Pod</strong></p><p>Serviceé€šè¿‡ä½¿ç”¨<strong>æ ‡ç­¾ï¼ˆlabelsï¼‰</strong>å’Œ<strong>é€‰æ‹©å™¨ï¼ˆselectorsï¼‰</strong>æ¥åŒ¹é…ä¸€ç»„Podã€‚æ ‡ç­¾å’Œé€‰æ‹©å™¨æ˜¯Kubernetesä¸­çš„ä¸€ç§åˆ†ç»„åŸè¯­ï¼Œå…è®¸å¯¹å¯¹è±¡è¿›è¡Œé€»è¾‘æ“ä½œã€‚</p><ul><li><p><strong>æ ‡ç­¾ï¼ˆLabelsï¼‰</strong>ï¼šæ ‡ç­¾æ˜¯é™„åŠ åˆ°å¯¹è±¡ä¸Šçš„key&#x2F;valueså¯¹ï¼Œå¯ä»¥ä»¥å¤šç§æ–¹å¼ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</p><ul><li>ä¸ºå¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒæŒ‡å®šå¯¹è±¡ã€‚</li><li>åµŒå…¥ç‰ˆæœ¬æ ‡ç­¾ã€‚</li><li>ä½¿ç”¨tagså¯¹å¯¹è±¡è¿›è¡Œåˆ†ç±»ã€‚</li></ul></li><li><p><strong>é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰</strong>ï¼šé€‰æ‹©å™¨ç”¨äºå®šä¹‰å“ªäº›å¸¦æœ‰ç‰¹å®šæ ‡ç­¾çš„Podåº”å±äºè¯¥Serviceã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒServiceå¯ä»¥åŠ¨æ€åœ°é€‚åº”é›†ç¾¤çš„å˜åŒ–ï¼Œå¦‚Podçš„å¢åŠ æˆ–åˆ é™¤ã€‚</p></li></ul><h3 id="4-3-å®ä¾‹"><a href="#4-3-å®ä¾‹" class="headerlink" title="4.3 å®ä¾‹"></a>4.3 å®ä¾‹</h3><h4 id="step-1ï¼šåˆ›å»ºä¸€ä¸ªservice"><a href="#step-1ï¼šåˆ›å»ºä¸€ä¸ªservice" class="headerlink" title="step 1ï¼šåˆ›å»ºä¸€ä¸ªservice"></a>step 1ï¼šåˆ›å»ºä¸€ä¸ªservice</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl expose deployment/kubernetes-bootcamp --type=&quot;NodePort&quot; --port 8080<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥å‘½ä»¤åˆ›å»ºä¸€ä¸ªNodePortç±»å‹çš„æœåŠ¡ï¼Œè¯¥æœåŠ¡å‘å¤–éƒ¨æš´éœ²ç«¯å£ã€‚</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315200309564.png"></p><p>ä½¿ç”¨ <code>kubectl describe services/kubernete-bootcamp</code> å‘½ä»¤æ¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315200503146.png"></p><p>å¯ä»¥çœ‹åˆ°å‘å¤–å¼€æ”¾çš„ç«¯å£æ˜¯30247.</p><p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨ <code>curl http:&quot;(minikube ip)&quot;:30247</code> æ¥ä½¿ç”¨æœåŠ¡ã€‚</p><p>æ³¨æ„ï¼Œåœ¨windowsä¸‹ä½¿ç”¨docker desktopçš„æ—¶å€™ï¼Œéœ€è¦é…ç½®ä¸€ä¸ªminikube tunnelã€‚é€šè¿‡tunnelæ¥è¿›è¡Œè½¬å‘ã€‚</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315202309870.png"></p><h4 id="Step-2ï¼šä½¿ç”¨Labels"><a href="#Step-2ï¼šä½¿ç”¨Labels" class="headerlink" title="Step 2ï¼šä½¿ç”¨Labels"></a>Step 2ï¼šä½¿ç”¨Labels</h4><p>deploymentè‡ªåŠ¨ä¸ºpodåˆ†é…äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œå¯ä»¥é€šè¿‡ <code>describe deployment</code> å‘½ä»¤æ¥æŸ¥çœ‹ã€‚</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315202510900.png"></p><p>åœ¨getå‘½ä»¤ä¸­ä½¿ç”¨-lå‚æ•°æŒ‡æ˜æ ‡ç­¾æ¥é€‰æ‹©ç›¸åº”çš„podå’Œservice</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pods -l app=kubernetes-bootcamp<br>kubectl get services -l app=kubernetes-bootcamp<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨labelå‘½ä»¤æ¥ä¸ºå¯¹è±¡æŒ‡æ˜æ–°çš„æ ‡ç­¾ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl label pods &lt;POD_NAME&gt; version=v1<br></code></pre></td></tr></table></figure><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315202921610.png"></p><h4 id="Step-3ï¼šåˆ é™¤service"><a href="#Step-3ï¼šåˆ é™¤service" class="headerlink" title="Step 3ï¼šåˆ é™¤service"></a>Step 3ï¼šåˆ é™¤service</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl delete service -l app=kubernetes-bootcamp<br></code></pre></td></tr></table></figure><h2 id="5-è¿è¡Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹"><a href="#5-è¿è¡Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹" class="headerlink" title="5 è¿è¡Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹"></a>5 è¿è¡Œåº”ç”¨çš„å¤šä¸ªå®ä¾‹</h2><p>scalingæ˜¯é€šè¿‡ä¿®æ”¹deploymentä¸­replicaçš„ä¸ªæ•°æ¥å®ç°çš„ã€‚</p><p>åœ¨åˆ›å»ºdeploymentçš„æ—¶å€™å¯ä»¥é€šè¿‡ <code>--replicas</code> å‚æ•°æ¥åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚</p><h3 id="5-1-Scalingæ¦‚è¿°"><a href="#5-1-Scalingæ¦‚è¿°" class="headerlink" title="5.1 Scalingæ¦‚è¿°"></a>5.1 Scalingæ¦‚è¿°</h3><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315205009041.png"></p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315205121386.png"></p><p>æ‰©å±•Deploymentå°†ç¡®ä¿åˆ›å»ºæ–°çš„Podï¼Œå¹¶å°†å…¶è°ƒåº¦åˆ°å…·æœ‰å¯ç”¨èµ„æºçš„èŠ‚ç‚¹ä¸Šã€‚é€šè¿‡æ‰©å±•ï¼Œå¯ä»¥å¢åŠ Podçš„æ•°é‡ä»¥è¾¾åˆ°æ–°çš„æœŸæœ›çŠ¶æ€ã€‚Kubernetesè¿˜æ”¯æŒPodçš„è‡ªåŠ¨æ‰©å±•ã€‚æ­¤å¤–ï¼Œå°†Podæ•°é‡æ‰©å±•ä¸ºé›¶ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œè¿™å°†ç»ˆæ­¢æŒ‡å®šDeploymentçš„æ‰€æœ‰Podã€‚</p><p>è¿è¡Œåº”ç”¨ç¨‹åºçš„å¤šä¸ªå®ä¾‹éœ€è¦ä¸€ç§æ–¹å¼æ¥åˆ†é…æµé‡ç»™æ‰€æœ‰çš„å®ä¾‹ã€‚Kubernetesä¸­çš„Serviceå…·å¤‡é›†æˆçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œèƒ½å¤Ÿå°†ç½‘ç»œæµé‡åˆ†é…ç»™æš´éœ²çš„Deploymentä¸­çš„æ‰€æœ‰Podã€‚Serviceä¼šæŒç»­ç›‘æ§è¿è¡Œä¸­çš„Podï¼Œç¡®ä¿æµé‡ä»…å‘é€åˆ°å¯ç”¨çš„Podã€‚</p><p>å½“ä½ æœ‰å¤šä¸ªåº”ç”¨ç¨‹åºå®ä¾‹åœ¨è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥æ‰§è¡Œæ»šåŠ¨æ›´æ–°ï¼ˆRolling Updatesï¼‰è€Œä¸ä¼šé€ æˆåœæœºã€‚æ»šåŠ¨æ›´æ–°å…è®¸ä½ é€æ­¥æ›¿æ¢æ—§çš„Podå¹¶å¯åŠ¨æ–°çš„Podï¼Œç¡®ä¿æœåŠ¡çš„è¿ç»­æ€§ã€‚</p><h3 id="5-2-æŸ¥çœ‹ReplicaSet"><a href="#5-2-æŸ¥çœ‹ReplicaSet" class="headerlink" title="5.2 æŸ¥çœ‹ReplicaSet"></a>5.2 æŸ¥çœ‹ReplicaSet</h3><p>è¦æŸ¥çœ‹ç”±Deploymentåˆ›å»ºçš„ReplicaSetï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get rs<br></code></pre></td></tr></table></figure><p>ReplicaSetçš„åå­—æ€»æ˜¯æ ¼å¼ä¸º <code>[DEPLOYMENT-NAME]-[RANDOM-STRING]</code>ã€‚è¿™é‡Œçš„éšæœºå­—ç¬¦ä¸²æ˜¯éšæœºç”Ÿæˆçš„ï¼Œå¹¶ä½¿ç”¨<code>pod-template-hash</code>ä½œä¸ºç§å­ã€‚</p><p>åœ¨è¾“å‡ºä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„åˆ—éœ€è¦æ³¨æ„ï¼š</p><ul><li><strong>DESIRED</strong>ï¼šæ˜¾ç¤ºå®šä¹‰çš„æœŸæœ›çš„åº”ç”¨ç¨‹åºå‰¯æœ¬æ•°é‡ã€‚è¿™æ˜¯åœ¨åˆ›å»ºDeploymentæ—¶æŒ‡å®šçš„æœŸæœ›çŠ¶æ€ã€‚</li><li><strong>CURRENT</strong>ï¼šæ˜¾ç¤ºå½“å‰å®é™…è¿è¡Œçš„å‰¯æœ¬æ•°é‡ã€‚</li></ul><h3 id="5-3-æ‰©å±•Deployment"><a href="#5-3-æ‰©å±•Deployment" class="headerlink" title="5.3 æ‰©å±•Deployment"></a>5.3 æ‰©å±•Deployment</h3><p>è¦æ‰‹åŠ¨æ‰©å±•Deploymentï¼Œä½ å¯ä»¥ä½¿ç”¨<code>kubectl scale</code>å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œè¦å°†ä¸€ä¸ªåä¸º<code>web-app</code>çš„Deploymentæ‰©å±•åˆ°5ä¸ªå‰¯æœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl scale deployment/web-app --replicas=5<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤å°†ä½¿Kubernetesåˆ›å»ºè¶³å¤Ÿçš„Podä»¥è¾¾åˆ°æŒ‡å®šçš„å‰¯æœ¬æ•°ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯5ä¸ªï¼‰ã€‚å¦‚æœå½“å‰å·²ç»æœ‰5ä¸ªæˆ–æ›´å¤šPodåœ¨è¿è¡Œï¼ŒKubernetesä¼šç›¸åº”åœ°å‡å°‘æˆ–å¢åŠ Podçš„æ•°é‡ã€‚</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250315210125918.png"></p><h3 id="5-4-è‡ªåŠ¨æ‰©å±•ï¼ˆHorizontal-Pod-Autoscalerï¼‰"><a href="#5-4-è‡ªåŠ¨æ‰©å±•ï¼ˆHorizontal-Pod-Autoscalerï¼‰" class="headerlink" title="5.4 è‡ªåŠ¨æ‰©å±•ï¼ˆHorizontal Pod Autoscalerï¼‰"></a>5.4 è‡ªåŠ¨æ‰©å±•ï¼ˆHorizontal Pod Autoscalerï¼‰</h3><p>è™½ç„¶æ‰‹åŠ¨æ‰©å±•é€‚ç”¨äºå·²çŸ¥çš„å·¥ä½œè´Ÿè½½ï¼Œä½†Kubernetesä¹Ÿæ”¯æŒåŸºäºCPUåˆ©ç”¨ç‡ç­‰æŒ‡æ ‡çš„è‡ªåŠ¨æ‰©å±•ï¼ˆHorizontal Pod Autoscalerï¼‰ã€‚ä½ å¯ä»¥åœ¨åˆ›å»ºDeploymentæ—¶é…ç½®è‡ªåŠ¨æ‰©å±•ç­–ç•¥ï¼Œæˆ–è€…ç¨åæ·»åŠ ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤è®¾ç½®äº†ä¸€ä¸ªDeployment <code>web-app</code>çš„è‡ªåŠ¨æ‰©å±•ç­–ç•¥ï¼Œä½¿å…¶å‰¯æœ¬æ•°åœ¨1åˆ°10ä¹‹é—´å˜åŒ–ï¼Œæ ¹æ®å¹³å‡CPUä½¿ç”¨ç‡è°ƒæ•´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl autoscale deployment web-app --min=1 --max=10 --cpu-percent=80<br></code></pre></td></tr></table></figure><p>è¿™æ„å‘³ç€å½“å¹³å‡CPUä½¿ç”¨ç‡è¾¾åˆ°80%æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨å¢åŠ Podçš„æ•°é‡ï¼Œæœ€å¤šä¸è¶…è¿‡10ä¸ªï¼›å½“è´Ÿè½½ä¸‹é™æ—¶ï¼Œå®ƒä¹Ÿä¼šå‡å°‘Podçš„æ•°é‡ï¼Œæœ€å°‘ä¿æŒ1ä¸ªPodè¿è¡Œã€‚</p><h2 id="6-æ»šåŠ¨æ›´æ–°"><a href="#6-æ»šåŠ¨æ›´æ–°" class="headerlink" title="6 æ»šåŠ¨æ›´æ–°"></a>6 æ»šåŠ¨æ›´æ–°</h2><h3 id="6-1-æ›´æ–°åº”ç”¨"><a href="#6-1-æ›´æ–°åº”ç”¨" class="headerlink" title="6.1 æ›´æ–°åº”ç”¨"></a>6.1 æ›´æ–°åº”ç”¨</h3><p>æ»šåŠ¨æ›´æ–°å…è®¸åœ¨ä¸é€ æˆåœæœºçš„æƒ…å†µä¸‹è¿›è¡Œéƒ¨ç½²æ›´æ–°ï¼Œå…¶å·¥ä½œåŸç†æ˜¯é€æ­¥ç”¨æ–°Podæ›¿æ¢å½“å‰çš„Podã€‚æ–°Podè¢«è°ƒåº¦åˆ°æœ‰å¯ç”¨èµ„æºçš„èŠ‚ç‚¹ä¸Šï¼ŒKubernetesä¼šç­‰å¾…è¿™äº›æ–°Podå¯åŠ¨åå†ç§»é™¤æ—§çš„Podã€‚</p><p>æ»šåŠ¨æ›´æ–°çš„å¿…è¦æ¡ä»¶ï¼šåº”ç”¨ç¨‹åºåœ¨é›†ç¾¤ä¸­æœ‰å¤šä¸ªè¿è¡Œå®ä¾‹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ›´æ–°è¿‡ç¨‹ä¸­ä¸å¯ç”¨çš„æœ€å¤§Podæ•°é‡å’Œå¯ä»¥åˆ›å»ºçš„æ–°Podæœ€å¤§æ•°é‡å‡ä¸º1ã€‚è¿™ä¸¤ä¸ªé€‰é¡¹éƒ½å¯ä»¥é…ç½®ä¸ºå…·ä½“çš„æ•°å­—æˆ–æ¯”ä¾‹ï¼ˆçš„Podï¼‰ã€‚åœ¨Kubernetesä¸­ï¼Œæ›´æ–°æ˜¯å…·æœ‰ç‰ˆæœ¬æ§åˆ¶çš„ï¼Œä»»ä½•éƒ¨ç½²æ›´æ–°éƒ½å¯ä»¥å›æ»šåˆ°ä¹‹å‰çš„ï¼ˆç¨³å®šï¼‰ç‰ˆæœ¬ã€‚</p><h3 id="6-2-æ»šåŠ¨æ›´æ–°æ¦‚è¿°"><a href="#6-2-æ»šåŠ¨æ›´æ–°æ¦‚è¿°" class="headerlink" title="6.2 æ»šåŠ¨æ›´æ–°æ¦‚è¿°"></a>6.2 æ»šåŠ¨æ›´æ–°æ¦‚è¿°</h3><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250316202843174.png" alt="æ›´æ–°å‰"></p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250316202938157.png" alt="æ›´æ–°ä¸­"></p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250316202851638.png" alt="æ›´æ–°ä¸­"></p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250316202929630.png" alt="æ›´æ–°å"></p><p>ç±»ä¼¼äºåº”ç”¨ç¨‹åºæ‰©å±•ï¼Œå¦‚æœä¸€ä¸ªéƒ¨ç½²è¢«å…¬å¼€æš´éœ²ï¼Œé‚£ä¹ˆåœ¨æ›´æ–°æœŸé—´ï¼ŒæœåŠ¡å°†ä»…å‘å¯ç”¨çš„Podåˆ†å‘æµé‡ã€‚</p><p>æ»šåŠ¨æ›´æ–°å…è®¸æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>é€šè¿‡å®¹å™¨é•œåƒæ›´æ–°å°†åº”ç”¨ç¨‹åºä»ä¸€ä¸ªç¯å¢ƒå‡çº§åˆ°å¦ä¸€ä¸ªç¯å¢ƒ</li><li>å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬</li><li>å®ç°åº”ç”¨çš„æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼Œå¹¶ä¸”è¾¾åˆ°é›¶åœæœºæ—¶é—´</li></ul><h3 id="6-3-æ›´æ–°åº”ç”¨ç‰ˆæœ¬"><a href="#6-3-æ›´æ–°åº”ç”¨ç‰ˆæœ¬" class="headerlink" title="6.3 æ›´æ–°åº”ç”¨ç‰ˆæœ¬"></a>6.3 æ›´æ–°åº”ç”¨ç‰ˆæœ¬</h3><p>é¦–å…ˆæŸ¥çœ‹æ›´æ–°å‰çš„é•œåƒç‰ˆæœ¬ï¼ˆ<code>kubectl describe pods</code>ï¼‰</p><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250316203843519.png"></p><p>è¦å°†åº”ç”¨ç¨‹åºçš„é•œåƒæ›´æ–°åˆ°ç¬¬2ç‰ˆï¼Œå¯ä»¥ä½¿ç”¨<code>set image</code>å­å‘½ä»¤ï¼Œéšåè·Ÿä¸Šdeploymentåç§°å’Œæ–°çš„é•œåƒç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">set</span> image deployments/kubernetes-bootcamp kubernetes-bootcamp=docker.io/jocatalin/kubernetes-bootcamp:v2<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤é€šçŸ¥deploymentä½¿ç”¨æ–°ç‰ˆæœ¬çš„é•œåƒè¿›è¡Œåº”ç”¨æ›´æ–°ï¼Œå¹¶å¯åŠ¨äº†ä¸€ä¸ªæ»šåŠ¨æ›´æ–°ã€‚å¯ä»¥é€šè¿‡<code>get pods</code>å­å‘½ä»¤æ£€æŸ¥æ–°Podçš„çŠ¶æ€ï¼Œå¹¶æŸ¥çœ‹æ—§Podæ­£åœ¨ç»ˆæ­¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get pods<br></code></pre></td></tr></table></figure><p><img src="/../images/k8s-k8s%E5%9F%BA%E7%A1%80/image-20250316204059267.png"></p><h3 id="6-4-éªŒè¯æ›´æ–°"><a href="#6-4-éªŒè¯æ›´æ–°" class="headerlink" title="6.4 éªŒè¯æ›´æ–°"></a>6.4 éªŒè¯æ›´æ–°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://<span class="hljs-string">&quot;<span class="hljs-subst">$(minikube ip)</span>:<span class="hljs-variable">$NODE_PORT</span>&quot;</span><br></code></pre></td></tr></table></figure><p>æ¯æ¬¡è¿è¡Œcurlå‘½ä»¤æ—¶ï¼Œéƒ½ä¼šè®¿é—®åˆ°ä¸åŒçš„Podã€‚è¯·æ³¨æ„ï¼Œç°åœ¨æ‰€æœ‰Podéƒ½åœ¨è¿è¡Œæœ€æ–°ç‰ˆæœ¬ï¼ˆv2ï¼‰ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡è¿è¡Œ<code>rollout status</code>å­å‘½ä»¤æ¥ç¡®è®¤æ›´æ–°çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl rollout status deployments/kubernetes-bootcamp<br></code></pre></td></tr></table></figure><p>è¦æŸ¥çœ‹åº”ç”¨ç¨‹åºå½“å‰çš„é•œåƒç‰ˆæœ¬ï¼Œå¯ä»¥è¿è¡Œ<code>describe pods</code>å­å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl describe pods<br></code></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºçš„é•œåƒå­—æ®µä¸­ï¼Œç¡®è®¤æ­£åœ¨è¿è¡Œçš„æ˜¯æœ€æ–°çš„é•œåƒç‰ˆæœ¬ï¼ˆv2ï¼‰ã€‚</p><h3 id="6-5-å›æ»šæ›´æ–°"><a href="#6-5-å›æ»šæ›´æ–°" class="headerlink" title="6.5 å›æ»šæ›´æ–°"></a>6.5 å›æ»šæ›´æ–°</h3><p>è®©æˆ‘ä»¬æ‰§è¡Œå¦ä¸€æ¬¡æ›´æ–°ï¼Œå¹¶å°è¯•éƒ¨ç½²ä¸€ä¸ªæ ‡è®°ä¸ºv10çš„é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl <span class="hljs-built_in">set</span> image deployments/kubernetes-bootcamp kubernetes-bootcamp=gcr.io/google-samples/kubernetes-bootcamp:v10<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>get deployments</code>æŸ¥çœ‹éƒ¨ç½²çš„çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get deployments<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¾“å‡ºä¸­æ²¡æœ‰åˆ—å‡ºæœŸæœ›çš„å¯ç”¨Podæ•°é‡ã€‚è¿è¡Œ<code>get pods</code>å­å‘½ä»¤åˆ—å‡ºæ‰€æœ‰Podï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get pods<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°ä¸€äº›Podçš„çŠ¶æ€ä¸ºImagePullBackOffã€‚</p><p>ä¸ºäº†æ›´æ·±å…¥åœ°äº†è§£é—®é¢˜ï¼Œè¿è¡Œ<code>describe pods</code>å­å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl describe pods<br></code></pre></td></tr></table></figure><p>åœ¨å—å½±å“Podçš„è¾“å‡ºäº‹ä»¶éƒ¨åˆ†ä¸­ï¼Œæ³¨æ„åˆ°v10é•œåƒç‰ˆæœ¬åœ¨ä»“åº“ä¸­ä¸å­˜åœ¨ã€‚</p><p>è¦å›æ»šéƒ¨ç½²åˆ°æœ€åä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„ç‰ˆæœ¬ï¼Œä½¿ç”¨<code>rollout undo</code>å­å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl rollout undo deployments/kubernetes-bootcamp<br></code></pre></td></tr></table></figure><p><code>rollout undo</code>å‘½ä»¤å°†éƒ¨ç½²æ¢å¤åˆ°ä¹‹å‰çš„å·²çŸ¥çŠ¶æ€ï¼ˆå³é•œåƒçš„v2ç‰ˆæœ¬ï¼‰ã€‚æ›´æ–°æ˜¯ç‰ˆæœ¬åŒ–çš„ï¼Œå¯ä»¥å›æ»šåˆ°Deploymentçš„ä»»ä½•ä¹‹å‰å·²çŸ¥çš„çŠ¶æ€ã€‚</p><p>å†æ¬¡ä½¿ç”¨<code>get pods</code>å­å‘½ä»¤åˆ—å‡ºPodï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get pods<br></code></pre></td></tr></table></figure><p>è¦æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„Podä¸Šéƒ¨ç½²çš„é•œåƒï¼Œä½¿ç”¨<code>describe pods</code>å­å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl describe pods<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼ŒDeploymentå†æ¬¡ä½¿ç”¨åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ï¼ˆv2ï¼‰ã€‚å›æ»šæˆåŠŸã€‚</p><p>è®°å¾—æ¸…ç†æœ¬åœ°é›†ç¾¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl delete deployments/kubernetes-bootcamp services/kubernetes-bootcamp<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++å¹¶å‘ç¼–ç¨‹å®æˆ˜Chapter7</title>
    <link href="/2025/02/22/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter7/"/>
    <url>/2025/02/22/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter7/</url>
    
    <content type="html"><![CDATA[<h1 id="7-è®¾è®¡æ— é”æ•°æ®ç»“æ„"><a href="#7-è®¾è®¡æ— é”æ•°æ®ç»“æ„" class="headerlink" title="7 è®¾è®¡æ— é”æ•°æ®ç»“æ„"></a>7 è®¾è®¡æ— é”æ•°æ®ç»“æ„</h1><h2 id="å®šä¹‰å’Œæ¨è®º"><a href="#å®šä¹‰å’Œæ¨è®º" class="headerlink" title="å®šä¹‰å’Œæ¨è®º"></a>å®šä¹‰å’Œæ¨è®º</h2><p>ç®—æ³•å’Œæ•°æ®ç»“æ„ä¸­åªè¦é‡‡ç”¨äº†äº’æ–¥ã€æ¡ä»¶å˜é‡æˆ–futureè¿›è¡ŒåŒæ­¥æ“ä½œï¼Œå°±ç§°ä¹‹ä¸ºé˜»å¡å‹ç®—æ³•å’Œé˜»å¡å‹æ•°æ®ç»“æ„ã€‚æ“ä½œç³»ç»Ÿå¾€å¾€ä¼šæŠŠè¢«é˜»å¡çš„çº¿ç¨‹å½»åº•æš‚åœï¼Œå¹¶å°†å…¶æ—¶é—´ç‰‡åˆ†é…ç»™å…¶ä»–çº¿ç¨‹ï¼Œç­‰åˆ°æœ‰çº¿ç¨‹æ‰§è¡Œäº†æ°å½“çš„æ“ä½œï¼Œé˜»å¡æ–¹è¢«è§£é™¤ã€‚</p><h3 id="éé˜»å¡å‹æ•°æ®ç»“æ„"><a href="#éé˜»å¡å‹æ•°æ®ç»“æ„" class="headerlink" title="éé˜»å¡å‹æ•°æ®ç»“æ„"></a>éé˜»å¡å‹æ•°æ®ç»“æ„</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">spinlock_mutex</span><br>&#123;<br>    std::atomic_flag flag;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">spinlock_mutex</span>():<br>        <span class="hljs-built_in">flag</span>(ATOMIC_FLAG_INIT)<br>    &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">while</span>(flag.<span class="hljs-built_in">test_and_set</span>(std::memory_order_acquire));<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        flag.<span class="hljs-built_in">clear</span>(std::memory_order_release);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä¹‹å‰å®ç°çš„è‡ªæ—‹é”è™½ç„¶ä¸å­˜åœ¨é˜»å¡è°ƒç”¨ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨äº’æ–¥ï¼Œä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿé”å®šã€‚å› æ­¤ï¼Œåªåˆ†æéé˜»å¡&#x2F;é˜»å¡ï¼Œæ— æ³•åˆ¤æ–­å…¶é€‚ç”¨æ€§ï¼Œéœ€è¦æ ¹æ®ä¸€ä¸‹æ¡æ¬¾è¿›è¡Œè¿›ä¸€æ­¥åˆ¤æ–­ï¼š</p><ul><li>æ— é˜»ç¢ï¼ˆobstruction-freeï¼‰ï¼šå‡å®šå…¶ä»–çº¿ç¨‹å…¨éƒ½æš‚åœï¼Œåˆ™ç›®æ ‡çº¿ç¨‹å°†åœ¨æœ‰é™æ­¥éª¤å†…å®Œæˆè‡ªå·±çš„æ“ä½œã€‚</li><li>æ— é”ï¼ˆlock-freeï¼‰ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹å…±åŒæ“ä½œåŒä¸€ä»½æ•°æ®ï¼Œé‚£ä¹ˆåœ¨æœ‰é™æ­¥éª¤å†…ï¼Œå…¶ä¸­æŸä¸€çº¿ç¨‹èƒ½å¤Ÿå®Œæˆè‡ªå·±çš„æ“ä½œã€‚</li><li>å…ç­‰ï¼ˆwait-freeï¼‰ï¼šåœ¨æŸä»½æ•°æ®ä¸Šï¼Œæ¯ä¸ªçº¿ç¨‹ç»è¿‡æœ‰é™æ­¥éª¤å°±èƒ½å®Œæˆè‡ªå·±çš„æ“ä½œï¼Œå³ä¾¿è¯¥ä»½æ•°æ®åŒæ—¶è¢«å…¶ä»–å¤šä¸ªçº¿ç¨‹æ‰€æ“ä½œã€‚</li></ul><h3 id="æ— é”æ•°æ®ç»“æ„"><a href="#æ— é”æ•°æ®ç»“æ„" class="headerlink" title="æ— é”æ•°æ®ç»“æ„"></a>æ— é”æ•°æ®ç»“æ„</h3>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++å¹¶å‘ç¼–ç¨‹å®æˆ˜Chapter5</title>
    <link href="/2025/02/17/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter5/"/>
    <url>/2025/02/17/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter5/</url>
    
    <content type="html"><![CDATA[<h1 id="5-C-å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ"><a href="#5-C-å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ" class="headerlink" title="5 C++å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ"></a>5 C++å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ</h1><h2 id="å†…å­˜æ¨¡å‹åŸºç¡€"><a href="#å†…å­˜æ¨¡å‹åŸºç¡€" class="headerlink" title="å†…å­˜æ¨¡å‹åŸºç¡€"></a>å†…å­˜æ¨¡å‹åŸºç¡€</h2><h3 id="å¯¹è±¡ã€å†…å­˜åŒºåŸŸå’Œå¹¶å‘"><a href="#å¯¹è±¡ã€å†…å­˜åŒºåŸŸå’Œå¹¶å‘" class="headerlink" title="å¯¹è±¡ã€å†…å­˜åŒºåŸŸå’Œå¹¶å‘"></a>å¯¹è±¡ã€å†…å­˜åŒºåŸŸå’Œå¹¶å‘</h3><p>æ‰€æœ‰ä¸å¤šçº¿ç¨‹ç›¸å…³çš„äº‹é¡¹éƒ½ä¼šç‰µæ¶‰å†…å­˜åŒºåŸŸã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹å„è‡ªè®¿é—®åˆ†ç¦»çš„å†…å­˜åŒºåŸŸï¼Œåˆ™ç›¸å®‰æ— äº‹ï¼Œä¸€åˆ‡è¿ä½œè‰¯å¥½ï¼›åä¹‹ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å†…å­˜åŒºåŸŸï¼Œæˆ‘ä»¬å°±è¦è­¦æƒ•äº†ã€‚å‡ä½¿æ²¡æœ‰çº¿ç¨‹æ›´æ–°å†…å­˜åŒºåŸŸï¼Œåˆ™ä¸å¿…åœ¨æ„ï¼Œåªè¯»æ•°æ®æ— é¡»ä¿æŠ¤æˆ–åŒæ­¥ã€‚</p><p>ä»»ä¸€çº¿ç¨‹æ”¹åŠ¨æ•°æ®éƒ½å¯èƒ½å¼•å‘æ¡ä»¶ç«äº‰ã€‚è¦é¿å…æ¡ä»¶ç«äº‰ï¼Œå°±å¿…é¡»å¼ºåˆ¶ä¸¤ä¸ªçº¿ç¨‹æŒ‰ä¸€å®šçš„æ¬¡åºè®¿é—®ã€‚</p><ul><li>å¯ä»¥ç”¨äº’æ–¥æ¥ä¿è¯è¿™ç§æ¬¡åºã€‚</li><li>åˆ©ç”¨åŸå­æ“ä½œçš„åŒæ­¥æ€§è´¨ï¼Œå¼ºåˆ¶ä¸¤ä¸ªçº¿ç¨‹éµå¾ªä¸€å®šçš„è®¿é—®æ¬¡åºã€‚</li></ul><h3 id="æ”¹åŠ¨åºåˆ—"><a href="#æ”¹åŠ¨åºåˆ—" class="headerlink" title="æ”¹åŠ¨åºåˆ—"></a>æ”¹åŠ¨åºåˆ—</h3><p>åœ¨ä¸€ä¸ªC++ç¨‹åºä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å…·æœ‰ä¸€ä¸ªæ”¹åŠ¨åºåˆ—[1]ï¼Œå®ƒç”±æ‰€æœ‰çº¿ç¨‹åœ¨å¯¹è±¡ä¸Šçš„å…¨éƒ¨å†™æ“ä½œæ„æˆï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå†™æ“ä½œå³ä¸ºå¯¹è±¡çš„åˆå§‹åŒ–ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåºåˆ—ä¼šéšç¨‹åºçš„å¤šæ¬¡è¿è¡Œè€Œå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯åœ¨ç¨‹åºçš„ä»»æ„ä¸€æ¬¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€å«çš„å…¨éƒ¨çº¿ç¨‹éƒ½å¿…é¡»å½¢æˆç›¸åŒçš„æ”¹åŠ¨åºåˆ—ã€‚</p><p>æ”¹åŠ¨åºåˆ—çš„è¦æ±‚ï¼š</p><ul><li>åªè¦æŸçº¿ç¨‹çœ‹åˆ°è¿‡æŸä¸ªå¯¹è±¡ï¼Œåˆ™è¯¥çº¿ç¨‹çš„åç»­è¯»æ“ä½œå¿…é¡»è·å¾—ç›¸å¯¹æ–°è¿‘çš„å€¼</li><li>è¯¥çº¿ç¨‹å°±åŒä¸€å¯¹è±¡çš„åç»­å†™æ“ä½œï¼Œå¿…ç„¶å‡ºç°åœ¨æ”¹åŠ¨åºåˆ—åæ–¹</li><li>å¦‚æœæŸçº¿ç¨‹å…ˆå‘ä¸€ä¸ªå¯¹è±¡å†™æ•°æ®ï¼Œè¿‡åå†è¯»å–å®ƒï¼Œé‚£ä¹ˆå¿…é¡»è¯»å–å‰é¢å†™çš„å€¼ã€‚</li><li>è‹¥åœ¨æ”¹åŠ¨åºåˆ—ä¸­ï¼Œä¸Šè¿°è¯»å†™æ“ä½œä¹‹é—´è¿˜æœ‰åˆ«çš„å†™æ“ä½œï¼Œåˆ™å¿…é¡»è¯»å–æœ€åå†™çš„å€¼ã€‚</li><li>åœ¨ç¨‹åºå†…éƒ¨ï¼Œå¯¹äºåŒä¸€ä¸ªå¯¹è±¡ï¼Œå…¨éƒ¨çº¿ç¨‹éƒ½å¿…é¡»å°±å…¶å½¢æˆç›¸åŒçš„æ”¹åŠ¨åºåˆ—ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¯¹è±¡ä¸Šéƒ½è¦æ±‚å¦‚æ­¤ï¼Œè€Œå¤šä¸ªå¯¹è±¡ä¸Šçš„æ”¹åŠ¨åºåˆ—åªæ˜¯ç›¸å¯¹å…³ç³»ï¼Œçº¿ç¨‹ä¹‹é—´ä¸å¿…è¾¾æˆä¸€è‡´ã€‚</li></ul><h2 id="C-ä¸­çš„åŸå­æ“ä½œåŠå…¶ç±»åˆ«"><a href="#C-ä¸­çš„åŸå­æ“ä½œåŠå…¶ç±»åˆ«" class="headerlink" title="C++ä¸­çš„åŸå­æ“ä½œåŠå…¶ç±»åˆ«"></a>C++ä¸­çš„åŸå­æ“ä½œåŠå…¶ç±»åˆ«</h2><p>åŸå­æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„æ“ä½œï¼ˆindivisible operationï¼‰ã€‚è¯¥æ“ä½œè¦ä¹ˆå®Œå…¨åšå¥½ï¼Œè¦ä¹ˆå®Œå…¨æ²¡åšã€‚</p><h3 id="æ ‡å‡†åŸå­ç±»å‹"><a href="#æ ‡å‡†åŸå­ç±»å‹" class="headerlink" title="æ ‡å‡†åŸå­ç±»å‹"></a>æ ‡å‡†åŸå­ç±»å‹</h3><p>æ ‡å‡†åŸå­ç±»å‹çš„å®šä¹‰ä½äºå¤´æ–‡ä»¶ <code>&lt;atomic&gt;</code> å†…ã€‚è¿™äº›ç±»å‹çš„æ“ä½œå…¨æ˜¯åŸå­åŒ–çš„ï¼Œå¹¶ä¸”ï¼Œæ ¹æ®è¯­è¨€çš„å®šä¹‰ï¼ŒC++å†…å»ºçš„åŸå­æ“ä½œä¹Ÿä»…ä»…æ”¯æŒè¿™äº›ç±»å‹ã€‚</p><p>æ ‡å‡†çš„åŸå­ç±»å‹å‡ ä¹éƒ½å…·å¤‡æˆå‘˜å‡½æ•° <code>is_lock_free()</code> ,(åªæœ‰ <code>std::atomic_flag</code> ä¸å…·å¤‡è¯¥æˆå‘˜å‡½æ•°ï¼Œå®ƒä¸€å®šé‡‡ç”¨æ— é”æ“ä½œ)å‡†è®¸ä½¿ç”¨è€…åˆ¤å®šæŸä¸€ç»™å®šç±»å‹ä¸Šçš„æ“ä½œæ˜¯èƒ½ç”±åŸå­æŒ‡ä»¤ç›´æ¥å®ç°ï¼Œè¿˜æ˜¯è¦å€ŸåŠ©ç¼–è¯‘å™¨å’Œç¨‹åºåº“çš„å†…éƒ¨é”æ¥å®ç°ã€‚</p><p>ä»C++17å¼€å§‹ï¼Œå…¨éƒ¨åŸå­ç±»å‹éƒ½å«æœ‰ä¸€ä¸ªé™æ€å¸¸é‡è¡¨è¾¾å¼æˆå‘˜å˜é‡ï¼Œå½¢å¦‚<code>X::is_always_lock_free</code> ï¼Œè€ƒå¯Ÿç¼–è¯‘ç”Ÿæˆçš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„ç¨‹åºï¼Œå½“ä¸”ä»…å½“åœ¨æ‰€æœ‰æ”¯æŒè¯¥ç¨‹åºè¿è¡Œçš„ç¡¬ä»¶ä¸Šï¼ŒåŸå­ç±»å‹Xå…¨éƒ½ä»¥æ— é”ç»“æ„å½¢å¼å®ç°ï¼Œè¯¥æˆå‘˜å˜é‡çš„å€¼æ‰ä¸ºtrueã€‚</p><p>å¯¹äºåŸå­ç±»å‹ä¸Šçš„æ¯ä¸€ç§æ“ä½œï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æä¾›é¢å¤–çš„å‚æ•°ï¼Œä»æšä¸¾ç±»<code>std::memory_order</code> å–å€¼ï¼Œç”¨äºè®¾å®šæ‰€éœ€çš„å†…å­˜æ¬¡åºè¯­ä¹‰ã€‚å…·æœ‰6ä¸ªå¯èƒ½çš„å€¼ï¼ŒåŒ…æ‹¬ <code>std::memory_order_relaxed</code> ã€<code>std::memory_order_acquire</code> ã€<code>std::memory_order_consume</code> ã€<code>std::memory_order_acq_rel</code> ã€<code>std:: memory_order_release</code> å’Œ <code>std::memory_order_seq_cst</code>ã€‚é»˜è®¤å†…å­˜æ¬¡åºæ˜¯æœ€ä¸¥æ ¼çš„ <code>std::memory_order_seq_cst</code></p><p>æ“ä½œçš„ç±»åˆ«å†³å®šäº†å†…å­˜æ¬¡åºæ‰€å‡†è®¸çš„å–å€¼ï¼š</p><ul><li>å­˜å‚¨ï¼ˆstoreï¼‰æ“ä½œï¼Œå¯é€‰ç”¨çš„å†…å­˜æ¬¡åºæœ‰ <code>std::memory_order_relaxed</code>ã€<code>std::memory_order_release</code> æˆ–<code>std::memory_order_seq_cst</code>ã€‚</li><li>è½½å…¥ï¼ˆloadï¼‰æ“ä½œï¼Œå¯é€‰ç”¨çš„å†…å­˜æ¬¡åºæœ‰ <code>std::memory_order_relaxed</code>ã€<code>std::memory_order_consume</code> ã€<code>std::memory_order_acquire</code> æˆ–<code>std::memory_order_seq_cst</code>ã€‚</li><li>â€œè¯»-æ”¹-å†™â€ï¼ˆread-modify-writeï¼‰æ“ä½œï¼Œå¯é€‰ç”¨çš„å†…å­˜æ¬¡åºæœ‰<code>std::memory_order_relaxed</code> ã€<code>std::memory_order_acquire</code> ã€<code>std::memory_order_consume</code> ã€<code>std::memory_order_acq_rel</code> ã€<code>std:: memory_order_release</code> å’Œ <code>std::memory_order_seq_cst</code></li></ul><h3 id="std-atomic-flag"><a href="#std-atomic-flag" class="headerlink" title="std::atomic_flag"></a><code>std::atomic_flag</code></h3><p><code>std::atomic_flag</code> æ˜¯æœ€ç®€å•çš„æ ‡å‡†åŸå­ç±»å‹ï¼Œè¡¨ç¤ºä¸€ä¸ªå¸ƒå°”æ ‡å¿—ã€‚è¯¥ç±»å‹çš„å¯¹è±¡åªæœ‰ä¸¤ç§çŠ¶æ€ï¼šæˆç«‹æˆ–ç½®é›¶ã€‚<code>std::atomic_flag</code> ç±»å‹çš„å¯¹è±¡å¿…é¡»ç”±å®<code>ATOMIC_FLAG_INIT</code> åˆå§‹åŒ–ï¼Œå®ƒæŠŠæ ‡å¿—åˆå§‹åŒ–ä¸ºç½®é›¶çŠ¶æ€ã€‚</p><p>å®Œæˆåˆå§‹åŒ–åï¼Œæˆ‘ä»¬åªèƒ½æ‰§è¡Œ3ç§æ“ä½œï¼šé”€æ¯ã€ç½®é›¶ã€è¯»å–åŸæœ‰çš„å€¼å¹¶è®¾ç½®æ ‡å¿—æˆç«‹ã€‚è¿™åˆ†åˆ«å¯¹åº”äºææ„å‡½æ•°ã€æˆå‘˜å‡½æ•° <code>clear()</code> ã€æˆå‘˜å‡½æ•° <code>test_and_set()</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ <code>std::atomic_flag</code> æ¥å®ç°è‡ªæ—‹é”ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpinLock</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">SpinLock</span>() : <span class="hljs-built_in">flag</span>(ATOMIC_FLAG_INIT) <br>    &#123; &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">while</span>(flag.<span class="hljs-built_in">test_and_set</span>());<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;<br>        flag.<span class="hljs-built_in">clear</span>();<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    std::atomic_flag flag;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="std-atomic"><a href="#std-atomic" class="headerlink" title="std::atomic&lt;bool&gt;"></a><code>std::atomic&lt;bool&gt;</code></h3><p><code>std::atomic&lt;bool&gt;</code> æ˜¯åŸºäºæ•´æ•°çš„æœ€åŸºæœ¬çš„åŸå­ç±»å‹ã€‚å°½ç®¡ä¹Ÿæ— æ³•æ‹·è´æ„é€ æˆ–æ‹·è´èµ‹å€¼ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯èƒ½ä¾æ®éåŸå­å¸ƒå°”é‡åˆ›å»ºå…¶å¯¹è±¡ï¼Œåˆå§‹å€¼æ˜¯trueæˆ–falseçš†å¯ã€‚è¯¥ç±»å‹çš„å®ä¾‹è¿˜èƒ½æ¥å—éåŸå­å¸ƒå°”é‡çš„èµ‹å€¼ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œä¸æƒ¯ä¾‹ä¸åŒï¼ŒåŸå­ç±»å‹çš„èµ‹å€¼æ“ä½œç¬¦ä¸è¿”å›å¼•ç”¨ï¼Œè€Œæ˜¯æŒ‰å€¼è¿”å›ï¼ˆè¯¥å€¼å±äºå¯¹åº”çš„éåŸå­ç±»å‹ï¼Œè¿”å›çš„æ˜¯èµ‹äºˆçš„å€¼ï¼‰ã€‚</p><p><code>std::atomic&lt;bool&gt;</code> é€šè¿‡ <code>store()</code> æ“ä½œè¿›è¡Œå†™ä½œæ“ï¼Œé€šè¿‡ <code>exchange()</code> æ“ä½œä»£æ›¿ <code>test_and_set()</code> æ“ä½œï¼Œè·å–åŸæœ‰çš„å€¼ï¼Œè‡ªè¡Œé€‰å®šæ–°å€¼ä½œä¸ºæ›¿æ¢ã€‚</p><p>æ”¯æŒå•çº¯çš„è¯»å–ï¼šéšå¼åšæ³•æ˜¯å°†å®ä¾‹è½¬æ¢ä¸ºæ™®é€šå¸ƒå°”å€¼ï¼Œæ˜¾ç¤ºåšæ³•æ˜¯è°ƒç”¨ <code>load()</code>.</p><p>è¿˜å¼•å…¥äº†ä¸€ç§æ“ä½œï¼šè‹¥åŸå­å¯¹è±¡å½“å‰çš„å€¼ç¬¦åˆé¢„æœŸï¼Œå°±èµ‹äºˆæ–°å€¼ã€‚å®ƒä¸<code>exchange()</code> ä¸€æ ·ï¼ŒåŒä¸ºâ€œè¯»-æ”¹-å†™â€æ“ä½œã€‚</p><p>è¿™ä¸€æ–°æ“ä½œè¢«ç§°ä¸ºâ€œæ¯”è¾ƒ-äº¤æ¢â€ï¼ˆcompare-exchangeï¼‰ï¼Œå®ç°å½¢å¼æ˜¯æˆå‘˜å‡½æ•°<code>compare_exchange_weak()</code> å’Œ <code>compare_exchange_strong()</code>ã€‚ä½¿ç”¨è€…ç»™å®šä¸€ä¸ªæœŸæœ›å€¼ï¼ŒåŸå­å˜é‡å°†å®ƒå’Œè‡ªèº«çš„å€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œå°±å­˜å…¥å¦ä¸€æ—¢å®šçš„å€¼ï¼›å¦åˆ™ï¼Œæ›´æ–°æœŸæœ›å€¼æ‰€å±çš„å˜é‡ï¼Œå‘å®ƒèµ‹äºˆåŸå­å˜é‡çš„å€¼ã€‚æ¯”è¾ƒ-äº¤æ¢å‡½æ•°è¿”å›å¸ƒå°”ç±»å‹ï¼Œå¦‚æœå®Œæˆäº†ä¿å­˜åŠ¨ä½œï¼ˆå‰ææ˜¯ä¸¤å€¼ç›¸ç­‰ï¼‰ï¼Œåˆ™æ“ä½œæˆåŠŸï¼Œå‡½æ•°è¿”å› <code>ture</code>ï¼›åä¹‹æ“ä½œå¤±è´¥ï¼Œå‡½æ•°è¿”å› <code>false</code>ã€‚</p><p>å¯¹äº <code>compare_exchange_weak()</code>ï¼Œå³ä½¿åŸå­å˜é‡çš„å€¼ç­‰äºæœŸæœ›å€¼ï¼Œä¿å­˜åŠ¨ä½œè¿˜æ˜¯æœ‰å¯èƒ½å¤±è´¥ï¼Œåœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼ŒåŸå­å˜é‡ç»´æŒåŸå€¼ä¸å˜ï¼Œè¿”å›falseã€‚åŸå­åŒ–çš„æ¯”è¾ƒ-äº¤æ¢å¿…é¡»ç”±ä¸€æ¡æŒ‡ä»¤å•ç‹¬å®Œæˆï¼Œè€ŒæŸäº›å¤„ç†å™¨æ²¡æœ‰è¿™ç§æŒ‡ä»¤ï¼Œæ— ä»ä¿è¯è¯¥æ“ä½œæŒ‰åŸå­åŒ–æ–¹å¼å®Œæˆã€‚è¦å®ç°æ¯”è¾ƒ-äº¤æ¢ï¼Œè´Ÿè´£çš„çº¿ç¨‹åˆ™é¡»æ”¹ä¸ºè¿ç»­è¿è¡Œä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œä½†åœ¨è¿™äº›è®¡ç®—æœºä¸Šï¼Œåªè¦å‡ºç°çº¿ç¨‹æ•°é‡å¤šäºå¤„ç†å™¨æ•°é‡çš„æƒ…å½¢ï¼Œçº¿ç¨‹å°±æœ‰å¯èƒ½æ‰§è¡Œåˆ°ä¸­é€”å› ç³»ç»Ÿè°ƒåº¦è€Œåˆ‡å‡ºï¼Œå¯¼è‡´æ“ä½œå¤±è´¥ã€‚è¿™ç§è®¡ç®—æœºæœ€æœ‰å¯èƒ½å¼•å‘ä¸Šè¿°çš„ä¿å­˜å¤±è´¥ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä½¯è´¥ï¼ˆspurious failureï¼‰ã€‚å…¶è´¥å› ä¸æ˜¯å˜é‡å€¼æœ¬èº«å­˜åœ¨é—®é¢˜ï¼Œè€Œæ˜¯å‡½æ•°æ‰§è¡Œæ—¶æœºä¸å¯¹ã€‚å› ä¸º <code>compare_exchange_weak</code>() å¯èƒ½ä½¯è´¥ï¼Œæ‰€ä»¥å®ƒå¾€å¾€å¿…é¡»é…åˆå¾ªç¯ä½¿ç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">bool</span> expected=<span class="hljs-literal">false</span>;<br><span class="hljs-keyword">extern</span> atomic&lt;<span class="hljs-type">bool</span>&gt; b; <span class="hljs-comment">//ç”±å…¶ä»–æºæ–‡ä»¶çš„ä»£ç è®¾å®šå˜é‡çš„å€¼</span><br><span class="hljs-keyword">while</span>(!b.<span class="hljs-built_in">compare_exchange_weak</span>(expected,<span class="hljs-literal">true</span>) &amp;&amp; !expected);<br></code></pre></td></tr></table></figure><p><strong>weakå’Œstrongç‰ˆæœ¬çš„åŒºåˆ«</strong></p><ul><li>weakç‰ˆæœ¬å¯èƒ½ä¼šå‘ç”Ÿä½¯è´¥ï¼Œå³è™½ç„¶å˜é‡å€¼å’Œé¢„æœŸå€¼ç›¸ç­‰ï¼Œä½†æ˜¯ç”±äºæ‰§è¡Œæ—¶æœºé—®é¢˜ï¼Œå¯¼è‡´è¿”å›false</li><li>strongç‰ˆæœ¬åªæœ‰å’Œé¢„æœŸå€¼ä¸ä¸€æ ·çš„æ—¶å€™æ‰ä¼šè¿”å›falseã€‚</li></ul><p>strongç‰ˆæœ¬è‡ªèº«å†…éƒ¨å«æœ‰ä¸€ä¸ªå¾ªç¯ï¼Œæ€§èƒ½è¾ƒå·®ï¼Œå¯¹äºæŸäº›ç»è¿‡ç®€å•è®¡ç®—å°±èƒ½å¾—å‡ºçš„ä¿å­˜å€¼ï¼Œç”¨weakç‰ˆæœ¬æ€§èƒ½æ›´å¥½ï¼Œå¯¹äºéœ€è¦è€—æ—¶æ‰èƒ½å¾—å‡ºçš„å€¼ï¼Œç”¨strongç‰ˆæœ¬å¯ä»¥é¿å…é‡å¤è®¡ç®—ã€‚</p><h3 id="std-atomic-1"><a href="#std-atomic-1" class="headerlink" title="std::atomic&lt;T*&gt;"></a><code>std::atomic&lt;T*&gt;</code></h3><p>æ¥å£ã€ç‰¹æ€§éƒ½ç±»ä¼¼ <code>std::atomic&lt;bool&gt;</code> ã€‚æä¾›çš„æ–°æ“ä½œæ˜¯ç®—æœ¯å½¢å¼çš„æŒ‡é’ˆè¿ç®—ã€‚æˆå‘˜å‡½æ•° <code>fetch_add()</code> å’Œ <code>fetch_sub()</code> ç»™å‡ºäº†æœ€åŸºæœ¬çš„æ“ä½œï¼Œåˆ†åˆ«å°±å¯¹è±¡ä¸­å­˜å‚¨çš„åœ°å€è¿›è¡ŒåŸå­åŒ–åŠ å‡ï¼Œè¿”å›åŸæ¥çš„åœ°å€ã€‚å¦å¤–ï¼Œè¯¥åŸå­ç±»å‹è¿˜å…·æœ‰åŒ…è£…æˆé‡è½½è¿ç®—ç¬¦çš„+&#x3D;å’Œâˆ’&#x3D;ï¼Œä»¥åŠ++å’Œâˆ’âˆ’çš„å‰åç¼€ç‰ˆæœ¬ï¼Œç”¨èµ·æ¥ååˆ†æ–¹ä¾¿ã€‚</p><h3 id="æ ‡å‡†æ•´æ•°åŸå­ç±»å‹"><a href="#æ ‡å‡†æ•´æ•°åŸå­ç±»å‹" class="headerlink" title="æ ‡å‡†æ•´æ•°åŸå­ç±»å‹"></a>æ ‡å‡†æ•´æ•°åŸå­ç±»å‹</h3><p>åœ¨ <code>std::atomic&lt;int&gt;</code> å’Œ <code>std::atomic&lt;unsigned long long&gt;</code> è¿™æ ·çš„æ•´æ•°åŸå­ç±»å‹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œçš„æ“ä½œé¢‡ä¸ºé½å…¨ï¼šæ—¢åŒ…æ‹¬å¸¸ç”¨çš„åŸå­æ“ä½œï¼ˆload()ã€store()ã€exchange()ã€compare_exchange_weak()å’Œcompare_exchange_strong()ï¼‰ï¼Œä¹ŸåŒ…æ‹¬åŸå­è¿ç®—ï¼ˆfetch_add()ã€fetch_sub()ã€fetch_and()ã€fetch_or()ã€fetch_xor()ï¼‰ï¼Œä»¥åŠè¿™äº›è¿ç®—çš„å¤åˆèµ‹å€¼å½¢å¼ï¼ˆ+&#x3D;ã€âˆ’&#x3D;ã€&amp;&#x3D;ã€|&#x3D;å’Œ^&#x3D;ï¼‰ï¼Œè¿˜æœ‰å‰åç¼€å½¢å¼çš„è‡ªå¢å’Œè‡ªå‡ï¼ˆ++xã€x++ã€âˆ’âˆ’xå’Œxâˆ’âˆ’ï¼‰ã€‚</p><h3 id="æ³›åŒ–çš„-std-atomic-ç±»æ¨¡æ¿"><a href="#æ³›åŒ–çš„-std-atomic-ç±»æ¨¡æ¿" class="headerlink" title="æ³›åŒ–çš„ std::atomic&lt;&gt; ç±»æ¨¡æ¿"></a>æ³›åŒ–çš„ <code>std::atomic&lt;&gt;</code> ç±»æ¨¡æ¿</h3><p>å¯¹äºæŸä¸ªè‡ªå®šä¹‰ç±»å‹UDTï¼Œè¦æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰èƒ½å…·ç°åŒ–å‡º <code>std::atomic&lt;UDT&gt;</code> ï¼š</p><ul><li>å¿…é¡»å…·å¤‡å¹³å®æ‹·è´èµ‹å€¼æ“ä½œç¬¦ï¼ˆtrivial copy-assignment operatorï¼‰</li><li>å®ƒä¸å¾—å«æœ‰ä»»ä½•è™šå‡½æ•°ï¼Œä¹Ÿä¸å¯ä»¥ä»è™šåŸºç±»æ´¾ç”Ÿå¾—å‡º</li><li>å¿…é¡»ç”±ç¼–è¯‘å™¨ä»£å…¶éšå¼ç”Ÿæˆæ‹·è´èµ‹å€¼æ“ä½œç¬¦ï¼›</li><li>è‹¥è‡ªå®šä¹‰ç±»å‹å…·æœ‰åŸºç±»æˆ–éé™æ€æ•°æ®æˆå‘˜ï¼Œåˆ™å®ƒä»¬åŒæ ·å¿…é¡»å…·å¤‡å¹³å®æ‹·è´èµ‹å€¼æ“ä½œç¬¦ã€‚</li></ul><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯”è¾ƒ-äº¤æ¢æ“ä½œæ‰€é‡‡ç”¨çš„æ˜¯é€ä½æ¯”è¾ƒè¿ç®—ï¼Œæ•ˆæœç­‰åŒäºç›´æ¥ä½¿ç”¨<code>memcmp()</code> å‡½æ•°ã€‚å³ä½¿UDTè‡ªè¡Œå®šä¹‰äº†æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œåœ¨è¿™é¡¹æ“ä½œä¸­ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚è‹¥è‡ªå®šä¹‰ç±»å‹å«æœ‰å¡«å……ä½ï¼ˆpadding bitï¼‰ï¼Œå´ä¸å‚ä¸æ™®é€šæ¯”è¾ƒæ“ä½œï¼Œé‚£ä¹ˆå³ä½¿UDTå¯¹è±¡çš„å€¼ç›¸ç­‰ï¼Œæ¯”è¾ƒ-äº¤æ¢æ“ä½œè¿˜æ˜¯ä¼šå¤±è´¥ã€‚</p><p>ç±»å‹ <code>std::atomic&lt;T&gt;</code> çš„æ¥å£ä¸ <code>std::atomic&lt;bool&gt;</code> ç›¸ä¼¼ï¼Œå¯ç”¨çš„æ“ä½œæœ‰é™ï¼ŒåŒ…æ‹¬ <code>load()</code>ã€<code>store()</code>ã€<code>exchange()</code>ã€<code>compare_exchange_weak()</code> å’Œ<code>compare_exchange_strong()</code>ï¼Œä»¥åŠæ¥å—ç±»å‹Tçš„å®ä¾‹çš„èµ‹å€¼ã€è½¬æ¢æˆç±»å‹Tçš„å®ä¾‹ã€‚</p><h3 id="åŸå­æ“ä½œçš„éæˆå‘˜å‡½æ•°"><a href="#åŸå­æ“ä½œçš„éæˆå‘˜å‡½æ•°" class="headerlink" title="åŸå­æ“ä½œçš„éæˆå‘˜å‡½æ•°"></a>åŸå­æ“ä½œçš„éæˆå‘˜å‡½æ•°</h3><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸å°‘åŸå­æ“ä½œï¼Œä½†ä»…é™äºåŸå­ç±»å‹æˆå‘˜å‡½æ•°çš„å½¢å¼ã€‚ä¸è¿‡ï¼Œè¿˜æœ‰ä¼—å¤šéæˆå‘˜å‡½æ•°ï¼Œä¸å„åŸå­ç±»å‹ä¸Šçš„æ‰€æœ‰æ“ä½œé€ä¸€ç­‰ä»·ã€‚å¤§éƒ¨åˆ†éæˆå‘˜å‡½æ•°ä¾æ®å¯¹åº”çš„æˆå‘˜å‡½æ•°å‘½åï¼Œåªä¸è¿‡å† ä»¥å‰ç¼€â€œ <code>atomic_</code> â€ï¼ˆå¦‚<code>std::atomic_load()</code>ï¼‰ï¼Œå®ƒä»¬è¿˜é’ˆå¯¹å„åŸå­ç±»å‹è¿›è¡Œäº†é‡è½½ã€‚åªè¦æœ‰å¯èƒ½æŒ‡å®šå†…å­˜æ¬¡åºï¼Œè¿™äº›å‡½æ•°å°±è¡åŒ–å‡ºä¸¤ä¸ªå˜ä½“ï¼šä¸€ä¸ªå¸¦æœ‰åç¼€â€œ<code>_explicit</code>â€ï¼Œæ¥æ”¶æ›´å¤šå‚æ•°ä»¥æŒ‡å®šå†…å­˜æ¬¡åºï¼Œè€Œå¦ä¸€ä¸ªåˆ™ä¸å¸¦åç¼€ä¹Ÿä¸æ¥æ”¶å†…å­˜æ¬¡åºå‚æ•°ï¼Œå¦‚<code>std::atomic_store_explicit(&amp;atomic_var,new_value,std::memory_order_release)</code>ä¸ <code>std::atomic_store(&amp;atomic_var,new_value)</code>ã€‚æˆå‘˜å‡½æ•°çš„è°ƒç”¨ä¼šéšå¼åœ°æ“ä½œåŸå­å¯¹è±¡ï¼Œä½†æ‰€æœ‰éæˆå‘˜å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘æ‰€è¦æ“ä½œçš„ç›®æ ‡åŸå­å¯¹è±¡ã€‚</p><p>C++æ ‡å‡†åº“è¿˜æä¾›äº†éæˆå‘˜å‡½æ•°ï¼ŒæŒ‰åŸå­åŒ–å½¢å¼è®¿é—® <code>std::shared_ptr&lt;&gt;</code> çš„å®ä¾‹ã€‚æ ‡å‡†åº“ç»™å‡ºäº†å…±äº«æŒ‡é’ˆçš„åŸå­æ“ä½œï¼ˆè½½å…¥ã€å­˜å‚¨ã€äº¤æ¢å’Œæ¯”è¾ƒ-äº¤æ¢ï¼‰ï¼Œå®ƒä»¬ä¸æ ‡å‡†åŸå­ç±»å‹ä¸Šçš„æ“ä½œä¸€æ ·ï¼Œéƒ½æ˜¯å¯¹åº”çš„åŒåå‡½æ•°çš„é‡è½½ï¼Œè€Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°éƒ½å±äº <code>std:shared_ptr&lt;&gt;*</code> ç±»å‹ã€‚</p><h3 id="åŸå­æ“ä½œçš„å†…å­˜é¡ºåº"><a href="#åŸå­æ“ä½œçš„å†…å­˜é¡ºåº" class="headerlink" title="åŸå­æ“ä½œçš„å†…å­˜é¡ºåº"></a>åŸå­æ“ä½œçš„å†…å­˜é¡ºåº</h3><p>åŸå­ç±»å‹ä¸Šçš„æ“ä½œæœä» 6 ç§å†…å­˜æ¬¡åºï¼šmemory_order_relaxedã€memory_order_consumeã€memory_order_acquireã€memory_order_releaseã€memory_order_acq_relå’Œmemory_order_seq_cstã€‚å…¶ä¸­ï¼Œmemory_order_seq_cstæ˜¯å¯é€‰çš„æœ€ä¸¥æ ¼çš„å†…å­˜æ¬¡åºï¼Œå„ç§åŸå­ç±»å‹çš„æ‰€æœ‰æ“ä½œéƒ½é»˜è®¤éµä»è¯¥æ¬¡åºã€‚</p><p>è™½ç„¶å†…å­˜æ¬¡åºå…±æœ‰6ç§ï¼Œä½†å®ƒä»¬åªä»£è¡¨3ç§æ¨¡å¼ï¼š</p><ul><li>å…ˆåä¸€è‡´æ¬¡åºï¼ˆmemory_order_seq_cstï¼‰</li><li>è·å–-é‡Šæ”¾æ¬¡åºï¼ˆmemory_order_consumeã€memory_order_acquireã€memory_order_releaseå’Œmemory_order_acq_relï¼‰</li><li>å®½æ¾æ¬¡åºï¼ˆmemory_order_relaxedï¼‰</li></ul><h4 id="å…ˆåä¸€è‡´æ¬¡åº"><a href="#å…ˆåä¸€è‡´æ¬¡åº" class="headerlink" title="å…ˆåä¸€è‡´æ¬¡åº"></a>å…ˆåä¸€è‡´æ¬¡åº</h4>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[PRO]å†…å­˜æ± </title>
    <link href="/2025/02/15/PRO-%E5%86%85%E5%AD%98%E6%B1%A0/"/>
    <url>/2025/02/15/PRO-%E5%86%85%E5%AD%98%E6%B1%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="å†…å­˜æ± "><a href="#å†…å­˜æ± " class="headerlink" title="å†…å­˜æ± "></a>å†…å­˜æ± </h1><h2 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1 ä»‹ç»"></a>1 ä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯å†…å­˜æ± "><a href="#ä»€ä¹ˆæ˜¯å†…å­˜æ± " class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜æ± "></a>ä»€ä¹ˆæ˜¯å†…å­˜æ± </h3><p>å†…å­˜æ± æ˜¯ä¸€ç§é¢„åˆ†é…å†…å­˜å¹¶è¿›è¡Œé‡å¤åˆ©ç”¨çš„æŠ€æœ¯ã€‚å‡å°‘åŠ¨æ€å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾ï¼Œæå‡ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚æœ¬è´¨ä¸Šæ˜¯ç”³è¯·ä¸€å—è¾ƒå¤§çš„å†…å­˜ï¼Œä¹‹ååœ¨åº”ç”¨å±‚å¯¹è¿™å—å†…å­˜è¿›è¡Œç®¡ç†ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>å‡å°‘åŠ¨æ€å†…å­˜åˆ†é…çš„å¼€é”€</li><li>é¿å…å†…å­˜ç¢ç‰‡</li><li>é™ä½ç³»ç»Ÿè°ƒç”¨é¢‘ç‡</li><li>ç¨³å®šåˆ†é…æ—¶é—´</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>åˆå§‹å†…å­˜å ç”¨è¾ƒå¤§</li><li>å¤æ‚</li><li>ä¸é€‚åˆå¤§å‹å¯¹è±¡</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong></p><ul><li>é«˜é¢‘å°å¯¹è±¡åˆ†é…<ul><li>æ¸¸æˆå¼€å‘ï¼šç²’å­ã€å­å¼¹ã€npcç­‰</li><li>ç½‘ç»œç¼–ç¨‹</li></ul></li><li>å®æ—¶ç³»ç»Ÿï¼šå†…å­˜æ± åˆ†é…å†…å­˜æ—¶é—´ç¨³å®šï¼Œé€‚åˆå®æ—¶æ§åˆ¶ç³»ç»Ÿ</li><li>é«˜æ€§èƒ½è®¡ç®—</li></ul><h2 id="2-å‰ç½®çŸ¥è¯†"><a href="#2-å‰ç½®çŸ¥è¯†" class="headerlink" title="2 å‰ç½®çŸ¥è¯†"></a>2 å‰ç½®çŸ¥è¯†</h2><h3 id="2-1-std-allocator"><a href="#2-1-std-allocator" class="headerlink" title="2.1 std::allocator"></a>2.1 <code>std::allocator</code></h3><h3 id="2-2-è‡ªæ—‹é”"><a href="#2-2-è‡ªæ—‹é”" class="headerlink" title="2.2 è‡ªæ—‹é”"></a>2.2 è‡ªæ—‹é”</h3><p>è‡ªæ—‹é”æ˜¯ä¸€ç§è½»é‡çº§çš„é”æœºåˆ¶ï¼Œç”¨äºå®ç°çº¿ç¨‹åŒæ­¥ã€‚ä»–ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ä¸æ–­å°è¯•è·å–é”ï¼Œé¿å…äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</p><table><thead><tr><th>è‡ªæ—‹é”</th><th>äº’æ–¥é”</th></tr></thead><tbody><tr><td>å¿™ç­‰</td><td>é˜»å¡</td></tr><tr><td>é€‚åˆæŒé”æ—¶é—´å¾ˆçŸ­</td><td>é€‚åˆæŒé”æ—¶é—´é•¿</td></tr><tr><td>æ— éœ€ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ€§èƒ½é«˜</td><td>éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€å¤§</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†…å­˜æ± </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MySql]Mysql</title>
    <link href="/2025/01/29/MySql-Mysql/"/>
    <url>/2025/01/29/MySql-Mysql/</url>
    
    <content type="html"><![CDATA[<h1 id="1-åŸºç¡€çŸ¥è¯†"><a href="#1-åŸºç¡€çŸ¥è¯†" class="headerlink" title="1 åŸºç¡€çŸ¥è¯†"></a>1 åŸºç¡€çŸ¥è¯†</h1><h2 id="1-1-æ•°æ®åº“ç›¸å…³æ¦‚å¿µ"><a href="#1-1-æ•°æ®åº“ç›¸å…³æ¦‚å¿µ" class="headerlink" title="1.1 æ•°æ®åº“ç›¸å…³æ¦‚å¿µ"></a>1.1 æ•°æ®åº“ç›¸å…³æ¦‚å¿µ</h2><p><strong>æ•°æ®åº“</strong>ï¼šå­˜å‚¨æ•°æ®çš„ä»“åº“ï¼Œå…¶ä¸­æ•°æ®æ˜¯æœ‰ç»„ç»‡çš„å­˜å‚¨èµ·æ¥çš„ã€‚</p><p><strong>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</strong>ï¼šæ“çºµå’Œç®¡ç†æ•°æ®åº“çš„è½¯ä»¶</p><p><strong>SQL</strong>ï¼šæ“çºµå…³ç³»å‹æ•°æ®åº“çš„ç¼–ç¨‹è¯­è¨€ã€‚</p><h2 id="1-2-MySQLæ•°æ®åº“çš„å®‰è£…"><a href="#1-2-MySQLæ•°æ®åº“çš„å®‰è£…" class="headerlink" title="1.2 MySQLæ•°æ®åº“çš„å®‰è£…"></a>1.2 MySQLæ•°æ®åº“çš„å®‰è£…</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a><strong>windows</strong></h3><p>ç›´æ¥å»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ï¼ŒæŒ‰ç…§é»˜è®¤å®‰è£…å³å¯ã€‚</p><p><strong>å¯åŠ¨å’Œåœæ­¢</strong></p><ul><li>windows+r è¾“å…¥services.mscæ‰¾åˆ°mysql80ã€‚</li><li>å‘½ä»¤è¡Œè¾“å…¥<ul><li>net start mysql80</li><li>net stop mysql80</li></ul></li></ul><p><strong>å®¢æˆ·ç«¯è¿æ¥</strong></p><ul><li>mysqlæä¾›çš„å®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·</li><li>ç³»ç»Ÿè‡ªå¸¦çš„å‘½ä»¤è¡Œè¿æ¥<ul><li>å‘½ä»¤ï¼š<code>mysql [-h 127.0.0.1] [-P 3306] -u root -p</code></li><li>è¿™ç§æ–¹å¼éœ€è¦é…ç½®ç¯å¢ƒå˜é‡</li></ul></li></ul><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h2 id="1-3-MySQLæ•°æ®æ¨¡å‹"><a href="#1-3-MySQLæ•°æ®æ¨¡å‹" class="headerlink" title="1.3 MySQLæ•°æ®æ¨¡å‹"></a>1.3 MySQLæ•°æ®æ¨¡å‹</h2><p><img src="/../images/MySql-Mysql/image-20250129163345252.png" alt="image-20250129163345252"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯é€šè¿‡SQLå°†è¦æ‰§è¡Œçš„æ“ä½œå‘é€ç»™DBMSï¼Œç„¶åç”±å…¶å¸®åŠ©æˆ‘ä»¬å»æ“ä½œã€åˆ›å»ºæ•°æ®åº“ã€‚</p><p><strong>å…³ç³»å‹æ•°æ®åº“</strong>ï¼šå»ºç«‹åœ¨å…³ç³»æ¨¡å‹åŸºç¡€ä¸Šï¼Œç”±å¤šå¼ ç›¸äº’è¿æ¥çš„äºŒç»´è¡¨ç»„æˆçš„æ•°æ®åº“</p><h1 id="2-SQL"><a href="#2-SQL" class="headerlink" title="2 SQL"></a>2 SQL</h1><h2 id="2-1-SQLé€šç”¨è¯­æ³•"><a href="#2-1-SQLé€šç”¨è¯­æ³•" class="headerlink" title="2.1 SQLé€šç”¨è¯­æ³•"></a>2.1 SQLé€šç”¨è¯­æ³•</h2><ul><li>å¯ä»¥å•è¡Œæˆ–è€…å¤šè¡Œä¹¦å†™ï¼Œä»¥åˆ†å·ç»“å°¾</li><li>å¯ä»¥ä½¿ç”¨ç©ºæ ¼&#x2F;ç¼©è¿›å¢åŠ å¯è¯»æ€§</li><li>ä¸åŒºåˆ†å¤§å°å†™ï¼Œå…³é”®å­—å»ºè®®ç”¨å¤§å†™</li><li>æ³¨é‡Š<ul><li>å•è¡Œæ³¨é‡Šï¼š<code>-- æ³¨é‡Šå†…å®¹</code>&#x2F;<code># æ³¨é‡Šå†…å®¹</code></li><li>å¤šè¡Œæ³¨é‡Šï¼š<code>/*æ³¨é‡Šå†…å®¹*/</code></li></ul></li></ul><h2 id="2-2-SQLåˆ†ç±»"><a href="#2-2-SQLåˆ†ç±»" class="headerlink" title="2.2 SQLåˆ†ç±»"></a>2.2 SQLåˆ†ç±»</h2><p><img src="/../images/MySql-Mysql/image-20250129164541224.png" alt="image-20250129164541224"></p><h2 id="2-3-DDL"><a href="#2-3-DDL" class="headerlink" title="2.3 DDL"></a>2.3 DDL</h2><h3 id="2-3-1-æ•°æ®åº“æ“ä½œ"><a href="#2-3-1-æ•°æ®åº“æ“ä½œ" class="headerlink" title="2.3.1 æ•°æ®åº“æ“ä½œ"></a>2.3.1 æ•°æ®åº“æ“ä½œ</h3><h4 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h4><ul><li>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“: <code>SHOW DATABASES;</code></li><li>æŸ¥è¯¢å½“å‰æ•°æ®åº“: <code>SELECT DATABASE();</code></li></ul><h4 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE [IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>] æ•°æ®åº“å [<span class="hljs-keyword">DEFAULT</span> CHARSET å­—ç¬¦é›†] [<span class="hljs-keyword">COLLATE</span> æ’åºè§„åˆ™];<br></code></pre></td></tr></table></figure><ul><li>if not existsï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼›å­˜åœ¨ä¸è¿›è¡Œä»»ä½•æ“ä½œ</li><li>default charset:æŒ‡å®šå­—ç¬¦é›†</li><li>collateï¼šæŒ‡å®šæ’åºè§„åˆ™</li></ul><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> DATABASE [IF <span class="hljs-keyword">EXISTS</span>] æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><ul><li>if existsï¼šå¦‚æœå­˜åœ¨åˆ™åˆ é™¤</li></ul><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">USE æ•°æ®åº“å;<br></code></pre></td></tr></table></figure><h3 id="2-3-2-è¡¨æ“ä½œ"><a href="#2-3-2-è¡¨æ“ä½œ" class="headerlink" title="2.3.2 è¡¨æ“ä½œ"></a>2.3.2 è¡¨æ“ä½œ</h3><h4 id="æŸ¥è¯¢-1"><a href="#æŸ¥è¯¢-1" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h4><ul><li>æŸ¥çœ‹å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> TABLES;<br></code></pre></td></tr></table></figure><p>å¿…é¡»å…ˆä½¿ç”¨USEè¿›å…¥ä¸€ä¸ªå…·ä½“çš„æ•°æ®åº“ã€‚</p><ul><li>æŸ¥è¯¢è¡¨ç»“æ„</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DESC</span> è¡¨å;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æŒ‡å®šè¡¨çš„å»ºè¡¨è¯­å¥</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å;<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»º-1"><a href="#åˆ›å»º-1" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(<br>å­—æ®µ<span class="hljs-number">1</span> å­—æ®µ<span class="hljs-number">1</span>ç±»å‹ [COMMENT å­—æ®µ<span class="hljs-number">1</span>æ³¨é‡Š],<br>...<br>å­—æ®µn å­—æ®µnç±»å‹ [COMMENT å­—æ®µnæ³¨é‡Š]<br>)[COMMENT è¡¨æ³¨é‡Š];<br></code></pre></td></tr></table></figure><p><strong>ä¾‹å­</strong></p><p><img src="/../images/MySql-Mysql/image-20250129170018326.png" alt="image-20250129170018326"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_user(<br>id <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;ç¼–å·&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) comment <span class="hljs-string">&#x27;å§“å&#x27;</span>,<br>    age <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<br>    gender <span class="hljs-type">varchar</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span><br>    ) comment <span class="hljs-string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;<br></code></pre></td></tr></table></figure><p>ç”¨decså‘½ä»¤æ¥æŸ¥çœ‹è¡¨ç»“æ„</p><p><img src="/../images/MySql-Mysql/image-20250129170540291.png"></p><p>ç”¨show create tableå‘½ä»¤æ¥æŸ¥çœ‹å»ºè¡¨è¯­å¥</p><p><img src="/../images/MySql-Mysql/image-20250129170724563.png" alt="image-20250129170724563"></p><h4 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h4><p>ä¸»è¦åˆ†ä¸ºä¸‰ç±»</p><ul><li>æ•°å€¼ç±»å‹</li><li>å­—ç¬¦ä¸²ç±»å‹</li><li>æ—¥æœŸæ—¶é—´ç±»å‹</li></ul><p><strong>æ•°å€¼ç±»å‹</strong></p><p><img src="/../images/MySql-Mysql/image-20250129171019459.png" alt="image-20250129171019459"></p><p>ä¾‹å­ï¼š</p><ul><li>age TINYINT UNSIGNED</li><li>score double(4,1) # 4ä»£è¡¨æ•´ä½“é•¿åº¦ï¼Œ1ä»£è¡¨å°æ•°ä½æ•°</li></ul><p><strong>å­—ç¬¦ä¸²ç±»å‹</strong></p><p><img src="/../images/MySql-Mysql/image-20250129171353079.png" alt="image-20250129171353079"></p><p>charå’Œvarcharéƒ½éœ€è¦æŒ‡æ˜æœ€å¤§é•¿åº¦ï¼š</p><ul><li>å¯¹äºchar(10):å­˜å‚¨å‡ ä¸ªå­—ç¬¦éƒ½å ç”¨10ä¸ªç©ºé—´ï¼ˆç”¨ç©ºæ ¼è¡¥é½ï¼‰</li><li>å¯¹äºvarchar(10)ï¼šå­˜å‚¨å‡ ä¸ªå­—ç¬¦å°±å ç”¨å‡ ä¸ªå­—ç¬¦çš„ç©ºé—´</li></ul><p>charçš„æ€§èƒ½é«˜ï¼Œvarcharæ€§èƒ½è¾ƒå·®ã€‚</p><p><strong>æ—¥æœŸæ—¶é—´ç±»å‹</strong></p><p><img src="/../images/MySql-Mysql/image-20250129171646683.png" alt="image-20250129171646683"></p><h4 id="ä¿®æ”¹è¡¨"><a href="#ä¿®æ”¹è¡¨" class="headerlink" title="ä¿®æ”¹è¡¨"></a>ä¿®æ”¹è¡¨</h4><ul><li>æ·»åŠ å­—æ®µ</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">ADD</span> å­—æ®µå ç±»å‹ [COMMENT æ³¨é‡Š] [çº¦æŸ];<br></code></pre></td></tr></table></figure><ul><li><p>ä¿®æ”¹å­—æ®µ</p><ul><li>ä¿®æ”¹å­—æ®µç±»å‹</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å MODIFY å­—æ®µå æ–°æ•°æ®ç±»å‹;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹å­—æ®µåå’Œå­—æ®µç±»å‹</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å CHANGE æ—§å­—æ®µå æ–°å­—æ®µå ç±»å‹ [COMMENT æ³¨é‡Š] [çº¦æŸ]<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">DROP</span> å­—æ®µå;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹è¡¨å</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å RENAME <span class="hljs-keyword">TO</span> æ–°è¡¨å;<br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h4><ul><li>åˆ é™¤è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> [IF <span class="hljs-keyword">EXISTS</span>] è¡¨å;<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤æŒ‡å®šè¡¨ï¼Œå¹¶é‡æ–°åˆ›å»ºè¯¥è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å;<br></code></pre></td></tr></table></figure><h2 id="2-4-DML"><a href="#2-4-DML" class="headerlink" title="2.4 DML"></a>2.4 DML</h2><p>å¯¹æ•°æ®åº“ä¸­è¡¨çš„æ•°æ®è®°å½•è¿›è¡Œå¢åˆ æ”¹æ“ä½œã€‚</p><ul><li>æ·»åŠ æ•°æ®(INSERT)</li><li>ä¿®æ”¹æ•°æ®(UPDATE)</li><li>åˆ é™¤æ•°æ®(DELETE)</li></ul><h3 id="2-4-1-æ·»åŠ æ•°æ®"><a href="#2-4-1-æ·»åŠ æ•°æ®" class="headerlink" title="2.4.1 æ·»åŠ æ•°æ®"></a>2.4.1 æ·»åŠ æ•°æ®</h3><ul><li>ç»™æŒ‡å®šå­—æ®µæ·»åŠ æ•°æ®</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> è¡¨å(å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,...) <span class="hljs-keyword">VALUES</span>(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,...);<br></code></pre></td></tr></table></figure><ul><li>ç»™å…¨éƒ¨å­—æ®µæ·»åŠ æ•°æ®</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> è¡¨å <span class="hljs-keyword">VALUES</span>(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,...);<br></code></pre></td></tr></table></figure><ul><li>æ‰¹é‡æ·»åŠ æ•°æ®</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> è¡¨å(å­—æ®µå<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span>,...) <span class="hljs-keyword">VALUES</span>(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,...),(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,...),...;<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> è¡¨å <span class="hljs-keyword">VALUES</span>(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,...),(å€¼<span class="hljs-number">1</span>,å€¼<span class="hljs-number">2</span>,...),...;<br></code></pre></td></tr></table></figure><h3 id="2-4-2-ä¿®æ”¹æ•°æ®"><a href="#2-4-2-ä¿®æ”¹æ•°æ®" class="headerlink" title="2.4.2 ä¿®æ”¹æ•°æ®"></a>2.4.2 ä¿®æ”¹æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> è¡¨å <span class="hljs-keyword">SET</span> å­—æ®µå<span class="hljs-number">1</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">1</span>,å­—æ®µå<span class="hljs-number">2</span><span class="hljs-operator">=</span>å€¼<span class="hljs-number">2</span>,...[ <span class="hljs-keyword">WHERE</span> æ¡ä»¶];<br></code></pre></td></tr></table></figure><h3 id="2-4-3-åˆ é™¤æ•°æ®"><a href="#2-4-3-åˆ é™¤æ•°æ®" class="headerlink" title="2.4.3 åˆ é™¤æ•°æ®"></a>2.4.3 åˆ é™¤æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> è¡¨å [<span class="hljs-keyword">WHERE</span> æ¡ä»¶];<br></code></pre></td></tr></table></figure><h2 id="2-5-DQL"><a href="#2-5-DQL" class="headerlink" title="2.5 DQL"></a>2.5 DQL</h2><p>æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•ã€‚</p><p>å…³é”®å­—ï¼šSELECT</p><p><strong>è¯­æ³•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>å­—æ®µåˆ—è¡¨<br><span class="hljs-keyword">FROM</span> <br>è¡¨ååˆ—è¡¨<br><span class="hljs-keyword">WHERE</span><br>æ¡ä»¶åˆ—è¡¨<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span><br>åˆ†ç»„å­—æ®µåˆ—è¡¨<br><span class="hljs-keyword">HAVING</span><br>åˆ†ç»„åæ¡ä»¶åˆ—è¡¨<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span><br>æ’åºå­—æ®µåˆ—è¡¨<br>LIMIT<br>åˆ†é¡µå‚æ•°<br></code></pre></td></tr></table></figure><h3 id="2-5-1-åŸºæœ¬æŸ¥è¯¢"><a href="#2-5-1-åŸºæœ¬æŸ¥è¯¢" class="headerlink" title="2.5.1 åŸºæœ¬æŸ¥è¯¢"></a>2.5.1 åŸºæœ¬æŸ¥è¯¢</h3><ul><li>æŸ¥è¯¢å¤šä¸ªå­—æ®µ</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µ<span class="hljs-number">1</span>,å­—æ®µ<span class="hljs-number">2</span>,... <span class="hljs-keyword">FROM</span> è¡¨å;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> è¡¨å;<br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®åˆ«å</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µ<span class="hljs-number">1</span> [<span class="hljs-keyword">AS</span> åˆ«å<span class="hljs-number">1</span>], å­—æ®µ<span class="hljs-number">2</span> [<span class="hljs-keyword">AS</span> åˆ«å<span class="hljs-number">2</span>],... <span class="hljs-keyword">FROM</span> è¡¨å;<br></code></pre></td></tr></table></figure><ul><li>å»é™¤é‡å¤è®°å½•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨å;<br></code></pre></td></tr></table></figure><h3 id="2-5-2-æ¡ä»¶æŸ¥è¯¢"><a href="#2-5-2-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="2.5.2 æ¡ä»¶æŸ¥è¯¢"></a>2.5.2 æ¡ä»¶æŸ¥è¯¢</h3><ul><li>åŸºæœ¬è¯­æ³•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨å <span class="hljs-keyword">WHERE</span> æ¡ä»¶åˆ—è¡¨;<br></code></pre></td></tr></table></figure><ul><li>æ¡ä»¶</li></ul><p><img src="/../images/MySql-Mysql/image-20250131193638225.png" alt="image-20250131193638225"></p><p><img src="/../images/MySql-Mysql/image-20250131193646484.png" alt="image-20250131193646484"></p><h3 id="2-5-3-èšåˆå‡½æ•°"><a href="#2-5-3-èšåˆå‡½æ•°" class="headerlink" title="2.5.3 èšåˆå‡½æ•°"></a>2.5.3 èšåˆå‡½æ•°</h3><p>å°†ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¿›è¡Œçºµå‘è®¡ç®—ã€‚</p><p><strong>å¸¸è§èšåˆå‡½æ•°</strong></p><table><thead><tr><th>å‡½æ•°</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>count</td><td>ç»Ÿè®¡æ•°é‡</td></tr><tr><td>max</td><td>æœ€å¤§å€¼</td></tr><tr><td>min</td><td>æœ€å°å€¼</td></tr><tr><td>avg</td><td>å¹³å‡å€¼</td></tr><tr><td>sum</td><td>æ±‚å’Œ</td></tr></tbody></table><p><strong>è¯­æ³•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> èšåˆå‡½æ•°(å­—æ®µåˆ—è¡¨) <span class="hljs-keyword">FROM</span> è¡¨å;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>nullå€¼ä¸å‚ä¸è®¡ç®—ã€‚</p><h3 id="2-5-4-åˆ†ç»„æŸ¥è¯¢"><a href="#2-5-4-åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="2.5.4 åˆ†ç»„æŸ¥è¯¢"></a>2.5.4 åˆ†ç»„æŸ¥è¯¢</h3><p><strong>è¯­æ³•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨å [<span class="hljs-keyword">WHERE</span> æ¡ä»¶] <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> åˆ†ç»„å­—æ®µå [<span class="hljs-keyword">HAVING</span> åˆ†ç»„åè¿‡æ»¤æ¡ä»¶];<br></code></pre></td></tr></table></figure><p><strong>whereä¸havingåŒºåˆ«</strong></p><ul><li>æ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯åˆ†ç»„ä¹‹å‰è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ»¡è¶³whereæ¡ä»¶ï¼Œä¸å‚ä¸åˆ†ç»„ï¼›è€Œhavingæ˜¯åˆ†ç»„ä¹‹åå¯¹ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚</li><li>åˆ¤æ–­æ¡ä»¶ä¸åŒï¼šwhereä¸èƒ½å¯¹èšåˆå‡½æ•°è¿›è¡Œåˆ¤æ–­ï¼Œè€Œhavingå¯ä»¥ã€‚</li></ul><p><strong>æ³¨æ„</strong></p><ul><li>æ‰§è¡Œé¡ºåºï¼šwhere &gt; èšåˆå‡½æ•° &gt; having</li><li>åˆ†ç»„ä¹‹åï¼ŒæŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸ºèšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µï¼ŒæŸ¥è¯¢å…¶ä»–å­—æ®µæ— ä»»ä½•æ„ä¹‰</li></ul><h3 id="2-5-5-æ’åºæŸ¥è¯¢"><a href="#2-5-5-æ’åºæŸ¥è¯¢" class="headerlink" title="2.5.5 æ’åºæŸ¥è¯¢"></a>2.5.5 æ’åºæŸ¥è¯¢</h3><p><strong>è¯­æ³•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨å <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> å­—æ®µ<span class="hljs-number">1</span> æ’åºæ–¹å¼<span class="hljs-number">1</span>, å­—æ®µ<span class="hljs-number">2</span> æ’åºæ–¹å¼<span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure><p><strong>æ’åºæ–¹å¼</strong></p><ul><li>ASCï¼šå‡åºï¼ˆé»˜è®¤å€¼ï¼‰</li><li>DESCï¼šé™åº</li></ul><h3 id="2-5-6-åˆ†é¡µæŸ¥è¯¢"><a href="#2-5-6-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2.5.6 åˆ†é¡µæŸ¥è¯¢"></a>2.5.6 åˆ†é¡µæŸ¥è¯¢</h3><p><strong>è¯­æ³•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨å LIMIT èµ·å§‹ç´¢å¼•,æŸ¥è¯¢è®°å½•æ•°;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><ul><li>èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œèµ·å§‹ç´¢å¼•&#x3D;ï¼ˆæŸ¥è¯¢é¡µç -1ï¼‰* æ¯é¡µè®°å½•æ•°ã€‚</li><li>åˆ†é¡µæŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æ–¹è¨€ï¼Œä¸åŒçš„æ•°æ®åº“æœ‰ä¸åŒçš„å®ç°ï¼Œmysqlæ˜¯LIMIT</li><li>å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ä¸ºlimit 10.</li></ul><h3 id="2-5-7-DQLæ‰§è¡Œé¡ºåº"><a href="#2-5-7-DQLæ‰§è¡Œé¡ºåº" class="headerlink" title="2.5.7 DQLæ‰§è¡Œé¡ºåº"></a>2.5.7 DQLæ‰§è¡Œé¡ºåº</h3><p><img src="/../images/MySql-Mysql/image-20250131201032788.png" alt="image-20250131201032788"></p><h2 id="2-6-DCL"><a href="#2-6-DCL" class="headerlink" title="2.6 DCL"></a>2.6 DCL</h2><p>ç”¨æ¥ç®¡ç†æ•°æ®åº“ç”¨æˆ·ã€æ§åˆ¶æ•°æ®åº“çš„è®¿é—®æƒé™ã€‚</p><h3 id="2-6-1-ç®¡ç†ç”¨æˆ·"><a href="#2-6-1-ç®¡ç†ç”¨æˆ·" class="headerlink" title="2.6.1 ç®¡ç†ç”¨æˆ·"></a>2.6.1 ç®¡ç†ç”¨æˆ·</h3><ul><li>æŸ¥è¯¢ç”¨æˆ·</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">USE mysql;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>;<br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºç”¨æˆ·</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;ä¸»æœºå&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;å¯†ç &#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ç”¨æˆ·å¯†ç </li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;ä¸»æœºå&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;æ–°å¯†ç &#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤ç”¨æˆ·</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;ä¸»æœºå&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="2-6-2-æƒé™æ§åˆ¶"><a href="#2-6-2-æƒé™æ§åˆ¶" class="headerlink" title="2.6.2 æƒé™æ§åˆ¶"></a>2.6.2 æƒé™æ§åˆ¶</h3><p><strong>å¸¸ç”¨æƒé™</strong></p><p><img src="/../images/MySql-Mysql/image-20250131201930250.png" alt="image-20250131201930250"></p><ul><li>æŸ¥è¯¢æƒé™</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;ä¸»æœºå&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>æˆäºˆæƒé™</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> æƒé™åˆ—è¡¨ <span class="hljs-keyword">ON</span> æ•°æ®åº“å.è¡¨å <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;ä¸»æœºå&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>æ’¤é”€æƒé™</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">REVOKE</span> æƒé™åˆ—è¡¨ <span class="hljs-keyword">ON</span> æ•°æ®åº“å.è¡¨å <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>@<span class="hljs-string">&#x27;ä¸»æœºå&#x27;</span>;<br></code></pre></td></tr></table></figure><h1 id="3-å‡½æ•°"><a href="#3-å‡½æ•°" class="headerlink" title="3 å‡½æ•°"></a>3 å‡½æ•°</h1><h2 id="3-1-å­—ç¬¦ä¸²å‡½æ•°"><a href="#3-1-å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="3.1 å­—ç¬¦ä¸²å‡½æ•°"></a>3.1 å­—ç¬¦ä¸²å‡½æ•°</h2><p><img src="/../images/MySql-Mysql/image-20250201121439266.png" alt="image-20250201121439266"></p><h2 id="3-2-æ•°å€¼å‡½æ•°"><a href="#3-2-æ•°å€¼å‡½æ•°" class="headerlink" title="3.2 æ•°å€¼å‡½æ•°"></a>3.2 æ•°å€¼å‡½æ•°</h2><p><img src="/../images/MySql-Mysql/image-20250201121923898.png" alt="image-20250201121923898"></p><h2 id="3-3-æ—¥æœŸå‡½æ•°"><a href="#3-3-æ—¥æœŸå‡½æ•°" class="headerlink" title="3.3 æ—¥æœŸå‡½æ•°"></a>3.3 æ—¥æœŸå‡½æ•°</h2><p><img src="/../images/MySql-Mysql/image-20250201122243626.png" alt="image-20250201122243626"></p><h2 id="3-4-æµç¨‹å‡½æ•°"><a href="#3-4-æµç¨‹å‡½æ•°" class="headerlink" title="3.4 æµç¨‹å‡½æ•°"></a>3.4 æµç¨‹å‡½æ•°</h2><p><img src="/../images/MySql-Mysql/image-20250201122608008.png" alt="image-20250201122608008"></p><h1 id="4-çº¦æŸ"><a href="#4-çº¦æŸ" class="headerlink" title="4 çº¦æŸ"></a>4 çº¦æŸ</h1><p><strong>æ¦‚å¿µ</strong>ï¼šä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®</p><p><strong>ç›®çš„</strong>ï¼šä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„æ­£ç¡®ã€æœ‰æ•ˆå’Œå®Œæ•´</p><p><strong>åˆ†ç±»</strong></p><p><img src="/../images/MySql-Mysql/image-20250201124712615.png" alt="image-20250201124712615"></p><p><strong>æ¡ˆä¾‹</strong></p><p><img src="/../images/MySql-Mysql/image-20250201125133223.png" alt="image-20250201125133223"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span>(<br>    id     <span class="hljs-type">int</span>           <span class="hljs-keyword">primary</span> key auto_increment     comment <span class="hljs-string">&#x27;ç¼–å·&#x27;</span>,<br>    name   <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>)   <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">unique</span>                comment <span class="hljs-string">&#x27;å§“å&#x27;</span>,<br>    age    <span class="hljs-type">int</span> unsigned  <span class="hljs-keyword">check</span>(age <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">120</span>)  comment <span class="hljs-string">&#x27;å¹´é¾„&#x27;</span>,<br>    status <span class="hljs-type">char</span>(<span class="hljs-number">1</span>)       <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;1&#x27;</span>                    comment <span class="hljs-string">&#x27;çŠ¶æ€&#x27;</span>,<br>    gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>)                                      comment <span class="hljs-string">&#x27;æ€§åˆ«&#x27;</span><br>)comment <span class="hljs-string">&#x27;ç”¨æˆ·è¡¨&#x27;</span>;<br><br></code></pre></td></tr></table></figure><h2 id="4-1-å¤–é”®çº¦æŸ"><a href="#4-1-å¤–é”®çº¦æŸ" class="headerlink" title="4.1 å¤–é”®çº¦æŸ"></a>4.1 å¤–é”®çº¦æŸ</h2><p><strong>æ¦‚å¿µ</strong>ï¼šç”¨æ¥è®©ä¸¤å¼ è¡¨çš„æ•°æ®ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚</p><p><img src="/../images/MySql-Mysql/image-20250201130252646.png" alt="image-20250201130252646"></p><p><strong>è¯­æ³•</strong></p><ul><li>æ·»åŠ å¤–é”®</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(<br>å­—æ®µå æ•°æ®ç±»å‹<br>...<br>[<span class="hljs-keyword">CONSTRAINT</span>] [å¤–é”®åç§°] <span class="hljs-keyword">FOREIGN</span> KEY(å¤–é”®å­—æ®µå) <span class="hljs-keyword">REFERENCES</span> ä¸»è¡¨(ä¸»è¡¨åˆ—å)<br>);<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> å¤–é”®åç§° <span class="hljs-keyword">FOREIGN</span> KEY(å¤–é”®å­—æ®µå) <span class="hljs-keyword">REFERENCES</span> ä¸»è¡¨(ä¸»è¡¨åˆ—å);<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤å¤–é”®</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> KEY å¤–é”®åç§°;<br></code></pre></td></tr></table></figure><p><strong>åˆ é™¤&#x2F;æ›´æ–°è¡Œä¸º</strong></p><p><img src="/../images/MySql-Mysql/image-20250201130815062.png" alt="image-20250201130815062"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> å¤–é”®åç§° <span class="hljs-keyword">FOREIGN</span> KEY(å¤–é”®å­—æ®µ) <span class="hljs-keyword">REFERENCES</span> ä¸»è¡¨å(ä¸»è¡¨å­—æ®µå) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br></code></pre></td></tr></table></figure><h1 id="5-å¤šè¡¨æŸ¥è¯¢"><a href="#5-å¤šè¡¨æŸ¥è¯¢" class="headerlink" title="5 å¤šè¡¨æŸ¥è¯¢"></a>5 å¤šè¡¨æŸ¥è¯¢</h1><h2 id="5-1-å¤šè¡¨å…³ç³»"><a href="#5-1-å¤šè¡¨å…³ç³»" class="headerlink" title="5.1 å¤šè¡¨å…³ç³»"></a>5.1 å¤šè¡¨å…³ç³»</h2><h3 id="5-1-1-ä¸€å¯¹å¤š"><a href="#5-1-1-ä¸€å¯¹å¤š" class="headerlink" title="5.1.1 ä¸€å¯¹å¤š"></a>5.1.1 ä¸€å¯¹å¤š</h3><p>ä¾‹å¦‚éƒ¨é—¨ä¸å‘˜å·¥çš„å…³ç³»ï¼Œä¸€ä¸ªéƒ¨é—¨å¯¹åº”å¤šä¸ªå‘˜å·¥ï¼Œä¸€ä¸ªå‘˜å·¥å¯¹åº”ä¸€ä¸ªéƒ¨é—¨ã€‚</p><p>å®ç°ï¼šåœ¨å¤šçš„ä¸€æ–¹å»ºç«‹å¤–é”®ï¼ŒæŒ‡å‘ä¸€çš„ä¸€æ–¹çš„ä¸»é”®ã€‚</p><h3 id="5-1-2-å¤šå¯¹å¤š"><a href="#5-1-2-å¤šå¯¹å¤š" class="headerlink" title="5.1.2 å¤šå¯¹å¤š"></a>5.1.2 å¤šå¯¹å¤š</h3><p>ä¾‹å¦‚å­¦ç”Ÿå’Œè¯¾ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šé—¨è¯¾ç¨‹ï¼Œä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥è¢«å¤šä¸ªå­¦ç”Ÿé€‰ä¿®ã€‚</p><p>å®ç°ï¼šå»ºç«‹ä¸€å¼ ä¸­é—´è¡¨ï¼Œè‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”åŒæ–¹çš„ä¸»é”®ã€‚</p><h3 id="5-1-3-ä¸€å¯¹ä¸€"><a href="#5-1-3-ä¸€å¯¹ä¸€" class="headerlink" title="5.1.3 ä¸€å¯¹ä¸€"></a>5.1.3 ä¸€å¯¹ä¸€</h3><p>ä¾‹å¦‚ç”¨æˆ·ä¸ç”¨æˆ·è¯¦æƒ…ä¹‹é—´çš„å…³ç³»ã€‚å¤šç”¨äºå•è¡¨æ‹†åˆ†ï¼Œå°†ä¸€å¼ è¡¨çš„åŸºç¡€å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå…¶ä»–è¯¦æƒ…æ”¾åœ¨å¦å¤–ä¸€å¼ è¡¨ä¸­ï¼Œä»¥æå‡æ“ä½œæ•ˆç‡ã€‚</p><p>å®ç°ï¼šåœ¨ä»»æ„ä¸€æ–¹åŠ å…¥å¤–é”®ï¼Œå…³è”å¦ä¸€æ–¹çš„ä¸»é”®ï¼Œå¹¶ä¸”è®¾ç½®å¤–é”®ä¸ºå”¯ä¸€çš„ï¼ˆuniqueï¼‰</p><h2 id="5-2-å¤šè¡¨æŸ¥è¯¢æ¦‚è¿°"><a href="#5-2-å¤šè¡¨æŸ¥è¯¢æ¦‚è¿°" class="headerlink" title="5.2 å¤šè¡¨æŸ¥è¯¢æ¦‚è¿°"></a>5.2 å¤šè¡¨æŸ¥è¯¢æ¦‚è¿°</h2><p><strong>æ¦‚è¿°</strong>ï¼šä»å¤šå¼ è¡¨ä¸­æŸ¥è¯¢æ•°æ®</p><p><strong>ç¬›å¡å°”ç§¯</strong>ï¼šä¸¤ä¸ªé›†åˆAå’ŒBçš„æ‰€æœ‰ç»„åˆæƒ…å†µï¼ˆå¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æ¶ˆé™¤æ— æ•ˆçš„ç¬›å¡å°”ç§¯ï¼‰ã€‚</p><h2 id="5-3-è¿æ¥æŸ¥è¯¢"><a href="#5-3-è¿æ¥æŸ¥è¯¢" class="headerlink" title="5.3 è¿æ¥æŸ¥è¯¢"></a>5.3 è¿æ¥æŸ¥è¯¢</h2><h3 id="5-3-1-å†…è¿æ¥"><a href="#5-3-1-å†…è¿æ¥" class="headerlink" title="5.3.1 å†…è¿æ¥"></a>5.3.1 å†…è¿æ¥</h3><p>æŸ¥è¯¢Aã€Bäº¤é›†éƒ¨åˆ†çš„æ•°æ®ã€‚</p><p><strong>è¯­æ³•</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- éšå¼å†…è¿æ¥</span><br><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨<span class="hljs-number">1</span>,è¡¨<span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> æ¡ä»¶;<br><br><span class="hljs-comment">-- æ˜¾å¼å†…è¿æ¥</span><br><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨<span class="hljs-number">1</span> [<span class="hljs-keyword">INNER</span>] <span class="hljs-keyword">JOIN</span> è¡¨<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> è¿æ¥æ¡ä»¶;<br></code></pre></td></tr></table></figure><h3 id="5-3-2-å¤–è¿æ¥"><a href="#5-3-2-å¤–è¿æ¥" class="headerlink" title="5.3.2 å¤–è¿æ¥"></a>5.3.2 å¤–è¿æ¥</h3><h4 id="å·¦å¤–è¿æ¥"><a href="#å·¦å¤–è¿æ¥" class="headerlink" title="å·¦å¤–è¿æ¥"></a>å·¦å¤–è¿æ¥</h4><p>æŸ¥è¯¢å·¦è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤è¡¨äº¤é›†éƒ¨åˆ†çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ è¡¨<span class="hljs-number">1</span> <span class="hljs-keyword">LEFT</span> [<span class="hljs-keyword">OUTER</span>] <span class="hljs-keyword">JOIN</span> è¡¨<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> æ¡ä»¶;<br></code></pre></td></tr></table></figure><h4 id="å³å¤–è¿æ¥"><a href="#å³å¤–è¿æ¥" class="headerlink" title="å³å¤–è¿æ¥"></a>å³å¤–è¿æ¥</h4><p>æŸ¥è¯¢å³è¡¨æ‰€æœ‰æ•°æ®ï¼Œä»¥åŠä¸¤è¡¨äº¤é›†éƒ¨åˆ†çš„æ•°æ®ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ è¡¨<span class="hljs-number">1</span> <span class="hljs-keyword">RIGHT</span> [<span class="hljs-keyword">OUTER</span>] <span class="hljs-keyword">JOIN</span> è¡¨<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> æ¡ä»¶;<br></code></pre></td></tr></table></figure><h3 id="5-3-3-è‡ªè¿æ¥"><a href="#5-3-3-è‡ªè¿æ¥" class="headerlink" title="5.3.3 è‡ªè¿æ¥"></a>5.3.3 è‡ªè¿æ¥</h3><p>å½“å‰è¡¨ä¸è‡ªèº«çš„è¿æ¥æŸ¥è¯¢ï¼Œè‡ªè¿æ¥å¿…é¡»ä½¿ç”¨è¡¨åˆ«åã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨A åˆ«åA <span class="hljs-keyword">JOIN</span> è¡¨A åˆ«åB <span class="hljs-keyword">ON</span> æ¡ä»¶;<br></code></pre></td></tr></table></figure><h2 id="5-4-è”åˆæŸ¥è¯¢"><a href="#5-4-è”åˆæŸ¥è¯¢" class="headerlink" title="5.4 è”åˆæŸ¥è¯¢"></a>5.4 è”åˆæŸ¥è¯¢</h2><p>å…³é”®å­—ï¼šunionï¼Œunion all</p><p>æŠŠå¤šæ¬¡æŸ¥è¯¢çš„ç»“æœåˆå¹¶èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„æŸ¥è¯¢ç»“æœã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨A...<br><span class="hljs-keyword">UNION</span> [<span class="hljs-keyword">ALL</span>]<br><span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨B...;<br></code></pre></td></tr></table></figure><ul><li>UNIONä¼šå¯¹ç»“æœå»é‡</li><li>UNION ALLç›´æ¥å°†ä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœæ‹¼æ¥åˆ°ä¸€èµ·</li><li>å¤šå¼ è¡¨çš„åˆ—æ•°å¿…é¡»ä¿æŒä¸€è‡´ï¼Œå­—æ®µç±»å‹ä¹Ÿéœ€è¦ä¿æŒä¸€è‡´</li></ul><h2 id="5-5-å­æŸ¥è¯¢"><a href="#5-5-å­æŸ¥è¯¢" class="headerlink" title="5.5 å­æŸ¥è¯¢"></a>5.5 å­æŸ¥è¯¢</h2><p>æ¦‚å¿µï¼šåœ¨sqlè¯­å¥ä¸­åµŒå¥—selectè¯­å¥ï¼Œæˆä¸ºåµŒå¥—æŸ¥è¯¢ï¼Œä¹Ÿå«å­æŸ¥è¯¢ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">WHERE</span> column1 <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> column1 <span class="hljs-keyword">FROM</span> t2);<br></code></pre></td></tr></table></figure><h3 id="5-5-1-æ ‡é‡å­æŸ¥è¯¢"><a href="#5-5-1-æ ‡é‡å­æŸ¥è¯¢" class="headerlink" title="5.5.1 æ ‡é‡å­æŸ¥è¯¢"></a>5.5.1 æ ‡é‡å­æŸ¥è¯¢</h3><p>å­æŸ¥è¯¢æ”¾å›çš„ç»“æœæ˜¯å•ä¸ªå€¼ã€‚ </p><p><strong>å¸¸ç”¨çš„æ“ä½œç¬¦</strong>ï¼š&#x3D;,&lt;&gt;,&gt;,&lt;,&gt;&#x3D;,&lt;&#x3D;</p><p><strong>æ¡ˆä¾‹</strong></p><p>æŸ¥è¯¢é”€å”®éƒ¨çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- a å…ˆæŸ¥è¯¢é”€å”®éƒ¨çš„éƒ¨é—¨id</span><br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é”€å”®éƒ¨&#x27;</span>;<br><span class="hljs-comment">-- b å†æŸ¥è¯¢éƒ¨é—¨id=é”€å”®éƒ¨éƒ¨é—¨idçš„å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é”€å”®éƒ¨&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="5-5-2-åˆ—å­æŸ¥è¯¢"><a href="#5-5-2-åˆ—å­æŸ¥è¯¢" class="headerlink" title="5.5.2 åˆ—å­æŸ¥è¯¢"></a>5.5.2 åˆ—å­æŸ¥è¯¢</h3><p>å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯ä¸€åˆ—ã€‚</p><p><strong>å¸¸ç”¨çš„æ“ä½œç¬¦</strong>ï¼šIN, NOT IN, ANY, SOME, ALL</p><p><img src="/../images/MySql-Mysql/image-20250201141909930.png" alt="image-20250201141909930"></p><h3 id="5-5-3-è¡Œå­æŸ¥è¯¢"><a href="#5-5-3-è¡Œå­æŸ¥è¯¢" class="headerlink" title="5.5.3 è¡Œå­æŸ¥è¯¢"></a>5.5.3 è¡Œå­æŸ¥è¯¢</h3><p>å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯ä¸€è¡Œã€‚</p><p><strong>å¸¸ç”¨çš„æ“ä½œç¬¦</strong>ï¼š&#x3D;, &lt;&gt;, IN, NOT IN</p><p><strong>æ¡ˆä¾‹</strong></p><p>æŸ¥è¯¢ä¸å¼ æ— å¿Œå·¥èµ„ä»¥åŠç›´å±é¢†å¯¼ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- a æŸ¥è¯¢å¼ æ— å¿Œçš„å·¥èµ„åŠç›´å±é¢†å¯¼id</span><br><span class="hljs-keyword">select</span> salary, managerid <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span>;<br><span class="hljs-comment">-- ç»“æœ 12500, 1</span><br><span class="hljs-comment">-- b æŸ¥è¯¢ä¸ä¹‹ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">=</span> <span class="hljs-number">12500</span> <span class="hljs-keyword">and</span> managerid <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-comment">-- å¯ä»¥è¿›ä¸€æ­¥ç®€å†™ä¸º</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> (salary, mangerid) <span class="hljs-operator">=</span> (<span class="hljs-number">12500</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br><br><span class="hljs-comment">-- è¿›ä¸€æ­¥ç”¨å­æŸ¥è¯¢</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> (salary, mangerid) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> salary, managerid <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å¼ æ— å¿Œ&#x27;</span>;);<br></code></pre></td></tr></table></figure><h3 id="5-5-4-è¡¨å­æŸ¥è¯¢"><a href="#5-5-4-è¡¨å­æŸ¥è¯¢" class="headerlink" title="5.5.4 è¡¨å­æŸ¥è¯¢"></a>5.5.4 è¡¨å­æŸ¥è¯¢</h3><p>å­æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—ã€‚</p><p><strong>å¸¸ç”¨çš„æ“ä½œ</strong>ï¼šIN</p><p>ä¸»è¦æ˜¯ç”¨åˆ°fromä¹‹åï¼Œå°†ä¸´æ—¶ç»“æœä½œä¸ºè¡¨ä»ä¸­æŸ¥è¯¢ã€‚</p><p><strong>æ¡ˆä¾‹</strong></p><p>æŸ¥è¯¢ä¸â€œé¹¿æ–å®¢â€ï¼Œâ€œå®‹è¿œæ¡¥â€çš„èŒä½å’Œè–ªèµ„ç›¸åŒçš„å‘˜å·¥ä¿¡æ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> (job, salary) <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> job, salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;é¹¿æ–å®¢&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å®‹è¿œæ¡¥&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢å…¥èŒæ—¥æœŸæ˜¯â€™2006-01-01â€™ä¹‹åçš„å‘˜å·¥ä¿¡æ¯ï¼ŒåŠéƒ¨é—¨ä¿¡æ¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.<span class="hljs-operator">*</span>, d.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> entrydate <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2006-01-01&#x27;</span>) e <span class="hljs-keyword">left</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure><h2 id="5-6-å¤šè¡¨æŸ¥è¯¢æ¡ˆä¾‹"><a href="#5-6-å¤šè¡¨æŸ¥è¯¢æ¡ˆä¾‹" class="headerlink" title="5.6 å¤šè¡¨æŸ¥è¯¢æ¡ˆä¾‹"></a>5.6 å¤šè¡¨æŸ¥è¯¢æ¡ˆä¾‹</h2><ul><li>æŸ¥è¯¢å‘˜å·¥çš„å§“åã€å¹´é¾„ã€èŒä½ã€éƒ¨é—¨ä¿¡æ¯ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name, e.age, e.job, d.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp e, dept d <span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢å¹´é¾„å°äº30çš„å‘˜å·¥å§“åã€å¹´é¾„ã€èŒä½ã€éƒ¨é—¨ä¿¡æ¯ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name, e.age, e.job, d.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id <span class="hljs-keyword">where</span> e.age <span class="hljs-operator">&lt;</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æ‹¥æœ‰å‘˜å·¥çš„éƒ¨é—¨IDã€éƒ¨é—¨åç§°ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> d.id, d.name <span class="hljs-keyword">from</span> emp e, dept d <span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æ‰€æœ‰å¹´é¾„å¤§äº40å²çš„å‘˜å·¥ï¼ŒåŠå…¶å½’å±çš„éƒ¨é—¨åç§°ï¼›å¦‚æœå‘˜å·¥æ²¡æœ‰åˆ†é…éƒ¨é—¨ï¼Œä¹Ÿéœ€è¦å±•ç¤ºå‡ºæ¥ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name, d.name <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id <span class="hljs-keyword">where</span> e.age <span class="hljs-operator">&gt;</span> <span class="hljs-number">40</span>;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å·¥èµ„ç­‰çº§ã€‚</li></ul><p><img src="/../images/MySql-Mysql/image-20250201145602955.png" alt="å·¥èµ„ç­‰çº§è¡¨"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name, sg.grade <span class="hljs-keyword">from</span> emp e, salarygrade sg <span class="hljs-keyword">where</span> e.salary <span class="hljs-operator">&gt;=</span> losal <span class="hljs-keyword">and</span> e.salary <span class="hljs-operator">&lt;=</span> hisal;<br><br><span class="hljs-keyword">select</span> e.name, sg.grade <span class="hljs-keyword">from</span> emp e, salarygrade sg <span class="hljs-keyword">where</span> e.salary <span class="hljs-keyword">between</span> sg.losal <span class="hljs-keyword">and</span> sg.hisal;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢ç ”å‘éƒ¨æ‰€æœ‰å‘˜å·¥çš„ä¿¡æ¯åŠå·¥èµ„ç­‰çº§ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.<span class="hljs-operator">*</span>, sg.grade <span class="hljs-keyword">from</span> emp e, salarygrade sg <span class="hljs-keyword">where</span> e.salary <span class="hljs-keyword">between</span> sg.losal <span class="hljs-keyword">and</span> sg.hisal <span class="hljs-keyword">and</span> e.dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç ”å‘éƒ¨&#x27;</span>);<br><br><span class="hljs-keyword">select</span> e.<span class="hljs-operator">*</span>, sg.grade <span class="hljs-string">&#x27;å·¥èµ„ç­‰çº§&#x27;</span><br><span class="hljs-keyword">from</span> emp e, salgrade sg, dept d<br><span class="hljs-keyword">where</span> e.salary <span class="hljs-keyword">between</span> sg.losal <span class="hljs-keyword">and</span> sg.hisal<br>  <span class="hljs-keyword">and</span> e.dept_id <span class="hljs-operator">=</span> d.id<br>  <span class="hljs-keyword">and</span> d.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç ”å‘éƒ¨&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢ç ”å‘éƒ¨å‘˜å·¥çš„å¹³å‡å·¥èµ„ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(e.salary) <span class="hljs-string">&#x27;å¹³å‡è–ªèµ„&#x27;</span><br><span class="hljs-keyword">from</span> emp e, dept d<br><span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id <span class="hljs-keyword">and</span><br>      d.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç ”å‘éƒ¨&#x27;</span>;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢å·¥èµ„æ¯”ç­ç»é«˜çš„å‘˜å·¥ä¿¡æ¯ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.<span class="hljs-operator">*</span><br><span class="hljs-keyword">from</span> emp e<br><span class="hljs-keyword">where</span> e.salary <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ç­ç»&#x27;</span>);<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æ¯”å¹³å‡è–ªèµ„é«˜çš„å‘˜å·¥ä¿¡æ¯ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><br><span class="hljs-keyword">from</span> emp e<br><span class="hljs-keyword">where</span> e.salary <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(salary) <span class="hljs-keyword">from</span> emp);<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢ä½äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥ä¿¡æ¯ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name, e.salary, e.dept_id, t.dept_id, t.avg_sal<br><span class="hljs-keyword">from</span> emp e,<br>     (<span class="hljs-keyword">select</span> dept_id, <span class="hljs-built_in">avg</span>(salary) avg_sal <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dept_id) t<br><span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> t.dept_id<br>  <span class="hljs-keyword">and</span> e.salary <span class="hljs-operator">&lt;</span> t.avg_sal;<br><br><span class="hljs-keyword">select</span> e.<span class="hljs-operator">*</span><br><span class="hljs-keyword">from</span> emp e<br><span class="hljs-keyword">where</span> e.salary <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(salary) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> emp.dept_id <span class="hljs-operator">=</span> e.dept_id);<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯ï¼Œå¹¶ç»Ÿè®¡éƒ¨é—¨çš„å‘˜å·¥äººæ•°ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æŸ¥è¯¢æ‰€æœ‰çš„éƒ¨é—¨ä¿¡æ¯ï¼Œå¹¶ç»Ÿè®¡éƒ¨é—¨çš„å‘˜å·¥äººæ•°ã€‚</span><br><span class="hljs-keyword">select</span> d.name, <span class="hljs-built_in">count</span>(e.name) <span class="hljs-string">&#x27;äººæ•°&#x27;</span><br><span class="hljs-keyword">from</span> dept d<br>         <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> emp e <span class="hljs-keyword">on</span> d.id <span class="hljs-operator">=</span> e.dept_id<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> d.name;<br></code></pre></td></tr></table></figure><h1 id="6-äº‹åŠ¡"><a href="#6-äº‹åŠ¡" class="headerlink" title="6 äº‹åŠ¡"></a>6 äº‹åŠ¡</h1><h2 id="6-1-äº‹åŠ¡ç®€ä»‹"><a href="#6-1-äº‹åŠ¡ç®€ä»‹" class="headerlink" title="6.1 äº‹åŠ¡ç®€ä»‹"></a>6.1 äº‹åŠ¡ç®€ä»‹</h2><p>äº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>é»˜è®¤mysqlçš„äº‹åŠ¡æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œå½“æ‰§è¡Œä¸€æ¡sqlè¯­å¥ï¼Œmysqlä¼šç«‹å³éšå¼çš„æäº¤äº‹åŠ¡ã€‚</p><h2 id="6-2-äº‹åŠ¡æ“ä½œ"><a href="#6-2-äº‹åŠ¡æ“ä½œ" class="headerlink" title="6.2 äº‹åŠ¡æ“ä½œ"></a>6.2 äº‹åŠ¡æ“ä½œ</h2><ul><li>æŸ¥çœ‹&#x2F;è®¾ç½®äº‹åŠ¡æäº¤æ–¹å¼</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@autocommit</span>;<br><br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@autocommit</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@autocommit</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><ul><li>æäº¤äº‹åŠ¡</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">COMMIT</span>;<br></code></pre></td></tr></table></figure><ul><li>å›æ»šäº‹åŠ¡</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></table></figure><ul><li>å¼€å¯äº‹åŠ¡</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">START</span> TRANSACTION <br><span class="hljs-comment">-- æˆ–</span><br><span class="hljs-keyword">BEGIN</span>;<br></code></pre></td></tr></table></figure><h2 id="6-3-äº‹åŠ¡å››å¤§ç‰¹æ€§ACID"><a href="#6-3-äº‹åŠ¡å››å¤§ç‰¹æ€§ACID" class="headerlink" title="6.3 äº‹åŠ¡å››å¤§ç‰¹æ€§ACID"></a>6.3 äº‹åŠ¡å››å¤§ç‰¹æ€§ACID</h2><ul><li>åŸå­æ€§ï¼ˆatuomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒã€‚</li><li>ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€</li><li>éš”ç¦»æ€§ï¼ˆisolationï¼‰ï¼šä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œ</li><li>æŒä¹…æ€§ï¼ˆdurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–è€…å›æ»šï¼Œå¯¹æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„</li></ul><h2 id="6-4-å¹¶å‘äº‹åŠ¡é—®é¢˜"><a href="#6-4-å¹¶å‘äº‹åŠ¡é—®é¢˜" class="headerlink" title="6.4 å¹¶å‘äº‹åŠ¡é—®é¢˜"></a>6.4 å¹¶å‘äº‹åŠ¡é—®é¢˜</h2><p><img src="/../images/MySql-Mysql/image-20250201211459327.png" alt="image-20250201211459327"></p><h2 id="6-5-äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#6-5-äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="6.5 äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>6.5 äº‹åŠ¡éš”ç¦»çº§åˆ«</h2><p><img src="/../images/MySql-Mysql/image-20250201211735100.png" alt="image-20250201211735100"></p><p>ä»ä¸Šåˆ°ä¸‹ï¼Œéš”ç¦»çº§åˆ«è¶Šæ¥è¶Šé«˜ï¼Œæ€§èƒ½è¶Šæ¥è¶Šå·®ã€‚</p><ul><li>æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@TRANSACTION_ISOLATION</span>;<br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> [SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span>] TRANSACTION ISOLATION LEVEL &#123;READ UNCOMMITTED<span class="hljs-operator">|</span>READ COMMITTED<span class="hljs-operator">|</span>REPEATABLE READ<span class="hljs-operator">|</span>SERIALIZABLE&#125;;<br></code></pre></td></tr></table></figure><p>SESSION|GLOBALå­—æ®µæŒ‡æ˜æ˜¯è®¾ç½®å½“å‰ä¼šè¯çš„éš”ç¦»çº§åˆ«è¿˜æ˜¯å…¨å±€çš„éš”ç¦»çº§åˆ«ã€‚</p><h1 id="7-å­˜å‚¨å¼•æ“"><a href="#7-å­˜å‚¨å¼•æ“" class="headerlink" title="7 å­˜å‚¨å¼•æ“"></a>7 å­˜å‚¨å¼•æ“</h1><h2 id="7-1-mysqlä½“ç³»ç»“æ„"><a href="#7-1-mysqlä½“ç³»ç»“æ„" class="headerlink" title="7.1 mysqlä½“ç³»ç»“æ„"></a>7.1 mysqlä½“ç³»ç»“æ„</h2><p><img src="/../images/MySql-Mysql/image-20250202202859742.png" alt="image-20250202202859742"></p><ul><li>è¿æ¥å±‚ï¼šæœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼Œä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚</li><li>æœåŠ¡å±‚ï¼šç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆç¼“å­˜çš„æŸ¥è¯¢ï¼ŒSQLçš„åˆ†æå’Œä¼˜åŒ–ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰ã€‚</li><li>å¼•æ“å±‚ï¼šå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MvSQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚</li><li>å­˜å‚¨å±‚ï¼šä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ï¼Œ</li></ul><h2 id="7-2-å­˜å‚¨å¼•æ“ç®€ä»‹"><a href="#7-2-å­˜å‚¨å¼•æ“ç®€ä»‹" class="headerlink" title="7.2 å­˜å‚¨å¼•æ“ç®€ä»‹"></a>7.2 å­˜å‚¨å¼•æ“ç®€ä»‹</h2><p>å­˜å‚¨å¼•æ“æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°&#x2F;æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„ã€‚</p><ul><li>åœ¨åˆ›å»ºè¡¨æ—¶ï¼ŒæŒ‡å®šå­˜å‚¨å¼•æ“</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> è¡¨å(<br>å­—æ®µåˆ—è¡¨<br>)ENGINE <span class="hljs-operator">=</span> INNODB;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> ENGINES;<br></code></pre></td></tr></table></figure><h2 id="7-3-å­˜å‚¨å¼•æ“ç‰¹ç‚¹"><a href="#7-3-å­˜å‚¨å¼•æ“ç‰¹ç‚¹" class="headerlink" title="7.3 å­˜å‚¨å¼•æ“ç‰¹ç‚¹"></a>7.3 å­˜å‚¨å¼•æ“ç‰¹ç‚¹</h2><h3 id="7-3-1-InnoDB"><a href="#7-3-1-InnoDB" class="headerlink" title="7.3.1 InnoDB"></a>7.3.1 InnoDB</h3><p>å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“ï¼Œåœ¨mysql5.5ä¹‹åï¼Œä½œä¸ºé»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><ul><li>DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒ<strong>äº‹åŠ¡</strong>ã€‚</li><li><strong>è¡Œçº§é”</strong>ï¼Œæé«˜å¹¶å‘äº‹åŠ¡è®¿é—®ã€‚</li><li>æ”¯æŒ<strong>å¤–é”®</strong>FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›</li></ul><p><strong>æ–‡ä»¶</strong>ï¼š</p><ul><li>xxx.ibdï¼šxxxä»£è¡¨çš„æ˜¯è¡¨åï¼ŒinnoDBå¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·çš„ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¡¨çš„è¡¨ç»“æ„ï¼ˆfrmï¼Œsdiï¼‰ï¼Œæ•°æ®å’Œç´¢å¼•ã€‚</li><li>å‚æ•°ï¼šinnodb_file_per_tableæŒ‡å®šæ˜¯å¦æ¯å¼ è¡¨éƒ½å¯¹åº”ä¸€ä¸ªè¡¨æ–‡ä»¶ã€‚</li></ul><p><strong>é€»è¾‘å­˜å‚¨ç»“æ„</strong></p><p><img src="/../images/MySql-Mysql/image-20250202204450953.png" alt="image-20250202204450953"></p><h3 id="7-3-2-MyISAM"><a href="#7-3-2-MyISAM" class="headerlink" title="7.3.2 MyISAM"></a>7.3.2 MyISAM</h3><p>æ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><ul><li>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®</li><li>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</li><li>è®¿é—®é€Ÿåº¦å¿«</li></ul><p><strong>æ–‡ä»¶</strong></p><ul><li>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li><li>xxx.MYDï¼šå­˜å‚¨æ•°æ®</li><li>xxx.MYIï¼šå­˜å‚¨ç´¢å¼•</li></ul><h3 id="7-3-3-Memory"><a href="#7-3-3-Memory" class="headerlink" title="7.3.3 Memory"></a>7.3.3 Memory</h3><p>å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåªèƒ½ä½œä¸ºä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨</p><ul><li>å†…å­˜å­˜æ”¾ï¼Œè®¿é—®é€Ÿåº¦å¿«</li><li>hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</li></ul><p><strong>æ–‡ä»¶</strong></p><ul><li>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li></ul><p><img src="/../images/MySql-Mysql/image-20250202204822801.png" alt="image-20250202204822801"></p><h2 id="7-4-å­˜å‚¨å¼•æ“é€‰æ‹©"><a href="#7-4-å­˜å‚¨å¼•æ“é€‰æ‹©" class="headerlink" title="7.4 å­˜å‚¨å¼•æ“é€‰æ‹©"></a>7.4 å­˜å‚¨å¼•æ“é€‰æ‹©</h2><ul><li>InnoDBï¼šæ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€‚å¦‚æœåº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢ä¹‹å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆInnoDBå­˜å‚¨å¼•æ“æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚</li><li>MyISAMï¼š å¦‚æœåº”ç”¨æ˜¯ä»¥è¯»æ“ä½œå’Œæ’å…¥æ“ä½œä¸ºä¸»ï¼Œåªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå¹¶ä¸”å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œé‚£ä¹ˆé€‰æ‹©è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚</li><li>MEMORYï¼šå°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºä¸´æ—¶è¡¨åŠç¼“å­˜ã€‚MEMORYçš„ç¼ºé™·å°±æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸”æ— æ³•ä¿éšœæ•°æ®çš„å®‰å…¨æ€§ã€‚</li></ul><h1 id="8-ç´¢å¼•"><a href="#8-ç´¢å¼•" class="headerlink" title="8 ç´¢å¼•"></a>8 ç´¢å¼•</h1><h2 id="8-1-ç´¢å¼•æ¦‚è¿°"><a href="#8-1-ç´¢å¼•æ¦‚è¿°" class="headerlink" title="8.1 ç´¢å¼•æ¦‚è¿°"></a>8.1 ç´¢å¼•æ¦‚è¿°</h2><p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ©mysqlé«˜æ•ˆè·å–æ•°æ®çš„<strong>æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰</strong>ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹æ€§æŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œå¸®åŠ©å¿«é€ŸæŸ¥æ‰¾æ•°æ®ã€‚</p><p><img src="/../images/MySql-Mysql/image-20250205153457238.png" alt="image-20250205153457238"></p><h2 id="8-2-ç´¢å¼•ç»“æ„"><a href="#8-2-ç´¢å¼•ç»“æ„" class="headerlink" title="8.2 ç´¢å¼•ç»“æ„"></a>8.2 ç´¢å¼•ç»“æ„</h2><p><strong>ç´¢å¼•ç»“æ„</strong></p><p>å› å­˜å‚¨å¼•æ“ä¸åŒè€Œæ‰€æœ‰åŒºåˆ«</p><p><img src="/../images/MySql-Mysql/image-20250205153615648.png" alt="image-20250205153615648"></p><p><img src="/../images/MySql-Mysql/image-20250205153700915.png" alt="image-20250205153700915"></p><h3 id="B-æ ‘"><a href="#B-æ ‘" class="headerlink" title="B+æ ‘"></a>B+æ ‘</h3><p><img src="/../images/MySql-Mysql/image-20250205155204239.png" alt="image-20250205155204239"></p><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><ul><li>åªèƒ½ç”±äºå¯¹ç­‰æ¯”è¾ƒï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</li><li>æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åº</li><li>æ•ˆç‡é«˜ï¼Œé€šå¸¸åªéœ€è¦ä¸€æ¬¡æ£€ç´¢ï¼Œé€šå¸¸è¦ä¼˜äºB+æ ‘ç´¢å¼•</li></ul><h3 id="ä¸ºä»€ä¹ˆé‡‡ç”¨b-æ ‘"><a href="#ä¸ºä»€ä¹ˆé‡‡ç”¨b-æ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆé‡‡ç”¨b+æ ‘"></a>ä¸ºä»€ä¹ˆé‡‡ç”¨b+æ ‘</h3><ul><li>ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜</li><li>ç›¸å¯¹äºbæ ‘ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜æ”¾ç´¢å¼•ï¼Œèƒ½å¤Ÿå­˜æ”¾çš„ç´¢å¼•æ›´å¤šï¼Œé«˜åº¦æ›´ä½ï¼Œæ•ˆç‡æ›´é«˜</li><li>ç›¸å¯¹äºhashï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢åŠæ’åºæ“ä½œ</li></ul><h2 id="8-3-ç´¢å¼•åˆ†ç±»"><a href="#8-3-ç´¢å¼•åˆ†ç±»" class="headerlink" title="8.3 ç´¢å¼•åˆ†ç±»"></a>8.3 ç´¢å¼•åˆ†ç±»</h2><p><img src="/../images/MySql-Mysql/image-20250205155915157.png" alt="image-20250205155915157"></p><p><img src="/../images/MySql-Mysql/image-20250205160036466.png" alt="image-20250205160036466"></p><p>èšé›†ç´¢å¼•é€‰å–è§„åˆ™ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œä¸»é”®ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå”¯ä¸€ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œä¹Ÿæ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œinnodbä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªrowidä½œä¸ºéšè—çš„èšé›†ç´¢å¼•</li></ul><p><img src="/../images/MySql-Mysql/image-20250205160313810.png" alt="image-20250205160313810"></p><p><strong>å›è¡¨æŸ¥è¯¢</strong></p><p>å…ˆæ ¹æ®äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼ï¼Œå†æ ¹æ®ä¸»é”®å€¼å»èšé›†ç´¢å¼•ä¸­æ‹¿åˆ°å¯¹åº”çš„è¡Œæ•°æ®ã€‚</p><h2 id="8-4-ç´¢å¼•è¯­æ³•"><a href="#8-4-ç´¢å¼•è¯­æ³•" class="headerlink" title="8.4 ç´¢å¼•è¯­æ³•"></a>8.4 ç´¢å¼•è¯­æ³•</h2><ul><li>åˆ›å»ºç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">UNIQUE</span><span class="hljs-operator">|</span>FULLTEXT] INDEX index_name <span class="hljs-keyword">ON</span> table_name (index_col_name,...);<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªç´¢å¼•å¯ä»¥å…³è”å¤šä¸ªå­—æ®µï¼Œå¦‚æœåªå…³è”ä¸€ä¸ªå­—æ®µï¼Œåˆ™æ˜¯å•åˆ—ç´¢å¼•ï¼Œå¦åˆ™å°±æ˜¯ç»„åˆç´¢å¼•ï¼ˆè”åˆç´¢å¼•ï¼‰ã€‚</p><ul><li>æŸ¥çœ‹ç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> table_name;<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤ç´¢å¼•</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> INDEX index_name <span class="hljs-keyword">ON</span> table_name;<br></code></pre></td></tr></table></figure><h2 id="8-5-SQLæ€§èƒ½åˆ†æ"><a href="#8-5-SQLæ€§èƒ½åˆ†æ" class="headerlink" title="8.5 SQLæ€§èƒ½åˆ†æ"></a>8.5 SQLæ€§èƒ½åˆ†æ</h2><h3 id="8-5-1-SQLæ‰§è¡Œé¢‘ç‡"><a href="#8-5-1-SQLæ‰§è¡Œé¢‘ç‡" class="headerlink" title="8.5.1 SQLæ‰§è¡Œé¢‘ç‡"></a>8.5.1 SQLæ‰§è¡Œé¢‘ç‡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> [<span class="hljs-keyword">GLOBAL</span><span class="hljs-operator">|</span>SESSION] STATUE <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;Com_______&#x27;</span>; # <span class="hljs-number">7</span>ä¸ªä¸‹åˆ’çº¿<br></code></pre></td></tr></table></figure><p><img src="/../images/MySql-Mysql/image-20250205161725617.png" alt="image-20250205161725617"></p><h3 id="8-5-2-æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#8-5-2-æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="8.5.2 æ…¢æŸ¥è¯¢æ—¥å¿—"></a>8.5.2 æ…¢æŸ¥è¯¢æ—¥å¿—</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šå‚æ•°ï¼ˆlong_query_time, å•ä½ï¼šç§’ï¼Œé»˜è®¤10sï¼‰çš„æ‰€æœ‰sqlè¯­å¥çš„æ—¥å¿—ã€‚</p><p>mysqlçš„æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œéœ€è¦åœ¨mysqlçš„é…ç½®æ–‡ä»¶ï¼ˆ&#x2F;etc&#x2F;my.cnfï¼‰ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯</p><p><img src="/../images/MySql-Mysql/image-20250205203414889.png" alt="image-20250205203414889"></p><h3 id="8-5-3-profileè¯¦æƒ…"><a href="#8-5-3-profileè¯¦æƒ…" class="headerlink" title="8.5.3 profileè¯¦æƒ…"></a>8.5.3 profileè¯¦æƒ…</h3><p>show profilesèƒ½å¤Ÿåœ¨åšsqlä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´è€—è´¹æƒ…å†µã€‚é€šè¿‡have_profilingå‚æ•°ï¼Œèƒ½å¤ŸæŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ”¯æŒprofileæ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@have_profiling</span>;<br></code></pre></td></tr></table></figure><p>é»˜è®¤profilingæ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨session&#x2F;globalä¸‹å¼€å¯profiling</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> profiling <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">-- æŸ¥çœ‹æ¯ä¸€æ¡sqlçš„è€—æ—¶åŸºæœ¬æƒ…å†µ</span><br><span class="hljs-keyword">show</span> profiles;<br><br><span class="hljs-comment">-- æŸ¥çœ‹æŒ‡å®šquery_idçš„sqlè¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ</span><br><span class="hljs-keyword">show</span> profile <span class="hljs-keyword">for</span> query query_id;<br><span class="hljs-comment">-- æŸ¥çœ‹æŒ‡å®šquery_idçš„sqlè¯­å¥çš„cpuä½¿ç”¨æƒ…å†µ</span><br><span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query query_id;<br></code></pre></td></tr></table></figure><h3 id="8-5-4-explainæ‰§è¡Œè®¡åˆ’"><a href="#8-5-4-explainæ‰§è¡Œè®¡åˆ’" class="headerlink" title="8.5.4 explainæ‰§è¡Œè®¡åˆ’"></a>8.5.4 explainæ‰§è¡Œè®¡åˆ’</h3><p>explainæˆ–è€…descå‘½ä»¤è·å–mysqlå¦‚ä½•æ‰§è¡Œselectè¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨selectè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- ç›´æ¥åœ¨selectè¯­å¥å‰é¢åŠ ä¸Šexplainæˆ–è€…desc</span><br>EXPLAIN <span class="hljs-keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="hljs-keyword">FROM</span> è¡¨å <span class="hljs-keyword">WHERE</span> æ¡ä»¶;<br></code></pre></td></tr></table></figure><table><thead><tr><th align="left">id</th><th align="left">select_type</th><th align="left">table</th><th align="left">partitions</th><th align="left">type</th><th align="left">possible_keys</th><th align="left">key</th><th align="left">key_len</th><th align="left">ref</th><th align="left">rows</th><th align="left">filtered</th><th align="left">Extra</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">SIMPLE</td><td align="left">account</td><td align="left">null</td><td align="left">ALL</td><td align="left">null</td><td align="left">null</td><td align="left">null</td><td align="left">null</td><td align="left">2</td><td align="left">50</td><td align="left">Using where</td></tr></tbody></table><ul><li>idï¼šselectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºï¼ˆidç›¸åŒï¼Œæ‰§è¡Œé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼Œidä¸åŒï¼Œå€¼è¶Šå¤§ï¼Œè¶Šå…ˆæ‰§è¡Œï¼‰ã€‚</li><li>select_typeï¼šè¡¨ç¤ºæŸ¥è¯¢ç±»å‹ï¼Œå¸¸è§çš„å–å€¼æœ‰simpleï¼ˆç®€å•è¡¨ï¼Œä¸ä½¿ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€primaryï¼ˆä¸»æŸ¥è¯¢ï¼Œå¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€unionï¼ˆunionä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€subqueryï¼ˆå­æŸ¥è¯¢ï¼‰ç­‰ã€‚</li><li><strong>type</strong>ï¼šè¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸ºNULLï¼ˆä¸æ¶‰åŠè¡¨ï¼‰ã€systemï¼ˆç³»ç»Ÿè¡¨ï¼‰ã€constï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ã€eq_refã€refï¼ˆéå”¯ä¸€æ€§ç´¢å¼•ï¼‰ã€rangeã€indexï¼ˆç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯ä»ç„¶å¯¹æ•´æ£µæ ‘è¿›è¡Œæ‰«æï¼‰ã€allï¼ˆå…¨è¡¨æ‰«æï¼‰ã€‚</li><li><strong>possible_keys</strong>ï¼šæ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ã€‚</li><li><strong>key</strong>ï¼šå®é™…ç”¨åˆ°çš„ç´¢å¼•</li><li><strong>key_len</strong>ï¼šä½¿ç”¨åˆ°çš„ç´¢å¼•çš„å­—èŠ‚æ•°ï¼Œè¯¥å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ã€‚</li><li>rowsï¼šmysqlè®¤ä¸ºå¿…é¡»è¦æ‰§è¡ŒæŸ¥è¯¢çš„è¡Œæ•°ï¼Œæ˜¯ä¸€ä¸ªä¼°è®¡å€¼</li><li>filteredï¼šç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”</li></ul><h2 id="8-6-ç´¢å¼•ä½¿ç”¨"><a href="#8-6-ç´¢å¼•ä½¿ç”¨" class="headerlink" title="8.6 ç´¢å¼•ä½¿ç”¨"></a>8.6 ç´¢å¼•ä½¿ç”¨</h2><ul><li>æœ€å·¦å‰ç¼€æ³•åˆ™</li></ul><p>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œå³æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚å¦‚æœä¸åŒ…å«æœ€å·¦è¾¹çš„åˆ—ï¼Œç´¢å¼•å…¨éƒ¨å¤±æ•ˆï¼›å¦‚æœè·³è¿‡äº†éƒ¨åˆ†åˆ—ï¼Œç´¢å¼•ä¼šéƒ¨åˆ†å¤±æ•ˆï¼ˆåé¢çš„å­—æ®µçš„ç´¢å¼•å¤±æ•ˆï¼‰ã€‚</p><ul><li>èŒƒå›´æŸ¥è¯¢</li></ul><p>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;,&lt;)ï¼ŒèŒƒå›´æŸ¥è¯¢å³ä¾§çš„åˆ—ç´¢å¼•å¤±æ•ˆã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession<span class="hljs-operator">=</span><span class="hljs-string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status<span class="hljs-operator">=</span><span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢çš„è¯­å¥ï¼Œstatusç´¢å¼•å¤±æ•ˆã€‚</p><p><strong>è§„é¿æ–¹å¼</strong>å°±æ˜¯åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ï¼Œå°½é‡é‡‡ç”¨&gt;&#x3D;,&lt;&#x3D;ã€‚</p><ul><li>ç´¢å¼•åˆ—è¿ç®—</li></ul><p>ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œå¦åˆ™ç´¢å¼•ä¼šå¤±æ•ˆã€‚</p><ul><li>å­—ç¬¦ä¸²ç±»å‹åŠ å¼•å·</li></ul><p>ä¸åŠ å¼•å·ï¼Œç´¢å¼•ä¼šå¤±æ•ˆ</p><ul><li>æ¨¡ç³ŠæŸ¥è¯¢</li></ul><p>å¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆï¼Œå¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆã€‚</p><ul><li>orè¿æ¥çš„æ¡ä»¶</li></ul><p>ç”¨oråˆ†å¼€çš„æ¡ä»¶ï¼Œå¦‚æœä¸€ä¸ªæœ‰ç´¢å¼•ï¼Œä¸€ä¸ªæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šç”Ÿæ•ˆã€‚</p><p><strong>è§„é¿æ–¹å¼</strong>å°±æ˜¯å¯¹æ¶‰åŠåˆ°çš„åˆ—éƒ½å»ºç«‹ç´¢å¼•ã€‚</p><ul><li>æ•°æ®åˆ†å¸ƒå½±å“</li></ul><p>å¦‚æœmysqlè¯„ä¼°ä½¿ç”¨æ­¤ç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¿˜æ…¢ï¼Œå°±ä¸ä½¿ç”¨ç´¢å¼•ã€‚</p><ul><li>sqlæç¤º</li></ul><p>åœ¨sqlè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚</p><p><img src="/../images/MySql-Mysql/image-20250205212130871.png" alt="image-20250205212130871"></p><p>use indexæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œforce indexæ˜¯å¼ºåˆ¶ã€‚</p><ul><li>è¦†ç›–ç´¢å¼•</li></ul><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ°ï¼‰ï¼Œå‡å°‘select*</p><p>extraä¿¡æ¯ï¼š</p><p><img src="/../images/MySql-Mysql/image-20250205212600517.png" alt="image-20250205212600517"></p><ul><li>å‰ç¼€ç´¢å¼•</li></ul><p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œæœ‰æ—¶å€™ç´¢å¼•å¾ˆé•¿ï¼Œå¯¼è‡´å¤§é‡çš„ç£ç›˜ioï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚æ­¤æ—¶å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å‰ç¼€å»ºç«‹ç´¢å¼•ï¼Œæé«˜ç´¢å¼•æ•ˆç‡ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_name <span class="hljs-keyword">ON</span> table_name(<span class="hljs-keyword">column</span>(n));<br></code></pre></td></tr></table></figure><p>æ ¹æ®ç´¢å¼•çš„é€‰æ‹©æ€§æ¥å†³å®šå‰ç¼€é•¿åº¦ï¼Œé€‰æ‹©æ€§æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ã€‚</p><p>è®¡ç®—é€‰æ‹©æ€§</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> email) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> <span class="hljs-built_in">substring</span>(email,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br></code></pre></td></tr></table></figure><p><img src="/../images/MySql-Mysql/image-20250205213709424.png" alt="image-20250205213709424"></p><ul><li>å•åˆ—ç´¢å¼•å’Œè”åˆç´¢å¼•</li></ul><p>å¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œå»ºè®®å»ºç«‹è”åˆç´¢å¼•ã€‚å¦‚æœè¦†ç›–ç´¢å¼•ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚</p><h2 id="8-7-ç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#8-7-ç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="8.7 ç´¢å¼•è®¾è®¡åŸåˆ™"></a>8.7 ç´¢å¼•è®¾è®¡åŸåˆ™</h2><p><img src="/../images/MySql-Mysql/image-20250205214206757.png" alt="image-20250205214206757"></p><h1 id="9-SQLä¼˜åŒ–"><a href="#9-SQLä¼˜åŒ–" class="headerlink" title="9 SQLä¼˜åŒ–"></a>9 SQLä¼˜åŒ–</h1><h2 id="9-1-æ’å…¥æ•°æ®"><a href="#9-1-æ’å…¥æ•°æ®" class="headerlink" title="9.1 æ’å…¥æ•°æ®"></a>9.1 æ’å…¥æ•°æ®</h2><ul><li>æ‰¹é‡æ’å…¥</li></ul><p>é‡‡ç”¨æ‰¹é‡æ’å…¥ä¼˜åŒ–æ’å…¥å¤šæ¡æ•°æ®æ“ä½œï¼Œä¸å»ºè®®è¶…è¿‡1000æ¡ä»¥ä¸Šçš„æ•°æ®ã€‚å¯¹äºå‡ ä¸‡æ¡æ•°æ®ï¼Œå¯ä»¥åˆ†ä¸ºå¤šæ¡æ’å…¥æ‰¹é‡æ“ä½œã€‚</p><ul><li>æ‰‹åŠ¨æäº¤äº‹åŠ¡</li><li>ä¸»é”®é¡ºåºæ’å…¥</li><li>å¤§æ‰¹é‡æ’å…¥æ•°æ®</li></ul><p>ä½¿ç”¨insertæ’å…¥æ€§èƒ½è¾ƒä½ï¼Œå¯ä»¥ä½¿ç”¨loadæŒ‡ä»¤è¿›è¡Œæ’å…¥</p><p><img src="/../images/MySql-Mysql/image-20250206113524201.png" alt="image-20250206113524201"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨æ—¶ï¼ŒåŠ ä¸Šå‚æ•° --local-infile</span><br>mysql <span class="hljs-comment">--local-infile -u root -p</span><br><span class="hljs-comment">-- è®¾ç½®å…¨å±€å‚æ•°local_infileä¸º1ï¼Œå¼€å¯ä»æœ¬åœ°åŠ è½½æ–‡ä»¶å¯¼å…¥æ•°æ®çš„å¼€å…³</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> local_infile <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-comment">-- æ‰§è¡ŒloadæŒ‡ä»¤å°†å‡†å¤‡å¥½çš„æ•°æ®ï¼ŒåŠ è½½åˆ°è¡¨ç»“æ„ä¸­</span><br>load data <span class="hljs-keyword">local</span> infile <span class="hljs-string">&#x27;/root/sql1.log&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&#x27;tb_user&#x27;</span> fields terminated <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;,&#x27;</span> lines terminated <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;\n&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="9-2-ä¸»é”®ä¼˜åŒ–"><a href="#9-2-ä¸»é”®ä¼˜åŒ–" class="headerlink" title="9.2 ä¸»é”®ä¼˜åŒ–"></a>9.2 ä¸»é”®ä¼˜åŒ–</h2><ul><li>æ•°æ®ç»„ç»‡æ–¹å¼</li></ul><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®éƒ½æ˜¯æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ï¼ˆindex organized tableï¼ŒIOTï¼‰ã€‚</p><ul><li>é¡µåˆ†è£‚</li></ul><p>é¡µå¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥å¡«å……ä¸€åŠï¼Œä¹Ÿå¯ä»¥å¡«å……100%ï¼Œæ¯ä¸ªé¡µåŒ…å«äº†2-Nè¡Œæ•°æ®ï¼Œæ ¹æ®ä¸»é”®æ’åˆ—ã€‚</p><ul><li>é¡µåˆå¹¶</li></ul><p><img src="/../images/MySql-Mysql/image-20250206114941929.png" alt="image-20250206114941929"></p><ul><li>ä¸»é”®é¡ºåºæ’å…¥</li></ul><p><img src="/../images/MySql-Mysql/image-20250206114618274.png" alt="image-20250206114618274"></p><p>å¯¹äºé¡ºåºæ’å…¥ï¼Œå½“ä¸€é¡µæ»¡äº†ä¹‹åï¼Œç›´æ¥å°†æ–°çš„è¡Œæ•°æ®æ’å…¥åˆ°æ–°åˆ†é…çš„é¡µå†…å³å¯ï¼Œä¸ä¼šå‘ç”Ÿé¡µåˆ†è£‚æƒ…å†µã€‚</p><ul><li>ä¸»é”®ä¹±åºæ’å…¥</li></ul><p><img src="/../images/MySql-Mysql/image-20250206114701480.png" alt="image-20250206114701480"></p><p><img src="/../images/MySql-Mysql/image-20250206114727804.png" alt="image-20250206114727804"></p><p><img src="/../images/MySql-Mysql/image-20250206114738690.png" alt="image-20250206114738690"></p><p>å¯¹äºä¸»é”®ä¹±åºæ’å…¥ï¼Œå½“æ–°çš„è¡Œæ•°æ®æ¥äº†ä¹‹åï¼Œéœ€è¦æ ¹æ®é¡ºåºæ’å…¥ï¼Œæ­¤æ—¶å‰é¢çš„é¡µå¦‚æœæ»¡äº†ï¼Œå°±ä¼šå‘ç”Ÿé¡µåˆ†è£‚ï¼Œå°†é¡µä¸€åŠçš„æ•°æ®å¤åˆ¶åˆ°æ–°é¡µä¸­ï¼Œç„¶åæ’å…¥æ•°æ®ï¼Œå†è°ƒæ•´é“¾è¡¨æŒ‡é’ˆã€‚</p><ul><li><p>ä¸»é”®è®¾è®¡åŸåˆ™</p><ul><li><p>å°½é‡é™ä½ä¸»é”®é•¿åº¦</p><p>å› ä¸ºå¯¹äºäºŒçº§ç´¢å¼•ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œå°±æ˜¯ä¸»é”®ï¼Œä¸»é”®å¦‚æœè¿‡é•¿ï¼Œä¼šå¯¼è‡´äºŒçº§ç´¢å¼•å ç”¨çš„ç©ºé—´å˜å¤§ã€‚</p></li><li><p>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚</p></li><li><p>å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚</p></li><li><p>é¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹</p></li></ul></li></ul><h2 id="9-3-order-byä¼˜åŒ–"><a href="#9-3-order-byä¼˜åŒ–" class="headerlink" title="9.3 order byä¼˜åŒ–"></a>9.3 order byä¼˜åŒ–</h2><p><img src="/../images/MySql-Mysql/image-20250206121348047.png" alt="image-20250206121348047"></p><p><img src="/../images/MySql-Mysql/image-20250206121907392.png" alt="image-20250206121907392"></p><h2 id="9-4-group-byä¼˜åŒ–"><a href="#9-4-group-byä¼˜åŒ–" class="headerlink" title="9.4 group byä¼˜åŒ–"></a>9.4 group byä¼˜åŒ–</h2><ul><li>åˆ†ç»„æ“ä½œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥ä¼˜åŒ–</li><li>éœ€è¦æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™</li></ul><h2 id="9-5-limitä¼˜åŒ–"><a href="#9-5-limitä¼˜åŒ–" class="headerlink" title="9.5 limitä¼˜åŒ–"></a>9.5 limitä¼˜åŒ–</h2><p>å¯¹äºlimitï¼Œå¤§æ•°æ®é‡çš„æ—¶å€™ï¼Œè¶Šå¾€åçš„é¡µï¼ŒèŠ±è´¹æ—¶é—´è¶Šé•¿ã€‚å› æ­¤æ­¤æ—¶mysqléœ€è¦æ’åºå‰é¢çš„æ•°æ®ï¼Œæœ€ååªè¿”å›æœ€åçš„ä¸€é¡µæ•°æ®ã€‚</p><p>ä¼˜åŒ–æ€è·¯ï¼šé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> t.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_sku t, (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tb_sku <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id limit <span class="hljs-number">2000000</span>, <span class="hljs-number">10</span>) a <span class="hljs-keyword">where</span> t.id <span class="hljs-operator">=</span> a.id;<br></code></pre></td></tr></table></figure><h2 id="9-6-countä¼˜åŒ–"><a href="#9-6-countä¼˜åŒ–" class="headerlink" title="9.6 countä¼˜åŒ–"></a>9.6 countä¼˜åŒ–</h2><p><img src="/../images/MySql-Mysql/image-20250206122752072.png" alt="image-20250206122752072"></p><p>ä¼˜åŒ–æ€è·¯ï¼šè‡ªå·±è®¡æ•°ï¼ˆé€šè¿‡redisç­‰ï¼‰ã€‚</p><ul><li><p>countçš„å‡ ç§ç”¨æ³•ï¼šcountæ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœä¸æ˜¯nullï¼Œç´¯è®¡å€¼å°±+1ã€‚</p><ul><li><p>count(*)</p><p><img src="/../images/MySql-Mysql/image-20250206123320304.png" alt="image-20250206123320304"></p></li><li><p>count(ä¸»é”®)</p><p><img src="/../images/MySql-Mysql/image-20250206123336547.png" alt="image-20250206123336547"></p></li><li><p>count(å­—æ®µ)</p><p><img src="/../images/MySql-Mysql/image-20250206123236087.png" alt="image-20250206123236087"></p></li><li><p>count(1)</p><p><img src="/../images/MySql-Mysql/image-20250206123257547.png" alt="image-20250206123257547"></p></li><li><p>æŒ‰ç…§æ•ˆç‡æ’åº</p><p>count(å­—æ®µ)&lt;count(ä¸»é”®)&lt;count(1)çº¦ç­‰äºcount(*)ã€‚ä¸»è¦è€ƒè™‘æ˜¯å¦å–å€¼ï¼Œæ˜¯å¦åˆ¤æ–­ç­‰å› ç´ ã€‚</p></li></ul></li></ul><h2 id="9-7-updateä¼˜åŒ–"><a href="#9-7-updateä¼˜åŒ–" class="headerlink" title="9.7 updateä¼˜åŒ–"></a>9.7 updateä¼˜åŒ–</h2><p> InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•çš„ï¼Œå¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™å°±ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œå¯¼è‡´å¹¶å‘æ€§èƒ½é™ä½ã€‚</p><h1 id="10-è§†å›¾"><a href="#10-è§†å›¾" class="headerlink" title="10 è§†å›¾"></a>10 è§†å›¾</h1><p>è§†å›¾ï¼ˆviewï¼‰æ˜¯ä¸€ç§è™šæ‹Ÿå­˜åœ¨çš„è¡¨ã€‚è§†å›¾ä¸­çš„æ•°æ®å¹¶ä¸åœ¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œè¡Œå’Œåˆ—çš„æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢ä¸­ä½¿ç”¨çš„è¡¨ï¼Œå¹¶ä¸”æ˜¯åœ¨ä½¿ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆçš„ã€‚</p><ul><li>åˆ›å»º</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">OR</span> REPLACE] <span class="hljs-keyword">VIEW</span> è§†å›¾åç§°(åˆ—ååˆ—è¡¨) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span>è¯­å¥ [<span class="hljs-keyword">WITH</span> [<span class="hljs-keyword">CASCADED</span><span class="hljs-operator">|</span><span class="hljs-keyword">LOCAL</span>] <span class="hljs-keyword">CHECK</span> OPTION];<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æŸ¥çœ‹åˆ›å»ºè§†å›¾è¯­å¥</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> è§†å›¾åç§°;<br><br><span class="hljs-comment">-- æŸ¥çœ‹è§†å›¾æ•°æ® å¯ä»¥åƒæ“ä½œè¡¨ä¸€æ ·æ“ä½œè§†å›¾</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> è§†å›¾åç§°;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">OR</span> REPLACE] <span class="hljs-keyword">VIEW</span> è§†å›¾åç§°(åˆ—ååˆ—è¡¨) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span>è¯­å¥ [<span class="hljs-keyword">WITH</span> [<span class="hljs-keyword">CASCADED</span><span class="hljs-operator">|</span><span class="hljs-keyword">LOCAL</span>] <span class="hljs-keyword">CHECK</span> OPTION];<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">VIEW</span> è§†å›¾åç§°(åˆ—ååˆ—è¡¨) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span>è¯­å¥ [<span class="hljs-keyword">WITH</span> [<span class="hljs-keyword">CASCADED</span><span class="hljs-operator">|</span><span class="hljs-keyword">LOCAL</span>] <span class="hljs-keyword">CHECK</span> OPTION];<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> [IF <span class="hljs-keyword">EXISTS</span>] è§†å›¾åç§° [,è§†å›¾åç§°]...;<br></code></pre></td></tr></table></figure><ul><li>æ£€æŸ¥é€‰é¡¹<ul><li>ä½¿ç”¨with check optionåˆ›å»ºè§†å›¾æ—¶ï¼Œmysqlä¼šæ£€æŸ¥æ­£åœ¨æ›´æ”¹çš„è¡Œï¼Œä»¥ä½¿å…¶ç¬¦åˆè§†å›¾å®šä¹‰ã€‚mysqlå…è®¸åŸºäºå¦ä¸€ä¸ªè§†å›¾åˆ›å»ºè§†å›¾ï¼Œå®ƒè¿˜ä¼šæ£€æŸ¥ä¾èµ–è§†å›¾ä¸­çš„è§„åˆ™ä»¥ä¿è¯ä¸€è‡´æ€§ã€‚cascadedå’ŒlocalæŒ‡æ˜äº†æ£€æŸ¥çš„èŒƒå›´ã€‚é»˜è®¤ä¸ºcascadedã€‚</li><li>cascadedï¼šä¼šçº§è”æ£€æŸ¥æ¯ä¸ªä¾èµ–çš„è§†å›¾çš„æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚</li><li>localï¼šä¼šçº§è”æ£€æŸ¥ä¾èµ–è§†å›¾çš„æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœä¾èµ–çš„è§†å›¾æ²¡æœ‰è®¾ç½®æ£€æŸ¥é€‰é¡¹ï¼Œåˆ™ä¸æ£€æŸ¥ã€‚</li></ul></li><li>è§†å›¾çš„æ›´æ–°</li></ul><p>åªæœ‰è§†å›¾ä¸­çš„è¡ŒäºåŸºè¡¨ä¸­çš„è¡Œ<strong>å­˜åœ¨ä¸€å¯¹ä¸€</strong>çš„å…³ç³»æ—¶ï¼Œè§†å›¾æ‰å¯ä»¥æ›´æ–°ï¼Œå¦‚æœè§†å›¾åŒ…å«ä¸€ä¸‹ä»»ä½•ä¸€é¡¹ï¼Œè§†å›¾ä¸å¯æ›´æ–°ï¼š</p><p><img src="/../images/MySql-Mysql/image-20250206155521991.png" alt="image-20250206155521991"></p><ul><li>ä½œç”¨</li></ul><ol><li>ç®€å•ï¼šç®€åŒ–å¯¹æ•°æ®çš„ç†è§£ï¼Œç®€åŒ–æ“ä½œã€‚æŸäº›å¤æ‚æŸ¥è¯¢å¯ä»¥è¢«å®šä¹‰ä¸ºè§†å›¾ï¼Œä»è€Œç®€åŒ–åç»­çš„æŸ¥è¯¢ã€‚</li><li>å®‰å…¨ï¼šæ•°æ®åº“å¯ä»¥æˆæƒï¼Œä½†æ˜¯ä¸èƒ½æˆæƒåˆ°ç‰¹å®šè¡Œå’Œç‰¹å®šåˆ—ä¸Šï¼Œé€šè¿‡è§†å›¾ï¼Œç”¨æˆ·åªèƒ½æŸ¥è¯¢å’Œä¿®æ”¹ä»–ä»¬æ‰€èƒ½è§åˆ°çš„æ•°æ®</li><li>æ•°æ®ç‹¬ç«‹ï¼šå±è”½çœŸå®è¡¨ç»“æ„å¸¦æ¥çš„å˜åŒ–</li></ol><h1 id="11-å­˜å‚¨è¿‡ç¨‹"><a href="#11-å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="11 å­˜å‚¨è¿‡ç¨‹"></a>11 å­˜å‚¨è¿‡ç¨‹</h1><p>å­˜å‚¨è¿‡ç¨‹æ˜¯äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µsqlè¯­å¥çš„é›†åˆï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹å¯ä»¥ç®€åŒ–å¼€å‘äººå‘˜çš„å·¥ä½œï¼Œå‡å°‘æ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå¯ä»¥æé«˜æ•°æ®å¤„ç†æ•ˆç‡ã€‚</p><p>æ€æƒ³ä¸Šï¼Œå­˜å‚¨è¿‡ç¨‹å°±æ˜¯æ•°æ®åº“sqlè¯­è¨€å±‚é¢çš„ä»£ç å°è£…ä¸é‡ç”¨ã€‚</p><ul><li>å°è£…ï¼Œå¤ç”¨</li><li>å¯ä»¥æ¥å—å‚æ•°ï¼Œå¯ä»¥è¿”å›æ•°æ®</li><li>å‡å°‘ç½‘ç»œäº¤äº’ï¼Œæ•ˆç‡æå‡</li></ul><h2 id="11-1-åŸºæœ¬è¯­æ³•"><a href="#11-1-åŸºæœ¬è¯­æ³•" class="headerlink" title="11.1 åŸºæœ¬è¯­æ³•"></a>11.1 åŸºæœ¬è¯­æ³•</h2><ul><li>åˆ›å»º</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> å­˜å‚¨è¿‡ç¨‹åç§°([å‚æ•°åˆ—è¡¨])<br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-comment">-- SQLè¯­å¥</span><br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure><ul><li>è°ƒç”¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CALL</span> åç§°([å‚æ•°]);<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æŸ¥è¯¢æŒ‡å®šæ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹åŠçŠ¶æ€ä¿¡æ¯</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.ROUTINES <span class="hljs-keyword">WHERE</span> ROUTINE_SCHEMA<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXX&#x27;</span>; <span class="hljs-comment">-- XXXæ•°æ®åº“åç§°</span><br><br><span class="hljs-comment">-- æŸ¥è¯¢æŸä¸ªå­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> å­˜å‚¨è¿‡ç¨‹åç§°;<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> [IF <span class="hljs-keyword">EXISTS</span>] å­˜å‚¨è¿‡ç¨‹åç§°;<br></code></pre></td></tr></table></figure><h2 id="11-2-å˜é‡"><a href="#11-2-å˜é‡" class="headerlink" title="11.2 å˜é‡"></a>11.2 å˜é‡</h2><h3 id="11-2-1-ç³»ç»Ÿå˜é‡"><a href="#11-2-1-ç³»ç»Ÿå˜é‡" class="headerlink" title="11.2.1 ç³»ç»Ÿå˜é‡"></a>11.2.1 ç³»ç»Ÿå˜é‡</h3><p>mysqlæœåŠ¡å™¨æä¾›ï¼Œä¸æ˜¯ç”¨æˆ·å®šä¹‰çš„ï¼Œå±äºæœåŠ¡å™¨å±‚é¢ï¼Œåˆ†ä¸º</p><ul><li>å…¨å±€å˜é‡ï¼ˆGLOBALï¼‰ï¼šé’ˆå¯¹æ‰€æœ‰ä¼šè¯æœ‰æ•ˆã€‚</li><li>ä¼šè¯å˜é‡ï¼ˆSESSIONï¼‰ï¼šé’ˆå¯¹å½“å‰ä¼šè¯æœ‰æ•ˆã€‚</li></ul><p><strong>æŸ¥çœ‹ç³»ç»Ÿå˜é‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> [SESSION<span class="hljs-operator">|</span><span class="hljs-keyword">GLOBAL</span>] VARIABLES;<br><span class="hljs-keyword">SHOW</span> [SESSION<span class="hljs-operator">|</span><span class="hljs-keyword">GLOBAL</span>] VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;...&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> @@[SESSION<span class="hljs-operator">|</span>GLOBAL.]ç³»ç»Ÿå˜é‡å;<br></code></pre></td></tr></table></figure><p><strong>è®¾ç½®ç³»ç»Ÿå˜é‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> [SESSION<span class="hljs-operator">|</span><span class="hljs-keyword">GLOBAL</span>] ç³»ç»Ÿå˜é‡å<span class="hljs-operator">=</span>å€¼;<br><span class="hljs-keyword">SET</span> @@[SESSION<span class="hljs-operator">|</span>GLOBAL.]ç³»ç»Ÿå˜é‡å<span class="hljs-operator">=</span>å€¼;<br></code></pre></td></tr></table></figure><p>mysqlæœåŠ¡å™¨é‡å¯ä¹‹åï¼Œå…¨å±€å˜é‡ä¼šé‡ç½®ã€‚å¦‚æœæƒ³æ°¸ä¹…ç”Ÿæ•ˆï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</p><h3 id="11-2-2-ç”¨æˆ·å®šä¹‰å˜é‡"><a href="#11-2-2-ç”¨æˆ·å®šä¹‰å˜é‡" class="headerlink" title="11.2.2 ç”¨æˆ·å®šä¹‰å˜é‡"></a>11.2.2 ç”¨æˆ·å®šä¹‰å˜é‡</h3><p>ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå·±å®šä¹‰çš„å˜é‡ï¼Œä¸ç”¨æå‰å£°æ˜ï¼Œåœ¨ç”¨çš„æ—¶å€™ç›´æ¥ç”¨â€@å˜é‡åâ€œä½¿ç”¨å°±å¯ä»¥ï¼Œå…¶ä½œç”¨åŸŸä¸ºå½“å‰è¿æ¥ã€‚</p><p><strong>èµ‹å€¼</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> <span class="hljs-variable">@var_name</span> <span class="hljs-operator">=</span> expr [, <span class="hljs-variable">@var_name</span> <span class="hljs-operator">=</span> expr]...;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@var_name</span> :<span class="hljs-operator">=</span> expr [, <span class="hljs-variable">@var_name</span> :<span class="hljs-operator">=</span> expr]...;<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@var_name</span> :<span class="hljs-operator">=</span> expr [, <span class="hljs-variable">@var_name</span> :<span class="hljs-operator">=</span> expr]...;<br><span class="hljs-keyword">SELECT</span> å­—æ®µå <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@var_name</span> <span class="hljs-keyword">FROM</span> è¡¨å;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@var_name</span>;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><p>ç”¨æˆ·å®šä¹‰å˜é‡ä¸ç”¨æå‰å£°æ˜ï¼Œå¦‚æœä½¿ç”¨çš„æ—¶å€™è¿˜æ²¡æœ‰èµ‹å€¼ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œåªä¸è¿‡å˜é‡çš„å€¼ä¸ºnull</p><h3 id="11-2-3-å±€éƒ¨å˜é‡"><a href="#11-2-3-å±€éƒ¨å˜é‡" class="headerlink" title="11.2.3 å±€éƒ¨å˜é‡"></a>11.2.3 å±€éƒ¨å˜é‡</h3>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++å¹¶å‘ç¼–ç¨‹å®æˆ˜Chapter6</title>
    <link href="/2025/01/29/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter6/"/>
    <url>/2025/01/29/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter6/</url>
    
    <content type="html"><![CDATA[<h1 id="è®¾è®¡åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„"><a href="#è®¾è®¡åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„" class="headerlink" title="è®¾è®¡åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„"></a>è®¾è®¡åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„</h1><h2 id="å¹¶å‘è®¾è®¡çš„å†…æ¶µ"><a href="#å¹¶å‘è®¾è®¡çš„å†…æ¶µ" class="headerlink" title="å¹¶å‘è®¾è®¡çš„å†…æ¶µ"></a>å¹¶å‘è®¾è®¡çš„å†…æ¶µ</h2><p><strong>çº¿ç¨‹å®‰å…¨</strong></p><p>å¤šçº¿ç¨‹æ‰§è¡Œçš„æ“ä½œæ— è®ºå¼‚åŒï¼Œæ¯ä¸ªçº¿ç¨‹æ‰€è§çš„æ•°æ®ç»“æ„éƒ½æ˜¯è‡ªæ°çš„ï¼›æ•°æ®ä¸ä¼šä¸¢å¤±æˆ–ç ´åï¼Œæ‰€æœ‰ä¸å˜é‡ç»ˆå°†æˆç«‹ï¼Œæ¶æ€§æ¡ä»¶ç«äº‰ä¹Ÿä¸ä¼šå‡ºç°ã€‚</p><p><strong>çœŸæ­£çš„å¹¶å‘</strong></p><p>ä¿æŠ¤çš„èŒƒå›´è¶Šå°ï¼Œéœ€è¦çš„ä¸²è¡ŒåŒ–æ“ä½œå°±è¶Šå°‘ï¼Œå¹¶å‘ç¨‹åº¦å°±å¯èƒ½è¶Šé«˜ã€‚</p><h2 id="åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„"><a href="#åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„" class="headerlink" title="åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„"></a>åŸºäºé”çš„å¹¶å‘æ•°æ®ç»“æ„</h2><h3 id="åŸºäºé”å®ç°çº¿ç¨‹å®‰å…¨çš„æ ˆå®¹å™¨"><a href="#åŸºäºé”å®ç°çº¿ç¨‹å®‰å…¨çš„æ ˆå®¹å™¨" class="headerlink" title="åŸºäºé”å®ç°çº¿ç¨‹å®‰å…¨çš„æ ˆå®¹å™¨"></a>åŸºäºé”å®ç°çº¿ç¨‹å®‰å…¨çš„æ ˆå®¹å™¨</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stack&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;exception&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">empty_stack</span> : std::exception &#123;<br>    <span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">what</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-title">throw</span><span class="hljs-params">()</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeStack</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">ThreadSafeStack</span>() = <span class="hljs-keyword">default</span>;<br>    <span class="hljs-built_in">ThreadSafeStack</span>(<span class="hljs-type">const</span> ThreadSafeStack&amp; other) &#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(other.mtx_)</span></span>;<br>        data_ = other.data_;<br>    &#125;<br>    ThreadSafeStack&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> ThreadSafeStack&amp;) = <span class="hljs-keyword">delete</span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        data_.<span class="hljs-built_in">push</span>(std::<span class="hljs-built_in">move</span>(new_value));<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pop</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        <span class="hljs-keyword">if</span> (data_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">throw</span> <span class="hljs-built_in">empty_stack</span>();<br>        value = std::<span class="hljs-built_in">move</span>(data_.<span class="hljs-built_in">top</span>());<br>        data_.<span class="hljs-built_in">pop</span>();<br>    &#125;<br><br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        <span class="hljs-keyword">if</span> (data_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">throw</span> <span class="hljs-built_in">empty_stack</span>();<br>        <span class="hljs-keyword">auto</span> res = std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(std::<span class="hljs-built_in">move</span>(data_.<span class="hljs-built_in">top</span>());<br>        data_.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br>    <span class="hljs-type">bool</span> <span class="hljs-built_in">empty</span>() <span class="hljs-type">const</span> &#123;<br>        std::lock_guard&lt;std::mutex&gt; <span class="hljs-built_in">lk</span>(mtx_);<br>        <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">empty</span>();<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">mutable</span> std::mutex mtx_;<br>    std::stack&lt;T&gt; data_;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>æ¯ä¸ªæˆå‘˜å‡½æ•°éƒ½åœ¨å†…éƒ¨äº’æ–¥mä¹‹ä¸ŠåŠ é”ï¼Œå› æ­¤è¿™ä¿éšœäº†åŸºæœ¬çš„çº¿ç¨‹å®‰å…¨ã€‚è¿™ç§æ–¹å¼ä¿è¯äº†ä»»ä½•æ—¶åˆ»éƒ½ä»…æœ‰å”¯ä¸€çº¿ç¨‹è®¿é—®æ•°æ®ã€‚</li><li>åœ¨empty()å’Œæ¯ä¸ªpop()é‡è½½ä¹‹é—´ï¼Œéƒ½æ½œè—ç€æ•°æ®ç«äº‰çš„éšæ‚£ã€‚ç„¶è€Œï¼Œpop()å‡½æ•°ä¸ä»…å¯ä»¥åŠ é”ï¼Œå…¶è¿˜å¯ä»¥æ˜æ–‡åˆ¤åˆ«å†…éƒ¨çš„æ ˆå®¹å™¨æ˜¯å¦ä¸ºç©ºï¼Œæ‰€ä»¥è¿™ä¸å±äºæ¶æ€§æ•°æ®ç«äº‰ã€‚</li><li>è¿™æ®µä»£ç æœ‰å¯èƒ½å¼•èµ·æ­»é”ï¼ŒåŸå› æ˜¯æˆ‘ä»¬åœ¨æŒé”æœŸé—´æ‰§è¡Œç”¨æˆ·ä»£ç ï¼šæ ˆå®¹å™¨æ‰€å«çš„æ•°æ®ä¸­ï¼Œæœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„å¤åˆ¶æ„é€ å‡½æ•°ã€ç§»åŠ¨æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼æ“ä½œç¬¦å’Œç§»åŠ¨èµ‹å€¼æ“ä½œç¬¦ï¼Œç”¨æˆ·ä¹Ÿæœ‰å¯èƒ½è‡ªè¡Œé‡è½½newæ“ä½œç¬¦ã€‚å‡ä½¿æ ˆå®¹å™¨è¦æ’å…¥æˆ–ç§»é™¤æ•°æ®ï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­æ•°æ®è‡ªèº«è°ƒç”¨äº†ä¸Šè¿°å‡½æ•°ï¼Œåˆ™å¯èƒ½å†è¿›ä¸€æ­¥è°ƒç”¨æ ˆå®¹å™¨çš„æˆå‘˜å‡½æ•°ï¼Œå› è€Œéœ€è¦è·å–é”ï¼Œä½†ç›¸å…³çš„äº’æ–¥å´å·²è¢«é”ä½ï¼Œæœ€åå¯¼è‡´æ­»é”ã€‚å‘æ ˆå®¹å™¨æ·»åŠ &#x2F;ç§»é™¤æ•°æ®ï¼Œå´ä¸æ¶‰åŠå¤åˆ¶è¡Œä¸ºæˆ–å†…å­˜åˆ†é…ï¼Œè¿™æ˜¯ä¸åˆ‡å®é™…çš„ç©ºæƒ³ã€‚åˆç†çš„è§£å†³æ–¹å¼æ˜¯å¯¹æ ˆå®¹å™¨çš„ä½¿ç”¨è€…æå‡ºè¦æ±‚ï¼Œç”±ä»–ä»¬è´Ÿè´£ä¿è¯é¿å…ä»¥ä¸Šæ­»é”åœºæ™¯ã€‚</li><li>éœ€è¦ä½¿ç”¨è€…ä¿è¯ï¼Œå¿…é¡»å½“å¯¹è±¡æ„é€ å®Œæˆä¹‹åï¼Œåˆ«çš„çº¿ç¨‹æ‰èƒ½è®¿é—®æ•°æ®ï¼›åªæœ‰å½“æ‰€æœ‰çº¿ç¨‹éƒ½åœæ­¢è®¿é—®ï¼Œæ‰å¯ä»¥é”€æ¯å¯¹è±¡ã€‚</li><li>è¯¥å®ç°ä»…å®¹è®¸ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®ã€‚æ€§èƒ½æœ‰é™ã€‚</li><li>è¯¥æ ˆå®¹å™¨å¹¶æœªæä¾›ä»»ä½•ç­‰å¾…&#x2F;æ·»åŠ æ•°æ®çš„æ“ä½œï¼Œå› æ­¤ï¼Œå‡å¦‚æ ˆå®¹å™¨æ»¡è½½æ•°æ®è€Œçº¿ç¨‹åˆç­‰ç€æ·»åŠ æ•°æ®ï¼Œå®ƒå°±å¿…é¡»å®šæœŸåå¤è°ƒç”¨empty()ï¼Œæˆ–é€šè¿‡è°ƒç”¨pop()è€Œæ•è·empty_stackå¼‚å¸¸ï¼Œä»è€ŒæŸ¥éªŒæ ˆå®¹å™¨æ˜¯å¦ä¸ºç©ºã€‚ä¸‡ä¸€çœŸçš„å‡ºç°è¿™ç§æƒ…å†µï¼Œæœ¬ä¾‹çš„æ ˆå®¹å™¨å®ç°å°±ç»éæœ€ä½³é€‰æ‹©ï¼Œå› ä¸ºç­‰å¾…çš„çº¿ç¨‹åªæœ‰è€—è´¹å®è´µçš„ç®—åŠ›æŸ¥éªŒæ•°æ®ï¼Œæˆ–è€…æ ˆå®¹å™¨ä½¿ç”¨è€…ä¸å¾—ä¸å¦è¡Œç¼–å†™ä»£ç ï¼Œä»¥åœ¨å¤–éƒ¨å®ç°â€œç­‰å¾…-é€šçŸ¥â€çš„åŠŸèƒ½ï¼ˆå¦‚åˆ©ç”¨æ¡ä»¶å˜é‡ï¼‰ï¼Œä»¤å†…éƒ¨é”æ“ä½œå˜å¾—å¤šä½™ä¸”æµªè´¹ã€‚</li></ul><h3 id="é‡‡ç”¨é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨"><a href="#é‡‡ç”¨é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨" class="headerlink" title="é‡‡ç”¨é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨"></a>é‡‡ç”¨é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_queue</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">mutable</span> std::mutex mut;<br>    std::queue&lt;T&gt; data_queue;<br>    std::condition_variable data_cond;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">threadsafe_queue</span>()<br>    &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>        data_queue.<span class="hljs-built_in">push</span>(std::<span class="hljs-built_in">move</span>(new_value));<br>        data_cond.<span class="hljs-built_in">notify_one</span>();  <span class="hljs-comment">//  â‡½---  â‘ </span><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait_and_pop</span><span class="hljs-params">(T&amp; value)</span>  <span class="hljs-comment">//  â‡½---  â‘¡</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>        data_cond.<span class="hljs-built_in">wait</span>(lk,[<span class="hljs-keyword">this</span>]&#123;<span class="hljs-keyword">return</span> !data_queue.<span class="hljs-built_in">empty</span>();&#125;);<br>        value=std::<span class="hljs-built_in">move</span>(data_queue.<span class="hljs-built_in">front</span>());<br>        data_queue.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">wait_and_pop</span><span class="hljs-params">()</span>  <span class="hljs-comment">//  â‡½---  â‘¢</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>        data_cond.<span class="hljs-built_in">wait</span>(lk,[<span class="hljs-keyword">this</span>]&#123;<span class="hljs-keyword">return</span> !data_queue.<span class="hljs-built_in">empty</span>();&#125;);  <span class="hljs-comment">//  â‡½---  â‘£</span><br>        <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">res</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;T&gt;(std::move(data_queue.front())))</span></span>;<br>        data_queue.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">try_pop</span><span class="hljs-params">(T&amp; value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>        <span class="hljs-keyword">if</span>(data_queue.<span class="hljs-built_in">empty</span>())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        value=std::<span class="hljs-built_in">move</span>(data_queue.<span class="hljs-built_in">front</span>());<br>        data_queue.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>        <span class="hljs-keyword">if</span>(data_queue.<span class="hljs-built_in">empty</span>())<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();  <span class="hljs-comment">//  â‡½---  â‘¤</span><br>        <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">res</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;T&gt;(std::move(data_queue.front())))</span></span>;<br>        data_queue.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>        <span class="hljs-keyword">return</span> data_queue.<span class="hljs-built_in">empty</span>();<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>å‡å®šåœ¨æ•°æ®å‹å…¥é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆdata_cond.notify_one()çš„è°ƒç”¨åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªã€‚ç„¶è€Œï¼Œè‹¥è¯¥è§‰é†’çš„çº¿ç¨‹åœ¨æ‰§è¡Œwait_and_pop()æ—¶æŠ›å‡ºå¼‚å¸¸ï¼ˆè­¬å¦‚æ–°æŒ‡é’ˆstd::shared_ptr&lt;&gt;åœ¨æ„å»ºæ—¶å°±æœ‰å¯èƒ½äº§ç”Ÿå¼‚å¸¸â‘£ï¼‰ï¼Œå°±ä¸ä¼šæœ‰ä»»ä½•å…¶ä»–çº¿ç¨‹è¢«å”¤é†’ã€‚<ul><li>å¦‚æœæˆ‘ä»¬ä¸èƒ½æ¥å—è¿™ç§è¡Œä¸ºæ–¹å¼ï¼Œåˆ™å°†data_cond.notify_one()æ”¹ä¸ºdata_cond.notify_all()ã€‚è¿™æ ·å°±ä¼šå”¤é†’å…¨ä½“çº¿ç¨‹ï¼Œä½†è¦å¤§å¤§å¢åŠ å¼€é”€ï¼šå®ƒä»¬ç»å¤§å¤šæ•°è¿˜æ˜¯ä¼šå‘ç°é˜Ÿåˆ—ä¾ç„¶ä¸ºç©ºï¼Œåªå¥½é‡æ–°ä¼‘çœ ã€‚</li><li>ç¬¬äºŒç§å¤„ç†æ–¹å¼æ˜¯ï¼Œå€˜è‹¥æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œåˆ™åœ¨wait_and_pop()ä¸­å†æ¬¡è°ƒç”¨notify_one()ï¼Œä»è€Œå†å”¤é†’å¦ä¸€çº¿ç¨‹ï¼Œè®©å®ƒå»è·å–å­˜å‚¨çš„å€¼ã€‚</li><li>ç¬¬ä¸‰ç§å¤„ç†æ–¹å¼æ˜¯ï¼Œå°†std::shared_ptr&lt;&gt;çš„åˆå§‹åŒ–è¯­å¥ç§»åŠ¨åˆ°push()çš„è°ƒç”¨å¤„ï¼Œä»¤é˜Ÿåˆ—å®¹å™¨æ”¹ä¸ºå­˜å‚¨std::shared_ptr&lt;&gt;ï¼Œè€Œä¸å†ç›´æ¥å­˜å‚¨æ•°æ®çš„å€¼ã€‚ä»å†…éƒ¨std::queue&lt;&gt;å¤åˆ¶std::shared_ptr&lt;&gt;å®ä¾‹çš„æ“ä½œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥wait_and_pop()ä¹Ÿæ˜¯å¼‚å¸¸å®‰å…¨çš„ã€‚</li></ul></li></ul><h3 id="é‡‡ç”¨ç²¾ç»†ç²’åº¦çš„é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨"><a href="#é‡‡ç”¨ç²¾ç»†ç²’åº¦çš„é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨" class="headerlink" title="é‡‡ç”¨ç²¾ç»†ç²’åº¦çš„é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨"></a>é‡‡ç”¨ç²¾ç»†ç²’åº¦çš„é”å’Œæ¡ä»¶å˜é‡å®ç°çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®¹å™¨</h3><p>ç”¨å•å‘é“¾è¡¨å……å½“é˜Ÿåˆ—çš„æ•°æ®ç»“æ„ã€‚é˜Ÿåˆ—å«æœ‰ä¸€ä¸ªâ€œå¤´æŒ‡é’ˆheadâ€ï¼Œå®ƒæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å†ä¾æ¬¡æŒ‡å‘åç»§èŠ‚ç‚¹ã€‚é˜Ÿåˆ—å¼¹å‡ºæ•°æ®çš„æ–¹æ³•æ˜¯æ›´æ”¹headæŒ‡é’ˆï¼šå°†æŒ‡å‘ç›®æ ‡æ”¹ä¸ºå…¶åç»§èŠ‚ç‚¹ï¼Œå¹¶è¿”å›åŸæ¥çš„ç¬¬ä¸€é¡¹æ•°æ®ã€‚</p><p>æ–°æ•°æ®ä»é˜Ÿåˆ—æœ«ç«¯åŠ å…¥ï¼Œå…¶å®ç°æ–¹å¼æ˜¯ï¼Œé˜Ÿåˆ—å¦å¤–ç»´æŠ¤ä¸€ä¸ªâ€œå°¾æŒ‡é’ˆtailâ€ï¼ŒæŒ‡å‘å°¾èŠ‚ç‚¹ã€‚å‡å¦‚æœ‰æ–°èŠ‚ç‚¹åŠ å…¥ï¼Œåˆ™å°†å°¾èŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°tailæŒ‡é’ˆï¼Œä»¤å…¶æŒ‡å‘æ–°èŠ‚ç‚¹ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™å°†headæŒ‡é’ˆå’ŒtailæŒ‡é’ˆéƒ½è®¾ç½®ä¸ºNULLã€‚</p><p><img src="/../images/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter6/image-20250220113406835.png" alt="image-20250220113406835"></p><p><strong>å•çº¿ç¨‹ç‰ˆæœ¬</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Queue</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">queue</span>() : <span class="hljs-built_in">tail</span>(<span class="hljs-literal">nullptr</span>)<br>    &#123;&#125;<br>    <span class="hljs-built_in">queue</span>(<span class="hljs-type">const</span> queue&amp; other) = <span class="hljs-keyword">delete</span>;<br>    queue&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> queue&amp; other) = <span class="hljs-keyword">delete</span>;<br><br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (!head) &#123;<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();<br>        &#125;<br>        std::shared_ptr&lt;T&gt; <span class="hljs-type">const</span> res = std::<span class="hljs-built_in">make_shared</span>(std::<span class="hljs-built_in">move</span>(head-&gt;data));<br>        <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> old_head = std::<span class="hljs-built_in">move</span>(head);<br>        head = std::<span class="hljs-built_in">move</span>(old_head-&gt;next);<br>        <span class="hljs-keyword">if</span> (!head) &#123;<br>            tail = <span class="hljs-literal">nullptr</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span> </span>&#123;<br>        <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-keyword">new</span> node(std::move(new_value)))</span></span>;<br>        node* <span class="hljs-type">const</span> new_tail = p.<span class="hljs-built_in">get</span>();<br>        <span class="hljs-keyword">if</span> (tail) &#123;<br>            tail-&gt;next = std::<span class="hljs-built_in">move</span>(p);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            head = std::<span class="hljs-built_in">move</span>(p);<br>        &#125;<br>        tail = new_tail;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span> &#123;<br>        T data;<br>        std::unique_ptr&lt;node&gt; next;<br>        <span class="hljs-built_in">node</span>(T data_):<br>            <span class="hljs-built_in">data</span>(std::<span class="hljs-built_in">move</span>(data_))<br>        &#123;&#125;<br>    &#125;;<br>    std::unique_ptr&lt;node&gt; head;<br>    node* tail;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¤šçº¿ç¨‹ä¸‹å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>pushå¯ä»¥åŒæ—¶æ”¹åŠ¨headæŒ‡é’ˆå’ŒtailæŒ‡é’ˆï¼Œæ‰€ä»¥è¯¥å‡½æ•°éœ€è¦å°†ä¸¤ä¸ªäº’æ–¥é”ä½ã€‚</li><li>pushå’Œtry_popæœ‰å¯èƒ½å¹¶å‘è®¿é—®åŒä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡é’ˆï¼šå½“é˜Ÿåˆ—ä»…å«æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå³head&#x3D;&#x3D;tailã€‚è¿™ä¼šå¯¼è‡´é”å®šåŒä¸€ä¸ªäº’æ–¥ã€‚</li></ul><p><strong>é€šè¿‡åˆ†ç¦»æ•°æ®å®ç°å¹¶å‘</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_queue</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span><br>    &#123;<br>        std::shared_ptr&lt;T&gt; data;<br>        std::unique_ptr&lt;node&gt; next;<br>    &#125;;<br>    std::mutex head_mutex;<br>    std::unique_ptr&lt;node&gt; head;<br>    std::mutex tail_mutex;<br>    node* tail;<br>    <span class="hljs-function">node* <span class="hljs-title">get_tail</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">tail_lock</span><span class="hljs-params">(tail_mutex)</span></span>;<br>        <span class="hljs-keyword">return</span> tail;<br>    &#125;<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">pop_head</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(head_mutex)</span></span>; <br><br>        <span class="hljs-keyword">if</span>(head.<span class="hljs-built_in">get</span>()==<span class="hljs-built_in">get_tail</span>())<br>        &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>        &#125;<br>        std::unique_ptr&lt;node&gt; old_head=std::<span class="hljs-built_in">move</span>(head);<br>        head=std::<span class="hljs-built_in">move</span>(old_head-&gt;next);<br>        <span class="hljs-keyword">return</span> old_head;<br>    &#125;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">threadsafe_queue</span>():<br>        <span class="hljs-built_in">head</span>(<span class="hljs-keyword">new</span> node),<span class="hljs-built_in">tail</span>(head.<span class="hljs-built_in">get</span>())<br>    &#123;&#125;<br>    <span class="hljs-built_in">threadsafe_queue</span>(<span class="hljs-type">const</span> threadsafe_queue&amp; other)=<span class="hljs-keyword">delete</span>;<br>    threadsafe_queue&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> threadsafe_queue&amp; other)=<span class="hljs-keyword">delete</span>;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        std::unique_ptr&lt;node&gt; old_head=<span class="hljs-built_in">pop_head</span>();<br>        <span class="hljs-keyword">return</span> old_head?old_head-&gt;data:std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">new_data</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">            std::make_shared&lt;T&gt;(std::move(new_value)))</span></span>;<br>        <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-keyword">new</span> node)</span></span>;<br>        node* <span class="hljs-type">const</span> new_tail=p.<span class="hljs-built_in">get</span>();<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">tail_lock</span><span class="hljs-params">(tail_mutex)</span></span>;<br>        tail-&gt;data=new_data;<br>        tail-&gt;next=std::<span class="hljs-built_in">move</span>(p);<br>        tail=new_tail;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>å¯¹äºpushè€Œè¨€ï¼Œå¯¹tailæŒ‡é’ˆçš„å…¨éƒ¨è®¿é—®éƒ½éœ€è¦åŠ é”</li><li>å¯¹äºtry_popè€Œè¨€ï¼Œéœ€è¦å¯¹headæŒ‡é’ˆåŠ é”ï¼Œæ­¤å¤–ï¼Œè¿˜éœ€è¦åœ¨å†…éƒ¨è®¿é—®tailæŒ‡é’ˆä¸€æ¬¡ï¼Œæ‰€ä»¥éœ€è¦åœ¨å¯¹åº”çš„äº’æ–¥ä¸ŠåŠ é”ã€‚</li><li>åœ¨try_popä¸­ï¼Œå¯¹tailçš„è®¿é—®åŠ é”æ˜¯å¿…è¦çš„ä¿æŠ¤ã€‚å¦‚æœä¸åŠ é”ï¼Œtry_popå’Œpushå¯èƒ½ä¼šç”±ä¸åŒçš„çº¿ç¨‹è°ƒç”¨ï¼Œå¯¼è‡´å¯¹tailçš„è®¿é—®å‡ºç°ç«äº‰è¡Œä¸ºã€‚</li><li>get_tailçš„è°ƒç”¨åœ¨head_mutexä¿æŠ¤èŒƒå›´ä¸­ï¼Œè¿™å¾ˆé‡è¦ã€‚åä¹‹ï¼Œå…ˆå¯¹tailåŠ é”ï¼Œè·å–åˆ°tailæŒ‡é’ˆï¼Œå†å¯¹headåŠ é”ï¼Œä½†æ­¤æ—¶å¯èƒ½æ— æ³•é¡ºåˆ©åŠ é”ï¼Œæ­¤æ—¶åˆ«çš„çº¿ç¨‹å¯èƒ½è·å–åˆ°é”è¿›è¡Œtry_popï¼Œç­‰åˆ°å½“å‰çº¿ç¨‹å¯¹headåŠ é”çš„æ—¶å€™ï¼Œheadå’Œtailéƒ½å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥ä¹‹å‰è¿”å›çš„tailæŒ‡é’ˆå¯èƒ½ä¸åœ¨æ˜¯å°¾æŒ‡é’ˆï¼Œç”šè‡³å·²ç»ä¸æ˜¯é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹äº†ã€‚</li><li>å¹¶å‘æ€§åˆ†æ<ul><li>pushåœ¨æ²¡æœ‰æŒé”çš„çŠ¶æ€ä¸‹ï¼Œä¸ºæ–°èŠ‚ç‚¹å’Œæ–°æ•°æ®å®Œæˆäº†å†…å­˜åˆ†é…ã€‚</li><li>try_popåªåœ¨äº’æ–¥tail_mutexä¸ŠçŸ­æš‚æŒé”ï¼Œå› æ­¤try_popå’Œpushå‡ ä¹å¯ä»¥å¹¶å‘æ‰§è¡Œã€‚</li><li>é˜Ÿåˆ—èŠ‚ç‚¹é€šè¿‡æ™ºèƒ½æŒ‡é’ˆçš„ææ„å‡½æ•°åˆ é™¤ï¼Œåœ¨head_mutexçš„ä¿æŠ¤èŒƒå›´ä»¥å¤–æ‰§è¡Œï¼Œå¦‚æ­¤å¯ä»¥æé«˜try_popçš„å¹¶å‘åº¦ï¼Œå› ä¸ºåˆ é™¤èŠ‚ç‚¹ã€è¿”å›æ•°æ®ä¹‹ç±»è€—æ—¶çš„æ“ä½œåœ¨äº’æ–¥å¤–æ‰§è¡Œã€‚</li></ul></li></ul><p><strong>ç­‰å¾…æ•°æ®å¼¹å‡º</strong></p><p>è¿›ä¸€æ­¥å®ç°wait_and_popç­‰åŠŸèƒ½ã€‚</p><p>æ¥å£è®¾è®¡ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_queue</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span><br>    &#123;<br>        std::shared_ptr&lt;T&gt; data;<br>        std::unique_ptr&lt;node&gt; next;<br>    &#125;;<br>    std::mutex head_mutex;<br>    std::unique_ptr&lt;node&gt; head;<br>    std::mutex tail_mutex;<br>    node* tail;<br>    std::condition_variable data_cond;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">threadsafe_queue</span>():<br>        <span class="hljs-built_in">head</span>(<span class="hljs-keyword">new</span> node),<span class="hljs-built_in">tail</span>(head.<span class="hljs-built_in">get</span>())<br>    &#123;&#125;<br>    <span class="hljs-built_in">threadsafe_queue</span>(<span class="hljs-type">const</span> threadsafe_queue&amp; other)=<span class="hljs-keyword">delete</span>;<br>    threadsafe_queue&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> threadsafe_queue&amp; other)=<span class="hljs-keyword">delete</span>;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">try_pop</span><span class="hljs-params">(T&amp; value)</span></span>;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">wait_and_pop</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait_and_pop</span><span class="hljs-params">(T&amp; value)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å‘é˜Ÿåˆ—ä¸­å‹å…¥æ–°èŠ‚ç‚¹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-type">void</span> threadsafe_queue&lt;T&gt;::<span class="hljs-built_in">push</span>(T new_value)<br>&#123;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">new_data</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        std::make_shared&lt;T&gt;(std::move(new_value)))</span></span>;<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-keyword">new</span> node)</span></span>;<br>    &#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">tail_lock</span><span class="hljs-params">(tail_mutex)</span></span>;<br>        tail-&gt;data=new_data;<br>        node* <span class="hljs-type">const</span> new_tail=p.<span class="hljs-built_in">get</span>();<br>        tail-&gt;next=std::<span class="hljs-built_in">move</span>(p);<br>        tail=new_tail;<br>    &#125;<br>    data_cond.<span class="hljs-built_in">notify_one</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>wait_and_popå®ç°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_queue</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function">node* <span class="hljs-title">get_tail</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">tail_lock</span><span class="hljs-params">(tail_mutex)</span></span>;<br>        <span class="hljs-keyword">return</span> tail;<br>    &#125;<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">pop_head</span><span class="hljs-params">()</span>   <span class="hljs-comment">// â‡½---  â‘ </span></span><br><span class="hljs-function">    </span>&#123;<br>        std::unique_ptr&lt;node&gt; old_head=std::<span class="hljs-built_in">move</span>(head);<br>        head=std::<span class="hljs-built_in">move</span>(old_head-&gt;next);<br>        <span class="hljs-keyword">return</span> old_head;<br>    &#125;<br>    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">wait_for_data</span><span class="hljs-params">()</span>  <span class="hljs-comment">//  â‡½---  â‘¡</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(head_mutex)</span></span>;<br>        data_cond.<span class="hljs-built_in">wait</span>(head_lock,[&amp;]&#123;<span class="hljs-keyword">return</span> head.<span class="hljs-built_in">get</span>()!=<span class="hljs-built_in">get_tail</span>();&#125;);<br>        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(head_lock);  <span class="hljs-comment">//  â‡½---  â‘¢</span><br>    &#125;<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">wait_pop_head</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(wait_for_data())</span></span>;  <span class="hljs-comment">//  â‡½---  â‘£</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>();<br>    &#125;<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">wait_pop_head</span><span class="hljs-params">(T&amp; value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(wait_for_data())</span></span>;  <span class="hljs-comment">//  â‡½---  â‘¤</span><br>        value=std::<span class="hljs-built_in">move</span>(*head-&gt;data);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>();<br>    &#125;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">wait_and_pop</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        std::unique_ptr&lt;node&gt; <span class="hljs-type">const</span> old_head=<span class="hljs-built_in">wait_pop_head</span>();<br>        <span class="hljs-keyword">return</span> old_head-&gt;data;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait_and_pop</span><span class="hljs-params">(T&amp; value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        std::unique_ptr&lt;node&gt; <span class="hljs-type">const</span> old_head=<span class="hljs-built_in">wait_pop_head</span>(value);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>try_popå’Œemptyå®ç°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_queue</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">try_pop_head</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(head_mutex)</span></span>;<br>        <span class="hljs-keyword">if</span>(head.<span class="hljs-built_in">get</span>()==<span class="hljs-built_in">get_tail</span>())<br>        &#123;<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">unique_ptr</span>&lt;node&gt;();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>();<br>    &#125;<br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">try_pop_head</span><span class="hljs-params">(T&amp; value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(head_mutex)</span></span>;<br>        <span class="hljs-keyword">if</span>(head.<span class="hljs-built_in">get</span>()==<span class="hljs-built_in">get_tail</span>())<br>        &#123;<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">unique_ptr</span>&lt;node&gt;();<br>        &#125;<br>        value=std::<span class="hljs-built_in">move</span>(*head-&gt;data);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>();<br>    &#125;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        std::unique_ptr&lt;node&gt; old_head=<span class="hljs-built_in">try_pop_head</span>();<br>        <span class="hljs-keyword">return</span> old_head?old_head-&gt;data:std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">try_pop</span><span class="hljs-params">(T&amp; value)</span></span><br><span class="hljs-function">    </span>&#123;<br>        std::unique_ptr&lt;node&gt; <span class="hljs-type">const</span> old_head=<span class="hljs-built_in">try_pop_head</span>(value);<br>        <span class="hljs-keyword">return</span> old_head;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">head_lock</span><span class="hljs-params">(head_mutex)</span></span>;<br>        <span class="hljs-keyword">return</span> (head.<span class="hljs-built_in">get</span>()==<span class="hljs-built_in">get_tail</span>());<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_queue</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span><br>    &#123;<br>        std::shared_ptr&lt;T&gt; data;<br>        std::unique_ptr&lt;node&gt; next;<br>    &#125;;<br>    std::mutex head_mutex;<br>    std::unique_ptr&lt;node&gt; head;<br>    std::mutex tail_mutex;<br>    node* tail;<br>    std::condition_variable data_cond;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">threadsafe_queue</span>():<br>        <span class="hljs-built_in">head</span>(<span class="hljs-keyword">new</span> node),<span class="hljs-built_in">tail</span>(head.<span class="hljs-built_in">get</span>())<br>    &#123;&#125;<br><br>    <span class="hljs-built_in">threadsafe_queue</span>(<span class="hljs-type">const</span> threadsafe_queue&amp; other)=<span class="hljs-keyword">delete</span>;<br>    threadsafe_queue&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> threadsafe_queue&amp; other)=<span class="hljs-keyword">delete</span>;<br><br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> old_head = <span class="hljs-built_in">try_pop_head</span>(); <br>        <span class="hljs-keyword">return</span> old_head ? old_head-&gt;data : std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">try_pop</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> old_head = <span class="hljs-built_in">try_pop_head</span>(value);<br>        <span class="hljs-keyword">return</span> old_head.<span class="hljs-built_in">get</span>() != <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">wait_and_pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> old_head = <span class="hljs-built_in">wait_pop_head</span>();<br>        <span class="hljs-keyword">return</span> old_head ? old_head-&gt;data : std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait_and_pop</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> old_head = <span class="hljs-built_in">wait_pop_head</span>(value);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> new_data = std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(std::<span class="hljs-built_in">move</span>(new_value));<br>        <span class="hljs-keyword">auto</span> p = std::<span class="hljs-built_in">make_unique</span>&lt;node&gt;();<br>        &#123;<br>            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(tail_mutex)</span></span>;<br>            tail-&gt;data = new_data;<br>            <span class="hljs-keyword">auto</span> new_tail = p.<span class="hljs-built_in">get</span>();<br>            tail-&gt;next = std::<span class="hljs-built_in">move</span>(p);<br>            tail = new_tail;<br>        &#125;<br>        <span class="hljs-comment">// è¿™é‡Œå…ˆè§£é”ï¼Œå†é€šçŸ¥ï¼Œå¯ä»¥é¿å…å”¤é†’ä¹‹åï¼Œå› ä¸ºäº’æ–¥æ²¡æœ‰è§£é”åˆé‡æ–°é˜»å¡ã€‚</span><br>        data_cond.<span class="hljs-built_in">notify_one</span>();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head_mutex)</span></span>;<br>        <span class="hljs-keyword">return</span> head.<span class="hljs-built_in">get</span>() == <span class="hljs-built_in">get_tail</span>();<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function">node* <span class="hljs-title">get_tail</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(tail_mutex)</span></span>;<br>        <span class="hljs-keyword">return</span> tail;<br>    &#125;<br><br>    <span class="hljs-comment">// å¿…é¡»æŒæœ‰head_mutex</span><br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">pop_head</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> old_head = std::<span class="hljs-built_in">move</span>(head);<br>        head = std::<span class="hljs-built_in">move</span>(old_head-&gt;next);<br>        <span class="hljs-keyword">return</span> old_head; <br>    &#125;<br><br>    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">wait_for_data</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head_mutex)</span></span>;<br>        data_cond.<span class="hljs-built_in">wait</span>(lk, [<span class="hljs-keyword">this</span>]&#123;<br>            <span class="hljs-keyword">return</span> head.<span class="hljs-built_in">get</span>() != <span class="hljs-built_in">get_tail</span>();<br>        &#125;);<br>        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(lk);<br>    &#125;<br><br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">wait_pop_head</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> lk = <span class="hljs-built_in">wait_for_data</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>();<br>    &#125;<br><br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">wait_pop_head</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> lk = <span class="hljs-built_in">wait_for_data</span>();<br>        <span class="hljs-comment">// è¿™é‡Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ ä¹Ÿä¸ä¼šæ±¡æŸ“é˜Ÿåˆ—</span><br>        value = std::<span class="hljs-built_in">move</span>(*head-&gt;data);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>(); <br>    &#125;<br><br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">try_pop_head</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head_mutex)</span></span>;<br>        <span class="hljs-keyword">if</span> (head.<span class="hljs-built_in">get</span>() == <span class="hljs-built_in">get_tail</span>()) &#123;<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">unique_ptr</span>&lt;node&gt;();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>();<br>    &#125;<br><br>    <span class="hljs-function">std::unique_ptr&lt;node&gt; <span class="hljs-title">try_pop_head</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head_mutex)</span></span>;<br>        <span class="hljs-keyword">if</span> (head.<span class="hljs-built_in">get</span>() == <span class="hljs-built_in">get_tail</span>()) &#123;<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">unique_ptr</span>&lt;node&gt;();<br>        &#125;<br>        <span class="hljs-comment">// åŒwait_pop_head</span><br>        value = std::<span class="hljs-built_in">move</span>(*head-&gt;data);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pop_head</span>(); <br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>é™„ä¸Šä¸€ä¸ªç®€å•çš„æµ‹è¯•ä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;atomic&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cassert&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span><br><br><br><span class="hljs-comment">// å•çº¿ç¨‹æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">single_thread_test</span><span class="hljs-params">()</span> </span>&#123;<br>    threadsafe_queue&lt;<span class="hljs-type">int</span>&gt; queue;<br><br>    <span class="hljs-comment">// æµ‹è¯•åˆå§‹çŠ¶æ€</span><br>    <span class="hljs-built_in">assert</span>(queue.<span class="hljs-built_in">empty</span>());<br><br>    <span class="hljs-comment">// æµ‹è¯•pushå’Œtry_pop</span><br>    queue.<span class="hljs-built_in">push</span>(<span class="hljs-number">42</span>);<br>    <span class="hljs-built_in">assert</span>(!queue.<span class="hljs-built_in">empty</span>());<br>    <br>    <span class="hljs-type">int</span> val;<br>    <span class="hljs-type">bool</span> success = queue.<span class="hljs-built_in">try_pop</span>(val);<br>    <span class="hljs-built_in">assert</span>(success);<br>    <span class="hljs-built_in">assert</span>(val == <span class="hljs-number">42</span>);<br>    <span class="hljs-built_in">assert</span>(queue.<span class="hljs-built_in">empty</span>());<br><br>    <span class="hljs-comment">// æµ‹è¯•wait_and_pop</span><br>    <span class="hljs-function">std::thread <span class="hljs-title">consumer</span><span class="hljs-params">([&amp;]&#123;</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-type">int</span> popped_val;</span></span><br><span class="hljs-params"><span class="hljs-function">        queue.wait_and_pop(popped_val);</span></span><br><span class="hljs-params"><span class="hljs-function">        assert(popped_val == <span class="hljs-number">100</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">    &#125;)</span></span>;<br><br>    std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">10</span>));<br>    queue.<span class="hljs-built_in">push</span>(<span class="hljs-number">100</span>);<br>    consumer.<span class="hljs-built_in">join</span>();<br>    <span class="hljs-built_in">assert</span>(queue.<span class="hljs-built_in">empty</span>());<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Single thread tests passed!\n&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// å¤šçº¿ç¨‹æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">multi_thread_test</span><span class="hljs-params">()</span> </span>&#123;<br>    threadsafe_queue&lt;<span class="hljs-type">int</span>&gt; queue;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> NUM_ITEMS = <span class="hljs-number">10000</span>;<br>    <span class="hljs-function">std::atomic&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">counter</span><span class="hljs-params">(<span class="hljs-number">0</span>)</span></span>;<br>    std::vector&lt;std::thread&gt; threads;<br><br>    <span class="hljs-comment">// ç”Ÿäº§è€…çº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; ++i) &#123;<br>        threads.<span class="hljs-built_in">emplace_back</span>([&amp;] &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; NUM_ITEMS; ++j) &#123;<br>                queue.<span class="hljs-built_in">push</span>(j);<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; ++i) &#123;<br>        threads.<span class="hljs-built_in">emplace_back</span>([&amp;] &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; NUM_ITEMS; ++j) &#123;<br>                <span class="hljs-type">int</span> val;<br>                queue.<span class="hljs-built_in">wait_and_pop</span>(val);<br>                counter += val;<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; t : threads) &#123;<br>        t.<span class="hljs-built_in">join</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// éªŒè¯ç»“æœï¼ˆç­‰å·®æ•°åˆ—æ±‚å’Œå…¬å¼ï¼‰</span><br>    <span class="hljs-type">int</span> expected = <span class="hljs-number">2</span> * (NUM_ITEMS<span class="hljs-number">-1</span>)*NUM_ITEMS/<span class="hljs-number">2</span>;<br>    <span class="hljs-built_in">assert</span>(counter.<span class="hljs-built_in">load</span>() == expected);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Multi-thread tests passed!\n&quot;</span>;<br>&#125;<br><br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">single_thread_test</span>();<br>    <span class="hljs-built_in">multi_thread_test</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé˜Ÿåˆ—æ˜¯æ— é™é˜Ÿåˆ—ã€‚åªè¦å­˜åœ¨ç©ºé—²å†…å­˜ï¼Œå³ä¾¿å·²å­˜å…¥çš„æ•°æ®æ²¡æœ‰è¢«ç§»é™¤ï¼Œå„ä¸ªçº¿ç¨‹è¿˜æ˜¯èƒ½æŒç»­å¾€é˜Ÿåˆ—æ·»åŠ æ–°æ•°æ®ã€‚ä¸ä¹‹å¯¹åº”çš„æ˜¯æœ‰é™é˜Ÿåˆ—ï¼Œå…¶æœ€å¤§é•¿åº¦åœ¨åˆ›å»ºä¹‹é™…å°±å·²å›ºå®šã€‚ä¸€æ—¦æœ‰é™é˜Ÿåˆ—å®¹é‡å·²æ»¡ï¼Œå†è¯•å›¾å‘å…¶å‹å…¥æ•°æ®å°±ä¼šå¤±è´¥ï¼Œæˆ–è€…å‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°æœ‰æ•°æ®å¼¹å‡ºè€Œäº§ç”Ÿå®¹çº³ç©ºé—´ä¸ºæ­¢ã€‚</p><h3 id="é‡‡ç”¨é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„æŸ¥æ‰¾è¡¨"><a href="#é‡‡ç”¨é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„æŸ¥æ‰¾è¡¨" class="headerlink" title="é‡‡ç”¨é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„æŸ¥æ‰¾è¡¨"></a>é‡‡ç”¨é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„æŸ¥æ‰¾è¡¨</h3><p>æŸ¥æ‰¾è¡¨çš„ä½¿ç”¨æ–¹å¼ä¸åŒäºæ ˆå®¹å™¨æˆ–é˜Ÿåˆ—å®¹å™¨ã€‚æ ˆå®¹å™¨å’Œé˜Ÿåˆ—å®¹å™¨çš„å‡ ä¹æ¯é¡¹æ“ä½œéƒ½ä¼šè¿›è¡Œæ”¹åŠ¨ï¼Œæˆ–å¢åŠ å…ƒç´ ï¼Œæˆ–åˆ å‡å…ƒç´ ï¼ŒæŸ¥æ‰¾è¡¨å´é²œæœ‰æ”¹åŠ¨ã€‚</p><p>ä»å¹¶å‘çš„è§’åº¦è€ƒè™‘ï¼Œ<code>std::map&lt;&gt;</code> æ¥å£ä¸­çš„æœ€å¤§é—®é¢˜æ˜¯è¿­ä»£å™¨ã€‚æœ‰ä¸€ç§æ€è·¯æ˜¯é€šè¿‡è¿­ä»£å™¨è®¿é—®å®¹å™¨å†…éƒ¨ï¼Œå³ä¾¿æœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ï¼ˆå¹¶æ”¹åŠ¨ï¼‰å®¹å™¨æ•°æ®ï¼Œè¿­ä»£å™¨æ‰€æä¾›çš„è®¿é—®ä¾ç„¶å®‰å…¨ã€‚è¿™è™½ç„¶å¯è¡Œï¼Œä½†é¢‡ä¸ºæ£˜æ‰‹ã€‚è¦ä»¤è¿­ä»£å™¨æ­£ç¡®è¿è¡Œï¼Œæˆ‘ä»¬å°±å¿…é¡»é¢å¯¹è¯¸å¤šé—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¤„ç†èµ·æ¥ç›¸å½“å¤æ‚ï¼Œä¾‹å¦‚ä¸€ä¸ªçº¿ç¨‹è¦åˆ é™¤æŸä¸ªå…ƒç´ ï¼Œè€Œå®ƒå´æ­£è¢«è¿­ä»£å™¨å¼•ç”¨ã€‚è€ƒè™‘åˆ° <code>std::map&lt;&gt;</code> ä¸¥é‡ä¾èµ–è¿­ä»£å™¨ï¼ˆæ ‡å‡†åº“ä¸­çš„å…¶ä»–å…³è”å®¹å™¨äº¦ç„¶ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±è®¾è®¡æ¥å£ã€‚</p><p>æŸ¥æ‰¾è¡¨åŸºæœ¬æ¥å£ï¼š</p><ul><li>å¢åŠ é…å¯¹çš„é”®&#x2F;å€¼å¯¹</li><li>æ ¹æ®ç»™å®šçš„é”®æ”¹å˜å…³è”çš„å€¼ã€‚</li><li>ç§»é™¤æŸä¸ªé”®åŠå…¶å…³è”çš„å€¼ã€‚</li><li>æ ¹æ®ç»™å®šçš„é”®è·å–å…³è”å€¼ï¼ˆè‹¥è¯¥é”®å­˜åœ¨ï¼‰ã€‚</li><li>ä¸€äº›é’ˆå¯¹å®¹å™¨è‡ªèº«çš„æ•´ä½“æ“ä½œä¹Ÿååˆ†æœ‰ç”¨ï¼Œå¦‚æ£€æŸ¥å®¹å™¨æ˜¯å¦ä¸ºç©ºã€ä»¥â€œå¿«ç…§â€æ–¹å¼å¤åˆ¶æ‰€æœ‰é”®æˆ–å…¨ä½“é”®&#x2F;å€¼å¯¹ã€‚</li></ul><p>ä¸ºäº†å®ç°æ›´é«˜çš„å¹¶å‘åº¦ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°å¯¹æ ‡å‡†åº“æä¾›çš„å®¹å™¨è¿›è¡Œä¸€å±‚å°è£…ï¼Œè¿™æ ·å¹¶å‘åº¦ä¸é«˜ã€‚è€ƒè™‘å…³è”å®¹å™¨çš„å‡ ç§å®ç°æ–¹å¼ï¼š</p><ul><li>çº¢é»‘æ ‘</li><li>æœ‰åºæ•°ç»„</li><li>æ•£åˆ—è¡¨</li></ul><p>çº¢é»‘æ ‘æ¯æ¬¡æŸ¥æ‰¾æˆ–æ”¹åŠ¨éƒ½è¦ä»æ ¹èŠ‚ç‚¹å¼€å§‹è®¿é—®ï¼Œå¿…é¡»é€å±‚åŠ é”è§£é”ï¼Œæå‡ä¸å¤§ï¼›æœ‰åºæ•°ç»„å› ä¸ºæ— æ³•é¢„çŸ¥æŸ¥æ‰¾çš„ç›®æ ‡çš„ä½ç½®ï¼Œæ‰€ä»¥å¿…é¡»å¯¹æ•´ä¸ªæ•°ç»„åŠ é”ï¼Œæ•ˆç‡æ›´å·®ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æ•£åˆ—è¡¨ã€‚</p><p>å‡å®šæ•£åˆ—è¡¨å…·æœ‰å›ºå®šæ•°é‡çš„æ¡¶ï¼Œæ¯ä¸ªé”®éƒ½å±äºä¸€ä¸ªæ¡¶ï¼Œé”®æœ¬èº«çš„å€¼å’Œæ•£åˆ—å‡½æ•°å†³å®šé”®å…·ä½“å±äºå“ªä¸ªæ¡¶ã€‚è¿™è®©æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä¸ºæ¯ä¸ªæ¡¶ä½¿ç”¨ç‹¬ç«‹çš„é”ï¼Œä»è€Œå¢åŠ å¹¶å‘åº¦ã€‚é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé’ˆå¯¹é”®çš„æ•£åˆ—å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨C++æ ‡å‡†åº“æä¾›çš„å‡½æ•°æ¨¡æ¿ <code>std::hash&lt;&gt;</code>ã€‚è¯¥å‡½æ•°å·²ç»å…·å¤‡é’ˆå¯¹åŸºç¡€ç±»å‹çš„ç‰¹åŒ–ç‰ˆæœ¬ï¼Œå¦‚ <code>int</code> å’Œ <code>std::string</code> ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°å¯¹å…¶ä»–ç±»å‹çš„é”®è¿›è¡Œç‰¹åŒ–ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;map&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;shared_mutex&gt;</span></span><br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Key, <span class="hljs-keyword">typename</span> Value, <span class="hljs-keyword">typename</span> Hash = std::hash&lt;Key&gt;&gt;<br><span class="hljs-keyword">class</span> threadsafe_lookup_table &#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">class</span> bucket_type &#123;<br>    <span class="hljs-keyword">private</span>:<br>        <span class="hljs-keyword">using</span> bucket_value = std::pair&lt;Key, Value&gt;;<br>        <span class="hljs-keyword">using</span> bucket_data = std::list&lt;bucket_value&gt;;<br>        <span class="hljs-keyword">using</span> bucket_iterator = <span class="hljs-keyword">typename</span> bucket_data::iterator;<br>        bucket_data data;<br>        <span class="hljs-keyword">mutable</span> std::shared_mutex mtx;<br><br>        <span class="hljs-function">bucket_iterator <span class="hljs-title">find_entry_for</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key)</span> <span class="hljs-type">const</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">find_if</span>(data.<span class="hljs-built_in">begin</span>(), data.<span class="hljs-built_in">end</span>(), [&amp;key](<span class="hljs-type">const</span> bucket_value&amp; item)&#123;<br>                <span class="hljs-keyword">return</span> item.first == key;<br>            &#125;);<br>        &#125;<br>    <span class="hljs-keyword">public</span>:<br>        <span class="hljs-function">Value <span class="hljs-title">value_for</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key, <span class="hljs-type">const</span> Value&amp; default_value)</span> <span class="hljs-type">const</span> </span>&#123;<br>            <span class="hljs-function">std::shared_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx)</span></span>;<br>            <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> found_entry = <span class="hljs-built_in">find_entry_for</span>(key);<br>            <span class="hljs-keyword">return</span> found_entry == data.<span class="hljs-built_in">end</span>() ? default_value : found_entry-&gt;second;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_or_update_mapping</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key, <span class="hljs-type">const</span> Value&amp; value)</span> </span>&#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx)</span></span>;<br>            <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> found_entry = <span class="hljs-built_in">find_entry_for</span>(key);<br>            <span class="hljs-keyword">if</span> (found_entry == data.<span class="hljs-built_in">end</span>()) &#123;<br>                data.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">bucket_value</span>(key, value));<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                found_entry-&gt;second = value;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove_mapping</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key)</span> </span>&#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx)</span></span>;<br>            <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> found_entry = <span class="hljs-built_in">find_entry_for</span>(key);<br>            <span class="hljs-keyword">if</span> (found_entry != data.<span class="hljs-built_in">end</span>()) &#123;<br>                data.<span class="hljs-built_in">erase</span>(found_entry);<br>            &#125;<br>        &#125;<br>    &#125;;<br>    std::vector&lt;std::unique_ptr&lt;bucket_type&gt;&gt; buckets;<br>    Hash hasher;<br><br>    <span class="hljs-function">bucket_type&amp; <span class="hljs-title">get_bucket</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key)</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> bucket_idx = <span class="hljs-built_in">hasher</span>(key) % buckets.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">return</span> *buckets[bucket_idx];<br>    &#125;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">using</span> key_type = Key;<br>    <span class="hljs-keyword">using</span> mapped_type = Value;<br>    <span class="hljs-keyword">using</span> hash_type = Hash;<br>    <span class="hljs-built_in">threadsafe_lookup_table</span>(<span class="hljs-type">unsigned</span> num_buckets = <span class="hljs-number">19</span>, <span class="hljs-type">const</span> Hash&amp; hasher_ = <span class="hljs-built_in">Hash</span>())<br>        : <span class="hljs-built_in">buckets</span>(num_buckets), <span class="hljs-built_in">hasher</span>(hasher_) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> i = <span class="hljs-number">0</span>; i &lt; num_buckets; ++i) &#123;<br>            buckets[i].<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> bucket_type);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">threadsafe_lookup_table</span>(<span class="hljs-type">const</span> threadsafe_lookup_table&amp;) = <span class="hljs-keyword">delete</span>;<br>    threadsafe_lookup_table&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> threadsafe_lookup_table&amp;) = <span class="hljs-keyword">delete</span>;<br>    <br>    <span class="hljs-function">Value <span class="hljs-title">value_for</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key, <span class="hljs-type">const</span> Value&amp; default_value = Value())</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">get_bucket</span>(key).<span class="hljs-built_in">value_for</span>(key, default_value);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_or_update_mapping</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key, <span class="hljs-type">const</span> Value&amp; value)</span> </span>&#123;<br>        <span class="hljs-built_in">get_bucket</span>(key).<span class="hljs-built_in">add_or_update_mapping</span>(key, value);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove_mapping</span><span class="hljs-params">(<span class="hljs-type">const</span> Key&amp; key)</span> </span>&#123;<br>        <span class="hljs-built_in">get_bucket</span>(key).<span class="hljs-built_in">remove_mapping</span>(key);<br>    &#125;<br><br>    <span class="hljs-function">std::map&lt;Key, Value&gt; <span class="hljs-title">get_map</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>        std::vector&lt;std::unique_lock&lt;std::shared_mutex&gt;&gt; lks;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; bucket : buckets) &#123;<br>            lks.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">unique_lock</span>&lt;std::shared_mutex&gt;(bucket.mtx));<br>        &#125;<br>        std::map&lt;Key, Value&gt; res;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; bucket : buckets) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = bucket.data.<span class="hljs-built_in">begin</span>(); it != bucket.data.<span class="hljs-built_in">end</span>(); ++it) &#123;<br>                res.<span class="hljs-built_in">insert</span>(*it);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>å› ä¸ºæ¡¶çš„æ•°é‡æ˜¯å›ºå®šçš„ï¼Œå› æ­¤å¯¹bucketsçš„è®¿é—®æ— éœ€åŠ é”ã€‚å¯¹äºæ¯ä¸ªæ¡¶çš„è®¿é—®ï¼Œéƒ½ç”±å…±äº«é”å¦¥å–„çš„å¤„ç†è¿›è¡Œäº†ä¿æŠ¤ã€‚</li><li>å¼‚å¸¸å®‰å…¨ï¼š<ul><li>value_forä¸æ¶‰åŠæ”¹åŠ¨ï¼Œå³ä½¿æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿä¸æ±¡æŸ“æ•°æ®ç»“æ„ã€‚</li><li>remove_mappingé€šè¿‡eraseæ”¹åŠ¨é“¾è¡¨ï¼Œè¯¥è°ƒç”¨è‚¯å®šä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li>add_or_update_mappingå¦‚æœæ‰§è¡Œaddæ“ä½œï¼Œè¿›è¡Œpush_backï¼Œè¯¥æ“ä½œæ˜¯å¼‚å¸¸å®‰å…¨çš„ï¼Œå³ä½¿æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šæ±¡æŸ“é“¾è¡¨ã€‚å¦‚æœæ‰§è¡Œupdateæ“ä½œï¼Œè¿›è¡Œèµ‹å€¼æ“ä½œï¼Œè¯¥æ“ä½œä¸æ˜¯å¼‚å¸¸å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šä½¿å…³è”çš„å€¼å¤„äºæ··åˆçŠ¶æ€ã€‚å¯ä»¥å°†å¼‚å¸¸å®‰å…¨äº¤ç»™ä½¿ç”¨è€…å¤„ç†ã€‚</li></ul></li></ul><h3 id="é‡‡ç”¨å¤šç§é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„é“¾è¡¨"><a href="#é‡‡ç”¨å¤šç§é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„é“¾è¡¨" class="headerlink" title="é‡‡ç”¨å¤šç§é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„é“¾è¡¨"></a>é‡‡ç”¨å¤šç§é”ç¼–å†™çº¿ç¨‹å®‰å…¨çš„é“¾è¡¨</h3><p>å‰é¢æåˆ°åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é¿å…æ”¯æŒè¿­ä»£å™¨ã€‚ä¸ºäº†æä¾›è¿­ä»£åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ç”¨æˆå‘˜å‡½æ•°çš„å½¢å¼æ¥å®ç°ï¼Œä¾‹å¦‚for_eachã€‚ä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼Œå› ä¸ºå¦‚æœfor_eachçš„å­˜åœ¨è¦æœ‰æ„ä¹‰ï¼Œåˆ™å…¶å¿…é¡»åœ¨æŒæœ‰å†…éƒ¨é”çš„æ—¶å€™è¿è¡Œç”¨æˆ·ä»£ç ï¼Œè€Œä¸”è¿˜å¿…é¡»å‘ç”¨æˆ·ä¼ é€’æ¯ä¸€é¡¹æ•°æ®ï¼Œè€Œä¸”æ•°æ®åº”è¯¥æŒ‰å€¼ä¼ é€’ã€‚æˆ‘ä»¬åªæœ‰è¦æ±‚ä½¿ç”¨è€…æ¥ç¡®ä¿å…¶æä¾›çš„ç”¨æˆ·ä»£ç ä¸ä¼šè¯•å›¾è·å–é”ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">threadsafe_list</span> &#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span> &#123;<br>        std::mutex mtx;<br>        std::shared_ptr&lt;T&gt; data;<br>        std::unique_ptr&lt;node&gt; next;<br>        <span class="hljs-built_in">node</span>() :<br>            <span class="hljs-built_in">next</span>()<br>        &#123; &#125;<br>        <span class="hljs-built_in">node</span>(<span class="hljs-type">const</span> T&amp; value):<br>            <span class="hljs-built_in">data</span>(std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(value)),<br>            <span class="hljs-built_in">next</span>()<br>        &#123; &#125;<br>    &#125;;<br>    node head;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">threadsafe_list</span>() = <span class="hljs-keyword">default</span>;<br>    ~<span class="hljs-built_in">threadsafe_list</span>() &#123;<br><br>    &#125;<br>    <span class="hljs-built_in">threadsafe_list</span>(<span class="hljs-type">const</span> node&amp;) = <span class="hljs-keyword">delete</span>;<br>    threadsafe_list&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> threadsafe_list&amp;) = <span class="hljs-keyword">delete</span>;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_front</span><span class="hljs-params">(<span class="hljs-type">const</span> T&amp; value)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> new_node = std::<span class="hljs-built_in">make_unique</span>&lt;node&gt;(value);<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head.mtx)</span></span>;<br>        new_node-&gt;next = std::<span class="hljs-built_in">move</span>(head.next);<br>        head.next = std::<span class="hljs-built_in">move</span>(new_node);<br>    &#125;<br><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Function&gt;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">for_each</span><span class="hljs-params">(Function f)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> cur_node = &amp;head;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head.mtx)</span></span>;<br>        <span class="hljs-keyword">while</span> (node* <span class="hljs-type">const</span> next = cur_node-&gt;next.<span class="hljs-built_in">get</span>()) &#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">next_lk</span><span class="hljs-params">(next-&gt;mtx)</span></span>;<br>            lk.<span class="hljs-built_in">unlock</span>();<br>            <span class="hljs-built_in">f</span>(*next-&gt;data);<br>            cur_node = next;<br>            lk = std::<span class="hljs-built_in">move</span>(next_lk);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Predicate&gt;<br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">find_first_if</span><span class="hljs-params">(Predicate p)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> cur_node = &amp;head;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head.mtx)</span></span>;<br>        <span class="hljs-keyword">while</span> (node* <span class="hljs-type">const</span> next = cur_node-&gt;next.<span class="hljs-built_in">get</span>()) &#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">next_lk</span><span class="hljs-params">(next-&gt;mtx)</span></span>;<br>            lk.<span class="hljs-built_in">unlock</span>();<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">p</span>(*next-&gt;data)) &#123;<br>                <span class="hljs-keyword">return</span> next-&gt;data;<br>            &#125;<br>            cur_node = next;<br>            lk = std::<span class="hljs-built_in">move</span>(next_lk);<br>        &#125;<br>        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();<br>    &#125;<br><br>    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> Predicate&gt;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove_if</span><span class="hljs-params">(Predicate p)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> cur_node = &amp;head;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(head.mtx)</span></span>;<br>        <span class="hljs-keyword">while</span> (node* <span class="hljs-type">const</span> next = cur_node-&gt;next.<span class="hljs-built_in">get</span>()) &#123;<br>            <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">next_lk</span><span class="hljs-params">(next-&gt;mtx)</span></span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">p</span>(*next-&gt;data)) &#123;<br>                <span class="hljs-keyword">auto</span> old_next = std::<span class="hljs-built_in">move</span>(cur_node-&gt;next);<br>                cur_node-&gt;next = std::<span class="hljs-built_in">move</span>(next-&gt;next);<br>                next_lk.<span class="hljs-built_in">unlock</span>();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                lk.<span class="hljs-built_in">unlock</span>();<br>                cur_node = next;<br>                lk = std::<span class="hljs-built_in">move</span>(next_lk);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå®ç°çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼ŒæŒ‰ç…§é“¾è¡¨ä¸­èŠ‚ç‚¹çš„å‰åé¡ºåºåŠ é”ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¶…è¶Šä»–äººçš„å¤„ç†èŠ‚ç‚¹ï¼Œè‹¥ä¸€ä¸ªçº¿ç¨‹éœ€åœ¨æŸèŠ‚ç‚¹ä¸Šè€—è´¹ç‰¹åˆ«é•¿çš„æ—¶é—´ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹åœ¨åˆ°è¾¾è¯¥èŠ‚ç‚¹æ—¶å°±ä¸å¾—ä¸ç­‰å¾…ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++å¹¶å‘ç¼–ç¨‹å®æˆ˜Chapter4</title>
    <link href="/2025/01/26/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter4/"/>
    <url>/2025/01/26/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter4/</url>
    
    <content type="html"><![CDATA[<h1 id="4-å¹¶å‘æ“ä½œçš„åŒæ­¥"><a href="#4-å¹¶å‘æ“ä½œçš„åŒæ­¥" class="headerlink" title="4 å¹¶å‘æ“ä½œçš„åŒæ­¥"></a>4 å¹¶å‘æ“ä½œçš„åŒæ­¥</h1><h2 id="4-1-ç­‰å¾…äº‹ä»¶æˆ–ç­‰å¾…å…¶ä»–æ¡ä»¶"><a href="#4-1-ç­‰å¾…äº‹ä»¶æˆ–ç­‰å¾…å…¶ä»–æ¡ä»¶" class="headerlink" title="4.1 ç­‰å¾…äº‹ä»¶æˆ–ç­‰å¾…å…¶ä»–æ¡ä»¶"></a>4.1 ç­‰å¾…äº‹ä»¶æˆ–ç­‰å¾…å…¶ä»–æ¡ä»¶</h2><p>çº¿ç¨‹Aéœ€è¦ç­‰å¾…çº¿ç¨‹Bå®Œæˆä»»åŠ¡ï¼Œæœ‰å‡ ç§æ–¹å¼</p><ul><li>åœ¨å…±äº«æ•°æ®å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæ ‡å¿—ï¼ˆäº’æ–¥ä¿æŠ¤ï¼‰ï¼Œçº¿ç¨‹Bå®Œæˆåï¼Œè®¾ç½®è¯¥æ ‡å¿—ã€‚</li></ul><p>â€‹è¿™ç§æ–¹æ³•ä¸­çº¿ç¨‹Aå¿…é¡»ä¸æ–­è½®è¯¢æ£€æŸ¥æ ‡å¿—ã€‚å­˜åœ¨èµ„æºæµªè´¹ã€‚</p><ul><li>è®©çº¿ç¨‹Aè°ƒç”¨ <code>std::this_thread::sleep_for()</code> å‡½æ•°ï¼Œåœ¨å„æ¬¡æ£€éªŒä¹‹é—´çŸ­æš‚ä¼‘çœ ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">bool</span> flag;<br>std::mutex m;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait_for_flag</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(m)</span></span>;<br>    <span class="hljs-keyword">while</span>(!flag)<br>    &#123;<br>        lk.<span class="hljs-built_in">unlock</span>();   <br>        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));  <br>        lk.<span class="hljs-built_in">lock</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹ä¸Šè¿°ä»£ç è™½ç„¶æ•ˆç‡æœ‰æ‰€æå‡ï¼Œä½†æ˜¯ä¼‘çœ æ—¶é—´çš„é•¿çŸ­å¾ˆéš¾ç¡®å®šã€‚å¦‚æœæ—¶é—´è¿‡çŸ­ï¼Œçº¿ç¨‹ä»ä¼šé¢‘ç¹æ£€æŸ¥ï¼›æ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´å»¶è¿Ÿï¼Œä»»åŠ¡å·²ç»å®Œæˆä½†çº¿ç¨‹Aè¿˜åœ¨ä¼‘çœ ã€‚å¯¹äºå®æ—¶åº”ç”¨ï¼Œæ¸¸æˆç­‰ï¼Œä¸èƒ½æ¥å—ã€‚</p><ul><li>ä½¿ç”¨C++æ ‡å‡†åº“çš„å·¥å…·ï¼ˆä¼˜å…ˆé‡‡ç”¨ï¼‰</li></ul><p>â€‹æœ€åŸºæœ¬çš„æ–¹å¼æ˜¯æ¡ä»¶å˜é‡ã€‚å½“æ¡ä»¶æˆç«‹æ—¶ï¼Œå°±é€šè¿‡è¯¥æ¡ä»¶å˜é‡ï¼Œé€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œå°†ä»–ä»¬å”¤é†’ç»§ç»­å¤„ç†ã€‚</p><h3 id="4-1-1-å‡­å€Ÿæ¡ä»¶å˜é‡ç­‰å¾…æ¡ä»¶æˆç«‹"><a href="#4-1-1-å‡­å€Ÿæ¡ä»¶å˜é‡ç­‰å¾…æ¡ä»¶æˆç«‹" class="headerlink" title="4.1.1 å‡­å€Ÿæ¡ä»¶å˜é‡ç­‰å¾…æ¡ä»¶æˆç«‹"></a>4.1.1 å‡­å€Ÿæ¡ä»¶å˜é‡ç­‰å¾…æ¡ä»¶æˆç«‹</h3><p>C++æ ‡å‡†åº“æä¾›äº†æ¡ä»¶å˜é‡çš„ä¸¤ç§å®ç°ï¼šstd::condition_variable å’Œstd::condition_variable_anyã€‚å®ƒä»¬éƒ½åœ¨æ ‡å‡†åº“çš„å¤´æ–‡ä»¶<condition_variable>å†…å£°æ˜ã€‚ä¸¤è€…éƒ½éœ€é…åˆäº’æ–¥ï¼Œæ–¹èƒ½æä¾›å¦¥å½“çš„åŒæ­¥æ“ä½œã€‚std::condition_variableä»…é™äºä¸std::mutexä¸€èµ·ä½¿ç”¨ï¼›ç„¶è€Œï¼Œåªè¦æŸä¸€ç±»å‹ç¬¦åˆæˆä¸ºäº’æ–¥çš„æœ€ä½æ ‡å‡†ï¼Œè¶³ä»¥å……å½“äº’æ–¥ï¼Œstd::condition_variable_anyå³å¯ä¸ä¹‹é…åˆä½¿ç”¨ï¼Œå› æ­¤å®ƒçš„åç¼€æ˜¯â€œ_anyâ€ã€‚ç”±äºstd::condition_variable_anyæ›´åŠ é€šç”¨ï¼Œå®ƒå¯èƒ½äº§ç”Ÿé¢å¤–å¼€é”€ï¼Œæ¶‰åŠå…¶æ€§èƒ½ã€è‡ªèº«çš„ä½“ç§¯æˆ–ç³»ç»Ÿèµ„æºç­‰ï¼Œå› æ­¤std::condition_variableåº”äºˆä¼˜å…ˆé‡‡ç”¨ï¼Œé™¤éæœ‰å¿…è¦ä»¤ç¨‹åºæ›´çµæ´»ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::mutex mut;<br>std::queue&lt;data_chunk&gt; data_queue; <br>std::condition_variable data_cond;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">data_preparation_thread</span><span class="hljs-params">()</span>            <span class="hljs-comment">// ç”±çº¿ç¨‹Bè¿è¡Œ</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">more_data_to_prepare</span>())<br>    &#123;<br>        data_chunk <span class="hljs-type">const</span> data=<span class="hljs-built_in">prepare_data</span>();<br>        &#123;<br>            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;<br>            data_queue.<span class="hljs-built_in">push</span>(data); <br>        &#125;<br>        data_cond.<span class="hljs-built_in">notify_one</span>();   <br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">data_processing_thread</span><span class="hljs-params">()</span>           <span class="hljs-comment">// ç”±çº¿ç¨‹Aè¿è¡Œ</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>    &#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mut)</span></span>;   <br>        data_cond.<span class="hljs-built_in">wait</span>(<br>            lk,[]&#123;<span class="hljs-keyword">return</span> !data_queue.<span class="hljs-built_in">empty</span>();&#125;);   â‘¤<br>        data_chunk data=data_queue.<span class="hljs-built_in">front</span>();<br>        data_queue.<span class="hljs-built_in">pop</span>();<br>        lk.<span class="hljs-built_in">unlock</span>();   <br>        <span class="hljs-built_in">process</span>(data);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">is_last_chunk</span>(data))<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><ul><li>çº¿ç¨‹Bè§£é”äº’æ–¥åå†é€šçŸ¥çº¿ç¨‹Aï¼Œè¿™æ ·çº¿ç¨‹Aå”¤é†’åæ— éœ€ç­‰å¾…äº’æ–¥è§£é”ï¼Œä¸ä¼šå†æ¬¡è¢«é˜»å¡</li><li>çº¿ç¨‹Aåœ¨æ¡ä»¶å˜é‡ä¸Šè°ƒç”¨waitï¼Œä¼ å…¥é”å¯¹è±¡å’Œä¸€ä¸ªlambdaå‡½æ•°ï¼Œç”¨äºè¡¨è¾¾éœ€è¦ç­‰å¾…æˆç«‹çš„æ¡ä»¶ã€‚åªæœ‰æ¡ä»¶æˆç«‹ï¼Œwaitæ‰ä¼šè¿”å›ï¼›å¦åˆ™ï¼Œwaitè§£é”äº’æ–¥é‡ï¼Œå¹¶é˜»å¡çº¿ç¨‹ã€‚</li><li>çº¿ç¨‹Bå‡†å¤‡å¥½æ•°æ®åï¼Œé€šçŸ¥çº¿ç¨‹Aï¼ŒAè¢«å”¤é†’åï¼Œé¦–å…ˆè·å–äº’æ–¥é‡ï¼Œç„¶åæ£€æŸ¥æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚</li><li>å¦‚æœçº¿ç¨‹Aé‡æ–°è·å¾—äº’æ–¥ï¼Œå¹¶ä¸”æŸ¥éªŒæ¡ä»¶ï¼Œè€Œè¿™ä¸€è¡Œä¸ºå´ä¸æ˜¯ç›´æ¥å“åº”çº¿ç¨‹ä¹™çš„é€šçŸ¥ï¼Œåˆ™ç§°ä¹‹ä¸ºä¼ªå”¤é†’ï¼ˆspurious wakeï¼‰ã€‚æŒ‰ç…§C++æ ‡å‡†çš„è§„å®šï¼Œè¿™ç§ä¼ªå”¤é†’å‡ºç°çš„æ•°é‡å’Œé¢‘ç‡éƒ½ä¸ç¡®å®šã€‚å› æ­¤ï¼Œéœ€è¦è€ƒè™‘æ£€éªŒå‡½æ•°æ˜¯å¦æœ‰å‰¯ä½œç”¨ã€‚</li></ul><h3 id="4-1-2-åˆ©ç”¨æ¡ä»¶å˜é‡æ„å»ºçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—"><a href="#4-1-2-åˆ©ç”¨æ¡ä»¶å˜é‡æ„å»ºçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—" class="headerlink" title="4.1.2 åˆ©ç”¨æ¡ä»¶å˜é‡æ„å»ºçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—"></a>4.1.2 åˆ©ç”¨æ¡ä»¶å˜é‡æ„å»ºçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><br><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeQueue</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">ThreadSafeQueue</span>() &#123; &#125; <br>    <span class="hljs-built_in">ThreadSafeQueue</span>(<span class="hljs-type">const</span> ThreadSafeQueue&amp; other) &#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(other.mtx_)</span></span>;<br>        data_ = other.data_; <br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">empty</span>();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(T new_value)</span> </span>&#123;<br>        &#123;<br>            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>            data_.<span class="hljs-built_in">push</span>(new_value);<br>        &#125;    <br>        cond_.<span class="hljs-built_in">notify_one</span>();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">try_pop</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        <span class="hljs-keyword">if</span> (data_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        value = data_.<span class="hljs-built_in">front</span>();<br>        data_.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">try_pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        <span class="hljs-keyword">if</span> (data_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;();<br>        <span class="hljs-keyword">auto</span> res = std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(data_.<span class="hljs-built_in">front</span>());<br>        data_.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">wait_and_pop</span><span class="hljs-params">(T&amp; value)</span> </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        cond_.<span class="hljs-built_in">wait</span>(lk, [<span class="hljs-keyword">this</span>]&#123;<br>            <span class="hljs-keyword">return</span> !data_.<span class="hljs-built_in">empty</span>();<br>        &#125;);<br>        value = data_.<span class="hljs-built_in">front</span>();<br>        data_.<span class="hljs-built_in">pop</span>();<br>    &#125;<br><br>    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">wait_and_pop</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(mtx_)</span></span>;<br>        cond_.<span class="hljs-built_in">wait</span>(lk, [<span class="hljs-keyword">this</span>]&#123;<br>            <span class="hljs-keyword">return</span> !data_.<span class="hljs-built_in">empty</span>();<br>        &#125;);<br>        <span class="hljs-keyword">auto</span> res = std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(data_.<span class="hljs-built_in">front</span>());<br>        data_.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">return</span> res;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">mutable</span> std::mutex mtx_;<br>    std::condition_variable cond_;<br>    std::queue&lt;T&gt; data_;<br>&#125;;<br><br>ThreadSafeQueue&lt;<span class="hljs-type">int</span>&gt; q;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadFuncA</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) &#123;<br>        std::cout &lt;&lt; i &lt;&lt; std::endl;<br>        q.<span class="hljs-built_in">push</span>(i);<br>        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadFuncB</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) &#123;<br>        <span class="hljs-keyword">auto</span> value = q.<span class="hljs-built_in">wait_and_pop</span>();<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;i = &quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot;, value = &quot;</span> &lt;&lt; *value &lt;&lt; std::endl;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function">std::thread <span class="hljs-title">A</span><span class="hljs-params">(ThreadFuncA)</span></span>;<br>    <span class="hljs-built_in">ThreadFuncB</span>();<br>    A.<span class="hljs-built_in">join</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><ul><li>å› ä¸ºäº’æ–¥é‡ä¼šå› ä¸ºé”æ“ä½œè€Œå˜åŒ–ï¼Œä¸ºäº†æ”¯æŒconstå¯¹è±¡ï¼Œå…¶å¿…é¡»ç”¨mutableä¿®é¥°ã€‚</li></ul><h2 id="4-2-ä½¿ç”¨futureç­‰å¾…ä¸€æ¬¡æ€§äº‹ä»¶å‘ç”Ÿ"><a href="#4-2-ä½¿ç”¨futureç­‰å¾…ä¸€æ¬¡æ€§äº‹ä»¶å‘ç”Ÿ" class="headerlink" title="4.2 ä½¿ç”¨futureç­‰å¾…ä¸€æ¬¡æ€§äº‹ä»¶å‘ç”Ÿ"></a>4.2 ä½¿ç”¨futureç­‰å¾…ä¸€æ¬¡æ€§äº‹ä»¶å‘ç”Ÿ</h2><h3 id="4-2-1-ä»åå°ä»»åŠ¡è¿”å›å€¼"><a href="#4-2-1-ä»åå°ä»»åŠ¡è¿”å›å€¼" class="headerlink" title="4.2.1 ä»åå°ä»»åŠ¡è¿”å›å€¼"></a>4.2.1 ä»åå°ä»»åŠ¡è¿”å›å€¼</h3><p>å¦‚æœå¹¶ä¸æ€¥éœ€çº¿ç¨‹è¿ç®—çš„å€¼ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>std::async()</code> ï¼ˆå‡½æ•°æ¨¡æ¿ï¼Œå£°æ˜ä½äºå¤´æ–‡ä»¶  <code>&lt;future&gt;</code> ä¸­ï¼‰æŒ‰å¼‚æ­¥æ–¹å¼å¯åŠ¨ä»»åŠ¡ã€‚æˆ‘ä»¬ä» <code>std::async()</code> å‡½æ•°å¤„è·å¾— <code>std::future</code> å¯¹è±¡ï¼ˆè€Œé <code>std::thread</code> å¯¹è±¡ï¼‰ï¼Œè¿è¡Œçš„å‡½æ•°ä¸€æ—¦å®Œæˆï¼Œå…¶è¿”å›å€¼å°±ç”±è¯¥å¯¹è±¡æœ€åæŒæœ‰ã€‚è‹¥è¦ç”¨åˆ°è¿™ä¸ªå€¼ï¼Œåªéœ€åœ¨ <code>future</code> å¯¹è±¡ä¸Šè°ƒç”¨<code>get()</code>ï¼Œå½“å‰çº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œä»¥ä¾¿ <code>future</code> å‡†å¤‡å¦¥å½“å¹¶è¿”å›è¯¥å€¼ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œç”¨ <code>std::future</code> å–å¾—å¼‚æ­¥ä»»åŠ¡çš„å‡½æ•°è¿”å›å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;future&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">find_the_answer_to_ltuae</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">do_other_stuff</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    std::future&lt;<span class="hljs-type">int</span>&gt; the_answer=std::<span class="hljs-built_in">async</span>(find_the_answer_to_ltuae);<br>    <span class="hljs-built_in">do_other_stuff</span>();<br>    std::cout&lt;&lt;<span class="hljs-string">&quot;The answer is &quot;</span>&lt;&lt;the_answer.<span class="hljs-built_in">get</span>()&lt;&lt;std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>std::async()</code> å¯ä»¥æ¥æ”¶é™„åŠ å‚æ•°ï¼Œè¿›è€Œä¼ é€’ç»™ä»»åŠ¡å‡½æ•°ä½œä¸ºå‚æ•°ï¼ŒåŒ <code>std::thread</code> çš„æ„é€ å‡½æ•°ä¸€è‡´ã€‚</p><p>å¯ä»¥ç»™ <code>std::async()</code> è¡¥å……ä¸€ä¸ªå‚æ•°ï¼Œä»¥æŒ‡å®šé‡‡ç”¨å“ªç§è¿è¡Œæ–¹å¼ã€‚å‚æ•°çš„ç±»å‹æ˜¯ <code>std::launch</code>ï¼Œå…¶å€¼å¯ä»¥æ˜¯ <code>std::launch::deferred</code> æˆ– <code>std::launch::async</code> ã€‚å‰è€…æŒ‡å®šåœ¨å½“å‰çº¿ç¨‹ä¸Šå»¶åè°ƒç”¨ä»»åŠ¡å‡½æ•°ï¼Œç­‰åˆ°åœ¨futureä¸Šè°ƒç”¨äº† <code>wait()</code> æˆ– <code>get()</code> ï¼Œä»»åŠ¡å‡½æ•°æ‰ä¼šæ‰§è¡Œï¼›åè€…æŒ‡å®šå¿…é¡»å¦å¤–å¼€å¯ä¸“å±çš„çº¿ç¨‹ï¼Œåœ¨å…¶ä¸Šè¿è¡Œä»»åŠ¡å‡½æ•°ã€‚è¯¥å‚æ•°çš„å€¼è¿˜å¯ä»¥æ˜¯ <code>std::launch::deferred | std::launch::async</code> ï¼Œè¡¨ç¤ºç”± <code>std::async()</code> çš„å®ç°è‡ªè¡Œé€‰æ‹©è¿è¡Œæ–¹å¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> f6=std::<span class="hljs-built_in">async</span>(std::launch::async,<span class="hljs-built_in">Y</span>(),<span class="hljs-number">1.2</span>);    â‡½---  â‘ è¿è¡Œæ–°çº¿ç¨‹<br><br><span class="hljs-keyword">auto</span> f7=std::<span class="hljs-built_in">async</span>(std::launch::deferred,baz,std::<span class="hljs-built_in">ref</span>(x));    â‡½---  â‘¡åœ¨<span class="hljs-built_in">wait</span>()æˆ–<span class="hljs-built_in">get</span>()å†…éƒ¨è¿è¡Œä»»åŠ¡å‡½æ•°<br><span class="hljs-keyword">auto</span> f8=std::<span class="hljs-built_in">async</span>(    â‡½---  <br>   std::launch::deferred | std::launch::async,<br>   baz,std::<span class="hljs-built_in">ref</span>(x));<br><span class="hljs-keyword">auto</span> f9=std::<span class="hljs-built_in">async</span>(baz,std::<span class="hljs-built_in">ref</span>(x));     â‡½---  â‘¢äº¤ç”±å®ç°è‡ªè¡Œé€‰æ‹©è¿è¡Œæ–¹å¼<br>f<span class="hljs-number">7.</span><span class="hljs-built_in">wait</span>();    â‡½---  â‘£å‰é¢â‘¡å¤„çš„ä»»åŠ¡å‡½æ•°è°ƒç”¨è¢«å»¶åï¼Œåˆ°è¿™é‡Œæ‰è¿è¡Œ<br></code></pre></td></tr></table></figure><h3 id="4-2-2-å…³è”futureå®ä¾‹å’Œä»»åŠ¡"><a href="#4-2-2-å…³è”futureå®ä¾‹å’Œä»»åŠ¡" class="headerlink" title="4.2.2 å…³è”futureå®ä¾‹å’Œä»»åŠ¡"></a>4.2.2 å…³è”futureå®ä¾‹å’Œä»»åŠ¡</h3><p><code>std::packaged_task&lt;&gt;</code> è¿ç»“äº†futureå¯¹è±¡ä¸å‡½æ•°ï¼ˆæˆ–å¯è°ƒç”¨å¯¹è±¡ï¼‰ã€‚<code>std::packaged_task&lt;&gt;</code> å¯¹è±¡åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼šè°ƒç”¨å…³è”çš„å‡½æ•°ï¼ˆæˆ–å¯è°ƒç”¨å¯¹è±¡ï¼‰ï¼ŒæŠŠè¿”å›å€¼ä¿å­˜ä¸ºfutureçš„å†…éƒ¨æ•°æ®ï¼Œå¹¶ä»¤futureå‡†å¤‡å°±ç»ªã€‚</p><p><code>std::packaged_task&lt;&gt;</code> æ˜¯ç±»æ¨¡æ¿ï¼Œå…¶æ¨¡æ¿å‚æ•°æ˜¯å‡½æ•°ç­¾åã€‚ä¼ å…¥çš„å‡½æ•°å¿…é¡»ä¸ä¹‹ç›¸ç¬¦ï¼ˆä¸å¿…ä¸¥æ ¼åŒ¹é…ï¼Œåªè¦èƒ½å¤Ÿäº’ç›¸è½¬æ¢å³å¯ï¼‰ã€‚</p><p>ç±»æ¨¡æ¿ <code>std::packaged_task&lt;&gt;</code> å…·æœ‰æˆå‘˜å‡½æ•° <code>get_future()</code> ï¼Œå®ƒè¿”å›<code>std::future&lt;&gt;</code> å®ä¾‹ï¼Œè¯¥futureçš„ç‰¹åŒ–ç±»å‹å–å†³äºå‡½æ•°ç­¾åæ‰€æŒ‡å®šçš„è¿”å›å€¼ã€‚</p><p><code>std::packaged_task&lt;&gt;</code> è¿˜å…·å¤‡å‡½æ•°è°ƒç”¨æ“ä½œç¬¦ï¼Œå®ƒçš„å‚æ•°å–å†³äºå‡½æ•°ç­¾åçš„å‚æ•°åˆ—è¡¨ã€‚</p><p><code>std::packaged_task</code> å¯¹è±¡æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œè¿˜å¯ä»¥å°†å…¶åŒ…è£…åœ¨ <code>std::function</code> å¯¹è±¡å†…ï¼Œå½“ä½œçº¿ç¨‹å‡½æ•°ä¼ é€’ç»™ <code>std::thread</code> å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ç»™éœ€è¦å¯è°ƒç”¨å¯¹è±¡çš„å‡½æ•°ã€‚</p><p><strong>åœ¨çº¿ç¨‹é—´ä¼ é€’ä»»åŠ¡</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;deque&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;future&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;utility&gt;</span></span><br><br>std::mutex m;<br>std::deque&lt;std::packaged_task&lt;<span class="hljs-type">void</span>()&gt;&gt; tasks;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">gui_shutdown_message_received</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">get_and_process_gui_message</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">gui_thread</span><span class="hljs-params">()</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span>(!<span class="hljs-built_in">gui_shutdown_message_received</span>()) <br>    &#123;<br>        <span class="hljs-built_in">get_and_process_gui_message</span>();<br>        std::packaged_task&lt;<span class="hljs-built_in">void</span>()&gt; task;<br>        &#123;<br>            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(m)</span></span>;<br>            <span class="hljs-keyword">if</span>(tasks.<span class="hljs-built_in">empty</span>())   <br>                <span class="hljs-keyword">continue</span>;<br>            task=std::<span class="hljs-built_in">move</span>(tasks.<span class="hljs-built_in">front</span>());  <br>            tasks.<span class="hljs-built_in">pop_front</span>();<br>        &#125;<br>        <span class="hljs-built_in">task</span>();    <br>    &#125;<br>&#125;<br><span class="hljs-function">std::thread <span class="hljs-title">gui_bg_thread</span><span class="hljs-params">(gui_thread)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Func&gt;</span><br><span class="hljs-function">std::future&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title">post_task_for_gui_thread</span><span class="hljs-params">(Func f)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">std::packaged_task&lt;<span class="hljs-title">void</span><span class="hljs-params">()</span>&gt; <span class="hljs-title">task</span><span class="hljs-params">(f)</span></span>;   <br>    std::future&lt;<span class="hljs-type">void</span>&gt; res=task.<span class="hljs-built_in">get_future</span>();   <br>    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(m)</span></span>;<br>    tasks.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(task));   <br>    <span class="hljs-keyword">return</span> res; <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-2-3-åˆ›å»º-std-promise"><a href="#4-2-3-åˆ›å»º-std-promise" class="headerlink" title="4.2.3 åˆ›å»º std::promise"></a>4.2.3 åˆ›å»º <code>std::promise</code></h3><p><code>std::promise&lt;T&gt;</code> ç»™å‡ºäº†ä¸€ç§å¼‚æ­¥æ±‚å€¼çš„æ–¹æ³•ï¼ˆç±»å‹ä¸ºTï¼‰ï¼ŒæŸä¸ª<code>std::future&lt;T&gt;</code> å¯¹è±¡ä¸ç»“æœå…³è”ï¼Œèƒ½å»¶åè¯»å‡ºéœ€è¦æ±‚å–çš„å€¼ã€‚é…å¯¹çš„std::promiseå’Œstd::futureå¯å®ç°ä¸‹é¢çš„å·¥ä½œæœºåˆ¶ï¼šç­‰å¾…æ•°æ®çš„çº¿ç¨‹åœ¨futureä¸Šé˜»å¡ï¼Œè€Œæä¾›æ•°æ®çš„çº¿ç¨‹åˆ©ç”¨ç›¸é…çš„promiseè®¾å®šå…³è”çš„å€¼ï¼Œä½¿futureå‡†å¤‡å°±ç»ªã€‚</p><p>è‹¥éœ€ä»ç»™å®šçš„std::promiseå®ä¾‹è·å–å…³è”çš„std::futureå¯¹è±¡ï¼Œè°ƒç”¨å‰è€…çš„æˆå‘˜å‡½æ•°get_future()å³å¯ï¼Œè¿™ä¸std::packaged_taskä¸€æ ·ã€‚promiseçš„å€¼é€šè¿‡æˆå‘˜å‡½æ•°set_value()è®¾ç½®ï¼Œåªè¦è®¾ç½®å¥½ï¼Œfutureå³å‡†å¤‡å°±ç»ªï¼Œå‡­å€Ÿå®ƒå°±èƒ½è·å–è¯¥å€¼ã€‚å¦‚æœstd::promiseåœ¨è¢«é”€æ¯æ—¶ä»æœªæ›¾è®¾ç½®å€¼ï¼Œä¿å­˜çš„æ•°æ®åˆ™ç”±å¼‚å¸¸ä»£æ›¿ã€‚</p><h3 id="4-2-4-å°†å¼‚å¸¸ä¿å­˜åˆ°futureä¸­"><a href="#4-2-4-å°†å¼‚å¸¸ä¿å­˜åˆ°futureä¸­" class="headerlink" title="4.2.4 å°†å¼‚å¸¸ä¿å­˜åˆ°futureä¸­"></a>4.2.4 å°†å¼‚å¸¸ä¿å­˜åˆ°futureä¸­</h3><p><strong><code>std::async()</code></strong></p><p>è‹¥ç»ç”± <code>std::async()</code> è°ƒç”¨çš„å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œä¼šè¢«ä¿å­˜åˆ°futureä¸­ï¼Œä»£æ›¿æœ¬è¯¥è®¾å®šçš„å€¼ï¼Œfutureè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ç­‰åˆ°å…¶æˆå‘˜å‡½æ•°getè¢«è°ƒç”¨ï¼Œå¼‚å¸¸è¢«é‡æ–°æŠ›å‡ºã€‚</p><p><strong><code>std::packaged_task</code></strong></p><p>åŒä¸Šã€‚</p><p><strong><code>std::promise</code></strong></p><p>é€šè¿‡æˆå‘˜å‡½æ•°çš„æ˜¾ç¤ºè°ƒç”¨å®ç°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">extern</span> std::promise&lt;<span class="hljs-type">double</span>&gt; some_promise;<br><span class="hljs-keyword">try</span><br>&#123;<br>    some_promise.<span class="hljs-built_in">set_value</span>(<span class="hljs-built_in">calculate_value</span>());<br>&#125;<br><span class="hljs-built_in">catch</span>(...)<br>&#123;<br>    some_promise.<span class="hljs-built_in">set_exception</span>(std::<span class="hljs-built_in">current_exception</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ç›´æ¥é”€æ¯ä¸futureå…³è”çš„promiseå¯¹è±¡æˆ–packaged_taskå¯¹è±¡ã€‚</p><h3 id="4-2-5-å¤šä¸ªçº¿ç¨‹ä¸€èµ·ç­‰å¾…"><a href="#4-2-5-å¤šä¸ªçº¿ç¨‹ä¸€èµ·ç­‰å¾…" class="headerlink" title="4.2.5 å¤šä¸ªçº¿ç¨‹ä¸€èµ·ç­‰å¾…"></a>4.2.5 å¤šä¸ªçº¿ç¨‹ä¸€èµ·ç­‰å¾…</h3><p>è‹¥æˆ‘ä»¬åœ¨å¤šä¸ªçº¿ç¨‹ä¸Šè®¿é—®åŒä¸€ä¸ªstd::futureå¯¹è±¡ï¼Œè€Œä¸é‡‡å–é¢å¤–çš„åŒæ­¥æªæ–½ï¼Œå°†å¼•å‘æ•°æ®ç«äº‰å¹¶å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p><p>std::futureä»…èƒ½ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼ï¼Œæ‰€ä»¥å½’å±æƒå¯åœ¨å¤šä¸ªå®ä¾‹ä¹‹é—´è½¬ç§»ï¼Œä½†åœ¨ç›¸åŒæ—¶åˆ»ï¼Œåªä¼šæœ‰å”¯ä¸€ä¸€ä¸ªfutureå®ä¾‹æŒ‡å‘ç‰¹å®šçš„å¼‚æ­¥ç»“æœï¼›</p><p>std::shared_futureçš„å®ä¾‹åˆ™èƒ½å¤åˆ¶å‡ºå‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŒæœ‰è¯¥ç±»çš„å¤šä¸ªå¯¹è±¡ï¼Œå®ƒä»¬å…¨æŒ‡å‘åŒä¸€å¼‚æ­¥ä»»åŠ¡çš„çŠ¶æ€æ•°æ®ã€‚</p><p><img src="/../images/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter4/image-20250129152205506.png"></p><p>å‘æ¯ä¸ªçº¿ç¨‹ä¼ é€’std::shared_futureå¯¹è±¡çš„å‰¯æœ¬ï¼Œå®ƒä»¬ä¸ºå„çº¿ç¨‹ç‹¬è‡ªæ‰€æœ‰ï¼Œå¹¶è¢«è§†ä½œå±€éƒ¨å˜é‡ã€‚å› æ­¤ï¼Œè¿™äº›å‰¯æœ¬å°±ä½œä¸ºå„çº¿ç¨‹çš„å†…éƒ¨æ•°æ®ï¼Œç”±æ ‡å‡†åº“æ­£ç¡®åœ°åŒæ­¥ï¼Œå¯ä»¥å®‰å…¨åœ°è®¿é—®ã€‚</p><p>std::shared_futureçš„å®ä¾‹ä¾æ®std::futureçš„å®ä¾‹æ„é€ è€Œå¾—ï¼Œå‰è€…æ‰€æŒ‡å‘çš„å¼‚æ­¥çŠ¶æ€ç”±åè€…å†³å®šã€‚å› ä¸ºstd::futureå¯¹è±¡ç‹¬å å¼‚æ­¥çŠ¶æ€ï¼Œå…¶å½’å±æƒä¸ä¸ºå…¶ä»–ä»»ä½•å¯¹è±¡æ‰€å…±æœ‰ï¼Œæ‰€ä»¥è‹¥è¦æŒ‰é»˜è®¤æ–¹å¼æ„é€ std::shared_futureå¯¹è±¡ï¼Œåˆ™é¡»ç”¨std::moveå‘å…¶é»˜è®¤æ„é€ å‡½æ•°ä¼ é€’å½’å±æƒï¼Œè¿™ä½¿std::futureå˜æˆç©ºçŠ¶æ€ï¼ˆempty stateï¼‰ã€‚</p><p>std::futureå…·æœ‰æˆå‘˜å‡½æ•°share()ï¼Œç›´æ¥åˆ›å»ºæ–°çš„std::shared_futureå¯¹è±¡ï¼Œå¹¶å‘å®ƒè½¬ç§»å½’å±æƒã€‚</p><h2 id="4-3-é™æ—¶ç­‰å¾…"><a href="#4-3-é™æ—¶ç­‰å¾…" class="headerlink" title="4.3 é™æ—¶ç­‰å¾…"></a>4.3 é™æ—¶ç­‰å¾…</h2>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++å¹¶å‘ç¼–ç¨‹å®æˆ˜Chapter3</title>
    <link href="/2025/01/26/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter3/"/>
    <url>/2025/01/26/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter3/</url>
    
    <content type="html"><![CDATA[<h1 id="3-åœ¨çº¿ç¨‹é—´å…±äº«æ•°æ®"><a href="#3-åœ¨çº¿ç¨‹é—´å…±äº«æ•°æ®" class="headerlink" title="3 åœ¨çº¿ç¨‹é—´å…±äº«æ•°æ®"></a>3 åœ¨çº¿ç¨‹é—´å…±äº«æ•°æ®</h1><h2 id="3-1-çº¿ç¨‹é—´å…±äº«æ•°æ®çš„é—®é¢˜"><a href="#3-1-çº¿ç¨‹é—´å…±äº«æ•°æ®çš„é—®é¢˜" class="headerlink" title="3.1 çº¿ç¨‹é—´å…±äº«æ•°æ®çš„é—®é¢˜"></a>3.1 çº¿ç¨‹é—´å…±äº«æ•°æ®çš„é—®é¢˜</h2><div class="note note-primary">            <p>å½’æ ¹ç»“åº•ï¼Œå¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜å¤šç”±æ•°æ®æ”¹åŠ¨å¼•å‘ã€‚å¦‚æœæ‰€æœ‰å…±äº«æ•°æ®éƒ½æ˜¯åªè¯»æ•°æ®ï¼Œå°±ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>          </div><p><strong>ä¸å˜é‡(invariant)</strong></p><p>å®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹æŸä¸€ç‰¹å®šæ•°æ®çš„æ–­è¨€ï¼Œè¯¥æ–­è¨€æ€»æ˜¯æˆç«‹çš„ï¼Œä¾‹å¦‚â€œè¿™ä¸ªå˜é‡çš„å€¼å³ä¸ºé“¾è¡¨å…ƒç´ çš„æ•°ç›®â€ã€‚æ•°æ®æ›´æ–°å¾€å¾€ä¼šç ´åè¿™äº›ä¸å˜é‡ã€‚</p><p>æ”¹åŠ¨çº¿ç¨‹é—´çš„å…±äº«æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´ä¸å˜é‡è¢«ç ´åã€‚ä¾‹å¦‚å¯¹äºåŒå‘é“¾è¡¨ï¼Œä¸å˜é‡å°±æ˜¯å¦‚æœAèŠ‚ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘BèŠ‚ç‚¹ï¼Œé‚£ä¹ˆBèŠ‚ç‚¹çš„prevæŒ‡é’ˆåº”è¯¥æŒ‡å‘AèŠ‚ç‚¹ã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤åŒå‘é“¾è¡¨ä¸­çš„æŸä¸ªèŠ‚ç‚¹Nï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹NèŠ‚ç‚¹å‰é©±èŠ‚ç‚¹Açš„nextæŒ‡é’ˆå’ŒNèŠ‚ç‚¹åç»§èŠ‚ç‚¹çš„prevæŒ‡é’ˆã€‚å½“æˆ‘ä»¬åªä¿®æ”¹äº†ä¸€ä¸ªæŒ‡é’ˆçš„æ—¶å€™ï¼Œä¸å˜é‡å³è¢«ç ´åã€‚</p><h3 id="3-1-1-æ¡ä»¶ç«äº‰"><a href="#3-1-1-æ¡ä»¶ç«äº‰" class="headerlink" title="3.1.1 æ¡ä»¶ç«äº‰"></a>3.1.1 æ¡ä»¶ç«äº‰</h3><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæ“ä½œç”±ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è´Ÿè´£ï¼Œå®ƒä»¬äº‰å…ˆè®©çº¿ç¨‹æ‰§è¡Œå„è‡ªçš„æ“ä½œï¼Œè€Œç»“æœå–å†³äºå®ƒä»¬æ‰§è¡Œçš„ç›¸å¯¹æ¬¡åºï¼Œæ‰€æœ‰è¿™ç§æƒ…å†µéƒ½æ˜¯æ¡ä»¶ç«äº‰ã€‚</p><ul><li>è‰¯æ€§æ¡ä»¶ç«äº‰ï¼šä¾‹å¦‚ï¼Œä¸¤ä¸ªçº¿ç¨‹å‘é˜Ÿåˆ—æ·»åŠ æ•°æ®é¡¹ä»¥å¾…å¤„ç†ï¼Œåªè¦ç»´æŒä½ç³»ç»Ÿçš„ä¸å˜é‡ï¼Œå…ˆæ·»åŠ å“ªä¸ªæ•°æ®é¡¹é€šå¸¸å¹¶ä¸é‡è¦ã€‚</li><li>æ¶è¡Œæ¡ä»¶ç«äº‰ï¼šå½“æ¡ä»¶ç«äº‰å¯¼è‡´ä¸å˜é‡è¢«ç ´åæ—¶ï¼Œæ‰ä¼šäº§ç”Ÿé—®é¢˜ï¼Œæ­£å¦‚å‰é¢ä¸¾ä¾‹çš„åŒå‘é“¾è¡¨ã€‚</li></ul><h3 id="3-1-2-é˜²æ­¢æ¶æ€§æ¡ä»¶ç«äº‰"><a href="#3-1-2-é˜²æ­¢æ¶æ€§æ¡ä»¶ç«äº‰" class="headerlink" title="3.1.2 é˜²æ­¢æ¶æ€§æ¡ä»¶ç«äº‰"></a>3.1.2 é˜²æ­¢æ¶æ€§æ¡ä»¶ç«äº‰</h3><p>å‡ ç§é˜²æ­¢æ¶æ€§æ¡ä»¶ç«äº‰çš„æ–¹æ³•ï¼š</p><ol><li>é‡‡å–ä¿æŠ¤æªæ–½åŒ…è£…æ•°æ®ç»“æ„ï¼Œç¡®ä¿ä¸å˜é‡è¢«ç ´åæ—¶ï¼Œä¸­é—´çŠ¶æ€åªå¯¹æ‰§è¡Œæ”¹åŠ¨çš„çº¿ç¨‹å¯è§ã€‚åœ¨å…¶ä»–è®¿é—®åŒä¸€æ•°æ®ç»“æ„çš„çº¿ç¨‹çš„è§†è§’ä¸­ï¼Œè¿™ç§æ”¹åŠ¨è¦ä¹ˆå°šæœªå¼€å§‹ï¼Œè¦ä¹ˆå·²ç»å®Œæˆã€‚</li><li>ä¿®æ”¹æ•°æ®ç»“æ„çš„è®¾è®¡åŠå…¶ä¸å˜é‡ï¼Œç”±ä¸€è¿ä¸²ä¸å¯æ‹†åˆ†çš„æ”¹åŠ¨å®Œæˆæ•°æ®å˜æ›´ï¼Œæ¯ä¸ªæ”¹åŠ¨éƒ½ç»´æŒä¸å˜é‡ä¸è¢«ç ´åã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºæ— é”ç¼–ç¨‹ï¼Œéš¾ä»¥æ­£ç¡®ç¼–å†™ã€‚</li><li>å°†ä¿®æ”¹æ•°æ®ç»“æ„å½“ä½œäº‹åŠ¡ï¼ˆtransactionï¼‰æ¥å¤„ç†ï¼Œç±»ä¼¼äºæ•°æ®åº“åœ¨ä¸€ä¸ªäº‹åŠ¡å†…å®Œæˆæ›´æ–°ï¼šæŠŠéœ€è¦æ‰§è¡Œçš„æ•°æ®è¯»å†™æ“ä½œè§†ä¸ºä¸€ä¸ªå®Œæ•´åºåˆ—ï¼Œå…ˆç”¨äº‹åŠ¡æ—¥å¿—å­˜å‚¨è®°å½•ï¼Œå†æŠŠåºåˆ—å½“æˆå•ä¸€æ­¥éª¤æäº¤è¿è¡Œã€‚è‹¥åˆ«çš„çº¿ç¨‹æ”¹åŠ¨äº†æ•°æ®è€Œä»¤æäº¤æ— æ³•å®Œæ•´æ‰§è¡Œï¼Œåˆ™äº‹åŠ¡é‡æ–°å¼€å§‹ã€‚è¿™ç§°ä¸ºè½¯ä»¶äº‹åŠ¡å†…å­˜ï¼ˆSoftware Transactional Memoryï¼ŒSTMï¼‰ã€‚</li></ol><h2 id="3-2-ç”¨äº’æ–¥ä¿æŠ¤å…±äº«æ•°æ®"><a href="#3-2-ç”¨äº’æ–¥ä¿æŠ¤å…±äº«æ•°æ®" class="headerlink" title="3.2 ç”¨äº’æ–¥ä¿æŠ¤å…±äº«æ•°æ®"></a>3.2 ç”¨äº’æ–¥ä¿æŠ¤å…±äº«æ•°æ®</h2><p>æ ‡è®°è®¿é—®è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰ä»£ç ï¼Œä»¤å„çº¿ç¨‹åœ¨å…¶ä¸Šç›¸äº’æ’æ–¥ï¼ˆmutually exclusiveï¼‰ï¼Œåªè¦æœ‰çº¿ç¨‹æ­£åœ¨è¿è¡Œæ ‡è®°çš„ä»£ç ï¼Œä»»ä½•åˆ«çš„çº¿ç¨‹æ„å›¾è®¿é—®åŒä¸€ä»½æ•°æ®ï¼Œåˆ™å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°è¯¥çº¿ç¨‹å®Œäº‹ã€‚</p><p>C++çº¿ç¨‹åº“ä¿è¯äº†ï¼Œä¸€æ—¦æœ‰çº¿ç¨‹é”ä½äº†æŸä¸ªäº’æ–¥ï¼Œè‹¥å…¶ä»–çº¿ç¨‹è¯•å›¾å†ç»™å®ƒåŠ é”ï¼Œåˆ™é¡»ç­‰å¾…ï¼Œç›´è‡³æœ€åˆæˆåŠŸåŠ é”çš„çº¿ç¨‹æŠŠè¯¥äº’æ–¥è§£é”ã€‚</p><h3 id="3-2-1"><a href="#3-2-1" class="headerlink" title="3.2.1"></a>3.2.1</h3><p>åœ¨C++ä¸­ï¼Œé€šè¿‡æ„é€ std::mutexçš„å®ä¾‹æ¥åˆ›å»ºäº’æ–¥ï¼Œè°ƒç”¨æˆå‘˜å‡½æ•°lock()å¯¹å…¶åŠ é”ï¼Œè°ƒç”¨unlock()è§£é”ã€‚</p><p>ä½†æ›´å¥½çš„åšæ³•æ˜¯è¿ç”¨RAIIçš„æ‰‹æ³•ï¼ŒC++æ ‡å‡†åº“æä¾›äº†ç±»æ¨¡æ¿std::lock_guard&lt;&gt;ï¼Œé’ˆå¯¹äº’æ–¥ç±»èåˆå®ç°äº†RAIIæ‰‹æ³•ï¼šåœ¨æ„é€ æ—¶ç»™äº’æ–¥åŠ é”ï¼Œåœ¨ææ„æ—¶è§£é”ï¼Œä»è€Œä¿è¯äº’æ–¥æ€»è¢«æ­£ç¡®è§£é”ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br>std::list&lt;<span class="hljs-type">int</span>&gt; some_list;<br>std::mutex some_mutex;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_to_list</span><span class="hljs-params">(<span class="hljs-type">int</span> new_value)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">guard</span><span class="hljs-params">(some_mutex)</span></span>; <br>    some_list.<span class="hljs-built_in">push_back</span>(new_value);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">list_contains</span><span class="hljs-params">(<span class="hljs-type">int</span> value_to_find)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">guard</span><span class="hljs-params">(some_mutex)</span></span>;<br>    <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">find</span>(some_list.<span class="hljs-built_in">begin</span>(),some_list.<span class="hljs-built_in">end</span>(),value_to_find)<br>        != some_list.<span class="hljs-built_in">end</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>C++17å¼•å…¥äº†ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œåä¸ºç±»æ¨¡æ¿å‚æ•°æ¨å¯¼ï¼ˆclass template argument deductionï¼‰ï¼Œå¯¹äºstd::lock_guard&lt;&gt;è¿™ç§ç®€å•çš„ç±»æ¨¡æ¿ï¼Œæ¨¡æ¿å‚æ•°åˆ—è¡¨å¯ä»¥å¿½ç•¥ã€‚</p><p><strong>æ³¨æ„</strong></p><p>å¦‚æœæˆå‘˜å‡½æ•°è¿”å›æŒ‡é’ˆæˆ–å¼•ç”¨ï¼ŒæŒ‡å‘å—ä¿æŠ¤çš„å…±äº«æ•°æ®ï¼Œé‚£ä¹ˆå³ä¾¿æˆå‘˜å‡½æ•°å…¨éƒ½æŒ‰è‰¯å¥½ã€æœ‰åºçš„æ–¹å¼é”å®šäº’æ–¥ï¼Œä»ç„¶æ— æµäºäº‹ï¼Œå› ä¸ºä¿æŠ¤å·²è¢«æ‰“ç ´ï¼Œå‡ºç°äº†å¤§æ¼æ´ã€‚åªè¦å­˜åœ¨ä»»ä½•èƒ½è®¿é—®è¯¥æŒ‡é’ˆå’Œå¼•ç”¨çš„ä»£ç ï¼Œå®ƒå°±å¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å…±äº«æ•°æ®ï¼ˆä¹Ÿå¯ä»¥ä¿®æ”¹ï¼‰ï¼Œè€Œæ— é¡»é”å®šäº’æ–¥ã€‚æ‰€ä»¥ï¼Œè‹¥åˆ©ç”¨äº’æ–¥ä¿æŠ¤å…±äº«æ•°æ®ï¼Œåˆ™éœ€è°¨æ…è®¾è®¡ç¨‹åºæ¥å£ï¼Œä»è€Œç¡®ä¿äº’æ–¥å·²å…ˆè¡Œé”å®šï¼Œå†å¯¹å—ä¿æŠ¤çš„å…±äº«æ•°æ®è¿›è¡Œè®¿é—®ï¼Œå¹¶ä¿è¯ä¸ç•™åé—¨ã€‚</p><h3 id="3-2-2-ç»„ç»‡å’Œç¼–æ’ä»£ç ä»¥ä¿æŠ¤å…±äº«æ•°æ®"><a href="#3-2-2-ç»„ç»‡å’Œç¼–æ’ä»£ç ä»¥ä¿æŠ¤å…±äº«æ•°æ®" class="headerlink" title="3.2.2 ç»„ç»‡å’Œç¼–æ’ä»£ç ä»¥ä¿æŠ¤å…±äº«æ•°æ®"></a>3.2.2 ç»„ç»‡å’Œç¼–æ’ä»£ç ä»¥ä¿æŠ¤å…±äº«æ•°æ®</h3><p>æœ‰å‡ ç§æƒ…å†µä¼šå¯¼è‡´ä¿æŠ¤å¤±æ•ˆï¼š</p><ul><li>æˆå‘˜å‡½æ•°å‘è°ƒç”¨è€…è¿”å›æŒ‡å‘å…±äº«æ•°æ®çš„æŒ‡é’ˆæˆ–å¼•ç”¨</li><li>è‹¥æˆå‘˜å‡½æ•°åœ¨è‡ªèº«å†…éƒ¨è°ƒç”¨äº†åˆ«çš„å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è€ƒè™‘å‘è¿™äº›å‡½æ•°ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æ˜¯å¦å®‰å…¨ã€‚å¦‚æœè¯¥å‡½æ•°å°†å…±äº«æ•°æ®çš„åœ°å€å­˜èµ·æ¥ï¼Œç­‰åˆ°è„±ç¦»ä¿æŠ¤ä¹‹åå†å»è®¿é—®ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸è‰¯åæœã€‚</li></ul><p>æœ¬è´¨ä¸Šï¼Œä¸Šè¿°é—®é¢˜æ˜¯ç”±äºæœªèƒ½æŠŠæ‰€æœ‰è®¿é—®å…±äº«æ•°æ®çš„ä»£ç éƒ½æ ‡è®°ä¸ºäº’æ–¥ã€‚</p><div class="note note-primary">            <p>ä¸å¾—å‘é”æ‰€åœ¨çš„ä½œç”¨åŸŸä¹‹å¤–ä¼ é€’æŒ‡é’ˆå’Œå¼•ç”¨ï¼ŒæŒ‡å‘å—ä¿æŠ¤çš„å…±äº«æ•°æ®ï¼Œæ— è®ºæ˜¯é€šè¿‡å‡½æ•°è¿”å›å€¼å°†å®ƒä»¬ä¿å­˜åˆ°å¯¹å¤–å¯è§çš„å†…å­˜ï¼Œè¿˜æ˜¯å°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä½¿ç”¨è€…æä¾›çš„å‡½æ•°ã€‚</p>          </div><h3 id="3-2-3-å‘ç°æ¥å£å›ºæœ‰çš„æ¡ä»¶ç«äº‰"><a href="#3-2-3-å‘ç°æ¥å£å›ºæœ‰çš„æ¡ä»¶ç«äº‰" class="headerlink" title="3.2.3 å‘ç°æ¥å£å›ºæœ‰çš„æ¡ä»¶ç«äº‰"></a>3.2.3 å‘ç°æ¥å£å›ºæœ‰çš„æ¡ä»¶ç«äº‰</h3><p>è€ƒè™‘stackå®¹å™¨ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå…¶emptyå’Œsizeçš„ç»“æœä¸å¯ä¿¡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++">stack&lt;<span class="hljs-type">int</span>&gt; s;<br><span class="hljs-keyword">if</span>(!s.<span class="hljs-built_in">empty</span>()) <br>&#123;<br>    <span class="hljs-type">int</span> <span class="hljs-type">const</span> value=s.<span class="hljs-built_in">top</span>();<br>    s.<span class="hljs-built_in">pop</span>();  <br>    <span class="hljs-built_in">do_something</span>(value);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åœ¨ifåˆ¤æ–­å’Œè®¿é—®æ ˆé¡¶å…ƒç´ ä¹‹é—´ï¼Œå¯èƒ½æœ‰åˆ«çš„çº¿ç¨‹å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå¯¼è‡´æ ˆç©ºï¼Œä»è€Œå¼•å‘æœªå®šä¹‰è¡Œä¸ºã€‚</li><li>åœ¨topå’Œpopä¹‹é—´ï¼Œä¹Ÿå­˜åœ¨æ¡ä»¶ç«äº‰ï¼šä¸¤ä¸ªçº¿ç¨‹éƒ½è®¿é—®æ ˆé¡¶å…ƒç´ ï¼Œç„¶åå‡ºæ ˆï¼Œä¼šå¯¼è‡´æœ‰ä¸€ä¸ªå…ƒç´ è¢«å¿½ç•¥æ‰äº†ã€‚</li></ul><p>ä¸ºäº†è§£å†³ç¬¬äºŒä¸ªæ¡ä»¶ç«äº‰ï¼Œæ¯”è¾ƒè‡ªç„¶çš„æƒ³æ³•æ˜¯å°†topå’Œpopåˆæˆä¸ºä¸€ä¸ªæ“ä½œï¼Œä½†æ˜¯è¿™å¯èƒ½ä¼šå¯¼è‡´å¼‚å¸¸ä¸å®‰å…¨ã€‚å½“æ ˆä¸­å­˜å‚¨çš„å¯¹è±¡çš„æ‹·è´æ„é€ å‡½æ•°å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ï¼Œå¯èƒ½æ— æ³•æ­£ç¡®è·å¾—å…¶å¯¹è±¡ï¼Œä½†æ˜¯è¯¥å¯¹è±¡å·²ç»ä»æ ˆä¸Šè¢«å¼¹å‡ºäº†ã€‚</p><p>æ¶ˆé™¤æ¡ä»¶ç«äº‰çš„æ–¹æ³•ï¼š</p><ul><li>ä¼ å…¥å¼•ç”¨</li></ul><p>å€Ÿä¸€ä¸ªå¤–éƒ¨å˜é‡æ¥æ”¶æ ˆå®¹å™¨å¼¹å‡ºçš„å…ƒç´ ï¼Œå°†æŒ‡æ¶‰å®ƒçš„å¼•ç”¨é€šè¿‡å‚æ•°ä¼ å…¥pop()è°ƒç”¨ã€‚</p><p>é—®é¢˜ï¼š</p><p>è¿™ç§æ–¹æ³•è¦æ±‚æ ˆå®¹å™¨å­˜å‚¨çš„å‹åˆ«æ˜¯å¯èµ‹å€¼çš„ï¼ˆassignableï¼‰ã€‚</p><ul><li>æä¾›ä¸æŠ›å‡ºå¼‚å¸¸çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œæˆ–ä¸æŠ›å‡ºå¼‚å¸¸çš„ç§»åŠ¨æ„é€ å‡½æ•°</li><li>è¿”å›æŒ‡é’ˆï¼ŒæŒ‡å‘å¼¹å‡ºçš„å…ƒç´ </li></ul><p>ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é¿å…äº†å†…å­˜æ³„æ¼ï¼Œå¹¶ä¸”ç”±c++æ ‡å‡†åº“è´Ÿè´£ç®¡ç†å†…å­˜ã€‚</p><h3 id="3-2-4-æ­»é”"><a href="#3-2-4-æ­»é”" class="headerlink" title="3.2.4 æ­»é”"></a>3.2.4 æ­»é”</h3><p>C++æ ‡å‡†åº“æä¾›äº†std::lock()å‡½æ•°ã€‚å®ƒå¯ä»¥åŒæ—¶é”ä½å¤šä¸ªäº’æ–¥ï¼Œè€Œæ²¡æœ‰å‘ç”Ÿæ­»é”çš„é£é™©ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">some_big_object</span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(some_big_object&amp; lhs, some_big_object&amp; rhs)</span></span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">X</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    some_big_object some_detail;<br>    std::mutex m;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">X</span>(some_big_object <span class="hljs-type">const</span>&amp; sd):<span class="hljs-built_in">some_detail</span>(sd)&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(X&amp; lhs, X&amp; rhs)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(&amp;lhs==&amp;rhs)<br>            <span class="hljs-keyword">return</span>;<br>        std::<span class="hljs-built_in">lock</span>(lhs.m,rhs.m);   <br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock_a</span><span class="hljs-params">(lhs.m, std::adopt_lock)</span></span>; <br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock_b</span><span class="hljs-params">(rhs.m, std::adopt_lock)</span></span>;<br>        <span class="hljs-built_in">swap</span>(lhs.some_detail,rhs.some_detail);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><code>std::lock</code> é”å®šä¸¤ä¸ªäº’æ–¥ï¼Œå…¶è¯­ä¹‰æ˜¯â€œå…¨å‘˜å…±åŒæˆè´¥â€ï¼ˆall-or-nothingï¼Œæˆ–å…¨éƒ¨æˆåŠŸé”å®šï¼Œæˆ–æ²¡è·å–ä»»ä½•é”å¹¶æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚</p><p><code>std::adopt_lock</code> æŒ‡æ˜äº’æ–¥å·²ç»é”å®šï¼Œ<code>std::lock_guard</code> åº”è¯¥æ¥æ”¶æ‰€æœ‰æƒï¼Œè€Œä¸æ˜¯è¯•å›¾åŠ é”ã€‚</p><p>å¿…é¡»å…ˆåˆ¤æ–­äº¤æ¢å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºå¯¹æŸä¸ª <code>std::mutex</code> å¯¹è±¡é‡å¤åŠ é”å°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼ˆ<code>std::recursive_mutex</code> å¯ä»¥é‡å¤åŠ é”ï¼‰ã€‚</p><p>é’ˆå¯¹ä»¥ä¸Šåœºæ™¯ï¼ŒC++17è¿˜è¿›ä¸€æ­¥æä¾›äº†æ–°çš„RAIIç±»æ¨¡æ¿std::scoped_lock&lt;&gt;ã€‚std:: scoped_lock&lt;&gt;å’Œstd::lock_guard&lt;&gt;å®Œå…¨ç­‰ä»·ï¼Œåªä¸è¿‡å‰è€…æ˜¯å¯å˜å‚æ•°æ¨¡æ¿ï¼ˆvariadic templateï¼‰ï¼Œæ¥æ”¶å„ç§äº’æ–¥å‹åˆ«ä½œä¸ºæ¨¡æ¿å‚æ•°åˆ—è¡¨ï¼Œè¿˜ä»¥å¤šä¸ªäº’æ–¥å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚ä¸‹åˆ—ä»£ç ä¸­ï¼Œä¼ å…¥æ„é€ å‡½æ•°çš„ä¸¤ä¸ªäº’æ–¥éƒ½è¢«åŠ é”ï¼Œæœºåˆ¶ä¸std::lock()å‡½æ•°ç›¸åŒï¼Œå› æ­¤ï¼Œå½“æ„é€ å‡½æ•°å®Œæˆæ—¶ï¼Œå®ƒä»¬å°±éƒ½è¢«é”å®šï¼Œè€Œåï¼Œåœ¨ææ„å‡½æ•°å†…ä¸€èµ·è¢«è§£é”ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(X&amp; lhs, X&amp; rhs)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(&amp;lhs==&amp;rhs)<br>            <span class="hljs-keyword">return</span>;<br>        <span class="hljs-function">std::scoped_lock <span class="hljs-title">guard</span><span class="hljs-params">(lhs.m,rhs.m)</span></span>;  <br>        <span class="hljs-built_in">swap</span>(lhs.some_detail,rhs.some_detail);<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="3-2-5-é˜²èŒƒæ­»é”çš„è¡¥å……åŸåˆ™"><a href="#3-2-5-é˜²èŒƒæ­»é”çš„è¡¥å……åŸåˆ™" class="headerlink" title="3.2.5 é˜²èŒƒæ­»é”çš„è¡¥å……åŸåˆ™"></a>3.2.5 é˜²èŒƒæ­»é”çš„è¡¥å……åŸåˆ™</h3><p>æ²¡æœ‰æ¶‰åŠé”ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿæ­»é”ç°è±¡ã€‚å‡å®šæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå„è‡ªå…³è”äº†std::threadå®ä¾‹ï¼Œè‹¥å®ƒä»¬åŒæ—¶åœ¨å¯¹æ–¹çš„std::threadå®ä¾‹ä¸Šè°ƒç”¨join()ï¼Œå°±èƒ½åˆ¶é€ å‡ºæ­»é”ç°è±¡å´ä¸æ¶‰åŠé”æ“ä½œã€‚</p><p>é˜²èŒƒæ­»é”çš„å‡†åˆ™æœ€ç»ˆå¯å½’çº³æˆä¸€ä¸ªæ€æƒ³ï¼šåªè¦å¦ä¸€çº¿ç¨‹æœ‰å¯èƒ½æ­£åœ¨ç­‰å¾…å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åƒä¸‡ä¸èƒ½åè¿‡æ¥ç­‰å¾…å®ƒã€‚</p><h4 id="1-é¿å…åµŒå¥—é”"><a href="#1-é¿å…åµŒå¥—é”" class="headerlink" title="1 é¿å…åµŒå¥—é”"></a>1 é¿å…åµŒå¥—é”</h4><p>å‡å¦‚å·²ç»æŒæœ‰é”ï¼Œä¸è¦è¯•å›¾è·å–ç¬¬äºŒä¸ªé”ã€‚è¿™æ ·ä¸ä¼šå› ä¸ºé”å¯¼è‡´æ­»é”ï¼Œä½†æ˜¯ä»ç„¶æœ‰å¯èƒ½å‡ºç°æ­»é”ç°è±¡ï¼ˆçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼‰ã€‚</p><p>å¦‚æœä¸€å®šè¦è·å–å¤šä¸ªé”ï¼Œæœ€å¥½é‡‡ç”¨ <code>std::lock</code> æˆ–è€… <code>std::scoped_lock</code>.</p><h4 id="2-ä¸€æ—¦æŒé”ï¼Œå°±é¡»é¿å…ç”±ç”¨æˆ·æä¾›çš„ç¨‹åºæ¥å£"><a href="#2-ä¸€æ—¦æŒé”ï¼Œå°±é¡»é¿å…ç”±ç”¨æˆ·æä¾›çš„ç¨‹åºæ¥å£" class="headerlink" title="2 ä¸€æ—¦æŒé”ï¼Œå°±é¡»é¿å…ç”±ç”¨æˆ·æä¾›çš„ç¨‹åºæ¥å£"></a>2 ä¸€æ—¦æŒé”ï¼Œå°±é¡»é¿å…ç”±ç”¨æˆ·æä¾›çš„ç¨‹åºæ¥å£</h4><p>å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·æä¾›çš„æ¥å£ä¼šåšä»€ä¹ˆï¼Œå®ƒå¯èƒ½è¦è·å–é”å¯¼è‡´æ­»é”ã€‚</p><h4 id="3-ä¾ä»å›ºå®šé¡ºåºè·å–é”"><a href="#3-ä¾ä»å›ºå®šé¡ºåºè·å–é”" class="headerlink" title="3 ä¾ä»å›ºå®šé¡ºåºè·å–é”"></a>3 ä¾ä»å›ºå®šé¡ºåºè·å–é”</h4><h4 id="4-æŒ‰å±‚çº§åŠ é”"><a href="#4-æŒ‰å±‚çº§åŠ é”" class="headerlink" title="4 æŒ‰å±‚çº§åŠ é”"></a>4 æŒ‰å±‚çº§åŠ é”</h4><p>å¯ä»¥å®ç°ä¸€ä¸ª <code> hierarchical_mutex</code> æ¥æŒ‰ç…§å±‚çº§åŠ é”ï¼Œåªèƒ½æŒ‰ç…§å±‚çº§ä»é«˜åˆ°ä½çš„æ–¹å‘åŠ é”ã€‚åªè¦å®ç°äº† <code>lock(),unlock(),try_lock()</code> ä¸‰ä¸ªæˆå‘˜å‡½æ•°ï¼Œå°±å¯ä»¥å’Œ <code>std::lock_guard</code> é…åˆä½¿ç”¨ã€‚<code>try_lock()</code> : è‹¥å¦ä¸€çº¿ç¨‹å·²åœ¨ç›®æ ‡äº’æ–¥ä¸ŠæŒæœ‰é”ï¼Œåˆ™å‡½æ•°ç«‹å³è¿”å›falseï¼Œå®Œå…¨ä¸ç­‰å¾…ã€‚</p><p>ä¸ºäº†å­˜å‚¨å½“å‰å±‚çº§ç¼–å·ï¼Œ<code>hierarchical_mutex</code> çš„å®ç°ä½¿ç”¨äº†çº¿ç¨‹ä¸“å±çš„å±€éƒ¨å˜é‡ï¼ˆç”¨ <code>thread_local</code> ä¿®é¥°ï¼‰ã€‚æ‰€æœ‰äº’æ–¥çš„å®ä¾‹éƒ½èƒ½è¯»å–è¯¥å˜é‡ï¼Œä½†å®ƒçš„å€¼å› ä¸åŒçº¿ç¨‹è€Œå¼‚ã€‚è¿™ä½¿ä»£ç å¯ä»¥ç‹¬ç«‹æ£€æµ‹å„çº¿ç¨‹çš„è¡Œä¸ºï¼Œå„äº’æ–¥éƒ½èƒ½åˆ¤æ–­æ˜¯å¦å…è®¸å½“å‰çº¿ç¨‹å¯¹å…¶åŠ é”ã€‚</p><h4 id="5-å°†å‡†åˆ™æ¨å¹¿åˆ°é”æ“ä½œä»¥å¤–"><a href="#5-å°†å‡†åˆ™æ¨å¹¿åˆ°é”æ“ä½œä»¥å¤–" class="headerlink" title="5 å°†å‡†åˆ™æ¨å¹¿åˆ°é”æ“ä½œä»¥å¤–"></a>5 å°†å‡†åˆ™æ¨å¹¿åˆ°é”æ“ä½œä»¥å¤–</h4><p>å¯¹äºçº¿ç¨‹äº’ç›¸ç­‰å¾…çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ç”¨ä¸Šè¿°çš„æ–¹æ³•æ¥è§£å†³ã€‚å¹¶ä¸”è¿˜å¯ä»¥è®©åŒä¸€ä¸ªå‡½æ•°å¯åŠ¨å…¨éƒ¨çº¿ç¨‹ï¼Œä¸”æ±‡åˆå·¥ä½œä¹Ÿç”±ä¹‹è´Ÿè´£ã€‚</p><h3 id="3-2-6-è¿ç”¨-std-unique-lock-çµæ´»åŠ é”"><a href="#3-2-6-è¿ç”¨-std-unique-lock-çµæ´»åŠ é”" class="headerlink" title="3.2.6 è¿ç”¨ std::unique_lock çµæ´»åŠ é”"></a>3.2.6 è¿ç”¨ <code>std::unique_lock</code> çµæ´»åŠ é”</h3><p>ç±»æ¨¡æ¿ <code>std::unique_lock&lt;&gt;</code> æ”¾å®½äº†ä¸å˜é‡çš„æˆç«‹æ¡ä»¶ï¼Œå®ƒç›¸è¾ƒ <code>std::lock_guard&lt;&gt;</code> æ›´çµæ´»ä¸€äº›ã€‚<code>std::unique_lock</code> å¯¹è±¡ä¸ä¸€å®šå§‹ç»ˆå æœ‰ä¸ä¹‹å…³è”çš„äº’æ–¥ã€‚</p><p>å…¶æ„é€ å‡½æ•°æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼š</p><ul><li>æˆ‘ä»¬å¯ä»¥ä¼ å…¥ <code>std::adopt_lock</code> å®ä¾‹ï¼Œå€Ÿæ­¤æŒ‡æ˜ <code>std::unique_lock</code> å¯¹è±¡ç®¡ç†äº’æ–¥ä¸Šçš„é”</li><li>ä¹Ÿå¯ä»¥ä¼ å…¥ <code>std::defer_lock</code> å®ä¾‹ï¼Œä»è€Œä½¿äº’æ–¥åœ¨å®Œæˆæ„é€ æ—¶å¤„äºæ— é”çŠ¶æ€ï¼Œç­‰ä»¥åæœ‰éœ€è¦æ—¶æ‰åœ¨ <code>std::unique_lock</code> å¯¹è±¡ï¼ˆä¸æ˜¯äº’æ–¥å¯¹è±¡ï¼‰ä¸Šè°ƒç”¨ <code>lock()</code> è€Œè·å–é”ï¼Œæˆ–æŠŠ <code>std::unique_lock</code> å¯¹è±¡äº¤ç»™ <code>std::lock()</code> å‡½æ•°åŠ é”ã€‚</li></ul><p><code>std::unique_lock</code> å ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œä¹Ÿæ¯” <code>std::lock_guard</code> ç•¥æ…¢ã€‚</p><h3 id="3-2-7-åœ¨ä¸åŒä½œç”¨åŸŸä¹‹é—´è½¬ç§»äº’æ–¥å½’å±æƒ"><a href="#3-2-7-åœ¨ä¸åŒä½œç”¨åŸŸä¹‹é—´è½¬ç§»äº’æ–¥å½’å±æƒ" class="headerlink" title="3.2.7 åœ¨ä¸åŒä½œç”¨åŸŸä¹‹é—´è½¬ç§»äº’æ–¥å½’å±æƒ"></a>3.2.7 åœ¨ä¸åŒä½œç”¨åŸŸä¹‹é—´è½¬ç§»äº’æ–¥å½’å±æƒ</h3><p><code>std::unique_lock</code> å®ä¾‹ä¸å æœ‰ä¸ä¹‹å…³è”çš„äº’æ–¥ï¼Œæ‰€ä»¥éšç€å…¶å®ä¾‹çš„è½¬ç§»ï¼Œäº’æ–¥çš„å½’å±æƒå¯ä»¥åœ¨å¤šä¸ª <code>std::unique_lock</code> å®ä¾‹ä¹‹é—´è½¬ç§»ã€‚</p><p><code>std::unique_lock</code> å±äºå¯ç§»åŠ¨å´ä¸å¯å¤åˆ¶çš„å‹åˆ«ã€‚</p><p>è½¬ç§»æœ‰ä¸€ç§ç”¨é€”ï¼šå‡†è®¸å‡½æ•°é”å®šäº’æ–¥ï¼Œç„¶åæŠŠäº’æ–¥çš„å½’å±æƒè½¬ç§»ç»™å‡½æ•°è°ƒç”¨è€…ï¼Œå¥½è®©ä»–åœ¨åŒä¸€ä¸ªé”çš„ä¿æŠ¤ä¸‹æ‰§è¡Œå…¶ä»–æ“ä½œã€‚</p><p><code>std::unique_lock</code> ç±»ååˆ†çµæ´»ï¼Œå…è®¸å®ƒçš„å®ä¾‹åœ¨è¢«é”€æ¯å‰è§£é”ã€‚å…¶æˆå‘˜å‡½æ•°<code>unlock()</code> è´Ÿè´£è§£é”æ“ä½œï¼Œè¿™ä¸äº’æ–¥ä¸€è‡´ã€‚</p><h3 id="3-2-8-æŒ‰é€‚åˆçš„ç²’åº¦åŠ é”"><a href="#3-2-8-æŒ‰é€‚åˆçš„ç²’åº¦åŠ é”" class="headerlink" title="3.2.8 æŒ‰é€‚åˆçš„ç²’åº¦åŠ é”"></a>3.2.8 æŒ‰é€‚åˆçš„ç²’åº¦åŠ é”</h3><h2 id="3-3-ä¿æŠ¤å…±äº«æ•°æ®çš„å…¶ä»–å·¥å…·"><a href="#3-3-ä¿æŠ¤å…±äº«æ•°æ®çš„å…¶ä»–å·¥å…·" class="headerlink" title="3.3 ä¿æŠ¤å…±äº«æ•°æ®çš„å…¶ä»–å·¥å…·"></a>3.3 ä¿æŠ¤å…±äº«æ•°æ®çš„å…¶ä»–å·¥å…·</h2><h3 id="3-3-1-åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¿æŠ¤å…±äº«æ•°æ®"><a href="#3-3-1-åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¿æŠ¤å…±äº«æ•°æ®" class="headerlink" title="3.3.1 åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¿æŠ¤å…±äº«æ•°æ®"></a>3.3.1 åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¿æŠ¤å…±äº«æ•°æ®</h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦æŸä¸ªå…±äº«æ•°æ®ï¼Œè€Œå®ƒåˆ›å»ºèµ·æ¥å¼€é”€ä¸è²ã€‚å› ä¸ºåˆ›å»ºå®ƒå¯èƒ½éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æˆ–åˆ†é…å¤§é‡å†…å­˜ï¼Œæ‰€ä»¥ç­‰åˆ°å¿…è¦æ—¶æ‰çœŸæ­£ç€æ‰‹åˆ›å»ºã€‚è¿™ç§æ–¹å¼ç§°ä¸ºå»¶è¿Ÿåˆå§‹åŒ–ï¼ˆlazy initializationï¼‰ï¼Œå¸¸è§äºå•çº¿ç¨‹ä»£ç ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::shared_ptr&lt;some_resource&gt; resource_ptr;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(!resource_ptr)<br>    &#123;<br>        resource_ptr.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> some_resource);<br>    &#125;<br>    resource_ptr-&gt;<span class="hljs-built_in">do_something</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è‹¥å°†ä¸Šè¿°ä»£ç è½¬ä¸ºå¤šçº¿ç¨‹å½¢å¼ï¼Œå‡è®¾æ•°æ®æœ¬èº«çº¿ç¨‹å®‰å…¨ã€‚é‚£ä¹ˆä»…éœ€è¦å¯¹æŒ‡é’ˆè¿›è¡Œä¿æŠ¤ã€‚æœ€ç®€å•çš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::shared_ptr&lt;some_resource&gt; resource_ptr;<br>std::mutex resource_mutex;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(resource_mutex)</span></span>; <span class="hljs-comment">// æ­¤å¤„ï¼Œå…¨éƒ¨çº¿ç¨‹éƒ½è¢«è¿«å¾ªåºè¿è¡Œ</span><br>    <span class="hljs-keyword">if</span>(!resource_ptr)<br>    &#123;<br>        resource_ptr.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> some_resource);  <br>    &#125;<br>    lk.<span class="hljs-built_in">unlock</span>();<br>    resource_ptr-&gt;<span class="hljs-built_in">do_something</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„é—®é¢˜æ˜¯ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¿…é¡»ä¾æ¬¡è¿è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½è¦è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¢åŠ äº†ä¸å¿…è¦çš„å¼€é”€ã€‚</p><p>ä¸ºäº†æ”¹è¿›ä¸Šè¿°æ–¹æ³•ï¼Œæå‡ºäº†åŒé‡æ£€éªŒé”å®šæ¨¡å¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">undefined_behaviour_with_double_checked_locking</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(!resource_ptr)    â‡½---  â‘ <br>    &#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(resource_mutex)</span></span>;<br>        <span class="hljs-keyword">if</span>(!resource_ptr)    â‡½---  â‘¡<br>        &#123;<br>            resource_ptr.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> some_resource);    â‡½---  â‘¢<br>        &#125;<br>    &#125;<br>    resource_ptr-&gt;<span class="hljs-built_in">do_something</span>();    â‡½---  â‘£<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å¯èƒ½å¼•å‘æ¶æ€§æ¡ä»¶ç«äº‰ã€‚å½“å‰çº¿ç¨‹åœ¨é”ä¿æŠ¤èŒƒå›´å¤–è¯»å–æŒ‡é’ˆâ‘ ï¼Œè€Œå¯¹æ–¹çº¿ç¨‹å´å¯èƒ½å…ˆè·å–é”ï¼Œé¡ºåˆ©è¿›å…¥é”ä¿æŠ¤èŒƒå›´å†…æ‰§è¡Œå†™æ“ä½œâ‘¢ï¼Œå› æ­¤è¯»å†™æ“ä½œæ²¡æœ‰åŒæ­¥ï¼Œäº§ç”Ÿäº†æ¡ä»¶ç«äº‰ï¼Œæ—¢æ¶‰åŠæŒ‡é’ˆæœ¬èº«ï¼Œè¿˜æ¶‰åŠå…¶æŒ‡å‘çš„å¯¹è±¡ã€‚å°½ç®¡å½“å‰çº¿ç¨‹èƒ½å¤Ÿçœ‹è§å…¶ä»–çº¿ç¨‹å†™å…¥æŒ‡é’ˆï¼Œå´æœ‰å¯èƒ½æ— è§†æ–°å®ä¾‹some_resourceçš„åˆ›å»ºï¼Œç»“æœdo_something()çš„è°ƒç”¨å°±ä¼šå¯¹ä¸æ­£ç¡®çš„å€¼è¿›è¡Œæ“ä½œâ‘£ã€‚</p><p>C++æ ‡å‡†åº“ä¸­æä¾›äº†std::once_flagç±»å’Œstd:: call_once()å‡½æ•°ï¼Œä»¥ä¸“é—¨å¤„ç†è¯¥æƒ…å†µã€‚æ‰€æœ‰çº¿ç¨‹å…±åŒè°ƒç”¨std::call_once()å‡½æ•°ï¼Œä»è€Œç¡®ä¿åœ¨è¯¥è°ƒç”¨è¿”å›æ—¶ï¼Œ æŒ‡é’ˆåˆå§‹åŒ–ç”±å…¶ä¸­æŸçº¿ç¨‹å®‰å…¨ä¸”å”¯ä¸€åœ°å®Œæˆï¼ˆé€šè¿‡é€‚åˆçš„åŒæ­¥æœºåˆ¶ï¼‰ã€‚å¿…è¦çš„åŒæ­¥æ•°æ®åˆ™ç”±std::once_flagå®ä¾‹å­˜å‚¨ï¼Œæ¯ä¸ªstd::once_flagå®ä¾‹å¯¹åº”ä¸€æ¬¡ä¸åŒçš„åˆå§‹åŒ–ã€‚ç›¸æ¯”æ˜¾å¼ä½¿ç”¨äº’æ–¥ï¼Œstd::call_once()å‡½æ•°çš„é¢å¤–å¼€é”€å¾€å¾€æ›´ä½ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆå§‹åŒ–å·²ç»å®Œæˆçš„æƒ…å†µä¸‹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++">std::shared_ptr&lt;some_resource&gt; resource_ptr;<br>std::once_flag resource_flag;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">init_resource</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    resource_ptr.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> some_resource);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    std::<span class="hljs-built_in">call_once</span>(resource_flag,init_resource);<br>    resource_ptr-&gt;<span class="hljs-built_in">do_something</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ç±»ä¸­å»¶è¿Ÿåˆå§‹åŒ–æˆå‘˜</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">X</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    connection_info connection_details;<br>    connection_handle connection;<br>    std::once_flag connection_init_flag;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">open_connection</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        connection=connection_manager.<span class="hljs-built_in">open</span>(connection_details);<br>    &#125;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">X</span>(connection_info <span class="hljs-type">const</span>&amp; connection_details_):<br>       <span class="hljs-built_in">connection_details</span>(connection_details_)<br>    &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">send_data</span><span class="hljs-params">(data_packet <span class="hljs-type">const</span>&amp; data)</span>    â‡½---  â‘ </span><br><span class="hljs-function">    </span>&#123;<br>        std::<span class="hljs-built_in">call_once</span>(connection_init_flag,&amp;X::open_connection,<span class="hljs-keyword">this</span>);    â‡½---  â‘¡<br>        connection.<span class="hljs-built_in">send_data</span>(data);<br>    &#125;<br>    <span class="hljs-function">data_packet <span class="hljs-title">receive_data</span><span class="hljs-params">()</span>    â‡½---  â‘¢</span><br><span class="hljs-function">    </span>&#123;<br>        std::<span class="hljs-built_in">call_once</span>(connection_init_flag,&amp;X::open_connection,<span class="hljs-keyword">this</span>);    â‡½---  â‘¡<br>        <span class="hljs-keyword">return</span> connection.<span class="hljs-built_in">receive_data</span>();<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>std::once_flagçš„å®ä¾‹æ—¢ä¸å¯å¤åˆ¶ä¹Ÿä¸å¯ç§»åŠ¨ï¼Œè¿™ä¸std::mutexç±»ä¼¼ã€‚</p><p>C++11è§„å®šé™æ€å±€éƒ¨å˜é‡çš„åˆå§‹åŒ–åªä¼šåœ¨æŸä¸€çº¿ç¨‹ä¸Šå•ç‹¬å‘ç”Ÿï¼Œåœ¨åˆå§‹åŒ–å®Œæˆä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹ä¸ä¼šè¶Šè¿‡é™æ€æ•°æ®çš„å£°æ˜è€Œç»§ç»­è¿è¡Œã€‚æŸäº›ç±»çš„ä»£ç åªéœ€ç”¨åˆ°å”¯ä¸€ä¸€ä¸ªå…¨å±€å®ä¾‹ï¼Œè¿™ç§æƒ…å½¢å¯ç”¨ä»¥ä¸‹æ–¹æ³•ä»£æ›¿std::call_once()ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">my_class</span>;<br><span class="hljs-function">my_class&amp; <span class="hljs-title">get_my_class_instance</span><span class="hljs-params">()</span>  </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">static</span> my_class instance;  <br>    <span class="hljs-keyword">return</span> instance;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-3-2-ä¿æŠ¤ç”šå°‘æ›´æ–°çš„æ•°æ®ç»“æ„"><a href="#3-3-2-ä¿æŠ¤ç”šå°‘æ›´æ–°çš„æ•°æ®ç»“æ„" class="headerlink" title="3.3.2 ä¿æŠ¤ç”šå°‘æ›´æ–°çš„æ•°æ®ç»“æ„"></a>3.3.2 ä¿æŠ¤ç”šå°‘æ›´æ–°çš„æ•°æ®ç»“æ„</h3><p>è€ƒè™‘ä¸€ä¸ªå­˜å‚¨ç€DNSæ¡ç›®çš„ç¼“å­˜è¡¨ï¼Œå®ƒå°†åŸŸåè§£é‡Šæˆå¯¹åº”çš„IPåœ°å€ã€‚ç»™å®šçš„DNSæ¡ç›®é€šå¸¸åœ¨å¾ˆé•¿æ—¶é—´å†…éƒ½ä¸ä¼šå˜åŒ–â€”â€”åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒDNSæ¡ç›®ä¿æŒå¤šå¹´ä¸å˜ã€‚å°½ç®¡ï¼Œéšç€ç”¨æˆ·è®¿é—®ä¸åŒç½‘ç«™ï¼Œç¼“å­˜è¡¨ä¼šä¸æ—¶åŠ å…¥æ–°æ¡ç›®ï¼Œä½†åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œæ•°æ®åœ¨æ•´ä¸ªç”Ÿå‘½æœŸå†…å°†ä¿æŒä¸å˜ã€‚ä¸ºäº†åˆ¤æ–­æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼Œå¿…é¡»å®šæœŸæŸ¥éªŒç¼“å­˜è¡¨ï¼›åªè¦ç»†èŠ‚æœ‰æ‰€æ”¹åŠ¨ï¼Œå°±éœ€è¦è¿›è¡Œæ›´æ–°ã€‚</p><p>è‹¥é‡‡ç”¨std::mutexä¿æŠ¤æ•°æ®ç»“æ„ï¼Œåˆ™è¿‡äºä¸¥è‹›ï¼ŒåŸå› æ˜¯å³ä¾¿æ²¡å‘ç”Ÿæ”¹åŠ¨ï¼Œå®ƒç…§æ ·ä¼šç¦æ­¢å¹¶å‘è®¿é—®ã€‚æˆ‘ä»¬éœ€åœ¨è¿™é‡Œé‡‡ç”¨æ–°ç±»å‹çš„äº’æ–¥ã€‚ç”±äºæ–°çš„äº’æ–¥å…·æœ‰ä¸¤ç§ä¸åŒçš„ä½¿ç”¨æ–¹å¼ï¼Œå› æ­¤é€šå¸¸è¢«ç§°ä¸ºè¯»å†™äº’æ–¥ï¼šå…è®¸å•ç‹¬ä¸€ä¸ªâ€œå†™çº¿ç¨‹â€è¿›è¡Œå®Œå…¨æ’ä»–çš„è®¿é—®ï¼Œä¹Ÿå…è®¸å¤šä¸ªâ€œè¯»çº¿ç¨‹â€å…±äº«æ•°æ®æˆ–å¹¶å‘è®¿é—®ã€‚</p><ul><li>C++17æ ‡å‡†åº“æä¾›äº†ä¸¤ç§æ–°çš„äº’æ–¥ï¼šstd::shared_mutexå’Œstd::shared_timed_mutexã€‚</li><li>C++14æ ‡å‡†åº“åªæœ‰std::shared_timed_mutex</li><li>C++11æ ‡å‡†åº“éƒ½æ²¡æœ‰ã€‚</li></ul><p>å¯ä»¥ç”¨ <code>std::shared_mutex</code> æ¥è¿›è¡Œè¿™ç§åŒæ­¥æ“ä½œã€‚</p><p>å¯¹äºå†™æ“ä½œï¼šç”¨ <code>std::lock_guard</code> æˆ–è€… <code>std::unique_lock</code> æ¥è¿›è¡Œé”å®šï¼Œä¿è¯è®¿é—®çš„æ’ä»–æ€§ã€‚</p><p>å¯¹äºè¯»æ“ä½œï¼šç”¨ <code>std::shared_lock</code> å®ç°å…±äº«è®¿é—®ã€‚</p><p>å…±äº«é”ä»…æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œå³å‡è®¾å®ƒå·²è¢«æŸäº›çº¿ç¨‹æ‰€æŒæœ‰ï¼Œè‹¥åˆ«çš„çº¿ç¨‹è¯•å›¾è·å–æ’ä»–é”ï¼Œå°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´åˆ°é‚£äº›çº¿ç¨‹å…¨éƒ½é‡Šæ”¾è¯¥å…±äº«é”ã€‚åä¹‹ï¼Œå¦‚æœä»»ä¸€çº¿ç¨‹æŒæœ‰æ’ä»–é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å…¨éƒ½æ— æ³•è·å–å…±äº«é”æˆ–æ’ä»–é”ï¼Œç›´åˆ°æŒé”çº¿ç¨‹å°†æ’ä»–é”é‡Šæ”¾ä¸ºæ­¢ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;map&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;shared_mutex&gt;</span></span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">dns_entry</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">dns_cache</span><br>&#123;<br>    std::map&lt;std::string,dns_entry&gt; entries;<br>    <span class="hljs-keyword">mutable</span> std::shared_mutex entry_mutex;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">dns_entry <span class="hljs-title">find_entry</span><span class="hljs-params">(std::string <span class="hljs-type">const</span>&amp; domain)</span> <span class="hljs-type">const</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">std::shared_lock&lt;std::shared_mutex&gt; <span class="hljs-title">lk</span><span class="hljs-params">(entry_mutex)</span></span>; <br>        std::map&lt;std::string,dns_entry&gt;::const_iterator <span class="hljs-type">const</span> it=<br>            entries.<span class="hljs-built_in">find</span>(domain);<br>        <span class="hljs-keyword">return</span> (it==entries.<span class="hljs-built_in">end</span>())?<span class="hljs-built_in">dns_entry</span>():it-&gt;second;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_or_add_entry</span><span class="hljs-params">(std::string <span class="hljs-type">const</span>&amp; domain,</span></span><br><span class="hljs-params"><span class="hljs-function">                             dns_entry <span class="hljs-type">const</span>&amp; dns_details)</span></span><br><span class="hljs-function">    </span>&#123;<br>        std::lock_guard&lt;std::shared_mutex&gt;<span class="hljs-built_in">lk</span>(entry_mutex);<br>        entries[domain]=dns_details;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="3-3-3-é€’å½’åŠ é”"><a href="#3-3-3-é€’å½’åŠ é”" class="headerlink" title="3.3.3 é€’å½’åŠ é”"></a>3.3.3 é€’å½’åŠ é”</h3><p>å‡å¦‚çº¿ç¨‹å·²ç»æŒæœ‰æŸä¸ªstd::mutexå®ä¾‹ï¼Œè¯•å›¾å†æ¬¡å¯¹å…¶é‡æ–°åŠ é”å°±ä¼šå‡ºé”™ï¼Œå°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p><p>ä½†åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œç¡®æœ‰éœ€è¦è®©çº¿ç¨‹åœ¨åŒä¸€äº’æ–¥ä¸Šå¤šæ¬¡é‡å¤åŠ é”ï¼Œè€Œæ— é¡»è§£é”ã€‚C++æ ‡å‡†åº“ä¸ºæ­¤æä¾›äº†std::recursive_mutexï¼Œå…¶å·¥ä½œæ–¹å¼ä¸std::mutexç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„æ˜¯ï¼Œå…¶å…è®¸åŒä¸€çº¿ç¨‹å¯¹æŸäº’æ–¥çš„åŒä¸€å®ä¾‹å¤šæ¬¡åŠ é”ã€‚æˆ‘ä»¬å¿…é¡»å…ˆé‡Šæ”¾å…¨éƒ¨çš„é”ï¼Œæ‰å¯ä»¥è®©å¦ä¸€ä¸ªçº¿ç¨‹é”ä½è¯¥äº’æ–¥ã€‚ä¾‹å¦‚ï¼Œè‹¥æˆ‘ä»¬å¯¹å®ƒè°ƒç”¨äº†3æ¬¡lock()ï¼Œå°±å¿…é¡»è°ƒç”¨3æ¬¡unlock()ã€‚</p><p>è‹¥è¦è®¾è®¡ä¸€ä¸ªç±»ä»¥æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œå®ƒå°±éœ€åŒ…å«äº’æ–¥æ¥ä¿æŠ¤æ•°æ®æˆå‘˜ï¼Œé€’å½’äº’æ–¥å¸¸å¸¸ç”¨äºè¿™ç§æƒ…å½¢ã€‚æ¯ä¸ªå…¬æœ‰å‡½æ•°éƒ½éœ€å…ˆé”ä½äº’æ–¥ï¼Œç„¶åæ‰è¿›è¡Œæ“ä½œï¼Œæœ€åè§£é”äº’æ–¥ã€‚ä½†æœ‰æ—¶åœ¨æŸäº›æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå…¬æœ‰å‡½æ•°éœ€è¦è°ƒç”¨å¦ä¸€å…¬æœ‰å‡½æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåè€…å°†åŒæ ·è¯•å›¾é”ä½äº’æ–¥ï¼Œå¦‚æœé‡‡ç”¨std::mutexä¾¿ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚æœ‰ä¸€ç§â€œå¿«åˆ€æ–©ä¹±éº»â€çš„è§£å†³æ–¹æ³•ï¼šç”¨é€’å½’äº’æ–¥ä»£æ›¿æ™®é€šäº’æ–¥ã€‚è¿™å®¹è®¸ç¬¬äºŒä¸ªå…¬æœ‰å‡½æ•°æˆåŠŸåœ°å¯¹é€’å½’äº’æ–¥åŠ é”ï¼Œå› æ­¤å‡½æ•°å¯ä»¥é¡ºåˆ©åœ°æ‰§è¡Œä¸‹å»ã€‚</p><p>ä¸Šè¿°æ–¹æ³•ä¸æ¨èã€‚å½“ä»¥ä¸Šç±»å‹æŒæœ‰é”çš„æ—¶å€™ï¼Œå…¶ä¸å˜é‡å¾€å¾€ä¼šè¢«ç ´åã€‚é€šå¸¸å¯ä»¥é‡‡å–æ›´å¥½çš„æ–¹æ³•ï¼šæ ¹æ®è¿™ä¸¤ä¸ªå…¬æœ‰å‡½æ•°çš„å…±åŒéƒ¨åˆ†ï¼Œæå–å‡ºä¸€ä¸ªæ–°çš„ç§æœ‰å‡½æ•°ï¼Œæ–°å‡½æ•°ç”±è¿™ä¸¤ä¸ªå…¬æœ‰å‡½æ•°è°ƒç”¨ï¼Œè€Œå®ƒå‡å®šäº’æ–¥å·²ç»è¢«é”ä½ï¼Œé‚æ— é¡»é‡å¤åŠ é”ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++å¹¶å‘ç¼–ç¨‹å®æˆ˜Chapter2</title>
    <link href="/2025/01/24/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter2/"/>
    <url>/2025/01/24/C-C-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98Chapter2/</url>
    
    <content type="html"><![CDATA[<h1 id="2-çº¿ç¨‹ç®¡æ§"><a href="#2-çº¿ç¨‹ç®¡æ§" class="headerlink" title="2 çº¿ç¨‹ç®¡æ§"></a>2 çº¿ç¨‹ç®¡æ§</h1><h2 id="2-1-çº¿ç¨‹çš„åŸºæœ¬ç®¡æ§"><a href="#2-1-çº¿ç¨‹çš„åŸºæœ¬ç®¡æ§" class="headerlink" title="2.1 çº¿ç¨‹çš„åŸºæœ¬ç®¡æ§"></a>2.1 çº¿ç¨‹çš„åŸºæœ¬ç®¡æ§</h2><p>æ¯ä¸ªC++ç¨‹åºéƒ½å«æœ‰è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ï¼Œå³è¿è¡Œmain()çš„çº¿ç¨‹ï¼Œå®ƒç”±C++è¿è¡Œæ—¶ï¼ˆC++ runtimeï¼‰ç³»ç»Ÿå¯åŠ¨ã€‚éšåï¼Œç¨‹åºå°±å¯ä»¥å‘èµ·æ›´å¤šçº¿ç¨‹ï¼Œå®ƒä»¬ä»¥åˆ«çš„å‡½æ•°ä½œä¸ºå…¥å£ï¼ˆentry pointï¼‰ã€‚è¿™äº›æ–°çº¿ç¨‹è¿åŒèµ·å§‹çº¿ç¨‹å¹¶å‘è¿è¡Œã€‚å½“main()è¿”å›æ—¶ï¼Œç¨‹åºå°±ä¼šé€€å‡ºï¼›åŒæ ·ï¼Œå½“å…¥å£å‡½æ•°è¿”å›æ—¶ï¼Œå¯¹åº”çš„çº¿ç¨‹éšä¹‹ç»ˆç»“ã€‚</p><h3 id="2-1-1-å‘èµ·çº¿ç¨‹"><a href="#2-1-1-å‘èµ·çº¿ç¨‹" class="headerlink" title="2.1.1 å‘èµ·çº¿ç¨‹"></a>2.1.1 å‘èµ·çº¿ç¨‹</h3><p>çº¿ç¨‹é€šè¿‡æ„å»º <code>std::thread</code> å¯¹è±¡å¯åŠ¨ï¼Œä»»ä½•å¯è°ƒç”¨ç±»å‹éƒ½å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚</p><p>å¦‚æœåœ¨ <code>std::thread</code> å¯¹è±¡é”€æ¯çš„æ—¶å€™è¿˜æ²¡æœ‰å†³å®šæ±‡åˆè¿˜æ˜¯åˆ†ç¦»çº¿ç¨‹ï¼Œé‚£ä¹ˆææ„å‡½æ•°ä¼šç»ˆæ­¢æ‰æ•´ä¸ªç¨‹åºï¼ˆéœ€è¦æ³¨æ„ï¼Œçº¿ç¨‹æ˜¯å¦ç»“æŸå’Œè¯¥çº¿ç¨‹å¯¹è±¡æ˜¯å¦é”€æ¯æ²¡æœ‰å…³ç³»ï¼Œçº¿ç¨‹å¯èƒ½åœ¨å†³å®šæ±‡åˆæˆ–è€…åˆ†ç¦»å¾ˆä¹…ä¹‹å‰å°±å·²ç»ç»“æŸè¿è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨åˆ†ç¦»ä¹‹åå¾ˆä¹…æ‰ç»“æŸè¿è¡Œï¼‰ã€‚</p><p><strong>ä¿è¯çº¿ç¨‹è®¿é—®çš„å¤–éƒ¨æ•°æ®æœ‰æ•ˆ</strong></p><p>å¦‚æœç¨‹åºé€‰æ‹©åˆ†ç¦»çº¿ç¨‹ï¼Œä¸”çº¿ç¨‹æŒæœ‰æŒ‡é’ˆæˆ–è€…å¼•ç”¨æŒ‡å‘ä¸»çº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œå¦‚æœæ­¤æ—¶ä¸»çº¿ç¨‹é€€å‡ºï¼Œå­çº¿ç¨‹è¿˜åœ¨ç»§ç»­è¿è¡Œï¼Œä¼šå¯¼è‡´æ‚¬ç©ºæŒ‡é’ˆoræ‚¬ç©ºå¼•ç”¨é—®é¢˜ã€‚</p><p>è§£å†³æ–¹å¼ï¼š</p><ul><li>ä»¤çº¿ç¨‹å‡½æ•°å®Œå…¨è‡ªå«ï¼ˆself-containedï¼‰ï¼Œå°†æ•°æ®å¤åˆ¶åˆ°æ–°çº¿ç¨‹å†…éƒ¨ï¼Œè€Œä¸æ˜¯å…±äº«æ•°æ®ã€‚</li><li>æ±‡åˆæ–°çº¿ç¨‹</li><li>ä¹Ÿå¯ä»¥ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆä¼ é€’å‚æ•°ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å±€éƒ¨å˜é‡åœ¨ä½¿ç”¨æœŸé—´ä¸ä¼šè¢«é”€æ¯æ‰ã€‚</li></ul><h3 id="2-1-2-ç­‰å¾…çº¿ç¨‹å®Œæˆ"><a href="#2-1-2-ç­‰å¾…çº¿ç¨‹å®Œæˆ" class="headerlink" title="2.1.2 ç­‰å¾…çº¿ç¨‹å®Œæˆ"></a>2.1.2 ç­‰å¾…çº¿ç¨‹å®Œæˆ</h3><p>è‹¥éœ€ç­‰å¾…çº¿ç¨‹å®Œæˆï¼Œå¯ä»¥åœ¨ä¸ä¹‹å…³è”çš„std::threadå®ä¾‹ä¸Šï¼Œé€šè¿‡è°ƒç”¨æˆå‘˜å‡½æ•°join()å®ç°ã€‚</p><p>åªè¦è°ƒç”¨äº†join()ï¼Œéš¶å±äºè¯¥çº¿ç¨‹çš„ä»»ä½•å­˜å‚¨ç©ºé—´å³ä¼šå› æ­¤æ¸…é™¤ï¼Œstd::threadå¯¹è±¡é‚ä¸å†å…³è”åˆ°å·²ç»“æŸçš„çº¿ç¨‹ã€‚äº‹å®ä¸Šï¼Œå®ƒä¸ä»»ä½•çº¿ç¨‹å‡æ— å…³è”ã€‚<strong>å¯¹äºæŸä¸ªç»™å®šçš„çº¿ç¨‹ï¼Œjoin()ä»…èƒ½è°ƒç”¨ä¸€æ¬¡ï¼›åªè¦std::threadå¯¹è±¡æ›¾ç»è°ƒç”¨è¿‡join()ï¼Œçº¿ç¨‹å°±ä¸å†å¯æ±‡åˆï¼ˆjoinableï¼‰ï¼Œæˆå‘˜å‡½æ•°joinable()å°†è¿”å›falseã€‚</strong></p><h3 id="2-1-3-åœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ç­‰å¾…"><a href="#2-1-3-åœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ç­‰å¾…" class="headerlink" title="2.1.3 åœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ç­‰å¾…"></a>2.1.3 åœ¨å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ç­‰å¾…</h3><p>è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨å…¶å®æ˜¯ï¼Œå¦‚æœè¦æ±‡åˆçº¿ç¨‹ï¼Œéœ€è¦ä¿è¯æ‰€æœ‰å¯èƒ½çš„é€€å‡ºè·¯å¾„éƒ½æ±‡åˆçº¿ç¨‹ã€‚æ¯”è¾ƒç†æƒ³çš„åšæ³•æ˜¯é‡‡ç”¨RAIIæ€æƒ³ï¼Œè®¾è®¡ä¸€ä¸ªthread_guardç±»ï¼Œåœ¨å…¶ææ„å‡½æ•°ä¸­è°ƒç”¨join.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">thread_guard</span><br>&#123;<br>    std::thread&amp; t;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">thread_guard</span><span class="hljs-params">(std::thread&amp; t_)</span>:</span><br><span class="hljs-function">        t(t_)</span><br><span class="hljs-function">    &#123;</span>&#125;<br>    ~<span class="hljs-built_in">thread_guard</span>()<br>    &#123;<br>        <span class="hljs-keyword">if</span>(t.<span class="hljs-built_in">joinable</span>())   <br>        &#123;<br>            t.<span class="hljs-built_in">join</span>(); <br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">thread_guard</span>(thread_guard <span class="hljs-type">const</span>&amp;)=<span class="hljs-keyword">delete</span>;  <br>    thread_guard&amp; <span class="hljs-keyword">operator</span>=(thread_guard <span class="hljs-type">const</span>&amp;)=<span class="hljs-keyword">delete</span>;<br>&#125;;   <br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">func</span>;    <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> some_local_state=<span class="hljs-number">0</span>;<br>    <span class="hljs-function">func <span class="hljs-title">my_func</span><span class="hljs-params">(some_local_state)</span></span>;<br>    <span class="hljs-function">std::thread <span class="hljs-title">t</span><span class="hljs-params">(my_func)</span></span>;<br>    <span class="hljs-function">thread_guard <span class="hljs-title">g</span><span class="hljs-params">(t)</span></span>;<br>    <span class="hljs-built_in">do_something_in_current_thread</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨ <code>f</code> é€€å‡ºä¹‹å‰ï¼Œä¼šæŒ‰ç…§æ„å»ºçš„é€†åºï¼Œé”€æ¯å±€éƒ¨å¯¹è±¡ï¼Œå› æ­¤ä¼šé¦–å…ˆé”€æ¯thread_guardå¯¹è±¡ã€‚</p><h3 id="2-1-4-åœ¨åå°è¿è¡Œçº¿ç¨‹"><a href="#2-1-4-åœ¨åå°è¿è¡Œçº¿ç¨‹" class="headerlink" title="2.1.4 åœ¨åå°è¿è¡Œçº¿ç¨‹"></a>2.1.4 åœ¨åå°è¿è¡Œçº¿ç¨‹</h3><p>è°ƒç”¨std::threadå¯¹è±¡çš„æˆå‘˜å‡½æ•°detach()ï¼Œä¼šä»¤çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œé‚æ— æ³•ä¸ä¹‹ç›´æ¥é€šä¿¡ã€‚å‡è‹¥çº¿ç¨‹è¢«åˆ†ç¦»ï¼Œå°±æ— æ³•ç­‰å¾…å®ƒå®Œç»“ï¼Œä¹Ÿä¸å¯èƒ½è·å¾—ä¸å®ƒå…³è”çš„std::threadå¯¹è±¡ï¼Œå› è€Œæ— æ³•æ±‡åˆè¯¥çº¿ç¨‹ã€‚</p><p>ç„¶è€Œåˆ†ç¦»çš„çº¿ç¨‹ç¡®å®ä»åœ¨åå°è¿è¡Œï¼Œå…¶å½’å±æƒå’Œæ§åˆ¶æƒéƒ½è½¬ç§»ç»™C++è¿è¡Œæ—¶åº“ï¼ˆruntime libraryï¼Œåˆåè¿è¡Œåº“ï¼‰ï¼Œç”±æ­¤ä¿è¯ï¼Œä¸€æ—¦çº¿ç¨‹é€€å‡ºï¼Œä¸ä¹‹å…³è”çš„èµ„æºéƒ½ä¼šè¢«æ­£ç¡®å›æ”¶ã€‚</p><p>UNIXæ“ä½œç³»ç»Ÿä¸­ï¼Œæœ‰äº›è¿›ç¨‹å«ä½œå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemon processï¼‰ï¼Œå®ƒä»¬åœ¨åå°è¿è¡Œä¸”æ²¡æœ‰å¯¹å¤–çš„ç”¨æˆ·ç•Œé¢ï¼›æ²¿è¢­è¿™ä¸€æ¦‚å¿µï¼Œåˆ†ç¦»å‡ºå»çš„çº¿ç¨‹å¸¸å¸¸è¢«ç§°ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼ˆdaemon threadï¼‰ã€‚è¿™ç§çº¿ç¨‹å¾€å¾€é•¿æ—¶é—´è¿è¡Œã€‚å‡ ä¹åœ¨åº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå­˜æœŸå†…ï¼Œå®ƒä»¬éƒ½ä¸€ç›´è¿è¡Œï¼Œä»¥æ‰§è¡Œåå°ä»»åŠ¡ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿç›‘æ§ã€ä»å¯¹è±¡ç¼“å­˜ä¸­æ¸…é™¤æ— ç”¨æ•°æ®é¡¹ã€ä¼˜åŒ–æ•°æ®ç»“æ„ç­‰ã€‚</p><p>ä¸èƒ½å‡­ç©ºè°ƒç”¨detachæ–¹æ³•ï¼Œå¿…é¡»ç¡®ä¿è¯¥å¯¹è±¡å­˜åœ¨ä¸å…¶å…³è”çš„çº¿ç¨‹ã€‚<strong>åªæœ‰å½“t.joinable()è¿”å›trueæ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½è°ƒç”¨t.detach()ã€‚</strong></p><h2 id="2-2-å‘çº¿ç¨‹å‡½æ•°ä¼ é€’å‚æ•°"><a href="#2-2-å‘çº¿ç¨‹å‡½æ•°ä¼ é€’å‚æ•°" class="headerlink" title="2.2 å‘çº¿ç¨‹å‡½æ•°ä¼ é€’å‚æ•°"></a>2.2 å‘çº¿ç¨‹å‡½æ•°ä¼ é€’å‚æ•°</h2><p>è‹¥éœ€å‘æ–°çº¿ç¨‹ä¸Šçš„å‡½æ•°æˆ–å¯è°ƒç”¨å¯¹è±¡ä¼ é€’å‚æ•°ï¼Œæ–¹æ³•ç›¸å½“ç®€å•ï¼Œç›´æ¥å‘std::threadçš„æ„é€ å‡½æ•°å¢æ·»æ›´å¤šå‚æ•°å³å¯ã€‚</p><p>çº¿ç¨‹å…·æœ‰å†…éƒ¨å­˜å‚¨ç©ºé—´ï¼Œå‚æ•°ä¼šæŒ‰ç…§é»˜è®¤æ–¹å¼å…ˆå¤åˆ¶åˆ°è¯¥å¤„ï¼Œæ–°åˆ›å»ºçš„æ‰§è¡Œçº¿ç¨‹æ‰èƒ½ç›´æ¥è®¿é—®å®ƒä»¬ã€‚ç„¶åï¼Œè¿™äº›å‰¯æœ¬è¢«å½“æˆä¸´æ—¶å˜é‡ï¼Œä»¥å³å€¼å½¢å¼ä¼ ç»™æ–°çº¿ç¨‹ä¸Šçš„å‡½æ•°æˆ–å¯è°ƒç”¨å¯¹è±¡ã€‚å³ä¾¿å‡½æ•°çš„ç›¸å…³å‚æ•°æŒ‰è®¾æƒ³åº”è¯¥æ˜¯å¼•ç”¨ï¼Œä¸Šè¿°è¿‡ç¨‹ä¾ç„¶ä¼šå‘ç”Ÿã€‚</p><p>å¦‚æœçº¿ç¨‹å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªéå¸¸é‡å¼•ç”¨ï¼Œä»£ç ä¼šæ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œè§£å†³åŠæ³•æ˜¯ç”¨ <code>std::ref</code>.</p><p>å¯¹äºç§»åŠ¨æ“ä½œæ¥è¯´ï¼Œèµ„æºæ‰€æœ‰æƒä¼šå…ˆè½¬ç§»åˆ°çº¿ç¨‹çš„å†…éƒ¨å­˜å‚¨ç©ºé—´ï¼Œç„¶åå†è½¬ç§»ç»™çº¿ç¨‹å‡½æ•°ã€‚</p><h2 id="2-3-ç§»äº¤çº¿ç¨‹å½’å±æƒ"><a href="#2-3-ç§»äº¤çº¿ç¨‹å½’å±æƒ" class="headerlink" title="2.3 ç§»äº¤çº¿ç¨‹å½’å±æƒ"></a>2.3 ç§»äº¤çº¿ç¨‹å½’å±æƒ</h2><p><code>std::thread</code> æ‹¥æœ‰å…¶æ‰€å…³è”çš„çº¿ç¨‹ï¼Œæ”¯æŒç§»åŠ¨è¯­ä¹‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸Šé¢ <code>thread_guard</code> ç±»çš„ä»£ç å¾—åˆ° <code>scoped_thread</code> ç±»ï¼Œè¯¥ç±»æŒç®¡çº¿ç¨‹ï¼Œé˜²æ­¢å‡ºç° <code>thread_guard</code> å¯¹è±¡çš„ç”Ÿå‘½æœŸè¶…å‡ºå…¶ç®¡æ§çš„çº¿ç¨‹ï¼Œå¯¼è‡´ä¸è‰¯åæœã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">scoped_thread</span><br>&#123;<br>    std::thread t;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">scoped_thread</span><span class="hljs-params">(std::thread t_)</span>: </span><br><span class="hljs-function">        t(std::move(t_))</span><br><span class="hljs-function">    &#123;</span><br>        <span class="hljs-keyword">if</span>(!t.<span class="hljs-built_in">joinable</span>())  <br>            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">logic_error</span>(<span class="hljs-string">&quot;No thread&quot;</span>);<br>    &#125;<br>    ~<span class="hljs-built_in">scoped_thread</span>()<br>    &#123;<br>        t.<span class="hljs-built_in">join</span>();   <br>    &#125;<br>    <span class="hljs-built_in">scoped_thread</span>(scoped_thread <span class="hljs-type">const</span>&amp;)=<span class="hljs-keyword">delete</span>;<br>    scoped_thread&amp; <span class="hljs-keyword">operator</span>=(scoped_thread <span class="hljs-type">const</span>&amp;)=<span class="hljs-keyword">delete</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="2-4-åœ¨è¿è¡Œæ—¶é€‰æ‹©çº¿ç¨‹æ•°é‡"><a href="#2-4-åœ¨è¿è¡Œæ—¶é€‰æ‹©çº¿ç¨‹æ•°é‡" class="headerlink" title="2.4 åœ¨è¿è¡Œæ—¶é€‰æ‹©çº¿ç¨‹æ•°é‡"></a>2.4 åœ¨è¿è¡Œæ—¶é€‰æ‹©çº¿ç¨‹æ•°é‡</h2><p>C++æ ‡å‡†åº“çš„std::thread::hardware_concurrency()å‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡æ ‡ï¼Œè¡¨ç¤ºç¨‹åºåœ¨å„æ¬¡è¿è¡Œä¸­å¯çœŸæ­£å¹¶å‘çš„çº¿ç¨‹æ•°é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    cout &lt;&lt; thread::<span class="hljs-built_in">hardware_concurrency</span>() &lt;&lt; endl; <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">// åœ¨æˆ‘çš„ç”µè„‘ä¸Š è¿”å›å€¼æ˜¯16</span><br></code></pre></td></tr></table></figure><h2 id="2-5-è¯†åˆ«çº¿ç¨‹"><a href="#2-5-è¯†åˆ«çº¿ç¨‹" class="headerlink" title="2.5 è¯†åˆ«çº¿ç¨‹"></a>2.5 è¯†åˆ«çº¿ç¨‹</h2><p>çº¿ç¨‹IDæ‰€å±å‹åˆ«æ˜¯std::thread::idï¼Œå®ƒæœ‰ä¸¤ç§è·å–æ–¹æ³•ï¼š</p><ul><li>åœ¨ä¸çº¿ç¨‹å…³è”çš„std::threadå¯¹è±¡ä¸Šè°ƒç”¨æˆå‘˜å‡½æ•°get_id()ï¼Œå³å¯å¾—åˆ°è¯¥çº¿ç¨‹çš„IDã€‚å¦‚æœstd::threadå¯¹è±¡æ²¡æœ‰å…³è”ä»»ä½•æ‰§è¡Œçº¿ç¨‹ï¼Œè°ƒç”¨get_id()åˆ™ä¼šè¿”å›ä¸€ä¸ªstd::thread::idå¯¹è±¡ï¼Œå®ƒæŒ‰é»˜è®¤æ„é€ æ–¹å¼ç”Ÿæˆï¼Œè¡¨ç¤ºâ€œçº¿ç¨‹ä¸å­˜åœ¨â€ã€‚</li><li>å½“å‰çº¿ç¨‹çš„IDå¯ä»¥é€šè¿‡è°ƒç”¨std::this_thread::get_id()è·å¾—ï¼Œå‡½æ•°å®šä¹‰ä½äºå¤´æ–‡ä»¶ <code>&lt;thread</code> å†…ã€‚</li></ul><p>C++æ ‡å‡†åº“å®¹è®¸æˆ‘ä»¬éšæ„åˆ¤æ–­ä¸¤ä¸ªçº¿ç¨‹IDæ˜¯å¦ç›¸åŒï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼›std::thread::idå‹åˆ«å…·å¤‡å…¨å¥—å®Œæ•´çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œæ¯”è¾ƒè¿ç®—ç¬¦å°±æ‰€æœ‰ä¸ç›¸ç­‰çš„å€¼ç¡®ç«‹äº†å…¨åºï¼ˆtotal orderï¼‰å…³ç³»ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>C++</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 21</title>
    <link href="/2024/11/22/OS-Three-Easy-Pieces-Chapter-21/"/>
    <url>/2024/11/22/OS-Three-Easy-Pieces-Chapter-21/</url>
    
    <content type="html"><![CDATA[<h1 id="Beyond-Physical-Memory-Mechanisms"><a href="#Beyond-Physical-Memory-Mechanisms" class="headerlink" title="Beyond Physical Memory: Mechanisms"></a>Beyond Physical Memory: Mechanisms</h1><p>å¦‚æœæŸä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´å¤ªå¤§ï¼Œæˆ–è€…æ•´ä¸ªç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹çš„æ‰€æœ‰è™šæ‹Ÿåœ°å€ç©ºé—´ä¹‹å’Œæ— æ³•ä¸€æ¬¡æ€§æ”¾åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸éœ€è¦å°†ä¸€äº›å½“å‰ä¸å¸¸ç”¨çš„åœ°å€ç©ºé—´æ¢å‡ºåˆ°ç¡¬ç›˜ä¸­ã€‚</p><h2 id="1-Swap-Space"><a href="#1-Swap-Space" class="headerlink" title="1 Swap Space"></a>1 Swap Space</h2><p>ç£ç›˜ä¸­éœ€è¦æœ‰ä¸€ä¸ªäº¤æ¢åŒºï¼Œç”¨äºå’Œå†…å­˜äº¤æ¢å†…å­˜é¡µã€‚OSéœ€è¦è®°å½•æ¯ä¸ªæ¢å‡ºé¡µçš„ç£ç›˜åœ°å€ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-21/image-20241122152725104.png"></p><h2 id="2-The-Present-Bit"><a href="#2-The-Present-Bit" class="headerlink" title="2 The Present Bit"></a>2 The Present Bit</h2><p>å¸¸è§„çš„åœ°å€è½¬æ¢è¿‡ç¨‹ï¼š</p><p>è¿›ç¨‹æä¾›è™šæ‹Ÿå†…å­˜åœ°å€</p><ul><li>TLB hitï¼šå–å¾—ç‰©ç†é¡µå·</li><li>TLB miss<ul><li>æŸ¥æ‰¾é¡µè¡¨ï¼Œå–å¾—ç‰©ç†é¡µå·</li><li>æ›´æ–°TLB</li><li>é‡æ–°æ‰§è¡ŒæŒ‡ä»¤</li></ul></li></ul><p>ä¸ºäº†æ”¯æŒswapï¼Œé¡µè¡¨é¡¹ä¸­éœ€è¦å¢åŠ ä¸€ä¸ª<strong>present bit</strong>ï¼Œç”¨æ¥æŒ‡å‡ºå½“å‰é¡µæ˜¯å¦åœ¨å†…å­˜ä¸­ã€‚</p><p>å¦‚æœå°è¯•è®¿é—®æŸä¸ªå½“å‰ä¸åœ¨å†…å­˜ä¸­çš„å†…å­˜é¡µï¼Œä¼šè§¦å‘<strong>page fault</strong>å¼‚å¸¸ï¼Œä¹‹åæ“ä½œç³»ç»Ÿæ‰§è¡Œpage-fault handleræ¥å¤„ç†ã€‚</p><h2 id="3-The-Page-Fault"><a href="#3-The-Page-Fault" class="headerlink" title="3 The Page Fault"></a>3 The Page Fault</h2>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 20</title>
    <link href="/2024/11/22/OS-Three-Easy-Pieces-Chapter-20/"/>
    <url>/2024/11/22/OS-Three-Easy-Pieces-Chapter-20/</url>
    
    <content type="html"><![CDATA[<h1 id="Paging-Smaller-Tables"><a href="#Paging-Smaller-Tables" class="headerlink" title="Paging: Smaller Tables"></a>Paging: Smaller Tables</h1><p>åŸºæœ¬çš„é¡µå¼å†…å­˜å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯é¡µè¡¨å æ®çš„ç©ºé—´å¤ªå¤§äº†ã€‚</p><h2 id="1-Simple-Solution-Bigger-Pages"><a href="#1-Simple-Solution-Bigger-Pages" class="headerlink" title="1 Simple Solution: Bigger Pages"></a>1 Simple Solution: Bigger Pages</h2><p>æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ›´å¤§çš„é¡µï¼Œè¿™æ ·å¯ä»¥å‡å°‘é¡µè¡¨é¡¹çš„ä¸ªæ•°ï¼Œä»è€Œå‡å°‘é¡µè¡¨çš„å¤§å°ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´å†…éƒ¨å†…å­˜ç¢ç‰‡ã€‚</p><h2 id="2-Hybrid-Approach-Paging-and-Segments"><a href="#2-Hybrid-Approach-Paging-and-Segments" class="headerlink" title="2 Hybrid Approach: Paging and Segments"></a>2 Hybrid Approach: Paging and Segments</h2><p>æ®µé¡µå¼å†…å­˜ï¼Œç»“åˆæ®µå¼å†…å­˜å’Œé¡µå¼å†…å­˜ã€‚æ¯ä¸ªæ®µç”±ä¸€å¯¹base&#x2F;boundå¯„å­˜å™¨ç®¡ç†ã€‚baseå¯„å­˜å™¨æŒ‡å‡ºè¯¥æ®µé¡µè¡¨çš„ç‰©ç†åœ°å€ï¼Œboundå¯„å­˜å™¨æŒ‡å‡ºè¯¥é¡µè¡¨çš„ç»“æŸåœ°å€ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªæ®µåªæœ‰å¾ˆå°‘çš„é¡µçš„æ—¶å€™ï¼Œé¡µè¡¨åªæœ‰å‡ ä¸ªé¡µè¡¨é¡¹ï¼ŒèŠ‚çœäº†ç©ºé—´ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæ¯ä¸ªæ®µçš„é¡µè¡¨è¿˜æ˜¯çº¿æ€§çš„ï¼Œå¦‚æœæŸä¸ªæ®µçš„å†…å­˜å¾ˆç¨€ç–ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸ºæ‰€æœ‰ä¸­é—´çš„æ²¡æœ‰ä½¿ç”¨çš„é¡µåˆ†é…é¡µè¡¨é¡¹ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-20/image-20241122143620252-1732257380904-1.png"></p><h2 id="3-Multi-level-Page-Tables"><a href="#3-Multi-level-Page-Tables" class="headerlink" title="3 Multi-level Page Tables"></a>3 Multi-level Page Tables</h2><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-20/image-20241122144339431.png"></p><p>ä¼ ç»Ÿé¡µè¡¨æœ€æœ¬è´¨çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬å¾ˆéš¾åœ¨å†…å­˜ä¸­æ‰¾å‡ºä¸€å¤§å—è¿ç»­çš„å†…å­˜ç”¨æ¥å­˜æ”¾é¡µè¡¨é¡¹ï¼Œå¹¶ä¸”è¿™äº›é¡µè¡¨é¡¹ä¸­æœ‰å¾ˆå¤šæ˜¯æ— æ•ˆçš„ã€‚å¤šçº§é¡µè¡¨æœ€æœ¬è´¨çš„æ€æƒ³å°±æ˜¯é¡µè¡¨æŒ‰é¡µæ¥ç®¡ç†ï¼Œå¦‚æœé¡µè¡¨ä¸­æŸé¡µçš„æ‰€æœ‰é¡µè¡¨é¡¹éƒ½æ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆå¯ä»¥ä¸åˆ†é…é¡µè¡¨çš„è¯¥é¡µã€‚è¿™æ ·å°±å¯ä»¥èŠ‚çœå¾ˆå¤šç©ºé—´ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><p>å¤šçº§é¡µè¡¨ä»¥æ—¶é—´æ¢å–ç©ºé—´ã€‚æ¯æ¬¡TLB missçš„æ—¶å€™ï¼Œä¸ºäº†å®Œæˆåœ°å€è½¬æ¢ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–çš„å†…å­˜è®¿é—®å»è·å–ç›¸åº”çš„é¡µè¡¨é¡¹ã€‚è€Œä¸”ï¼Œå¤šçº§é¡µè¡¨å¢åŠ äº†å¤æ‚æ€§ã€‚</p><h2 id="4-Inverted-Page-Tables"><a href="#4-Inverted-Page-Tables" class="headerlink" title="4 Inverted Page Tables"></a>4 Inverted Page Tables</h2><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åè½¬é¡µè¡¨ï¼Œå³é€šè¿‡ç‰©ç†é¡µå·å»æ‰¾å¯¹åº”çš„è¿›ç¨‹çš„è™šæ‹Ÿé¡µå·ã€‚è¿™æ ·ï¼Œæ•´ä¸ªç³»ç»Ÿåªéœ€è¦ä¸€ä¸ªé¡µè¡¨å³å¯ã€‚ä¸ºäº†å®Œæˆåœ°å€è½¬æ¢ï¼Œå¦‚æœéœ€è¦çº¿æ€§æ‰«ææ•´ä¸ªé¡µè¡¨ï¼Œæ—¶é—´å¼€é”€å¤ªå¤§äº†ï¼Œå¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨æ¥ç®¡ç†ã€‚</p><h2 id="5-Swapping-the-Page-Tables-to-Disk"><a href="#5-Swapping-the-Page-Tables-to-Disk" class="headerlink" title="5 Swapping the Page Tables to Disk"></a>5 Swapping the Page Tables to Disk</h2><p>é¡µè¡¨ä»ç„¶æœ‰å¯èƒ½å¤ªå¤§å¯¼è‡´æ— æ³•ä¸€æ¬¡æ€§æ”¾å…¥å†…å­˜ä¸­ï¼Œæœ‰äº›ç³»ç»Ÿå°†é¡µè¡¨æ”¾åœ¨å†…æ ¸è™šæ‹Ÿå†…å­˜ä¸­ï¼Œå…è®¸æ“ä½œç³»ç»Ÿå°†é¡µè¡¨æ¢å‡ºåˆ°ç£ç›˜ä¸­ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 19</title>
    <link href="/2024/11/15/OS-Three-Easy-Pieces-Chapter-19/"/>
    <url>/2024/11/15/OS-Three-Easy-Pieces-Chapter-19/</url>
    
    <content type="html"><![CDATA[<h1 id="Paging-Faster-Translations-TLBs"><a href="#Paging-Faster-Translations-TLBs" class="headerlink" title="Paging: Faster Translations (TLBs)"></a>Paging: Faster Translations (TLBs)</h1><p>ä¸ºäº†åŠ é€Ÿå†…å­˜è®¿é—®ï¼ŒOSéœ€è¦ç¡¬ä»¶çš„å¸®åŠ©ï¼š<strong>translation-lookaside bufferï¼ˆTLBï¼‰</strong>ã€‚TLBå…¶å®å°±æ˜¯ç»å¸¸è®¿é—®çš„PTEçš„ç¡¬ä»¶ç¼“å­˜ã€‚åœ¨æ¯æ¬¡è®¿å­˜ä¹‹å‰ï¼Œç¡¬ä»¶é¦–å…ˆå»TLBä¸­æŸ¥çœ‹æŒ‡å®šçš„PTEæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±ä¸éœ€è¦å»å†…å­˜ä¸­æŸ¥æ‰¾å¯¹åº”çš„PTEäº†ã€‚</p><h2 id="1-TLB-Basic-Algorithm"><a href="#1-TLB-Basic-Algorithm" class="headerlink" title="1 TLB Basic Algorithm"></a>1 TLB Basic Algorithm</h2><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-19/image-20241115164628041.png"></p><h2 id="2-Who-Handles-The-TLB-Miss"><a href="#2-Who-Handles-The-TLB-Miss" class="headerlink" title="2 Who Handles The TLB Miss"></a>2 Who Handles The TLB Miss</h2><p><strong>ç¡¬ä»¶å¤„ç†</strong></p><p>ç”±ç¡¬ä»¶è´Ÿè´£æ›´æ–°TLBã€‚</p><p><strong>è½¯ä»¶å¤„ç†ï¼ˆOSï¼‰</strong></p><p>ç”±OSè´Ÿè´£æ›´æ–°TLBã€‚å½“é‡åˆ°TLB missçš„æ—¶å€™ï¼Œç¡¬ä»¶åªéœ€è¦å‘å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç„¶åè·³è½¬åˆ°å¯¹åº”çš„å¼‚å¸¸å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†å³å¯ã€‚</p><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>è¿™ç§å¼‚å¸¸å’Œç³»ç»Ÿè°ƒç”¨ä¸ä¸€æ ·ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ç»§ç»­æ‰§è¡Œï¼›è€Œè¿™ç§å¼‚å¸¸éœ€è¦è¿”å›å½“å‰æŒ‡ä»¤çš„åœ°å€é‡æ–°æ‰§è¡Œå½“å‰æŒ‡ä»¤ã€‚</li><li>OSéœ€è¦ç¡®ä¿TLB misså¤„ç†ä»£ç ä¸ä¼šè§¦å‘TLB missã€‚å¯ä»¥ç›´æ¥å°†å¤„ç†ä»£ç æ”¾åœ¨ç‰©ç†åœ°å€ä¸­ï¼ˆæœªæ˜ å°„ï¼Œæ— éœ€åœ°å€ç¿»è¯‘ï¼‰æˆ–è€…åœ¨TLBä¸­é¢„ç•™ä¸€äº›entriesç”¨æ¥å­˜æ”¾å¤„ç†ä»£ç çš„PTEã€‚</li></ul><h2 id="3-TLB-Contents-Whatâ€™s-In-There"><a href="#3-TLB-Contents-Whatâ€™s-In-There" class="headerlink" title="3 TLB Contents: Whatâ€™s In There"></a>3 TLB Contents: Whatâ€™s In There</h2><p>TLBé€šå¸¸æœ‰32ï¼Œ64ï¼Œ128ä¸ªentriesï¼Œå¹¶ä¸”æ˜¯å…¨ç›¸è¿çš„ï¼ˆæ„å‘³ç€ä»»ä½•ä¸€ä¸ªentryéƒ½å¯èƒ½é˜²æ­¢åœ¨ä»»ä½•ä½ç½®ï¼Œç”±ç¡¬ä»¶è´Ÿè´£å¹¶è¡Œçš„æŸ¥æ‰¾å¯¹åº”çš„entryï¼‰ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-19/image-20241115170540216.png" alt="A TLB entry"></p><p>éœ€è¦æ³¨æ„ï¼ŒTLB entryéœ€è¦åŒ…å«VPNï¼Œå› ä¸ºTLBæ˜¯å…¨ç›¸è¿çš„ã€‚</p><p>other bitsé€šå¸¸åŒ…å«valid bitï¼Œprotection bitsï¼Œaddress-space identifierï¼Œdirty bitç­‰ã€‚</p><h2 id="4-TLB-Issue-Context-Switches"><a href="#4-TLB-Issue-Context-Switches" class="headerlink" title="4 TLB Issue: Context Switches"></a>4 TLB Issue: Context Switches</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTLBä¸­çš„å†…å®¹éƒ½æ˜¯é’ˆå¯¹æŸä¸ªè¿›ç¨‹è€Œè¨€çš„ã€‚å½“å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼ŒTLBä¸­çš„å†…å®¹å°±ä¸åœ¨æœ‰æ•ˆäº†ã€‚</p><p><strong>TLB flush</strong></p><p>ç®€å•çš„åšæ³•æ˜¯æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼Œéƒ½å°†TLBä¸­çš„å†…å®¹flushæ‰ï¼ˆå°†valid bitç½®0ï¼‰ã€‚ä½†æ˜¯å¯¹äºé¢‘ç¹åˆ‡æ¢çš„ç³»ç»Ÿï¼Œå¯èƒ½ä¼šå¸¦æ¥è¾ƒå¤§çš„å¼€é”€ã€‚</p><p><strong>ASID</strong></p><p>å¦ä¸€ç§åšæ³•æ˜¯åœ¨TLB entryä¸­å¢åŠ ä¸€ä¸ª<strong>address space identifierï¼ˆASIDï¼‰</strong>æ¥æŒ‡ç¤ºè¯¥entryå¯¹åº”çš„è¿›ç¨‹ã€‚ASIDç›¸å½“äºæ˜¯PIDï¼Œä½†æ˜¯é€šå¸¸åªæœ‰è¾ƒå°‘çš„ä½æ•°ï¼ˆPID32ä½ï¼ŒASID8ä½ï¼‰</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-19/image-20241115171717905.png"></p><h2 id="5-Issue-Replacement-Policy"><a href="#5-Issue-Replacement-Policy" class="headerlink" title="5 Issue: Replacement Policy"></a>5 Issue: Replacement Policy</h2><p>ç±»ä¼¼äºé¡µç½®æ¢ç®—æ³•ã€‚</p><p>å…¸å‹çš„æœ‰LRUï¼Œéšæœºæ›¿æ¢ç®—æ³•ç­‰ã€‚éšæœºæ›¿æ¢ç®—æ³•æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”å¯ä»¥é¿å…ä¸€äº›è¾¹ç•Œæƒ…å†µã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 18</title>
    <link href="/2024/11/15/OS-Three-Easy-Pieces-Chapter-18/"/>
    <url>/2024/11/15/OS-Three-Easy-Pieces-Chapter-18/</url>
    
    <content type="html"><![CDATA[<h1 id="Paging-Introduction"><a href="#Paging-Introduction" class="headerlink" title="Paging: Introduction"></a>Paging: Introduction</h1><h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1 Overview"></a>1 Overview</h2><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„é¡µè¡¨(Page table)ï¼Œç”¨æ¥è¿›è¡Œè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚</p><p>è™šæ‹Ÿåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè™šæ‹Ÿé¡µå·ï¼ˆVirtual Page Numberï¼ŒVPNï¼‰å’Œå†…é¡µåç§»ï¼ˆoffsetï¼‰ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-18/image-20241115161640163.png"></p><p>MMUæ ¹æ®é¡µè¡¨ï¼Œå°†VPNè½¬æ¢ä¸ºå¯¹åº”çš„ç‰©ç†é¡µå·ï¼ˆPhysical Page Numberï¼ŒPPNï¼‰ï¼Œç„¶åå°†PPNå’Œoffsetç»„åˆï¼Œè·å¾—å®é™…çš„ç‰©ç†åœ°å€ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-18/image-20241115161808036.png"></p><h2 id="2-Where-Are-Page-Tables-Stored"><a href="#2-Where-Are-Page-Tables-Stored" class="headerlink" title="2  Where Are Page Tables Stored?"></a>2  Where Are Page Tables Stored?</h2><p>å¯¹äºå¸¸è§çš„åœ°å€ç©ºé—´ï¼ˆ32ä½ï¼Œé¡µå¤§å°4KBï¼‰ï¼ŒVPNæ˜¯20ä½ï¼Œoffsetæ˜¯12ä½ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦$2^{20}$ä¸ªé¡µè¡¨é¡¹ï¼ˆpage table entryï¼‰ï¼Œå¦‚æœæ¯ä¸ªé¡µè¡¨é¡¹æ˜¯4å­—èŠ‚ï¼Œé‚£ä¹ˆæ¯ä¸ªè¿›ç¨‹ä¸ºäº†è¿›è¡Œåœ°å€è½¬æ¢ï¼Œéœ€è¦4MBçš„ç©ºé—´ã€‚å› æ­¤ï¼Œé€šå¸¸ï¼Œå°†é¡µè¡¨é˜²æ­¢åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯åœ¨æŸäº›èŠ¯ç‰‡ä¸Šçš„ç¡¬ä»¶ä¸­ã€‚</p><h2 id="3-Whatâ€™s-Actually-In-The-Page-Table"><a href="#3-Whatâ€™s-Actually-In-The-Page-Table" class="headerlink" title="3 Whatâ€™s Actually In The Page Table?"></a>3 Whatâ€™s Actually In The Page Table?</h2><p>é¡µè¡¨å°±æ˜¯ä¸€ä¸ªè´Ÿè´£å°†VPNè½¬æ¢ä¸ºPPNçš„æ•°æ®ç»“æ„ã€‚æœ€ç®€å•çš„å®ç°æ–¹å¼æ˜¯æ•°ç»„ï¼ŒOSç”¨VPNä½œä¸ºç´¢å¼•ï¼Œå–å¾—å¯¹åº”çš„PTEï¼Œç„¶åå–å¾—å¯¹åº”çš„PPNã€‚</p><p><strong>valid bit</strong></p><p>è¯¥ä½ç”¨æ¥æ ‡è¯†ä¸€ä¸ªåœ°å€è½¬åŒ–æ˜¯å¦æœ‰æ•ˆã€‚</p><p><strong>protection bits</strong></p><p>ç”¨æ¥æ ‡è¯†æŸé¡µæ˜¯å¦å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œç­‰ã€‚</p><p><strong>present bit</strong></p><p>ç”¨æ¥æ ‡è¯†æŸé¡µæ˜¯åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè¿˜æ˜¯åœ¨ç£ç›˜ä¸­ã€‚ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒäº¤æ¢æŠ€æœ¯ã€‚</p><p><strong>dirty bit</strong></p><p>ç”¨æ¥æ ‡è¯†æŸé¡µæ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚</p><p><strong>reference bitï¼ˆaccessed bitï¼‰</strong></p><p>ç”¨æ¥æ ‡è¯†æŸé¡µæ˜¯å¦è¢«è®¿é—®è¿‡ã€‚ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒé¡µæ›¿æ¢ã€‚</p><h2 id="4-Paging-Also-Too-Slow"><a href="#4-Paging-Also-Too-Slow" class="headerlink" title="4 Paging: Also Too Slow"></a>4 Paging: Also Too Slow</h2><p>æ³¨æ„åˆ°ï¼Œæ¯æ¬¡è®¿å­˜ä¹‹å‰ï¼Œéƒ½å¿…é¡»è¿›è¡Œä¸€æ¬¡é¢å¤–çš„è®¿å­˜ï¼Œæ‰¾åˆ°å¯¹åº”çš„PTEå®Œæˆåœ°å€è½¬æ¢ï¼Œç„¶åæ‰èƒ½è®¿é—®å®é™…çš„å†…å­˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 17</title>
    <link href="/2024/11/15/OS-Three-Easy-Pieces-Chapter-17/"/>
    <url>/2024/11/15/OS-Three-Easy-Pieces-Chapter-17/</url>
    
    <content type="html"><![CDATA[<h1 id="Free-Space-Management"><a href="#Free-Space-Management" class="headerlink" title="Free-Space Management"></a>Free-Space Management</h1><p>å¯¹äºé¡µå¼å†…å­˜æ¥è¯´ï¼Œç©ºé—²é¡µç®¡ç†å¾ˆç®€å•ï¼Œåªéœ€è¦ç”¨é“¾è¡¨æ¥ç®¡ç†ç©ºé—²é¡µå³å¯ï¼›ä½†æ˜¯å¯¹äºåƒæ®µå¼å†…å­˜è¿™ç§ç©ºé—²å†…å­˜å•å…ƒå¤§å°ä¸å›ºå®šçš„æ–¹å¼æ¥è¯´ï¼Œç©ºé—²å†…å­˜ç®¡ç†å˜å¾—æ›´å¤æ‚ã€‚å¯¹äºåè€…ï¼Œæœ€å¤§çš„æŒ‘æˆ˜æ˜¯<strong>å¤–éƒ¨ç¢ç‰‡é—®é¢˜</strong>ã€‚</p><h2 id="1-Low-level-Mechanisms"><a href="#1-Low-level-Mechanisms" class="headerlink" title="1 Low-level Mechanisms"></a>1 Low-level Mechanisms</h2><p><strong>Splitting and Coalescing</strong></p><p>ç®¡ç†ç©ºé—²å†…å­˜ç©ºé—´çš„æ•°æ®ç»“æ„åœ¨éœ€è¦æ—¶éœ€è¦è¿›è¡Œç›¸åº”çš„æ‹†åˆ†æˆ–è€…åˆå¹¶ã€‚</p><p><strong>Tracking The Size Of Allocated Regions</strong></p><p>åƒ <code>free(void *ptr)</code> è¿™æ ·çš„æ¥å£æ— éœ€å¤§å°å‚æ•°ã€‚å› æ­¤ï¼Œç»™å®šä¸€ä¸ªæŒ‡é’ˆï¼Œåº”è¯¥å¯ä»¥å¿«é€Ÿç¡®å®šéœ€è¦é‡Šæ”¾çš„å†…å­˜çš„å¤§å°ã€‚</p><p>ä¸ºæ­¤ï¼Œå¾ˆå¤šå®ç°ä¼šåœ¨å†…å­˜ä¸­å­˜å‚¨ä¸€ä¸ªheaderï¼Œåœ¨headerä¸­å­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-17/image-20241115144435344.png"></p><p><strong>Embedding A Free List</strong></p><p>å°†ç®¡ç†ç©ºé—²å†…å­˜çš„é“¾è¡¨ç»“ç‚¹å­˜å‚¨åœ¨ç©ºé—²å†…å­˜ä¸­ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-17/image-20241115150529087.png"></p><p>å½“ç”³è¯·äº†ä¸€äº›å†…å­˜å</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-17/image-20241115150608588.png"></p><p>å½“ç”³è¯·äº†ä¸€äº›å†…å­˜ï¼Œå¹¶é‡Šæ”¾äº†ä¸€äº›å†…å­˜åã€‚å¯ä»¥æ³¨æ„åˆ°ï¼Œæ­¤æ—¶æ‰€æœ‰çš„ç©ºé—²ç©ºé—´æ²¡æœ‰è¢«åˆå¹¶ï¼Œæˆ‘ä»¬å¯ä»¥éå†ä¸€éé“¾è¡¨ï¼Œå°†ç›¸é‚»çš„ç©ºé—´åˆå¹¶ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-17/image-20241115150744978.png"></p><h2 id="2-Basic-Strategies"><a href="#2-Basic-Strategies" class="headerlink" title="2 Basic Strategies"></a>2 Basic Strategies</h2><p><strong>Best Fit</strong></p><p>ä»æœ€å°çš„å¯è¡Œçš„ç©ºé—²å†…å­˜ä¸­åˆ†é…ã€‚</p><p><strong>Worst Fit</strong></p><p>ä»æœ€å¤§çš„å¯è¡Œçš„ç©ºé—²å†…å­˜ä¸­åˆ†é…ã€‚</p><p><strong>First Fit</strong></p><p>ä»ç¬¬ä¸€ä¸ªå¯è¡Œçš„ç©ºé—²å†…å­˜ä¸­åˆ†é…ã€‚</p><p>ä¸€èˆ¬å°†ç©ºé—²å†…å­˜æŒ‰ç…§åœ°å€æ’åºã€‚</p><p><strong>Next Fit</strong></p><p>ç±»ä¼¼First fitï¼Œä½†æ˜¯æ¯æ¬¡ä»ä¸Šä¸€æ¬¡åˆ†é…çš„ä¸‹ä¸€ä¸ªå¯è¡Œçš„ç©ºé—²å†…å­˜ä¸­åˆ†é…ã€‚</p><h2 id="3-Other-Approaches"><a href="#3-Other-Approaches" class="headerlink" title="3 Other Approaches"></a>3 Other Approaches</h2><p>Segregated Listsã€Buddy Allocationç­‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Lab4 traps</title>
    <link href="/2024/11/12/MIT-6-1810-Lab4-traps/"/>
    <url>/2024/11/12/MIT-6-1810-Lab4-traps/</url>
    
    <content type="html"><![CDATA[<h2 id="1-RISC-V-assembly-easy"><a href="#1-RISC-V-assembly-easy" class="headerlink" title="1 RISC-V assembly (easy)"></a>1 RISC-V assembly (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">easy</a>)</h2><div class="note note-primary">            <p>Which registers contain arguments to functions? For example, which register holds 13 in mainâ€™s call to <code>printf</code>?</p>          </div><p>åœ¨RISC-Vä¸­ï¼Œå‡½æ•°çš„å‚æ•°å­˜æ”¾åœ¨å¯„å­˜å™¨ <code>a0-a7</code> ä¸­ï¼Œå¦‚æœè¶…è¿‡8ä¸ªå‚æ•°ï¼Œå¯ä»¥ç”¨æ ˆæ¥ä¼ é€’ã€‚<code>a0-a1</code> å¯„å­˜å™¨è¿˜ç”¨æ¥ä¼ é€’å‡½æ•°çš„è¿”å›å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">24:4635                lia2,13<br></code></pre></td></tr></table></figure><p> ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>printf</code> çš„å‚æ•°13æ”¾åœ¨å¯„å­˜å™¨ <code>a2</code> ä¸­è¿›è¡Œä¼ é€’ã€‚</p><div class="note note-primary">            <p>Where is the call to function <code>f</code> in the assembly code for main? Where is the call to <code>g</code>? (Hint: the compiler may inline functions.)</p>          </div><p><code>f</code> å’Œ <code>g</code> éƒ½è¢«inlinedåˆ° <code>main</code> ä¸­äº†ï¼Œç¼–è¯‘å™¨é¢„è®¡ç®—å‡ºäº† <code>f(8) + 1</code> çš„å€¼ï¼Œç›´æ¥å°† <code>12</code> åŠ è½½åˆ°å¯„å­˜å™¨ <code>a1</code> ä¸­ï¼Œè€Œæ²¡æœ‰ç›´æ¥è°ƒç”¨å‡½æ•°ã€‚</p><div class="note note-primary">            <p>At what address is the function <code>printf</code> located?</p>          </div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">30:68c000ef          jal6bc &lt;printf&gt;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç ä¸­å¯çŸ¥ï¼Œ<code>printf</code> åœ¨0x6bcå¤„</p><div class="note note-primary">            <p>What value is in the register <code>ra</code> just after the <code>jalr</code> to <code>printf</code> in <code>main</code>?</p>          </div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">30:68c000ef          jal6bc &lt;printf&gt;<br>34:4501                lia0,0<br></code></pre></td></tr></table></figure><p>å½“ <code>jal</code> æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ”¾åœ¨ <code>ra</code> ä¸­ï¼Œå› æ­¤ <code>ra</code> ä¸­çš„å€¼æ˜¯0x34</p><div class="note note-primary">            <p>Run the following code.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i = <span class="hljs-number">0x00646c72</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;H%x Wo%s&quot;</span>, <span class="hljs-number">57616</span>, (<span class="hljs-type">char</span> *) &amp;i);<br></code></pre></td></tr></table></figure><p>What is the output? <a href="https://www.asciitable.com/">Hereâ€™s an ASCII table</a> that maps bytes to characters.</p><p>The output depends on that fact that the RISC-V is little-endian. If the RISC-V were instead big-endian what would you set <code>i</code> to in order to yield the same output? Would you need to change <code>57616</code> to a different value?</p>          </div><p>åœ¨å°ç«¯ï¼ˆlittle-endianï¼‰ç³»ç»Ÿä¸­ï¼Œæœ€ä½æœ‰æ•ˆå­—èŠ‚å­˜å‚¨åœ¨æœ€ä½åœ°å€ã€‚</p><p><code>i = 0x00646c72</code>ï¼Œåœ¨å°ç«¯ç³»ç»Ÿä¸­ï¼Œå®ƒä¼šæŒ‰å­—èŠ‚é¡ºåºå­˜å‚¨ä¸º <code>72 6c 64 00</code>ï¼š</p><ul><li><code>0x72</code> å¯¹åº”å­—ç¬¦ <code>&#39;r&#39;</code></li><li><code>0x6c</code> å¯¹åº”å­—ç¬¦ <code>&#39;l&#39;</code></li><li><code>0x64</code> å¯¹åº”å­—ç¬¦ <code>&#39;d&#39;</code></li><li><code>0x00</code> å¯¹åº”ç©ºå­—ç¬¦ï¼ˆå­—ç¬¦ä¸²ç»“å°¾ï¼‰</li></ul><p><code>printf(&quot;H%x Wo%s&quot;, 57616, (char *) &amp;i);</code> ä¸­ï¼Œ<code>%x</code> ä¼šå°† <code>57616</code> ä»¥åå…­è¿›åˆ¶æ ¼å¼è¾“å‡ºï¼Œè€Œ <code>%s</code> ä¼šå°† <code>i</code> çš„å€¼æŒ‰å­—ç¬¦å­—ç¬¦ä¸²è¾“å‡ºã€‚</p><p>å› æ­¤ï¼Œè¾“å‡ºæ˜¯ï¼š</p><ul><li><code>H%x</code> ä¼šè¾“å‡º <code>H</code> åŠ ä¸Š <code>57616</code> çš„åå…­è¿›åˆ¶å½¢å¼ï¼Œå³ <code>e110</code>ã€‚</li><li><code>Wo%s</code> ä¼šè¾“å‡º <code>Wo</code> åŠ ä¸Š <code>i</code> çš„å†…å®¹ï¼Œå³ <code>rld</code>ã€‚</li></ul><p>æ‰€ä»¥åœ¨å°ç«¯ç³»ç»Ÿä¸Šï¼Œè¿™æ®µä»£ç çš„è¾“å‡ºä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">He110</span> World<br></code></pre></td></tr></table></figure><p>åœ¨å¤§ç«¯ï¼ˆbig-endianï¼‰ç³»ç»Ÿä¸Šï¼Œ<code>0x00646c72</code> å°†æŒ‰å­—èŠ‚é¡ºåºå­˜å‚¨ä¸º <code>00 64 6c 72</code>ï¼Œè¿™ä¼šå°† <code>i</code> è§£é‡Šä¸ºä¸åŒçš„å­—ç¬¦åºåˆ—ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é‡æ–°è®¾ç½® <code>i</code> ä»¥ç¡®ä¿è¾“å‡ºç›¸åŒã€‚</p><p>ä¸ºäº†åœ¨å¤§ç«¯ç³»ç»Ÿä¸Šå¾—åˆ° <code>rld</code> çš„å­—ç¬¦é¡ºåºï¼Œæˆ‘ä»¬éœ€è¦å°† <code>i</code> è®¾ä¸º <code>0x726c6400</code>ï¼Œè¿™æ ·åœ¨å¤§ç«¯ç³»ç»Ÿä¸­å­˜å‚¨çš„å­—èŠ‚åºå°†æ˜¯ <code>72 6c 64 00</code>ï¼Œå³ <code>rld</code>ã€‚</p><p><code>57616</code> çš„å€¼æ²¡æœ‰ä¾èµ–å­—èŠ‚é¡ºåºï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œæ‰€ä»¥æ— éœ€æ›´æ”¹ã€‚</p><div class="note note-primary">            <p>In the following code, what is going to be printed after <code>&#39;y=&#39;</code>? (note: the answer is not a specific value.) Why does this happen?</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;x=%d y=%d&quot;</span>, <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure>          </div><p>è¿™æ®µä»£ç ä½¿ç”¨ <code>printf</code> å‡½æ•°æ¥è¾“å‡ºä¸¤ä¸ªå ä½ç¬¦ <code>%d</code>ï¼Œåˆ†åˆ«ç”¨äºæ‰“å°å˜é‡ <code>x</code> å’Œ <code>y</code> çš„å€¼ã€‚ç„¶è€Œï¼Œåªæä¾›äº†ä¸€ä¸ªå‚æ•° <code>3</code>ï¼Œæ²¡æœ‰ç»™å‡ºç¬¬äºŒä¸ªå‚æ•°ã€‚</p><p>ç”±äºç¼ºå°‘ç¬¬äºŒä¸ªå‚æ•°ï¼Œ<code>printf</code> ä¼šåœ¨å†…å­˜ä¸­ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªä½ç½®çš„å€¼æ¥å¡«å…… <code>y</code> çš„å ä½ç¬¦ã€‚è¿™ç§è¡Œä¸ºæ˜¯<strong>æœªå®šä¹‰è¡Œä¸º</strong>ï¼ˆundefined behaviorï¼‰ï¼Œå¯èƒ½å¯¼è‡´ä»¥ä¸‹æƒ…å†µä¹‹ä¸€ï¼š</p><ol><li><strong>éšæœºå€¼</strong>ï¼š<code>printf</code> ä¼šä»æ ˆæˆ–å¯„å­˜å™¨ä¸­è¯»å–ä¸€äº›æœªåˆå§‹åŒ–çš„å€¼ï¼Œå› æ­¤ <code>y</code> å¯èƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªéšæœºå€¼ã€‚</li><li><strong>ç¨‹åºå´©æºƒ</strong>ï¼šåœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œæœªæä¾›çš„å‚æ•°ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ‰“å°å‡ºæ— æ•ˆæ•°æ®ã€‚</li></ol><h2 id="2-Backtrace-moderate"><a href="#2-Backtrace-moderate" class="headerlink" title="2 Backtrace (moderate)"></a>2 Backtrace (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">moderate</a>)</h2><p>æœ¬é¢˜è¦æ±‚æˆ‘ä»¬å®ç° <code>backtrace()</code> å‡½æ•°ç”¨æ¥æ‰“å°å‡½æ•°è°ƒç”¨æ ˆï¼Œå‡½æ•°è°ƒç”¨æ ˆçš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<code>ra</code> å¯„å­˜å™¨çš„åœ°å€å­˜æ”¾åœ¨ <code>fp - 8</code> çš„ä½ç½®ä¸Šã€‚åœ¨xv6ä¸­ï¼Œå†…æ ¸æ ˆçš„å¤§å°æ˜¯ä¸€é¡µï¼Œå› æ­¤æ‰€æœ‰çš„æ ˆå¸§éƒ½åœ¨åŒä¸€é¡µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ®æ­¤æ¥åœæ­¢ <code>backtrace</code>ã€‚</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">                 .<br>                 .<br>    +-&gt;          .<br>    |<span class="hljs-string">   +-----------------+   </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string"> return address  </span>|<span class="hljs-string">   </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string">   previous fp ------+</span><br><span class="hljs-string">    </span>|<span class="hljs-string">   </span>|<span class="hljs-string"> saved registers </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string"> local variables </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string">       ...       </span>|<span class="hljs-string"> &lt;-+</span><br><span class="hljs-string">    </span>|<span class="hljs-string">   +-----------------+   </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string"> return address  </span>|<span class="hljs-string">   </span>|<br>    +------ previous fp   |<span class="hljs-string">   </span>|<br>        |<span class="hljs-string"> saved registers </span>|<span class="hljs-string">   </span>|<br>        |<span class="hljs-string"> local variables </span>|<span class="hljs-string">   </span>|<br>    +-&gt; |<span class="hljs-string">       ...       </span>|<span class="hljs-string">   </span>|<br>    |<span class="hljs-string">   +-----------------+   </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string"> return address  </span>|<span class="hljs-string">   </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string">   previous fp ------+</span><br><span class="hljs-string">    </span>|<span class="hljs-string">   </span>|<span class="hljs-string"> saved registers </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string"> local variables </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string">       ...       </span>|<span class="hljs-string"> &lt;-+</span><br><span class="hljs-string">    </span>|<span class="hljs-string">   +-----------------+   </span>|<br>    |<span class="hljs-string">   </span>|<span class="hljs-string"> return address  </span>|<span class="hljs-string">   </span>|<br>    +------ previous fp   |<span class="hljs-string">   </span>|<br>        |<span class="hljs-string"> saved registers </span>|<span class="hljs-string">   </span>|<br>        |<span class="hljs-string"> local variables </span>|<span class="hljs-string">   </span>|<br>$fp --&gt; |<span class="hljs-string">       ...       </span>|<span class="hljs-string">   </span>|<br>        +-----------------+   |<span class="hljs-string"></span><br><span class="hljs-string">        </span>|<span class="hljs-string"> return address  </span>|<span class="hljs-string">   </span>|<br>        |<span class="hljs-string">   previous fp ------+</span><br><span class="hljs-string">        </span>|<span class="hljs-string"> saved registers </span>|<br>$sp --&gt; |<span class="hljs-string"> local variables </span>|<br>        +-----------------+<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">backtrace</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  uint64 ra, cur_fp, prev_fp, page;<br>  cur_fp = r_fp();<br>  page = PGROUNDDOWN(cur_fp);<br>  <span class="hljs-keyword">while</span> (cur_fp &gt;= page &amp;&amp; cur_fp &lt; page + PGSIZE) &#123;<br>    ra = *((uint64*)(cur_fp - <span class="hljs-number">8</span>));<br>    prev_fp = *((uint64*)(cur_fp - <span class="hljs-number">16</span>));<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p\n&quot;</span>, (<span class="hljs-type">void</span>*)ra);<br>    cur_fp = prev_fp;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[DB]Database System Concepts Chapter 2</title>
    <link href="/2024/11/10/DB-Database-System-Concepts-Chapter-2/"/>
    <url>/2024/11/10/DB-Database-System-Concepts-Chapter-2/</url>
    
    <content type="html"><![CDATA[<h1 id="Introduction-to-the-Relational-Model"><a href="#Introduction-to-the-Relational-Model" class="headerlink" title="Introduction to the Relational Model"></a>Introduction to the Relational Model</h1><h2 id="1-Structure-of-Relational-Databases"><a href="#1-Structure-of-Relational-Databases" class="headerlink" title="1 Structure of Relational Databases"></a>1 Structure of Relational Databases</h2><p>ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“åŒ…å«ä¸€ç»„è¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„åå­—ã€‚</p><p><img src="/../images/DB-Database-System-Concepts-Chapter-2/image-20241110210929546.png" alt="instructorå…³ç³»"></p><p>é€šå¸¸æ¥è¯´ï¼Œè¡¨ä¸­çš„ä¸€è¡Œä»£è¡¨ç€ä¸€ç»„å€¼ä¹‹é—´çš„å…³ç³»ã€‚</p><p><strong>æœ¯è¯­</strong></p><ul><li><p>tupleï¼šä¸€ç»„å€¼çš„åºåˆ—</p></li><li><p>nä¸ªå€¼çš„å…³ç³»ç”¨ä¸€ä¸ªn-tupleæ¥è¡¨ç¤ºï¼ˆè¡¨ä¸­çš„ä¸€è¡Œï¼‰</p></li><li><p>relation - ä¸€å¼ è¡¨</p></li><li><p>tuple - è¡¨ä¸­çš„ä¸€è¡Œ</p></li><li><p>attribute - è¡¨ä¸­çš„ä¸€åˆ—</p></li><li><p>relation instance - æŸç§å…³ç³»çš„ä¸€ä¸ªç¤ºä¾‹ï¼ˆæŸäº›ç‰¹å®šçš„è¡Œï¼‰</p></li><li><p>domain - æŸç§å…³ç³»æŸä¸ªattributeçš„å¯è¡Œå€¼é›†åˆ</p><p>å¯¹äºæ‰€æœ‰å…³ç³» rï¼Œr çš„æ‰€æœ‰å±æ€§åŸŸéƒ½æ˜¯åŸå­çš„ã€‚åŸŸæ˜¯åŸå­çš„çš„æ„æ€æ˜¯åŸŸçš„å…ƒç´ è¢«è§†ä¸ºä¸å¯åˆ†å‰²çš„å•ä½ã€‚</p></li><li><p>null value - ç”¨æ¥æŒ‡ç¤ºæŸä¸ªå€¼æœªçŸ¥æˆ–è€…ä¸å­˜åœ¨</p></li></ul><h2 id="2-Database-Schema"><a href="#2-Database-Schema" class="headerlink" title="2 Database Schema"></a>2 Database Schema</h2><ul><li>database schema - æ•°æ®åº“çš„é€»è¾‘è§†å›¾</li><li>database instance - æŸä¸ªç»™å®šçš„æ•°æ®åº“çš„æŸä¸ªç¡®å®šæ—¶é—´çš„ä¸€ä¸ªå¿«ç…§</li><li>relation - å¯¹åº”ç¼–ç¨‹ä¸­çš„å˜é‡</li><li>relation schema - å¯¹åº”ç¼–ç¨‹ä¸­çš„ç±»å‹å®šä¹‰</li></ul><p>å¯¹äºä¸‹å›¾ä¸­çš„departmentå…³ç³»ï¼Œå…¶schemaä¸ºï¼š<br>$$<br>department(dept_name, building, budget)<br>$$<br><img src="/../images/DB-Database-System-Concepts-Chapter-2/image-20241110212615824.png"></p><h2 id="3-Keys"><a href="#3-Keys" class="headerlink" title="3 Keys"></a>3 Keys</h2><p>å¿…é¡»æä¾›ä¸€ç§æ–¹æ³•æ¥åŒºåˆ†ä¸€ä¸ªå…³ç³»ä¸­ä¸åŒçš„tupleã€‚</p><p><strong>è¶…é”®superkey</strong></p><p>è¶…é”®æ˜¯ä¸€ä¸ªæˆ–å‡ ä¸ªå±æ€§çš„é›†åˆï¼Œå®ƒä»¬å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå…³ç³»ä¸­çš„æŸä¸ªtupleã€‚<br>$$<br>if \space t_1 \neq t_2,then \space t1.K \neq t2.K<br>$$<br>å…¶ä¸­$K$æ˜¯æŸä¸ªå…³ç³»$r$çš„æ‰€æœ‰å±æ€§é›†åˆ$R$çš„ä¸€ä¸ªå­é›†ã€‚</p><p>å¦‚æœ$K$æ˜¯ä¸€ä¸ªè¶…é”®ï¼Œé‚£ä¹ˆ$K$çš„ä»»ä½•ä¸€ä¸ªè¶…é›†ä¹Ÿæ˜¯è¶…é”®</p><p><strong>å€™é€‰é”®candidate keys</strong></p><p>å€™é€‰é”®çš„ä»»ä½•ä¸€ä¸ªå­é›†éƒ½ä¸æ˜¯è¶…é”®ã€‚</p><p>å¯¹äºä¸€ä¸ªå…³ç³»ï¼Œå¯ä»¥æœ‰å¤šä¸ªå€™é€‰é”®ã€‚</p><p><strong>ä¸»é”®primary key</strong></p><p>è¢«é€‰å®šçš„æŸä¸ªå€™é€‰é”®ï¼Œç”¨æ¥åŒºåˆ†tupleã€‚ä¸»é”®çš„å€¼åº”è¯¥ä»ä¸æˆ–è€…å¾ˆå°‘æ”¹å˜ã€‚</p><p><strong>ä¸»é”®çº¦æŸprimary key constraints</strong></p><p>é”®æ˜¯æ•´ä¸ªå…³ç³»çš„ä¸€ä¸ªæ€§è´¨ï¼Œè€Œæ— å…³æŸä¸ªå…·ä½“çš„tupleã€‚ä»»ä½•ä¸¤ä¸ªä¸åŒçš„tupleï¼Œå®ƒä»¬é”®çš„å€¼ä¸èƒ½ç›¸åŒã€‚è¿™ä»£è¡¨è¿™è¢«å»ºæ¨¡çš„çœŸå®ä¸–ç•Œçš„ä¸€ä¸ªçº¦æŸï¼ˆä¸»é”®çº¦æŸprimary key constraintsï¼‰</p><p><strong>å¤–é”®çº¦æŸ</strong></p><p>è€ƒè™‘ä¸€ä¸‹æ•™å¸ˆå…³ç³»ä¸­çš„éƒ¨é—¨åå±æ€§ã€‚å¦‚æœ instructor ä¸­çš„å…ƒç»„çš„ç³»åå€¼ä¸ç³»å…³ç³»ä¸­çš„ç³»ä¸å¯¹åº”ï¼Œé‚£æ˜¯ä¸åˆç†çš„ã€‚å› æ­¤ï¼Œåœ¨ä»»ä½•æ•°æ®åº“å®ä¾‹ä¸­ï¼Œç»™å®šæ•™å‘˜å…³ç³»ä¸­çš„ä»»ä½•å…ƒç»„ï¼ˆå¦‚ taï¼‰ï¼Œéƒ¨é—¨å…³ç³»ä¸­ä¸€å®šæœ‰æŸä¸ªå…ƒç»„ï¼ˆå¦‚ tbï¼‰ï¼Œä½¿å¾— ta çš„éƒ¨é—¨åå±æ€§å€¼ä¸ tb çš„ä¸»é”®ï¼ˆéƒ¨é—¨åï¼‰å€¼ç›¸åŒã€‚</p><p>ä»å…³ç³» r1 çš„å±æ€§é›† A åˆ°å…³ç³» r2 çš„<strong>ä¸»é”®</strong> B çš„å¤–é”®çº¦æŸè§„å®šï¼Œåœ¨ä»»ä½•æ•°æ®åº“å®ä¾‹ä¸­ï¼Œr1 ä¸­æ¯ä¸ªå…ƒç»„çš„ A å€¼ä¹Ÿå¿…é¡»æ˜¯ r2 ä¸­æŸä¸ªå…ƒç»„çš„ B å€¼ã€‚å±æ€§é›† A è¢«ç§°ä¸ºæ¥è‡ª r1 å¹¶å¼•ç”¨ r2 çš„å¤–é”®ã€‚å…³ç³» r1 ä¹Ÿè¢«ç§°ä¸ºå¤–é”®çº¦æŸçš„å¼•ç”¨å…³ç³»ï¼Œè€Œ r2 è¢«ç§°ä¸ºè¢«å¼•ç”¨å…³ç³»ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Database</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 16</title>
    <link href="/2024/11/10/OS-Three-Easy-Pieces-Chapter-16/"/>
    <url>/2024/11/10/OS-Three-Easy-Pieces-Chapter-16/</url>
    
    <content type="html"><![CDATA[<h1 id="Segmentation"><a href="#Segmentation" class="headerlink" title="Segmentation"></a>Segmentation</h1><h2 id="1-Segmentation-Generalized-Base-Bounds"><a href="#1-Segmentation-Generalized-Base-Bounds" class="headerlink" title="1 Segmentation: Generalized Base&#x2F;Bounds"></a>1 Segmentation: Generalized Base&#x2F;Bounds</h2><p>ä¼ ç»Ÿçš„åŠ¨æ€é‡å®šä½ä¼šå¯¼è‡´å†…å­˜ç©ºé—´çš„æµªè´¹ï¼ˆæ•´ä¸ªç”¨æˆ·åœ°å€ç©ºé—´å¯èƒ½åªæœ‰ä¸€å°éƒ¨åˆ†çœŸæ­£ä½¿ç”¨ï¼Œå¤§éƒ¨åˆ†æ˜¯ç©ºé—²çš„ï¼‰ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨åˆ†æ®µçš„æ–¹å¼ï¼Œå°†ç”¨æˆ·åœ°å€ç©ºé—´æŒ‰ç…§é€»è¾‘åˆ†ä¸ºä¸åŒçš„segmentï¼Œæ¯ä¸ªsegmentéƒ½æœ‰ä¸€å¯¹base&#x2F;boundå¯„å­˜å™¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿›è¡Œåœ°å€è½¬åŒ–çš„æ—¶å€™ï¼Œå¿…é¡»å°†è™šæ‹Ÿåœ°å€é¦–å…ˆè½¬åŒ–ä¸ºæ®µå†…åç§»ï¼Œç„¶ååœ¨è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚</p><h2 id="2-Which-Segment-Are-We-Referring-To"><a href="#2-Which-Segment-Are-We-Referring-To" class="headerlink" title="2 Which Segment Are We Referring To"></a>2 Which Segment Are We Referring To</h2><p>ä¸€ç§æ™®éçš„åšæ³•æ˜¯ï¼Œç”¨è™šæ‹Ÿåœ°å€çš„é«˜ä½æ¥ç´¢å¼•ä¸åŒçš„æ®µï¼Œä½ä½ä½œä¸ºæ®µå†…çš„åç§»ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-16/image-20241110195254091.png"></p><p>è¿™ç§åšæ³•çš„ç¼ºç‚¹æ˜¯é™åˆ¶äº†æ¯ä¸ªæ®µçš„å¤§å°ã€‚</p><p>å¦å¤–ä¸€ç§å¯èƒ½çš„åšæ³•æ˜¯é€šè¿‡åœ°å€çš„æ¥æºæ¥åˆ¤æ–­æ®µã€‚å¦‚æœåœ°å€æ¥è‡ªPCï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ä»£ç æ®µï¼›å¦‚æœåœ°å€æ¥è‡ªspï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯æ ˆæ®µï¼›å¦åˆ™å°±æ˜¯å †æ®µã€‚</p><h2 id="3-What-About-The-Stack"><a href="#3-What-About-The-Stack" class="headerlink" title="3 What About The Stack"></a>3 What About The Stack</h2><p>å› ä¸ºå †æ˜¯é€†å‘å¢é•¿çš„ï¼Œå› æ­¤éœ€è¦é¢å¤–å¤„ç†ã€‚å…·ä½“åœ°ï¼Œç¡¬ä»¶åº”è¯¥æ·»åŠ ä¸€ä¸ªæ ‡è®°ä½ï¼Œç”¨æ¥æŒ‡ç¤ºåœ°å€å¢é•¿æ–¹å‘æ˜¯æ­£å‘çš„è¿˜æ˜¯é€†å‘çš„ã€‚</p><h2 id="4-Support-for-Sharing"><a href="#4-Support-for-Sharing" class="headerlink" title="4 Support for Sharing"></a>4 Support for Sharing</h2><p>é€šè¿‡å¯¹æ¯ä¸ªsegmentæ·»åŠ ä¿æŠ¤ä½ï¼ˆå¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œç­‰ï¼‰ï¼Œå¯ä»¥å®‰å…¨çš„åœ¨ä¸åŒçš„è¿›ç¨‹é—´å…±äº«å†…å­˜ã€‚</p><p>åŒæ—¶ï¼ŒMMUåœ¨è¿›è¡Œåœ°å€è½¬æ¢çš„æ—¶å€™ï¼Œä¹Ÿè¦ç¡®ä¿æŸä¸ªè¿›ç¨‹å¯¹æŸå—å†…å­˜æœ‰æ­£ç¡®çš„è®¿é—®æƒé™ã€‚</p><h2 id="5-OS-Support"><a href="#5-OS-Support" class="headerlink" title="5 OS Support"></a>5 OS Support</h2><p>æ®µå¼å†…å­˜ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼š</p><ul><li>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™æ“ä½œç³»ç»Ÿéœ€è¦è´Ÿè´£åˆ‡æ¢æ‰€æœ‰æ®µçš„base&#x2F;boundå¯„å­˜å™¨</li><li>æ®µå¢é•¿<ul><li>å¦‚æœheapæœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œ<code>malloc</code> ç›´æ¥åœ¨heapä¸­åˆ†é…å†…å­˜ï¼Œç„¶åè¿”å›ç›¸åº”çš„åœ°å€</li><li>å¦‚æœheapæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œ <code>malloc</code> ä¼šè°ƒç”¨ <code>sbrk</code> ç³»ç»Ÿè°ƒç”¨å»å¢é•¿heapï¼Œå¦‚æœæœ‰è¶³å¤Ÿçš„ç©ºé—´ä¾›å¢é•¿ï¼Œæ“ä½œç³»ç»Ÿä¼šæ›´æ–°å †æ®µçš„boundå¯„å­˜å™¨ã€‚</li></ul></li><li>ç®¡ç†ç©ºé—²å†…å­˜ï¼šæ®µå¼å†…å­˜æœ€å¤§çš„é—®é¢˜æ˜¯ä¼šå¤–éƒ¨ç¢ç‰‡é—®é¢˜ã€‚æœ‰ä¸€ç³»åˆ—ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼ˆBFï¼ŒWFï¼ŒFFï¼Œä¼™ä¼´ç®—æ³•ç­‰ï¼‰ï¼Œä½†æ˜¯éƒ½æ— æ³•æ ¹æœ¬ä¸Šè§£å†³å¤–éƒ¨ç¢ç‰‡é—®é¢˜ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 15</title>
    <link href="/2024/11/10/OS-Three-Easy-Pieces-Chapter-15/"/>
    <url>/2024/11/10/OS-Three-Easy-Pieces-Chapter-15/</url>
    
    <content type="html"><![CDATA[<h1 id="Mechanism-Address-Translation"><a href="#Mechanism-Address-Translation" class="headerlink" title="Mechanism: Address Translation"></a>Mechanism: Address Translation</h1><h2 id="1-Assumptions"><a href="#1-Assumptions" class="headerlink" title="1 Assumptions"></a>1 Assumptions</h2><p>æœ€åˆçš„å‡è®¾å¾ˆç®€å•ï¼š</p><ul><li>ç”¨æˆ·åœ°å€ç©ºé—´åœ¨ç‰©ç†å†…å­˜ä¸­è¿ç»­å­˜æ”¾</li><li>ç”¨æˆ·åœ°å€ç©ºé—´ä¸å¤§äºç‰©ç†å†…å­˜å¤§å°</li><li>æ¯ä¸ªç”¨æˆ·åœ°å€ç©ºé—´éƒ½ä¸€æ ·å¤§</li></ul><h2 id="2-Dynamic-Hardware-based-Relocation"><a href="#2-Dynamic-Hardware-based-Relocation" class="headerlink" title="2 Dynamic(Hardware-based) Relocation"></a>2 Dynamic(Hardware-based) Relocation</h2><p>æ—©æœŸï¼Œåœ¨æ²¡æœ‰ç¡¬ä»¶æ”¯æŒçš„æ—¶å€™ï¼Œæœ‰äº›æ“ä½œç³»ç»Ÿæ”¯æŒè½¯ä»¶é‡å®šä½(static relocation)ã€‚<strong>loader</strong>ç¨‹åºè´Ÿè´£æ”¹å†™å¦å¤–ä¸€ä¸ªç¨‹åºä¸­æ¶‰åŠåˆ°çš„åœ°å€ä¸ºå®é™…çš„ç‰©ç†åœ°å€ã€‚è¿™ç§æ–¹æ³•ä¸æä¾›ä»»ä½•çš„ä¿æŠ¤ï¼ŒåŒæ—¶ä¹Ÿå¾ˆéš¾ä¿®æ”¹æŸä¸ªç¨‹åºåœ¨ç‰©ç†å†…å­˜ä¸­çš„ä½ç½®ã€‚</p><p>åé¢ï¼Œåœ¨ç¡¬ä»¶çš„æ”¯æŒä¸‹ï¼Œæå‡ºäº†åŠ¨æ€é‡å®šä½ã€‚æ¯ä¸ªCPUå†…éƒ¨æœ‰ä¸€ä¸ªbaseå¯„å­˜å™¨å’Œä¸€ä¸ªboundå¯„å­˜å™¨ï¼Œè´Ÿè´£å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†åœ°ã€‚<br>$$<br>physical\space address &#x3D; virtual \space address + base<br>$$<br>è¿™ç§åœ°å€è½¬æ¢æ˜¯å‘ç”Ÿåœ¨è¿è¡ŒæœŸé—´çš„ï¼Œå¹¶ä¸”åœ¨ç¨‹åºå·²ç»å¼€å§‹è¿è¡Œä¹‹åï¼Œä¹Ÿå¯ä»¥é‡æ–°å®šä½ç¨‹åºã€‚</p><p>boundå¯„å­˜å™¨è´Ÿè´£æä¾›å†…å­˜ä¿æŠ¤ï¼Œå†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰æ£€æŸ¥ä¸€ä¸ªç¨‹åºæä¾›çš„è™šæ‹Ÿåœ°å€æ˜¯å¦åœ¨boundèŒƒå›´å†…ï¼Œå¦‚æœä¸åœ¨ï¼Œåˆ™è§¦å‘å¼‚å¸¸ï¼Œå°†è¿›ç¨‹æ€æ­»ï¼›å¦‚æœåˆæ³•ï¼Œæ‰æ¥ç€è¿›è¡Œåœ°å€è½¬æ¢ï¼Œå°†å…¶è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†åœ°å€ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-15/image-20241110185430276.png"></p><h2 id="3-Operating-System-Issues"><a href="#3-Operating-System-Issues" class="headerlink" title="3 Operating System Issues"></a>3 Operating System Issues</h2><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-15/image-20241110185748756.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[CMU 15-445]HyperLogLogåŸç†</title>
    <link href="/2024/11/09/CMU-15-445-HyperLogLog%E5%8E%9F%E7%90%86/"/>
    <url>/2024/11/09/CMU-15-445-HyperLogLog%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="HyperLogLog-in-Presto"><a href="#HyperLogLog-in-Presto" class="headerlink" title="HyperLogLog in Presto"></a>HyperLogLog in Presto</h1><p><strong>æƒ…æ™¯</strong></p><p>æƒ³è¦ç¡®å®šä¸€ä¸ªæœ‰é‡å¤å…ƒç´ çš„å¾ˆå¤§é›†åˆçš„cardinalityã€‚å¸¸è§„æ–¹æ³•çš„æ—¶é—´å¼€é”€æˆ–è€…å†…å­˜å¼€é”€è¿‡å¤§ï¼Œæ— æ³•æ¥å—ã€‚</p><p><strong>A simple estimator</strong></p><p>é¦–å…ˆï¼Œç”Ÿæˆä¸€ä¸ªç†è®ºæ•°æ®é›†ï¼š</p><ul><li>ç”Ÿæˆnä¸ªå‡åŒ€åˆ†å¸ƒåœ¨[0,1]ä¹‹é—´çš„æ•°ã€‚</li><li>éšæœºæŒ‘é€‰ä¸€äº›æ•°ï¼Œéšæœºå¤åˆ¶å‡ æ¬¡ã€‚</li><li>æ‰“ä¹±é¡ºåº</li></ul><p>å› ä¸ºæ‰€æœ‰æ•°æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œå¯ä»¥æ‰¾å‡ºæœ€å°çš„æ•°$x_{min}$ï¼Œç„¶åä¼°è®¡é›†åˆçš„$cardinality &#x3D; 1&#x2F;x_{min}$.</p><p>ä¸ºäº†ç¡®ä¿æ•°æ˜¯å‡åŒ€åˆ†å¸ƒçš„ï¼Œå¯ä»¥å¯¹æ¯ä¸ªæ•°è¿›è¡Œå“ˆå¸Œï¼Œç„¶åæ ¹æ®å“ˆå¸Œå€¼æ¥ä¼°è®¡ã€‚</p><p><img src="/../images/CMU-15-445-HyperLogLog%E5%8E%9F%E7%90%86/image-20241109162303304.png"></p><p>è¿™ç§ç®€å•çš„ä¼°è®¡æœ‰è¾ƒé«˜çš„åå·®ï¼Œå› ä¸ºå¦‚æœæœ€å°å€¼å¤ªå°ï¼Œä¼šå¯¼è‡´ä¼°è®¡çš„å€¼è¿‡å¤§ã€‚</p><p><strong>Probabilistic counting</strong></p><p>ä¸ºäº†æ”¹å–„ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»Ÿè®¡å“ˆå¸Œå€¼äºŒè¿›åˆ¶å¼€å¤´è¿ç»­çš„0çš„ä¸ªæ•°ã€‚å› ä¸ºæŸä¸ªç»™å®šå“ˆå¸Œå€¼å¼€å¤´è¿ç»­å‡ºç°$i$ä¸ª0çš„æ¦‚ç‡æ˜¯$1&#x2F;2^i$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹³å‡æ¥è¯´ï¼Œæ¯$2^i$ä¸ªå“ˆå¸Œå€¼æ‰ä¼šå‡ºç°ä¸€ä¸ªè¿ç»­$i$ä¸ª0çš„å“ˆå¸Œå€¼ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡æ‰€æœ‰å“ˆå¸Œå€¼ä¸­å‡ºç°çš„æœ€å¤§çš„è¿ç»­çš„0çš„ä¸ªæ•°$k$ï¼Œç„¶åé›†åˆçš„$cardinality&#x3D;2^k$ã€‚</p><p>è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ul><li>æœ€å¥½æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•ä¼°è®¡çš„å€¼åªèƒ½æ˜¯2çš„å¹‚</li><li>å› ä¸ºè¯¥æ–¹æ³•ä»ç„¶åªä¾èµ–äºæŸä¸ªæœ‰æœ€é•¿è¿ç»­0çš„å“ˆå¸Œå€¼ï¼Œå› æ­¤ä¹Ÿæœ‰è¾ƒå¤§çš„åå·®ã€‚</li></ul><p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯éœ€è¦çš„å†…å­˜ç©ºé—´å¾ˆå°ï¼Œåªéœ€è¦è®°å½•æœ€å¤§è¿ç»­çš„0çš„ä¸ªæ•°å³å¯ã€‚</p><p><strong>Improving accuracyï¼šLogLog</strong></p><p>æˆ‘ä»¬å¯ä»¥è®¾è®¡å¾ˆå¤šå“ˆå¸Œå‡½æ•°ï¼Œç„¶åå°†æœ€å¤§è¿ç»­0çš„ä¸ªæ•°å–å¹³å‡ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•çš„è®¡ç®—å¼€é”€è¿‡å¤§ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œç”¨å“ˆå¸Œå€¼çš„æœ€é«˜å‡ ä½ä½œä¸ºç´¢å¼•ï¼Œç´¢å¼•åˆ°ä¸€ä¸ªbucketï¼Œæ¯ä¸ªbucketè®°å½•å…¶è§è¿‡çš„æœ€é•¿è¿ç»­0çš„ä¸ªæ•°ã€‚ç„¶åç”¨å…¬å¼$cardinality &#x3D; constant Â· m Â· 2^{1&#x2F;m \Sigma^N_{j&#x3D;1}R_j}$æ¥è¿›è¡Œä¼°è®¡ã€‚</p><p><img src="/../images/CMU-15-445-HyperLogLog%E5%8E%9F%E7%90%86/image-20241109164308143.png"></p><p>ç»Ÿè®¡åˆ†ææŒ‡å‡ºä¸Šè¿°æ–¹æ³•çš„ä¼°è®¡æœ‰ä¸€ä¸ªåå·®ï¼Œå› æ­¤ä»¤$constant &#x3D; 0.79402$æ¥ä¿®æ­£è¿™ä¸ªåå·®ã€‚</p><p>å¯¹äº$m$ä¸ªbucketï¼Œè¯¥æ–¹æ³•çš„è¯¯å·®å¤§æ¦‚åœ¨$1.3&#x2F;\sqrt{m}$å·¦å³ã€‚</p><p><strong>HLLï¼šImproving accuracy further</strong></p><ul><li>å¼‚å¸¸å€¼ä¼šé™ä½å‡†ç¡®åº¦ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨æ”¶é›†æ¯ä¸ªbucketçš„å€¼çš„æ—¶å€™ï¼Œåªè€ƒè™‘è¾ƒå°çš„70%çš„bucketï¼Œæ‰”æ‰å…¶ä½™30%ã€‚è¿™ç§ç®—æ³•ï¼ˆSuperLogLogï¼‰ï¼Œå¯ä»¥å°†è¯¯å·®é™ä½åˆ°$1.05&#x2F;\sqrt{m}$.</li><li>HLLä½¿ç”¨è°ƒå’Œå¹³å‡ï¼Œå¯ä»¥å°†è¯¯å·®é™ä½åˆ°$1.04&#x2F;\sqrt{m}$å·¦å³ã€‚</li></ul><p>æœ€ç»ˆï¼Œå¾—åˆ°çš„å…¬å¼ä¸º<br>$$<br>CARDINALITY_{HLL} &#x3D; constant Â· m Â· \frac{m}{\Sigma_{j&#x3D;1}^N 2^{-R_j}}<br>$$<br><strong>é›†åˆå¹¶è¿ç®—</strong></p><p>å¯¹äºä¸¤ä¸ªHLLæ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œå¹¶æ“ä½œï¼ˆå¯¹æ¯ä¸ªå¯¹åº”ä½ç½®çš„bucketå–äºŒè€…çš„è¾ƒå¤§è€…ï¼‰ã€‚è¯¥æ“ä½œå¾ˆç®€å•å¹¶ä¸”æ˜¯æ— æŸçš„ã€‚å¯¹äºå¹¶è¡Œè¿ç®—å‹å¥½ã€‚</p><p><strong>Prestoâ€˜s HLL implementation</strong></p><p>è¯¥å®ç°æ–¹æ³•æœ‰ä¸¤ç§å¸ƒå±€ï¼šsparseå’Œdenseã€‚</p><p>sparseå¸ƒå±€çš„ç»“æœå‡ ä¹æ˜¯å‡†ç¡®çš„ï¼Œä½†æ˜¯å¯¹äºcardinalityè¾ƒå¤§çš„æƒ…å†µï¼Œç®—æ³•ä¼šè‡ªåŠ¨é‡‡ç”¨denseå¸ƒå±€ï¼Œè¯¥å¸ƒå±€çš„ç»“æœæ˜¯ä¸Šè¿°HLLç®—æ³•çš„é¢„ä¼°å€¼ã€‚</p><p><strong>ç¨€ç–å¸ƒå±€</strong>å­˜å‚¨ä¸€ç»„ç›¸é‚»çš„ 32 ä½çš„bucketï¼ŒæŒ‰æ¡¶ç´¢å¼•å‡åºæ’åºã€‚å½“æœ‰æ–°æ•°æ®è¾“å…¥æ—¶ï¼ŒPresto ä¼šæ£€æŸ¥æ•°æ®æ¡¶ç¼–å·æ˜¯å¦å·²ç»å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶å€¼ã€‚å¦‚æœæ•°æ®æ¡¶æ˜¯æ–°çš„ï¼ŒPresto ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„ 32 ä½å†…å­˜åœ°å€æ¥ä¿å­˜è¯¥å€¼ã€‚éšç€æ•°æ®é‡çš„å¢åŠ ï¼Œå­˜å‚¨æ¡¶çš„æ•°é‡å¯èƒ½ä¼šè¶…è¿‡é¢„å…ˆè®¾å®šçš„å†…å­˜é™åˆ¶ã€‚è¿™æ—¶ï¼ŒPresto ä¼šåˆ‡æ¢åˆ°å¯†é›†å¸ƒå±€è¡¨ç¤ºæ³•ã€‚</p><p><strong>å¯†é›†å¸ƒå±€</strong> æœ‰å›ºå®šæ•°é‡çš„å­˜å‚¨æ¡¶ï¼Œç›¸å…³å†…å­˜ä»ä¸€å¼€å§‹å°±è¢«åˆ†é…ã€‚æ¡¶å€¼ä»¥ 4 ä½å€¼åºåˆ—çš„å½¢å¼ç¼–ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ ¹æ® HLL ç®—æ³•çš„ç»Ÿè®¡ç‰¹æ€§ï¼Œ4 ä½è¶³ä»¥ç¼–ç ç»™å®š HLL ç»“æ„ä¸­çš„å¤§éƒ¨åˆ†å€¼ã€‚å¯¹äºå¤§äº4ä½çš„å€¼ï¼Œä½™æ•°å­˜å‚¨åœ¨æº¢å‡ºé¡¹åˆ—è¡¨ä¸­ã€‚</p><p><img src="/../images/CMU-15-445-HyperLogLog%E5%8E%9F%E7%90%86/image-20241109171247559.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CMU 15-445</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]æ–‡ä»¶ç³»ç»Ÿfilesystemåº“</title>
    <link href="/2024/11/06/C-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9Ffilesystem%E5%BA%93/"/>
    <url>/2024/11/06/C-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9Ffilesystem%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h1 id="æ–‡ä»¶ç³»ç»Ÿfilesystemåº“"><a href="#æ–‡ä»¶ç³»ç»Ÿfilesystemåº“" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿfilesystemåº“"></a>æ–‡ä»¶ç³»ç»Ÿfilesystemåº“</h1><p>C++17æ ‡å‡†çš„ä¸€ä¸ªé‡è¦è¡¥å……æ˜¯filesystemåº“ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿå¤„ç†åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚Windowsæˆ–POSIXçš„æ–‡ä»¶ç³»ç»Ÿï¼‰ä¸­çš„è·¯å¾„ã€æ–‡ä»¶å’Œç›®å½•ã€‚</p><h2 id="1-ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„"><a href="#1-ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„" class="headerlink" title="1 ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„"></a>1 ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„</h2><p>filesystemåº“ä½äº <code>&lt;filesystem&gt;</code> å¤´æ–‡ä»¶çš„ <code>std::filesystem</code> å‘½åç©ºé—´ä¸­ã€‚</p><p>æ–‡ä»¶ç³»ç»Ÿç»„ä»¶ï¼ˆæ–‡ä»¶ã€ç›®å½•ã€ç¡¬é“¾æ¥æˆ–è½¯é“¾æ¥ï¼‰çš„è·¯å¾„ç”± <code>path</code> ç±»è¡¨ç¤ºã€‚</p><h3 id="1-1-åŸºæœ¬æ“ä½œ"><a href="#1-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="1.1 åŸºæœ¬æ“ä½œ"></a>1.1 åŸºæœ¬æ“ä½œ</h3><ul><li><p>åˆ›å»ºè·¯å¾„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> path = std::filesystem::path&#123;<span class="hljs-string">&quot;/home/docs&quot;</span>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ å…ƒç´ åˆ°è·¯å¾„ï¼ˆåŒ…å«ç›®å½•åˆ†éš”ç¬¦ï¼‰</p><p>é€šè¿‡æˆå‘˜æ“ä½œç¬¦ <code>/=</code> ï¼Œéæˆå‘˜æ“ä½œç¬¦ <code>/</code> æˆ–è€… <code>append()</code> æ–¹æ³•å°†å…ƒç´ é™„åŠ åˆ°è·¯å¾„ï¼ŒåŒ…å«ç›®å½•åˆ†éš”ç¬¦</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++">path /= <span class="hljs-string">&quot;Book&quot;</span>;<br>path = path / <span class="hljs-string">&quot;Modern&quot;</span> / <span class="hljs-string">&quot;Cpp&quot;</span>;<br>path.<span class="hljs-built_in">append</span>(<span class="hljs-string">&quot;Programming&quot;</span>);<br><span class="hljs-comment">// è¾“å‡º &quot;/home/docs/book/Modern/Cpp/Programming&quot;</span><br>cout &lt;&lt; path &lt;&lt; endl;<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ å…ƒç´ åˆ°è·¯å¾„ï¼ˆä¸åŒ…å«ç›®å½•åˆ†éš”ç¬¦ï¼‰</p><p>ä½¿ç”¨æˆå‘˜æ“ä½œç¬¦ <code>+=</code> ã€éæˆå‘˜æ“ä½œç¬¦ <code>+</code> æˆ– <code>concat()</code> æ–¹æ³•å°†å…ƒç´ è¿æ¥åˆ°è·¯å¾„ï¼Œè€Œä¸åŒ…å«ç›®å½•åˆ†éš”ç¬¦</p></li><li><p>åˆ†è§£ç›®å½•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> path = filesystem::path&#123;<span class="hljs-string">&quot;root/home/docs/file.txt&quot;</span>&#125;;<br>    cout <br>        &lt;&lt; <span class="hljs-string">&quot;root: &quot;</span>        &lt;&lt; path.<span class="hljs-built_in">root_name</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;root dir: &quot;</span>    &lt;&lt; path.<span class="hljs-built_in">root_directory</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;root path: &quot;</span>   &lt;&lt; path.<span class="hljs-built_in">root_path</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;rel path: &quot;</span>    &lt;&lt; path.<span class="hljs-built_in">relative_path</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;parent path: &quot;</span> &lt;&lt; path.<span class="hljs-built_in">parent_path</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;filename: &quot;</span>    &lt;&lt; path.<span class="hljs-built_in">filename</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;stem: &quot;</span>        &lt;&lt; path.<span class="hljs-built_in">stem</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;extension: &quot;</span>   &lt;&lt; path.<span class="hljs-built_in">extension</span>() &lt;&lt; endl;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery">root: <span class="hljs-string">&quot;&quot;</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">root</span> dir: <span class="hljs-string">&quot;&quot;</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">root</span><span class="hljs-built_in"> path</span>: <span class="hljs-string">&quot;&quot;</span><br>rel<span class="hljs-built_in"> path</span>: <span class="hljs-string">&quot;root/home/docs/file.txt&quot;</span><br>parent<span class="hljs-built_in"> path</span>: <span class="hljs-string">&quot;root/home/docs&quot;</span><br>filename: <span class="hljs-string">&quot;file.txt&quot;</span><br>stem: <span class="hljs-string">&quot;file&quot;</span><br>extension: <span class="hljs-string">&quot;.txt&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥ç›®å½•å„ä¸ªéƒ¨åˆ†</p><p>ä½¿ç”¨æˆå‘˜å‡½æ•°ï¼ˆå¦‚ <code>has_root_name()</code> ã€ <code>has_root_directory()</code> ã€<code>has_filename()</code> ã€ <code>has_stem()</code> å’Œ <code>has_extension()</code> ï¼‰è·å–è·¯å¾„çš„å„éƒ¨åˆ†æ˜¯å¦å¯ç”¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> path = filesystem::path&#123;<span class="hljs-string">&quot;root/home/docs/file.txt&quot;</span>&#125;;<br>    cout <br>        &lt;&lt; <span class="hljs-string">&quot;has root: &quot;</span>        &lt;&lt; path.<span class="hljs-built_in">has_root_name</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has root dir: &quot;</span>    &lt;&lt; path.<span class="hljs-built_in">has_root_directory</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has root path: &quot;</span>   &lt;&lt; path.<span class="hljs-built_in">has_root_path</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has rel path: &quot;</span>    &lt;&lt; path.<span class="hljs-built_in">has_relative_path</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has parent path: &quot;</span> &lt;&lt; path.<span class="hljs-built_in">has_parent_path</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has filename: &quot;</span>    &lt;&lt; path.<span class="hljs-built_in">has_filename</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has stem: &quot;</span>        &lt;&lt; path.<span class="hljs-built_in">has_stem</span>() &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span><br>        &lt;&lt; <span class="hljs-string">&quot;has extension: &quot;</span>   &lt;&lt; path.<span class="hljs-built_in">has_extension</span>() &lt;&lt; endl;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">has</span> root: <span class="hljs-number">0</span><br><span class="hljs-attribute">has</span> root dir: <span class="hljs-number">0</span><br><span class="hljs-attribute">has</span> root path: <span class="hljs-number">0</span><br><span class="hljs-attribute">has</span> rel path: <span class="hljs-number">1</span><br><span class="hljs-attribute">has</span> parent path: <span class="hljs-number">1</span><br><span class="hljs-attribute">has</span> filename: <span class="hljs-number">1</span><br><span class="hljs-attribute">has</span> stem: <span class="hljs-number">1</span><br><span class="hljs-attribute">has</span> extension: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„è¿˜æ˜¯ç»å¯¹è·¯å¾„</p><p>ç”¨ <code>is_absolute()</code> æˆå‘˜å‡½æ•°æ£€æŸ¥è·¯å¾„æ˜¯å¦æ˜¯ç»å¯¹è·¯å¾„</p></li><li><p>ä¿®æ”¹æ–‡ä»¶åå’Œæ‰©å±•å</p><p>ç”¨ <code>replace_filename()</code> ä¿®æ”¹æ–‡ä»¶åï¼Œç”¨ <code>remove_filename()</code> åˆ é™¤æ–‡ä»¶åï¼Œç”¨<code>replace_extension()</code> ä¿®æ”¹æ‰©å±•å</p></li><li><p>å°†ç›®å½•åˆ†éš”ç¬¦è½¬æ¢ä¸ºç³»ç»Ÿé¦–é€‰çš„åˆ†éš”ç¬¦</p><p>ç”¨ <code>make_preferred()</code> æˆå‘˜å‡½æ•°å°†ç›®å½•åˆ†éš”ç¬¦è½¬æ¢ä¸ºç³»ç»Ÿé¦–é€‰çš„åˆ†éš”ç¬¦</p></li></ul><h2 id="2-åˆ›å»ºã€å¤åˆ¶å’Œåˆ é™¤æ–‡ä»¶åŠç›®å½•"><a href="#2-åˆ›å»ºã€å¤åˆ¶å’Œåˆ é™¤æ–‡ä»¶åŠç›®å½•" class="headerlink" title="2 åˆ›å»ºã€å¤åˆ¶å’Œåˆ é™¤æ–‡ä»¶åŠç›®å½•"></a>2 åˆ›å»ºã€å¤åˆ¶å’Œåˆ é™¤æ–‡ä»¶åŠç›®å½•</h2><p>filesystemåº“æ”¯æŒå¯¹æ–‡ä»¶çš„æ“ä½œï¼ˆå¦‚å¤åˆ¶ã€ç§»åŠ¨å’Œåˆ é™¤ï¼‰ä»¥åŠå¯¹ç›®å½•çš„æ“ä½œï¼ˆå¦‚åˆ›å»ºã€é‡å‘½åå’Œåˆ é™¤ï¼‰ã€‚</p><ul><li>ä½¿ç”¨ <code>create_directory()</code> åˆ›å»ºæ–°ç›®å½•ã€‚å¦‚æœç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™è¯¥å‡½æ•°ä»€ä¹ˆéƒ½ä¸åšã€‚æ³¨æ„ï¼Œè¯¥æ–¹æ³•ä¸ä¼šé€’å½’çš„åˆ›å»ºç›®å½•</li><li>ä½¿ç”¨ <code>create_directories()</code> é€’å½’çš„åˆ›å»ºæ–°ç›®å½•ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 17</title>
    <link href="/2024/11/03/C-C-Primer-Chapter-17/"/>
    <url>/2024/11/03/C-C-Primer-Chapter-17/</url>
    
    <content type="html"><![CDATA[<h1 id="17-æ ‡å‡†åº“ç‰¹æ®Šè®¾æ–½"><a href="#17-æ ‡å‡†åº“ç‰¹æ®Šè®¾æ–½" class="headerlink" title="17 æ ‡å‡†åº“ç‰¹æ®Šè®¾æ–½"></a>17 æ ‡å‡†åº“ç‰¹æ®Šè®¾æ–½</h1><h2 id="4-éšæœºæ•°"><a href="#4-éšæœºæ•°" class="headerlink" title="4 éšæœºæ•°"></a>4 éšæœºæ•°</h2><p>å®šä¹‰åœ¨å¤´æ–‡ä»¶randomä¸­çš„éšæœºæ•°åº“é€šè¿‡ä¸€ç»„åä½œçš„ç±»æ¥ç”Ÿæˆéšæœºæ•°ï¼š</p><ul><li>éšæœºæ•°å¼•æ“ç±»ï¼ˆrandom-number enginesï¼‰</li><li>éšæœºæ•°åˆ†å¸ƒç±»ï¼ˆrandom-number distributionï¼‰</li></ul><p>ä¸€ä¸ªå¼•æ“ç±»å¯ä»¥ç”Ÿæˆunsignedéšæœºæ•°åºåˆ—ï¼Œä¸€ä¸ªåˆ†å¸ƒç±»ä½¿ç”¨ä¸€ä¸ªå¼•æ“ç±»ç”ŸæˆæŒ‡å®šç±»å‹çš„ã€åœ¨ç»™å®šèŒƒå›´å†…çš„ã€æœä»ç‰¹å®šæ¦‚ç‡åˆ†å¸ƒçš„éšæœºæ•°ã€‚</p><h3 id="4-1-éšæœºæ•°å¼•æ“å’Œåˆ†å¸ƒ"><a href="#4-1-éšæœºæ•°å¼•æ“å’Œåˆ†å¸ƒ" class="headerlink" title="4.1 éšæœºæ•°å¼•æ“å’Œåˆ†å¸ƒ"></a>4.1 éšæœºæ•°å¼•æ“å’Œåˆ†å¸ƒ</h3><p>éšæœºæ•°å¼•æ“æ˜¯å‡½æ•°å¯¹è±¡ç±»ï¼ˆå‚è§14.8èŠ‚ï¼Œç¬¬506é¡µï¼‰ï¼Œå®ƒä»¬å®šä¹‰äº†ä¸€ä¸ªè°ƒç”¨è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦ä¸æ¥å—å‚æ•°å¹¶è¿”å›ä¸€ä¸ªéšæœºunsignedæ•´æ•°ã€‚</p><p>æ ‡å‡†åº“å®šä¹‰äº†å¤šä¸ªéšæœºæ•°å¼•æ“ç±»ï¼ŒåŒºåˆ«åœ¨äºæ€§èƒ½å’Œéšæœºæ€§è´¨é‡ä¸åŒã€‚æ¯ä¸ªç¼–è¯‘å™¨éƒ½ä¼šæŒ‡å®šå…¶ä¸­ä¸€ä¸ªä½œä¸ºdefault_random_engineç±»å‹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-17/image-20241103140024471.png"></p><p>å¯¹äºå¤§å¤šæ•°åœºåˆï¼Œéšæœºæ•°å¼•æ“çš„è¾“å‡ºæ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°ä¹‹ä¸ºåŸå§‹éšæœºæ•°ã€‚é—®é¢˜å‡ºåœ¨ç”Ÿæˆçš„éšæœºæ•°çš„å€¼èŒƒå›´é€šå¸¸ä¸æˆ‘ä»¬éœ€è¦çš„ä¸ç¬¦ï¼Œè€Œæ­£ç¡®è½¬æ¢éšæœºæ•°çš„èŒƒå›´æ˜¯æå…¶å›°éš¾çš„ã€‚</p><p><strong>åˆ†å¸ƒç±»å‹å’Œå¼•æ“</strong></p><p>ä¸ºäº†å¾—åˆ°åœ¨ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„æ•°ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªåˆ†å¸ƒç±»å‹çš„å¯¹è±¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">uniform_int_distribution&lt;<span class="hljs-type">unsigned</span>&gt; <span class="hljs-title">u</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">9</span>)</span></span>;<br>default_random_engine e;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) <br>    cout &lt;&lt; <span class="hljs-built_in">u</span>(e) &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>u(0,0)</code> è¡¨ç¤ºå¸Œæœ›å¾—åˆ°[0,9]ä¹‹é—´çš„æ•°ã€‚</p><p><strong>å¼•æ“ç”Ÿæˆä¸€ä¸ªæ•°å€¼åºåˆ—</strong></p><p>å¯¹äºéšæœºæ•°å‘ç”Ÿå™¨æ¥è¯´ï¼šå³ä½¿ç”Ÿæˆçš„æ•°çœ‹èµ·æ¥æ˜¯éšæœºçš„ï¼Œä½†å¯¹ä¸€ä¸ªç»™å®šçš„å‘ç”Ÿå™¨ï¼Œæ¯æ¬¡è¿è¡Œç¨‹åºå®ƒéƒ½ä¼šè¿”å›ç›¸åŒçš„æ•°å€¼åºåˆ—ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">vector&lt;<span class="hljs-type">unsigned</span>&gt; <span class="hljs-title">bad_randVec</span><span class="hljs-params">()</span> </span>&#123;<br>    default_random_engine e;<br>    <span class="hljs-function">uniform_int_distribution&lt;<span class="hljs-type">unsigned</span>&gt; <span class="hljs-title">u</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">9</span>)</span></span>;<br>    vector&lt;<span class="hljs-type">unsigned</span>&gt; ret;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i) <br>        ret.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">u</span>(e));<br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ç›¸åŒçš„vectorï¼Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p>æ­£ç¡®çš„åšæ³•å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">vector&lt;<span class="hljs-type">unsigned</span>&gt; <span class="hljs-title">good_randVec</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">static</span> default_random_engine e;<br>    <span class="hljs-function"><span class="hljs-type">static</span> uniform_int_distribution&lt;<span class="hljs-type">unsigned</span>&gt; <span class="hljs-title">u</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">9</span>)</span></span>;<br>    vector&lt;<span class="hljs-type">unsigned</span>&gt; ret;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i) <br>        ret.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">u</span>(e));<br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†å¼•æ“å’Œåˆ†å¸ƒå®šä¹‰ä¸ºstaticçš„ï¼Œä½¿å…¶åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´èƒ½å¤Ÿä¿æŒä½çŠ¶æ€ã€‚</p><div class="note note-primary">            <p>ä¸€ä¸ªç»™å®šçš„éšæœºæ•°å‘ç”Ÿå™¨ä¸€ç›´ä¼šç”Ÿæˆç›¸åŒçš„éšæœºæ•°åºåˆ—ã€‚ä¸€ä¸ªå‡½æ•°å¦‚æœå®šä¹‰äº†å±€éƒ¨çš„éšæœºæ•°å‘ç”Ÿå™¨ï¼Œåº”è¯¥å°†å…¶ï¼ˆåŒ…æ‹¬å¼•æ“å’Œåˆ†å¸ƒå¯¹è±¡ï¼‰å®šä¹‰ä¸ºstaticçš„ã€‚å¦åˆ™ï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šç”Ÿæˆç›¸åŒçš„åºåˆ—ã€‚</p>          </div><p><strong>è®¾ç½®éšæœºæ•°å‘ç”Ÿå™¨ç§å­</strong></p><p>æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯è°ƒç”¨ç³»ç»Ÿå‡½æ•°timeã€‚è¿™ä¸ªå‡½æ•°å®šä¹‰åœ¨å¤´æ–‡ä»¶ctimeä¸­ï¼Œå®ƒè¿”å›ä»ä¸€ä¸ªç‰¹å®šæ—¶åˆ»åˆ°å½“å‰ç»è¿‡äº†å¤šå°‘ç§’ã€‚å‡½æ•°timeæ¥å—å•ä¸ªæŒ‡é’ˆå‚æ•°ï¼Œå®ƒæŒ‡å‘ç”¨äºå†™å…¥æ—¶é—´çš„æ•°æ®ç»“æ„ã€‚å¦‚æœæ­¤æŒ‡é’ˆä¸ºç©ºï¼Œåˆ™å‡½æ•°ç®€å•åœ°è¿”å›æ—¶é—´</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">default_random_engine <span class="hljs-title">e</span><span class="hljs-params">(time(<span class="hljs-number">0</span>))</span></span>;<br></code></pre></td></tr></table></figure><p>ç”±äºtimeè¿”å›ä»¥ç§’è®¡çš„æ—¶é—´ï¼Œå› æ­¤è¿™ç§æ–¹å¼åªé€‚ç”¨äºç”Ÿæˆç§å­çš„é—´éš”ä¸ºç§’çº§æˆ–æ›´é•¿çš„åº”ç”¨ã€‚</p><h3 id="4-2-å…¶ä»–éšæœºæ•°åˆ†å¸ƒ"><a href="#4-2-å…¶ä»–éšæœºæ•°åˆ†å¸ƒ" class="headerlink" title="4.2 å…¶ä»–éšæœºæ•°åˆ†å¸ƒ"></a>4.2 å…¶ä»–éšæœºæ•°åˆ†å¸ƒ</h3><p><strong>ç”Ÿæˆéšæœºå®æ•°</strong></p><p>ä½¿ç”¨æ–°æ ‡å‡†åº“è®¾æ–½ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è·å¾—éšæœºæµ®ç‚¹æ•°ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªuniform_real_distributionç±»å‹çš„å¯¹è±¡ï¼Œå¹¶è®©æ ‡å‡†åº“æ¥å¤„ç†ä»éšæœºæ•´æ•°åˆ°éšæœºæµ®ç‚¹æ•°çš„æ˜ å°„ã€‚</p><p><strong>ä½¿ç”¨åˆ†å¸ƒçš„é»˜è®¤ç»“æœç±»å‹</strong></p><p>åˆ†å¸ƒç±»å‹éƒ½æ˜¯æ¨¡æ¿ï¼Œå…·æœ‰å•ä¸€çš„æ¨¡æ¿ç±»å‹å‚æ•°ï¼Œè¡¨ç¤ºåˆ†å¸ƒç”Ÿæˆçš„éšæœºæ•°çš„ç±»å‹ã€‚</p><p>æ¯ä¸ªåˆ†å¸ƒæ¨¡æ¿éƒ½æœ‰ä¸€ä¸ªé»˜è®¤æ¨¡æ¿å®å‚ã€‚ç”Ÿæˆæµ®ç‚¹å€¼çš„åˆ†å¸ƒç±»å‹é»˜è®¤ç”Ÿæˆdoubleå€¼ï¼Œè€Œç”Ÿæˆæ•´å‹å€¼çš„åˆ†å¸ƒé»˜è®¤ç”Ÿæˆintå€¼ã€‚ç”±äºåˆ†å¸ƒç±»å‹åªæœ‰ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œå› æ­¤å½“æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨é»˜è®¤éšæœºæ•°ç±»å‹æ—¶è¦è®°å¾—åœ¨æ¨¡æ¿åä¹‹åä½¿ç”¨ç©ºå°–æ‹¬å·ã€‚</p><p><strong>ç”Ÿæˆéå‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°</strong></p><p>é™¤äº†æ­£ç¡®ç”Ÿæˆåœ¨æŒ‡å®šèŒƒå›´å†…çš„æ•°ä¹‹å¤–ï¼Œæ–°æ ‡å‡†åº“çš„å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å¯ä»¥ç”Ÿæˆéå‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ã€‚å®é™…ä¸Šï¼Œæ–°æ ‡å‡†åº“å®šä¹‰äº†20ç§åˆ†å¸ƒç±»å‹ï¼Œä¾‹å¦‚normal_distributionï¼Œè¯¥åˆ†å¸ƒæ¥å—ä¸€ä¸ªå‡å€¼å’Œæ–¹å·®ã€‚</p><p><strong>bernoulli_distributionç±»</strong></p><p>è¯¥ç±»æ˜¯ä¸€ä¸ªæ™®é€šç±»ï¼Œè€Œä¸æ˜¯æ¨¡æ¿ç±»ã€‚æ­¤åˆ†å¸ƒæ€»æ˜¯è¿”å›ä¸€ä¸ªboolå€¼ã€‚å®ƒè¿”å›trueçš„æ¦‚ç‡æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œæ­¤æ¦‚ç‡çš„é»˜è®¤å€¼æ˜¯0.5ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 14</title>
    <link href="/2024/11/01/OS-Three-Easy-Pieces-Chapter-14/"/>
    <url>/2024/11/01/OS-Three-Easy-Pieces-Chapter-14/</url>
    
    <content type="html"><![CDATA[<h1 id="Interlude-Memory-API"><a href="#Interlude-Memory-API" class="headerlink" title="Interlude: Memory API"></a>Interlude: Memory API</h1><p>æœ¬ç« ä»‹ç»UNIXç³»ç»Ÿä¸­å†…å­˜ç›¸å…³çš„APIã€‚</p><h2 id="1-Types-of-Memory"><a href="#1-Types-of-Memory" class="headerlink" title="1 Types of Memory"></a>1 Types of Memory</h2><p>åœ¨cç¨‹åºä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å†…å­˜</p><ul><li><p>æ ˆå†…å­˜</p><p>æ ˆå†…å­˜ï¼Œä¹Ÿè¢«ç§°ä¸ºè‡ªåŠ¨å­˜å‚¨å†…å­˜ï¼Œç”±ç¼–è¯‘å™¨éšå¼çš„ç”³è¯·å’Œé‡Šæ”¾ã€‚</p></li><li><p>å †å†…å­˜</p><p>ç”±ç¨‹åºå‘˜æ‰‹åŠ¨çš„é€šè¿‡mallocå’Œfreeç”³è¯·å’Œé‡Šæ”¾ã€‚</p></li></ul><h2 id="2-The-malloc-Call"><a href="#2-The-malloc-Call" class="headerlink" title="2 The malloc() Call"></a>2 The <code>malloc()</code> Call</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> *<span class="hljs-title function_">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>;<br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œåœ¨å †ä¸Šç”³è¯·æŒ‡å®šå¤§å°å­—èŠ‚çš„å†…å­˜ï¼Œå¹¶è¿”å›è¯¥å†…å­˜çš„åœ°å€ã€‚å¤±è´¥çš„è¯ï¼Œè¿”å› <code>NULL</code>.</p><p>é€šå¸¸æƒ…å†µä¸‹ä¼šæ­é… <code>sizeof()</code> è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚ä¹‹æ‰€ä»¥æ˜¯è¿ç®—ç¬¦è€Œä¸æ˜¯å‡½æ•°è°ƒç”¨æ˜¯å› ä¸º <code>sizeof()</code> æ±‚å€¼é€šå¸¸å‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œè€Œä¸æ˜¯è¿è¡ŒæœŸã€‚</p><h2 id="3-The-free-Call"><a href="#3-The-free-Call" class="headerlink" title="3 The free() Call"></a>3 The <code>free()</code> Call</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr)</span>;<br></code></pre></td></tr></table></figure><h2 id="4-Underlying-OS-Support"><a href="#4-Underlying-OS-Support" class="headerlink" title="4 Underlying OS Support"></a>4 Underlying OS Support</h2><p>æœ‰ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å«åš <code>brk</code>ï¼Œç”¨äºæ”¹å˜ç¨‹åº<strong>break</strong>çš„ä½ç½®ï¼Œå³å †ï¼ˆheapï¼‰ç»“æŸçš„ä½ç½®ã€‚<code>brk</code> æ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆæ–°çš„breakåœ°å€ï¼‰ï¼Œå¯ä»¥æ ¹æ®æ–°åœ°å€ä¸å½“å‰breakçš„ä½ç½®å…³ç³»æ¥å¢å¤§æˆ–ç¼©å°å †çš„å¤§å°ï¼šå¦‚æœæ–°çš„breakä½ç½®æ¯”å½“å‰çš„ä½ç½®å¤§ï¼Œå †ä¼šæ‰©å±•ï¼›å¦‚æœå°ï¼Œå †ä¼šç¼©å°ã€‚</p><p>å¦ä¸€ä¸ªç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ <code>sbrk</code>ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¢é‡å€¼ä½œä¸ºå‚æ•°ï¼Œç”¨äºåœ¨ç°æœ‰å †çš„åŸºç¡€ä¸Šå¢åŠ æˆ–å‡å°‘ä¸€å®šçš„å†…å­˜å¤§å°ï¼ŒåŠŸèƒ½ä¸ <code>brk</code> ç±»ä¼¼ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>mmap()</code> ç³»ç»Ÿè°ƒç”¨ä»æ“ä½œç³»ç»Ÿè·å–å†…å­˜ã€‚é€šè¿‡ä¼ å…¥åˆé€‚çš„å‚æ•°ï¼Œ<code>mmap()</code> å¯ä»¥åœ¨ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªåŒ¿åå†…å­˜åŒºåŸŸâ€”â€”è¿™ä¸ªåŒºåŸŸä¸ä¸ä»»ä½•ç‰¹å®šæ–‡ä»¶å…³è”ï¼Œè€Œæ˜¯ä¸äº¤æ¢ç©ºé—´ç›¸å…³ã€‚è¿™ç§å†…å­˜åŒºåŸŸä¹Ÿå¯ä»¥åƒå †ä¸€æ ·è¿›è¡Œç®¡ç†å’Œä½¿ç”¨ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥é˜… <code>mmap()</code> çš„æ‰‹å†Œé¡µã€‚</p><h2 id="5-Other-Calls"><a href="#5-Other-Calls" class="headerlink" title="5 Other Calls"></a>5 Other Calls</h2><p><strong><code>calloc()</code></strong></p><p>ç”³è¯·å†…å­˜å¹¶åˆå§‹åŒ–ä¸º0.</p><p><strong><code>realloc()</code></strong></p><p>ä¿®æ”¹æŸç‰‡ç”³è¯·çš„å†…å­˜çš„å¤§å°ï¼Œå¯èƒ½æ¶‰åŠåˆ°å†…å­˜çš„æ‹·è´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 13</title>
    <link href="/2024/11/01/OS-Three-Easy-Pieces-Chapter-13/"/>
    <url>/2024/11/01/OS-Three-Easy-Pieces-Chapter-13/</url>
    
    <content type="html"><![CDATA[<h1 id="The-Abstraction-Address-Spaces"><a href="#The-Abstraction-Address-Spaces" class="headerlink" title="The Abstraction: Address Spaces"></a>The Abstraction: Address Spaces</h1><h2 id="1-Early-Systems"><a href="#1-Early-Systems" class="headerlink" title="1 Early Systems"></a>1 Early Systems</h2><p>ä»å†…å­˜çš„è§’åº¦æ¥çœ‹ï¼Œæ—©æœŸçš„æœºå™¨å¹¶æ²¡æœ‰ä¸ºç”¨æˆ·æä¾›å¤ªå¤šçš„æŠ½è±¡æ¦‚å¿µã€‚åŸºæœ¬ä¸Šï¼Œæ“ä½œç³»ç»Ÿæ˜¯åœ¨å†…å­˜ä¸­çš„ç¨‹åºï¼ˆå®é™…ä¸Šæ˜¯ç¨‹åºåº“ï¼‰ï¼Œè€Œæœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰å½“å‰ä½äºç‰©ç†å†…å­˜ä¸­ï¼Œå¹¶ä½¿ç”¨å†…å­˜çš„å…¶ä½™éƒ¨åˆ†ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-13/image-20241101160330010.png"></p><h2 id="2-The-Address-Space"><a href="#2-The-Address-Space" class="headerlink" title="2 The Address Space"></a>2 The Address Space</h2><p>åœ°å€ç©ºé—´æ˜¯æ“ä½œç³»ç»Ÿæä¾›ç»™ç”¨æˆ·çš„ä¸€ç§æŠ½è±¡ã€‚åœ¨ç”¨æˆ·çœ‹æ¥ï¼Œå®ƒå¯ä»¥ä½¿ç”¨æ•´ä¸ªåœ°å€ç©ºé—´çš„å†…å­˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ°å€ç©ºé—´è‡³å°‘åŒ…æ‹¬ä»£ç ï¼Œå †ï¼Œæ ˆç­‰ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-13/image-20241101161943524.png" alt="ç”¨æˆ·åœ°å€ç©ºé—´"></p><p>ç”±äºæ“ä½œç³»ç»Ÿéœ€è¦åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ç‰©ç†å†…å­˜ï¼Œå› æ­¤å®ƒä¸èƒ½ç›´æ¥ä½¿ç”¨è¿›ç¨‹åœ°å€ç©ºé—´çš„åœ°å€ï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ï¼Œå®ƒéœ€è¦å°†å…¶è½¬æ¢ä¸ºå®é™…çš„ç‰©ç†åœ°å€ï¼Œå³è™šæ‹ŸåŒ–å†…å­˜ã€‚</p><h2 id="3-Goals"><a href="#3-Goals" class="headerlink" title="3 Goals"></a>3 Goals</h2><p>VMç³»ç»Ÿæœ‰å¦‚ä¸‹å‡ ä¸ªç›®æ ‡ï¼š</p><ol><li>transparencyï¼šç¨‹åºä¸åº”è¯¥æ„è¯†åˆ°è™šæ‹Ÿå†…å­˜çš„å­˜åœ¨ï¼Œå®ƒè¡¨ç°çš„åº”è¯¥åƒè‡ªå·±æ‹¥æœ‰å®Œæ•´çš„ç‰©ç†å†…å­˜ä¸€æ ·ã€‚</li><li>efficiencyï¼šæ—¶é—´å’Œç©ºé—´ä¸Šé«˜æ•ˆ</li><li>protectionï¼šæ“ä½œç³»ç»Ÿæœ¬èº«å’Œç”¨æˆ·è¿›ç¨‹ä¸åº”è¯¥å—åˆ°å…¶ä»–è¿›ç¨‹çš„å¹²æ‰°ï¼ˆè¿›ç¨‹ä¸èƒ½è®¿é—®å…¶ä»–è¿›ç¨‹çš„å†…å­˜ï¼‰ã€‚è¿™å¼•å‡ºäº†isolationçš„æ¦‚å¿µï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åº”è¯¥åœ¨è‡ªå·±çš„éš”ç¦»çš„å†…å­˜ä¸­è¿è¡Œã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 10</title>
    <link href="/2024/11/01/OS-Three-Easy-Pieces-Chapter-10/"/>
    <url>/2024/11/01/OS-Three-Easy-Pieces-Chapter-10/</url>
    
    <content type="html"><![CDATA[<h1 id="Multiprocessor-Scheduling-Advanced"><a href="#Multiprocessor-Scheduling-Advanced" class="headerlink" title="Multiprocessor Scheduling (Advanced)"></a>Multiprocessor Scheduling (Advanced)</h1>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 9</title>
    <link href="/2024/11/01/OS-Three-Easy-Pieces-Chapter-9/"/>
    <url>/2024/11/01/OS-Three-Easy-Pieces-Chapter-9/</url>
    
    <content type="html"><![CDATA[<h1 id="Scheduling-Proportional-Share"><a href="#Scheduling-Proportional-Share" class="headerlink" title="Scheduling: Proportional Share"></a>Scheduling: Proportional Share</h1><p>åœ¨æœ¬ç« ä¸­ï¼Œå°†ç ”ç©¶ä¸€ç§ä¸åŒç±»å‹çš„è°ƒåº¦ç¨‹åºï¼Œå³<strong>æ¯”ä¾‹å…±äº«ï¼ˆproportional shareï¼‰</strong>è°ƒåº¦ç¨‹åºï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º<strong>å…¬å¹³å…±äº«ï¼ˆfair-shareï¼‰</strong>è°ƒåº¦ç¨‹åºã€‚æ¯”ä¾‹å…±äº«è°ƒåº¦å™¨åŸºäºä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼šè°ƒåº¦å™¨å¯ä»¥ä¸å¯¹å‘¨è½¬æ—¶é—´æˆ–å“åº”æ—¶é—´è¿›è¡Œä¼˜åŒ–ï¼Œè€Œæ˜¯è®¾æ³•ä¿è¯æ¯ä¸ªä½œä¸šéƒ½èƒ½è·å¾—ä¸€å®šæ¯”ä¾‹çš„ CPU æ—¶é—´ã€‚å…¶<strong>åŸºæœ¬æ€æƒ³</strong>éå¸¸ç®€å•ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ä¸¾è¡Œä¸€æ¬¡æŠ½ç­¾ï¼Œå†³å®šä¸‹ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹ï¼›åº”è¯¥æ›´é¢‘ç¹è¿è¡Œçš„è¿›ç¨‹åº”è¯¥æœ‰æ›´å¤šæœºä¼šä¸­ç­¾ã€‚</p><h2 id="1-Basic-Concept-Tickets-Represent-Your-Share"><a href="#1-Basic-Concept-Tickets-Represent-Your-Share" class="headerlink" title="1 Basic Concept: Tickets Represent Your Share"></a>1 Basic Concept: Tickets Represent Your Share</h2><p>æŠ½ç­¾è°ƒåº¦çš„åŸºç¡€æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„æ¦‚å¿µï¼š<strong>tickets</strong>ï¼Œç”¨æ¥è¡¨ç¤ºè¿›ç¨‹ï¼ˆæˆ–ç”¨æˆ·æˆ–å…¶ä»–ï¼‰åº”è·å¾—çš„èµ„æºä»½é¢ã€‚ä¸€ä¸ªè¿›ç¨‹æ‹¥æœ‰çš„ ticket çš„ç™¾åˆ†æ¯”ä»£è¡¨äº†å®ƒåœ¨ç›¸å…³ç³»ç»Ÿèµ„æºä¸­çš„ä»½é¢ã€‚</p><p>æŠ½ç­¾è°ƒåº¦æ¯éš”ä¸€æ®µæ—¶é—´è¿›è¡Œä¸€æ¬¡æŠ½ç­¾ï¼ŒéšæœºæŠ½ä¸€ä¸ªticketå‡ºæ¥ï¼Œç„¶åè°ƒåº¦æ‹¥æœ‰è¯¥ticketçš„è¿›ç¨‹è¿è¡Œã€‚</p><h2 id="2-Ticket-Mechanisms"><a href="#2-Ticket-Mechanisms" class="headerlink" title="2 Ticket Mechanisms"></a>2 Ticket Mechanisms</h2><p><strong>ticket currency</strong></p><p>è¯¥æœºåˆ¶å…è®¸ç”¨æˆ·æ ¹æ®éœ€è¦ç»™è‡ªå·±çš„ä»»åŠ¡åˆ†é…è´§å¸ï¼Œç„¶åæ“ä½œç³»ç»Ÿæ ¹æ®è¯¥ç”¨æˆ·æ‰€æœ‰çš„ticketä»¥åŠå­ä»»åŠ¡çš„è´§å¸è®¡ç®—å‡ºæ¯ä¸ªå­ä»»åŠ¡çš„ticketsã€‚</p><p>æ¯”å¦‚ï¼Œæœ€å¼€å§‹Aï¼ŒBå„è‡ªæœ‰100ä¸ªtickets</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-9/image-20241101145013205.png"></p><p><strong>ticket transfer</strong></p><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æš‚æ—¶å°†è‡ªå·±çš„ticketsè½¬ç»™å¦å¤–ä¸€ä¸ªè¿›ç¨‹ã€‚è¯¥ç­–ç•¥åœ¨CSæ¨¡å¼ä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p>å½“å®¢æˆ·éœ€è¦æœåŠ¡å™¨å¸®è‡ªå·±å®ŒæˆæŸäº›å·¥ä½œçš„æ—¶å€™ï¼Œä¸€å¹¶å°†è‡ªå·±çš„ticketsè½¬ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å®Œæˆä¹‹åï¼Œå°†ticketså†è½¬å›å®¢æˆ·ã€‚</p><p><strong>ticket inflation</strong></p><p>åœ¨äº’ç›¸ä¿¡ä»»çš„ç¯å¢ƒä¸­ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡å¢åŠ æˆ–å‡å°‘å…¶ticketæ¥é€‚åº”å…¶èµ„æºéœ€æ±‚ã€‚</p><h2 id="3-Implementation"><a href="#3-Implementation" class="headerlink" title="3 Implementation"></a>3 Implementation</h2><p>æŠ½ç­¾è°ƒåº¦æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å…¶å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦ï¼š</p><ol><li>ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨</li><li>ä¸€ä¸ªç»´æŠ¤æ‰€æœ‰è¿›ç¨‹çš„æ•°æ®ç»“æ„</li><li>ticketsæ€»æ•°</li></ol><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-9/image-20241101150058910.png"></p><p>è¦åšå‡ºè°ƒåº¦å†³ç­–ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ä»ticketæ€»æ•°ä¸­éšæœºæŠ½å–ä¸€ä¸ªæ•°å­—ï¼ˆä¸­å¥–è€…ï¼‰ã€‚ç„¶åï¼Œæˆ‘ä»¬åªéœ€éå†åˆ—è¡¨ï¼Œç”¨ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ä¸­å¥–è€…ã€‚ä»£ç ä¼šéå†è¿›ç¨‹åˆ—è¡¨ï¼Œå°†æ¯ä¸ªè¿›ç¨‹çš„ticketsæ·»åŠ åˆ°è®¡æ•°å™¨ä¸­ï¼Œç›´åˆ°è®¡æ•°å™¨è¶…è¿‡ä¸­å¥–è€…ä¸ºæ­¢ã€‚ä¸€æ—¦å‡ºç°è¿™ç§æƒ…å†µï¼Œå½“å‰åˆ—è¡¨ä¸­çš„è¿›ç¨‹å°±æ˜¯ä¸­å¥–è€…ã€‚</p><h2 id="4-How-To-Assign-Tickets"><a href="#4-How-To-Assign-Tickets" class="headerlink" title="4 How To Assign Tickets"></a>4 How To Assign Tickets</h2><p>ä¸€ä¸ªæ–¹æ³•æ˜¯è®¤ä¸ºç”¨æˆ·çŸ¥é“å¦‚ä½•åˆ†é…ã€‚ä½†è¿™å…¶å®å¹¶æ²¡æœ‰è§£å†³å®é™…çš„é—®é¢˜ã€‚</p><h2 id="5-Stride-Scheduling"><a href="#5-Stride-Scheduling" class="headerlink" title="5 Stride Scheduling"></a>5 Stride Scheduling</h2><p>è¯¥ç­–ç•¥æ˜¯ç”¨ä¸€ä¸ªå¾ˆå¤§çš„æ•°é™¤ä»¥æ¯ä¸ªè¿›ç¨‹çš„ticketï¼Œå¾—åˆ°æ¯ä¸ªè¿›ç¨‹çš„strideï¼Œå¹¶ç”¨ä¸€ä¸ªè®¡æ•°å™¨æ¥è®°å½•æ¯ä¸ªè¿›ç¨‹çš„æ‰§è¡Œè¿›åº¦ï¼ˆpassï¼‰ã€‚æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å…¶passå¢åŠ strideã€‚æ¯æ¬¡è°ƒåº¦éƒ½ä¼šé€‰å–passå€¼æœ€å°çš„é‚£ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚</p><p><strong>æŠ½ç­¾è°ƒåº¦çš„ä¼˜åŠ¿</strong></p><p>ç›¸è¾ƒäºstride schedulingï¼ŒæŠ½ç­¾è°ƒåº¦çš„ä¼˜åŠ¿æ˜¯æ²¡æœ‰å…¨å±€çŠ¶æ€ï¼Œå³æ²¡æœ‰passã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ·»åŠ çš„æ—¶å€™ï¼Œå¯¹äºstride schedulingï¼Œæˆ‘ä»¬ä¸èƒ½å°†å…¶passç®€å•çš„è®¾ç½®ä¸º0ï¼Œå¦åˆ™è¯¥æ–°è¿›ç¨‹ä¼šä¸»å®°ç³»ç»Ÿã€‚è€Œå¯¹äºæŠ½ç­¾è°ƒåº¦ï¼Œæˆ‘ä»¬æ— éœ€è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œåªè¦è®¾ç½®å¥½å¯¹åº”çš„ticketså³å¯ã€‚</p><h2 id="6-The-Linux-Completely-Fair-Schedulerï¼ˆCFSï¼‰"><a href="#6-The-Linux-Completely-Fair-Schedulerï¼ˆCFSï¼‰" class="headerlink" title="6 The Linux Completely Fair Schedulerï¼ˆCFSï¼‰"></a>6 The Linux Completely Fair Schedulerï¼ˆCFSï¼‰</h2><p>Linuxçš„CFSè°ƒåº¦å™¨å®ç°äº†å…¬å¹³å…±äº«è°ƒåº¦ï¼Œè€Œä¸”æ˜¯ä»¥é«˜æ•ˆå’Œå¯æ‰©å±•çš„æ–¹å¼å®ç°çš„ã€‚</p><p><strong>Basic Operation</strong></p><p>å¤§å¤šæ•°è°ƒåº¦ç¨‹åºéƒ½åŸºäºå›ºå®šæ—¶é—´ç‰‡çš„æ¦‚å¿µï¼Œè€Œ CFS çš„è¿è¡Œæ–¹å¼åˆ™æœ‰äº›ä¸åŒã€‚å®ƒçš„ç›®æ ‡å¾ˆç®€å•ï¼šåœ¨æ‰€æœ‰ç«äº‰è¿›ç¨‹ä¹‹é—´å…¬å¹³åˆ†é… CPUã€‚å®ƒé€šè¿‡ä¸€ç§ç®€å•çš„åŸºäºè®¡æ•°çš„æŠ€æœ¯æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä¸º<strong>è™šæ‹Ÿè¿è¡Œæ—¶é—´ï¼ˆvruntimeï¼‰</strong>ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹è¿è¡Œæ—¶éƒ½ä¼šç´¯ç§¯ vruntimeã€‚åœ¨æœ€åŸºæœ¬çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ vruntime éƒ½ä»¥ç›¸åŒçš„é€Ÿåº¦å¢é•¿ï¼Œä¸ç‰©ç†ï¼ˆå®é™…ï¼‰æ—¶é—´æˆæ¯”ä¾‹ã€‚åœ¨è¿›è¡Œè°ƒåº¦å†³ç­–æ—¶ï¼ŒCFS ä¼šé€‰æ‹© vruntime æœ€ä½çš„è¿›ç¨‹ä½œä¸ºä¸‹ä¸€ä¸ªè¿è¡Œè¿›ç¨‹ã€‚</p><p>è°ƒåº¦ç¨‹åºå¦‚ä½•çŸ¥é“ä½•æ—¶åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶è¿è¡Œä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Ÿè¿™é‡Œçš„çŸ›ç›¾å¾ˆæ˜æ˜¾ï¼šå¦‚æœ CFS åˆ‡æ¢è¿‡äºé¢‘ç¹ï¼Œå…¬å¹³æ€§ä¼šæé«˜ï¼Œå› ä¸º CFS å°†ç¡®ä¿æ¯ä¸ªè¿›ç¨‹å³ä½¿åœ¨å¾®å°çš„æ—¶é—´çª—å£å†…ä¹Ÿèƒ½è·å¾—å…¶ CPU ä»½é¢ï¼Œä½†ä»£ä»·æ˜¯æ€§èƒ½ä¸‹é™ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡å¤šï¼‰ï¼›å¦‚æœ CFS åˆ‡æ¢é¢‘ç‡è¾ƒä½ï¼Œæ€§èƒ½ä¼šæé«˜ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢å‡å°‘ï¼‰ï¼Œä½†ä»£ä»·æ˜¯è¿‘æœŸå…¬å¹³æ€§ä¸‹é™ã€‚</p><p>CFS é€šè¿‡å„ç§æ§åˆ¶å‚æ•°æ¥å¤„ç†è¿™ç§çŸ›ç›¾ã€‚</p><p>é¦–å…ˆæ˜¯ <code>sched_latency</code>ã€‚CFS ä½¿ç”¨è¯¥å€¼æ¥ç¡®å®šä¸€ä¸ªè¿›ç¨‹åœ¨è€ƒè™‘åˆ‡æ¢å‰åº”è¿è¡Œå¤šé•¿æ—¶é—´ã€‚å…¸å‹çš„è°ƒåº¦å»¶è¿Ÿå€¼ä¸º 48ï¼ˆæ¯«ç§’ï¼‰ï¼›CFS å°†æ­¤å€¼é™¤ä»¥ CPU ä¸Šè¿è¡Œçš„è¿›ç¨‹æ•°ï¼ˆnï¼‰æ¥ç¡®å®šè¿›ç¨‹çš„æ—¶é—´ç‰‡ï¼Œä»è€Œç¡®ä¿åœ¨è¿™æ®µæ—¶é—´å†…ï¼ŒCFS å®Œå…¨å…¬å¹³ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-9/image-20241101152428006.png"></p><p>ä¸Šè¿°æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæœ€å¼€å§‹æœ‰å››ä¸ªè¿›ç¨‹ABCDï¼Œå› æ­¤æœ€å¼€å§‹çš„æ—¶é—´ç‰‡æ˜¯48&#x2F;4 &#x3D; 12msï¼Œä¹‹åCDè¿è¡Œå®Œæ¯•ï¼Œåªå‰©ä¸¤ä¸ªè¿›ç¨‹ABï¼Œæ¯ä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡æ˜¯48&#x2F;2 &#x3D; 12msã€‚</p><p>ä½†æ˜¯ï¼Œå½“è¿›ç¨‹è¿‡å¤šçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´æ¯ä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡è¿‡å¤šï¼Œå¯¼è‡´é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCFSç”¨å¦å¤–ä¸€ä¸ªå‚æ•°æ¥æ§åˆ¶ï¼Œ<code>min_granularity</code> ï¼Œä¸€èˆ¬è®¾ç½®ä¸º6msã€‚CFSæ°¸è¿œä¸ä¼šå°†æ—¶é—´ç‰‡çš„å€¼è®¾ç½®çš„æ¯” <code>min_granularity</code> å°ï¼Œä¿è¯ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä¼šå¤ªè¿‡é¢‘ç¹ã€‚</p><p><strong>Weighting(Niceness)</strong></p><p>CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰è¿˜å…è®¸å¯¹è¿›ç¨‹ä¼˜å…ˆçº§è¿›è¡Œæ§åˆ¶ï¼Œè®©ç”¨æˆ·æˆ–ç®¡ç†å‘˜å¯ä»¥ä¸ºæŸäº›è¿›ç¨‹åˆ†é…æ›´å¤šçš„CPUèµ„æºã€‚è¿™ç§æ§åˆ¶ä¸æ˜¯é€šè¿‡ticketï¼Œè€Œæ˜¯é€šè¿‡UNIXç»å…¸çš„â€œniceâ€æœºåˆ¶æ¥å®ç°çš„ã€‚è¿›ç¨‹çš„niceå‚æ•°èŒƒå›´åœ¨ -20 åˆ° +19 ä¹‹é—´ï¼Œé»˜è®¤å€¼æ˜¯ 0ã€‚æ­£çš„niceå€¼æ„å‘³ç€è¾ƒä½çš„ä¼˜å…ˆçº§ï¼Œè´Ÿçš„niceå€¼åˆ™è¡¨ç¤ºè¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚</p><p>CFSå°†niceå€¼æ˜ å°„åˆ°weightï¼Œå¹¶æ ¹æ®ä¸€ä¸‹å…¬å¼æ¥è®¡ç®—æ¯ä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-9/image-20241101153458916.png"><br>$$<br>time_slice_k &#x3D; \frac{weight_k}{\Sigma_{i &#x3D; 0}^{n - 1}weight_k} Â· sched_latency<br>$$<br>ä¸ºäº†é…åˆæ—¶é—´ç‰‡è®¡ç®—ï¼Œvruntimeçš„è®¡ç®—å…¬å¼ä¹Ÿè¦åšå‡ºç›¸åº”çš„ä¿®æ”¹ï¼Œå…¶ä¸­$weight_0$æ˜¯é»˜è®¤æƒé‡ï¼Œä¸º1024ï¼Œ$runtime_i$æ˜¯æŸä¸ªè¿›ç¨‹çš„å®é™…è¿è¡Œæ—¶é—´ã€‚<br>$$<br>vruntime_i&#x3D;vruntime_i + \frac{weight_0}{weight_i} Â· runtime_i<br>$$<br>ä½¿ç”¨æƒé‡è¡¨çš„è®¾è®¡çš„èªæ˜ä¹‹å¤„åœ¨äºï¼Œå½“è¿›ç¨‹ä¹‹é—´çš„niceå€¼å·®å¼‚ä¿æŒä¸å˜æ—¶ï¼ŒCPUåˆ†é…æ¯”ä¾‹ä¹Ÿèƒ½ä¿æŒä¸å˜ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿ä¸¤ä¸ªè¿›ç¨‹çš„niceå€¼å‘ç”Ÿå˜åŒ–ï¼Œåªè¦å®ƒä»¬ä¹‹é—´çš„å·®å€¼ç›¸åŒï¼Œå®ƒä»¬çš„CPUåˆ†é…æ¯”ä¾‹ä¸ä¼šå˜ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æœ€åˆè¿›ç¨‹Açš„niceå€¼ä¸º0ï¼Œè¿›ç¨‹Bçš„niceå€¼ä¸º5ã€‚åæ¥æˆ‘ä»¬å°†Açš„niceå€¼è°ƒæ•´ä¸º5ï¼ŒBçš„niceå€¼è°ƒæ•´ä¸º10ã€‚è™½ç„¶ä¸¤ä¸ªè¿›ç¨‹çš„niceå€¼éƒ½å˜äº†ï¼Œä½†ç”±äºå®ƒä»¬çš„niceå·®å€¼ä»ç„¶æ˜¯5ï¼ŒCFSä¼šä»¥ä¸ä¹‹å‰ç›¸åŒçš„æ–¹å¼è°ƒåº¦å®ƒä»¬ï¼Œä¿æŒç›¸åŒçš„CPUåˆ†é…æ¯”ä¾‹ã€‚</p><p><strong>Using Red-Black Trees</strong></p><p>CFSä½¿ç”¨çº¢é»‘æ ‘æ¥ç»´æŠ¤æ‰€æœ‰runnableçš„è¿›ç¨‹ï¼ˆå…¶ä»–çŠ¶æ€çš„è¿›ç¨‹ç”±å…¶ä»–æ•°æ®ç»“æ„æ¥ç»´æŠ¤ï¼‰ã€‚è¿™å¯ä»¥ä¿è¯æ¯æ¬¡é€‰å–æœ€å°vruntimeçš„è¿›ç¨‹çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(logn)$ã€‚</p><p>ä¸ºä»€ä¹ˆä¸é€‚ç”¨å°é¡¶å †æ¥ç»´æŠ¤ï¼Ÿ</p><p>å…³äºè¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="https://stackoverflow.com/questions/33191110/reason-why-cfs-scheduler-using-red-black-tree">linux kernel - Reason why CFS scheduler using red black tree? - Stack Overflow</a></p><p><strong>Dealing With I&#x2F;O And Sleeping Process</strong></p><p>åœ¨é€‰æ‹©ä¸‹ä¸€ä¸ªè¿è¡Œçš„æœ€ä½ vruntime æ—¶ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä½œä¸šå·²ç»ä¼‘çœ äº†å¾ˆé•¿æ—¶é—´ã€‚è®¾æƒ³æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼ŒA å’Œ Bï¼Œå…¶ä¸­ä¸€ä¸ªè¿›ç¨‹ï¼ˆAï¼‰æŒç»­è¿è¡Œï¼Œè€Œå¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆBï¼‰å·²ç»ä¼‘çœ äº†å¾ˆé•¿æ—¶é—´ï¼ˆæ¯”å¦‚ 10 ç§’ï¼‰ã€‚å½“ B å”¤é†’æ—¶ï¼Œå®ƒçš„ vruntime å°†æ¯” A æ™š 10 ç§’ï¼Œå› æ­¤ï¼ŒB å°†åœ¨æ¥ä¸‹æ¥çš„ 10 ç§’å†…ç‹¬å  CPUï¼ŒåŒæ—¶èµ¶ä¸Š Aï¼Œè¿™å®é™…ä¸Šä¼šé¥¿æ­» Aã€‚</p><p>å®é™…ä¸Šï¼ŒCFS ä¼šå°†è¯¥ä½œä¸šçš„ vruntime è®¾ç½®ä¸ºåœ¨æ ‘ä¸­æ‰¾åˆ°çš„æœ€å°å€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒCFS é¿å…äº† â€œé¥¥é¥¿â€ï¼Œä½†ä¹Ÿä»˜å‡ºäº†ä»£ä»·ï¼šä½œä¸šå¦‚æœç»å¸¸å¤„äºçŸ­æ—¶é—´ç¡çœ çŠ¶æ€ï¼Œå°±æ— æ³•è·å¾—å…¬å¹³çš„ CPU èµ„æºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 14</title>
    <link href="/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-14/"/>
    <url>/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-14/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼ºæšä¸¾ç±»å‹ï¼ˆC-11C-17-C-20ï¼‰"><a href="#å¼ºæšä¸¾ç±»å‹ï¼ˆC-11C-17-C-20ï¼‰" class="headerlink" title="å¼ºæšä¸¾ç±»å‹ï¼ˆC++11C++17 C++20ï¼‰"></a>å¼ºæšä¸¾ç±»å‹ï¼ˆC++11C++17 C++20ï¼‰</h1><h2 id="1-æšä¸¾ç±»å‹çš„å¼Šç«¯"><a href="#1-æšä¸¾ç±»å‹çš„å¼Šç«¯" class="headerlink" title="1 æšä¸¾ç±»å‹çš„å¼Šç«¯"></a>1 æšä¸¾ç±»å‹çš„å¼Šç«¯</h2><p><strong>ç±»å‹é—®é¢˜</strong></p><p>è™½ç„¶æšä¸¾ç±»å‹å­˜åœ¨ä¸€å®šçš„å®‰å…¨æ£€æŸ¥åŠŸèƒ½ï¼Œä¸€ä¸ªæšä¸¾ç±»å‹ä¸å…è®¸åˆ†é…åˆ°å¦å¤–ä¸€ç§æšä¸¾ç±»å‹ï¼Œè€Œä¸”æ•´å‹ä¹Ÿæ— æ³•éšå¼è½¬æ¢æˆæšä¸¾ç±»å‹ã€‚ä½†æ˜¯æšä¸¾ç±»å‹å´å¯ä»¥éšå¼è½¬æ¢ä¸ºæ•´å‹ï¼Œå› ä¸ºC++æ ‡å‡†æ–‡æ¡£æåˆ°â€œæšä¸¾ç±»å‹å¯ä»¥é‡‡ç”¨æ•´å‹æå‡çš„æ–¹æ³•è½¬æ¢æˆæ•´å‹â€ã€‚</p><p><strong>ä½œç”¨åŸŸé—®é¢˜</strong></p><p>æšä¸¾ç±»å‹ä¼šæŠŠå…¶å†…éƒ¨çš„æšä¸¾æ ‡è¯†ç¬¦å¯¼å‡ºåˆ°æšä¸¾è¢«å®šä¹‰çš„ä½œç”¨åŸŸã€‚ä¹Ÿæ˜¯å°±è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨æšä¸¾æ ‡è¯†ç¬¦çš„æ—¶å€™ï¼Œå¯ä»¥è·³è¿‡å¯¹äºæšä¸¾ç±»å‹çš„æè¿°ã€‚</p><h2 id="2-ä½¿ç”¨å¼ºæšä¸¾ç±»å‹"><a href="#2-ä½¿ç”¨å¼ºæšä¸¾ç±»å‹" class="headerlink" title="2 ä½¿ç”¨å¼ºæšä¸¾ç±»å‹"></a>2 ä½¿ç”¨å¼ºæšä¸¾ç±»å‹</h2><p>C++11å¢åŠ äº†å¼ºæšä¸¾ç±»å‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>æšä¸¾æ ‡è¯†ç¬¦å±äºå¼ºæšä¸¾ç±»å‹çš„ä½œç”¨åŸŸã€‚</li><li>æšä¸¾æ ‡è¯†ç¬¦ä¸ä¼šéšå¼è½¬æ¢ä¸ºæ•´å‹ã€‚</li><li>èƒ½æŒ‡å®šå¼ºæšä¸¾ç±»å‹çš„åº•å±‚ç±»å‹ï¼Œåº•å±‚ç±»å‹é»˜è®¤ä¸ºintç±»å‹ã€‚</li></ul><p>å®šä¹‰è¯­æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æšä¸¾å®šä¹‰çš„enumå…³é”®å­—ä¹‹ååŠ ä¸Šclasså…³é”®å­—å°±å¯ä»¥äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">enum class</span> <span class="hljs-title class_">HighSchool</span> &#123;<br>    student,<br>    teacher,<br>    principal<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¼ºæšä¸¾ç±»å‹ä¸ä»…å®ç°èµ·æ¥éå¸¸ç®€æ´ï¼Œè€Œä¸”è¿˜æ˜¯PODç±»å‹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰ç±»å‹çš„æ—¶å€™ä½¿ç”¨:ç¬¦å·æ¥æŒ‡æ˜å…¶åº•å±‚ç±»å‹ã€‚åˆ©ç”¨å®ƒå¯ä»¥æ¶ˆé™¤ä¸åŒç¼–è¯‘å™¨å¸¦æ¥çš„æ­§ä¹‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">enum class</span> <span class="hljs-title class_">E</span> : <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> &#123;<br>    e1 = <span class="hljs-number">1</span>,<br>    e2 = <span class="hljs-number">2</span>,<br>    e3 = <span class="hljs-number">0xfffffff0</span><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">bool</span> b = e1 &lt; e3;<br>    std::cout &lt;&lt; std::boolalpha &lt;&lt; b &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-åˆ—è¡¨åˆå§‹åŒ–æœ‰åº•å±‚ç±»å‹æšä¸¾å¯¹è±¡"><a href="#3-åˆ—è¡¨åˆå§‹åŒ–æœ‰åº•å±‚ç±»å‹æšä¸¾å¯¹è±¡" class="headerlink" title="3 åˆ—è¡¨åˆå§‹åŒ–æœ‰åº•å±‚ç±»å‹æšä¸¾å¯¹è±¡"></a>3 åˆ—è¡¨åˆå§‹åŒ–æœ‰åº•å±‚ç±»å‹æšä¸¾å¯¹è±¡</h2><p>ä»C++17æ ‡å‡†å¼€å§‹ï¼Œå¯¹æœ‰åº•å±‚ç±»å‹çš„æšä¸¾ç±»å‹å¯¹è±¡å¯ä»¥ç›´æ¥ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">enum class</span> <span class="hljs-title class_">Color</span> &#123;<br>  Red,<br>  Green,<br>  Blue<br>&#125;;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  Color c&#123; <span class="hljs-number">5</span> &#125;;          <span class="hljs-comment">// ç¼–è¯‘æˆåŠŸ</span><br>  Color c1 = <span class="hljs-number">5</span>;          <span class="hljs-comment">// ç¼–è¯‘å¤±è´¥</span><br>  Color c2 = &#123; <span class="hljs-number">5</span> &#125;;      <span class="hljs-comment">// ç¼–è¯‘å¤±è´¥</span><br>  <span class="hljs-function">Color <span class="hljs-title">c3</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span>;           <span class="hljs-comment">// ç¼–è¯‘å¤±è´¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>C++11æ ‡å‡†ä¸­å¯¹å¼ºæšä¸¾ç±»å‹åˆå§‹åŒ–åšäº†ä¸¥æ ¼é™åˆ¶ï¼Œç›®çš„å°±æ˜¯é˜²æ­¢æšä¸¾ç±»å‹çš„æ»¥ç”¨ã€‚å¯æ˜¯C++17åˆæ‰“ç ´äº†è¿™ç§ä¸¥æ ¼çš„é™åˆ¶ï¼ŒåŠ¨æœºæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç°åœ¨å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°æ•´æ•°ç±»å‹ï¼Œè¯¥ç±»å‹å¿…é¡»ä¸¥æ ¼åŒºåˆ«äºå…¶ä»–æ•´å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å¤Ÿå’Œå…¶ä»–æ•´å‹åšéšå¼è½¬æ¢ï¼Œæ˜¾ç„¶ä½¿ç”¨typedefçš„æ–¹æ³•æ˜¯ä¸è¡Œçš„ã€‚å¦å¤–ï¼Œè™½ç„¶é€šè¿‡å®šä¹‰ä¸€ä¸ªç±»çš„æ–¹æ³•å¯ä»¥åˆ°è¾¾è¿™ä¸ªç›®çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•éœ€è¦ç¼–å†™å¤§é‡çš„ä»£ç æ¥é‡è½½è¿ç®—ç¬¦ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªç†æƒ³çš„æ–¹æ¡ˆã€‚æ‰€ä»¥ï¼ŒC++çš„ä¸“å®¶æŠŠç›®å…‰æŠ•å‘äº†æœ‰åº•å±‚ç±»å‹çš„æšä¸¾ç±»å‹ï¼Œå…¶ç‰¹æ€§å‡ ä¹å®Œç¾åœ°ç¬¦åˆä»¥ä¸Šè¦æ±‚ï¼Œé™¤äº†åˆå§‹åŒ–æ•´å‹å€¼çš„æ—¶å€™éœ€è¦ç”¨åˆ°å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚äºæ˜¯ï¼ŒC++17ä¸ºæœ‰åº•å±‚ç±»å‹çš„æšä¸¾ç±»å‹æ”¾å®½äº†åˆå§‹åŒ–çš„é™åˆ¶ï¼Œè®©å…¶æ”¯æŒåˆ—è¡¨åˆå§‹åŒ–ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">enum class</span> <span class="hljs-title class_">Index</span> : <span class="hljs-type">int</span> &#123;&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  Index a&#123; <span class="hljs-number">5</span> &#125;;<br>  Index b&#123; <span class="hljs-number">10</span> &#125;;<br>  <span class="hljs-comment">// a = 12;</span><br>  <span class="hljs-comment">// int c = b;</span><br>  std::cout &lt;&lt; <span class="hljs-string">&quot;a &lt; b is &quot;</span> <br>       &lt;&lt; std::boolalpha <br>       &lt;&lt; (a &lt; b) &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-ä½¿ç”¨usingæ‰“å¼€å¼ºæšä¸¾ç±»å‹"><a href="#4-ä½¿ç”¨usingæ‰“å¼€å¼ºæšä¸¾ç±»å‹" class="headerlink" title="4 ä½¿ç”¨usingæ‰“å¼€å¼ºæšä¸¾ç±»å‹"></a>4 ä½¿ç”¨usingæ‰“å¼€å¼ºæšä¸¾ç±»å‹</h2><p>C++20æ ‡å‡†æ‰©å±•äº†usingåŠŸèƒ½ï¼Œå®ƒå¯ä»¥æ‰“å¼€å¼ºæšä¸¾ç±»å‹çš„å‘½åç©ºé—´ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">ColorToString</span><span class="hljs-params">(Color c)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">switch</span> (c)<br>  &#123;<br>  <span class="hljs-keyword">using</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span>;<br>  <span class="hljs-keyword">case</span> Red: <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Red&quot;</span>;<br>  <span class="hljs-keyword">case</span> Green: <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Green&quot;</span>;<br>  <span class="hljs-keyword">case</span> Blue: <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Blue&quot;</span>;<br>  <span class="hljs-keyword">default</span>:<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;none&quot;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">ColorToString</span><span class="hljs-params">(Color c)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">switch</span> (c)<br>  &#123;<br>  <span class="hljs-keyword">using</span> Color::Red;<br>  <span class="hljs-keyword">case</span> Red: <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Red&quot;</span>;<br>  <span class="hljs-keyword">case</span> Color::Green: <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Green&quot;</span>;<br>  <span class="hljs-keyword">case</span> Color::Blue: <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Blue&quot;</span>;<br>  <span class="hljs-keyword">default</span>:<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;none&quot;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 13</title>
    <link href="/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-13/"/>
    <url>/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-13/</url>
    
    <content type="html"><![CDATA[<h1 id="ç»§æ‰¿æ„é€ å‡½æ•°ï¼ˆC-11ï¼‰"><a href="#ç»§æ‰¿æ„é€ å‡½æ•°ï¼ˆC-11ï¼‰" class="headerlink" title="ç»§æ‰¿æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰"></a>ç»§æ‰¿æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰</h1><h2 id="1-ä½¿ç”¨ç»§æ‰¿æ„é€ å‡½æ•°"><a href="#1-ä½¿ç”¨ç»§æ‰¿æ„é€ å‡½æ•°" class="headerlink" title="1 ä½¿ç”¨ç»§æ‰¿æ„é€ å‡½æ•°"></a>1 ä½¿ç”¨ç»§æ‰¿æ„é€ å‡½æ•°</h2><p>C++ä¸­å¯ä»¥ä½¿ç”¨usingå…³é”®å­—å°†åŸºç±»çš„å‡½æ•°å¼•å…¥æ´¾ç”Ÿç±»</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span> </span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">using</span> Base::foo;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(<span class="hljs-type">char</span>*)</span> </span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  Derived d;<br>  d.<span class="hljs-built_in">foo</span>(<span class="hljs-number">5</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>C++11çš„ç»§æ‰¿æ„é€ å‡½æ•°æ­£æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œå°†usingå…³é”®å­—çš„èƒ½åŠ›è¿›è¡Œäº†æ‰©å±•ï¼Œä½¿å…¶èƒ½å¤Ÿå¼•å…¥åŸºç±»çš„æ„é€ å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Base</span>() : <span class="hljs-built_in">x_</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">y_</span>(<span class="hljs-number">0.</span>) &#123;&#125;;<br>  <span class="hljs-built_in">Base</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">double</span> y) : <span class="hljs-built_in">x_</span>(x), <span class="hljs-built_in">y_</span>(y) &#123;&#125;<br>  <span class="hljs-built_in">Base</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">x_</span>(x), <span class="hljs-built_in">y_</span>(<span class="hljs-number">0.</span>) &#123;&#125;<br>  <span class="hljs-built_in">Base</span>(<span class="hljs-type">double</span> y) : <span class="hljs-built_in">x_</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">y_</span>(y) &#123;&#125;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> x_;<br>  <span class="hljs-type">double</span> y_;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">using</span> Base::Base;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li><p>æ´¾ç”Ÿç±»æ˜¯éšå¼ç»§æ‰¿åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥åªæœ‰åœ¨ç¨‹åºä¸­ä½¿ç”¨äº†è¿™äº›æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºæ´¾ç”Ÿç±»ç”Ÿæˆç»§æ‰¿æ„é€ å‡½æ•°çš„ä»£ç ã€‚</p></li><li><p>æ´¾ç”Ÿç±»ä¸ä¼šç»§æ‰¿åŸºç±»çš„é»˜è®¤æ„é€ å‡½æ•°å’Œå¤åˆ¶æ„é€ å‡½æ•°ã€‚è¿™ä¸€ç‚¹ä¹çœ‹æœ‰äº›å¥‡æ€ªï¼Œä½†ä»”ç»†æƒ³æƒ³ä¹Ÿæ˜¯é¡ºç†æˆç« çš„ã€‚å› ä¸ºåœ¨C++è¯­æ³•è§„åˆ™ä¸­ï¼Œæ‰§è¡Œæ´¾ç”Ÿç±»é»˜è®¤æ„é€ å‡½æ•°ä¹‹å‰ä¸€å®šä¼šå…ˆæ‰§è¡ŒåŸºç±»çš„æ„é€ å‡½æ•°ã€‚åŒæ ·çš„ï¼Œåœ¨æ‰§è¡Œå¤åˆ¶æ„é€ å‡½æ•°ä¹‹å‰ä¹Ÿä¸€å®šä¼šå…ˆæ‰§è¡ŒåŸºç±»çš„å¤åˆ¶æ„é€ å‡½æ•°ã€‚æ‰€ä»¥ç»§æ‰¿åŸºç±»çš„é»˜è®¤æ„é€ å‡½æ•°å’Œé»˜è®¤å¤åˆ¶æ„é€ å‡½æ•°çš„åšæ³•æ˜¯å¤šä½™çš„ï¼Œè¿™é‡Œä¸ä¼šè¿™ä¹ˆåšã€‚</p></li><li><p>ç»§æ‰¿æ„é€ å‡½æ•°ä¸ä¼šå½±å“æ´¾ç”Ÿç±»é»˜è®¤æ„é€ å‡½æ•°çš„éšå¼å£°æ˜ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºç»§æ‰¿åŸºç±»æ„é€ å‡½æ•°çš„æ´¾ç”Ÿç±»ï¼Œç¼–è¯‘å™¨ä¾ç„¶ä¼šä¸ºå…¶è‡ªåŠ¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°çš„ä»£ç ã€‚</p></li><li><p>åœ¨æ´¾ç”Ÿç±»ä¸­å£°æ˜ç­¾åç›¸åŒçš„æ„é€ å‡½æ•°ä¼šç¦æ­¢ç»§æ‰¿ç›¸åº”çš„æ„é€ å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">Base</span>() : <span class="hljs-built_in">x_</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">y_</span>(<span class="hljs-number">0.</span>) &#123;&#125;;<br>  <span class="hljs-built_in">Base</span>(<span class="hljs-type">int</span> x, <span class="hljs-type">double</span> y) : <span class="hljs-built_in">x_</span>(x), <span class="hljs-built_in">y_</span>(y) &#123;&#125;<br>  <span class="hljs-built_in">Base</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">x_</span>(x), <span class="hljs-built_in">y_</span>(<span class="hljs-number">0.</span>) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;Base(int x)&quot;</span> &lt;&lt; std::endl; &#125;<br>  <span class="hljs-built_in">Base</span>(<span class="hljs-type">double</span> y) : <span class="hljs-built_in">x_</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">y_</span>(y) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;Base(double y)&quot;</span> &lt;&lt; std::endl; &#125;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> x_;<br>  <span class="hljs-type">double</span> y_;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-keyword">using</span> Base::Base;<br>  <span class="hljs-built_in">Derived</span>(<span class="hljs-type">int</span> x) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;Derived(int x)&quot;</span> &lt;&lt; std::endl; &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function">Derived <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-number">5</span>)</span></span>;<br>  <span class="hljs-function">Derived <span class="hljs-title">d1</span><span class="hljs-params">(<span class="hljs-number">5.5</span>)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ´¾ç”Ÿç±»Derivedä½¿ç”¨using Base::Baseç»§æ‰¿äº†åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ç”±äºDerivedå®šä¹‰äº†æ„é€ å‡½æ•°Derived(int x)ï¼Œè¯¥å‡½æ•°çš„ç­¾åä¸åŸºç±»çš„æ„é€ å‡½æ•°Base(int x)ç›¸åŒï¼Œå› æ­¤è¿™ä¸ªæ„é€ å‡½æ•°çš„ç»§æ‰¿è¢«ç¦æ­¢äº†ï¼ŒDerived d(5)ä¼šè°ƒç”¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°å¹¶ä¸”è¾“å‡ºâ€Derived(int x)â€ã€‚å¦å¤–ï¼Œè¿™ä¸ªç¦æ­¢åŠ¨ä½œå¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»–ç­¾åçš„æ„é€ å‡½æ•°ï¼ŒDerived d1(5.5)ä¾ç„¶å¯ä»¥æˆåŠŸåœ°ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°è¿›è¡Œæ„é€ åˆå§‹åŒ–ã€‚</p></li><li><p>æ´¾ç”Ÿç±»ç»§æ‰¿å¤šä¸ªç­¾åç›¸åŒçš„æ„é€ å‡½æ•°ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥</p></li><li><p>ç»§æ‰¿æ„é€ å‡½æ•°çš„åŸºç±»æ„é€ å‡½æ•°ä¸èƒ½ä¸ºç§æœ‰</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 12</title>
    <link href="/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-12/"/>
    <url>/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-12/</url>
    
    <content type="html"><![CDATA[<h1 id="å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆC-11ï¼‰"><a href="#å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆC-11ï¼‰" class="headerlink" title="å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰"></a>å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰</h1><h2 id="1-å§”æ‰˜æ„é€ å‡½æ•°"><a href="#1-å§”æ‰˜æ„é€ å‡½æ•°" class="headerlink" title="1 å§”æ‰˜æ„é€ å‡½æ•°"></a>1 å§”æ‰˜æ„é€ å‡½æ•°</h2><p>C++11æ ‡å‡†æ”¯æŒäº†å§”æ‰˜æ„é€ å‡½æ•°ï¼šæŸä¸ªç±»å‹çš„ä¸€ä¸ªæ„é€ å‡½æ•°å¯ä»¥å§”æ‰˜åŒç±»å‹çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°å¯¹å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ã€‚ä¸ºäº†æè¿°æ–¹ä¾¿æˆ‘ä»¬ç§°å‰è€…ä¸ºå§”æ‰˜æ„é€ å‡½æ•°ï¼Œåè€…ä¸ºä»£ç†æ„é€ å‡½æ•°ï¼ˆè‹±æ–‡ç›´è¯‘ä¸ºç›®æ ‡æ„é€ å‡½æ•°ï¼‰ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">X</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">X</span>() : <span class="hljs-built_in">X</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.</span>) &#123;&#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">int</span> a) : <span class="hljs-built_in">X</span>(a, <span class="hljs-number">0.</span>) &#123;&#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">double</span> b) : <span class="hljs-built_in">X</span>(<span class="hljs-number">0</span>, b) &#123;&#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">int</span> a, <span class="hljs-type">double</span> b) : <span class="hljs-built_in">a_</span>(a), <span class="hljs-built_in">b_</span>(b) &#123; <span class="hljs-built_in">CommonInit</span>(); &#125;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CommonInit</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>  <span class="hljs-type">int</span> a_;<br>  <span class="hljs-type">double</span> b_;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œé¡ºåºæ˜¯å…ˆæ‰§è¡Œä»£ç†æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ï¼Œæ¥ç€æ‰§è¡Œä»£ç†æ„é€ å‡½æ•°çš„ä¸»ä½“ï¼ˆä¹Ÿå°±æ˜¯CommonInitå‡½æ•°ï¼‰ï¼Œæœ€åæ‰§è¡Œå§”æ‰˜æ„é€ å‡½æ•°çš„ä¸»ä½“ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>æ¯ä¸ªæ„é€ å‡½æ•°éƒ½å¯ä»¥å§”æ‰˜å¦ä¸€ä¸ªæ„é€ å‡½æ•°ä¸ºä»£ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒæ—¢æ˜¯å§”æ‰˜æ„é€ å‡½æ•°ä¹Ÿæ˜¯ä»£ç†æ„é€ å‡½æ•°</li><li>ä¸è¦é€’å½’å¾ªç¯å§”æ‰˜ï¼è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸ºå¾ªç¯å§”æ‰˜ä¸ä¼šè¢«ç¼–è¯‘å™¨æŠ¥é”™ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿæœªå®šä¹‰è¡Œä¸ºï¼Œæœ€å¸¸è§çš„ç»“æœæ˜¯ç¨‹åºå› æ ˆå†…å­˜ç”¨å°½è€Œå´©æºƒ</li><li>å¦‚æœä¸€ä¸ªæ„é€ å‡½æ•°ä¸ºå§”æ‰˜æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå…¶åˆå§‹åŒ–åˆ—è¡¨é‡Œå°±ä¸èƒ½å¯¹æ•°æ®æˆå‘˜å’ŒåŸºç±»è¿›è¡Œåˆå§‹åŒ–</li><li>å§”æ‰˜æ„é€ å‡½æ•°çš„æ‰§è¡Œé¡ºåºæ˜¯å…ˆæ‰§è¡Œä»£ç†æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ï¼Œç„¶åæ‰§è¡Œä»£ç†æ„é€ å‡½æ•°çš„ä¸»ä½“ï¼Œæœ€åæ‰§è¡Œå§”æ‰˜æ„é€ å‡½æ•°çš„ä¸»ä½“</li><li>å¦‚æœåœ¨ä»£ç†æ„é€ å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå§”æ‰˜æ„é€ å‡½æ•°ä¸»ä½“æŠ›å‡ºäº†å¼‚å¸¸ï¼Œåˆ™è‡ªåŠ¨è°ƒç”¨è¯¥ç±»å‹çš„ææ„å‡½æ•°ã€‚</li></ul><h2 id="2-å§”æ‰˜æ¨¡æ¿æ„é€ å‡½æ•°"><a href="#2-å§”æ‰˜æ¨¡æ¿æ„é€ å‡½æ•°" class="headerlink" title="2 å§”æ‰˜æ¨¡æ¿æ„é€ å‡½æ•°"></a>2 å§”æ‰˜æ¨¡æ¿æ„é€ å‡½æ•°</h2><p>å§”æ‰˜æ¨¡æ¿æ„é€ å‡½æ•°æ˜¯æŒ‡ä¸€ä¸ªæ„é€ å‡½æ•°å°†æ§åˆ¶æƒå§”æ‰˜åˆ°åŒç±»å‹çš„ä¸€ä¸ªæ¨¡æ¿æ„é€ å‡½æ•°ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯ä»£ç†æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ã€‚è¿™æ ·åšçš„æ„ä¹‰åœ¨äºæ³›åŒ–äº†æ„é€ å‡½æ•°ï¼Œå‡å°‘å†—ä½™çš„ä»£ç çš„äº§ç”Ÿã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;deque&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">X</span> &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt; <span class="hljs-title">X</span><span class="hljs-params">(T first, T last)</span> : l_(first, last) &#123;</span> &#125;<br>  std::list&lt;<span class="hljs-type">int</span>&gt; l_;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">X</span>(std::vector&lt;<span class="hljs-type">short</span>&gt;&amp;);<br>  <span class="hljs-built_in">X</span>(std::deque&lt;<span class="hljs-type">int</span>&gt;&amp;);<br>&#125;;<br>X::<span class="hljs-built_in">X</span>(std::vector&lt;<span class="hljs-type">short</span>&gt;&amp; v) : <span class="hljs-built_in">X</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>()) &#123; &#125;<br>X::<span class="hljs-built_in">X</span>(std::deque&lt;<span class="hljs-type">int</span>&gt;&amp; v) : <span class="hljs-built_in">X</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>()) &#123; &#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  std::vector&lt;<span class="hljs-type">short</span>&gt; a&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span> &#125;;<br>  std::deque&lt;<span class="hljs-type">int</span>&gt; b&#123; <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span> &#125;;<br>  <span class="hljs-function">X <span class="hljs-title">x1</span><span class="hljs-params">(a)</span></span>;<br>  <span class="hljs-function">X <span class="hljs-title">x2</span><span class="hljs-params">(b)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-æ•è·å§”æ‰˜æ„é€ å‡½æ•°çš„å¼‚å¸¸"><a href="#3-æ•è·å§”æ‰˜æ„é€ å‡½æ•°çš„å¼‚å¸¸" class="headerlink" title="3 æ•è·å§”æ‰˜æ„é€ å‡½æ•°çš„å¼‚å¸¸"></a>3 æ•è·å§”æ‰˜æ„é€ å‡½æ•°çš„å¼‚å¸¸</h2><p>å½“ä½¿ç”¨Function-try-blockå»æ•è·å§”æ‰˜æ„é€ å‡½æ•°å¼‚å¸¸æ—¶ï¼Œå…¶è¿‡ç¨‹å’Œæ•è·åˆå§‹åŒ–åˆ—è¡¨å¼‚å¸¸å¦‚å‡ºä¸€è¾™ã€‚å¦‚æœä¸€ä¸ªå¼‚å¸¸åœ¨ä»£ç†æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨æˆ–è€…ä¸»ä½“ä¸­è¢«æŠ›å‡ºï¼Œé‚£ä¹ˆå§”æ‰˜æ„é€ å‡½æ•°çš„ä¸»ä½“å°†ä¸å†è¢«æ‰§è¡Œï¼Œä¸ä¹‹ç›¸å¯¹çš„ï¼Œæ§åˆ¶æƒä¼šäº¤åˆ°å¼‚å¸¸æ•è·çš„catchä»£ç å—ä¸­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">X</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">X</span>() <span class="hljs-keyword">try</span> : <span class="hljs-built_in">X</span>(<span class="hljs-number">0</span>) &#123;&#125;<br>  <span class="hljs-built_in">catch</span> (<span class="hljs-type">int</span> e)<br>  &#123;<br>       std::cout &lt;&lt; <span class="hljs-string">&quot;catch: &quot;</span> &lt;&lt; e &lt;&lt; std::endl;<br>       <span class="hljs-keyword">throw</span> <span class="hljs-number">3</span>;<br>  &#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">int</span> a) <span class="hljs-keyword">try</span> : <span class="hljs-built_in">X</span>(a, <span class="hljs-number">0.</span>) &#123;&#125;<br>  <span class="hljs-built_in">catch</span> (<span class="hljs-type">int</span> e)<br>  &#123;<br>       std::cout &lt;&lt; <span class="hljs-string">&quot;catch: &quot;</span> &lt;&lt; e &lt;&lt; std::endl;<br>       <span class="hljs-keyword">throw</span> <span class="hljs-number">2</span>;<br>  &#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">double</span> b) : <span class="hljs-built_in">X</span>(<span class="hljs-number">0</span>, b) &#123;&#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">int</span> a, <span class="hljs-type">double</span> b) : <span class="hljs-built_in">a_</span>(a), <span class="hljs-built_in">b_</span>(b) &#123; <span class="hljs-keyword">throw</span> <span class="hljs-number">1</span>; &#125;<br><span class="hljs-keyword">private</span>:<br>  <span class="hljs-type">int</span> a_;<br>  <span class="hljs-type">double</span> b_;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>       X x;<br>  &#125;<br>  <span class="hljs-built_in">catch</span> (<span class="hljs-type">int</span> e) &#123;<br>       std::cout &lt;&lt; <span class="hljs-string">&quot;catch: &quot;</span> &lt;&lt; e &lt;&lt; std::endl;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">catch</span>: <span class="hljs-number">1</span><br><span class="hljs-keyword">catch</span>: <span class="hljs-number">2</span><br><span class="hljs-keyword">catch</span>: <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h2 id="4-å§”æ‰˜å‚æ•°è¾ƒå°‘çš„æ„é€ å‡½æ•°"><a href="#4-å§”æ‰˜å‚æ•°è¾ƒå°‘çš„æ„é€ å‡½æ•°" class="headerlink" title="4 å§”æ‰˜å‚æ•°è¾ƒå°‘çš„æ„é€ å‡½æ•°"></a>4 å§”æ‰˜å‚æ•°è¾ƒå°‘çš„æ„é€ å‡½æ•°</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å°†å‚æ•°è¾ƒå°‘çš„æ„é€ å‡½æ•°å§”æ‰˜ç»™å‚æ•°è¾ƒå¤šçš„æ„é€ å‡½æ•°ï¼Œå› ä¸ºè¿™æ ·åšçš„è‡ªç”±åº¦æ›´é«˜ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯å®Œå…¨å¦å®šä»å‚æ•°è¾ƒå¤šçš„æ„é€ å‡½æ•°å§”æ‰˜å‚æ•°è¾ƒå°‘çš„æ„é€ å‡½æ•°çš„æ„ä¹‰ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨æ„é€ å‡½æ•°çš„å‚æ•°å¿…é¡»åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨çš„åœºæ™¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 11</title>
    <link href="/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-11/"/>
    <url>/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-11/</url>
    
    <content type="html"><![CDATA[<h1 id="éå—é™è”åˆç±»å‹ï¼ˆC-11ï¼‰"><a href="#éå—é™è”åˆç±»å‹ï¼ˆC-11ï¼‰" class="headerlink" title="éå—é™è”åˆç±»å‹ï¼ˆC++11ï¼‰"></a>éå—é™è”åˆç±»å‹ï¼ˆC++11ï¼‰</h1><h2 id="1-è”åˆç±»å‹åœ¨C-ä¸­çš„å±€é™æ€§"><a href="#1-è”åˆç±»å‹åœ¨C-ä¸­çš„å±€é™æ€§" class="headerlink" title="1 è”åˆç±»å‹åœ¨C++ä¸­çš„å±€é™æ€§"></a>1 è”åˆç±»å‹åœ¨C++ä¸­çš„å±€é™æ€§</h2><p>è¿‡å»çš„C++æ ‡å‡†è§„å®šï¼Œè”åˆç±»å‹çš„æˆå‘˜å˜é‡çš„ç±»å‹ä¸èƒ½æ˜¯ä¸€ä¸ªéå¹³å‡¡ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„æˆå‘˜ç±»å‹ä¸èƒ½æœ‰è‡ªå®šä¹‰æ„é€ å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">union</span> <span class="hljs-title class_">U</span><br>&#123;<br>  <span class="hljs-type">int</span> x1;<br>  <span class="hljs-type">float</span> x2;<br>  std::string x3;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯æ— æ³•é€šè¿‡ç¼–è¯‘çš„ï¼Œå› ä¸ºx3å­˜åœ¨è‡ªå®šä¹‰çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªéå¹³å‡¡ç±»å‹ã€‚</p><h2 id="2-ä½¿ç”¨éå—é™è”åˆç±»å‹"><a href="#2-ä½¿ç”¨éå—é™è”åˆç±»å‹" class="headerlink" title="2 ä½¿ç”¨éå—é™è”åˆç±»å‹"></a>2 ä½¿ç”¨éå—é™è”åˆç±»å‹</h2><p>åœ¨C++11ä¸­è”åˆç±»å‹çš„æˆå‘˜å¯ä»¥æ˜¯é™¤äº†å¼•ç”¨ç±»å‹å¤–çš„æ‰€æœ‰ç±»å‹ã€‚</p><p>åœ¨C++11ä¸­å¦‚æœæœ‰è”åˆç±»å‹ä¸­å­˜åœ¨éå¹³å‡¡ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªè”åˆç±»å‹çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°å°†è¢«éšå¼åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»è‡ªå·±è‡³å°‘æä¾›è”åˆç±»å‹çš„æ„é€ å’Œææ„å‡½æ•°ã€‚</p><p>æ¨èçš„åšæ³•æ˜¯è®©è”åˆç±»å‹çš„æ„é€ å’Œææ„å‡½æ•°ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯ä»€ä¹ˆä¹Ÿä¸åšï¼Œå¹¶ä¸”å°†å…¶æˆå‘˜çš„æ„é€ å’Œææ„å‡½æ•°æ”¾åœ¨éœ€è¦ä½¿ç”¨è”åˆç±»å‹çš„åœ°æ–¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-keyword">union</span> <span class="hljs-title class_">U</span><br>&#123;<br>  <span class="hljs-built_in">U</span>() &#123;&#125;<br>  ~<span class="hljs-built_in">U</span>() &#123;&#125;<br>  <span class="hljs-type">int</span> x1;<br>  <span class="hljs-type">float</span> x2;<br>  std::string x3;<br>  std::vector&lt;<span class="hljs-type">int</span>&gt; x4;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  U u;<br>  <span class="hljs-keyword">new</span>(&amp;u.x3) std::<span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;hello world&quot;</span>); <span class="hljs-comment">// placement newæŠ€å·§</span><br>  std::cout &lt;&lt; u.x3 &lt;&lt; std::endl;<br>  u.x<span class="hljs-number">3.</span>~<span class="hljs-built_in">basic_string</span>();<br><br>  <span class="hljs-keyword">new</span>(&amp;u.x4) std::vector&lt;<span class="hljs-type">int</span>&gt;; <span class="hljs-comment">// placement newæŠ€å·§</span><br>  u.x<span class="hljs-number">4.</span><span class="hljs-built_in">push_back</span>(<span class="hljs-number">58</span>);<br>  std::cout &lt;&lt; u.x4[<span class="hljs-number">0</span>] &lt;&lt; std::endl;<br>  u.x<span class="hljs-number">4.</span>~<span class="hljs-built_in">vector</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>è”åˆç±»å‹çš„é™æ€æˆå‘˜ä¸å±äºè”åˆç±»å‹çš„ä»»ä½•å¯¹è±¡ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯å¯¹è±¡æ„é€ æ—¶è¢«å®šä¹‰çš„ï¼Œä¸èƒ½åœ¨è”åˆç±»å‹å†…éƒ¨åˆå§‹åŒ–ã€‚å®é™…ä¸Šè¿™ä¸€ç‚¹å’Œç±»çš„é™æ€æˆå‘˜å˜é‡æ˜¯ä¸€æ ·çš„ï¼Œå½“ç„¶äº†ï¼Œå®ƒçš„åˆå§‹åŒ–æ–¹æ³•ä¹Ÿå’Œç±»çš„é™æ€æˆå‘˜å˜é‡ç›¸åŒï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">union</span> <span class="hljs-title class_">U</span><br>&#123;<br>  <span class="hljs-type">static</span> <span class="hljs-type">int</span> x1;<br>&#125;;<br><span class="hljs-type">int</span> U::x1 = <span class="hljs-number">42</span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  std::cout &lt;&lt; U::x1 &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 10</title>
    <link href="/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-10/"/>
    <url>/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-10/</url>
    
    <content type="html"><![CDATA[<h1 id="é»˜è®¤å’Œåˆ é™¤å‡½æ•°ï¼ˆC-11ï¼‰"><a href="#é»˜è®¤å’Œåˆ é™¤å‡½æ•°ï¼ˆC-11ï¼‰" class="headerlink" title="é»˜è®¤å’Œåˆ é™¤å‡½æ•°ï¼ˆC++11ï¼‰"></a>é»˜è®¤å’Œåˆ é™¤å‡½æ•°ï¼ˆC++11ï¼‰</h1><h2 id="1-ç±»çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°"><a href="#1-ç±»çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°" class="headerlink" title="1 ç±»çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°"></a>1 ç±»çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°</h2><ul><li>é»˜è®¤æ„é€ å‡½æ•°</li><li>ææ„å‡½æ•°</li><li>å¤åˆ¶æ„é€ å‡½æ•°</li><li>å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°</li><li>ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆC++11æ–°å¢ï¼‰</li><li>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°ï¼ˆC++11æ–°å¢ï¼‰</li></ul><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ol><li>å£°æ˜ä»»ä½•æ„é€ å‡½æ•°éƒ½ä¼šæŠ‘åˆ¶é»˜è®¤æ„é€ å‡½æ•°çš„æ·»åŠ ã€‚</li><li>ä¸€æ—¦ç”¨è‡ªå®šä¹‰æ„é€ å‡½æ•°ä»£æ›¿é»˜è®¤æ„é€ å‡½æ•°ï¼Œç±»å°±å°†è½¬å˜ä¸ºéå¹³å‡¡ç±»å‹ã€‚</li></ol><h2 id="2-æ˜¾ç¤ºé»˜è®¤å’Œæ˜¾ç¤ºåˆ é™¤-C-11"><a href="#2-æ˜¾ç¤ºé»˜è®¤å’Œæ˜¾ç¤ºåˆ é™¤-C-11" class="headerlink" title="2 æ˜¾ç¤ºé»˜è®¤å’Œæ˜¾ç¤ºåˆ é™¤ C++11"></a>2 æ˜¾ç¤ºé»˜è®¤å’Œæ˜¾ç¤ºåˆ é™¤ C++11</h2><p>æ˜¾å¼é»˜è®¤å’Œæ˜¾å¼åˆ é™¤çš„è¯­æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å£°æ˜å‡½æ•°çš„å°¾éƒ¨æ·»åŠ &#x3D;defaultå’Œ&#x3D;deleteï¼Œå®ƒä»¬åˆ†åˆ«æŒ‡ç¤ºç¼–è¯‘å™¨æ·»åŠ ç‰¹æ®Šå‡½æ•°çš„é»˜è®¤ç‰ˆæœ¬ä»¥åŠåˆ é™¤æŒ‡å®šçš„å‡½æ•°ã€‚</p><ul><li>&#x3D;defaultå¯ä»¥æ·»åŠ åˆ°ç±»å†…éƒ¨å‡½æ•°å£°æ˜ï¼Œä¹Ÿå¯ä»¥æ·»åŠ åˆ°ç±»å¤–éƒ¨ã€‚</li><li>&#x3D;deleteä¸&#x3D;defaultä¸åŒï¼Œå®ƒå¿…é¡»æ·»åŠ åœ¨ç±»å†…éƒ¨çš„å‡½æ•°å£°æ˜ä¸­ï¼Œå¦‚æœå°†å…¶æ·»åŠ åˆ°ç±»å¤–éƒ¨ï¼Œé‚£ä¹ˆä¼šå¼•å‘ç¼–è¯‘é”™è¯¯ã€‚</li></ul><h2 id="3-æ˜¾ç¤ºåˆ é™¤çš„å…¶ä»–ç”¨æ³•"><a href="#3-æ˜¾ç¤ºåˆ é™¤çš„å…¶ä»–ç”¨æ³•" class="headerlink" title="3 æ˜¾ç¤ºåˆ é™¤çš„å…¶ä»–ç”¨æ³•"></a>3 æ˜¾ç¤ºåˆ é™¤çš„å…¶ä»–ç”¨æ³•</h2><p>æ˜¾å¼åˆ é™¤ä¸ä»…é€‚ç”¨äºç±»çš„æˆå‘˜å‡½æ•°ï¼Œå¯¹äºæ™®é€šå‡½æ•°åŒæ ·æœ‰æ•ˆã€‚åªä¸è¿‡ç›¸å¯¹äºåº”ç”¨äºæˆå‘˜å‡½æ•°ï¼Œåº”ç”¨äºæ™®é€šå‡½æ•°çš„æ„ä¹‰å°±ä¸å¤§äº†ã€‚</p><p>æ˜¾å¼åˆ é™¤è¿˜å¯ä»¥ç”¨äºç±»çš„newè¿ç®—ç¬¦å’Œç±»ææ„å‡½æ•°ã€‚æ˜¾å¼åˆ é™¤ç‰¹å®šç±»çš„newè¿ç®—ç¬¦å¯ä»¥é˜»æ­¢è¯¥ç±»åœ¨å †ä¸ŠåŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œæ¢å¥è¯è¯´å®ƒå¯ä»¥é™åˆ¶ç±»çš„ä½¿ç”¨è€…åªèƒ½é€šè¿‡è‡ªåŠ¨å˜é‡ã€é™æ€å˜é‡æˆ–è€…å…¨å±€å˜é‡çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ã€‚</p><p>æ˜¾å¼åˆ é™¤ç±»çš„ææ„å‡½æ•°åœ¨æŸç§ç¨‹åº¦ä¸Šå’Œåˆ é™¤newè¿ç®—ç¬¦çš„ç›®çš„æ­£å¥½ç›¸åï¼Œå®ƒé˜»æ­¢ç±»é€šè¿‡è‡ªåŠ¨å˜é‡ã€é™æ€å˜é‡æˆ–è€…å…¨å±€å˜é‡çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯å´å¯ä»¥é€šè¿‡newè¿ç®—ç¬¦åˆ›å»ºå¯¹è±¡ã€‚å½“ç„¶äº†ï¼Œé€šè¿‡newè¿ç®—ç¬¦åˆ›å»ºçš„å¯¹è±¡ä¹Ÿæ— æ³•é€šè¿‡deleteé”€æ¯ã€‚</p><h2 id="4-explicitå’Œ-delete"><a href="#4-explicitå’Œ-delete" class="headerlink" title="4 explicitå’Œ&#x3D;delete"></a>4 explicitå’Œ&#x3D;delete</h2><p>åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸ŠåŒæ—¶ä½¿ç”¨explicitå’Œ&#x3D;deleteæ˜¯ä¸€ä¸ªä¸æ˜æ™ºçš„åšæ³•ï¼Œå®ƒå¸¸å¸¸ä¼šé€ æˆä»£ç è¡Œä¸ºæ··ä¹±éš¾ä»¥ç†è§£ï¼Œåº”å°½é‡é¿å…è¿™æ ·åšã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 9</title>
    <link href="/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-9/"/>
    <url>/2024/11/01/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-9/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆ—è¡¨åˆå§‹åŒ–ï¼ˆC-11-C-20ï¼‰"><a href="#åˆ—è¡¨åˆå§‹åŒ–ï¼ˆC-11-C-20ï¼‰" class="headerlink" title="åˆ—è¡¨åˆå§‹åŒ–ï¼ˆC++11 C++20ï¼‰"></a>åˆ—è¡¨åˆå§‹åŒ–ï¼ˆC++11 C++20ï¼‰</h1><h2 id="1-å›é¡¾å˜é‡åˆå§‹åŒ–"><a href="#1-å›é¡¾å˜é‡åˆå§‹åŒ–" class="headerlink" title="1 å›é¡¾å˜é‡åˆå§‹åŒ–"></a>1 å›é¡¾å˜é‡åˆå§‹åŒ–</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç§°ä½¿ç”¨æ‹¬å·åˆå§‹åŒ–çš„æ–¹å¼å«ä½œç›´æ¥åˆå§‹åŒ–ï¼Œè€Œä½¿ç”¨ç­‰å·åˆå§‹åŒ–çš„æ–¹å¼å«ä½œæ‹·è´åˆå§‹åŒ–ï¼ˆå¤åˆ¶åˆå§‹åŒ–ï¼‰ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨ç­‰å·å¯¹å˜é‡åˆå§‹åŒ–å¹¶ä¸æ˜¯è°ƒç”¨ç­‰å·è¿ç®—ç¬¦çš„èµ‹å€¼æ“ä½œã€‚å®é™…æƒ…å†µæ˜¯ï¼Œç­‰å·æ˜¯æ‹·è´åˆå§‹åŒ–ï¼Œ<strong>è°ƒç”¨çš„ä¾ç„¶æ˜¯ç›´æ¥åˆå§‹åŒ–å¯¹åº”çš„æ„é€ å‡½æ•°</strong>ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯éšå¼è°ƒç”¨è€Œå·²ã€‚</p><h2 id="2-ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–-C-11"><a href="#2-ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–-C-11" class="headerlink" title="2 ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ– C++11"></a>2 ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ– C++11</h2><p>C++11æ ‡å‡†å¼•å…¥äº†åˆ—è¡¨åˆå§‹åŒ–ï¼Œå®ƒä½¿ç”¨å¤§æ‹¬å·{}å¯¹å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå’Œä¼ ç»Ÿå˜é‡åˆå§‹åŒ–çš„è§„åˆ™ä¸€æ ·ï¼Œå®ƒä¹ŸåŒºåˆ†ä¸ºç›´æ¥åˆå§‹åŒ–å’Œæ‹·è´åˆå§‹åŒ–ã€‚å®ƒæ”¯æŒéšå¼è°ƒç”¨å¤šå‚æ•°çš„æ„é€ å‡½æ•°ã€‚å¦‚æœä¸å¸Œæœ›è¿›è¡Œéšå¼è½¬æ¢ï¼Œéœ€è¦åœ¨ç‰¹å®šçš„æ„é€ å‡½æ•°ä¸Šå£°æ˜explicitã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">C</span> &#123;<br>  <span class="hljs-built_in">C</span>(std::string a, <span class="hljs-type">int</span> b) &#123;&#125;<br>  <span class="hljs-built_in">C</span>(<span class="hljs-type">int</span> a) &#123;&#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(C)</span> </span>&#123;&#125;<br><span class="hljs-function">C <span class="hljs-title">bar</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;world&quot;</span>, <span class="hljs-number">5</span>&#125;;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> x = &#123;<span class="hljs-number">5</span>&#125;;         <span class="hljs-comment">// æ‹·è´åˆå§‹åŒ–</span><br>  <span class="hljs-type">int</span> x1&#123;<span class="hljs-number">8</span>&#125;;           <span class="hljs-comment">// ç›´æ¥åˆå§‹åŒ–</span><br>  C x2 = &#123;<span class="hljs-number">4</span>&#125;;          <span class="hljs-comment">// æ‹·è´åˆå§‹åŒ–</span><br>  C x3&#123;<span class="hljs-number">2</span>&#125;;             <span class="hljs-comment">// ç›´æ¥åˆå§‹åŒ–</span><br>  <span class="hljs-built_in">foo</span>(&#123;<span class="hljs-number">8</span>&#125;);            <span class="hljs-comment">// æ‹·è´åˆå§‹åŒ–</span><br>  <span class="hljs-built_in">foo</span>(&#123;<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-number">8</span>&#125;);   <span class="hljs-comment">// æ‹·è´åˆå§‹åŒ–</span><br>  C x4 = <span class="hljs-built_in">bar</span>();        <span class="hljs-comment">// æ‹·è´åˆå§‹åŒ–</span><br>  C *x5 = <span class="hljs-keyword">new</span> C&#123; <span class="hljs-string">&quot;hi&quot;</span>, <span class="hljs-number">42</span> &#125;;  <span class="hljs-comment">// ç›´æ¥åˆå§‹åŒ–</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-std-initializer-listè¯¦è§£"><a href="#3-std-initializer-listè¯¦è§£" class="headerlink" title="3 std::initializer_listè¯¦è§£"></a>3 std::initializer_listè¯¦è§£</h2><p>æ ‡å‡†å®¹å™¨ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ”¯æŒåˆ—è¡¨åˆå§‹åŒ–ï¼Œç¦»ä¸å¼€ç¼–è¯‘å™¨æ”¯æŒçš„åŒæ—¶ï¼Œå®ƒä»¬è‡ªå·±ä¹Ÿå¿…é¡»æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼šæ”¯æŒstd::initializer_listä¸ºå½¢å‚çš„æ„é€ å‡½æ•°ã€‚</p><p>std::initializer_listç®€å•åœ°è¯´å°±æ˜¯ä¸€ä¸ªæ”¯æŒbeginã€endä»¥åŠsizeæˆå‘˜å‡½æ•°çš„ç±»æ¨¡æ¿ã€‚ç¼–è¯‘å™¨è´Ÿè´£å°†åˆ—è¡¨é‡Œçš„å…ƒç´ ï¼ˆå¤§æ‹¬å·åŒ…å«çš„å†…å®¹ï¼‰æ„é€ ä¸ºä¸€ä¸ªstd::initializer_listçš„å¯¹è±¡ï¼Œç„¶åå¯»æ‰¾æ ‡å‡†å®¹å™¨ä¸­æ”¯æŒstd:: initializer_listä¸ºå½¢å‚çš„æ„é€ å‡½æ•°å¹¶è°ƒç”¨å®ƒã€‚æ ‡å‡†å®¹å™¨çš„æ„é€ å‡½æ•°åªéœ€è¦è°ƒç”¨std::initializer_listå¯¹è±¡çš„beginå’Œendå‡½æ•°ï¼Œåœ¨å¾ªç¯ä¸­å¯¹æœ¬å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>std:: initializer_listçš„beginå’Œendå‡½æ•°å¹¶ä¸æ˜¯è¿”å›çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªå¸¸é‡å¯¹è±¡æŒ‡é’ˆconst T *ã€‚</p><h2 id="4-ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–çš„æ³¨æ„äº‹é¡¹"><a href="#4-ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="4 ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–çš„æ³¨æ„äº‹é¡¹"></a>4 ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–çš„æ³¨æ„äº‹é¡¹</h2><h3 id="4-1-éšå¼ç¼©çª„è½¬æ¢é—®é¢˜"><a href="#4-1-éšå¼ç¼©çª„è½¬æ¢é—®é¢˜" class="headerlink" title="4.1 éšå¼ç¼©çª„è½¬æ¢é—®é¢˜"></a>4.1 éšå¼ç¼©çª„è½¬æ¢é—®é¢˜</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">int</span> x = <span class="hljs-number">12345</span>;<br><span class="hljs-type">char</span> y = x;<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­å˜é‡yçš„åˆå§‹åŒ–æ˜æ˜¾æ˜¯ä¸€ä¸ªéšå¼ç¼©çª„è½¬æ¢ï¼Œè¿™åœ¨ä¼ ç»Ÿå˜é‡åˆå§‹åŒ–ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä»£ç èƒ½é¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚ä½†æ˜¯å¦‚æœé‡‡ç”¨åˆ—è¡¨åˆå§‹åŒ–ï¼Œæ¯”å¦‚char z{ x }ï¼Œæ ¹æ®æ ‡å‡†ç¼–è¯‘å™¨é€šå¸¸ä¼šç»™å‡ºä¸€ä¸ªé”™è¯¯ï¼ŒMSVCå’ŒCLangå°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œè€ŒGCCæœ‰äº›ä¸åŒï¼Œå®ƒåªæ˜¯ç»™å‡ºäº†è­¦å‘Šã€‚</p><p>C++ä¸­çš„éšå¼ç¼©çª„è½¬æ¢ï¼š</p><ul><li>ä»æµ®ç‚¹ç±»å‹è½¬æ¢æ•´æ•°ç±»å‹ã€‚</li><li>ä»long doubleè½¬æ¢åˆ°doubleæˆ–floatï¼Œæˆ–ä»doubleè½¬æ¢åˆ°floatï¼Œé™¤éè½¬æ¢æºæ˜¯å¸¸é‡è¡¨è¾¾å¼ä»¥åŠè½¬æ¢åçš„å®é™…å€¼åœ¨ç›®æ ‡å¯ä»¥è¡¨ç¤ºçš„å€¼èŒƒå›´å†…ã€‚</li><li>ä»æ•´æ•°ç±»å‹æˆ–éå¼ºæšä¸¾ç±»å‹è½¬æ¢åˆ°æµ®ç‚¹ç±»å‹ï¼Œé™¤éè½¬æ¢æºæ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œè½¬æ¢åçš„å®é™…å€¼é€‚åˆç›®æ ‡ç±»å‹å¹¶ä¸”èƒ½å¤Ÿå°†ç”Ÿæˆç›®æ ‡ç±»å‹çš„ç›®æ ‡å€¼è½¬æ¢å›åŸå§‹ç±»å‹çš„åŸå§‹å€¼ã€‚</li><li>ä»æ•´æ•°ç±»å‹æˆ–éå¼ºæšä¸¾ç±»å‹è½¬æ¢åˆ°ä¸èƒ½ä»£è¡¨æ‰€æœ‰åŸå§‹ç±»å‹å€¼çš„æ•´æ•°ç±»å‹ï¼Œé™¤éæºæ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œå…¶å€¼åœ¨è½¬æ¢ä¹‹åèƒ½å¤Ÿé€‚åˆç›®æ ‡ç±»å‹ã€‚</li></ul><h3 id="4-2-åˆ—è¡¨åˆå§‹åŒ–çš„ä¼˜å…ˆçº§é—®é¢˜"><a href="#4-2-åˆ—è¡¨åˆå§‹åŒ–çš„ä¼˜å…ˆçº§é—®é¢˜" class="headerlink" title="4.2 åˆ—è¡¨åˆå§‹åŒ–çš„ä¼˜å…ˆçº§é—®é¢˜"></a>4.2 åˆ—è¡¨åˆå§‹åŒ–çš„ä¼˜å…ˆçº§é—®é¢˜</h3><p>å¦‚æœæœ‰ä¸€ä¸ªç±»åŒæ—¶æ‹¥æœ‰æ»¡è¶³åˆ—è¡¨åˆå§‹åŒ–çš„æ„é€ å‡½æ•°ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ˜¯ä»¥std::initializer_listä¸ºå‚æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°†ä¼˜å…ˆä»¥std::initializer_ listä¸ºå‚æ•°æ„é€ å‡½æ•°ã€‚</p><h2 id="5-æŒ‡å®šåˆå§‹åŒ–-C-20"><a href="#5-æŒ‡å®šåˆå§‹åŒ–-C-20" class="headerlink" title="5 æŒ‡å®šåˆå§‹åŒ– C++20"></a>5 æŒ‡å®šåˆå§‹åŒ– C++20</h2><p>ä¸ºäº†æé«˜æ•°æ®æˆå‘˜åˆå§‹åŒ–çš„å¯è¯»æ€§å’Œçµæ´»æ€§ï¼ŒC++20æ ‡å‡†ä¸­å¼•å…¥äº†æŒ‡å®šåˆå§‹åŒ–çš„ç‰¹æ€§ã€‚è¯¥ç‰¹æ€§å…è®¸æŒ‡å®šåˆå§‹åŒ–æ•°æ®æˆå‘˜çš„åç§°ï¼Œä»è€Œä½¿ä»£ç æ„å›¾æ›´åŠ æ˜ç¡®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point3D</span> &#123;<br>  <span class="hljs-type">int</span> x;<br>  <span class="hljs-type">int</span> y;<br>  <span class="hljs-type">int</span> z;<br>&#125;;<br><br>Point3D p&#123; .z = <span class="hljs-number">3</span> &#125;;    <span class="hljs-comment">// x = 0, y = 0</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ol><li>å®ƒè¦æ±‚å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªèšåˆç±»å‹</li><li>æŒ‡å®šçš„æ•°æ®æˆå‘˜å¿…é¡»æ˜¯éé™æ€æ•°æ®æˆå‘˜</li><li>æ¯ä¸ªéé™æ€æ•°æ®æˆå‘˜æœ€å¤šåªèƒ½åˆå§‹åŒ–ä¸€æ¬¡</li><li>éé™æ€æ•°æ®æˆå‘˜çš„åˆå§‹åŒ–å¿…é¡»æŒ‰ç…§å£°æ˜çš„é¡ºåºè¿›è¡Œ</li><li>é’ˆå¯¹è”åˆä½“ä¸­çš„æ•°æ®æˆå‘˜åªèƒ½åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®š</li><li>ä¸èƒ½åµŒå¥—æŒ‡å®šåˆå§‹åŒ–æ•°æ®æˆå‘˜</li><li>åœ¨C++20ä¸­ï¼Œä¸€æ—¦ä½¿ç”¨æŒ‡å®šåˆå§‹åŒ–ï¼Œå°±ä¸èƒ½æ··ç”¨å…¶ä»–æ–¹æ³•å¯¹æ•°æ®æˆå‘˜åˆå§‹åŒ–äº†</li></ol>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[RL]åŸºæœ¬æ¦‚å¿µ</title>
    <link href="/2024/10/31/RL-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
    <url>/2024/10/31/RL-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><h3 id="çŠ¶æ€ï¼ˆstateï¼‰"><a href="#çŠ¶æ€ï¼ˆstateï¼‰" class="headerlink" title="çŠ¶æ€ï¼ˆstateï¼‰"></a>çŠ¶æ€ï¼ˆstateï¼‰</h3><p>æ™ºèƒ½ä½“ï¼ˆagentï¼‰ç›¸å¯¹äºç¯å¢ƒçš„çŠ¶å†µï¼ˆstatusï¼‰</p><p><img src="/../images/RL-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/image-20241031181655935.png"></p><p>å¯¹äºç½‘æ ¼ä¸–ç•Œçš„ä¾‹å­ï¼Œæ™ºèƒ½ä½“çš„ä½ç½®å°±æ˜¯çŠ¶æ€ã€‚</p><p><strong>çŠ¶æ€ç©ºé—´ï¼š</strong>æ‰€æœ‰çŠ¶æ€çš„é›†åˆ $S &#x3D; {s_i}_{i &#x3D; 1}^9$</p><h3 id="åŠ¨ä½œï¼ˆactionï¼‰"><a href="#åŠ¨ä½œï¼ˆactionï¼‰" class="headerlink" title="åŠ¨ä½œï¼ˆactionï¼‰"></a>åŠ¨ä½œï¼ˆactionï¼‰</h3><p>å¯¹äºæ¯ä¸ªçŠ¶æ€ï¼Œå¯ä»¥é‡‡å–çš„è¡ŒåŠ¨ã€‚</p><p><strong>çŠ¶æ€çš„åŠ¨ä½œç©ºé—´</strong></p>]]></content>
    
    
    <categories>
      
      <category>å¼ºåŒ–å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>RL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 8</title>
    <link href="/2024/10/31/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-8/"/>
    <url>/2024/10/31/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-8/</url>
    
    <content type="html"><![CDATA[<h1 id="éé™æ€æ•°æ®æˆå‘˜é»˜è®¤åˆå§‹åŒ–ï¼ˆC-11-C-20ï¼‰"><a href="#éé™æ€æ•°æ®æˆå‘˜é»˜è®¤åˆå§‹åŒ–ï¼ˆC-11-C-20ï¼‰" class="headerlink" title="éé™æ€æ•°æ®æˆå‘˜é»˜è®¤åˆå§‹åŒ–ï¼ˆC++11 C++20ï¼‰"></a>éé™æ€æ•°æ®æˆå‘˜é»˜è®¤åˆå§‹åŒ–ï¼ˆC++11 C++20ï¼‰</h1><h2 id="1-ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–"><a href="#1-ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–" class="headerlink" title="1 ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–"></a>1 ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–</h2><p>åœ¨C++11ä»¥å‰ï¼Œå¯¹éé™æ€æ•°æ®æˆå‘˜åˆå§‹åŒ–éœ€è¦ç”¨åˆ°åˆå§‹åŒ–åˆ—è¡¨ï¼Œå½“ç±»çš„æ•°æ®æˆå‘˜å’Œæ„é€ å‡½æ•°è¾ƒå¤šæ—¶ï¼Œç¼–å†™æ„é€ å‡½æ•°å¾ˆç—›è‹¦ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼ŒC++11æ ‡å‡†æå‡ºäº†æ–°çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå³åœ¨å£°æ˜éé™æ€æ•°æ®æˆå‘˜çš„åŒæ—¶ç›´æ¥å¯¹å…¶ä½¿ç”¨&#x3D;æˆ–è€…{}ï¼ˆè§ç¬¬9ç« ï¼‰åˆå§‹åŒ–ã€‚åœ¨æ­¤ä¹‹å‰åªæœ‰ç±»å‹ä¸ºæ•´å‹æˆ–è€…æšä¸¾ç±»å‹çš„å¸¸é‡é™æ€æ•°æ®æˆå‘˜æ‰æœ‰è¿™ç§å£°æ˜é»˜è®¤åˆå§‹åŒ–çš„å¾…é‡ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>ä¸è¦ä½¿ç”¨æ‹¬å·()å¯¹éé™æ€æ•°æ®æˆå‘˜è¿›è¡Œåˆå§‹åŒ–ï¼Œå› ä¸ºè¿™æ ·ä¼šé€ æˆè§£æé—®é¢˜ï¼Œæ‰€ä»¥ä¼šç¼–è¯‘é”™è¯¯ã€‚</li><li>ä¸è¦ç”¨autoæ¥å£°æ˜å’Œåˆå§‹åŒ–éé™æ€æ•°æ®æˆå‘˜ã€‚</li></ul><h2 id="2-ä½åŸŸçš„é»˜è®¤åˆå§‹åŒ–ï¼ˆåç»­å†çœ‹ï¼‰"><a href="#2-ä½åŸŸçš„é»˜è®¤åˆå§‹åŒ–ï¼ˆåç»­å†çœ‹ï¼‰" class="headerlink" title="2 ä½åŸŸçš„é»˜è®¤åˆå§‹åŒ–ï¼ˆåç»­å†çœ‹ï¼‰"></a>2 ä½åŸŸçš„é»˜è®¤åˆå§‹åŒ–ï¼ˆåç»­å†çœ‹ï¼‰</h2><p>åœ¨C++11æ ‡å‡†æå‡ºéé™æ€æ•°æ®æˆå‘˜é»˜è®¤åˆå§‹åŒ–æ–¹æ³•ä¹‹åï¼ŒC++20æ ‡å‡†åˆå¯¹è¯¥ç‰¹æ€§åšäº†è¿›ä¸€æ­¥æ‰©å……ã€‚åœ¨C++20ä¸­æˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®æˆå‘˜çš„ä½åŸŸè¿›è¡Œé»˜è®¤åˆå§‹åŒ–äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span>  <span class="hljs-title class_">S</span> &#123;<br>  <span class="hljs-type">int</span> y : <span class="hljs-number">8</span> = <span class="hljs-number">11</span>;<br>  <span class="hljs-type">int</span> z : <span class="hljs-number">4</span> &#123;<span class="hljs-number">7</span>&#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>intæ•°æ®çš„ä½8ä½è¢«åˆå§‹åŒ–ä¸º11ï¼Œç´§è·Ÿå®ƒçš„é«˜4ä½è¢«åˆå§‹åŒ–ä¸º7ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 7</title>
    <link href="/2024/10/31/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-7/"/>
    <url>/2024/10/31/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-7/</url>
    
    <content type="html"><![CDATA[<h1 id="lambdaè¡¨è¾¾å¼ï¼ˆC-11ï½C-20ï¼‰"><a href="#lambdaè¡¨è¾¾å¼ï¼ˆC-11ï½C-20ï¼‰" class="headerlink" title="lambdaè¡¨è¾¾å¼ï¼ˆC++11ï½C++20ï¼‰"></a>lambdaè¡¨è¾¾å¼ï¼ˆC++11ï½C++20ï¼‰</h1><h2 id="1-lambdaè¡¨è¾¾å¼è¯­æ³•"><a href="#1-lambdaè¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="1 lambdaè¡¨è¾¾å¼è¯­æ³•"></a>1 lambdaè¡¨è¾¾å¼è¯­æ³•</h2><p>è¯­æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">[ captures ] ( params ) specifiers exception -&gt; ret &#123; body &#125;<br></code></pre></td></tr></table></figure><ul><li>[ captures ] â€”â€” æ•è·åˆ—è¡¨ï¼Œå®ƒå¯ä»¥æ•è·å½“å‰å‡½æ•°ä½œç”¨åŸŸçš„é›¶ä¸ªæˆ–å¤šä¸ªå˜é‡ï¼Œå˜é‡ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚æ•è·åˆ—è¡¨çš„æ•è·æ–¹å¼æœ‰ä¸¤ç§ï¼šæŒ‰å€¼æ•è·å’Œå¼•ç”¨æ•è·ã€‚</li><li>( params ) â€”â€” å¯é€‰å‚æ•°åˆ—è¡¨ï¼Œè¯­æ³•å’Œæ™®é€šå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸€æ ·ï¼Œåœ¨ä¸éœ€è¦å‚æ•°çš„æ—¶å€™å¯ä»¥å¿½ç•¥å‚æ•°åˆ—è¡¨ã€‚</li><li>specifiers â€”â€” å¯é€‰é™å®šç¬¦ï¼ŒC++11ä¸­å¯ä»¥ç”¨mutableï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨lambdaè¡¨è¾¾å¼å‡½æ•°ä½“å†…æ”¹å˜æŒ‰å€¼æ•è·çš„å˜é‡ï¼Œæˆ–è€…è°ƒç”¨éconstçš„æˆå‘˜å‡½æ•°ã€‚</li><li>exception â€”â€” å¯é€‰å¼‚å¸¸è¯´æ˜ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨noexceptæ¥æŒ‡æ˜lambdaæ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li><li>ret â€”â€” å¯é€‰è¿”å›å€¼ç±»å‹ï¼Œä¸åŒäºæ™®é€šå‡½æ•°ï¼Œlambdaè¡¨è¾¾å¼ä½¿ç”¨è¿”å›ç±»å‹åç½®çš„è¯­æ³•æ¥è¡¨ç¤ºè¿”å›ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼ˆvoidç±»å‹ï¼‰ï¼Œå¯ä»¥å¿½ç•¥åŒ…æ‹¬-&gt;åœ¨å†…çš„æ•´ä¸ªéƒ¨åˆ†ã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æœ‰è¿”å›å€¼çš„æƒ…å†µä¸‹ä¸æŒ‡å®šè¿”å›ç±»å‹ï¼Œè¿™æ—¶ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æ¨å¯¼å‡ºä¸€ä¸ªè¿”å›ç±»å‹ã€‚</li><li>{ body } â€”â€” lambdaè¡¨è¾¾å¼çš„å‡½æ•°ä½“ï¼Œè¿™ä¸ªéƒ¨åˆ†å’Œæ™®é€šå‡½æ•°çš„å‡½æ•°ä½“ä¸€æ ·ã€‚</li></ul><h2 id="2-æ•è·åˆ—è¡¨"><a href="#2-æ•è·åˆ—è¡¨" class="headerlink" title="2 æ•è·åˆ—è¡¨"></a>2 æ•è·åˆ—è¡¨</h2><h3 id="2-1-ä½œç”¨åŸŸ"><a href="#2-1-ä½œç”¨åŸŸ" class="headerlink" title="2.1 ä½œç”¨åŸŸ"></a>2.1 ä½œç”¨åŸŸ</h3><p>æ•è·åˆ—è¡¨ä¸­çš„å˜é‡å­˜åœ¨äºä¸¤ä¸ªä½œç”¨åŸŸ</p><ul><li>lambdaè¡¨è¾¾å¼å®šä¹‰çš„å‡½æ•°ä½œç”¨åŸŸ</li><li>lambdaè¡¨è¾¾å¼å‡½æ•°ä½“çš„ä½œç”¨åŸŸã€‚</li></ul><p>å‰è€…æ˜¯ä¸ºäº†æ•è·å˜é‡ï¼Œåè€…æ˜¯ä¸ºäº†ä½¿ç”¨å˜é‡ã€‚</p><p>æ ‡å‡†è§„å®šèƒ½æ•è·çš„å˜é‡å¿…é¡»æ˜¯ä¸€ä¸ª<strong>è‡ªåŠ¨å­˜å‚¨ç±»å‹</strong>ã€‚ç®€å•æ¥è¯´å°±æ˜¯<strong>éé™æ€çš„å±€éƒ¨å˜é‡</strong>ã€‚</p><p>å¦‚æœæƒ³ä½¿ç”¨å…¨å±€å˜é‡æˆ–è€…å±€éƒ¨é™æ€å˜é‡ï¼Œç›´æ¥ä½¿ç”¨å°±å¯ä»¥ï¼Œæ— éœ€æ•è·ã€‚</p><h3 id="2-2-æ•è·å€¼å’Œæ•è·å¼•ç”¨"><a href="#2-2-æ•è·å€¼å’Œæ•è·å¼•ç”¨" class="headerlink" title="2.2 æ•è·å€¼å’Œæ•è·å¼•ç”¨"></a>2.2 æ•è·å€¼å’Œæ•è·å¼•ç”¨</h3><p><strong>æ•è·å€¼</strong></p><p>ç›´æ¥åœ¨æ•è·åˆ—è¡¨ä¸­å†™å…¥å˜é‡åå³å¯ï¼Œå¤šä¸ªå˜é‡ç”¨é€—å·åˆ†éš”ã€‚</p><p>æ•è·å€¼æ˜¯å°†å‡½æ•°ä½œç”¨åŸŸçš„xå’Œyçš„å€¼å¤åˆ¶åˆ°lambdaè¡¨è¾¾å¼å¯¹è±¡çš„å†…éƒ¨ï¼Œå°±å¦‚åŒlambdaè¡¨è¾¾å¼çš„æˆå‘˜å˜é‡ä¸€æ ·ã€‚</p><p><strong>æ•è·å¼•ç”¨</strong></p><p>æ•è·å¼•ç”¨çš„è¯­æ³•ä¸æ•è·å€¼åªæœ‰ä¸€ä¸ª&amp;çš„åŒºåˆ«ï¼Œè¦è¡¨è¾¾æ•è·å¼•ç”¨æˆ‘ä»¬åªéœ€è¦åœ¨æ•è·å˜é‡ä¹‹å‰åŠ ä¸Š&amp;ã€‚</p><p><strong>æ”¹å˜æ•è·å€¼</strong></p><p>lambdaè¡¨è¾¾å¼æ•è·çš„å˜é‡é»˜è®¤ä¸ºå¸¸é‡ï¼Œæˆ–è€…è¯´lambdaæ˜¯ä¸€ä¸ªå¸¸é‡å‡½æ•°ï¼ˆç±»ä¼¼äºå¸¸é‡æˆå‘˜å‡½æ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œå€¼æ•è·çš„å˜é‡æ— æ³•åœ¨lambdaè¡¨è¾¾å¼å†…éƒ¨ä¿®æ”¹ï¼Œè€Œå¼•ç”¨æ•è·çš„å˜é‡å¯ä»¥ä¿®æ”¹ï¼ˆè¿™æ˜¯å› ä¸ºä¿®æ”¹å¼•ç”¨æ•è·çš„å˜é‡ï¼Œå®é™…æ˜¯ä¿®æ”¹å¼•ç”¨ç»‘å®šçš„å˜é‡ï¼Œè€Œå¼•ç”¨æœ¬èº«å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼‰ã€‚</p><p>ä¸ºäº†ä¿®æ”¹å€¼æ•è·çš„å˜é‡ï¼Œéœ€è¦ç”¨åˆ° <code>mutable</code> è¯´æ˜ç¬¦ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bar3</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> x = <span class="hljs-number">5</span>, y = <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">auto</span> foo = [x, y] () <span class="hljs-keyword">mutable</span> &#123;<br>        x += <span class="hljs-number">1</span>;<br>        y += <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">return</span> x * y;<br>    &#125;;<br>    std::cout &lt;&lt; <span class="hljs-built_in">foo</span>() &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>å€¼æ•è·çš„å˜é‡æ˜¯åŸæœ¬å˜é‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä¿®æ”¹ä¸ä¼šå½±å“åŸæœ¬çš„å˜é‡ï¼Œä½†æ˜¯å¼•ç”¨æ•è·çš„å˜é‡ä¼šå½±å“åŸæœ¬çš„å˜é‡ã€‚</li><li>åœ¨lambdaè¡¨è¾¾å¼å†…éƒ¨ä¿®æ”¹æŸä¸ªæŒ‰å€¼æ•è·çš„å˜é‡ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨lambdaè¡¨è¾¾å¼é€ æˆçš„ä¿®æ”¹ï¼Œéƒ½ä¼šå½±å“ä¸‹ä¸€æ¬¡çš„è°ƒç”¨ã€‚</li><li>æ•è·å€¼çš„å˜é‡åœ¨lambdaè¡¨è¾¾å¼å®šä¹‰çš„æ—¶å€™å·²ç»å›ºå®šä¸‹æ¥äº†ï¼Œæ— è®ºå‡½æ•°åœ¨lambdaè¡¨è¾¾å¼å®šä¹‰åå¦‚ä½•ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ï¼Œlambdaè¡¨è¾¾å¼æ•è·çš„å€¼éƒ½ä¸ä¼šå˜åŒ–</li></ul><h3 id="2-3-ç‰¹æ®Šçš„æ•è·æ–¹æ³•"><a href="#2-3-ç‰¹æ®Šçš„æ•è·æ–¹æ³•" class="headerlink" title="2.3 ç‰¹æ®Šçš„æ•è·æ–¹æ³•"></a>2.3 ç‰¹æ®Šçš„æ•è·æ–¹æ³•</h3><p>lambdaè¡¨è¾¾å¼çš„æ•è·åˆ—è¡¨é™¤äº†æŒ‡å®šæ•è·å˜é‡ä¹‹å¤–è¿˜æœ‰3ç§ç‰¹æ®Šçš„æ•è·æ–¹æ³•</p><ul><li>[this] â€”â€” æ•è·thisæŒ‡é’ˆï¼Œæ•è·thisæŒ‡é’ˆå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨thisç±»å‹çš„æˆå‘˜å˜é‡å’Œå‡½æ•°ã€‚</li><li>[&#x3D;] â€”â€” æ•è·lambdaè¡¨è¾¾å¼å®šä¹‰ä½œç”¨åŸŸçš„å…¨éƒ¨å˜é‡çš„å€¼ï¼ŒåŒ…æ‹¬thisã€‚</li><li>[&amp;] â€”â€” æ•è·lambdaè¡¨è¾¾å¼å®šä¹‰ä½œç”¨åŸŸçš„å…¨éƒ¨å˜é‡çš„å¼•ç”¨ï¼ŒåŒ…æ‹¬thisã€‚</li></ul><h2 id="3-lambdaè¡¨è¾¾å¼çš„å®ç°åŸç†"><a href="#3-lambdaè¡¨è¾¾å¼çš„å®ç°åŸç†" class="headerlink" title="3 lambdaè¡¨è¾¾å¼çš„å®ç°åŸç†"></a>3 lambdaè¡¨è¾¾å¼çš„å®ç°åŸç†</h2><p>åœ¨C++11æ ‡å‡†ä¸­ï¼Œlambdaè¡¨è¾¾å¼çš„ä¼˜åŠ¿åœ¨äºä¹¦å†™ç®€å•æ–¹ä¾¿ä¸”æ˜“äºç»´æŠ¤ï¼Œè€Œå‡½æ•°å¯¹è±¡çš„ä¼˜åŠ¿åœ¨äºä½¿ç”¨æ›´åŠ çµæ´»ä¸å—é™åˆ¶ï¼Œä½†æ€»çš„æ¥è¯´å®ƒä»¬éå¸¸ç›¸ä¼¼ã€‚å®é™…ä¸Šè¿™ä¹Ÿæ­£æ˜¯lambdaè¡¨è¾¾å¼çš„å®ç°åŸç†ã€‚</p><p>lambdaè¡¨è¾¾å¼åœ¨ç¼–è¯‘æœŸä¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé—­åŒ…ç±»ï¼Œåœ¨è¿è¡Œæ—¶ç”±è¿™ä¸ªé—­åŒ…ç±»äº§ç”Ÿä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºé—­åŒ…ã€‚åœ¨C++ä¸­ï¼Œæ‰€è°“çš„é—­åŒ…å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ªåŒ¿åä¸”å¯ä»¥åŒ…å«å®šä¹‰æ—¶ä½œç”¨åŸŸä¸Šä¸‹æ–‡çš„å‡½æ•°å¯¹è±¡ã€‚</p><h2 id="4-æ— çŠ¶æ€lambdaè¡¨è¾¾å¼"><a href="#4-æ— çŠ¶æ€lambdaè¡¨è¾¾å¼" class="headerlink" title="4 æ— çŠ¶æ€lambdaè¡¨è¾¾å¼"></a>4 æ— çŠ¶æ€lambdaè¡¨è¾¾å¼</h2><p>C++æ ‡å‡†å¯¹äºæ— çŠ¶æ€çš„lambdaè¡¨è¾¾å¼æœ‰ç€ç‰¹æ®Šçš„ç…§é¡¾ï¼Œå³å®ƒå¯ä»¥éšå¼è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">void</span>(*)())</span> </span>&#123;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">g</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-built_in">f</span>([] &#123;&#125;); &#125; <span class="hljs-comment">// ç¼–è¯‘æˆåŠŸ</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">void</span>(&amp;)())</span> </span>&#123;&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">g</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-built_in">f</span>(*[] &#123;&#125;); &#125;<br></code></pre></td></tr></table></figure><h2 id="5-åœ¨STLä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼"><a href="#5-åœ¨STLä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼" class="headerlink" title="5 åœ¨STLä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼"></a>5 åœ¨STLä¸­ä½¿ç”¨lambdaè¡¨è¾¾å¼</h2><p>STLä¸­å¸¸å¸¸ä¼šè§åˆ°è¿™æ ·ä¸€äº›ç®—æ³•å‡½æ•°ï¼Œå®ƒä»¬çš„å½¢å‚éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆæˆ–å‡½æ•°å¯¹è±¡ä»è€Œå®Œæˆæ•´ä¸ªç®—æ³•ï¼Œä¾‹å¦‚std::sortã€std::find_ifç­‰ã€‚</p><p>ä½¿ç”¨lambdaè¡¨è¾¾å¼ç›´æ¥åœ¨ä¼ å‚æ—¶å®šä¹‰äº†è¾…åŠ©å‡½æ•°ã€‚æ— è®ºæ˜¯ç¼–å†™è¿˜æ˜¯é˜…è¯»ä»£ç ï¼Œç›´æ¥å®šä¹‰lambdaè¡¨è¾¾å¼éƒ½æ¯”å®šä¹‰è¾…åŠ©å‡½æ•°æ›´åŠ ç®€æ´ä¸”å®¹æ˜“ç†è§£ã€‚</p><h2 id="6-å¹¿ä¹‰æ•è·-C-14-ï¼ˆåç»­å†çœ‹ï¼‰"><a href="#6-å¹¿ä¹‰æ•è·-C-14-ï¼ˆåç»­å†çœ‹ï¼‰" class="headerlink" title="6 å¹¿ä¹‰æ•è· C++14 ï¼ˆåç»­å†çœ‹ï¼‰"></a>6 å¹¿ä¹‰æ•è· C++14 ï¼ˆåç»­å†çœ‹ï¼‰</h2><p>C++14æ ‡å‡†ä¸­å®šä¹‰äº†å¹¿ä¹‰æ•è·ï¼Œæ‰€è°“å¹¿ä¹‰æ•è·å®é™…ä¸Šæ˜¯ä¸¤ç§æ•è·æ–¹å¼ï¼Œ</p><ol><li><p>ç®€å•æ•è·ï¼Œè¿™ç§æ•è·å°±æ˜¯å‰æ–‡ä¸­æåˆ°çš„æ•è·æ–¹æ³•ï¼Œå³[identifier]ã€[&amp;identifier]ä»¥åŠ[this]ç­‰ã€‚</p></li><li><p>åˆå§‹åŒ–æ•è·ï¼Œè¿™ç§æ•è·æ–¹å¼æ˜¯åœ¨C++14æ ‡å‡†ä¸­å¼•å…¥çš„ï¼Œå®ƒè§£å†³äº†ç®€å•æ•è·çš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œå³åªèƒ½æ•è·lambdaè¡¨è¾¾å¼å®šä¹‰ä¸Šä¸‹æ–‡çš„å˜é‡ï¼Œè€Œæ— æ³•æ•è·è¡¨è¾¾å¼ç»“æœä»¥åŠè‡ªå®šä¹‰æ•è·å˜é‡åï¼Œæ¯”å¦‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> x = <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">auto</span> foo = [r = x + <span class="hljs-number">1</span>]&#123; <span class="hljs-keyword">return</span> r; &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>åˆå§‹åŒ–æ•è·åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸å®ç”¨çš„</p><ol><li><p>ä½¿ç”¨ç§»åŠ¨æ“ä½œå‡å°‘ä»£ç è¿è¡Œçš„å¼€é”€ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    std::string x = <span class="hljs-string">&quot;hello c++ &quot;</span>;<br>    <span class="hljs-keyword">auto</span> foo = [x = std::<span class="hljs-built_in">move</span>(x)]&#123; <span class="hljs-keyword">return</span> x + <span class="hljs-string">&quot;world&quot;</span>; &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨å¼‚æ­¥è°ƒç”¨æ—¶å¤åˆ¶thiså¯¹è±¡ï¼Œé˜²æ­¢lambdaè¡¨è¾¾å¼è¢«è°ƒç”¨æ—¶å› åŸå§‹thiså¯¹è±¡è¢«ææ„é€ æˆæœªå®šä¹‰çš„è¡Œä¸ºï¼Œæ¯”å¦‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Work</span><br>&#123;<br>  <span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> value;<br><br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Work</span>() : <span class="hljs-built_in">value</span>(<span class="hljs-number">42</span>) &#123;&#125;<br>    <span class="hljs-function">std::future&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">spawn</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">async</span>([=, tmp = *<span class="hljs-keyword">this</span>]() -&gt; <span class="hljs-type">int</span> &#123; <span class="hljs-keyword">return</span> tmp.value; &#125;);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ol><h2 id="7-æ³›å‹lambdaè¡¨è¾¾å¼-C-14"><a href="#7-æ³›å‹lambdaè¡¨è¾¾å¼-C-14" class="headerlink" title="7 æ³›å‹lambdaè¡¨è¾¾å¼ C++14"></a>7 æ³›å‹lambdaè¡¨è¾¾å¼ C++14</h2><p>C++14æ ‡å‡†è®©lambdaè¡¨è¾¾å¼å…·å¤‡äº†æ¨¡ç‰ˆå‡½æ•°çš„èƒ½åŠ›ï¼Œå³<strong>æ³›å‹lambdaè¡¨è¾¾å¼</strong>ã€‚æ³›å‹lambdaè¡¨è¾¾å¼è¯­æ³•åªéœ€è¦ä½¿ç”¨autoå ä½ç¬¦å³å¯ï¼Œä¾‹å¦‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> foo = [](<span class="hljs-keyword">auto</span> a) &#123; <span class="hljs-keyword">return</span> a; &#125;;<br>    <span class="hljs-type">int</span> three = <span class="hljs-built_in">foo</span>(<span class="hljs-number">3</span>);<br>    <span class="hljs-type">char</span> <span class="hljs-type">const</span>* hello = <span class="hljs-built_in">foo</span>(<span class="hljs-string">&quot;hello&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="8-å¸¸é‡lambdaè¡¨è¾¾å¼å’Œæ•è·-this-C-17"><a href="#8-å¸¸é‡lambdaè¡¨è¾¾å¼å’Œæ•è·-this-C-17" class="headerlink" title="8 å¸¸é‡lambdaè¡¨è¾¾å¼å’Œæ•è·*this C++17"></a>8 å¸¸é‡lambdaè¡¨è¾¾å¼å’Œæ•è·*this C++17</h2><p>C++17æ ‡å‡†å¯¹lambdaè¡¨è¾¾å¼åŒæ ·æœ‰ä¸¤å¤„å¢å¼º</p><ul><li><p>å¸¸é‡lambdaè¡¨è¾¾å¼</p></li><li><p>å¯¹æ•è·*thisçš„å¢å¼ºã€‚</p><p><code>[*this]</code> çš„è¯­æ³•è®©ç¨‹åºç”Ÿæˆäº†ä¸€ä¸ª*thiså¯¹è±¡çš„å‰¯æœ¬å¹¶å­˜å‚¨åœ¨lambdaè¡¨è¾¾å¼å†…ï¼Œå¯ä»¥åœ¨lambdaè¡¨è¾¾å¼å†…ç›´æ¥è®¿é—®è¿™ä¸ªå¤åˆ¶å¯¹è±¡çš„æˆå‘˜ï¼Œæ¶ˆé™¤äº†ä¹‹å‰lambdaè¡¨è¾¾å¼éœ€è¦é€šè¿‡tmpè®¿é—®å¯¹è±¡æˆå‘˜çš„å°´å°¬ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Work</span><br>&#123;<br>  <span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> value;<br><br>  <span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Work</span>() : <span class="hljs-built_in">value</span>(<span class="hljs-number">42</span>) &#123;&#125;<br>    <span class="hljs-function">std::future&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">spawn</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">async</span>([=, *<span class="hljs-keyword">this</span>]() -&gt; <span class="hljs-type">int</span> &#123; <span class="hljs-keyword">return</span> value; &#125;);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ul><h2 id="9-æ•è·-this-C-20"><a href="#9-æ•è·-this-C-20" class="headerlink" title="9 æ•è·[&#x3D;, this] C++20"></a>9 æ•è·[&#x3D;, this] C++20</h2><p>[&#x3D;] å¯ä»¥æ•è·thisæŒ‡é’ˆï¼Œç›¸ä¼¼çš„ï¼Œ<code>[=,*this]</code> ä¼šæ•è·thiså¯¹è±¡çš„å‰¯æœ¬ã€‚ä½†æ˜¯åœ¨ä»£ç ä¸­å¤§é‡å‡ºç°[&#x3D;]å’Œ <code>[=,*this]</code> çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½å¾ˆå®¹æ˜“å¿˜è®°å‰è€…ä¸åè€…çš„åŒºåˆ«ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨C++20æ ‡å‡†ä¸­å¼•å…¥äº†[&#x3D;, this]æ•è·thisæŒ‡é’ˆçš„è¯­æ³•ï¼Œå®ƒå®é™…ä¸Šè¡¨è¾¾çš„æ„æ€å’Œ[&#x3D;]ç›¸åŒï¼Œç›®çš„æ˜¯è®©ç¨‹åºå‘˜ä»¬åŒºåˆ†å®ƒä¸ <code>[=,*this]</code> çš„ä¸åŒ</p><p>åœ¨C++20æ ‡å‡†ä¸­è¿˜ç‰¹åˆ«å¼ºè°ƒäº†è¦ç”¨[&#x3D;, this]ä»£æ›¿[&#x3D;]</p><p>åŒæ—¶ç”¨ä¸¤ç§è¯­æ³•æ•è·thisæŒ‡é’ˆæ˜¯ä¸å…è®¸çš„ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">[<span class="hljs-keyword">this</span>, *<span class="hljs-keyword">this</span>]&#123;&#125;;<br></code></pre></td></tr></table></figure><h2 id="10-æ¨¡æ¿è¯­æ³•çš„æ³›å‹lambdaè¡¨è¾¾å¼-C-20"><a href="#10-æ¨¡æ¿è¯­æ³•çš„æ³›å‹lambdaè¡¨è¾¾å¼-C-20" class="headerlink" title="10 æ¨¡æ¿è¯­æ³•çš„æ³›å‹lambdaè¡¨è¾¾å¼ C++20"></a>10 æ¨¡æ¿è¯­æ³•çš„æ³›å‹lambdaè¡¨è¾¾å¼ C++20</h2><p>C++20ä¸­æ·»åŠ æ¨¡æ¿å¯¹lambdaçš„æ”¯æŒï¼Œè¯­æ³•éå¸¸ç®€å•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++">[]&lt;<span class="hljs-keyword">typename</span> T&gt;(T t) &#123;&#125;<br><br><span class="hljs-keyword">auto</span> f = []&lt;<span class="hljs-keyword">typename</span> T&gt;(std::vector&lt;T&gt; vector) &#123;<br><span class="hljs-comment">// â€¦</span><br>&#125;;<br><br><span class="hljs-keyword">auto</span> f = []&lt;<span class="hljs-keyword">typename</span> T&gt;(T <span class="hljs-type">const</span>&amp; x) &#123;<br>T copy = x;<br><span class="hljs-keyword">using</span> Iterator = <span class="hljs-keyword">typename</span> T::iterator;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="11-å¯æ„é€ å’Œå¯èµ‹å€¼çš„æ— çŠ¶æ€lambdaè¡¨è¾¾å¼-C-20"><a href="#11-å¯æ„é€ å’Œå¯èµ‹å€¼çš„æ— çŠ¶æ€lambdaè¡¨è¾¾å¼-C-20" class="headerlink" title="11 å¯æ„é€ å’Œå¯èµ‹å€¼çš„æ— çŠ¶æ€lambdaè¡¨è¾¾å¼ C++20"></a>11 å¯æ„é€ å’Œå¯èµ‹å€¼çš„æ— çŠ¶æ€lambdaè¡¨è¾¾å¼ C++20</h2><p>åœ¨C++20æ ‡å‡†ä¹‹å‰æ— çŠ¶æ€çš„lambdaè¡¨è¾¾å¼ç±»å‹æ—¢ä¸èƒ½æ„é€ ä¹Ÿæ— æ³•èµ‹å€¼ï¼Œè¿™é˜»ç¢äº†è®¸å¤šåº”ç”¨çš„å®ç°ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†åƒstd::sortå’Œstd::find_ifè¿™æ ·çš„å‡½æ•°éœ€è¦ä¸€ä¸ªå‡½æ•°å¯¹è±¡æˆ–å‡½æ•°æŒ‡é’ˆæ¥è¾…åŠ©æ’åºå’ŒæŸ¥æ‰¾ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼å®Œæˆä»»åŠ¡ã€‚ä½†æ˜¯å¦‚æœé‡åˆ°std::mapè¿™ç§å®¹å™¨ç±»å‹å°±ä¸å¥½åŠäº†ï¼Œå› ä¸ºstd::mapçš„æ¯”è¾ƒå‡½æ•°å¯¹è±¡æ˜¯é€šè¿‡æ¨¡æ¿å‚æ•°ç¡®å®šçš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªç±»å‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> greater = [](<span class="hljs-keyword">auto</span> x, <span class="hljs-keyword">auto</span> y) &#123; <span class="hljs-keyword">return</span> x &gt; y; &#125;;<br>std::map&lt;std::string, <span class="hljs-type">int</span>, <span class="hljs-keyword">decltype</span>(greater)&gt; mymap;<br><br><span class="hljs-keyword">auto</span> greater = [](<span class="hljs-keyword">auto</span> x, <span class="hljs-keyword">auto</span> y) &#123; <span class="hljs-keyword">return</span> x &gt; y; &#125;;<br>std::map&lt;std::string, <span class="hljs-type">int</span>, <span class="hljs-keyword">decltype</span>(greater)&gt; mymap1, mymap2;<br>mymap1 = mymap2;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åœ¨C++17ä¸­ä¸å¯è¡Œï¼Œå› ä¸ºlambdaè¡¨è¾¾å¼ç±»å‹æ— æ³•æ„é€ ä¹Ÿæ— æ³•èµ‹å€¼ã€‚</p><p>åœ¨C++17ä¸­è¦æƒ³è®©ä¸Šè¿°ä»£ç é€šè¿‡ç¼–è¯‘ï¼Œéœ€è¦æ˜ç¡®çš„å°†greaterå¯¹è±¡ä¼ é€’ç»™mymap</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> greater = [](<span class="hljs-keyword">auto</span> x, <span class="hljs-keyword">auto</span> y) &#123; <span class="hljs-keyword">return</span> x &gt; y; &#125;;<br><span class="hljs-function">std::map&lt;std::string, <span class="hljs-type">int</span>, <span class="hljs-title">decltype</span><span class="hljs-params">(greater)</span>&gt; <span class="hljs-title">mymap</span><span class="hljs-params">(greater)</span></span>;<br></code></pre></td></tr></table></figure><p>C++20æ ‡å‡†å…è®¸äº†æ— çŠ¶æ€lambdaè¡¨è¾¾å¼ç±»å‹çš„æ„é€ å’Œèµ‹å€¼ï¼Œæ‰€ä»¥ä½¿ç”¨C++20æ ‡å‡†çš„ç¼–è¯‘ç¯å¢ƒæ¥ç¼–è¯‘ä¸Šé¢çš„ä»£ç æ˜¯å¯è¡Œçš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]2140.è§£å†³æ™ºåŠ›é—®é¢˜</title>
    <link href="/2024/10/31/LC-2140-%E8%A7%A3%E5%86%B3%E6%99%BA%E5%8A%9B%E9%97%AE%E9%A2%98/"/>
    <url>/2024/10/31/LC-2140-%E8%A7%A3%E5%86%B3%E6%99%BA%E5%8A%9B%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„äºŒç»´æ•´æ•°æ•°ç»„ <code>questions</code> ï¼Œå…¶ä¸­ <code>questions[i] = [pointsi, brainpoweri]</code> ã€‚</p><p>è¿™ä¸ªæ•°ç»„è¡¨ç¤ºä¸€åœºè€ƒè¯•é‡Œçš„ä¸€ç³»åˆ—é¢˜ç›®ï¼Œä½ éœ€è¦ <strong>æŒ‰é¡ºåº</strong> ï¼ˆä¹Ÿå°±æ˜¯ä»é—®é¢˜ <code>0</code> å¼€å§‹ä¾æ¬¡è§£å†³ï¼‰ï¼Œé’ˆå¯¹æ¯ä¸ªé—®é¢˜é€‰æ‹© <strong>è§£å†³</strong> æˆ–è€… <strong>è·³è¿‡</strong> æ“ä½œã€‚è§£å†³é—®é¢˜ <code>i</code> å°†è®©ä½  <strong>è·å¾—</strong> <code>pointsi</code> çš„åˆ†æ•°ï¼Œä½†æ˜¯ä½ å°† <strong>æ— æ³•</strong> è§£å†³æ¥ä¸‹æ¥çš„ <code>brainpoweri</code> ä¸ªé—®é¢˜ï¼ˆå³åªèƒ½è·³è¿‡æ¥ä¸‹æ¥çš„ <code>brainpoweri</code> ä¸ªé—®é¢˜ï¼‰ã€‚å¦‚æœä½ è·³è¿‡é—®é¢˜ <code>i</code> ï¼Œä½ å¯ä»¥å¯¹ä¸‹ä¸€ä¸ªé—®é¢˜å†³å®šä½¿ç”¨å“ªç§æ“ä½œã€‚</p><p>æ¯”æ–¹è¯´ï¼Œç»™ä½  </p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">questions = <span class="hljs-comment">[<span class="hljs-comment">[3, 2]</span>, <span class="hljs-comment">[4, 3]</span>, <span class="hljs-comment">[4, 4]</span>, <span class="hljs-comment">[2, 5]</span>]</span><br></code></pre></td></tr></table></figure><ul><li>å¦‚æœé—®é¢˜ <code>0</code> è¢«è§£å†³äº†ï¼Œ é‚£ä¹ˆä½ å¯ä»¥è·å¾— <code>3</code> åˆ†ï¼Œä½†ä½ ä¸èƒ½è§£å†³é—®é¢˜ <code>1</code> å’Œ <code>2</code> ã€‚</li><li>å¦‚æœä½ è·³è¿‡é—®é¢˜ <code>0</code> ï¼Œä¸”è§£å†³é—®é¢˜ <code>1</code> ï¼Œä½ å°†è·å¾— <code>4</code> åˆ†ä½†æ˜¯ä¸èƒ½è§£å†³é—®é¢˜ <code>2</code> å’Œ <code>3</code> ã€‚</li></ul><p>è¯·ä½ è¿”å›è¿™åœºè€ƒè¯•é‡Œä½ èƒ½è·å¾—çš„ <strong>æœ€é«˜</strong> åˆ†æ•°ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è€ƒè™‘ç”¨$dp[i]$è¡¨ç¤ºè§£å†³å‰$i$é“é¢˜ç›®å¯ä»¥è·å¾—çš„æœ€é«˜åˆ†æ•°ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœä¸è§£å†³ç¬¬$i$é“é¢˜ç›®ï¼Œé‚£ä¹ˆ$dp[i] &#x3D; dp[i - 1]$.</li><li>å¦‚æœè§£å†³ç¬¬$i$é“é¢˜ç›®ï¼Œé‚£ä¹ˆ$dp[i] &#x3D; points[i] + max(0, max_{0 \leq j &lt; i, j + brainpower[j] &lt; i}{dp[j]})$.</li></ul><p>æ—¶é—´å¤æ‚åº¦ä¸º$O(n^2)$.</p><p><strong>åæ•ˆæ€§</strong></p><p>å¯¹äºæ¯ä¸€é“é¢˜ç›®ï¼Œè§£å†³ä¸å¦ä¸ä¼šå½±å“å‰é¢çš„é¢˜ç›®ï¼Œå› æ­¤å¯ä»¥è€ƒè™‘åæ–¹å‘å®šä¹‰çŠ¶æ€ï¼Œå³$dp[i]$è¡¨ç¤ºè§£å†³ç¬¬$i$é“é¢˜ç›®åŠä»¥åçš„é¢˜ç›®å¯ä»¥è·å¾—çš„æœ€é«˜åˆ†æ•°ï¼Œé‚£ä¹ˆæœ‰çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p><ul><li>å¦‚æœä¸è§£å†³ç¬¬$i$é“é¢˜ç›®ï¼Œé‚£ä¹ˆ$dp[i] &#x3D; dp[i + 1]$.</li><li>å¦‚æœè§£å†³ç¬¬$i$é“é¢˜ç›®ï¼Œé‚£ä¹ˆ$dp[i] &#x3D; points[i] + dp[i + brainpower[i] + 1]$.</li></ul><p>æ³¨æ„ï¼Œéœ€è¦è€ƒè™‘æ•°ç»„è¶Šç•Œçš„é—®é¢˜ï¼Œå¦‚æœè¶Šç•Œï¼Œé‚£ä¹ˆ$dp[i] &#x3D; 0, i &gt;&#x3D; n$.</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">long</span> <span class="hljs-type">long</span> <span class="hljs-title">mostPoints</span><span class="hljs-params">(vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; questions)</span> </span>&#123;<br>        <span class="hljs-type">int</span> n = questions.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">auto</span> dp = <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt;(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i) &#123;<br>            dp[i] = <span class="hljs-built_in">max</span>(dp[i + <span class="hljs-number">1</span>], questions[i][<span class="hljs-number">0</span>] + dp[<span class="hljs-built_in">min</span>(n, i + questions[i][<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>)]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> dp[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦:</strong> $O(n)$.</p><p><strong>ç©ºé—´å¤æ‚åº¦:</strong>$O(n)$.</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åŠ¨æ€è§„åˆ’</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
      <tag>dp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OOP]C++é¢å‘å¯¹è±¡é«˜æ•ˆç¼–ç¨‹ Chapter 2</title>
    <link href="/2024/10/28/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/"/>
    <url>/2024/10/28/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯æ•°æ®æŠ½è±¡"><a href="#ä»€ä¹ˆæ˜¯æ•°æ®æŠ½è±¡" class="headerlink" title="ä»€ä¹ˆæ˜¯æ•°æ®æŠ½è±¡"></a>ä»€ä¹ˆæ˜¯æ•°æ®æŠ½è±¡</h1><span id="more"></span><p>æ•°æ®æŠ½è±¡ï¼ˆdata abstractionï¼‰åœ¨å¿½ç•¥ç±»å¯¹è±¡é—´å­˜åœ¨å·®å¼‚çš„åŒæ—¶ï¼Œå±•ç°äº†å¯¹ç”¨æˆ·è€Œè¨€æœ€é‡è¦çš„ç‰¹æ€§ã€‚çš„ç¡®ï¼ŒæŠ½è±¡åº”è¯¥å¯¹ç»ˆç«¯ç”¨æˆ·éšè—æ— å…³ç´§è¦çš„ç»†èŠ‚ï¼Œé¿å…æš´éœ²æœ‰å¯èƒ½åˆ†æ•£ç”¨æˆ·æ³¨æ„åŠ›æˆ–ä¸ä½¿ç”¨ç¯å¢ƒæ¯«ä¸ç›¸å¹²çš„ç»†èŠ‚ã€‚</p><h2 id="1-æ¥å£å’Œå®ç°çš„åˆ†ç¦»"><a href="#1-æ¥å£å’Œå®ç°çš„åˆ†ç¦»" class="headerlink" title="1 æ¥å£å’Œå®ç°çš„åˆ†ç¦»"></a>1 æ¥å£å’Œå®ç°çš„åˆ†ç¦»</h2><p><strong>æ¥å£çš„å«ä¹‰</strong></p><p>ç±»å¯¹è±¡çš„æ¥å£æ”¯æŒå¤–éƒ¨è§†å›¾ï¼Œæ¥å£å°±æ˜¯ç”¨æˆ·è§‚å¯Ÿçš„å¯¹è±¡è§†å›¾ï¼Œä»¥åŠç”¨æˆ·å¯ä»¥ç”¨æ¥å£åšä»€ä¹ˆï¼ˆä¹ŸåŒ…æ‹¬æ¥å£å¯¹ç”¨æˆ·åšä»€ä¹ˆï¼‰ã€‚</p><p>å½“æˆ‘ä»¬è®¾è®¡æ¥å£æ—¶ï¼Œåº”æœ€å¤§ç¨‹åº¦åœ°æ»¡è¶³ç”¨æˆ·çš„è¦æ±‚ï¼Œè¿™äº›ç”¨æˆ·ä¹Ÿç§°ä¸ºå®¢æˆ·ï¼ˆclientï¼‰ã€‚æ‰€è°“ç±»çš„å®¢æˆ·ï¼Œå°±æ˜¯ä½¿ç”¨ç±»ä¸”ä¸çŸ¥é“ï¼ˆæˆ–ä¸ç”¨å…³å¿ƒï¼‰ç±»å†…éƒ¨è¿ä½œçš„äººã€‚å®¢æˆ·å¯åˆ›å»ºç±»çš„å¯¹è±¡ï¼Œå¹¶é€šè¿‡æ¥å£å¯¹å…¶è¿›è¡Œæ“ä½œã€‚</p><p><strong>å®ç°çš„å«ä¹‰</strong></p><p>æ¥å£å‘Šè¯‰å®¢æˆ·å¯ä»¥åšä»€ä¹ˆï¼Œå®ç°åˆ™è´Ÿè´£å¦‚ä½•åšï¼Œæ‰€æœ‰çš„å·¥ä½œéƒ½åœ¨å®ç°ä¸­å®Œæˆã€‚å®¢æˆ·æ— éœ€äº†è§£ç±»å¦‚ä½•å®ç°æ¥å£æ‰€æä¾›çš„æ“ä½œã€‚å› æ­¤ï¼Œå®ç°ç”¨äºæ”¯æŒç”±å¯¹è±¡è¡¨ç°çš„æ¥å£ã€‚</p><h2 id="2-å¯¹è±¡æ¥å£çš„é‡è¦æ€§"><a href="#2-å¯¹è±¡æ¥å£çš„é‡è¦æ€§" class="headerlink" title="2 å¯¹è±¡æ¥å£çš„é‡è¦æ€§"></a>2 å¯¹è±¡æ¥å£çš„é‡è¦æ€§</h2><p>æ•°æ®æŠ½è±¡çš„ç›®çš„æ˜¯ï¼Œæä¾›æ¸…æ™°å’Œå……è¶³çš„æ¥å£ï¼Œåœ¨æ–¹ä¾¿ä¸”å—æ§çš„æ¨¡å¼ä¸‹å…è®¸ç”¨æˆ·è®¿é—®åº•å±‚å®ç°ã€‚</p><h2 id="3-ä¿æŠ¤å®ç°"><a href="#3-ä¿æŠ¤å®ç°" class="headerlink" title="3 ä¿æŠ¤å®ç°"></a>3 ä¿æŠ¤å®ç°</h2><p>å¦‚æœå®ç°åœ¨ç”Ÿå­˜æœŸå†…æ— æ³•ä¿è¯è‡ªèº«çš„å®Œæ•´æ€§ï¼Œè¿™æ ·çš„å®ç°åˆ™æ¯«æ— ç”¨å¤„ã€‚</p><p>æ¥å£ï¼ˆé€Ÿåº¦è¡¨ã€ATMã€ç”µæºæ’åº§ï¼‰éƒ½ç”±å®ç°æ”¯æŒï¼Œè€Œä¸”è¯¥å®ç°ç”±å¯¹åº”çš„æ¥å£æ¥ä¿æŠ¤ï¼ˆå³æ¥å£æä¾›ä¸€ä¸ªæ¸…æ™°ä¸”å®šä¹‰æ˜ç¡®çš„æ–¹æ³•è®¿é—®å®ç°ï¼‰ã€‚æ¢è¨€ä¹‹ï¼Œå®ç°ä»¥ç‰¹å®šæ–¹å¼å·¥ä½œï¼Œå¹¶è·Ÿè¸ªè‡ªèº«çš„çŠ¶æ€ã€‚å¦å¤–ï¼Œå®ç°å‡è®¾å®ƒçš„çŠ¶æ€ä»…èƒ½é€šè¿‡æ¥å£æ›´æ”¹ï¼Œå¦‚æœè¿åæ­¤å‰ææ¡ä»¶ï¼ˆå³ä¸çŸ¥ä½•æ•…ï¼Œå®ç°çš„çŠ¶æ€è¢«ç›´æ¥ä»å¤–éƒ¨æ›´æ”¹ï¼Œå¹¶æœªé€šè¿‡æä¾›çš„æ¥å£æ›´æ”¹ï¼‰ï¼Œåˆ™æ— æ³•ä¿è¯å®ç°è¿›è¡Œæ­£ç¡®åœ°æ“ä½œã€‚</p><p>æ•°æ®æŠ½è±¡å¼•å‡ºäº†ç›¸å…³çš„æ¦‚å¿µï¼šæ•°æ®å°è£…ï¼ˆdata encapsulationï¼‰ã€‚åªè¦å­˜åœ¨ç”±å®ç°æ”¯æŒçš„å¸¦æ¥å£çš„å¯¹è±¡ï¼Œå°±ä¸€å®šå­˜åœ¨å®ç°éšè—ï¼ˆimplementation hidingï¼‰ï¼ˆä¹Ÿç§°ä¸ºä¿¡æ¯éšè—ï¼‰ã€‚æœ‰äº›ä¿¡æ¯å¯¹å®ç°è€Œè¨€ç›¸å½“é‡è¦ï¼Œä½†æ˜¯å¯¹ä½¿ç”¨æ¥å£çš„ç”¨æˆ·è€Œè¨€å´æ¯«æ— ä»·å€¼ï¼Œè¿™äº›ä¿¡æ¯å°†è¢«éšè—åœ¨å®ç°ä¸­ã€‚å®ç°ç”±æ¥å£å°è£…ï¼Œè€Œä¸”æ¥å£æ˜¯è®¿é—®è¯¥å®ç°çš„å”¯ä¸€åˆæ³•é€”å¾„ã€‚</p><p>è¢«å°è£…çš„æ•°æ®å¯¹äºå¯¹è±¡çš„å®ç°æå…¶é‡è¦ã€‚è¿›ä¸€æ­¥è€Œè¨€ï¼Œå®ç°å¿…é¡»ç»´æŠ¤è¢«å°è£…ä¿¡æ¯çš„å®Œæ•´ï¼ˆæˆ–æ­£ç¡®çš„çŠ¶æ€ï¼‰ã€‚</p><h2 id="4-æ•°æ®å°è£…çš„ä¼˜ç‚¹"><a href="#4-æ•°æ®å°è£…çš„ä¼˜ç‚¹" class="headerlink" title="4 æ•°æ®å°è£…çš„ä¼˜ç‚¹"></a>4 æ•°æ®å°è£…çš„ä¼˜ç‚¹</h2><p>æ•°æ®è¢«å°è£…åï¼Œå®¢æˆ·æ— æ³•ç›´æ¥è®¿é—®ï¼Œæ›´ä¸èƒ½ä¿®æ”¹ï¼Œåªæœ‰æ¥å£å‡½æ•°æ‰å¯è®¿é—®å’Œä¿®æ”¹å°è£…çš„ä¿¡æ¯ã€‚è¿›ä¸€æ­¥è€Œè¨€ï¼Œä½¿ç”¨æ¥å£çš„ç”¨æˆ·å®Œå…¨ä¸çŸ¥é“æè¿°è¯¥æ¥å£çš„å‡½æ•°å¦‚ä½•ä½¿ç”¨å°è£…ä¿¡æ¯ï¼Œè€Œä¸”å¯¹è±¡ï¼ˆæˆ–ç±»ï¼‰çš„ç”¨æˆ·å¯¹æ­¤ä¹Ÿæ¯«æ— å…´è¶£ã€‚</p><p>æ•°æ®å°è£…çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯<strong>å®ç°ç‹¬ç«‹ï¼ˆimplementation independenceï¼‰</strong>ã€‚ç”±äºç±»çš„ç”¨æˆ·æ— æ³•æŸ¥çœ‹å°è£…çš„æ•°æ®ï¼ˆæˆ–ä¿¡æ¯ï¼‰ï¼Œä»–ä»¬ç”šè‡³ä¸ä¼šæ³¨æ„åˆ°å°è£…æ•°æ®çš„å­˜åœ¨ã€‚å› æ­¤ï¼Œæ”¹åŠ¨å°è£…å†…çš„æ•°æ®ä¸ä¼šï¼ˆä¹Ÿä¸è¯¥ï¼‰å½±å“ç”¨æˆ·æ‰€è§çš„æ¥å£ã€‚</p><h2 id="5-æ¥å£ã€å®ç°å’Œæ•°æ®å°è£…ä¹‹é—´çš„å…³ç³»"><a href="#5-æ¥å£ã€å®ç°å’Œæ•°æ®å°è£…ä¹‹é—´çš„å…³ç³»" class="headerlink" title="5 æ¥å£ã€å®ç°å’Œæ•°æ®å°è£…ä¹‹é—´çš„å…³ç³»"></a>5 æ¥å£ã€å®ç°å’Œæ•°æ®å°è£…ä¹‹é—´çš„å…³ç³»</h2><ul><li>æ¥å£æ˜¯ä»»ä½•ç±»ï¼ˆå’Œå®ƒçš„å¯¹è±¡ï¼‰å®¢æˆ·çš„è§†å›¾ï¼›</li><li>æ¥å£ç”±å°è£…çš„å®ç°æ”¯æŒï¼›</li><li>æ”¹å˜ç±»çš„å®ç°ï¼ˆæ”¯æŒæ¥å£ï¼‰ä¸åº”è¯¥å½±å“è¯¥ç±»å®¢æˆ·æ‰€è§çš„æ¥å£ï¼›</li><li>å°è£…çš„å®ç°èƒ½è®©å®ç°è€…ä¿®æ”¹å®ç°ä½†ä¸å½±å“æ¥å£ã€‚å³å®¢æˆ·ä½¿ç”¨çš„æ¥å£ä¸æ”¯æŒæ¥å£çš„å®ç°å½¼æ­¤ç‹¬ç«‹ï¼›</li></ul><h2 id="6-ç¡®å®šå°è£…çš„å†…å®¹"><a href="#6-ç¡®å®šå°è£…çš„å†…å®¹" class="headerlink" title="6 ç¡®å®šå°è£…çš„å†…å®¹"></a>6 ç¡®å®šå°è£…çš„å†…å®¹</h2><ul><li>å¦‚æœæŸé¡¹å¯¹äºç”¨æˆ·ç†è§£ç±»æ¯«æ— å¸®åŠ©ï¼Œå°è£…è¯¥é¡¹ï¼Œå³ä»æ¥å£ä¸­ç§»é™¤è¯¥é¡¹æ ¹æœ¬ä¸ä¼šå‡å°‘ç±»çš„æ•ˆç”¨ï¼›</li><li>å¦‚æœæŸé¡¹åŒ…å«æ•æ„Ÿæ•°æ®ï¼ˆå•†ä¸šç§˜å¯†ã€ä¸“åˆ©ä¿¡æ¯ã€ä¸ªäººä¿¡æ¯ç­‰ï¼‰ï¼Œä¸ºäº†ä¸è®©ç”¨æˆ·ç›´æ¥è®¿é—®ï¼Œå°è£…è¯¥é¡¹ï¼›</li><li>å¦‚æœæŸäº›é¡¹æœ‰æ½œåœ¨çš„å±é™©ï¼ˆæ¿€å…‰æŸã€Xå°„çº¿ã€å¾®æ³¢ç­‰ï¼‰ï¼Œå¹¶ä¸”è¦æ±‚ç”¨æˆ·æŒæ¡ç‰¹æ®ŠæŠ€èƒ½ï¼ˆæ™®é€šç”¨æˆ·ä¸å…·å¤‡ï¼‰æ‰èƒ½æ“ä½œï¼Œåˆ™å°è£…è¯¥é¡¹ï¼›</li><li>å¦‚æœç±»ä¸ºäº†è‡ªæˆ‘ç®¡ç†è€Œä½¿ç”¨æŸäº›å…ƒç´ ï¼Œä¸”å¯¹æ¥å£æ„ä¹‰ä¸å¤§ï¼Œåº”å°è£…è¿™äº›å…ƒç´ ï¼›</li><li>å¦‚æœæŸäº›é¡¹å€¾å‘äºåœ¨å°†æ¥è¿›è¡Œæ”¹åŠ¨ï¼ˆä¸ºäº†ä½¿ç”¨æ›´æ–°çš„æŠ€æœ¯æˆ–è€…è®©å…¶æ›´å¿«æˆ–æ›´å®‰å…¨ï¼‰ï¼Œå¿…é¡»ä»ç±»çš„æ¥å£ä¸­ç§»é™¤ï¼Œå°è£…è¿™äº›é¡¹ã€‚</li></ul><h2 id="7-æŠ½è±¡æ•°æ®ç±»å‹"><a href="#7-æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="7 æŠ½è±¡æ•°æ®ç±»å‹"></a>7 æŠ½è±¡æ•°æ®ç±»å‹</h2><p><strong>æŠ½è±¡æ•°æ®ç±»å‹</strong>æ˜¯ç”±ç¨‹åºå‘˜å®šä¹‰çš„æ–°ç±»å‹ï¼Œé™„å¸¦ä¸€ç»„æ“æ§æ–°ç±»å‹çš„æ“ä½œã€‚å®šä¹‰æ–°æŠ½è±¡ç±»å‹å°†ç›´æ¥åº”ç”¨æ•°æ®æŠ½è±¡çš„æ¦‚å¿µã€‚æŠ½è±¡æ•°æ®ç±»å‹ä¹Ÿç§°ä¸ºç¨‹åºå‘˜å®šä¹‰ç±»å‹ï¼ˆprogrammer defined typeï¼‰ã€‚</p><h2 id="8-å¯¹è±¡æ˜¯é‡ç‚¹"><a href="#8-å¯¹è±¡æ˜¯é‡ç‚¹" class="headerlink" title="8 å¯¹è±¡æ˜¯é‡ç‚¹"></a>8 å¯¹è±¡æ˜¯é‡ç‚¹</h2><p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯ä½¿ç”¨å¯¹è±¡ã€‚è¦ç‰¢è®°ï¼šæ— è®ºä½•æ—¶æˆ‘ä»¬è®¨è®ºè°ƒç”¨å‡½æ•°æˆ–å‘é€æ¶ˆæ¯æ—¶ï¼Œéƒ½å¿…é¡»æ¶‰åŠä¸€ä¸ªå¯¹è±¡ã€‚æˆ‘ä»¬é€šè¿‡å¯¹è±¡è°ƒç”¨å‡½æ•°ï¼ˆæˆ–å‘é€æ¶ˆæ¯ç»™å¯¹è±¡ï¼‰ï¼Œåœ¨æ²¡æœ‰å¯¹è±¡æ¥æ”¶æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å‘é€æ¶ˆæ¯ã€‚å¿…é¡»æœ‰çš„æ”¾çŸ¢ï¼Œå¯¹è±¡å³æ˜¯ç›®æ ‡ã€‚</p><h2 id="9-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹å®‰å…¨ç±»"><a href="#9-ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="9 ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹å®‰å…¨ç±»"></a>9 ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹å®‰å…¨ç±»</h2><p>ä¸€ä¸ªè¿›ç¨‹å†…çš„ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œåœ¨æˆå‘˜å‡½æ•°å†…éƒ¨å®Œæˆæ‰§è¡Œä¹‹å‰ï¼Œå¦‚æœï¼ˆæ“ä½œç³»ç»Ÿï¼‰è°ƒåº¦ï¼ˆscheduleï¼‰å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œï¼Œä¸”è¯¥çº¿ç¨‹ä¹Ÿé€šè¿‡ç›¸åŒçš„å¯¹è±¡è°ƒç”¨ç›¸åŒçš„æˆå‘˜å‡½æ•°ï¼Œåˆ™å¯¹è±¡å¿…é¡»ä¿è¯è‡ªèº«å®Œæ•´å’Œè¿è¡Œè‰¯å¥½ã€‚å¦‚æœå¯¹è±¡ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¿™æ ·çš„ç±»å°±ä¸æ˜¯<strong>çº¿ç¨‹å®‰å…¨ï¼ˆthread-safeï¼‰</strong>çš„ã€‚</p><h2 id="10-ç¡®ä¿æŠ½è±¡çš„å¯é æ€§â€”â€”ç±»ä¸å˜å¼å’Œæ–­è¨€"><a href="#10-ç¡®ä¿æŠ½è±¡çš„å¯é æ€§â€”â€”ç±»ä¸å˜å¼å’Œæ–­è¨€" class="headerlink" title="10 ç¡®ä¿æŠ½è±¡çš„å¯é æ€§â€”â€”ç±»ä¸å˜å¼å’Œæ–­è¨€"></a>10 ç¡®ä¿æŠ½è±¡çš„å¯é æ€§â€”â€”ç±»ä¸å˜å¼å’Œæ–­è¨€</h2><h3 id="10-1-ç±»ä¸å˜å¼"><a href="#10-1-ç±»ä¸å˜å¼" class="headerlink" title="10.1 ç±»ä¸å˜å¼"></a>10.1 ç±»ä¸å˜å¼</h3><p>æ¯ä¸ªç±»éƒ½ä¼šåœ¨å¯¹è±¡ä¸­åŒ…å«ä¸€äº›æ’ä¸ºçœŸçš„æ¡ä»¶ï¼Œæ— è®ºå¯¹è±¡è°ƒç”¨ä»»ä½•æˆå‘˜å‡½æ•°ï¼Œè¿™äº›æ¡ä»¶éƒ½å¿…é¡»ä¸ºçœŸã€‚è¿™æ ·çš„æ¡ä»¶ç§°ä¸ºç±»ä¸å˜å¼ï¼ˆclass invariantï¼‰ã€‚</p><h3 id="10-2-å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶"><a href="#10-2-å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶" class="headerlink" title="10.2 å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶"></a>10.2 å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶</h3><p>æˆå‘˜å‡½æ•°å¯èƒ½ä¼šåŒ…å«å…¶ä»–æ¡ä»¶ï¼Œåœ¨æ‰§è¡Œä»£ç å‰å¿…é¡»ä¿è¯è¿™äº›æ¡ä»¶ä¸ºçœŸã€‚è¿™äº›åœ¨æ“ä½œå¼€å§‹è¢«è°ƒç”¨ä¹‹å‰å¿…é¡»ä¸ºçœŸçš„æ¡ä»¶ï¼Œç§°ä¸º<strong>å‰ç½®æ¡ä»¶ï¼ˆpreconditionï¼‰</strong>ã€‚</p><p>åœ¨Cå’ŒC++ä¸­ï¼Œæ–­è¨€å·²ç»ä½¿ç”¨å¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚æ‰€æœ‰çš„Cå’ŒC++ç¼–è¯‘å™¨éƒ½æ”¯æŒassertå®ã€‚è¯¥å®æ¥å—ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè€Œä¸”å¿…é¡»åˆ¤æ–­è¡¨è¾¾å¼çš„çœŸå‡ã€‚å€˜è‹¥è¡¨è¾¾å¼åˆ¤æ–­ä¸ºçœŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œï¼›å€˜è‹¥è¡¨è¾¾å¼ä¸ºå‡ï¼Œåˆ™ç¨‹åºåœæ­¢ï¼Œå¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯è¡¨æ˜æ–­è¨€å¤±è´¥ã€‚</p><h3 id="10-3-é«˜æ•ˆä½¿ç”¨æ–­è¨€"><a href="#10-3-é«˜æ•ˆä½¿ç”¨æ–­è¨€" class="headerlink" title="10.3 é«˜æ•ˆä½¿ç”¨æ–­è¨€"></a>10.3 é«˜æ•ˆä½¿ç”¨æ–­è¨€</h3><p>é«˜æ•ˆä½¿ç”¨æ–­è¨€å¯å®ç°æ›´å¯é çš„ç¨‹åºã€‚å½“æ¡ä»¶ä¸æˆç«‹æ—¶ï¼Œæ–­è¨€è‡³å°‘ä¿è¯ç¨‹åºä¸ä¼šç»§ç»­æ‰§è¡Œã€‚ä½†æ˜¯å‘ç”Ÿæ–­è¨€å¤±è´¥ï¼Œå°±ä¸å¯èƒ½å†å¤åŸã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç”¨åˆ° C++æ”¯æŒçš„çœŸæ­£çš„å¼‚å¸¸ç®¡ç†å·¥å…·ã€‚</p><h2 id="11-ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUMLï¼‰"><a href="#11-ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUMLï¼‰" class="headerlink" title="11 ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUMLï¼‰"></a>11 ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUMLï¼‰</h2><h3 id="11-1-ç±»å’Œå¯¹è±¡çš„è¡¨ç¤º"><a href="#11-1-ç±»å’Œå¯¹è±¡çš„è¡¨ç¤º" class="headerlink" title="11.1 ç±»å’Œå¯¹è±¡çš„è¡¨ç¤º"></a>11.1 ç±»å’Œå¯¹è±¡çš„è¡¨ç¤º</h3><p>ç±»ç”¨çŸ©å½¢è¡¨ç¤ºã€‚ç±»åé€šå¸¸ç”¨ç²—ä½“è¡¨ç¤ºã€‚å±æ€§åœ¨ç±»åä¸‹çš„ç¬¬äºŒæ ä¸­åˆ—å‡ºï¼Œæ“ä½œåœ¨ç±»åä¸‹çš„ç¬¬ä¸‰æ ä¸­åˆ—å‡ºã€‚åœ¨é«˜çº§æ¦‚è¿°å›¾ä¸­ï¼Œç¬¬äºŒæ å’Œç¬¬ä¸‰æ å¯ä»¥çœç•¥ï¼Œåªåœ¨çŸ©å½¢ä¸­æ˜¾ç¤ºç±»åå³å¯ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028193708004.png"></p><p>åœ¨ç±»åçš„ä¸Šæ–¹å¯ä»¥è§„å®šç±»çš„è¡å‹ï¼ˆstereotypeï¼‰ã€‚è¡å‹è¡¨ç¤ºå®ƒæ˜¯ä½•ç§ç±»å‹çš„ç±»ï¼Œå¦‚å¼‚å¸¸ç±»ã€æ§åˆ¶ç±»ã€æ¥å£ç±»ç­‰ã€‚è¡å‹åŒ…å«åœ¨ä¸€å¯¹åŒå°–æ‹¬å·ä¸­ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028193938215.png"></p><p>æŠ½è±¡ç±»çš„åç§°ç”¨æ–œä½“è¡¨ç¤ºï¼ŒæŠ½è±¡æ“ä½œä¹Ÿç”¨æ–œä½“è¡¨ç¤ºã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028194101136.png"></p><p>å¯¹è±¡ç”¨çŸ©å½¢è¡¨ç¤ºï¼ŒçŸ©å½¢ä¸­çš„å¯¹è±¡åå’Œç±»åå¸¦ä¸‹åˆ’çº¿ã€‚</p><p>é¡¶æ ¼ä¸­ä»¥å¯¹è±¡åï¼šç±»åçš„å½¢å¼æ˜¾ç¤ºã€‚åŒ¿åå¯¹è±¡å¯ä»¥çœç•¥å¯¹è±¡åã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028194115589.png"></p><h3 id="11-2-UMLä¸­ç±»çš„å…³ç³»"><a href="#11-2-UMLä¸­ç±»çš„å…³ç³»" class="headerlink" title="11.2 UMLä¸­ç±»çš„å…³ç³»"></a>11.2 UMLä¸­ç±»çš„å…³ç³»</h3><h4 id="11-2-1-å…³è”å…³ç³»"><a href="#11-2-1-å…³è”å…³ç³»" class="headerlink" title="11.2.1 å…³è”å…³ç³»"></a>11.2.1 å…³è”å…³ç³»</h4><p>å…³è”è¡¨ç¤ºå¯¹è±¡ä¸ä¸åŒç±»ä¹‹é—´çš„ç»“æ„å…³ç³»ï¼ˆstructual relationshipï¼‰ï¼Œå¤§å¤šæ•°å…³è”éƒ½æ˜¯äºŒå…ƒå…³ç³»ï¼ˆbinary relationï¼‰ã€‚ç±»ä¹‹é—´çš„å¤šé‡å…³è”ï¼ˆmultiple associationï¼‰å’Œç±»æœ¬èº«çš„è‡ªå…³è”ï¼ˆself associationï¼‰éƒ½æ˜¯åˆæ³•çš„ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028194319605.png"></p><p>æ¯ä¸ªå…³è”çš„æœ«ç«¯å°±æ˜¯è§’è‰²ã€‚æ¯ä¸ªè§’è‰²éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œè¯´æ˜å…¶ä»–çš„ç±»å¦‚ä½•çœ‹å¾…è¿™ä¸ªç±»ã€‚Companyå°†Personçœ‹åšæˆâ€œé›‡å‘˜â€ã€‚ç±»ä¼¼åœ°ï¼ŒPersonå°†Companyçœ‹æˆâ€œé›‡ä¸»â€ã€‚è§’è‰²åå¿…é¡»å”¯ä¸€ï¼Œå®ƒæ¯”å…³è”åæ›´é‡è¦ã€‚</p><p>æ¯ä¸ªè§’è‰²éƒ½è¯´æ˜äº†ç±»çš„å¤šé‡æ€§ï¼ˆmultiplicityï¼‰ã€‚ä¾‹å¦‚ï¼ŒPersonå¯ä»¥ä¸ºè®¸å¤šå…¬å¸å·¥ä½œï¼ˆå³äººä¸è®¸å¤šå…¬å¸ç›¸å…³è”ï¼‰ã€‚è¿™è¯´æ˜è§’è‰²çš„å¤šé‡æ€§ã€‚ç¬¦å· <code>*</code> è¡¨æ˜â€œè®¸å¤šâ€ï¼ˆå¯¹è±¡çš„æ— é™æ•°ç›®ï¼Œå…¶è¡¨ç¤ºä¸º 0..*ï¼‰ã€‚å¤šé‡æ€§ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ï¼ˆ1æˆ–5ç­‰ç­‰ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªèŒƒå›´ï¼ˆ1..5ï¼‰ã€‚</p><p>å…³è”æœ«ç«¯çš„ç®­å¤´è¡¨æ˜å…³è”çš„å¯¼èˆªæ€§ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028194707559.png"></p><p>ä¸€ä¸ªç±»è¿˜å¯ä»¥ä¸æœ¬èº«å½¢æˆå…³è”ï¼Œå³æˆä¸ºå…³è”ç±»ï¼ˆassociation classï¼‰ã€‚åœ¨å…³è”çº¿ç”¨è™šçº¿å¼•å‡ºçš„ç±»ï¼Œå³æ˜¯å…³è”ç±»ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028194912827.png"></p><h4 id="11-2-2-åŒ…å«å…³ç³»ï¼ˆhas-aï¼‰"><a href="#11-2-2-åŒ…å«å…³ç³»ï¼ˆhas-aï¼‰" class="headerlink" title="11.2.2 åŒ…å«å…³ç³»ï¼ˆhas-aï¼‰"></a>11.2.2 åŒ…å«å…³ç³»ï¼ˆhas-aï¼‰</h4><p><strong>èšé›†</strong></p><p>èšé›†ï¼ˆaggregationï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šå½¢å¼çš„å…³è”ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéƒ¨åˆ†ï¼ˆå³æ•´ä½“æ‰€åŒ…å«çš„éƒ¨åˆ†ï¼‰çš„ç”Ÿå­˜æœŸä¸å†å–å†³äºæ•´ä½“çš„ç”Ÿå­˜æœŸã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028195042337.png"></p><p>é€šè¿‡ä¸€ä¸ªç©ºè±å½¢è¿æ¥çš„ç±»ä¸ºèšé›†ã€‚ä¸èƒ½åœ¨çº¿çš„ä¸¤ç«¯éƒ½ç»˜åˆ¶è±å½¢ã€‚å½“ç±»ä¹‹é—´æ²¡æœ‰ç”Ÿå­˜æœŸä¾èµ–æ—¶ï¼Œè¯¥è¡¨ç¤ºæ³•ç”¨äºè¡¨ç¤ºå¸¸è§çš„<strong>æŒ‰å¼•ç”¨èšé›†</strong>ã€‚Orchestraï¼ˆç®¡å¼¦ä¹é˜Ÿï¼‰æ˜¯Performerï¼ˆæ¼”å¥è€…ï¼‰çš„å…¨ä½“æ¼”å‡ºè€…ã€‚å¦‚æœå°†è¡¨ç¤ºèšé›†çš„ç©ºè±å½¢å¡«å……ï¼Œåˆ™è¡¨ç¤º<strong>ç»„åˆï¼ˆcompositionï¼‰</strong>â€”â€”èšé›†çš„ä¸€ç§åŠ å¼ºçš„å½¢å¼ã€‚</p><p><strong>ç»„åˆ</strong></p><p>è¿™æ˜¯ä¸€ç§èšé›†å½¢å¼ï¼Œæœ‰å¾ˆå¼ºçš„ç”Ÿå­˜æœŸï¼Œä¸”éƒ¨åˆ†å’Œæ•´ä½“ä¹‹é—´çš„æ‰€æœ‰æƒä¾èµ–å…³ç³»ä¹Ÿå¾ˆå¼ºã€‚èšé›†ï¼ˆå®¹å™¨ï¼‰çš„å¤šé‡æ€§ä¸èƒ½è¶…è¿‡1ä¸ªï¼ˆæ— å…±äº«ï¼‰ã€‚ç»„åˆçš„å¯¹è±¡ä¸€èµ·è¢«åˆ›å»ºï¼Œä¸€èµ·è¢«é”€æ¯ã€‚</p><p>å½“å¤šé‡æ€§ï¼ˆåŸºæ•°ï¼‰å¤§äº 1 æ—¶ï¼Œå¯ä»¥åœ¨åˆ›å»ºèšé›†æœ¬èº«åå†åˆ›å»ºéƒ¨åˆ†ï¼ˆpartï¼‰ï¼Œé™¤éåœ¨èšé›†è¢«é”€æ¯å‰ï¼Œæ˜¾å¼ç§»é™¤éƒ¨åˆ†ï¼Œå¦åˆ™éƒ¨åˆ†ä¼šå’Œèšé›†ä¸€èµ·è¢«é”€æ¯ã€‚ä¸€æ¶ AirPlane æœ‰å¤šä¸ª Engineå’Œå¤šä¸ªSeatç­‰ï¼Œè€Œä¸”åœ¨AirPlaneç±»å¯¹è±¡çš„ç”Ÿå­˜æœŸå†…ï¼Œå¯ä»¥æ·»åŠ æˆ–ç§»é™¤Seatã€‚å½“AirPlaneç±»å¯¹è±¡è¢«é”€æ¯åï¼Œå®ƒæ‰€åŒ…å«çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šè¢«é”€æ¯ï¼Œé™¤éå®ƒä»¬å·²ç»ä»AirPlaneç±»å¯¹è±¡ä¸­ç§»é™¤ï¼ˆä¾‹å¦‚ï¼Œåº§æ¤…å¯èƒ½è¢«ç§»é™¤ï¼Œå¤ç”¨äºå¦ä¸€æ¶é£æœºä¸­ï¼‰ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028201313888.png"></p><p><strong>ORå…³è”</strong></p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç±»å¯ä»¥å‚ä¸ä¸¤ä¸ªå…³è”ï¼Œä½†æ˜¯æ¯ä¸ªå¯¹è±¡ä¸€æ¬¡åªèƒ½å‚ä¸ä¸€ä¸ªå…³è”ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028201147824.png"></p><h4 id="11-2-3-æ³›åŒ–å…³ç³»ï¼ˆis-aï¼‰"><a href="#11-2-3-æ³›åŒ–å…³ç³»ï¼ˆis-aï¼‰" class="headerlink" title="11.2.3 æ³›åŒ–å…³ç³»ï¼ˆis-aï¼‰"></a>11.2.3 æ³›åŒ–å…³ç³»ï¼ˆis-aï¼‰</h4><p>æ³›åŒ–å…³ç³»ç”¨äºè¡¨ç¤ºç»§æ‰¿ï¼Œæ„å‘³ç€ä»åŸºç±»åˆ°æ´¾ç”Ÿç±»çš„ä¸€èˆ¬â€”â€”ç‰¹æ®Šå…³ç³»ï¼Œå›¾ä¸­çš„ç®­å¤´å¿…é¡»ä¸ºç©ºå¿ƒ</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-2/image-20241028201814607.png"></p>]]></content>
    
    
    <categories>
      
      <category>é¢å‘å¯¹è±¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>OOP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OOP]C++é¢å‘å¯¹è±¡é«˜æ•ˆç¼–ç¨‹ Chapter 1</title>
    <link href="/2024/10/28/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-1/"/>
    <url>/2024/10/28/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-1/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹</h1><span id="more"></span><h2 id="1-ç†è§£å¯¹è±¡æ¨¡å‹"><a href="#1-ç†è§£å¯¹è±¡æ¨¡å‹" class="headerlink" title="1 ç†è§£å¯¹è±¡æ¨¡å‹"></a>1 ç†è§£å¯¹è±¡æ¨¡å‹</h2><p>OOPä¸­çš„åŸºæœ¬å®ä½“æ˜¯ç±»ã€‚å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚</p><p>åœ¨OOPä¸­ï¼Œå‡½æ•°é€šè¿‡å¯¹è±¡è°ƒç”¨ã€‚</p><h2 id="2-ç†è§£æ¶ˆæ¯ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡"><a href="#2-ç†è§£æ¶ˆæ¯ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡" class="headerlink" title="2 ç†è§£æ¶ˆæ¯ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡"></a>2 ç†è§£æ¶ˆæ¯ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡</h2><p>ç±»çš„ä»»ä½•ç”¨æˆ·ï¼ˆå¦ä¸€ä¸ªç¨‹åºã€å¦ä¸€ä¸ªç±»ç­‰ï¼‰éƒ½æ˜¯ç±»çš„å®¢æˆ·ã€‚å®¢æˆ·é€šè¿‡ç±»çš„å¯¹è±¡ä½¿ç”¨æˆå‘˜å‡½æ•°ï¼ˆæ¶ˆæ¯ï¼‰è¿›è¡Œæœ‰ç”¨çš„æ“ä½œã€‚</p><p>æ¶ˆæ¯åªæ˜¯å®¢æˆ·æ‰€è§çš„ä¸€ä¸ªåç§°ï¼Œè¯¥åç§°å¯èƒ½åœ¨è¿è¡ŒæœŸè¢«ç»‘å®šåœ¨æ­£ç¡®çš„å®ç°ä¸Šï¼ˆæ–¹æ³•ï¼‰ã€‚ç±»çš„æ¯ä¸ªç¤ºä¾‹éƒ½åŒ…å«å®ä¾‹å˜é‡çš„å•ç‹¬å‰¯æœ¬ã€‚</p><h2 id="3-ä»€ä¹ˆå¯ä»¥ä½œä¸ºç±»"><a href="#3-ä»€ä¹ˆå¯ä»¥ä½œä¸ºç±»" class="headerlink" title="3 ä»€ä¹ˆå¯ä»¥ä½œä¸ºç±»"></a>3 ä»€ä¹ˆå¯ä»¥ä½œä¸ºç±»</h2><p>ç±»æ‹¥æœ‰ä¸€ç»„å¯¹è±¡çš„å…±åŒå±æ€§ï¼ˆæˆ–è€…ç‰¹æ€§ï¼‰ã€‚</p><p>ç±»ä¸åªæ˜¯å®¹å™¨ï¼Œä¸èƒ½è®¤ä¸ºå®ƒä»…ä»…ç”¨äºå­˜å‚¨è¢«å‡½æ•°ä¿®æ”¹çš„æ•°æ®ã€‚ç±»ä¸ºå®¢æˆ·æä¾›äº†å¤æ‚å®ä½“çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå¹¶å…è®¸å®¢æˆ·é€šè¿‡æ“ä½œç±»çš„å¯¹è±¡å®Œæˆæœ‰ç”¨çš„å·¥ä½œã€‚ç±»ä¸åªæ˜¯å°†å®ƒçš„å„ä¸ªéƒ¨åˆ†ç®€å•åœ°ç»„åˆèµ·æ¥è€Œå·²ã€‚ç±»å†³å®šå¦‚ä½•å®Œæˆä»»åŠ¡ï¼Œå®ƒæ¸…æ¥šåœ°é™ˆè¿°äº†è¯¥ç±»çš„å¯¹è±¡å¯ä»¥åšä»€ä¹ˆã€‚</p><h2 id="4-ä»€ä¹ˆä¸æ˜¯ç±»"><a href="#4-ä»€ä¹ˆä¸æ˜¯ç±»" class="headerlink" title="4 ä»€ä¹ˆä¸æ˜¯ç±»"></a>4 ä»€ä¹ˆä¸æ˜¯ç±»</h2><p>ä¸€ä¸ª Câ€œç»“æ„â€ä¸èƒ½ç›´æ¥æˆä¸ºä¸€ä¸ªç±»ã€‚ä¸èƒ½å°†ç»“æ„ä¿®æ”¹æˆç±»ï¼Œè®©æ‰€æœ‰æ•°æ®æˆä¸ºç§æœ‰æ•°æ®ï¼Œç„¶åæ·»åŠ ä¸€ç»„å‡½æ•°æ¥è·å¾—å’Œè®¾ç½®æ•°æ®æˆå‘˜ï¼Œè¿™ä¸æ˜¯ç±»ã€‚ç±»ä¸åªæ˜¯ä¸€ç»„å…è®¸å®¢æˆ·è·å–å’Œè®¾ç½®æ•°æ®æˆå‘˜å€¼çš„å‡½æ•°ã€‚æ•°æ®å°è£…éšè—äº†ç±»ä¸­çš„æ•°æ®ï¼Œè€Œä¸”é€šè¿‡æˆå‘˜å‡½æ•°æä¾›æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ã€‚å¦‚æœåªæ˜¯è®©å‡½æ•°è¯»å†™ç»“æ„ä¸­çš„æ•°æ®ï¼Œå…¶å®å¹¶æœªç®€åŒ–ä»»ä½•ä¸œè¥¿ã€‚åªåŒ…å«è·å€¼å‡½æ•°ï¼ˆgetterï¼‰å’Œè®¾å€¼å‡½æ•°ï¼ˆsetterï¼‰çš„ç±»æ˜¯ç³Ÿç³•çš„è®¾è®¡ã€‚</p><h2 id="5-ç±»çš„ç›®çš„"><a href="#5-ç±»çš„ç›®çš„" class="headerlink" title="5 ç±»çš„ç›®çš„"></a>5 ç±»çš„ç›®çš„</h2><p>è®¾è®¡ç±»çš„ç›®çš„å¿…é¡»éå¸¸æ˜ç¡®ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç±»åº”è¯¥æ˜“äºç†è§£å’Œä½¿ç”¨ï¼Œå¿…é¡»æ¸…æ¥šåœ°å‘å®¢æˆ·è¯´æ˜å…¶ç›®çš„ã€‚æ¯ä¸ªç±»éƒ½æ˜¯ä¸ºç‰¹å®šé¢†åŸŸçš„æŸç§ç”¨é€”è€Œè®¾è®¡çš„ã€‚</p><p>ç±»ï¼ˆå®é™…ä¸Šæ˜¯ç±»çš„å¯¹è±¡ï¼‰è´Ÿè´£å±¥è¡Œå…¶åŠŸèƒ½ã€‚å½“è®¾è®¡å‡ºç±»åï¼Œå®ƒï¼ˆå®é™…ä¸Šæ˜¯ç±»çš„è®¾è®¡äººå‘˜ï¼‰ä¾¿å¯¹å®¢æˆ·æ‰¿è¯ºäº†å®ƒçš„åŠŸèƒ½ã€‚ç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œç±»ä¼šè´Ÿè´£ç®¡ç†ä¸€äº›ç»†èŠ‚ï¼Œå› æ­¤å®¢æˆ·ä¸ç”¨æ‹…å¿ƒã€‚</p><h2 id="6-æ·±å…¥äº†è§£å¯¹è±¡"><a href="#6-æ·±å…¥äº†è§£å¯¹è±¡" class="headerlink" title="6 æ·±å…¥äº†è§£å¯¹è±¡"></a>6 æ·±å…¥äº†è§£å¯¹è±¡</h2><p>åŒºåˆ«ç±»å’Œå¯¹è±¡æ˜¯ä¸€ä¸ªé€»è¾‘é—®é¢˜ã€‚ç®€å•åœ°è¯´ï¼Œå¯¹è±¡æ˜¯å¸¦æœ‰çŠ¶æ€å’Œè¡Œä¸ºçš„æ´»çš„å®ä½“ã€‚æ‰€æœ‰ç±»å¯¹è±¡çš„è¡Œä¸ºéƒ½å®šä¹‰åœ¨ç±»ä¸­ï¼Œè€ŒçŠ¶æ€åˆ™ç”±å¯¹è±¡å•ç‹¬ç»´æŠ¤ã€‚</p><h3 id="6-1-å¯¹è±¡çš„çŠ¶æ€"><a href="#6-1-å¯¹è±¡çš„çŠ¶æ€" class="headerlink" title="6.1 å¯¹è±¡çš„çŠ¶æ€"></a>6.1 å¯¹è±¡çš„çŠ¶æ€</h3><p>æ¯ä¸ªBankAccountç±»å¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªbalanceæ•°æ®æˆå‘˜ã€‚å‡è®¾æˆ‘ä»¬ä¸å…è®¸å®¢æˆ·çš„è´¦æˆ·é€æ”¯ï¼Œé‚£ä¹ˆï¼Œåªéœ€å£°æ˜è´¦æˆ·ä¸­çš„ä½™é¢ä¸å…è®¸å°äº0ã€‚è¿™æ˜¯ä»»ä½•é“¶è¡Œè´¦æˆ·å¯¹è±¡çš„å·²çŸ¥æ€§è´¨ï¼ˆpropertyï¼‰ï¼Œæˆ‘ä»¬ä¸å¿…æ£€æŸ¥å¯¹è±¡çš„çŠ¶æ€æ¥ç¡®è®¤è¿™ä¸ªå±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯æ¯ä¸ªé“¶è¡Œè´¦æˆ·å¯¹è±¡çš„<strong>é™æ€æ€§è´¨ï¼ˆstatic propertyï¼‰</strong>ã€‚ç„¶è€Œï¼Œåœ¨BankAccoutç±»å¯¹è±¡ç”Ÿå­˜æœŸå†…çš„ä»»ä½•æ—¶å€™ï¼Œè´¦æˆ·ä¸­çš„ä½™é¢éƒ½æ˜¯balanceæ•°æ®æˆå‘˜ä¸­çš„å€¼ã€‚è¯¥æ•°æ®æˆå‘˜çš„å€¼éšç€è´¦æˆ·çš„å­˜æ¬¾ã€è½¬è´¦ã€å–æ¬¾ä¸æ–­å˜åŒ–ã€‚å› æ­¤ï¼Œè´¦æˆ·ä½™é¢æ˜¯ä¸€ä¸ªåŠ¨æ€å˜åŒ–çš„å€¼ã€‚æ¢è¨€ä¹‹ï¼Œbalance æ•°æ®æˆå‘˜æ˜¯ä¸€ä¸ªåŠ¨æ€å€¼ã€‚<strong>å¯¹è±¡çš„çŠ¶æ€æ˜¯æ‰€æœ‰é™æ€æ€§è´¨ä»¥åŠè¿™äº›é™æ€æ€§è´¨çš„åŠ¨æ€å€¼çš„é›†åˆã€‚</strong></p><h3 id="6-2-å¯¹è±¡çŠ¶æ€çš„é‡è¦æ€§"><a href="#6-2-å¯¹è±¡çŠ¶æ€çš„é‡è¦æ€§" class="headerlink" title="6.2 å¯¹è±¡çŠ¶æ€çš„é‡è¦æ€§"></a>6.2 å¯¹è±¡çŠ¶æ€çš„é‡è¦æ€§</h3><p>å¯¹è±¡å¦‚ä½•å“åº”æˆ‘ä»¬çš„å‘½ä»¤ï¼ˆæ“ä½œï¼‰ä»¥åŠå¯¹å…¶ä»–å¯¹è±¡ï¼ˆå®¢æˆ·ï¼‰åšä»€ä¹ˆï¼Œéƒ½ç›´æ¥ä¾èµ–äºå¯¹è±¡çš„çŠ¶æ€ï¼›æ‰§è¡ŒæŸæ–¹æ³•æ‰€å¾—çš„ç»“æœä¹Ÿç›´æ¥ä¾èµ–äºå¯¹è±¡çš„çŠ¶æ€ã€‚</p><h3 id="6-3-è°æ§åˆ¶å¯¹è±¡çš„çŠ¶æ€"><a href="#6-3-è°æ§åˆ¶å¯¹è±¡çš„çŠ¶æ€" class="headerlink" title="6.3 è°æ§åˆ¶å¯¹è±¡çš„çŠ¶æ€"></a>6.3 è°æ§åˆ¶å¯¹è±¡çš„çŠ¶æ€</h3><p>å¯¹è±¡çš„çŠ¶æ€é€šè¿‡æˆå‘˜å‡½æ•°ä¿®æ”¹ã€‚ç±»å‡å®šæ— æ³•ä»å¤–éƒ¨ä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ã€‚æ‰€æœ‰ä¸è®©æ™®é€šå®¢æˆ·è®¿é—®çš„æ•°æ®éƒ½åº”å°è£…åœ¨ç±»çš„privateåŒºåŸŸä¸­ã€‚è¿™ä¹Ÿç§°ä¸º<strong>æ•°æ®å°è£…ï¼ˆdata encapsulationï¼‰</strong>ã€‚</p><h3 id="6-4-å¯¹è±¡çš„è¡Œä¸º"><a href="#6-4-å¯¹è±¡çš„è¡Œä¸º" class="headerlink" title="6.4 å¯¹è±¡çš„è¡Œä¸º"></a>6.4 å¯¹è±¡çš„è¡Œä¸º</h3><p>å¯¹è±¡çš„è¡Œä¸ºåœ¨æŸç§æ–¹å¼ä¸Šæ˜¯å¯¹å®¢æˆ·è°ƒç”¨æ¶ˆæ¯çš„å“åº”ã€‚è¡Œä¸ºæ˜¯å¯¹è±¡å¯¹æ¶ˆæ¯é‡‡å–çš„è¡ŒåŠ¨å’Œåšå‡ºçš„ååº”ã€‚æ¶ˆæ¯ä¼šå¼•èµ·çŠ¶æ€çš„å˜åŒ–ï¼Œä¹Ÿä¼šå¼•èµ·å‘é€æ›´å¤šçš„æ¶ˆæ¯è‡³å…¶ä»–å¯¹è±¡ï¼Œæˆ–ä¸¤è€…å…¼æœ‰ä¹‹ã€‚</p><h2 id="7-é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘çš„é˜¶æ®µ"><a href="#7-é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘çš„é˜¶æ®µ" class="headerlink" title="7 é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘çš„é˜¶æ®µ"></a>7 é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘çš„é˜¶æ®µ</h2><h3 id="7-1-é¢å‘å¯¹è±¡åˆ†æOOA"><a href="#7-1-é¢å‘å¯¹è±¡åˆ†æOOA" class="headerlink" title="7.1 é¢å‘å¯¹è±¡åˆ†æOOA"></a>7.1 é¢å‘å¯¹è±¡åˆ†æOOA</h3><p>ä»ç®€å•æè¿°é—®é¢˜å¼€å§‹ï¼ˆå¤§å¤šæ•°éƒ½ä¸å®Œæ•´ï¼‰ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„èµ·ç‚¹ã€‚åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°åˆé€‚çš„ç±»ã€‚</p><p>é¢å‘å¯¹è±¡åˆ†æï¼ˆObject-Oriented Analysisï¼Œç¼©å†™OOAï¼‰æ¶‰åŠä»ç±»å’Œå¯¹è±¡çš„è§’åº¦åˆ†æé—®é¢˜ï¼Œè¿™äº›ç±»å’Œå¯¹è±¡éƒ½è¦ä»é—®é¢˜é¢†åŸŸï¼ˆproblem domainï¼‰ä¸­æ‰¾å‡ºã€‚ä½†æ˜¯ï¼Œè¿™äº›ç±»å¹¶ä¸æ˜¯åœ¨æœ€ç»ˆå®ç°ä¸­èƒ½ç›´æ¥ä½¿ç”¨çš„ç±»ã€‚æ•´ä¸ªè¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå»ºæ¨¡ç»ƒä¹ ï¼Œå³å°è¯•å»ºç«‹é—®é¢˜é¢†åŸŸçš„æ¨¡å‹ã€‚æœ¬é˜¶æ®µçš„ä»»åŠ¡ä¸»è¦æ˜¯ï¼Œå½»åº•åœ°åˆ†æé—®é¢˜å’Œæ˜ç¡®åœ°æŒ‡å®šè¦æ±‚ã€‚è¦åœ¨å®¢æˆ·çš„é—®é¢˜é¢†åŸŸæ‰¾å‡ºç±»å’Œå¯¹è±¡ï¼Œå¹¶ç”¨å…¶å®Œæ•´åœ°æè¿°ä»€ä¹ˆæ–¹æ¡ˆå¯è¡Œï¼Œä»€ä¹ˆæ–¹æ¡ˆä¸å¯è¡Œã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬åº”é‡‡ç”¨å®¢æˆ·èƒ½å¤Ÿç†è§£çš„ç±»å’Œå¯¹è±¡æ¥æè¿°é—®é¢˜ã€‚è¿™äº›ç±»å’Œå¯¹è±¡éƒ½å¯ä»¥ç›´æ¥åœ¨é—®é¢˜é¢†åŸŸä¸­æ‰¾åˆ°ã€‚</p><p>åœ¨OOAé˜¶æ®µä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å°†æ³¨æ„åŠ›æ”¾åœ¨é—®é¢˜é¢†åŸŸä¸­ä½¿ç”¨çš„ç±»ï¼Œè€Œéå®ç°ä¸­ä½¿ç”¨çš„ç±»ã€‚å®ç°çš„ç»†èŠ‚å°†åœ¨é¢å‘å¯¹è±¡è®¾è®¡ï¼ˆOODï¼‰é˜¶æ®µå®ç°ã€‚</p><h3 id="7-2-é¢å‘å¯¹è±¡è®¾è®¡OOD"><a href="#7-2-é¢å‘å¯¹è±¡è®¾è®¡OOD" class="headerlink" title="7.2 é¢å‘å¯¹è±¡è®¾è®¡OOD"></a>7.2 é¢å‘å¯¹è±¡è®¾è®¡OOD</h3><p>OODï¼ˆé¢å‘å¯¹è±¡è®¾è®¡ï¼‰é˜¶æ®µåœ¨OOAï¼ˆé¢å‘å¯¹è±¡åˆ†æï¼‰é˜¶æ®µä¹‹åï¼Œåœ¨æœ¬é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å°†åœ¨OOAé˜¶æ®µå¼€å‘çš„æ¡†æ¶ä¸­åŠ å…¥ç»†èŠ‚ï¼Œå¾…è§£å†³çš„é—®é¢˜å°†è¢«åˆ†è§£ä¸ºç±»å’Œå¯¹è±¡ç”¨äºå®ç°ä¸­ã€‚æœ¬é˜¶æ®µéœ€è¦å®Œæˆçš„ä»»åŠ¡åŒ…æ‹¬<strong>å®šä¹‰ç±»ä¹‹é—´çš„å…³ç³»</strong>ã€<strong>æè¿°å¯¹è±¡å¦‚ä½•æ‰èƒ½é€‚åº”ç³»ç»Ÿçš„è¿›ç¨‹æ¨¡å‹</strong>ã€<strong>å¦‚ä½•è·¨åœ°å€ç©ºé—´åˆ’åˆ†å¯¹è±¡</strong>ã€<strong>ç³»ç»Ÿå¦‚ä½•å®ŒæˆåŠ¨æ€è¡Œä¸º</strong>ç­‰ã€‚</p><p><strong>æ‰¾åˆ°é‚£äº›éš¾ä»¥ç¢ç£¨çš„å¯¹è±¡</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯å°†é—®é¢˜ä¸­çš„ä¸‹åˆ—å®ä½“è½¬åŒ–ä¸ºç±»ï¼š</p><ul><li>äººï¼Œä½ç½®å’Œä¸œè¥¿ï¼›</li><li>äº‹ä»¶â€”â€”é¼ æ ‡è¾“å…¥ã€å‡ºç”Ÿã€æ­»äº¡ç­‰ï¼›</li><li>äº¤æ˜“â€”â€”åŒæ„è´·æ¬¾ã€æ±½è½¦é”€å”®ç­‰ï¼›</li><li>äººæ‰€æ‰®æ¼”çš„è§’è‰²â€”â€”çˆ¶äº²ã€æ¯äº²ç­‰ã€‚</li></ul><h3 id="7-3-é¢å‘å¯¹è±¡ç¼–ç¨‹OOP"><a href="#7-3-é¢å‘å¯¹è±¡ç¼–ç¨‹OOP" class="headerlink" title="7.3 é¢å‘å¯¹è±¡ç¼–ç¨‹OOP"></a>7.3 é¢å‘å¯¹è±¡ç¼–ç¨‹OOP</h3><p>è¿™æ˜¯é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘ç¯èŠ‚çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚å°† OOD é˜¶æ®µçš„æˆæœè¾“å‡ºï¼Œå°†å…¶è¾“å…¥è‡³OOP é˜¶æ®µä¸­ã€‚</p><h2 id="8-å¯¹è±¡æ¨¡å‹çš„å…³é”®è¦ç´ "><a href="#8-å¯¹è±¡æ¨¡å‹çš„å…³é”®è¦ç´ " class="headerlink" title="8 å¯¹è±¡æ¨¡å‹çš„å…³é”®è¦ç´ "></a>8 å¯¹è±¡æ¨¡å‹çš„å…³é”®è¦ç´ </h2><p>å»ºç«‹å¯¹è±¡æ¨¡å‹çš„å…³é”®è¦ç´ ï¼š</p><ul><li>æ•°æ®æŠ½è±¡</li><li>å°è£…</li><li>å±‚æ¬¡</li></ul><p><strong>æ•°æ®æŠ½è±¡ï¼ˆdata abstractionï¼‰</strong>æ˜¯ä¸ºäº†å¼ºè°ƒå¯¹è±¡çš„ç›¸ä¼¼æ€§ï¼Œå¿½ç•¥å…¶å·®å¼‚æ€§æ¥å®šä¹‰ç±»ã€‚åœ¨è¡¨ç°ç±»ï¼ˆæŠ½è±¡ï¼‰çš„ä¸»è¦ç‰¹æ€§æ—¶ï¼Œåº”é¿å…å±•ç°é‚£äº›ä¸é‡è¦çš„å’Œåˆ†æ•£æ³¨æ„åŠ›çš„å…ƒç´ ã€‚å®é™…ä¸Šï¼Œç±»å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ã€‚é¡ºå¸¦ä¸€æï¼ŒæŠ½è±¡å°†é‡ç‚¹æ”¾åœ¨å¯¹è±¡çš„å¤–éƒ¨è§†å›¾ä¸Šï¼Œå¹¶å°†å¯¹è±¡å¿…ä¸å¯å°‘çš„è¡Œä¸ºä»å†…éƒ¨çš„å®ç°ç»†èŠ‚ä¸­åˆ†ç¦»å‡ºæ¥ã€‚</p><p><strong>å°è£…ï¼ˆencapsulationï¼‰</strong>æ˜¯ä¸ºäº†éšè—æŠ½è±¡çš„å†…éƒ¨å®ç°ç»†èŠ‚ã€‚å®ƒå°†æŠ½è±¡çš„å¤–éƒ¨æ¥å£ä»å†…éƒ¨å®ç°ç»†èŠ‚ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å°è£…å’ŒæŠ½è±¡å½¼æ­¤äº’è¡¥ã€‚ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„æŠ½è±¡ä¼šå°è£…ä¸€äº›æˆå‘˜ï¼Œè€Œè¢«å°è£…çš„å®ä½“åˆ™å¸®åŠ©æŠ½è±¡ä¿æŒå®Œæ•´æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæŠ½è±¡å…ˆäºå°è£…ã€‚å¦å¤–ï¼Œåªæœ‰åœ¨å¼€å§‹å®ç°æ—¶ï¼Œæ‰åº”è¯¥å°†æ³¨æ„åŠ›æ”¾åœ¨å°è£…ä¸Šã€‚</p><p><strong>å±‚æ¬¡ï¼ˆhierarchyï¼‰</strong>æ˜¯ä¸ºäº†æ”¯æŒæŠ½è±¡çš„æœ‰åºã€‚æŠ½è±¡å¾ˆå¼ºå¤§å¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨ç»å¤§å¤šæ•°é‡å¤§é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆéƒ½ä¼šç”±äºåˆ›å»ºäº†å¤ªå¤šçš„æŠ½è±¡ï¼Œä»¥è‡³äºæ— æ³•ç»Ÿè§‚å¤§å±€ã€‚è™½ç„¶å°è£…å’Œæ¨¡å—åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½ç¼“è§£è¿™ä¸€å±€é¢ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä»é™·å…¥äº†ä¸è®¡å…¶æ•°çš„æŠ½è±¡è¿·é›¾ä¸­ã€‚äººçš„æ€ç»´ä¸€æ¬¡åªèƒ½ç†è§£ä¸€ç»„æœ‰é™çš„æŠ½è±¡ï¼Œæå‡ºå¤ªå¤šæŠ½è±¡å¯¹è¯»è€…è€Œè¨€ç®€ç›´å°±æ˜¯ä¸€æ¬¡ä¿¡æ¯ä¿ç•™æµ‹è¯•ï¼Œå®åœ¨è®©äººéš¾ä»¥æ¶ˆåŒ–ã€‚ä¸ºäº†é¿å…è¿™äº›ä¸åˆ©å› ç´ ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æŠ½è±¡å®‰æ’åœ¨ä¸åŒçš„å±‚æ¬¡ï¼Œè¿™æ ·å³ä¾¿å°šæœªå……åˆ†ç†è§£æŠ½è±¡çš„ä¸»è¦ç‰¹æ€§ï¼Œä¹Ÿå¯å®Œå…¨æ˜ç™½æŸå±‚æ¬¡ä¸­çš„æ‰€æœ‰æŠ½è±¡ã€‚</p><p>åœ¨OOPä¸­æ™®éå­˜åœ¨ä¸¤ç§å±‚æ¬¡ã€‚<strong>ç»§æ‰¿å…³ç³»</strong>æ”¯æŒç±»å±‚æ¬¡ï¼ˆclass hierarchyï¼‰ï¼ˆis-aå…³ç³»ï¼Œè§å›¾1-6ï¼‰ï¼›èšé›†å…³ç³»ï¼ˆaggregation relationï¼‰ï¼ˆhas-aå…³ç³»ï¼Œè§å›¾1-7ï¼‰æ”¯æŒéƒ¨åˆ†-æ•´ä½“æ¦‚å¿µã€‚ç»§æ‰¿ç”¨äºæè¿°ä¸€èˆ¬-ç‰¹æ®Šå…³ç³»ï¼Œè€Œèšé›†ç”¨äºæè¿°æ¶‰åŠåŒ…å«ï¼ˆcontainmentï¼‰å’Œå…±äº«çš„å…³ç³»ã€‚</p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-1/image-20241028185457489.png"></p><p><img src="/../images/OOP-C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B-Chapter-1/image-20241028185508195.png"></p>]]></content>
    
    
    <categories>
      
      <category>é¢å‘å¯¹è±¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>OOP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Xv6 Chapter 8</title>
    <link href="/2024/10/27/MIT-6-1810-Xv6-Chapter-8/"/>
    <url>/2024/10/27/MIT-6-1810-Xv6-Chapter-8/</url>
    
    <content type="html"><![CDATA[<h1 id="File-system"><a href="#File-system" class="headerlink" title="File system"></a>File system</h1><p>æ–‡ä»¶ç³»ç»Ÿçš„åŠŸèƒ½ä¸»è¦å°±æ˜¯ç»„ç»‡ã€å­˜å‚¨ã€å…±äº«æ•°æ®ã€‚</p><h2 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1 Overview"></a>1 Overview</h2><p>xv6çš„æ–‡ä»¶ç³»ç»Ÿç”±ä¸ƒå±‚ç»„æˆã€‚</p><ul><li>disk ï¼šä»¥å—ä¸ºå•ä½ï¼Œè¯»å†™ç¡¬ç›˜</li><li>buffer cacheï¼š<ul><li>ç¼“å­˜ç¡¬ç›˜å—</li><li>åŒæ­¥ï¼šç¡®ä¿æ¯æ¬¡åªæœ‰ä¸€ä¸ªå†…æ ¸è¿›ç¨‹å¯ä»¥ä¿®æ”¹æŸä¸ªç‰¹å®šå—çš„æ•°æ®ã€‚</li></ul></li><li>loggingï¼š<ul><li>å…è®¸é«˜å±‚åœ¨ä¸€ä¸ª<strong>äº‹åŠ¡</strong>ä¸­å¯¹å¤šä¸ªå—è¿›è¡Œæ›´æ–°</li><li>ç¡®ä¿å´©æºƒçš„æ—¶å€™ï¼Œå¤šä¸ªå—çš„æ›´æ–°å…·æœ‰åŸå­æ€§ï¼ˆéƒ½æ›´æ–°æˆ–è€…éƒ½æ²¡æ›´æ–°ï¼‰</li></ul></li><li>inodeï¼šç”¨i-numberå”¯ä¸€æ ‡è¯†äº†ä¸€ä¸ªæ–‡ä»¶</li><li>directoryï¼šç›®å½•æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯ä¸€ç»„ç›®å½•é¡¹ï¼Œæ¯ä¸ªç›®å½•é¡¹åŒ…å«æ–‡ä»¶åå’Œi-number</li><li>pathnameï¼šæä¾›äº†å±‚æ¬¡è·¯å¾„ï¼Œå¹¶é€’å½’çš„è§£æè·¯å¾„</li><li>file descriptorï¼šå¯¹ç®¡é“ã€ç¡¬ä»¶ã€æ–‡ä»¶ç­‰èµ„æºè¿›è¡ŒæŠ½è±¡</li></ul><p><img src="/../images/MIT-6-1810-Xv6-Chapter-8/image-20241027165526300.png" alt="Layers of the xv6 file system"></p><p>ç¡¬ç›˜ä¼ ç»Ÿä¸Šä»¥ 512 å­—èŠ‚å—ï¼ˆä¹Ÿç§°ä¸ºæ‰‡åŒºï¼‰çš„ç¼–å·åºåˆ—æ¥ç»„ç»‡ç£ç›˜ä¸Šçš„æ•°æ®ã€‚æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨çš„å—å¤§å°å¯èƒ½ä¸ç£ç›˜ä½¿ç”¨çš„æ‰‡åŒºå¤§å°ä¸åŒï¼Œä½†é€šå¸¸å—å¤§å°æ˜¯æ‰‡åŒºå¤§å°çš„å€æ•°ã€‚Xv6 å°†è¯»å–åˆ°å†…å­˜ä¸­çš„æ•°æ®å—å‰¯æœ¬ä¿å­˜åœ¨ <code>struct buf</code> ç±»å‹çš„å¯¹è±¡ä¸­ï¼ˆkernel&#x2F;buf.h:1ï¼‰ã€‚å­˜å‚¨åœ¨æ­¤ç»“æ„ä¸­çš„æ•°æ®æœ‰æ—¶ä¸ç£ç›˜ä¸åŒæ­¥ï¼šè¿™äº›æ•°æ®å¯èƒ½å°šæœªä»ç£ç›˜è¯»å…¥ï¼ˆç£ç›˜æ­£åœ¨å¤„ç†è¿™äº›æ•°æ®ï¼Œä½†å°šæœªè¿”å›æ‰‡åŒºå†…å®¹ï¼‰ï¼Œä¹Ÿå¯èƒ½å·²è¢«è½¯ä»¶æ›´æ–°ï¼Œä½†å°šæœªå†™å…¥ç£ç›˜ã€‚</p><p>xv6 å°†ç£ç›˜åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ã€‚</p><ul><li>æ–‡ä»¶ç³»ç»Ÿä¸ä½¿ç”¨å— 0ï¼ˆå­˜æ”¾å¼•å¯¼æ‰‡åŒºï¼‰ã€‚</li><li>å— 1 æ˜¯è¶…çº§å—ï¼ŒåŒ…å«æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼ˆä»¥å—ä¸ºå•ä½çš„æ–‡ä»¶ç³»ç»Ÿå¤§å°ã€æ•°æ®å—æ•°ã€inodes æ•°å’Œlogä¸­çš„å—æ•°ï¼‰ã€‚è¶…çº§å—ç”±åä¸º mkfs çš„å•ç‹¬ç¨‹åºå¡«å……ï¼Œè¯¥ç¨‹åºè´Ÿè´£æ„å»ºåˆå§‹æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>ä» 2 å¼€å§‹çš„å—å­˜æ”¾æ—¥å¿—ã€‚</li><li>æ—¥å¿—ä¹‹åæ˜¯inodesï¼Œæ¯ä¸ªå—åŒ…å«å¤šä¸ªinodeã€‚</li><li>ä¹‹åæ˜¯ä½å›¾å—ï¼Œç”¨äºè·Ÿè¸ªæ­£åœ¨ä½¿ç”¨çš„æ•°æ®å—ã€‚</li><li>å…¶ä½™çš„å—æ˜¯æ•°æ®å—</li></ul><p><img src="/../images/MIT-6-1810-Xv6-Chapter-8/image-20241027172905942.png"></p><h2 id="Buffer-cache-layer"><a href="#Buffer-cache-layer" class="headerlink" title="Buffer cache layer"></a>Buffer cache layer</h2><p>è¯¥å±‚æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>åŒæ­¥å¯¹ç¡¬ç›˜å—çš„è®¿é—®ï¼Œç¡®ä¿æ¯ä¸ªç¡¬ç›˜å—åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½æ‹·è´ï¼Œå¹¶ä¸”æ¯æ¬¡åªæœ‰ä¸€ä¸ªå†…æ ¸çº¿ç¨‹èƒ½å¤Ÿè®¿é—®æŸå—æ•°æ®ã€‚</li><li>ç¼“å­˜ç¡¬ç›˜å—</li></ol><p>è¯¥å±‚é‡‡ç”¨LRUç­–ç•¥ï¼Œå½“æ–‡ä»¶ç³»ç»Ÿè¯·æ±‚ä¸€ä¸ªæ–°çš„ç¡¬ç›˜å—çš„æ—¶å€™ï¼Œå¦‚æœæ­¤æ—¶ç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™éœ€è¦æ›¿æ¢ä¸€ä¸ªæœ€ä¹…æœªä½¿ç”¨çš„å—å‡ºç¼“å†²åŒºã€‚</p><p>ä¸ºäº†ç¡®ä¿åŒæ­¥è®¿é—®ï¼Œæ¯ä¸ª <code>buf</code> éƒ½æœ‰ä¸€ä¸ª sleep-lock é”ï¼Œ<code>bread</code> è¿”å›ä¸€ä¸ªä¸Šé”çš„ <code>buf</code> ï¼Œå½“æŸä¸ªçº¿ç¨‹ä½¿ç”¨å®Œè¿™ä¸ª <code>buf</code> ä¹‹åï¼Œéœ€è¦è°ƒç”¨ <code>brelse</code> é‡Šæ”¾è¿™ä¸ªé”ã€‚</p><h2 id="Code-Buffer-cache"><a href="#Code-Buffer-cache" class="headerlink" title="Code: Buffer cache"></a>Code: Buffer cache</h2><p>ç¼“å†²ç”±ä¸€ä¸ªåŒå‘é“¾è¡¨ç®¡ç†ï¼Œé“¾è¡¨å¤´ç»“ç‚¹æ˜¯æœ€è¿‘ä½¿ç”¨çš„ç»“ç‚¹ï¼Œå°¾ç»“ç‚¹æ˜¯æœ€ä¹…æœªä½¿ç”¨çš„ç»“ç‚¹ã€‚</p><p>æ¯ä¸ª <code>buf</code> æœ‰ä¸¤ä¸ªçŠ¶æ€ä½ï¼š</p><ul><li><code>valid</code> ï¼šè¡¨ç¤º <code>buf</code> æ˜¯å¦æŒæœ‰ç¡¬ç›˜å—çš„ä¸€ä»½æ‹·è´</li><li><code>disk</code> ï¼šè¡¨ç¤º <code>buf</code> çš„å†…å®¹è¢«ç§»äº¤ç»™ç¡¬ç›˜ï¼Œæœ‰å¯èƒ½å¯¼è‡´ <code>buf</code> çš„å†…å®¹å‘ç”Ÿæ”¹å˜ã€‚</li></ul><p><code>bcache</code> è´Ÿè´£ç»´æŠ¤åŒå‘é“¾è¡¨çš„å¤´ç»“ç‚¹å’Œä¸€ä¸ªè‡ªæ—‹é”ï¼Œè¯¥é”ä¿æŠ¤ç¼“å­˜å—çš„ä¿¡æ¯ï¼Œè€Œæ¯ä¸ª <code>buf</code> çš„é”åˆ™è´Ÿè´£ä¿æŠ¤å¯¹è¯¥å—å†…å®¹çš„è¯»å†™ã€‚</p><p>éœ€è¦ç¡®ä¿æ¯ä¸ªç¡¬ç›˜å—è‡³å¤šåªæœ‰ä¸€ä»½ç¼“å­˜ï¼Œè¿™éœ€è¦ç¡®ä¿å¯¹äºæŸä¸ªå—æ˜¯å¦åœ¨ç¼“å­˜ä¸­çš„æ£€æŸ¥å’Œå¯¹è¯¥å—åˆ†é…ç¼“å­˜å—çš„æ“ä½œæ˜¯åŸå­çš„ã€‚è‹¥è¯¥æ“ä½œä¸æ˜¯åŸå­çš„ï¼ŒæŸä¸ªå†…æ ¸çº¿ç¨‹æ£€æŸ¥æŸä¸ªå—aï¼Œå‘ç°å…¶ä¸åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åæ‰§è¡Œå¦å¤–ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œè¯¥å—åŒæ ·æ£€æŸ¥å—aï¼Œå‘ç°ä¸åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åä¸ºè¯¥å—åˆ†é…äº†ä¸€ä¸ªç¼“å­˜ï¼Œæ¥ä¸‹æ¥å›åˆ°ç¬¬ä¸€ä¸ªå†…æ ¸çº¿ç¨‹æ‰§è¡Œï¼Œè¯¥çº¿ç¨‹ç”±äºå·²ç»å®Œæˆäº†æ£€æŸ¥ï¼Œåˆä¸ºå—aåˆ†é…äº†å¦ä¸€ä¸ªç¼“å­˜ï¼Œå¯¼è‡´å—aåœ¨ç¼“å­˜ä¸­æœ‰ä¸¤ä»½æ‹·è´ã€‚</p><p>å¦‚æœæ‰€æœ‰çš„ <code>buf</code> æ­¤æ—¶éƒ½åœ¨è¢«è®¿é—®ï¼Œåˆ™ <code>bget</code> ä¼španicã€‚</p><p>å¦‚æœæŸä¸ªçº¿ç¨‹ä¿®æ”¹äº† <code>buf</code> çš„å†…å®¹ï¼Œåˆ™å®ƒåœ¨é‡Šæ”¾è¯¥ <code>buf</code> ä¹‹å‰ï¼Œå¿…é¡»è°ƒç”¨ <code>bwrite</code> æŠŠä¿®æ”¹å†™å›ç¡¬ç›˜ã€‚</p><p>å½“æŸä¸ªçº¿ç¨‹ç”¨å®Œäº† <code>buf</code> ï¼Œå¿…é¡»è°ƒç”¨ <code>brelse</code> å»é‡Šæ”¾è¯¥ <code>buf</code> ï¼Œè¯¥è°ƒç”¨é‡Šæ”¾è¯¥ <code>buf</code> çš„é”ï¼Œç„¶åå°†è¯¥ <code>buf</code> ç§»åŠ¨åˆ°é“¾è¡¨å¤´ã€‚</p><h2 id="Logging-layer"><a href="#Logging-layer" class="headerlink" title="Logging layer"></a>Logging layer</h2><p>xv6é€šè¿‡æ—¥å¿—è§£å†³æ–‡ä»¶ç³»ç»Ÿæ“ä½œè¿‡ç¨‹ä¸­çš„å´©æºƒé—®é¢˜ã€‚</p><p>ç³»ç»Ÿè°ƒç”¨ä¸ä¼šç›´æ¥å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯åœ¨ç£ç›˜çš„æ—¥å¿—ä¸­è®°å½•å¯¹ç£ç›˜çš„å†™å…¥æ“ä½œï¼Œå½“ç³»ç»Ÿè°ƒç”¨è®°å½•äº†æ‰€æœ‰å†™å…¥æ“ä½œï¼Œä»–ä¼šå‘ç£ç›˜å†™å…¥ä¸€æ¡ç‰¹æ®Šçš„æäº¤è®°å½•ï¼Œè¡¨æ˜è¯¥æ—¥å¿—å·²ç»åŒ…å«ä¸€ä¸ªå®Œæ•´çš„æ“ä½œã€‚ä¹‹åï¼Œç³»ç»Ÿè°ƒç”¨ä¼šå°†å†™å…¥å†…å®¹å¼€å§‹å®é™…å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œå†™å®Œåï¼Œå°†æ—¥å¿—æ¸…é™¤ã€‚</p><p>å¦‚æœç³»ç»Ÿå´©æºƒå¹¶é‡æ–°å¯åŠ¨ï¼Œåœ¨è¿è¡Œä»»ä½•è¿›ç¨‹ä¹‹å‰ï¼Œæ–‡ä»¶ç³»ç»Ÿä»£ç ä¼šæŒ‰å¦‚ä¸‹æ–¹å¼ä»å´©æºƒä¸­æ¢å¤ï¼š</p><ul><li>å¦‚æœæ—¥å¿—è¢«æ ‡è®°ä¸ºåŒ…å«å®Œæ•´æ“ä½œï¼Œé‚£ä¹ˆæ¢å¤ä»£ç ä¼šå°†å†™å…¥å†…å®¹å¤åˆ¶åˆ°ç£ç›˜æ–‡ä»¶ç³»ç»Ÿä¸­å±äºå®ƒä»¬çš„ä½ç½®ã€‚</li><li>å¦‚æœæ—¥å¿—æœªæ ‡è®°ä¸ºåŒ…å«å®Œæ•´æ“ä½œï¼Œåˆ™æ¢å¤ä»£ç ä¼šå¿½ç•¥æ—¥å¿—ã€‚</li><li>æ¢å¤ä»£ç æœ€åä¼šæ“¦é™¤æ—¥å¿—ã€‚</li></ul><h2 id="Log-design"><a href="#Log-design" class="headerlink" title="Log design"></a>Log design</h2><p>æ—¥å¿—ä½äºè¶…çº§å—ä¸­æŒ‡å®šçš„å·²çŸ¥å›ºå®šä½ç½®ã€‚æ—¥å¿—ç”±ä¸€ä¸ªæ ‡é¢˜å—å’Œä¸€ç³»åˆ—æ›´æ–°å—å‰¯æœ¬ï¼ˆâ€œæ—¥å¿—å—â€ï¼‰ç»„æˆã€‚æ ‡é¢˜å—åŒ…å«ä¸€ä¸ªæ‰‡åŒºå·æ•°ç»„ï¼ˆæ¯ä¸ªæ—¥å¿—å—ä¸€ä¸ªï¼‰å’Œæ—¥å¿—å—è®¡æ•°ã€‚ç£ç›˜æ ‡é¢˜å—ä¸­çš„è®¡æ•°è¦ä¹ˆä¸ºé›¶ï¼Œè¡¨ç¤ºæ—¥å¿—ä¸­æ²¡æœ‰äº‹åŠ¡ï¼›è¦ä¹ˆä¸ºéé›¶ï¼Œè¡¨ç¤ºæ—¥å¿—ä¸­åŒ…å«ä¸€ä¸ªå®Œæ•´çš„å·²æäº¤äº‹åŠ¡ã€‚Xv6 ä¼šåœ¨äº‹åŠ¡æäº¤æ—¶å†™å…¥æ ‡é¢˜å—ï¼Œè€Œä¸ä¼šåœ¨äº‹åŠ¡æäº¤å‰å†™å…¥ï¼Œå¹¶åœ¨å°†æ—¥å¿—å—ä¸­æŒ‡å®šçš„æ“ä½œå®Œæˆåå°†è®¡æ•°è®¾ä¸ºé›¶ã€‚ </p><p>æ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„ä»£ç æ ‡è®°äº†éœ€è¦åŸå­å†™å…¥çš„ä¸€ç³»åˆ—æ“ä½œï¼ˆå³è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥çš„å†™å…¥æ“ä½œï¼‰ã€‚ä¸ºäº†å…è®¸å¤šä¸ªè¿›ç¨‹å¹¶å‘æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œæ—¥å¿—ç³»ç»Ÿå¯ä»¥å°†å¤šä¸ªç³»ç»Ÿè°ƒç”¨çš„å†™å…¥æ“ä½œç´¯ç§¯æˆä¸€ä¸ªäº‹åŠ¡ã€‚è¿™ç§æ–¹å¼å…è®¸ç³»ç»Ÿåœ¨å•ä¸ªæäº¤ä¸­å¤„ç†å¤šä¸ªç³»ç»Ÿè°ƒç”¨çš„å†™å…¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ã€‚</p><p>ä¸ºäº†é¿å…å°†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨åˆ†æˆå¤šä¸ªäº‹åŠ¡ï¼Œæ—¥å¿—ç³»ç»Ÿåªæœ‰åœ¨æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿè°ƒç”¨è¿›è¡Œæ—¶æ‰ä¼šæäº¤äº‹åŠ¡ã€‚</p><p>å°†å¤šä¸ªäº‹åŠ¡ä¸€èµ·æäº¤çš„æƒ³æ³•è¢«ç§°ä¸ºåˆ†ç»„æäº¤ã€‚åˆ†ç»„æäº¤å¯å‡å°‘ç£ç›˜æ“ä½œæ¬¡æ•°ï¼Œå› ä¸ºå®ƒå°†æäº¤çš„å›ºå®šæˆæœ¬åˆ†æ‘Šåˆ°å¤šä¸ªæ“ä½œä¸­ã€‚</p><h2 id="Code-logging"><a href="#Code-logging" class="headerlink" title="Code: logging"></a>Code: logging</h2><p>ç³»ç»Ÿè°ƒç”¨ä¸­å¯¹æ—¥å¿—çš„ä¸€ä¸ªå…¸å‹ç”¨æ³•ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">begin_op();<br><span class="hljs-comment">// ...</span><br>bp = bread(...);<br>bp-&gt;data[..] = ...;<br>log_write(bp);<br><span class="hljs-comment">// ...</span><br>end_op();<br></code></pre></td></tr></table></figure><p><code>begin_op</code> ç­‰å¾…æ—¥å¿—ç³»ç»Ÿå®Œæˆæäº¤ï¼Œæˆ–è€…æœ‰è¶³å¤Ÿçš„ç©ºé—´è®°å½•æ‰€æœ‰å†™å…¥å—ã€‚<code>log.outstanding</code> è¡¨ç¤ºç›®å‰æ­£åœ¨æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨çš„ä¸ªæ•°ï¼Œå¯ä»¥ä¿è¯æäº¤ä¸ä¼šå‘ç”Ÿåœ¨æŸä¸ªç³»ç»Ÿè°ƒç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚</p><p><code>log_write</code> æ˜¯ <code>bwrite</code> çš„ä»£ç†ã€‚å®ƒåœ¨å†…å­˜ä¸­è®°å½•äº†éœ€è¦å†™å…¥çš„å—å·ï¼Œå¹¶ä¸”å°† <code>buf</code> çš„ <code>refcnt</code> å­—æ®µåŠ 1ï¼Œç¡®ä¿è¯¥å—åœ¨æäº¤ä¹‹å‰ä¸€ç›´ä¿ç•™åœ¨ç¼“å­˜ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å¯¹æŸä¸ªå—å¤šæ¬¡å†™å…¥ï¼Œ<code>log_wirte</code> åªä¼šä¿ç•™ä¸€ä¸ªè®°å½•ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼Œè¿™ç§ä¼˜åŒ–æŠ€æœ¯ç§°ä¸º absorptionã€‚</p><p><code>end_op</code> é¦–å…ˆå°† <code>log.outstanding</code> å‡1ï¼Œå¦‚æœ <code>log.outstanding</code> ç°åœ¨æ˜¯0ï¼Œè¡¨ç¤ºè¯¥äº‹åŠ¡æ˜¯æœ€åä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆå¯ä»¥æäº¤ã€‚</p><p><code>commit</code> åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p><ol><li><code>write_log</code> å°†éœ€è¦è®°å½•çš„å—å†™å…¥åˆ°ç£ç›˜ä¸­çš„logä¸­ã€‚</li><li><code>write_head</code> å°†å½“å‰å†…å­˜ä¸­çš„æ ‡é¢˜å—å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚è¿™æ˜¯å®é™…çš„æäº¤ç‚¹ï¼Œåœ¨è¯¥å†™å…¥ä¹‹åçš„å´©æºƒï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œå´©æºƒå‰çš„äº‹åŠ¡ã€‚</li><li><code>install_trans</code> å°†logä¸­çš„å—å†™å…¥åˆ°å®é™…çš„å—ã€‚</li><li>å°†æ ‡é¢˜å—ä¸­çš„countç½®0</li></ol><h2 id="Code-Block-allocator"><a href="#Code-Block-allocator" class="headerlink" title="Code: Block allocator"></a>Code: Block allocator</h2><p>xv6ç”¨ä½å›¾æ¥ç®¡ç†ç©ºé—²å—ã€‚</p><p><code>balloc</code> åœ¨ä½å›¾ä¸­æ‰¾ä¸€ä¸ªç©ºé—²ä½ã€‚</p><p><code>bfree</code> åœ¨ä½å›¾ä¸­æ¸…é™¤ä¸€ä¸ªä½ã€‚</p><p>è¿™ä¸¤ä¸ªå‡½æ•°å¿…é¡»åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è°ƒç”¨ã€‚</p><h2 id="Inode-layer"><a href="#Inode-layer" class="headerlink" title="Inode layer"></a>Inode layer</h2><p>Inode ä¸€è¯æœ‰ä¸¤ç§å«ä¹‰ï¼š</p><ul><li>å®ƒå¯ä»¥æŒ‡åŒ…å«æ–‡ä»¶å¤§å°å’Œæ•°æ®å—ç¼–å·åˆ—è¡¨çš„ç£ç›˜æ•°æ®ç»“æ„ã€‚</li><li>æˆ–è€…ï¼Œâ€œinode â€å¯èƒ½æŒ‡å†…å­˜ä¸­çš„ inodeï¼Œå®ƒåŒ…å«ç£ç›˜ inode çš„å‰¯æœ¬ä»¥åŠå†…æ ¸æ‰€éœ€çš„é¢å¤–ä¿¡æ¯ã€‚</li></ul><p><strong>on-disk inode</strong></p><p>ç£ç›˜ä¸Šçš„inodeè¢«æ‰“åŒ…åˆ°ç£ç›˜ä¸Šçš„ä¸€ä¸ªè¿ç»­åŒºåŸŸï¼Œæ¯ä¸ªinodeçš„å¤§å°éƒ½æ˜¯å›ºå®šçš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// On-disk inode structure</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dinode</span> &#123;</span><br>  <span class="hljs-type">short</span> type;           <span class="hljs-comment">// File type</span><br>  <span class="hljs-type">short</span> major;          <span class="hljs-comment">// Major device number (T_DEVICE only)</span><br>  <span class="hljs-type">short</span> minor;          <span class="hljs-comment">// Minor device number (T_DEVICE only)</span><br>  <span class="hljs-type">short</span> nlink;          <span class="hljs-comment">// Number of links to inode in file system</span><br>  uint size;            <span class="hljs-comment">// Size of file (bytes)</span><br>  uint addrs[NDIRECT+<span class="hljs-number">1</span>];   <span class="hljs-comment">// Data block addresses</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>in-memory inode</strong></p><p>å†…æ ¸åœ¨ <code>itable</code> ä¸­ç®¡ç†in-memory inodeã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// in-memory copy of an inode</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> &#123;</span><br>  uint dev;           <span class="hljs-comment">// Device number</span><br>  uint inum;          <span class="hljs-comment">// Inode number</span><br>  <span class="hljs-type">int</span> ref;            <span class="hljs-comment">// Reference count</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sleeplock</span> <span class="hljs-title">lock</span>;</span> <span class="hljs-comment">// protects everything below here</span><br>  <span class="hljs-type">int</span> valid;          <span class="hljs-comment">// inode has been read from disk?</span><br><br>  <span class="hljs-type">short</span> type;         <span class="hljs-comment">// copy of disk inode</span><br>  <span class="hljs-type">short</span> major;<br>  <span class="hljs-type">short</span> minor;<br>  <span class="hljs-type">short</span> nlink;<br>  uint size;<br>  uint addrs[NDIRECT+<span class="hljs-number">1</span>];<br>&#125;;<br></code></pre></td></tr></table></figure><p>å†…æ ¸åªæœ‰åœ¨å½“å‰æœ‰cæŒ‡é’ˆå¼•ç”¨è¯¥inodeçš„æ—¶å€™ï¼Œæ‰ä¼šå°†å…¶åŠ è½½åˆ° <code>itable</code> ä¸­ã€‚</p><p>xv6ä¸­å…³äºinodeæœ‰å››ç§é”ï¼š</p><ul><li><code>itable.lock</code> ä¿è¯æŸä¸ªinodeè‡³å¤šåªåœ¨ <code>itable</code> ä¸­å‡ºç°ä¸€æ¬¡ã€‚å¹¶ä¸”ä¿è¯ <code>ref</code> å­—æ®µçš„ä¸€è‡´æ€§ã€‚</li><li><code>inode.lock</code> ä¿è¯å¯¹ <code>inode</code> çš„äº’æ–¥è®¿é—®ã€‚</li><li><code>ref</code> å­—æ®µä¿è¯ç³»ç»Ÿä¸è¦é‡ç”¨å…¶ <code>itable</code> ä¸­çš„inodeã€‚</li><li><code>unlink</code> å­—æ®µç»´æŠ¤å¼•ç”¨æŸä¸ªæ–‡ä»¶çš„ç›®å½•é¡¹ä¸ªæ•°ã€‚</li></ul><p><code>iget</code> è¿”å›çš„inodeä¿è¯æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œä¸”ä¸æ˜¯äº’æ–¥è®¿é—®çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>iget</code> è¿”å›çš„inodeåªä¿è¯æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯å†…å®¹å¹¶ä¸ä¸€å®šæœ‰ç”¨ï¼Œå¿…é¡»è°ƒç”¨ <code>ilock</code> å°†å…¶ä»ç¡¬ç›˜ä¸­è¯»å…¥å†…å­˜ä¸­ã€‚è¿™ç§åˆ†ç¦»æœºåˆ¶å¸®åŠ©é¿å…ä¸€äº›æ­»é”æƒ…å†µã€‚</p><h2 id="Code-Inodes"><a href="#Code-Inodes" class="headerlink" title="Code: Inodes"></a>Code: Inodes</h2><p><code>ialloc</code> éå†æ‰€æœ‰inodeï¼Œæ‰¾å‡ºä¸€ä¸ªç©ºé—²çš„inodeç»“ç‚¹å¹¶åˆ†é…ä¹‹ã€‚</p><p><code>iget</code> åœ¨ <code>itable</code> ä¸­æŸ¥æ‰¾æŒ‡å®šçš„inodeï¼Œå¦‚æœæ‰¾åˆ°ï¼Œè¿”å›ä¹‹ï¼Œå¦åˆ™é‡ç”¨ä¸€ä¸ªç©ºé—²çš„inodeã€‚</p><p><code>iput</code> é‡Šæ”¾ä¸€ä¸ªå¼•ç”¨æŸä¸ªinodeçš„cæŒ‡é’ˆï¼Œå¦‚æœè¯¥cæŒ‡é’ˆæ˜¯æœ€åä¸€ä¸ªå¼•ç”¨è¯¥inodeçš„æŒ‡é’ˆï¼Œåˆ™è¡¨æ˜ <code>itable</code> ä¸­çš„è¯¥é¡¹å¯ä»¥é‡ç”¨ã€‚å¦‚æœ <code>iput</code> å‘ç°æŸä¸ªinodeçš„ <code>ref</code> å­—æ®µå’Œ <code>unlink</code> å­—æ®µä¸º0ï¼Œåˆ™è¡¨æ˜è¯¥inodeè¡¨ç¤ºçš„æ–‡ä»¶å¿…é¡»è¢«åˆ é™¤ã€‚<code>iput</code> è°ƒç”¨ <code>itrunc</code> å°†è¯¥æ–‡ä»¶æˆªæ–­ï¼Œé‡Šæ”¾ç›¸åº”çš„æ•°æ®å—ï¼Œå°† <code>type</code> å­—æ®µè®¾ç½®ä¸º0ï¼Œå¹¶å°†è¯¥ <code>inode</code> å†™å›ç£ç›˜ä¸­ã€‚</p><p><code>iput</code> ä¸­çš„é”ç­–ç•¥ï¼š</p><ul><li>å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯èƒ½æ­£åœ¨ç­‰å¾… <code>ilock</code> ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰æ‰§è¡Œ <code>iput</code> çš„çº¿ç¨‹çš„ <code>ref</code> å­—æ®µä¸å¯èƒ½ä¸º0ï¼Œä¿è¯äº†ä¸ä¼šå°†inodeé‡Šæ”¾æ‰ã€‚</li><li>å¯¹ ialloc çš„å¹¶å‘è°ƒç”¨å¯èƒ½ä¼šé€‰æ‹© iput æ­£åœ¨é‡Šæ”¾çš„åŒä¸€ä¸ª inodeã€‚è¿™ç§æƒ…å†µåªæœ‰åœ¨ iupdate å†™å…¥ç£ç›˜ï¼Œä½¿ inode ç±»å‹ä¸ºé›¶ä¹‹åæ‰ä¼šå‘ç”Ÿã€‚è¿™ç§ç«èµ›æ˜¯è‰¯æ€§çš„ï¼›åˆ†é…çº¿ç¨‹ä¼šç¤¼è²Œåœ°ç­‰å¾…è·å¾— inode çš„ä¼‘çœ é”ï¼Œç„¶åå†è¯»å–æˆ–å†™å…¥ inodeï¼Œæ­¤æ—¶ iput å°±å®Œæˆäº†ã€‚</li></ul><p><code>iput</code> å¯èƒ½ä¼šå†™ç¡¬ç›˜ï¼Œè¿™æ„å‘³ç€å³ä½¿æ˜¯åªè¯»çš„ç³»ç»Ÿè°ƒç”¨ä¹Ÿå¿…é¡»å°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚</p><p>å½“æ–‡ä»¶çš„é“¾æ¥æ•°é™ä¸ºé›¶æ—¶ï¼Œ<code>iput</code> ä¸ä¼šç«‹å³æˆªæ–­æ–‡ä»¶ï¼Œå› ä¸ºæŸäº›è¿›ç¨‹å¯èƒ½ä»åœ¨å†…å­˜ä¸­æŒæœ‰å¯¹ inode çš„å¼•ç”¨ï¼šæŸä¸ªè¿›ç¨‹å¯èƒ½ä»åœ¨è¯»å†™æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæˆåŠŸæ‰“å¼€äº†æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœå´©æºƒå‘ç”Ÿåœ¨æœ€åä¸€ä¸ªè¿›ç¨‹å…³é—­æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ä¹‹å‰ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°†è¢«æ ‡è®°ä¸ºå·²åœ¨ç£ç›˜ä¸Šåˆ†é…ï¼Œä½†æ²¡æœ‰ç›®å½•é¡¹æŒ‡å‘å®ƒã€‚<br>æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ–¹æ³•å¤„ç†è¿™ç§æƒ…å†µã€‚</p><ul><li>ä¸€ç§ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåœ¨é‡å¯åæ¢å¤æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šæ‰«ææ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒæŸ¥æ‰¾æ ‡è®°ä¸ºå·²åˆ†é…ä½†æ²¡æœ‰ç›®å½•é¡¹æŒ‡å‘çš„æ–‡ä»¶ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥é‡Šæ”¾è¿™äº›æ–‡ä»¶ã€‚</li><li>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆä¸éœ€è¦æ‰«ææ–‡ä»¶ç³»ç»Ÿã€‚åœ¨è¿™ç§è§£å†³æ–¹æ¡ˆä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šåœ¨ç£ç›˜ä¸Šï¼ˆå¦‚è¶…çº§å—ä¸­ï¼‰è®°å½•é“¾æ¥è®¡æ•°é™ä¸ºé›¶ä½†å¼•ç”¨è®¡æ•°ä¸ä¸ºé›¶çš„æ–‡ä»¶çš„ inode inumberã€‚å¦‚æœæ–‡ä»¶ç³»ç»Ÿåœ¨å…¶å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶åˆ é™¤äº†è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ›´æ–°ç£ç›˜ä¸Šçš„åˆ—è¡¨ï¼Œå°†è¯¥ inode ä»åˆ—è¡¨ä¸­åˆ é™¤ã€‚æ¢å¤æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šé‡Šæ”¾åˆ—è¡¨ä¸­çš„ä»»ä½•æ–‡ä»¶ã€‚</li><li>Xv6 æ²¡æœ‰å®ç°ä»»ä½•ä¸€ç§æ–¹æ¡ˆï¼Œè¿™æ„å‘³ç€å³ä½¿èŠ‚ç‚¹ä¸å†ä½¿ç”¨ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½è¢«æ ‡è®°ä¸ºå·²åœ¨ç£ç›˜ä¸Šåˆ†é…ã€‚è¿™æ„å‘³ç€éšç€æ—¶é—´çš„æ¨ç§»ï¼Œxv6 å¯èƒ½ä¼šé¢ä¸´ç£ç›˜ç©ºé—´è€—å°½çš„é£é™©</li></ul><h2 id="Code-Inode-content"><a href="#Code-Inode-content" class="headerlink" title="Code: Inode content"></a>Code: Inode content</h2><p>ç£ç›˜ inode ç»“æ„ struct dinode åŒ…å«ä¸€ä¸ªå¤§å°å’Œä¸€ä¸ªå—ç¼–å·æ•°ç»„ï¼ˆè§å›¾ 8.3ï¼‰ã€‚æ•°ç»„çš„å‰12ä¸ªæ•°æ®å—æ˜¯ç›´æ¥æ•°æ®å—ï¼Œæœ€åä¸€ä¸ªæ•°æ®å—æ˜¯é—´æ¥æ•°æ®å—ã€‚å‡½æ•° bmap å¯¹è¡¨ç¤ºæ³•è¿›è¡Œäº†ç®¡ç†ï¼Œè¿™æ ·æˆ‘ä»¬å³å°†çœ‹åˆ°çš„ readi å’Œ writei ç­‰é«˜çº§ä¾‹ç¨‹å°±ä¸éœ€è¦ç®¡ç†è¿™ç§å¤æ‚æ€§äº†ã€‚å¦‚æœ ip è¿˜æ²¡æœ‰è¿™æ ·çš„æ•°æ®å—ï¼Œbmap ä¼šæ ¹æ®éœ€è¦åˆ†é…æ•°æ®å—ã€‚å¦‚æœ ip-&gt;addrs[] æˆ–é—´æ¥æ¡ç›®ä¸ºé›¶ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰åˆ†é…å—ã€‚å½“ bmap é‡åˆ°é›¶æ—¶ï¼Œå®ƒä¼šç”¨æŒ‰éœ€åˆ†é…çš„æ–°å—çš„ç¼–å·æ¥ä»£æ›¿ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-8/image-20241028162956014.png"></p><h2 id="Code-directory-layer"><a href="#Code-directory-layer" class="headerlink" title="Code: directory layer"></a>Code: directory layer</h2><p>ç›®å½•å…¶å®å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹æ˜¯ä¸€ä¸²ç›®å½•é¡¹ã€‚æ¯ä¸ªç›®å½•é¡¹ <code>struct dirent</code> åŒ…å«æ–‡ä»¶åå’Œinode numberã€‚æ–‡ä»¶åæœ€å¤š <code>DIRSIZE</code> ï¼ˆ14ï¼‰ä¸ªå­—ç¬¦ï¼Œinode numerä¸º0è¡¨ç¤ºè¯¥ç›®å½•é¡¹æ˜¯ç©ºé—²çš„ã€‚</p><p>å‡½æ•° <code>dirlookup</code> ä¼šåœ¨ä¸€ä¸ªç›®å½•ä¸­æœç´¢å¸¦æœ‰ç»™å®šåç§°çš„æ¡ç›®ã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘ç›¸åº” inode çš„æŒ‡é’ˆï¼ˆæœªä¸Šé”ï¼‰ï¼Œå¹¶å°† <code>*poff</code> è®¾ç½®ä¸ºè¯¥æ¡ç›®åœ¨ç›®å½•ä¸­çš„å­—èŠ‚åç§»é‡ï¼Œä»¥å¤‡è°ƒç”¨è€…ç¼–è¾‘ã€‚å¦‚æœ <code>dirlookup</code> æ‰¾åˆ°äº†åç§°æ­£ç¡®çš„æ¡ç›®ï¼Œå®ƒä¼šæ›´æ–° <code>*poff</code> å¹¶è¿”å›é€šè¿‡ <code>iget</code> è·å¾—çš„æœªä¸Šé”çš„ inodeã€‚è°ƒç”¨è€…å·²ç»é”å®šäº† <code>dp</code>ï¼Œå› æ­¤å¦‚æœæŸ¥æ‰¾çš„æ˜¯å½“å‰ç›®å½•çš„åˆ«å <code>.</code>ï¼Œåœ¨è¿”å›ä¹‹å‰å°è¯•é”å®š inode ä¼šé‡æ–°é”å®š <code>dp</code> å¹¶å¯¼è‡´æ­»é”ã€‚(è¿˜æœ‰æ›´å¤æ‚çš„æ­»é”æƒ…å†µï¼Œæ¶‰åŠå¤šä¸ªè¿›ç¨‹å’Œ<code>..</code>ï¼ˆçˆ¶ç›®å½•çš„åˆ«åï¼‰ï¼›<code>.</code> ä¸æ˜¯å”¯ä¸€çš„é—®é¢˜ï¼‰ã€‚è°ƒç”¨è€…å¯ä»¥å…ˆè§£é” <code>dp</code>ï¼Œç„¶åå†é”å®š <code>ip</code>ï¼Œä»¥ç¡®ä¿æ¯æ¬¡åªæŒæœ‰ä¸€ä¸ªé”ã€‚</p><p>å‡½æ•° <code>dirlink</code> ä½¿ç”¨ç»™å®šçš„åç§°å’Œ inode ç¼–å·å‘ç›®å½• <code>dp</code> å†™å…¥ä¸€ä¸ªæ–°çš„ç›®å½•æ¡ç›®ã€‚å¦‚æœåç§°å·²ç»å­˜åœ¨ï¼Œ<code>dirlink</code> ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ã€‚ä¸»å¾ªç¯è¯»å–ç›®å½•æ¡ç›®ï¼Œå¯»æ‰¾æœªåˆ†é…çš„æ¡ç›®ã€‚æ‰¾åˆ°åï¼Œå®ƒä¼šæå‰ç»“æŸå¾ªç¯ï¼Œå¹¶å°† <code>off</code> è®¾ä¸ºå¯ç”¨æ¡ç›®çš„åç§»é‡ã€‚å¦åˆ™ï¼Œå¾ªç¯ç»“æŸï¼Œ<code>off</code> è®¾ç½®ä¸º <code>dp-&gt;size</code>ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œ<code>dirlink</code> éƒ½ä¼šåœ¨åç§»é‡ <code>off</code> å¤„å†™å…¥ä¸€ä¸ªæ–°æ¡ç›®ã€‚</p><h2 id="Code-Path-names"><a href="#Code-Path-names" class="headerlink" title="Code: Path names"></a>Code: Path names</h2><p>è·¯å¾„åæŸ¥æ‰¾æ¶‰åŠå¯¹ <code>dirlookup</code> çš„è¿ç»­è°ƒç”¨ï¼Œæ¯ä¸ªè·¯å¾„ç»„ä»¶éƒ½æœ‰ä¸€ä¸ªè°ƒç”¨ã€‚<code>namei</code> å¯¹è·¯å¾„è¿›è¡Œæ±‚å€¼å¹¶è¿”å›ç›¸åº”çš„ inodeã€‚å‡½æ•° <code>nameiparent</code> æ˜¯ä¸€ä¸ªå˜ä½“ï¼šå®ƒåœ¨æœ€åä¸€ä¸ªå…ƒç´ ä¹‹å‰åœæ­¢ï¼Œè¿”å›çˆ¶ç›®å½•çš„ inode å¹¶å°†æœ€åä¸€ä¸ªå…ƒç´ å¤åˆ¶åˆ° name ä¸­ã€‚</p><h2 id="File-descriptor-layer"><a href="#File-descriptor-layer" class="headerlink" title="File descriptor layer"></a>File descriptor layer</h2><p>Xv6 ä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›äº†è‡ªå·±çš„æ‰“å¼€æ–‡ä»¶è¡¨æˆ–æ–‡ä»¶æè¿°ç¬¦ã€‚æ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶éƒ½ç”±ä¸€ä¸ª <code>struct file</code> è¡¨ç¤ºï¼Œå®ƒæ˜¯å¯¹ inode æˆ–ç®¡é“çš„å°è£…ï¼Œå¤–åŠ ä¸€ä¸ª I&#x2F;O åç§»é‡ã€‚æ¯æ¬¡è°ƒç”¨ open éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰“å¼€æ–‡ä»¶ï¼šå¦‚æœå¤šä¸ªè¿›ç¨‹ç‹¬ç«‹æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¸åŒçš„å®ä¾‹ä¼šæœ‰ä¸åŒçš„ I&#x2F;O åç§»é‡ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼ˆåŒä¸€ä¸ªç»“æ„æ–‡ä»¶ï¼‰å¯ä»¥å¤šæ¬¡å‡ºç°åœ¨ä¸€ä¸ªè¿›ç¨‹çš„æ–‡ä»¶è¡¨å’Œå¤šä¸ªè¿›ç¨‹çš„æ–‡ä»¶è¡¨ä¸­ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ open æ‰“å¼€æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ dup åˆ›å»ºåˆ«åï¼Œæˆ–ä½¿ç”¨ fork ä¸å­è¿›ç¨‹å…±äº«ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å¼•ç”¨è®¡æ•°è·Ÿè¸ªç‰¹å®šæ‰“å¼€æ–‡ä»¶çš„å¼•ç”¨æ¬¡æ•°ã€‚æ–‡ä»¶å¯ä»¥ä¸ºè¯»å–æˆ–å†™å…¥æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä¸ºè¯»å–å’Œå†™å…¥æ‰“å¼€ã€‚å¯è¯»å’Œå¯å†™å­—æ®µä¼šè·Ÿè¸ªè¿™ä¸€ç‚¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> &#123;</span> FD_NONE, FD_PIPE, FD_INODE, FD_DEVICE &#125; type;<br>  <span class="hljs-type">int</span> ref; <span class="hljs-comment">// reference count</span><br>  <span class="hljs-type">char</span> readable;<br>  <span class="hljs-type">char</span> writable;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pipe</span> *<span class="hljs-title">pipe</span>;</span> <span class="hljs-comment">// FD_PIPE</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">ip</span>;</span>  <span class="hljs-comment">// FD_INODE and FD_DEVICE</span><br>  uint off;          <span class="hljs-comment">// FD_INODE</span><br>  <span class="hljs-type">short</span> major;       <span class="hljs-comment">// FD_DEVICE</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ç³»ç»Ÿä¸­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶éƒ½ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€æ–‡ä»¶è¡¨ <code>ftable</code> ä¸­ã€‚æ–‡ä»¶è¡¨ä¸­æœ‰åˆ†é…æ–‡ä»¶ï¼ˆfileallocï¼‰ã€åˆ›å»ºé‡å¤å¼•ç”¨ï¼ˆfiledupï¼‰ã€é‡Šæ”¾å¼•ç”¨ï¼ˆfilecloseï¼‰ä»¥åŠè¯»å†™æ•°æ®ï¼ˆfileread å’Œ filewriteï¼‰çš„å‡½æ•°ã€‚</p><p>filealloc (kernel&#x2F;file.c:30) ä¼šåœ¨æ–‡ä»¶è¡¨ä¸­æ‰«ææœªå¼•ç”¨çš„æ–‡ä»¶ï¼ˆf-&gt;ref &#x3D;&#x3D;0ï¼‰å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼›filedup (kernel&#x2F;file.c:48) ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼›fileclose (kernel&#x2F;file.c:60) ä¼šå‡å°‘å¼•ç”¨è®¡æ•°ã€‚å½“æ–‡ä»¶çš„å¼•ç”¨è®¡æ•°ä¸ºé›¶æ—¶ï¼Œfileclose ä¼šé‡Šæ”¾åº•å±‚ç®¡é“æˆ– inodeã€‚</p><p>å‡½æ•° filestatã€fileread å’Œ filewrite å®ç°äº†å¯¹æ–‡ä»¶çš„ç»Ÿè®¡ã€è¯»å–å’Œå†™å…¥æ“ä½œã€‚filestatï¼ˆkernel&#x2F;file.c:88ï¼‰åªå…è®¸å¯¹ inode è¿›è¡Œæ“ä½œï¼Œå¹¶è°ƒç”¨ statiã€‚fileread å’Œ filewrite ä¼šæ£€æŸ¥æ‰“å¼€æ¨¡å¼æ˜¯å¦å…è®¸æ“ä½œï¼Œç„¶åå°†è°ƒç”¨ä¼ é€’ç»™ç®¡é“æˆ– inode å®ç°ã€‚å¦‚æœæ–‡ä»¶ä»£è¡¨ä¸€ä¸ª inodeï¼Œfileread å’Œ filewrite ä¼šä½¿ç”¨ I&#x2F;O åç§»é‡ä½œä¸ºæ“ä½œçš„åç§»é‡ï¼Œç„¶åå‘å‰æ¨è¿›ï¼ˆkernel&#x2F;file.c:122-123ï¼‰ï¼ˆkernel&#x2F;file.c:153-154ï¼‰ã€‚ç®¡é“æ²¡æœ‰åç§»é‡çš„æ¦‚å¿µã€‚å›æƒ³ä¸€ä¸‹ï¼Œinode å‡½æ•°è¦æ±‚è°ƒç”¨è€…å¤„ç†åŠ é”ï¼ˆkernel&#x2F;file.c:94-96ï¼‰ï¼ˆkernel&#x2F;file.c:121-124ï¼‰ï¼ˆkernel&#x2F;file.c:163-166ï¼‰ã€‚inode é”å®šæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å‰¯ä½œç”¨ï¼Œå³è¯»å–å’Œå†™å…¥çš„åç§»é‡æ˜¯åŸå­æ›´æ–°çš„ï¼Œå› æ­¤å¤šä¸ªåŒæ—¶å†™å…¥åŒä¸€æ–‡ä»¶çš„äººä¸ä¼šè¦†ç›–å½¼æ­¤çš„æ•°æ®ï¼Œå°½ç®¡ä»–ä»¬çš„å†™å…¥å¯èƒ½ä¼šäº¤é”™è¿›è¡Œã€‚</p><h2 id="Code-System-calls"><a href="#Code-System-calls" class="headerlink" title="Code: System calls"></a>Code: System calls</h2><p>å‡½æ•° <code>sys_link</code> å’Œ <code>sys_unlink</code> ç¼–è¾‘ç›®å½•ï¼Œåˆ›å»ºæˆ–åˆ é™¤å¯¹ inodes çš„å¼•ç”¨ã€‚<code>sys_link</code> é¦–å…ˆè·å–å‚æ•°ï¼Œå³ä¸¤ä¸ªå­—ç¬¦ä¸² <code>old</code> å’Œ <code>new</code>ã€‚å‡è®¾ <code>old</code> å­˜åœ¨ä¸”ä¸æ˜¯ç›®å½•ï¼Œ<code>sys_link</code> ä¼šå¢åŠ å…¶ <code>ip-&gt;nlink</code> è®¡æ•°ã€‚ç„¶åï¼Œ<code>sys_link</code> è°ƒç”¨ <code>nameiparent</code> æŸ¥æ‰¾ <code>new</code> çš„çˆ¶ç›®å½•å’Œæœ€ç»ˆè·¯å¾„å…ƒç´ ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæŒ‡å‘ <code>old</code> çš„ inode çš„æ–°ç›®å½•æ¡ç›®ã€‚æ–°çš„çˆ¶ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œå¹¶ä¸”ä¸ç°æœ‰çš„ inode ä½äºåŒä¸€è®¾å¤‡ä¸Šï¼šinode åªæœ‰åœ¨å•ä¸ªç£ç›˜ä¸Šæ‰æœ‰å”¯ä¸€æ„ä¹‰ã€‚å¦‚æœå‡ºç°ç±»ä¼¼é”™è¯¯ï¼Œ<code>sys_link</code> å¿…é¡»è¿”å›å¹¶é€’å‡ <code>ip-&gt;nlink</code> .</p><p>ç”±äºéœ€è¦æ›´æ–°å¤šä¸ªç£ç›˜å—ï¼Œå› æ­¤äº‹åŠ¡ç®€åŒ–äº†æ‰§è¡Œè¿‡ç¨‹ï¼Œä½†æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ›´æ–°çš„é¡ºåºã€‚å®ƒä»¬è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸æˆåŠŸã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œåœ¨åˆ›å»ºé“¾æ¥ä¹‹å‰æ›´æ–° ip-&gt;nlink ä¼šä½¿æ–‡ä»¶ç³»ç»Ÿæš‚æ—¶å¤„äºä¸å®‰å…¨çŠ¶æ€ï¼Œè€Œä¸­é—´çš„å´©æºƒå¯èƒ½ä¼šå¯¼è‡´å¤§ç¾éš¾ã€‚æœ‰äº†äº‹åŠ¡ï¼Œæˆ‘ä»¬å°±ä¸å¿…æ‹…å¿ƒè¿™ä¸ªé—®é¢˜äº† ã€‚</p><p><code>sys_link</code> ä¸ºç°æœ‰çš„ inode åˆ›å»ºæ–°åç§°ã€‚å‡½æ•° <code>create</code>ä¸ºæ–°çš„ inode åˆ›å»ºæ–°åç§°ã€‚å®ƒæ˜¯å¯¹ä¸‰ç§æ–‡ä»¶åˆ›å»ºç³»ç»Ÿè°ƒç”¨çš„æ¦‚æ‹¬ï¼šä½¿ç”¨ <code>O_CREATE</code> æ ‡å¿—æ‰“å¼€ä¸€ä¸ªæ–°çš„æ™®é€šæ–‡ä»¶ï¼Œä½¿ç”¨ <code>mkdir</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ï¼Œä½¿ç”¨ <code>mkdev</code> åˆ›å»ºä¸€ä¸ªæ–°çš„è®¾å¤‡æ–‡ä»¶ã€‚ä¸ <code>sys_link</code> ç±»ä¼¼ï¼Œ<code>create</code> ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨ <code>nameiparent</code> æ¥è·å–çˆ¶ç›®å½•çš„ inodeã€‚ç„¶åè°ƒç”¨ <code>dirlookup</code> æ£€æŸ¥åç§°æ˜¯å¦å·²ç»å­˜åœ¨ã€‚å¦‚æœåç§°ç¡®å®å­˜åœ¨ï¼Œ<code>create</code> çš„è¡Œä¸ºå°†å–å†³äºå®ƒè¢«ç”¨äºå“ªä¸ªç³»ç»Ÿè°ƒç”¨ï¼š<code>open</code> ä¸ <code>mkdir</code> å’Œ <code>mkdev</code> çš„è¯­ä¹‰ä¸åŒã€‚å¦‚æœ <code>create</code> æ˜¯ä»£è¡¨ <code>open</code> ä½¿ç”¨ï¼ˆç±»å‹ &#x3D;&#x3D; T_FILEï¼‰ï¼Œè€Œå­˜åœ¨çš„åç§°æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œé‚£ä¹ˆ <code>open</code> ä¼šå°†å…¶è§†ä¸ºæˆåŠŸã€‚å¦åˆ™ä¼šå‡ºé”™ã€‚å¦‚æœæ–‡ä»¶åä¸å­˜åœ¨ï¼Œ<code>create</code> ä¼šä½¿ç”¨ <code>ialloc</code> åˆ†é…ä¸€ä¸ªæ–°çš„ inodeã€‚å¦‚æœæ–°çš„ inode æ˜¯ä¸€ä¸ªç›®å½•ï¼Œ<code>create</code> ä¼šä½¿ç”¨ <code>.</code> å’Œ <code>..</code>æ¡ç›®å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚æœ€åï¼Œæ—¢ç„¶æ•°æ®å·²ç»æ­£ç¡®åˆå§‹åŒ–ï¼Œ<code>create</code> å°±å¯ä»¥å°†å…¶é“¾æ¥åˆ°çˆ¶ç›®å½•ã€‚<code>create</code> å’Œ <code>sys_link</code> ä¸€æ ·ï¼ŒåŒæ—¶æŒæœ‰ä¸¤ä¸ª inode é”ï¼š<code>ip</code> å’Œ <code>dp</code>ã€‚ç”±äº inode ip æ˜¯æ–°åˆ†é…çš„ï¼Œå› æ­¤ä¸ä¼šå‡ºç°æ­»é”ï¼šç³»ç»Ÿä¸­ä¸ä¼šæœ‰å…¶ä»–è¿›ç¨‹åœ¨æŒæœ‰ <code>ip</code> é”ååˆè¯•å›¾é”å®š <code>dp</code>ã€‚</p><p>ä½¿ç”¨ <code>create</code>ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç° <code>sys_open</code>ã€<code>sys_mkdir</code> å’Œ <code>sys_mknod</code>ã€‚<code>sys_open</code>æ˜¯æœ€å¤æ‚çš„ï¼Œå› ä¸ºåˆ›å»ºæ–°æ–‡ä»¶åªæ˜¯å®ƒèƒ½åšçš„äº‹æƒ…çš„ä¸€å°éƒ¨åˆ†ã€‚å¦‚æœ <code>open</code> ä¼ é€’äº† <code>O_CREATE</code> æ ‡å¿—ï¼Œå®ƒå°±ä¼šè°ƒç”¨ <code>create</code>ã€‚å¦åˆ™ï¼Œå®ƒå°†è°ƒç”¨ <code>namei</code>ã€‚å¿…é¡»é”å®š inode æœ¬èº«ã€‚è¿™ä¸ºæ£€æŸ¥ç›®å½•æ˜¯å¦åªä¸ºè¯»å–è€Œä¸æ˜¯å†™å…¥æ‰“å¼€æä¾›äº†æ–¹ä¾¿ã€‚å‡è®¾ä»¥æŸç§æ–¹å¼è·å¾—äº† inodeï¼Œ<code>sys_open</code> ä¼šåˆ†é…ä¸€ä¸ªæ–‡ä»¶å’Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åå¡«å…¥æ–‡ä»¶ã€‚è¯·æ³¨æ„ï¼Œå…¶ä»–è¿›ç¨‹æ— æ³•è®¿é—®éƒ¨åˆ†åˆå§‹åŒ–çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒåªå­˜åœ¨äºå½“å‰è¿›ç¨‹çš„è¡¨ä¸­ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[GIT]å¸¸ç”¨åŸºæœ¬æ“ä½œ</title>
    <link href="/2024/10/21/GIT-%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/10/21/GIT-%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>Git æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨äºè·Ÿè¸ªæ–‡ä»¶çš„æ›´æ”¹ï¼ŒååŠ©å›¢é˜Ÿåä½œå¼€å‘è½¯ä»¶é¡¹ç›®ã€‚</p><h3 id="1-åˆå§‹åŒ–-Git-ä»“åº“"><a href="#1-åˆå§‹åŒ–-Git-ä»“åº“" class="headerlink" title="1. åˆå§‹åŒ– Git ä»“åº“"></a>1. <strong>åˆå§‹åŒ– Git ä»“åº“</strong></h3><p>è¦ä½¿ç”¨ Git è·Ÿè¸ªé¡¹ç›®ï¼Œé¦–å…ˆéœ€è¦å°†é¡¹ç›®ç›®å½•åˆå§‹åŒ–ä¸º Git ä»“åº“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git init<br></code></pre></td></tr></table></figure><p>è¿™ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªéšè—çš„ <code>.git</code> æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ç‰ˆæœ¬æ§åˆ¶ç›¸å…³çš„æ•°æ®ã€‚</p><h3 id="2-å…‹éš†è¿œç¨‹ä»“åº“"><a href="#2-å…‹éš†è¿œç¨‹ä»“åº“" class="headerlink" title="2. å…‹éš†è¿œç¨‹ä»“åº“"></a>2. <strong>å…‹éš†è¿œç¨‹ä»“åº“</strong></h3><p>å¦‚æœå·²æœ‰è¿œç¨‹ä»“åº“ï¼Œå¯ä»¥é€šè¿‡ <code>git clone</code> å‘½ä»¤å°†å…¶å¤åˆ¶åˆ°æœ¬åœ°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/username/repo.git<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†è¿œç¨‹ä»“åº“ä¸‹è½½åˆ°å½“å‰ç›®å½•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ã€‚</p><h3 id="3-æŸ¥çœ‹ä»“åº“çŠ¶æ€"><a href="#3-æŸ¥çœ‹ä»“åº“çŠ¶æ€" class="headerlink" title="3. æŸ¥çœ‹ä»“åº“çŠ¶æ€"></a>3. <strong>æŸ¥çœ‹ä»“åº“çŠ¶æ€</strong></h3><p>ä½¿ç”¨ <code>git status</code> æŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€ï¼Œæ¯”å¦‚å“ªäº›æ–‡ä»¶è¢«ä¿®æ”¹äº†ã€å“ªäº›æ–‡ä»¶å¤„äºæš‚å­˜åŒºç­‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git status<br></code></pre></td></tr></table></figure><p>è¿™ä¼šæ˜¾ç¤ºæœªè·Ÿè¸ªæ–‡ä»¶ã€å·²ä¿®æ”¹æ–‡ä»¶å’Œæš‚å­˜åŒºçš„æ–‡ä»¶ã€‚</p><h3 id="4-è·Ÿè¸ªæ–°æ–‡ä»¶"><a href="#4-è·Ÿè¸ªæ–°æ–‡ä»¶" class="headerlink" title="4. è·Ÿè¸ªæ–°æ–‡ä»¶"></a>4. <strong>è·Ÿè¸ªæ–°æ–‡ä»¶</strong></h3><p>è¦å°†æ–°æ–‡ä»¶æ·»åŠ åˆ° Git çš„è·Ÿè¸ªåˆ—è¡¨ä¸­ï¼Œä½¿ç”¨ <code>git add</code> å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ æ‰€æœ‰æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ä¿®æ”¹å’Œæ–°æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºã€‚</p><h3 id="5-æäº¤æ›´æ”¹"><a href="#5-æäº¤æ›´æ”¹" class="headerlink" title="5. æäº¤æ›´æ”¹"></a>5. <strong>æäº¤æ›´æ”¹</strong></h3><p>ä¸€æ—¦æ·»åŠ äº†æ–‡ä»¶åˆ°æš‚å­˜åŒºï¼Œå¯ä»¥ä½¿ç”¨ <code>git commit</code> æ¥æäº¤è¿™äº›æ›´æ”¹ã€‚æ¯æ¬¡æäº¤éƒ½ä¼šè®°å½•ä¸€æ¡å†å²è®°å½•ï¼Œå¯ä»¥éšæ—¶æŸ¥çœ‹å’Œæ¢å¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git commit -m <span class="hljs-string">&quot;Commit message describing the changes&quot;</span><br></code></pre></td></tr></table></figure><p><code>-m</code> åè·Ÿçš„æ¶ˆæ¯åº”ç®€è¦æè¿°è¿™æ¬¡æäº¤çš„æ›´æ”¹å†…å®¹ã€‚</p><h3 id="6-æŸ¥çœ‹æäº¤å†å²"><a href="#6-æŸ¥çœ‹æäº¤å†å²" class="headerlink" title="6. æŸ¥çœ‹æäº¤å†å²"></a>6. <strong>æŸ¥çœ‹æäº¤å†å²</strong></h3><p>ä½¿ç”¨ <code>git log</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä»“åº“çš„æäº¤å†å²ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>è¿™ä¼šæ˜¾ç¤ºæäº¤çš„å“ˆå¸Œå€¼ã€ä½œè€…ã€æ—¥æœŸå’Œæäº¤æ¶ˆæ¯ã€‚å¦‚æœæƒ³æŸ¥çœ‹ç®€åŒ–çš„æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨ <code>--oneline</code> é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> --oneline<br></code></pre></td></tr></table></figure><h3 id="7-åˆ›å»ºåˆ†æ”¯"><a href="#7-åˆ›å»ºåˆ†æ”¯" class="headerlink" title="7. åˆ›å»ºåˆ†æ”¯"></a>7. <strong>åˆ›å»ºåˆ†æ”¯</strong></h3><p>åœ¨ Git ä¸­ï¼Œåˆ†æ”¯ç”¨äºå¹¶è¡Œå¼€å‘ä¸åŒçš„åŠŸèƒ½ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯æ¥å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¼šåˆ›å»ºå¹¶åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚å¦‚æœä½ åªæƒ³åˆ‡æ¢åˆ†æ”¯è€Œä¸åˆ›å»ºæ–°åˆ†æ”¯ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><h3 id="8-æ¨é€åˆ°è¿œç¨‹ä»“åº“"><a href="#8-æ¨é€åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="8. æ¨é€åˆ°è¿œç¨‹ä»“åº“"></a>8. <strong>æ¨é€åˆ°è¿œç¨‹ä»“åº“</strong></h3><p>å°†æœ¬åœ°çš„æäº¤æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œä»¥ä¾¿ä¸å›¢é˜Ÿæˆå‘˜å…±äº«ä»£ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœæƒ³å°† <code>main</code> åˆ†æ”¯çš„æ›´æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin main<br></code></pre></td></tr></table></figure><h3 id="9-æ‹‰å–è¿œç¨‹ä»“åº“çš„æ›´æ”¹"><a href="#9-æ‹‰å–è¿œç¨‹ä»“åº“çš„æ›´æ”¹" class="headerlink" title="9. æ‹‰å–è¿œç¨‹ä»“åº“çš„æ›´æ”¹"></a>9. <strong>æ‹‰å–è¿œç¨‹ä»“åº“çš„æ›´æ”¹</strong></h3><p>ä½¿ç”¨ <code>git pull</code> ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°çš„æ›´æ”¹å¹¶åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull origin &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œä» <code>main</code> åˆ†æ”¯æ‹‰å–è¿œç¨‹ä»“åº“çš„æœ€æ–°æ›´æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull origin main<br></code></pre></td></tr></table></figure><h3 id="10-æš‚å­˜å·¥ä½œï¼ˆStashingï¼‰"><a href="#10-æš‚å­˜å·¥ä½œï¼ˆStashingï¼‰" class="headerlink" title="10. æš‚å­˜å·¥ä½œï¼ˆStashingï¼‰"></a>10. <strong>æš‚å­˜å·¥ä½œï¼ˆStashingï¼‰</strong></h3><p>å¦‚æœæ­£åœ¨å¤„ç†ä¸€äº›ä»£ç æ›´æ”¹ï¼Œä½†è¿˜ä¸æƒ³æäº¤è¿™äº›æ›´æ”¹ï¼Œè€Œåˆæƒ³åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯æˆ–åšå…¶ä»–äº‹æƒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>git stash</code> å°†å·¥ä½œåŒºçš„æ›´æ”¹æš‚å­˜èµ·æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash<br></code></pre></td></tr></table></figure><p>ä¹‹åå¯ä»¥ä½¿ç”¨ <code>git stash apply</code> æ¢å¤æš‚å­˜çš„å·¥ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash apply<br></code></pre></td></tr></table></figure><h3 id="11-æŸ¥çœ‹å·®å¼‚"><a href="#11-æŸ¥çœ‹å·®å¼‚" class="headerlink" title="11. æŸ¥çœ‹å·®å¼‚"></a>11. <strong>æŸ¥çœ‹å·®å¼‚</strong></h3><p>è¦æŸ¥çœ‹æ–‡ä»¶çš„æ›´æ”¹å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>git diff</code> å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff<br></code></pre></td></tr></table></figure><p>è¿™ä¼šæ˜¾ç¤ºè‡ªä¸Šæ¬¡æäº¤ä»¥æ¥çš„æ›´æ”¹å†…å®¹ã€‚</p><h3 id="12-è¿˜åŸæ›´æ”¹"><a href="#12-è¿˜åŸæ›´æ”¹" class="headerlink" title="12. è¿˜åŸæ›´æ”¹"></a>12. <strong>è¿˜åŸæ›´æ”¹</strong></h3><p>åœ¨ Git ä¸­ï¼Œè¿˜åŸä»£ç æˆ–æ’¤é”€æ›´æ”¹æ˜¯éå¸¸å¸¸è§çš„æ“ä½œï¼Œæ— è®ºæ˜¯æ¢å¤æŸä¸ªæ–‡ä»¶çš„çŠ¶æ€ï¼Œè¿˜æ˜¯æ’¤é”€æŸæ¬¡æäº¤ï¼ŒGit éƒ½æä¾›äº†å¤šä¸ªæ–¹å¼æ¥å®‰å…¨ã€çµæ´»åœ°æ“ä½œé¡¹ç›®å†å²ã€‚ä»¥ä¸‹æ˜¯ Git ä¸­å¸¸ç”¨çš„è¿˜åŸå’Œæ’¤é”€æ“ä½œçš„è¯¦ç»†ä»‹ç»ã€‚</p><h4 id="12-1-æ’¤é”€æœªæäº¤çš„æ›´æ”¹"><a href="#12-1-æ’¤é”€æœªæäº¤çš„æ›´æ”¹" class="headerlink" title="12.1 æ’¤é”€æœªæäº¤çš„æ›´æ”¹"></a>12.1 <strong>æ’¤é”€æœªæäº¤çš„æ›´æ”¹</strong></h4><h5 id="è¿˜åŸå·¥ä½œåŒºçš„ä¿®æ”¹"><a href="#è¿˜åŸå·¥ä½œåŒºçš„ä¿®æ”¹" class="headerlink" title="è¿˜åŸå·¥ä½œåŒºçš„ä¿®æ”¹"></a><strong>è¿˜åŸå·¥ä½œåŒºçš„ä¿®æ”¹</strong></h5><p>å¦‚æœä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æäº¤ï¼ˆå³æ–‡ä»¶è¿˜æœªåŠ å…¥æš‚å­˜åŒºæˆ–å·²ç»æš‚å­˜ä½†æœªæäº¤ï¼‰ï¼Œå¯ä»¥å°†å®ƒä»¬æ¢å¤åˆ°ä¸Šæ¬¡æäº¤æ—¶çš„çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -- &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šä¸¢å¼ƒæ–‡ä»¶ä¸­çš„æ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ï¼Œæ¢å¤ä¸ºä¸Šä¸€æ¬¡æäº¤æ—¶çš„ç‰ˆæœ¬ã€‚å¦‚æœæƒ³è¿˜åŸå¤šä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ <code>.</code> è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -- .<br></code></pre></td></tr></table></figure><h5 id="æ’¤é”€å·²æš‚å­˜çš„æ›´æ”¹"><a href="#æ’¤é”€å·²æš‚å­˜çš„æ›´æ”¹" class="headerlink" title="æ’¤é”€å·²æš‚å­˜çš„æ›´æ”¹"></a><strong>æ’¤é”€å·²æš‚å­˜çš„æ›´æ”¹</strong></h5><p>å¦‚æœå·²ç»é€šè¿‡ <code>git add</code> å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œä½†ä½ æƒ³æ’¤é”€è¿™ä¸ªæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ <code>git reset</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†æ–‡ä»¶ä»æš‚å­˜åŒºç§»å‡ºï¼Œä½†ä¿ç•™æ–‡ä»¶çš„æ›´æ”¹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥å†æ¬¡ç¼–è¾‘æ–‡ä»¶æˆ–é€‰æ‹©ä¸æäº¤è¿™äº›æ›´æ”¹ã€‚</p><h5 id="è¿˜åŸæ•´ä¸ªå·¥ä½œç›®å½•"><a href="#è¿˜åŸæ•´ä¸ªå·¥ä½œç›®å½•" class="headerlink" title="è¿˜åŸæ•´ä¸ªå·¥ä½œç›®å½•"></a><strong>è¿˜åŸæ•´ä¸ªå·¥ä½œç›®å½•</strong></h5><p>å¦‚æœæƒ³æ’¤é”€æ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ï¼ˆåŒ…æ‹¬æš‚å­˜åŒºå’Œæœªæš‚å­˜çš„æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>git reset</code> å’Œ <code>git checkout</code> çš„ç»„åˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --hard HEAD<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†æ•´ä¸ªå·¥ä½œåŒºè¿˜åŸä¸ºæœ€åä¸€æ¬¡æäº¤çš„çŠ¶æ€ï¼Œæ‰€æœ‰æœªæäº¤çš„æ›´æ”¹éƒ½ä¼šä¸¢å¤±ã€‚</p><h4 id="12-2-æ’¤é”€å·²æäº¤çš„æ›´æ”¹"><a href="#12-2-æ’¤é”€å·²æäº¤çš„æ›´æ”¹" class="headerlink" title="12.2 æ’¤é”€å·²æäº¤çš„æ›´æ”¹"></a>12.2 <strong>æ’¤é”€å·²æäº¤çš„æ›´æ”¹</strong></h4><h5 id="ä¿®æ”¹æœ€è¿‘çš„æäº¤"><a href="#ä¿®æ”¹æœ€è¿‘çš„æäº¤" class="headerlink" title="ä¿®æ”¹æœ€è¿‘çš„æäº¤"></a><strong>ä¿®æ”¹æœ€è¿‘çš„æäº¤</strong></h5><p>å¦‚æœå·²ç»æäº¤äº†æ›´æ”¹ï¼Œä½†å‘ç°æäº¤ä¿¡æ¯æœ‰è¯¯æˆ–æ–‡ä»¶é—æ¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>git commit --amend</code> æ¥ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡çš„æäº¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git commit --amend<br></code></pre></td></tr></table></figure><p>è¿™ä¼šæ‰“å¼€ç¼–è¾‘å™¨ï¼Œå…è®¸ä¿®æ”¹æäº¤æ¶ˆæ¯ï¼Œæˆ–è€…å¯ä»¥æ·»åŠ æ›´å¤šçš„æ–‡ä»¶åˆ°è¯¥æäº¤ã€‚å¦‚æœæƒ³æ”¹åŠ¨çš„æ˜¯æœ€è¿‘ä¸€æ¬¡æäº¤çš„å†…å®¹è€Œä¸æ˜¯æ¶ˆæ¯ï¼Œå¯ä»¥å…ˆç”¨ <code>git add</code> å†æ‰§è¡Œ <code>git commit --amend</code>ã€‚</p><h5 id="å›æ»šåˆ°æŒ‡å®šæäº¤"><a href="#å›æ»šåˆ°æŒ‡å®šæäº¤" class="headerlink" title="å›æ»šåˆ°æŒ‡å®šæäº¤"></a><strong>å›æ»šåˆ°æŒ‡å®šæäº¤</strong></h5><p>å¦‚æœæƒ³æ’¤é”€ä¸€ä¸ªæˆ–å¤šä¸ªæäº¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>git reset</code> å‘½ä»¤ã€‚<code>git reset</code> æœ‰å¤šä¸ªé€‰é¡¹ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼š</p><ul><li><p><strong>è½¯é‡ç½®ï¼ˆ<code>--soft</code>ï¼‰</strong>ï¼šåªç§»åŠ¨æäº¤æŒ‡é’ˆï¼Œä¿ç•™æ‰€æœ‰æ–‡ä»¶çš„ä¿®æ”¹çŠ¶æ€å’Œæš‚å­˜çŠ¶æ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --soft &lt;commit&gt;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥å›åˆ°æŸä¸ªæäº¤ï¼Œä½†ä¿ç•™æ‰€æœ‰æ›´æ”¹åœ¨æš‚å­˜åŒºï¼Œä¹‹åå¯ä»¥é‡æ–°æäº¤ã€‚</p></li><li><p><strong>æ··åˆé‡ç½®ï¼ˆ<code>--mixed</code>ï¼Œé»˜è®¤ï¼‰</strong>ï¼šå›åˆ°æŒ‡å®šçš„æäº¤ï¼Œä½†ä¿ç•™æ–‡ä»¶çš„æ›´æ”¹ï¼Œåªæ˜¯å°†å…¶ç§»å‡ºæš‚å­˜åŒºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --mixed &lt;commit&gt;<br></code></pre></td></tr></table></figure></li><li><p><strong>ç¡¬é‡ç½®ï¼ˆ<code>--hard</code>ï¼‰</strong>ï¼šå½»åº•å›æ»šåˆ°æŒ‡å®šçš„æäº¤ï¼Œåˆ é™¤æ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ï¼Œå·¥ä½œç›®å½•ä¼šä¸æŒ‡å®šçš„æäº¤å®Œå…¨ä¸€è‡´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --hard &lt;commit&gt;<br></code></pre></td></tr></table></figure></li></ul><h5 id="æ’¤é”€æŸæ¬¡æäº¤ä½†ä¿ç•™æ›´æ”¹"><a href="#æ’¤é”€æŸæ¬¡æäº¤ä½†ä¿ç•™æ›´æ”¹" class="headerlink" title="æ’¤é”€æŸæ¬¡æäº¤ä½†ä¿ç•™æ›´æ”¹"></a><strong>æ’¤é”€æŸæ¬¡æäº¤ä½†ä¿ç•™æ›´æ”¹</strong></h5><p>æœ‰æ—¶å€™ä¸æƒ³å½»åº•å›åˆ°ä¹‹å‰çš„æŸä¸ªæäº¤ï¼Œè€Œåªæ˜¯æƒ³æ’¤é”€æŸä¸ªæäº¤çš„å½±å“ï¼Œä½†ä¿ç•™å®ƒçš„å†…å®¹ä¾›é‡æ–°ä¿®æ”¹ã€‚è¿™ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ <code>git revert</code>ã€‚</p><ul><li><p><strong>å›æ»šå•ä¸ªæäº¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git revert &lt;commit&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤ï¼Œæ’¤é”€æŒ‡å®šæäº¤çš„å†…å®¹ï¼Œä½†ä¸ä¼šæ”¹å˜æäº¤å†å²ã€‚</p></li></ul><h5 id="åˆ é™¤æœ€è¿‘çš„æäº¤"><a href="#åˆ é™¤æœ€è¿‘çš„æäº¤" class="headerlink" title="åˆ é™¤æœ€è¿‘çš„æäº¤"></a><strong>åˆ é™¤æœ€è¿‘çš„æäº¤</strong></h5><p>å¦‚æœæƒ³åˆ é™¤æœ€æ–°çš„ä¸€ä¸ªæˆ–å¤šä¸ªæäº¤ï¼ˆä¸”ä¸ä¿ç•™æ›´æ”¹ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>git reset</code> çš„ç¡¬é‡ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --hard HEAD~1<br></code></pre></td></tr></table></figure><p>è¿™ä¼šåˆ é™¤æœ€è¿‘çš„æäº¤ï¼Œ<code>HEAD~1</code> è¡¨ç¤ºå€’é€€ä¸€ä¸ªæäº¤ã€‚å¦‚æœåˆ é™¤å¤šä¸ªæäº¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>HEAD~n</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯æƒ³åˆ é™¤çš„æäº¤æ•°ã€‚</p><h4 id="12-3-è¿˜åŸå·²åˆ é™¤çš„æ–‡ä»¶"><a href="#12-3-è¿˜åŸå·²åˆ é™¤çš„æ–‡ä»¶" class="headerlink" title="12.3 è¿˜åŸå·²åˆ é™¤çš„æ–‡ä»¶"></a>12.3 <strong>è¿˜åŸå·²åˆ é™¤çš„æ–‡ä»¶</strong></h4><p>å¦‚æœä¸å°å¿ƒåˆ é™¤äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ²¡æœ‰æäº¤è¿™ä¸ªåˆ é™¤æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ <code>git checkout</code> æ¢å¤æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -- &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šå°†æ–‡ä»¶æ¢å¤åˆ°ä¸Šä¸€æ¬¡æäº¤æ—¶çš„çŠ¶æ€ã€‚</p><p>å¦‚æœå·²ç»æäº¤äº†æ–‡ä»¶åˆ é™¤æ“ä½œï¼Œä½†æƒ³æ¢å¤è¯¥æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>git reset</code> æˆ– <code>git revert</code> æ’¤é”€åˆ é™¤æ“ä½œï¼Œæˆ–è€…é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¢å¤ç‰¹å®šçš„å·²åˆ é™¤æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout &lt;commit&gt; -- &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šå°†æ–‡ä»¶æ¢å¤åˆ°æŒ‡å®šæäº¤æ—¶çš„çŠ¶æ€ã€‚</p><h4 id="12-4-æš‚å­˜å·¥ä½œå¹¶ç¨åæ¢å¤"><a href="#12-4-æš‚å­˜å·¥ä½œå¹¶ç¨åæ¢å¤" class="headerlink" title="12.4 æš‚å­˜å·¥ä½œå¹¶ç¨åæ¢å¤"></a>12.4 <strong>æš‚å­˜å·¥ä½œå¹¶ç¨åæ¢å¤</strong></h4><p>å½“åœ¨è¿›è¡ŒæŸäº›æ›´æ”¹æ—¶ï¼Œçªç„¶éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯æˆ–å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œä½†ä¸æƒ³æäº¤å½“å‰çš„æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>git stash</code> æš‚å­˜è¿™äº›æœªå®Œæˆçš„å·¥ä½œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†å½“å‰çš„æ‰€æœ‰æœªæäº¤æ›´æ”¹ï¼ˆåŒ…æ‹¬æš‚å­˜å’Œæœªæš‚å­˜çš„å†…å®¹ï¼‰æš‚å­˜èµ·æ¥ï¼Œå·¥ä½œç›®å½•ä¼šæ¢å¤åˆ°å¹²å‡€çŠ¶æ€ã€‚</p><p>å½“æƒ³æ¢å¤è¿™äº›å·¥ä½œæ—¶ï¼Œä½¿ç”¨ <code>git stash apply</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash apply<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†æš‚å­˜çš„æ›´æ”¹æ¢å¤åˆ°å·¥ä½œç›®å½•ã€‚</p><h4 id="12-5-æŸ¥çœ‹æäº¤çš„å†å²è®°å½•"><a href="#12-5-æŸ¥çœ‹æäº¤çš„å†å²è®°å½•" class="headerlink" title="12.5 æŸ¥çœ‹æäº¤çš„å†å²è®°å½•"></a>12.5 <strong>æŸ¥çœ‹æäº¤çš„å†å²è®°å½•</strong></h4><p>å¯ä»¥ä½¿ç”¨ <code>git log</code> å‘½ä»¤æŸ¥çœ‹ä»“åº“çš„å†å²æäº¤è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æŸ¥çœ‹æŸä¸ªæ–‡ä»¶åœ¨ä¸åŒæäº¤é—´çš„å˜åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>git log</code> åŠ ä¸Šæ–‡ä»¶åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> &lt;filename&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¼šæ˜¾ç¤ºä¸è¯¥æ–‡ä»¶ç›¸å…³çš„æ‰€æœ‰æäº¤ã€‚</p><h4 id="12-6-æŸ¥çœ‹æ–‡ä»¶å·®å¼‚"><a href="#12-6-æŸ¥çœ‹æ–‡ä»¶å·®å¼‚" class="headerlink" title="12.6 æŸ¥çœ‹æ–‡ä»¶å·®å¼‚"></a>12.6 <strong>æŸ¥çœ‹æ–‡ä»¶å·®å¼‚</strong></h4><p>ä½¿ç”¨ <code>git diff</code> å¯ä»¥æŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ–‡ä»¶å·®å¼‚ï¼š</p><ul><li><p><strong>æŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„å·®å¼‚</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹æš‚å­˜åŒºå’Œä¸Šæ¬¡æäº¤çš„å·®å¼‚</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff --cached<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹æŸæ¬¡æäº¤çš„æ›´æ”¹</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff &lt;commit&gt;<br></code></pre></td></tr></table></figure></li></ul><h4 id="12-7-å¼ºåˆ¶æ¨é€è¿˜åŸ"><a href="#12-7-å¼ºåˆ¶æ¨é€è¿˜åŸ" class="headerlink" title="12.7 å¼ºåˆ¶æ¨é€è¿˜åŸ"></a>12.7 <strong>å¼ºåˆ¶æ¨é€è¿˜åŸ</strong></h4><p>å¦‚æœå·²ç»æ¨é€äº†é”™è¯¯çš„æäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œå¹¶ä¸”éœ€è¦è¿˜åŸè¿œç¨‹ä»“åº“çš„çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>git push</code> çš„å¼ºåˆ¶æ¨é€é€‰é¡¹ï¼ˆ<strong>æ³¨æ„ï¼šè¿™ä¼šè¦†ç›–è¿œç¨‹ä»“åº“çš„å†å²ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨</strong>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push --force<br></code></pre></td></tr></table></figure><p>è¿™ç§æ“ä½œé€‚ç”¨äºç´§æ€¥æƒ…å†µä¸‹çš„é”™è¯¯ä¿®å¤ï¼Œä¸”éœ€è¦å›¢é˜Ÿåä½œæ—¶çš„é¢å¤–æ²Ÿé€šï¼Œä»¥é¿å…å…¶ä»–å¼€å‘è€…çš„å·¥ä½œè¢«è¦†ç›–ã€‚</p><h3 id="13-å…‹éš†ã€æ¨é€å’Œæ‹‰å–å¸¸ç”¨æµç¨‹"><a href="#13-å…‹éš†ã€æ¨é€å’Œæ‹‰å–å¸¸ç”¨æµç¨‹" class="headerlink" title="13. å…‹éš†ã€æ¨é€å’Œæ‹‰å–å¸¸ç”¨æµç¨‹"></a>13. <strong>å…‹éš†ã€æ¨é€å’Œæ‹‰å–å¸¸ç”¨æµç¨‹</strong></h3><ol><li><p><strong>å…‹éš†ä»“åº“</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/username/repo.git<br></code></pre></td></tr></table></figure></li><li><p><strong>æ‹‰å–æœ€æ–°ä»£ç </strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull origin main<br></code></pre></td></tr></table></figure></li><li><p><strong>è¿›è¡Œå¼€å‘ã€æäº¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .<br>git commit -m <span class="hljs-string">&quot;Add new feature&quot;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>æ¨é€åˆ°è¿œç¨‹ä»“åº“</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin main<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[GIT]åˆ†æ”¯å¸¸ç”¨æ“ä½œ</title>
    <link href="/2024/10/21/GIT-%E5%88%86%E6%94%AF%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/10/21/GIT-%E5%88%86%E6%94%AF%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>åˆ†æ”¯å…è®¸æˆ‘ä»¬åœ¨ä¸åŒçš„æ–¹å‘ä¸Šå·¥ä½œï¼Œè€Œä¸å½±å“ä¸»åˆ†æ”¯ã€‚å¦‚æœé¡¹ç›®ä¸­ä¸åŒçš„åŠŸèƒ½æˆ–ä¿®å¤ä½äºä¸åŒçš„åˆ†æ”¯ä¸Šï¼Œä¾¿å¯ä»¥å•ç‹¬å¼€å‘ã€æµ‹è¯•ï¼Œå¹¶åœ¨å¿…è¦æ—¶åˆå¹¶å›ä¸»åˆ†æ”¯ã€‚</p><h3 id="1-åˆ›å»ºåˆ†æ”¯"><a href="#1-åˆ›å»ºåˆ†æ”¯" class="headerlink" title="1. åˆ›å»ºåˆ†æ”¯"></a>1. <strong>åˆ›å»ºåˆ†æ”¯</strong></h3><p>å½“å¼€å§‹ä¸€ä¸ªæ–°åŠŸèƒ½æˆ–æƒ³è¦å®éªŒæŸäº›ä¸œè¥¿æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚å‡è®¾å·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ª Git ä»“åº“æˆ–å…‹éš†äº†ä¸€ä¸ªç°æœ‰çš„ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœæ­£åœ¨å¼€å‘ä¸€ä¸ªæ–°çš„åŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b feature-new-functionality<br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä¼šåŒæ—¶åˆ›å»ºä¸€ä¸ªåä¸º <code>feature-new-functionality</code> çš„æ–°åˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ã€‚</p><h3 id="2-åœ¨åˆ†æ”¯ä¸Šå·¥ä½œ"><a href="#2-åœ¨åˆ†æ”¯ä¸Šå·¥ä½œ" class="headerlink" title="2. åœ¨åˆ†æ”¯ä¸Šå·¥ä½œ"></a>2. <strong>åœ¨åˆ†æ”¯ä¸Šå·¥ä½œ</strong></h3><p>åœ¨æ–°åˆ†æ”¯ä¸Šï¼Œå¯ä»¥è¿›è¡Œæ­£å¸¸çš„å¼€å‘å·¥ä½œï¼Œä¾‹å¦‚æ·»åŠ æ–‡ä»¶ã€ä¿®æ”¹ä»£ç ç­‰ã€‚æ‰€æœ‰è¿™äº›æ›´æ”¹éƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šï¼Œä¸ä¼šå½±å“å…¶ä»–åˆ†æ”¯ã€‚</p><p>æŸ¥çœ‹å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch<br></code></pre></td></tr></table></figure><p>å®ƒä¼šåˆ—å‡ºå½“å‰ä»“åº“ä¸­çš„æ‰€æœ‰åˆ†æ”¯ï¼Œå½“å‰æ‰€åœ¨åˆ†æ”¯ä¼šæ ‡è®°ä¸€ä¸ªæ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰ã€‚</p><h3 id="3-æäº¤æ›´æ”¹"><a href="#3-æäº¤æ›´æ”¹" class="headerlink" title="3. æäº¤æ›´æ”¹"></a>3. <strong>æäº¤æ›´æ”¹</strong></h3><p>åœ¨åˆ†æ”¯ä¸­å®Œæˆäº†ä¸€äº›æ›´æ”¹åï¼Œå’Œä½¿ç”¨ Git çš„å¸¸è§„å·¥ä½œæµç¨‹ä¸€æ ·ï¼Œéœ€è¦å°†è¿™äº›æ›´æ”¹æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œå¹¶æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;files&gt;<br>git commit -m <span class="hljs-string">&quot;Add new functionality to the project&quot;</span><br></code></pre></td></tr></table></figure><h3 id="4-åˆ‡æ¢åˆ†æ”¯"><a href="#4-åˆ‡æ¢åˆ†æ”¯" class="headerlink" title="4. åˆ‡æ¢åˆ†æ”¯"></a>4. <strong>åˆ‡æ¢åˆ†æ”¯</strong></h3><p>å¯ä»¥åœ¨ä¸åŒçš„åˆ†æ”¯ä¹‹é—´åˆ‡æ¢ï¼Œè€Œä¸ä¼šä¸¢å¤±ä»»ä½•å·¥ä½œã€‚å‡è®¾æ­£åœ¨ <code>feature-new-functionality</code> åˆ†æ”¯ä¸Šå·¥ä½œï¼Œä½†ç°åœ¨æƒ³å›åˆ° <code>main</code> åˆ†æ”¯æŸ¥çœ‹é¡¹ç›®çš„ç¨³å®šç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout main<br></code></pre></td></tr></table></figure><p>Git ä¼šåˆ‡æ¢åˆ° <code>main</code> åˆ†æ”¯ï¼ŒåŒæ—¶ä¿ç•™ <code>feature-new-functionality</code> åˆ†æ”¯ä¸Šçš„æ‰€æœ‰å·¥ä½œã€‚</p><h3 id="5-åˆå¹¶åˆ†æ”¯"><a href="#5-åˆå¹¶åˆ†æ”¯" class="headerlink" title="5. åˆå¹¶åˆ†æ”¯"></a>5. <strong>åˆå¹¶åˆ†æ”¯</strong></h3><p>å½“åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šå®Œæˆäº†æŸä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸”ç»è¿‡æµ‹è¯•åå†³å®šå°†å®ƒåˆå¹¶åˆ° <code>main</code> åˆ†æ”¯ï¼ˆæˆ–å…¶ä»–åˆ†æ”¯ï¼‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œåˆå¹¶æ“ä½œï¼š</p><ol><li><p>é¦–å…ˆï¼Œåˆ‡æ¢åˆ°æƒ³è¦åˆå¹¶åˆ°çš„åˆ†æ”¯ï¼ˆä¾‹å¦‚ <code>main</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout main<br></code></pre></td></tr></table></figure></li><li><p>ç„¶åï¼Œåˆå¹¶å·¥ä½œçš„åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git merge feature-new-functionality<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœåˆå¹¶æ—¶æœ‰å†²çªï¼ˆå³ä¸¤ä¸ªåˆ†æ”¯ä¿®æ”¹äº†ç›¸åŒçš„æ–‡ä»¶éƒ¨åˆ†ï¼‰ï¼ŒGit ä¼šæç¤ºè¿›è¡Œå†²çªè§£å†³ã€‚è§£å†³å†²çªåï¼Œå¯ä»¥å†æ¬¡æäº¤è§£å†³åçš„ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;resolved-files&gt;<br>git commit -m <span class="hljs-string">&quot;Resolve merge conflicts&quot;</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="6-åˆ é™¤åˆ†æ”¯ï¼ˆå¯é€‰ï¼‰"><a href="#6-åˆ é™¤åˆ†æ”¯ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="6. åˆ é™¤åˆ†æ”¯ï¼ˆå¯é€‰ï¼‰"></a>6. <strong>åˆ é™¤åˆ†æ”¯ï¼ˆå¯é€‰ï¼‰</strong></h3><p>å½“ä¸€ä¸ªåˆ†æ”¯çš„å·¥ä½œå®Œæˆå¹¶æˆåŠŸåˆå¹¶åï¼Œå¯ä»¥é€‰æ‹©åˆ é™¤è¿™ä¸ªåˆ†æ”¯ï¼Œä»¥ä¿æŒä»“åº“æ•´æ´ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -d feature-new-functionality<br></code></pre></td></tr></table></figure><p>å¦‚æœåˆ†æ”¯æ²¡æœ‰åˆå¹¶åˆ°å…¶ä»–åˆ†æ”¯ï¼Œè€Œè¿˜æ˜¯æƒ³åˆ é™¤å®ƒï¼Œå¯ä»¥ä½¿ç”¨ <code>-D</code> å¼ºåˆ¶åˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -D feature-new-functionality<br></code></pre></td></tr></table></figure><h3 id="7-æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“"><a href="#7-æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="7. æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“"></a>7. <strong>æ¨é€åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</strong></h3><p>å¦‚æœæƒ³å°†æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆä¾‹å¦‚ GitHubï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin feature-new-functionality<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†æ–°åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚å›¢é˜Ÿä¸­çš„å…¶ä»–æˆå‘˜ä¹Ÿå¯ä»¥åœ¨è¿œç¨‹ä»“åº“ä¸­çœ‹åˆ°è¿™ä¸ªåˆ†æ”¯ï¼Œå¹¶è¿›è¡Œåä½œã€‚</p><h3 id="8-æ‹‰å–è¿œç¨‹åˆ†æ”¯"><a href="#8-æ‹‰å–è¿œç¨‹åˆ†æ”¯" class="headerlink" title="8. æ‹‰å–è¿œç¨‹åˆ†æ”¯"></a>8. <strong>æ‹‰å–è¿œç¨‹åˆ†æ”¯</strong></h3><p>å½“åœ¨è¿œç¨‹ä»“åº“ä¸­å‘ç°å…¶ä»–äººåˆ›å»ºçš„åˆ†æ”¯æ—¶ï¼Œå¯ä»¥å°†å®ƒæ‹‰å–åˆ°æœ¬åœ°ï¼Œè¿›è¡Œåä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git fetch<br>git checkout &lt;branch-name&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git fetch<br>git checkout feature-other-developer<br></code></pre></td></tr></table></figure><h3 id="9-ä½¿ç”¨-Git-åˆ†æ”¯çš„æœ€ä½³å®è·µ"><a href="#9-ä½¿ç”¨-Git-åˆ†æ”¯çš„æœ€ä½³å®è·µ" class="headerlink" title="9. ä½¿ç”¨ Git åˆ†æ”¯çš„æœ€ä½³å®è·µ"></a>9. <strong>ä½¿ç”¨ Git åˆ†æ”¯çš„æœ€ä½³å®è·µ</strong></h3><ul><li><strong>ä¸»åˆ†æ”¯ä¿æŒç¨³å®š</strong>ï¼šé€šå¸¸ï¼Œ<code>main</code> æˆ– <code>master</code> åˆ†æ”¯åº”ä¿æŒç¨³å®šã€‚å¯ä»¥åœ¨å…¶ä»–åŠŸèƒ½åˆ†æ”¯ä¸­è¿›è¡Œå®éªŒæˆ–å¼€å‘ï¼Œå½“ç¡®è®¤æ— è¯¯åå†åˆå¹¶å›ä¸»åˆ†æ”¯ã€‚</li><li><strong>å°è€Œé¢‘ç¹çš„æäº¤</strong>ï¼šåœ¨åˆ†æ”¯ä¸Šå·¥ä½œæ—¶ï¼Œè¿›è¡Œå°è€Œé¢‘ç¹çš„æäº¤æœ‰åŠ©äºæ›´å¥½åœ°è¿½è¸ªè¿›å±•å’Œæ›´å®¹æ˜“åœ°è§£å†³å†²çªã€‚</li><li><strong>å®šæœŸåŒæ­¥ä¸»åˆ†æ”¯</strong>ï¼šå¦‚æœåŠŸèƒ½åˆ†æ”¯å¼€å‘å‘¨æœŸè¾ƒé•¿ï¼Œå»ºè®®å®šæœŸå°† <code>main</code> åˆ†æ”¯ä¸­çš„æ›´æ–°åˆå¹¶åˆ°åŠŸèƒ½åˆ†æ”¯ï¼Œä»¥é¿å…è¾ƒå¤§çš„å†²çªã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 6</title>
    <link href="/2024/10/20/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-6/"/>
    <url>/2024/10/20/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-6/</url>
    
    <content type="html"><![CDATA[<h1 id="å³å€¼å¼•ç”¨ï¼ˆC-11-C-17-C-20ï¼‰"><a href="#å³å€¼å¼•ç”¨ï¼ˆC-11-C-17-C-20ï¼‰" class="headerlink" title="å³å€¼å¼•ç”¨ï¼ˆC++11 C++17 C++20ï¼‰"></a>å³å€¼å¼•ç”¨ï¼ˆC++11 C++17 C++20ï¼‰</h1><h2 id="1-å·¦å€¼å’Œå³å€¼"><a href="#1-å·¦å€¼å’Œå³å€¼" class="headerlink" title="1 å·¦å€¼å’Œå³å€¼"></a>1 å·¦å€¼å’Œå³å€¼</h2><p>åœ¨C++ä¸­</p><ul><li><strong>å·¦å€¼</strong>ä¸€èˆ¬æ˜¯æŒ‡ä¸€ä¸ªæŒ‡å‘ç‰¹å®šå†…å­˜çš„å…·æœ‰åç§°çš„å€¼ï¼ˆå…·åå¯¹è±¡ï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„å†…å­˜åœ°å€ï¼Œå¹¶ä¸”æœ‰ä¸€æ®µè¾ƒé•¿çš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li><strong>å³å€¼</strong>åˆ™æ˜¯ä¸æŒ‡å‘ç¨³å®šå†…å­˜åœ°å€çš„åŒ¿åå€¼ï¼ˆä¸å…·åå¯¹è±¡ï¼‰ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œé€šå¸¸æ˜¯æš‚æ—¶æ€§çš„ã€‚</li></ul><p>åŸºäºè¿™ä¸€ç‰¹å¾ï¼Œå¯ä»¥ç”¨å–åœ°å€ç¬¦&amp;æ¥åˆ¤æ–­å·¦å€¼å’Œå³å€¼ï¼Œèƒ½å–åˆ°å†…å­˜åœ°å€çš„å€¼ä¸ºå·¦å€¼ï¼Œå¦åˆ™ä¸ºå³å€¼ã€‚</p><div class="note note-primary">            <p>é™¤å­—ç¬¦ä¸²å­—é¢é‡ä»¥å¤–çš„å­—é¢é‡ï¼Œé€šå¸¸éƒ½æ˜¯å³å€¼ã€‚ç¼–è¯‘å™¨ä¼šå°†å­—ç¬¦ä¸²å­—é¢é‡å­˜å‚¨åˆ°ç¨‹åºçš„æ•°æ®æ®µä¸­ï¼Œç¨‹åºåŠ è½½çš„æ—¶å€™ä¹Ÿä¼šä¸ºå…¶å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å–åœ°å€ç¬¦&amp;æ¥è·å–å­—ç¬¦ä¸²å­—é¢é‡çš„å†…å­˜åœ°å€ã€‚</p>          </div><h2 id="2-å·¦å€¼å¼•ç”¨"><a href="#2-å·¦å€¼å¼•ç”¨" class="headerlink" title="2 å·¦å€¼å¼•ç”¨"></a>2 å·¦å€¼å¼•ç”¨</h2><p>å·¦å€¼å¼•ç”¨åœ¨ä¼ å‚çš„æ—¶å€™ç»å¸¸ä½¿ç”¨ï¼Œå¯ä»¥å…å»åˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡çš„æ“ä½œã€‚</p><p>éå¸¸é‡å·¦å€¼å¼•ç”¨çš„å¼•ç”¨å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªå·¦å€¼</p><p>å¸¸é‡å·¦å€¼å¼•ç”¨çš„å¼•ç”¨å¯¹è±¡å¯ä»¥å¼•ç”¨å³å€¼ã€‚è¿™ä¸ªç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œåœ¨ä½œä¸ºå‚æ•°çš„æ—¶å€™ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªå³å€¼ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´å‚æ•°çš„å¸¸é‡æ€§ï¼Œéœ€è¦å³å€¼å¼•ç”¨æ¥è§£å†³ã€‚</p><h2 id="3-å³å€¼å¼•ç”¨"><a href="#3-å³å€¼å¼•ç”¨" class="headerlink" title="3 å³å€¼å¼•ç”¨"></a>3 å³å€¼å¼•ç”¨</h2><p>å³å€¼å¼•ç”¨æ˜¯ä¸€ç§å¼•ç”¨å³å€¼ä¸”åªèƒ½å¼•ç”¨å³å€¼çš„æ–¹æ³•ã€‚åœ¨è¯­æ³•æ–¹é¢å³å€¼å¼•ç”¨å¯ä»¥å¯¹æ¯”å·¦å€¼å¼•ç”¨ï¼Œåœ¨å·¦å€¼å¼•ç”¨å£°æ˜ä¸­ï¼Œéœ€è¦åœ¨ç±»å‹åæ·»åŠ &amp;ï¼Œè€Œå³å€¼å¼•ç”¨åˆ™æ˜¯åœ¨ç±»å‹åæ·»åŠ &amp;&amp;</p><p>å³å€¼å¼•ç”¨çš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯å¯ä»¥å»¶é•¿å³å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚ä»¥æ­¤è¾¾åˆ°å‡å°‘å¤åˆ¶ï¼Œæå‡æ€§èƒ½çš„æ•ˆæœã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">X</span> &#123;<br><span class="hljs-keyword">public</span>:<br>  <span class="hljs-built_in">X</span>() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;X ctor&quot;</span> &lt;&lt; std::endl; &#125;<br>  <span class="hljs-built_in">X</span>(<span class="hljs-type">const</span> X&amp;x) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;X copy ctor&quot;</span> &lt;&lt; std::endl; &#125;<br>  ~<span class="hljs-built_in">X</span>() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;X dtor&quot;</span> &lt;&lt; std::endl; &#125;<br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>&#123; std::cout &lt;&lt; <span class="hljs-string">&quot;show X&quot;</span> &lt;&lt; std::endl; &#125;<br>&#125;;<br><br><span class="hljs-function">X <span class="hljs-title">make_x</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  X x1;<br>  <span class="hljs-keyword">return</span> x1;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  X &amp;&amp;x2 = <span class="hljs-built_in">make_x</span>();<br>  x<span class="hljs-number">2.</span><span class="hljs-built_in">show</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‰§è¡Œ <code>X x2 = make_x();</code>ï¼Œåœ¨æ²¡æœ‰ä»»ä½•ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä¼šæ‰§è¡Œä¸‰æ¬¡æ„é€ å‡½æ•°ï¼Œé¦–å…ˆæ„é€ x1ï¼Œç„¶åreturnçš„æ—¶å€™æ‰§è¡Œæ‹·è´æ„é€ å‡½æ•°æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œæœ€åèµ‹å€¼çš„æ—¶å€™è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ã€‚</p><p>å¦‚æœæ‰§è¡Œ <code>X &amp;&amp;x2 = make_x();</code>ï¼Œåˆ™åªä¼šæ‰§è¡Œä¸¤æ¬¡æ„é€ å‡½æ•°ï¼Œå‰ä¸¤æ¬¡å’Œä¸Šé¢ä¸€æ ·ï¼Œä½†æ˜¯æœ€åç”±äºx2å³å€¼å¼•ç”¨äº†ä¸´æ—¶å¯¹è±¡ï¼Œå› æ­¤è¿™ä¸ªä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½æœŸå¾—ä»¥å»¶é•¿ã€‚</p><h2 id="4-ç§»åŠ¨è¯­ä¹‰"><a href="#4-ç§»åŠ¨è¯­ä¹‰" class="headerlink" title="4 ç§»åŠ¨è¯­ä¹‰"></a>4 ç§»åŠ¨è¯­ä¹‰</h2><p>c++11æ ‡å‡†æä¾›äº†ç§»åŠ¨è¯­ä¹‰ï¼Œå¯ä»¥å°†èµ„æºåœ¨å¯¹è±¡ä¸­è¿›è¡Œè½¬ç§»ï¼Œå³è¿›è¡Œæµ…æ‹·è´çš„å·¥ä½œã€‚</p><p>ä½¿ç”¨çš„æ—¶å€™æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li>åŒå¤åˆ¶æ„é€ å‡½æ•°ä¸€æ ·ï¼Œç¼–è¯‘å™¨åœ¨ä¸€äº›æ¡ä»¶ä¸‹ä¼šç”Ÿæˆä¸€ä»½ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œè¿™äº›æ¡ä»¶åŒ…æ‹¬ï¼šæ²¡æœ‰ä»»ä½•çš„å¤åˆ¶å‡½æ•°ï¼ŒåŒ…æ‹¬å¤åˆ¶æ„é€ å‡½æ•°å’Œå¤åˆ¶èµ‹å€¼å‡½æ•°ï¼›æ²¡æœ‰ä»»ä½•çš„ç§»åŠ¨å‡½æ•°ï¼ŒåŒ…æ‹¬ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼å‡½æ•°ï¼›ä¹Ÿæ²¡æœ‰ææ„å‡½æ•°ã€‚è™½ç„¶è¿™äº›æ¡ä»¶ä¸¥è‹›å¾—è®©äººæœ‰äº›ä¸å¤ªæ„‰å¿«ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¸å¿…å¯¹ç”Ÿæˆçš„ç§»åŠ¨æ„é€ å‡½æ•°æœ‰å¤ªå¤šæœŸå¾…ï¼Œå› ä¸ºç¼–è¯‘å™¨ç”Ÿæˆçš„ç§»åŠ¨æ„é€ å‡½æ•°å’Œå¤åˆ¶æ„é€ å‡½æ•°å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</li><li>è™½ç„¶ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰åœ¨æ€§èƒ½ä¸Šæœ‰å¾ˆå¤§æ”¶ç›Šï¼Œä½†æ˜¯å´ä¹Ÿæœ‰ä¸€äº›é£é™©ï¼Œè¿™äº›é£é™©æ¥è‡ªå¼‚å¸¸ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨ä¸€ä¸ªç§»åŠ¨æ„é€ å‡½æ•°ä¸­ï¼Œå¦‚æœå½“ä¸€ä¸ªå¯¹è±¡çš„èµ„æºç§»åŠ¨åˆ°å¦ä¸€ä¸ªå¯¹è±¡æ—¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹è±¡çš„ä¸€éƒ¨åˆ†å‘ç”Ÿäº†è½¬ç§»è€Œå¦ä¸€éƒ¨åˆ†æ²¡æœ‰ï¼Œè¿™å°±ä¼šé€ æˆæºå¯¹è±¡å’Œç›®æ ‡å¯¹è±¡éƒ½ä¸å®Œæ•´çš„æƒ…å†µå‘ç”Ÿï¼Œè¿™ç§æƒ…å†µçš„åæœæ˜¯æ— æ³•é¢„æµ‹çš„ã€‚æ‰€ä»¥åœ¨ç¼–å†™ç§»åŠ¨è¯­ä¹‰çš„å‡½æ•°æ—¶å»ºè®®ç¡®ä¿å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸æ­¤åŒæ—¶ï¼Œå¦‚æœæ— æ³•ä¿è¯ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨noexceptè¯´æ˜ç¬¦é™åˆ¶è¯¥å‡½æ•°ã€‚è¿™æ ·å½“å‡½æ•°æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œç¨‹åºä¸ä¼šå†ç»§ç»­æ‰§è¡Œè€Œæ˜¯è°ƒç”¨std::terminateä¸­æ­¢æ‰§è¡Œä»¥å…é€ æˆå…¶ä»–ä¸è‰¯å½±å“ã€‚</li></ol><h2 id="5-å€¼ç±»åˆ«"><a href="#5-å€¼ç±»åˆ«" class="headerlink" title="5 å€¼ç±»åˆ«"></a>5 å€¼ç±»åˆ«</h2><p>å€¼ç±»åˆ«æ˜¯C++11æ ‡å‡†ä¸­æ–°å¼•å…¥çš„æ¦‚å¿µï¼Œå…·ä½“æ¥è¯´å®ƒæ˜¯è¡¨è¾¾å¼çš„ä¸€ç§å±æ€§ï¼Œè¯¥å±æ€§å°†è¡¨è¾¾å¼åˆ†ä¸º3ä¸ªç±»åˆ«ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å·¦å€¼ï¼ˆlvalueï¼‰ã€çº¯å³å€¼ï¼ˆprvalueï¼‰å’Œå°†äº¡å€¼ï¼ˆxvalueï¼‰ã€‚</p><p><img src="/../images/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-6/image-20241020202812151.png"></p><p>å®é™…ä¸Šï¼Œè¿™é‡Œçš„å·¦å€¼ï¼ˆlvalueï¼‰å°±æ˜¯ä¸Šæ–‡ä¸­æè¿°çš„C++98çš„å·¦å€¼ï¼Œè€Œè¿™é‡Œçš„çº¯å³å€¼ï¼ˆprvalueï¼‰åˆ™å¯¹åº”ä¸Šæ–‡ä¸­æè¿°çš„C++98çš„å³å€¼ã€‚</p><p>å°†äº¡å€¼ï¼ˆ<strong>Xvalue</strong>ï¼ŒExpiring valueï¼‰æ˜¯è¡¨ç¤ºå³å°†â€œè¢«é”€æ¯â€çš„å€¼ï¼Œé€šå¸¸æ˜¯<strong>èµ„æºå¯ä»¥è¢«ç§»åŠ¨çš„å¯¹è±¡</strong>ã€‚å°†äº¡å€¼å…è®¸èµ„æºè¢«â€œç§»åŠ¨â€ï¼Œå³å…è®¸å°†å…¶å†…éƒ¨çš„èµ„æºè½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯æ‹·è´ã€‚</p><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>å¯ä»¥è¢«ç§»åŠ¨æ„é€ æˆ–ç§»åŠ¨èµ‹å€¼ã€‚</li><li>å…¸å‹çš„å°†äº¡å€¼åŒ…æ‹¬ï¼šè¿”å›å³å€¼å¼•ç”¨çš„è¡¨è¾¾å¼ã€<code>std::move</code> è½¬æ¢åçš„å¯¹è±¡ã€‚</li></ul><h2 id="6-å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼"><a href="#6-å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼" class="headerlink" title="6 å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼"></a>6 å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼</h2><p>åœ¨c++11ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>static_cast&lt;Foo&amp;&amp;&gt;(foo)</code> å°†ä¸€ä¸ªå·¦å€¼è½¬æ¢ä¸ºä¸€ä¸ªå°†äº¡å€¼ï¼Œç„¶åå°†å³å€¼å¼•ç”¨ç»‘å®šåˆ°è¿™ä¸ªå°†äº¡å€¼ä¸Šã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è®©å·¦å€¼ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè½¬æ¢å‰åï¼Œå¯¹è±¡å…·æœ‰ç›¸åŒçš„å†…å­˜åœ°å€å’Œç”Ÿå‘½å‘¨æœŸã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">move_pool</span><span class="hljs-params">(BigMemoryPool &amp;&amp;pool)</span></span><br><span class="hljs-function"></span>&#123;<br>  std::cout &lt;&lt; <span class="hljs-string">&quot;call move_pool&quot;</span> &lt;&lt; std::endl;<br>  <span class="hljs-function">BigMemoryPool <span class="hljs-title">my_pool</span><span class="hljs-params">(pool)</span></span>; <span class="hljs-comment">// è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span><br>  <span class="hljs-function">BigMemoryPool <span class="hljs-title">my_pool1</span><span class="hljs-params">(<span class="hljs-keyword">static_cast</span>&lt;BigMemoryPool&amp;&amp;&gt;(pool))</span></span>; <span class="hljs-comment">// è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">move_pool</span>(<span class="hljs-built_in">make_pool</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œè™½ç„¶ <code>make_pool</code> è¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œä¸” <code>move_pool</code> çš„å½¢å‚æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä½†æ˜¯åœ¨æ„é€  <code>my_pool</code> çš„æ—¶å€™è¿˜æ˜¯ä¼šæ‰§è¡Œæ‹·è´æ„é€ å‡½æ•°ã€‚è¿™æ˜¯å› ä¸ºæ— è®ºä¸€ä¸ªå‡½æ•°çš„å®å‚æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œå³ä½¿å½¢å‚æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œè¿™ä¸ªå½¢å‚æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå·¦å€¼ã€‚</p><p>c++11çš„æ ‡å‡†åº“ä¸­æä¾›äº†ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ <code>std::move</code> æ¥å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼Œæœ¬è´¨ä¹Ÿæ˜¯ç”¨ <code>static_cast</code> æ¥åšçš„è½¬æ¢ï¼Œæ¨èä½¿ç”¨ <code>std::move</code> ã€‚</p><h2 id="7-ä¸‡èƒ½å¼•ç”¨å’Œå¼•ç”¨æŠ˜å "><a href="#7-ä¸‡èƒ½å¼•ç”¨å’Œå¼•ç”¨æŠ˜å " class="headerlink" title="7 ä¸‡èƒ½å¼•ç”¨å’Œå¼•ç”¨æŠ˜å "></a>7 ä¸‡èƒ½å¼•ç”¨å’Œå¼•ç”¨æŠ˜å </h2><p>å«æœ‰ <code>T&amp;&amp;</code> å’Œ <code>auto&amp;&amp;</code> çš„æ˜¯ä¸‡èƒ½å¼•ç”¨ã€‚åœ¨è¿™ä¸ªæ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œåˆå§‹åŒ–çš„æºå¯¹è±¡å¦‚æœæ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œåˆ™ç›®æ ‡å¯¹è±¡ä¼šæ¨å¯¼å‡ºå·¦å€¼å¼•ç”¨ï¼›åä¹‹å¦‚æœæºå¯¹è±¡æ˜¯ä¸€ä¸ªå³å€¼ï¼Œåˆ™ä¼šæ¨å¯¼å‡ºå³å€¼å¼•ç”¨ï¼Œä¸è¿‡æ— è®ºå¦‚ä½•éƒ½ä¼šæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ã€‚</p><p>ä¸‡èƒ½å¼•ç”¨èƒ½å¦‚æ­¤çµæ´»åœ°å¼•ç”¨å¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯å› ä¸ºåœ¨C++11ä¸­æ·»åŠ äº†ä¸€å¥—å¼•ç”¨å åŠ æ¨å¯¼çš„è§„åˆ™â€”â€”å¼•ç”¨æŠ˜å ã€‚</p><p><img src="/../images/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-6/image-20241020211329825.png"></p><h2 id="8-å®Œç¾è½¬å‘"><a href="#8-å®Œç¾è½¬å‘" class="headerlink" title="8 å®Œç¾è½¬å‘"></a>8 å®Œç¾è½¬å‘</h2><p>ä¸‡èƒ½å¼•ç”¨æœ€å…¸å‹çš„ç”¨é€”è¢«ç§°ä¸ºå®Œç¾è½¬å‘ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show_type</span><span class="hljs-params">(T t)</span></span><br><span class="hljs-function"></span>&#123;<br>  std::cout &lt;&lt; <span class="hljs-built_in">typeid</span>(t).<span class="hljs-built_in">name</span>() &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">normal_forwarding</span><span class="hljs-params">(T t)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">show_type</span>(t);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  std::string s = <span class="hljs-string">&quot;hello world&quot;</span>;<br>  <span class="hljs-built_in">normal_forwarding</span>(s);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨ <code>normal_forwarding</code> çš„æ—¶å€™ï¼Œä¼šæ‹·è´ä¸€æ¬¡å­—ç¬¦ä¸²ï¼Œç„¶åè°ƒç”¨ <code>show_type</code> çš„æ—¶å€™ï¼Œåˆå°†æ‹·è´ä¸€æ¬¡å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥å°† <code>normal_forwarding</code> çš„å½¢å‚å£°æ˜ä¸ºå¼•ç”¨æ¥å‡å°‘ä¸€æ¬¡æ‹·è´ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´å‡½æ•°æ— æ³•æ¥å—å³å€¼ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿå¯ä»¥é€šè¿‡å¸¸é‡å·¦å€¼å¼•ç”¨æ¥è§£å†³ï¼Œä½†æ˜¯è¿™å°±ä¼šå¯¼è‡´æ— æ³•ä¿®æ”¹å­—ç¬¦ä¸²ã€‚</p><p>æœ‰äº†ä¸‡èƒ½å¼•ç”¨ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºå½¢å‚tä¸€å®šæ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œä¸ºäº†è®©è½¬å‘èƒ½å¤Ÿå°†å·¦å³å€¼å±æ€§å¸¦åˆ°ç›®æ ‡å‡½æ•°ä¸­å»ï¼ˆ<code>show_type</code>ï¼‰ï¼Œè¿™é‡Œéœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼ŒåŒæ ·ç”¨åˆ°äº†å¼•ç”¨æŠ˜å çš„æ¦‚å¿µã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show_type</span><span class="hljs-params">(T t)</span></span><br><span class="hljs-function"></span>&#123;<br>  std::cout &lt;&lt; <span class="hljs-built_in">typeid</span>(t).<span class="hljs-built_in">name</span>() &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">perfect_forwarding</span><span class="hljs-params">(T &amp;&amp;t)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">show_type</span>(<span class="hljs-built_in">static_cast</span>&lt;T&amp;&amp;&gt;(t));<br>&#125;<br><br><span class="hljs-function">std::string <span class="hljs-title">get_string</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hi world&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  std::string s = <span class="hljs-string">&quot;hello world&quot;</span>;<br>  <span class="hljs-built_in">perfect_forwarding</span>(s);<br>  <span class="hljs-built_in">perfect_forwarding</span>(<span class="hljs-built_in">get_string</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨c++11æ ‡å‡†åº“ä¸­æä¾›äº† <code>std::forward</code> å‡½æ•°æ¨¡æ¿ï¼Œå…¶å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨ <code>static_cast</code> è¿›è¡Œçš„ç±»å‹è½¬æ¢ï¼Œä½†æ˜¯é‡‡ç”¨ <code>std::forward</code> ä½¿è¯­ä¹‰æ›´åŠ æ¸…æ¥šã€‚</p><p>æ³¨æ„ <code>std::move</code> å’Œ <code>std::forward</code> çš„åŒºåˆ«ï¼š</p><ul><li>å…¶ä¸­ <code>std::move</code> ä¸€å®šä¼šå°†å®å‚è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>std::move</code> ä¸éœ€è¦æŒ‡å®šæ¨¡æ¿å®å‚ï¼Œæ¨¡æ¿å®å‚æ˜¯ç”±å‡½æ•°è°ƒç”¨æ¨å¯¼å‡ºæ¥çš„ã€‚</li><li>è€Œ <code>std::forward</code> ä¼šæ ¹æ®å·¦å€¼å’Œå³å€¼çš„å®é™…æƒ…å†µè¿›è¡Œè½¬å‘ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™<strong>éœ€è¦æŒ‡å®šæ¨¡æ¿å®å‚</strong>ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 5</title>
    <link href="/2024/10/20/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-5/"/>
    <url>/2024/10/20/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-5/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°è¿”å›ç±»å‹åç½®ï¼ˆC-11ï¼‰"><a href="#å‡½æ•°è¿”å›ç±»å‹åç½®ï¼ˆC-11ï¼‰" class="headerlink" title="å‡½æ•°è¿”å›ç±»å‹åç½®ï¼ˆC++11ï¼‰"></a>å‡½æ•°è¿”å›ç±»å‹åç½®ï¼ˆC++11ï¼‰</h1><h2 id="1-ä½¿ç”¨å‡½æ•°è¿”å›ç±»å‹åç½®å£°æ˜å‡½æ•°"><a href="#1-ä½¿ç”¨å‡½æ•°è¿”å›ç±»å‹åç½®å£°æ˜å‡½æ•°" class="headerlink" title="1 ä½¿ç”¨å‡½æ•°è¿”å›ç±»å‹åç½®å£°æ˜å‡½æ•°"></a>1 ä½¿ç”¨å‡½æ•°è¿”å›ç±»å‹åç½®å£°æ˜å‡½æ•°</h2><p>è¿”å›å¤æ‚ç±»å‹çš„æ—¶å€™ï¼Œè¿”å›ç±»å‹åç½®æ›´æœ‰æ•ˆã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">bar_impl</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> x;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span><span class="hljs-params">(*bar)</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span>;<br><span class="hljs-function">bar <span class="hljs-title">foo1</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> bar_impl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">foo2</span><span class="hljs-params">()</span>-&gt;<span class="hljs-title">int</span><span class="hljs-params">(*)</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> bar_impl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">auto</span> func = <span class="hljs-built_in">foo2</span>();<br>  <span class="hljs-built_in">func</span>(<span class="hljs-number">58</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-æ¨å¯¼å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹"><a href="#2-æ¨å¯¼å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹" class="headerlink" title="2 æ¨å¯¼å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹"></a>2 æ¨å¯¼å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹</h2><p>C++11æ ‡å‡†ä¸­å‡½æ•°è¿”å›ç±»å‹åç½®çš„ä½œç”¨ä¹‹ä¸€æ˜¯æ¨å¯¼å‡½æ•°æ¨¡æ¿çš„è¿”å›ç±»å‹ï¼Œå‰ææ˜¯éœ€è¦ç”¨åˆ°decltypeè¯´æ˜ç¬¦</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T1, <span class="hljs-keyword">class</span> T2&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">sum1</span><span class="hljs-params">(T1 t1, T2 t2)</span>-&gt;<span class="hljs-title">decltype</span><span class="hljs-params">(t1 + t2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> t1 + t2;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>  <span class="hljs-keyword">auto</span> x1 = <span class="hljs-built_in">sum1</span>(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 4</title>
    <link href="/2024/10/20/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-4/"/>
    <url>/2024/10/20/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-4/</url>
    
    <content type="html"><![CDATA[<h1 id="decltypeè¯´æ˜ç¬¦ï¼ˆC-11ï½C-17ï¼‰"><a href="#decltypeè¯´æ˜ç¬¦ï¼ˆC-11ï½C-17ï¼‰" class="headerlink" title="decltypeè¯´æ˜ç¬¦ï¼ˆC++11ï½C++17ï¼‰"></a>decltypeè¯´æ˜ç¬¦ï¼ˆC++11ï½C++17ï¼‰</h1><h2 id="1-ä½¿ç”¨decltypeè¯´æ˜ç¬¦"><a href="#1-ä½¿ç”¨decltypeè¯´æ˜ç¬¦" class="headerlink" title="1 ä½¿ç”¨decltypeè¯´æ˜ç¬¦"></a>1 ä½¿ç”¨decltypeè¯´æ˜ç¬¦</h2><p>decltypeè¯´æ˜ç¬¦å¯ä»¥è·å–å¯¹è±¡æˆ–è€…è¡¨è¾¾å¼çš„ç±»å‹ã€‚å¹¶ä¸”å¯ä»¥ç”¨äºéé™æ€æˆå‘˜å˜é‡ã€‚</p><p><strong>ç”¨å¤„</strong></p><ol><li><p>åœ¨c++11æ ‡å‡†ä¸­ï¼Œä¸æ”¯æŒå¯¹autoå£°æ˜çš„è¿”å›ç±»å‹è¿›è¡Œæ¨å¯¼ï¼Œæ‰€ä»¥éœ€è¦ç”¨decltypeåœ¨å‡½æ•°çš„å°¾éƒ¨å¯¹è¿”å›ç±»å‹è¿›è¡Œè¯´æ˜</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T1, <span class="hljs-keyword">class</span> T2&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">sum</span><span class="hljs-params">(T1 a1, T2 a2)</span>-&gt;<span class="hljs-title">decltype</span><span class="hljs-params">(a1 + a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> a1 + a2;<br>&#125;<br><br><span class="hljs-keyword">auto</span> x4 = <span class="hljs-built_in">sum</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10.5</span>);<br></code></pre></td></tr></table></figure></li><li><p>åœ¨c++14æ ‡å‡†ä¸­ï¼Œæ”¯æŒå¯¹autoå£°æ˜çš„è¿”å›ç±»å‹è¿›è¡Œæ¨å¯¼ï¼Œå¯ä»¥ç®€åŒ–ä¸º</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T1, <span class="hljs-keyword">class</span> T2&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">sum</span><span class="hljs-params">(T1 a1, T2 a2)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> a1 + a2;<br>&#125;<br><br><span class="hljs-keyword">auto</span> x5 = <span class="hljs-built_in">sum</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10.5</span>);<br></code></pre></td></tr></table></figure></li><li><p>ä½†æ˜¯ï¼Œä¸Šè¿°ä»£ç æœ‰ä¸€ç‚¹é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬æœŸæœ›è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œä¸Šè¿°ä»£ç æ— æ³•åšåˆ°ã€‚é…åˆdecltypeå¯ä»¥åšåˆ°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">return_ref</span><span class="hljs-params">(T&amp; t)</span>-&gt;<span class="hljs-title">decltype</span><span class="hljs-params">(t)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> t;<br>&#125;<br><br><span class="hljs-type">int</span> x1 = <span class="hljs-number">0</span>;<br><span class="hljs-built_in">static_assert</span>(<br>    std::is_reference_v&lt;<span class="hljs-keyword">decltype</span>(<span class="hljs-built_in">return_ref</span>(x1))&gt;    <span class="hljs-comment">// ç¼–è¯‘æˆåŠŸ</span><br>    );<br></code></pre></td></tr></table></figure></li></ol><h2 id="2-æ¨å¯¼è§„åˆ™"><a href="#2-æ¨å¯¼è§„åˆ™" class="headerlink" title="2 æ¨å¯¼è§„åˆ™"></a>2 æ¨å¯¼è§„åˆ™</h2><p>decltype(e)ï¼ˆå…¶ä¸­eçš„ç±»å‹ä¸ºTï¼‰çš„æ¨å¯¼è§„åˆ™æœ‰5æ¡ã€‚</p><ol><li>å¦‚æœeæ˜¯ä¸€ä¸ª<strong>æœªåŠ æ‹¬å·çš„æ ‡è¯†ç¬¦è¡¨è¾¾å¼</strong>ï¼ˆç»“æ„åŒ–ç»‘å®šé™¤å¤–ï¼‰æˆ–è€…<strong>æœªåŠ æ‹¬å·çš„ç±»æˆå‘˜è®¿é—®</strong>ï¼Œåˆ™decltype(e)æ¨æ–­å‡ºçš„ç±»å‹æ˜¯eçš„ç±»å‹Tã€‚å¦‚æœå¹¶ä¸å­˜åœ¨è¿™æ ·çš„ç±»å‹ï¼Œæˆ–è€…eæ˜¯ä¸€ç»„é‡è½½å‡½æ•°ï¼Œåˆ™æ— æ³•è¿›è¡Œæ¨å¯¼ã€‚</li><li>å¦‚æœeæ˜¯ä¸€ä¸ª<strong>å‡½æ•°è°ƒç”¨æˆ–è€…ä»¿å‡½æ•°è°ƒç”¨</strong>ï¼Œé‚£ä¹ˆdecltype(e)æ¨æ–­å‡ºçš„ç±»å‹æ˜¯å…¶<strong>è¿”å›å€¼çš„ç±»å‹</strong>ã€‚</li><li>å¦‚æœeæ˜¯ä¸€ä¸ª<strong>ç±»å‹ä¸ºTçš„å·¦å€¼</strong>ï¼Œåˆ™decltype(e)æ˜¯T&amp;ã€‚</li><li>å¦‚æœeæ˜¯ä¸€ä¸ª<strong>ç±»å‹ä¸ºTçš„å°†äº¡å€¼</strong>ï¼Œåˆ™decltype(e)æ˜¯T&amp;&amp;ã€‚</li><li>é™¤å»ä»¥ä¸Šæƒ…å†µï¼Œåˆ™decltype(e)æ˜¯Tã€‚</li></ol><h2 id="3-cvé™å®šç¬¦çš„æ¨å¯¼"><a href="#3-cvé™å®šç¬¦çš„æ¨å¯¼" class="headerlink" title="3 cvé™å®šç¬¦çš„æ¨å¯¼"></a>3 cvé™å®šç¬¦çš„æ¨å¯¼</h2><ul><li>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨å¯¼ä¼šåŒæ­¥eçš„cvé™å®šç¬¦ã€‚</li><li>å½“eæ˜¯æœªåŠ æ‹¬å·çš„æˆå‘˜å˜é‡æ—¶ï¼Œçˆ¶å¯¹è±¡è¡¨è¾¾å¼çš„cvé™å®šç¬¦ä¼šè¢«å¿½ç•¥</li><li>å½“eæ˜¯åŠ æ‹¬å·çš„æˆå‘˜å˜é‡æ—¶ï¼Œçˆ¶å¯¹è±¡è¡¨è¾¾å¼çš„cvé™å®šç¬¦ä¼šåŒæ­¥åˆ°ç»“æœ</li></ul><h2 id="4-decltype-auto"><a href="#4-decltype-auto" class="headerlink" title="4 decltype(auto)"></a>4 decltype(auto)</h2><p>C++14æ ‡å‡†ä¸­å‡ºç°äº†decltypeå’Œautoä¸¤ä¸ªå…³é”®å­—çš„ç»“åˆä½“ï¼šdecltype(auto)ã€‚å®ƒçš„ä½œç”¨ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ç”¨decltypeçš„æ¨å¯¼è¡¨è¾¾å¼è§„åˆ™æ¥æ¨å¯¼autoã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œdecltype(auto)å¿…é¡»å•ç‹¬å£°æ˜ï¼Œä¹Ÿå°±æ˜¯å®ƒä¸èƒ½ç»“åˆæŒ‡é’ˆã€å¼•ç”¨ä»¥åŠcvé™å®šç¬¦ã€‚</p><p>æœ‰äº†è¿™ä¸ªç”¨æ³•ï¼Œä¸Šè¿°è¿”å›å¼•ç”¨çš„ç±»å‹å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> T&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">decltype</span>(<span class="hljs-keyword">auto</span>) <span class="hljs-title">return_ref</span><span class="hljs-params">(T&amp; t)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> t;<br>&#125;<br><br><span class="hljs-type">int</span> x1 = <span class="hljs-number">0</span>;<br><span class="hljs-built_in">static_assert</span>(<br>    std::is_reference_v&lt;<span class="hljs-keyword">decltype</span>(<span class="hljs-built_in">return_ref</span>(x1))&gt;    <span class="hljs-comment">// ç¼–è¯‘æˆåŠŸ</span><br>    );<br></code></pre></td></tr></table></figure><h2 id="5-decltype-auto-ä½œä¸ºéç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦"><a href="#5-decltype-auto-ä½œä¸ºéç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦" class="headerlink" title="5 decltype(auto)ä½œä¸ºéç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦"></a>5 decltype(auto)ä½œä¸ºéç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦</h2><p>ä¸autoä¸€æ ·ï¼Œåœ¨C++17æ ‡å‡†ä¸­decltype(auto)ä¹Ÿèƒ½ä½œä¸ºéç±»å‹æ¨¡æ¿å½¢å‚çš„å ä½ç¬¦</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 8</title>
    <link href="/2024/10/20/OS-Three-Easy-Pieces-Chapter-8/"/>
    <url>/2024/10/20/OS-Three-Easy-Pieces-Chapter-8/</url>
    
    <content type="html"><![CDATA[<h1 id="Scheduling-The-Multi-Level-Feedback-Queue"><a href="#Scheduling-The-Multi-Level-Feedback-Queue" class="headerlink" title="Scheduling: The Multi-Level Feedback Queue"></a>Scheduling: The Multi-Level Feedback Queue</h1><p>å¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆMulti-level Feedback Queueï¼ŒMLFQï¼‰éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li><p>ä¼˜åŒ–å‘¨è½¬æ—¶é—´</p><p>é€šè¿‡SJFæˆ–è€…STCTå¯ä»¥ä¼˜åŒ–å‘¨è½¬æ—¶é—´ï¼Œä½†æ˜¯è¿™éœ€è¦æå‰çŸ¥é“ä¸€ä¸ªä»»åŠ¡çš„è¿è¡Œæ—¶é—´ã€‚</p></li><li><p>ä¼˜åŒ–å“åº”æ—¶é—´</p><p>RRå¯ä»¥ä¼˜åŒ–å“åº”æ—¶é—´ï¼Œä½†æ˜¯å‘¨è½¬æ—¶é—´å¾ˆå·®ã€‚</p></li></ol><h2 id="1-MLFQ-Basic-Rules"><a href="#1-MLFQ-Basic-Rules" class="headerlink" title="1 MLFQ: Basic Rules"></a>1 MLFQ: Basic Rules</h2><p>å¤šçº§åé¦ˆé˜Ÿåˆ—æœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§ä¸åŒã€‚æ€»æ˜¯è®©ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡å…ˆè¿è¡Œï¼Œå¦‚æœä¸¤ä¸ªä»»åŠ¡åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§ç›¸åŒï¼‰ï¼Œåˆ™ä½¿ç”¨RRç­–ç•¥ã€‚</p><ul><li>è§„åˆ™1ï¼šå¦‚æœ$Priority(A) &gt; Priority(b)$ï¼Œé‚£ä¹ˆAè¿è¡Œ</li><li>è§„åˆ™2ï¼šå¦‚æœ$Priority(A) &#x3D; Priority(B)$ï¼Œé‚£ä¹ˆAï¼ŒBç”¨RRç­–ç•¥</li></ul><p>å¤šçº§åé¦ˆé˜Ÿåˆ—æ ¹æ®ä»»åŠ¡çš„å†å²è¡Œä¸ºæ¥é¢„æµ‹ä»»åŠ¡çš„æœªæ¥è¡Œä¸ºï¼Œå¹¶ä»¥æ­¤è°ƒæ•´ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚å¦‚æœä¸€ä¸ªä»»åŠ¡é¢‘ç¹çš„æ”¾å¼ƒCPUï¼Œç”³è¯·IOï¼Œé‚£ä¹ˆç»´æŒè¿™ä¸ªä»»åŠ¡çš„é«˜ä¼˜å…ˆçº§ï¼ˆIOå¯†é›†å‹ï¼‰ï¼Œå› ä¸ºè¯¥ä»»åŠ¡å¯èƒ½éœ€è¦è¾ƒå¼ºçš„äº¤äº’æ€§ï¼›åä¹‹ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ä½¿ç”¨CPUå¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼ˆCPUå¯†é›†å‹ï¼‰ï¼Œé‚£ä¹ˆé™ä½ä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-8/image-20241020162512090.png"></p><h2 id="2-Attempt-1-How-To-Change-Priority"><a href="#2-Attempt-1-How-To-Change-Priority" class="headerlink" title="2 Attempt #1: How To Change Priority"></a>2 Attempt #1: How To Change Priority</h2><p><strong>ä»»åŠ¡çš„é…é¢</strong>ï¼šå³ä¸€ä¸ªç»™å®šä»»åŠ¡åœ¨å½“å‰ä¼˜å…ˆçº§çš„é˜Ÿåˆ—èƒ½è¿è¡Œçš„æ—¶é—´ï¼Œå¦‚æœæ—¶é—´ç”¨å®Œäº†ï¼Œé‚£ä¹ˆå°±ä¼šé™ä½å…¶ä¼˜å…ˆçº§ã€‚</p><ul><li><strong>è§„åˆ™3</strong>ï¼šä½œä¸šè¿›å…¥ç³»ç»Ÿæ—¶ï¼Œä¼šè¢«ç½®äºæœ€é«˜ä¼˜å…ˆçº§ï¼ˆæœ€é¡¶é˜Ÿåˆ—ï¼‰ã€‚</li><li><strong>è§„åˆ™4a</strong>ï¼šå¦‚æœä½œä¸šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”¨å®Œäº†åˆ†é…èµ„æºï¼Œå…¶ä¼˜å…ˆçº§å°±ä¼šé™ä½ï¼ˆå³å‘ä¸‹ç§»åŠ¨ä¸€ä¸ªé˜Ÿåˆ—ï¼‰ã€‚</li><li><strong>è§„åˆ™4b</strong>ï¼šå¦‚æœä½œä¸šåœ¨åˆ†é…æ—¶é—´ç»“æŸå‰æ”¾å¼ƒ CPUï¼ˆå¦‚æ‰§è¡Œ I&#x2F;O æ“ä½œï¼‰ï¼Œåˆ™å…¶ä¼˜å…ˆçº§ä¿æŒä¸å˜ï¼ˆå³å…¶åˆ†é…æ—¶é—´è¢«é‡ç½®ï¼‰ã€‚</li></ul><p><strong>é—®é¢˜</strong></p><ol><li><p>é¥¥é¥¿é—®é¢˜</p><p>å¦‚æœä¸€ç›´æœ‰çŸ­ä½œä¸šåˆ°æ¥ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§ä½çš„ä»»åŠ¡å°†æ°¸è¿œæ— æ³•è¿è¡Œã€‚</p></li><li><p>æ¶æ„ç¨‹åº</p><p>å¦‚æœä¸€ä¸ªä»»åŠ¡åœ¨ç”¨å®Œè‡ªå·±çš„æ—¶é—´ç‰‡ä¹‹å‰ï¼Œç”³è¯·ä¸€ä¸ªIOæ“ä½œï¼Œé‚£ä¹ˆå®ƒå°†æ°¸è¿œç»´æŒé«˜ä¼˜å…ˆçº§ï¼Œå¯¼è‡´åˆ†é…ä¸å…¬å¹³ã€‚</p></li><li><p>ä»»åŠ¡å˜åŠ¨</p><p>å¦‚æœä¸€ä¸ªä»»åŠ¡ä»CPUå¯†é›†å‹è½¬å˜ä¸ºIOå¯†é›†å‹ï¼Œå¦‚ä½•å¤„ç†</p></li></ol><h2 id="3-Attempt-2-The-Priority-Boost"><a href="#3-Attempt-2-The-Priority-Boost" class="headerlink" title="3 Attempt #2: The Priority Boost"></a>3 Attempt #2: The Priority Boost</h2><ul><li><strong>è§„åˆ™5</strong>ï¼šåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´Såï¼Œå°†æ‰€æœ‰çš„ä»»åŠ¡é‡æ–°æ”¾ç½®åœ¨æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ã€‚</li></ul><p>é€šè¿‡è¿™ä¹ˆåšï¼Œè§£å†³äº†ä¸Šè¿°çš„é—®é¢˜1å’Œé—®é¢˜2ã€‚</p><p>Sçš„å€¼å¾ˆéš¾ç¡®å®šï¼Œå¦‚æœå¤ªé•¿ï¼Œä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡é¥¥é¥¿ï¼›å¦‚æœå¤ªçŸ­ï¼Œä¼šå¯¼è‡´äº¤äº’æ€§é™ä½ã€‚</p><h2 id="4-Attempt-3-Better-Accounting"><a href="#4-Attempt-3-Better-Accounting" class="headerlink" title="4 Attempt #3: Better Accounting"></a>4 Attempt #3: Better Accounting</h2><p>è°ƒåº¦å™¨åº”è¯¥è®°å½•æ¯ä¸ªä»»åŠ¡åœ¨å½“å‰é˜Ÿåˆ—çš„è¿è¡Œæ—¶é—´ï¼Œåªè¦ç”¨å®Œäº†æ—¶é—´ç‰‡ï¼Œå°±é™ä½å…¶ä¼˜å…ˆçº§ã€‚æ‰€ä»¥ï¼Œè§„åˆ™4ä¿®æ”¹ä¸º</p><ul><li><strong>è§„åˆ™4</strong>ï¼šä¸€æ—¦æŸé¡¹ä½œä¸šç”¨å®Œäº†ç»™å®šçº§åˆ«çš„æ—¶é—´åˆ†é…ï¼ˆæ— è®ºå®ƒè®©å‡º CPU å¤šå°‘æ¬¡ï¼‰ï¼Œå…¶ä¼˜å…ˆçº§å°±ä¼šé™ä½ï¼ˆå³å‘ä¸‹ç§»åŠ¨ä¸€ä¸ªé˜Ÿåˆ—ï¼‰ã€‚</li></ul><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-8/image-20241020164719536.png"></p><h2 id="5-Tuning-MLFQ-And-Other-Issues"><a href="#5-Tuning-MLFQ-And-Other-Issues" class="headerlink" title="5 Tuning MLFQ And Other Issues"></a>5 Tuning MLFQ And Other Issues</h2><p>å¤§å¤šæ•°å®ç°å…è®¸ä¸åŒä¼˜å…ˆçº§çš„é˜Ÿåˆ—æœ‰ä¸åŒçš„æ—¶é—´ç‰‡å¤§å°ï¼Œé«˜ä¼˜å…ˆçº§çš„é€šå¸¸å°ä¸€ç‚¹ï¼Œä½ä¼˜å…ˆçº§çš„é€šå¸¸é«˜ä¸€äº›ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 7</title>
    <link href="/2024/10/20/OS-Three-Easy-Pieces-Chapter-7/"/>
    <url>/2024/10/20/OS-Three-Easy-Pieces-Chapter-7/</url>
    
    <content type="html"><![CDATA[<h1 id="Scheduling-Introduction"><a href="#Scheduling-Introduction" class="headerlink" title="Scheduling: Introduction"></a>Scheduling: Introduction</h1><h2 id="1-Workload-Assumptions"><a href="#1-Workload-Assumptions" class="headerlink" title="1 Workload Assumptions"></a>1 Workload Assumptions</h2><ol><li>Each job runs for the same amount of time. </li><li>All jobs arrive at the same time. </li><li>Once started, each job runs to completion. </li><li>All jobs only use the CPU (i.e., they perform no I&#x2F;O) </li><li>The run-time of each job is known.</li></ol><h2 id="2-Scheduling-Metrics"><a href="#2-Scheduling-Metrics" class="headerlink" title="2 Scheduling Metrics"></a>2 Scheduling Metrics</h2><ul><li>å‘¨è½¬æ—¶é—´ï¼ˆturnaround timeï¼‰ï¼š$T_{turnaround} &#x3D; T_{completion} - T_{arrival}$</li><li>å…¬å¹³æ€§</li><li>å“åº”æ—¶é—´ï¼ˆresponse timeï¼‰ï¼š$T_{response} &#x3D; T_{fisrtrun} - T_{arrival}$</li></ul><h2 id="3-First-In-First-Out-FIFO"><a href="#3-First-In-First-Out-FIFO" class="headerlink" title="3 First In, First Out (FIFO)"></a>3 First In, First Out (FIFO)</h2><p>æœ€åŸºæœ¬çš„è°ƒåº¦ç®—æ³•ï¼Œå…ˆåˆ°æ¥çš„ä»»åŠ¡å…ˆæ‰§è¡Œï¼Œä¹Ÿç§°ä¸ºå…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰ã€‚</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>å®ç°ç®€å•</li><li>æ— é¥¥é¥¿ç°è±¡</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>å­˜åœ¨æŠ¤èˆªæ•ˆåº”ï¼ˆconvoy effectï¼‰ï¼Œå³çŸ­ä½œä¸šæ’åœ¨é•¿ä½œä¸šä¹‹åï¼Œå¯¼è‡´ç³»ç»Ÿå¹³å‡å‘¨è½¬æ—¶é—´è¾¹é•¿ã€‚</li></ul><h2 id="4-Shortest-Job-First-SJF"><a href="#4-Shortest-Job-First-SJF" class="headerlink" title="4  Shortest Job First (SJF)"></a>4  Shortest Job First (SJF)</h2><p>æ¯æ¬¡é€‰æ‹©è°ƒåº¦å½“å‰æœ€çŸ­çš„ä»»åŠ¡ã€‚ä¼ ç»Ÿä¸Šæ˜¯ä¸å¯æŠ¢å çš„ã€‚</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>å¹³å‡å‘¨è½¬æ—¶é—´è¾ƒçŸ­</li><li>ç®€å•</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>å½“ä»»åŠ¡åˆ°è¾¾æ—¶é—´ä¸åŒçš„æ—¶å€™ï¼Œä»ç„¶å­˜åœ¨æŠ¤èˆªæ•ˆåº”</li></ul><h2 id="5-Shortest-Time-to-Completion-First-STCF"><a href="#5-Shortest-Time-to-Completion-First-STCF" class="headerlink" title="5 Shortest Time-to-Completion First (STCF)"></a>5 Shortest Time-to-Completion First (STCF)</h2><p>æœ€çŸ­å®Œæˆæ—¶é—´ï¼Œä¹Ÿç§°ä¸ºæŠ¢å å¼çŸ­ä½œä¸šä¼˜å…ˆï¼ˆPSJFï¼‰ã€‚</p><p>è¯¥è°ƒåº¦ç­–ç•¥æ˜¯å¯¹çŸ­ä½œä¸šä¼˜å…ˆçš„æ”¹è¿›ï¼Œæ¯å½“æœ‰æ–°çš„ä»»åŠ¡åˆ°æ¥çš„æ—¶å€™ï¼Œå°±æŠ¢å å½“å‰è¿›ç¨‹ï¼Œè®©è°ƒåº¦å™¨æ ¹æ®ç›®å‰æ‰€éœ€æœ€çŸ­å®Œæˆæ—¶é—´æ¥è¿›è¡Œè°ƒåº¦ã€‚</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>è§£å†³äº†SJFçš„æŠ¤èˆªæ•ˆåº”</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>å“åº”æ—¶é—´é•¿ï¼Œäº¤äº’æ€§å·®</li></ul><h2 id="6-Round-Robin"><a href="#6-Round-Robin" class="headerlink" title="6 Round Robin"></a>6 Round Robin</h2><p>å°†CPUåˆ’åˆ†ä¸ºæ—¶é—´ç‰‡ï¼Œå¹³å‡åˆ†é…ç»™å„ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹è½®æµå¾—åˆ°æ—¶é—´ç‰‡ã€‚</p><p><strong>ä¼˜ç‚¹</strong></p><ul><li>å…¬å¹³</li><li>å“åº”æ—¶é—´ä½</li></ul><p><strong>ç¼ºç‚¹</strong></p><ul><li>å¹³å‡å‘¨è½¬æ—¶é—´å·®ï¼ˆæœ€å·®ä¹‹ä¸€ï¼‰</li></ul><p>æ—¶é—´ç‰‡è¿‡é•¿ä¼šå¯¼è‡´å“åº”æ—¶é—´å˜å·®ï¼Œæœ€åæƒ…å†µä¸‹ä¼šé€€åŒ–æˆFCFSã€‚æ—¶é—´ç‰‡è¿‡çŸ­è™½ç„¶ä¼šæå‡å“åº”æ—¶é—´ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€è¿‡å¤§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§å¼€é”€ä¸å•å•æ˜¯åˆ‡æ¢å¯„å­˜å™¨çš„å€¼ï¼Œå½“ç¨‹åºè¿è½¬çš„æ—¶å€™ï¼Œä¼šåœ¨CPUç¼“å­˜ï¼ŒTLBï¼Œåˆ†æ”¯é¢„æµ‹ç­‰ç¡¬ä»¶å»ºç«‹å¾ˆå¤šçŠ¶æ€æ¥æå‡æ•ˆç‡ï¼Œå½“åˆ‡æ¢è¿›ç¨‹çš„æ—¶å€™ï¼Œè¿™äº›çŠ¶æ€å…¨éƒ¨éœ€è¦æ›¿æ¢ï¼Œé€ æˆä¸€å®šçš„å¼€é”€ã€‚</p><h2 id="7-Incorporating-I-O"><a href="#7-Incorporating-I-O" class="headerlink" title="7 Incorporating I&#x2F;O"></a>7 Incorporating I&#x2F;O</h2><p>å°†ä»»åŠ¡åˆ†ä¸ºCPUå¯†é›†å‹å’ŒIOå¯†é›†å‹ï¼ŒIOå¯†é›†å‹çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„åˆ©ç”¨èµ„æºã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-7/image-20241020160849081.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 6</title>
    <link href="/2024/10/19/OS-Three-Easy-Pieces-Chapter-6/"/>
    <url>/2024/10/19/OS-Three-Easy-Pieces-Chapter-6/</url>
    
    <content type="html"><![CDATA[<h1 id="Mechanism-Limited-Direct-Execution"><a href="#Mechanism-Limited-Direct-Execution" class="headerlink" title="Mechanism: Limited Direct Execution"></a>Mechanism: Limited Direct Execution</h1><p>æ“ä½œç³»ç»Ÿå¿…é¡»ä»¥<strong>é«˜æ•ˆ</strong>çš„æ–¹å¼è™šæ‹ŸåŒ– CPUï¼ŒåŒæ—¶ä¿ç•™å¯¹ç³»ç»Ÿçš„<strong>æ§åˆ¶</strong>ã€‚ä¸ºæ­¤ï¼Œéœ€è¦<strong>ç¡¬ä»¶</strong>å’Œ<strong>æ“ä½œç³»ç»Ÿ</strong>çš„æ”¯æŒã€‚æ“ä½œç³»ç»Ÿé€šå¸¸ä¼šæ˜æ™ºåœ°ä½¿ç”¨ä¸€äº›ç¡¬ä»¶æ”¯æŒï¼Œä»¥ä¾¿æœ‰æ•ˆåœ°å®Œæˆå·¥ä½œã€‚</p><h2 id="1-Basic-Technique-Limited-Direct-Execution"><a href="#1-Basic-Technique-Limited-Direct-Execution" class="headerlink" title="1 Basic Technique: Limited Direct Execution"></a>1 Basic Technique: Limited Direct Execution</h2><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-6/image-20241019145343980.png"></p><p>å›¾ä¸­æ˜¾ç¤ºäº†ç›´æ¥æ‰§è¡Œçš„ç®€è¦æµç¨‹ï¼Œè¿™ä¸ªæµç¨‹å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿå¦‚ä½•ä¿æŒå¯¹è¿›ç¨‹çš„æ§åˆ¶ï¼Œé˜²æ­¢å…¶åšè¿æ³•æ“ä½œ</li><li>æ“ä½œç³»ç»Ÿå¦‚ä½•åˆ‡æ¢è¿›ç¨‹ï¼Œä»¥åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«CPU</li></ul><h2 id="2-Problem-1-Restricted-Operations"><a href="#2-Problem-1-Restricted-Operations" class="headerlink" title="2 Problem #1: Restricted Operations"></a>2 Problem #1: Restricted Operations</h2><p>ä¸ºäº†é™åˆ¶è¿›ç¨‹çš„è¡Œä¸ºï¼Œæå‡ºå†…æ ¸æ€å’Œç”¨æˆ·æ€çš„æ¦‚å¿µã€‚</p><p>ç”¨æˆ·è¿›ç¨‹ä¸€èˆ¬è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€ä¸­å¯¹ç¡¬ä»¶èµ„æºçš„è®¿é—®æ˜¯å—é™çš„ï¼Œä¸èƒ½æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼ˆè®¿é—®IOç­‰ï¼‰ï¼›è€Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¸€èˆ¬è¿è¡Œåœ¨å†…æ ¸æ€ï¼Œåœ¨å†…æ ¸æ€ä¸­å¯¹ç¡¬ä»¶èµ„æºæœ‰å®Œæ•´çš„è®¿é—®æƒé™ï¼Œå¯ä»¥æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼Œè®¿é—®å„ç§IOç­‰ã€‚</p><p>æœ‰äº†è¿™ä¸ªæ¦‚å¿µï¼Œå½“ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å¸Œæœ›è®¿é—®ä¸€äº›ç¡¬ä»¶èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œå‘Šè¯‰æ“ä½œç³»ç»Ÿä»–è¦å¹²å•¥ï¼Œç„¶åæ“ä½œç³»ç»Ÿè¿›è¡Œä¸€äº›å‚æ•°ã€æƒé™æ£€æŸ¥ç­‰ï¼Œç¡®ä¿ç”¨æˆ·è¿›ç¨‹æœ‰æƒåˆ©æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå¹¶ä¸”è¿™ä¸ªæ“ä½œä¸æ˜¯ä¸€äº›æ¶æ„æ“ä½œï¼Œç„¶åæ›¿ç”¨æˆ·è¿›ç¨‹æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå†è¿”å›ç”¨æˆ·è¿›ç¨‹ç»§ç»­æ‰§è¡Œã€‚ä»ç”¨æˆ·è¿›ç¨‹çš„è§†è§’æ¥çœ‹ï¼Œç³»ç»Ÿè°ƒç”¨å°±åƒä»»ä½•ä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°è°ƒç”¨ä¸€æ ·ã€‚</p><p>ä¸ºäº†æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œç¨‹åºå¿…é¡»æ‰§è¡Œä¸€ä¸ªç‰¹æ®Šçš„<strong>trap</strong>æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤è·³è½¬åˆ°å†…æ ¸ä¸­å¹¶ä¿®æ”¹å½“å‰æ€ä¸ºå†…æ ¸æ€ï¼ŒåŒæ—¶ï¼Œè¯¥æŒ‡ä»¤ä¹Ÿä¼šä¿å­˜ä¸€äº›å¯„å­˜å™¨åˆ°å†…æ ¸æ ˆï¼ˆæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªï¼‰ä¸­ï¼Œä»¥ä¾¿èƒ½å¤Ÿé¡ºåˆ©è¿”å›åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚å½“æ“ä½œç³»ç»Ÿå®Œæˆç³»ç»Ÿè°ƒç”¨åï¼Œä¼šæ‰§è¡Œä¸€ä¸ªç‰¹æ®Šçš„è¿”å›æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤ä»å†…æ ¸æ ˆä¸­æ¢å¤å¯„å­˜å™¨çš„å€¼ï¼Œè¿”å›åˆ°ç”¨æˆ·è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä¿®æ”¹å½“å‰æ€ä¸ºç”¨æˆ·æ€ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-6/image-20241019152221694.png"></p><p>æœ€åï¼Œä¸€ä¸ªtrapæŒ‡ä»¤å¦‚ä½•çŸ¥é“è·³è½¬åˆ°å“ªé‡Œæ‰§è¡Œå‘¢ï¼Œå¦‚ä½•åŒºåˆ†ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨ã€‚æˆ‘ä»¬ä¸èƒ½å…è®¸ç”¨æˆ·è¿›ç¨‹ç›´æ¥æŒ‡å®šæ‰§è¡ŒæŒ‡ä»¤çš„ä½ç½®ï¼Œå› æ­¤ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡ä¸€ä¸ªtrap tableæ¥å®ç°ã€‚trap tableå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œå°†ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨æ˜ å°„åˆ°å¯¹åº”çš„å¤„ç†ä¾‹ç¨‹çš„åœ°å€ã€‚æ‰§è¡ŒtrapæŒ‡ä»¤çš„æ—¶å€™ï¼Œç”±ç”¨æˆ·è´Ÿè´£æä¾›ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å·ï¼Œç„¶åæ“ä½œç³»ç»Ÿæ ¹æ®è¿™ä¸ªç³»ç»Ÿè°ƒç”¨å·è·³è½¬åˆ°å¯¹åº”çš„åœ°æ–¹æ‰§è¡Œã€‚trap tableæ˜¯åœ¨æ“ä½œç³»ç»Ÿbootçš„æ—¶å€™è®¾å®šçš„ï¼ˆé€šè¿‡æŸç§ç‰¹æƒæŒ‡ä»¤å‘Šè¯‰ç¡¬ä»¶trap tableçš„åœ°å€ï¼Œç¡¬ä»¶è®°ä½è¿™ä¸ªåœ°å€ï¼Œä¹‹åç›´æ¥åˆ°è¿™é‡ŒæŸ¥æ‰¾ï¼‰ã€‚</p><h2 id="3-Problem-2-Switching-Between-Processes"><a href="#3-Problem-2-Switching-Between-Processes" class="headerlink" title="3 Problem #2: Switching Between Processes"></a>3 Problem #2: Switching Between Processes</h2><h3 id="æ“ä½œç³»ç»Ÿå¦‚ä½•è·å–æ§åˆ¶æƒ"><a href="#æ“ä½œç³»ç»Ÿå¦‚ä½•è·å–æ§åˆ¶æƒ" class="headerlink" title="æ“ä½œç³»ç»Ÿå¦‚ä½•è·å–æ§åˆ¶æƒ"></a>æ“ä½œç³»ç»Ÿå¦‚ä½•è·å–æ§åˆ¶æƒ</h3><p>è¿›ç¨‹åˆ‡æ¢çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“è¿›ç¨‹ä¸ŠCPUæ‰§è¡Œä¹‹åï¼Œæ“ä½œç³»ç»Ÿç†è®ºä¸Šå°±ä¸èƒ½æ‰§è¡Œä»»ä½•æ“ä½œäº†ï¼ˆæ²¡æœ‰CPUèµ„æºï¼‰ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿå¦‚ä½•åˆ‡æ¢è¿›ç¨‹ï¼Ÿå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ç§æœºåˆ¶è®©æ“ä½œç³»ç»Ÿèƒ½å¤Ÿé‡æ–°è·å–æ§åˆ¶æƒã€‚</p><ol><li><p>åˆä½œæ–¹æ³•ï¼šç­‰å¾…è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</p><p>åœ¨æ—©æœŸçš„OSä¸­ï¼Œå†…æ ¸ç›¸ä¿¡è¿›ç¨‹ä¼šæ—¶ä¸æ—¶çš„è®©å‡ºCPUçš„æ§åˆ¶æƒï¼Œå³ä½¿è¿›ç¨‹ä¸è®©å‡ºæ§åˆ¶æƒï¼Œå…¶ä¹Ÿä¼šæ—¶ä¸æ—¶çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–è€…æ˜¯è§¦å‘å¼‚å¸¸ç­‰ï¼Œæ“ä½œç³»ç»Ÿåœ¨æ­¤æ—¶è·å–æ§åˆ¶æƒã€‚ç„¶è€Œï¼Œå½“è¿›ç¨‹é™·å…¥æ­»å¾ªç¯ä¸­ï¼Œæ“ä½œç³»ç»Ÿå°±æ— æ³•è·å–æ§åˆ¶æƒäº†ã€‚</p></li><li><p>éåˆä½œæ–¹æ³•ï¼šæ“ä½œç³»ç»Ÿæ¥ç®¡</p><p>é€šè¿‡å€ŸåŠ©ç¡¬ä»¶çš„å¸®åŠ©ï¼ˆ<strong>æ—¶é’Ÿä¸­æ–­</strong>ï¼‰ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥è·å–æ§åˆ¶æƒã€‚å…·ä½“çš„ï¼Œåœ¨bootçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå‘Šè¯‰ç¡¬ä»¶ï¼Œå½“å‘ç”Ÿæ—¶é’Ÿä¸­æ–­çš„æ—¶å€™ï¼Œæ‰§è¡Œä»€ä¹ˆä»£ç ï¼Œç„¶åå¯åŠ¨æ—¶é’Ÿã€‚è¿™æ ·ï¼Œå½“æ—¶é’Ÿä¸­æ–­å‘ç”Ÿçš„æ—¶å€™ï¼Œå½“å‰è¿›ç¨‹å°±ä¼šåœæ­¢æ‰§è¡Œï¼Œç„¶åè·³è½¬åˆ°æ—¶é’Ÿä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡Œï¼Œè¿™æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±è·å–äº†æ§åˆ¶æƒï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹ä¸­æ–­å¤„ç†å’Œç³»ç»Ÿè°ƒç”¨å¾ˆç±»ä¼¼ï¼Œç¡¬ä»¶éƒ½è¦è´Ÿè´£ä¿å­˜å¯„å­˜å™¨çš„å€¼ï¼Œåˆ‡æ¢æ€ç­‰ï¼Œä»¥ä¾¿ä¹‹åèƒ½å¤Ÿé¡ºåˆ©ç»§ç»­æ‰§è¡Œã€‚</p></li></ol><h2 id="4-Saving-and-Restoring-Context"><a href="#4-Saving-and-Restoring-Context" class="headerlink" title="4 Saving and Restoring Context"></a>4 Saving and Restoring Context</h2><p>ä¸Šä¸‹æ–‡åˆ‡æ¢è¦åšçš„äº‹æƒ…å…¶å®å¾ˆç®€å•ï¼Œä¿å­˜å½“å‰è¿›ç¨‹çš„å¯„å­˜å™¨çš„å€¼åˆ°PCBä¸­ï¼Œç„¶åä»è¦åˆ‡æ¢çš„è¿›ç¨‹çš„PCBä¸­æ¢å¤è¿™äº›å€¼åˆ°å¯„å­˜å™¨ä¸­ã€‚å…·ä½“çš„ï¼Œå½“æ—¶é’Ÿä¸­æ–­å‘ç”Ÿçš„æ—¶å€™ï¼Œç¡¬ä»¶ä¼šè´Ÿè´£å°†ä¸€äº›å¯„å­˜å™¨ä¿å­˜åˆ°å½“å‰è¿›ç¨‹Açš„å†…æ ¸æ ˆä¸­ï¼Œç„¶åè¿›å…¥æ—¶é’Ÿä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œï¼Œå¹¶åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå†…æ ¸å†³å®šè¦è¿›è¡Œè°ƒåº¦ï¼Œåˆ‡æ¢å¦ä¸€ä¸ªè¿›ç¨‹Bæ‰§è¡Œï¼Œæ­¤æ—¶è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°†å½“å‰å¯„å­˜å™¨çš„å€¼ä¿å­˜åˆ°å½“å‰è¿›ç¨‹Açš„PCBä¸­ï¼Œç„¶åä»è¿›ç¨‹Bçš„PCBä¸­æ¢å¤è¿™äº›å¯„å­˜å™¨çš„å€¼ï¼Œç„¶ååˆ‡æ¢åˆ°è¿›ç¨‹Bçš„å†…æ ¸æ ˆï¼Œæ­¤æ—¶æ‰§è¡Œè¿”å›æŒ‡ä»¤ï¼Œç¡¬ä»¶ä»å†…æ ¸æ ˆä¸­æ¢å¤å¯„å­˜å™¨çš„å€¼ï¼Œè·³è½¬åˆ°è¿›ç¨‹Bè¢«ä¸­æ–­çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚å¯èƒ½è¿˜ä¼šæ¶‰åŠé¢å¤–çš„é¡µè¡¨çš„åˆ‡æ¢ã€‚</p><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-6/image-20241019163100890.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 5</title>
    <link href="/2024/10/18/OS-Three-Easy-Pieces-Chapter-5/"/>
    <url>/2024/10/18/OS-Three-Easy-Pieces-Chapter-5/</url>
    
    <content type="html"><![CDATA[<h1 id="Interlude-Process-API"><a href="#Interlude-Process-API" class="headerlink" title="Interlude: Process API"></a>Interlude: Process API</h1><span id="more"></span><h2 id="1-The-fork-System-Call"><a href="#1-The-fork-System-Call" class="headerlink" title="1 The fork() System Call"></a>1 The <code>fork()</code> System Call</h2><p><code>fork</code> ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹å‡ ä¹å’ŒåŸæ¥çš„è¿›ç¨‹å®Œå…¨ä¸€æ ·ï¼Œå…·ä½“æ¥è¯´ï¼Œå®ƒè¿”å›ç»™ <code>fork</code> è°ƒç”¨çš„è¿”å›å€¼å’Œçˆ¶è¿›ç¨‹æ˜¯ä¸åŒçš„ã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œè¿”å›å€¼æ˜¯å­è¿›ç¨‹çš„PIDï¼Œè€Œåœ¨å­è¿›ç¨‹ä¸­ï¼Œè¿”å›å€¼æ˜¯0. æ–°è¿›ç¨‹ä¸ä¼šä» <code>main</code> å¼€å§‹æ‰§è¡Œï¼Œè€Œæ˜¯ä»è°ƒç”¨ <code>fork</code> çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤å¼€å§‹æ‰§è¡Œã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“åˆ›å»ºå¥½è¿›ç¨‹ä¹‹åï¼Œæ­¤æ—¶ç³»ç»Ÿä¸­å°±æœ‰ä¸¤ä¸ªå°±ç»ªçš„è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼‰ï¼ŒäºŒè€…è°å…ˆè¿è¡Œæ˜¯ä¸ç¡®å®šçš„ï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹æ­¤åšä»»ä½•å‡è®¾ã€‚</p><h2 id="2-The-wait-System-Call"><a href="#2-The-wait-System-Call" class="headerlink" title="2 The wait() System Call"></a>2 The <code>wait()</code> System Call</h2><p>æœ‰æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹å®Œæˆæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>wait</code> æˆ–è€… <code>waitpid</code> ç³»ç»Ÿè°ƒç”¨æ¥å®ç°ã€‚çˆ¶è¿›ç¨‹è°ƒç”¨ <code>wait</code> é˜»å¡ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå¹¶å®Œæˆï¼Œåªæœ‰åœ¨å­è¿›ç¨‹é€€å‡ºåï¼Œçˆ¶è¿›ç¨‹æ‰ä¼šä» <code>wait</code> ç³»ç»Ÿè°ƒç”¨è¿”å›ï¼Œç»§ç»­æ‰§è¡Œã€‚</p><h2 id="3-Finally-The-exec-System-Call"><a href="#3-Finally-The-exec-System-Call" class="headerlink" title="3 Finally, The exec() System Call"></a>3 Finally, The exec() System Call</h2><p><code>exec</code> ç³»ç»Ÿè°ƒç”¨ç”¨å¦ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºçš„ä»£ç å’Œé™æ€æ•°æ®è¦†ç›–å½“å‰è¿›ç¨‹çš„ä»£ç å’Œå¯æ‰§è¡Œæ•°æ®ï¼Œå †æ ˆç­‰å†…å­˜ç©ºé—´éƒ½è¢«é‡æ–°åˆå§‹åŒ–ï¼Œä¹‹åæ“ä½œç³»ç»Ÿè¿è¡Œè¿™ä¸ªæ–°çš„ç¨‹åºã€‚</p><p>æˆåŠŸçš„ <code>exec</code> è°ƒç”¨ä¸ä¼šè¿”å›ã€‚</p><h2 id="4-Why-Motivating-The-API"><a href="#4-Why-Motivating-The-API" class="headerlink" title="4 Why? Motivating The API"></a>4 Why? Motivating The API</h2><p>ä¹‹æ‰€ä»¥è¦è¿™æ ·è®¾è®¡ <code>fork</code> å’Œ <code>exec</code> ï¼Œæ˜¯å› ä¸ºè¿™ç§è®¾è®¡å¯ä»¥å…è®¸shellåœ¨ <code>fork</code> ä¹‹åï¼Œ<code>exec</code> ä¹‹å‰æ‰§è¡Œä¸€äº›ä»£ç ã€‚è¿™æ ·å¯ä»¥è®©æˆ‘ä»¬ç®€å•çš„å®ç°ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§ã€‚</p><p>ä¾‹å¦‚IOé‡å®šå‘ï¼ˆ<code>wc p3.c &gt; p3.output</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å­è¿›ç¨‹æ‰§è¡Œ <code>exec</code> ä¹‹å‰ï¼Œå…³é—­æ ‡å‡†è¾“å‡ºï¼Œç„¶åæ‰“å¼€p3.outputæ–‡ä»¶ï¼Œè¿™æ ·ä¹‹åå­è¿›ç¨‹è¿è¡Œçš„ä»»ä½•æœ¬æ¥åº”è¯¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„å†…å®¹éƒ½ä¼šå†™å…¥p3.outputä¸­ã€‚ä¹‹æ‰€ä»¥ä¼šè¿™æ ·æ˜¯å› ä¸ºåœ¨ <code>exec</code> ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œå¹¶ä¸”unixåˆ†é…æ–‡ä»¶æè¿°ç¬¦æ˜¯ä»0å¼€å§‹å¯»æ‰¾ç¬¬ä¸€ä¸ªå°šæœªåˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“æˆ‘ä»¬å…³é—­æ ‡å‡†è¾“å‡ºä¹‹åï¼Œå­è¿›ç¨‹çš„1å·æ–‡ä»¶æè¿°ç¬¦å°±å¯ç”¨äº†ï¼Œè¿™æ—¶å¦‚æœæˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†1å·æ–‡ä»¶æè¿°ç¬¦åˆ†é…ç»™è¯¥æ–‡ä»¶ã€‚</p><h2 id="5-Process-Control-And-Users"><a href="#5-Process-Control-And-Users" class="headerlink" title="5 Process Control And Users"></a>5 Process Control And Users</h2><p>é™¤äº† fork()ã€exec() å’Œ wait()ï¼ŒUNIX ç³»ç»Ÿä¸­è¿˜æœ‰å¾ˆå¤šä¸è¿›ç¨‹äº¤äº’çš„æ¥å£ã€‚ä¾‹å¦‚ï¼Œkill() ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘è¿›ç¨‹å‘é€ä¿¡å·ï¼ŒåŒ…æ‹¬æš‚åœã€æ­»äº¡å’Œå…¶ä»–æœ‰ç”¨çš„æŒ‡ä»¤ã€‚åœ¨å¤§å¤šæ•° UNIX shell ä¸­ï¼ŒæŸäº›æŒ‰é”®ç»„åˆè¢«é…ç½®ä¸ºå‘å½“å‰è¿è¡Œçš„è¿›ç¨‹å‘é€ç‰¹å®šä¿¡å·ï¼›ä¾‹å¦‚ï¼Œcontrol-c ä¼šå‘è¿›ç¨‹å‘é€ SIGINTï¼ˆä¸­æ–­ï¼‰ä¿¡å·ï¼ˆé€šå¸¸ä¼šç»ˆæ­¢è¿›ç¨‹ï¼‰ï¼Œè€Œ control-z åˆ™ä¼šå‘é€ SIGTSTPï¼ˆåœæ­¢ï¼‰ä¿¡å·ï¼Œä»è€Œä½¿è¿›ç¨‹åœ¨æ‰§è¡Œä¸­é€”æš‚åœï¼ˆå¯ä»¥ç¨åä½¿ç”¨å‘½ä»¤æ¢å¤è¿›ç¨‹ï¼Œä¾‹å¦‚è®¸å¤š shell ä¸­çš„ fg å†…ç½®å‘½ä»¤ï¼‰</p><p>æ•´ä¸ªä¿¡å·ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„åŸºç¡€è®¾æ–½ï¼Œç”¨äºå‘è¿›ç¨‹å‘é€å¤–éƒ¨äº‹ä»¶ï¼ŒåŒ…æ‹¬åœ¨å•ä¸ªè¿›ç¨‹å†…æ¥æ”¶å’Œå¤„ç†è¿™äº›ä¿¡å·çš„æ–¹æ³•ï¼Œä»¥åŠå‘å•ä¸ªè¿›ç¨‹å’Œæ•´ä¸ªè¿›ç¨‹ç»„å‘é€ä¿¡å·çš„æ–¹æ³•ã€‚è¦ä½¿ç”¨è¿™ç§é€šä¿¡æ–¹å¼ï¼Œè¿›ç¨‹åº”ä½¿ç”¨ signal() ç³»ç»Ÿè°ƒç”¨æ¥ â€œæ•è· â€å„ç§ä¿¡å·ï¼›è¿™æ ·åšå¯ç¡®ä¿å½“ç‰¹å®šä¿¡å·ä¼ é€åˆ°è¿›ç¨‹æ—¶ï¼Œè¿›ç¨‹å°†æš‚åœå…¶æ­£å¸¸æ‰§è¡Œï¼Œå¹¶è¿è¡Œç‰¹å®šä»£ç æ¥å“åº”è¯¥ä¿¡å·ã€‚</p><p>è¿™è‡ªç„¶ä¼šå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šè°èƒ½å‘è¿›ç¨‹å‘é€ä¿¡å·ï¼Œè°ä¸èƒ½ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç³»ç»Ÿå¯èƒ½ä¼šæœ‰å¤šäººåŒæ—¶ä½¿ç”¨ï¼›å¦‚æœå…¶ä¸­ä¸€äººå¯ä»¥ä»»æ„å‘é€ SIGINT ç­‰ä¿¡å·ï¼ˆä¸­æ–­è¿›ç¨‹ï¼Œå¾ˆå¯èƒ½ç»ˆæ­¢è¿›ç¨‹ï¼‰ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§å°±ä¼šå—åˆ°å½±å“ã€‚å› æ­¤ï¼Œç°ä»£ç³»ç»Ÿä¸­åŒ…å«äº†å¼ºçƒˆçš„ç”¨æˆ·æ¦‚å¿µã€‚ç”¨æˆ·åœ¨è¾“å…¥å¯†ç å»ºç«‹å‡­è¯åï¼Œç™»å½•ä»¥è®¿é—®ç³»ç»Ÿèµ„æºã€‚ç„¶åï¼Œç”¨æˆ·å¯ä»¥å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œå®Œå…¨æ§åˆ¶ï¼ˆæš‚åœã€æ€æ­»ç­‰ï¼‰ã€‚ç”¨æˆ·é€šå¸¸åªèƒ½æ§åˆ¶è‡ªå·±çš„è¿›ç¨‹ã€‚</p><h2 id="6-Useful-Tools"><a href="#6-Useful-Tools" class="headerlink" title="6 Useful Tools"></a>6 Useful Tools</h2><p>è¿˜æœ‰è®¸å¤šå‘½ä»¤è¡Œå·¥å…·ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œä½¿ç”¨ ps å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼›</li><li>top å·¥å…·ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºç³»ç»Ÿè¿›ç¨‹åŠå…¶å ç”¨çš„ CPU å’Œå…¶ä»–èµ„æºã€‚</li><li>kill å‘½ä»¤å¯ä»¥ç”¨æ¥å‘è¿›ç¨‹å‘é€ä»»æ„ä¿¡å·ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[OS]Three Easy Pieces Chapter 4</title>
    <link href="/2024/10/18/OS-Three-Easy-Pieces-Chapter-4/"/>
    <url>/2024/10/18/OS-Three-Easy-Pieces-Chapter-4/</url>
    
    <content type="html"><![CDATA[<h1 id="The-Abstraction-The-Process"><a href="#The-Abstraction-The-Process" class="headerlink" title="The Abstraction: The Process"></a>The Abstraction: The Process</h1><span id="more"></span><p>è¿›ç¨‹çš„å®šä¹‰ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿è¡Œçš„ç¨‹åºã€‚</p><p><strong>ä¸»è¦çš„æŒ‘æˆ˜</strong>ï¼š</p><p>å³ä½¿æˆ‘ä»¬åªæœ‰å‡ ä¸ªå®é™…çš„ç‰©ç†CPUï¼Œæ“ä½œç³»ç»Ÿå¦‚ä½•æä¾›ä¸€ä¸ªæœ‰æ— é™CPUçš„å‡è±¡ã€‚</p><p>æ“ä½œç³»ç»Ÿé€šè¿‡<strong>è™šæ‹ŸåŒ–</strong>æ¥æä¾›è¿™ç§å‡è±¡ã€‚ä¸ºäº†å®ç°è¿™ç§è™šæ‹ŸåŒ–ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>ä½çº§ç¡¬ä»¶æ”¯æŒï¼šä¸Šä¸‹æ–‡åˆ‡æ¢</li><li>é«˜çº§ç­–ç•¥ï¼šè°ƒåº¦ç­–ç•¥ï¼ˆæ ¹æ®å†å²ä¿¡æ¯ã€å·¥ä½œè´Ÿè½½ã€æ€§èƒ½æŒ‡æ ‡ç­‰ï¼‰</li></ul><h2 id="1-The-Abstraction-A-Process"><a href="#1-The-Abstraction-A-Process" class="headerlink" title="1 The Abstraction: A Process"></a>1 The Abstraction: A Process</h2><p>æ“ä½œç³»ç»Ÿå¯¹è¿è¡Œä¸­ç¨‹åºçš„æŠ½è±¡ï¼Œç§°ä¹‹ä¸ºè¿›ç¨‹ã€‚è¿›ç¨‹åªæ˜¯ä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºï¼›åœ¨ä»»ä½•æ—¶é—´ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡ç›˜ç‚¹è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è®¿é—®æˆ–å½±å“çš„ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†æ¥æ¦‚æ‹¬è¿›ç¨‹</p><p>åœ¨ä»»ä½•æ—¶å€™ï¼Œä¸€ä¸ªè¿›ç¨‹éƒ½å¯ä»¥é€šè¿‡ä»¥ä¸‹çŠ¶æ€æ¥æè¿°ï¼š</p><ul><li>å†…å­˜ç©ºé—´ä¸­çš„å†…å®¹</li><li>å¯„å­˜å™¨ä¸­çš„å€¼</li><li>äº¤äº’çš„IOè®¾å¤‡</li></ul><h2 id="2-Process-API"><a href="#2-Process-API" class="headerlink" title="2 Process API"></a>2 Process API</h2><p>æŠ½è±¡çš„æ¥çœ‹ï¼Œä»»ä½•æ“ä½œç³»ç»Ÿè‡³å°‘è¦æä¾›ä¸€ä¸‹API</p><ul><li><p>Create</p></li><li><p>Destroy</p></li><li><p>Wait</p></li><li><p>Miscel Control</p><p>ä¾‹å¦‚ï¼ŒOSå¸Œæœ›å¯ä»¥æš‚åœæŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œï¼Œä¹‹åå†ç»§ç»­æ‰§è¡Œå®ƒ</p></li><li><p>Status</p><p>è·å–è¿›ç¨‹çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯</p></li></ul><h2 id="3-Process-Creation-A-Little-More-Detail"><a href="#3-Process-Creation-A-Little-More-Detail" class="headerlink" title="3 Process Creation: A Little More Detail"></a>3 Process Creation: A Little More Detail</h2><p>ä¸ºäº†æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œæ“ä½œç³»ç»Ÿï¼š</p><ul><li><p>é¦–å…ˆï¼Œå°†ç¡¬ç›˜ä¸­çš„ç¨‹åºï¼ˆæŒ‡ä»¤ã€é™æ€æ•°æ®ç­‰ï¼‰è£…è½½è¿›å†…å­˜ä¸­ã€‚</p><p>ç¡¬ç›˜ä¸­çš„ç¨‹åºå¿…é¡»ç¬¦åˆæŸç§<strong>å¯æ‰§è¡Œæ ¼å¼</strong>ã€‚æ—©æœŸçš„æ“ä½œç³»ç»Ÿè£…è½½æ—¶å°†æ•´ä¸ªç¨‹åºè£…è½½è¿›å†…å­˜ï¼Œç°ä»£æ“ä½œç³»ç»Ÿé€šå¸¸é‡‡ç”¨æ‡’è£…è½½ï¼Œå³ï¼Œåªå°†éœ€è¦çš„å†…å®¹è£…è½½åˆ°å†…å­˜ä¸­ã€‚</p></li><li><p>ä¹‹åï¼Œæ“ä½œç³»ç»Ÿéœ€è¦åˆ†é…æ ˆå†…å­˜ï¼Œå¹¶ç”¨å‚æ•°åˆå§‹åŒ–è¿™ä¸ªæ ˆï¼ˆargcï¼Œargvï¼‰</p></li><li><p>åˆ†é…å †å†…å­˜</p></li><li><p>å¤„ç†IOç›¸å…³çš„åˆå§‹åŒ–</p><p>Unixä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹åˆå§‹æœ‰ä¸‰ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºï¼Œæ ‡å‡†é”™è¯¯ï¼‰</p></li><li><p>æœ€åï¼Œæ“ä½œç³»ç»Ÿè·³è½¬åˆ°æ–°è¿›ç¨‹çš„entry pointï¼ˆmain()ï¼‰å¼€å§‹æ‰§è¡Œã€‚</p></li></ul><h2 id="4-Process-States"><a href="#4-Process-States" class="headerlink" title="4 Process States"></a>4 Process States</h2><p><img src="/../images/OS-Three-Easy-Pieces-Chapter-4/image-20241018151951494.png" alt="è¿›ç¨‹ä¸‰çŠ¶æ€æ¨¡å‹"></p><h2 id="5-Data-Structures"><a href="#5-Data-Structures" class="headerlink" title="5 Data Structures"></a>5 Data Structures</h2><p>æ“ä½œç³»ç»Ÿéœ€è¦è®°å½•æ‰€æœ‰å°±ç»ªè¿›ç¨‹ï¼Œè¿è¡Œè¿›ç¨‹ï¼Œé˜»å¡è¿›ç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®çš„è½¬æ¢è¿›ç¨‹çš„çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œå½“æŸä¸ªIOäº‹ä»¶å®Œæˆäº†ï¼Œéœ€è¦å°†ä»»ä½•ç­‰å¾…è¯¥äº‹ä»¶çš„è¿›ç¨‹ä»é˜»å¡é˜Ÿåˆ—ç§»åŠ¨åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚</p><p>åœ¨xv6å†…æ ¸ä¸­ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦è·Ÿè¸ªå¹¶è®°å½•å¦‚ä¸‹å†…å®¹ã€‚å½“ä¸€ä¸ªè¿›ç¨‹å°†è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼Œå°†å…¶å¯„å­˜å™¨çš„å€¼ä¿å­˜åˆ° <code>context</code> ç»“æ„ä½“ä¸­ï¼Œä¹‹åå°†ä¸‹ä¸€ä¸ªè¦è°ƒåº¦çš„è¿›ç¨‹çš„ <code>context</code> ç»“æ„ä½“ä¸­çš„å€¼è£…è½½åˆ°å®é™…çš„å¯„å­˜å™¨ä¸­ï¼Œå®Œæˆä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Saved registers for kernel context switches.</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> &#123;</span><br>  uint64 ra;<br>  uint64 sp;<br><br>  <span class="hljs-comment">// callee-saved</span><br>  uint64 s0;<br>  uint64 s1;<br>  uint64 s2;<br>  uint64 s3;<br>  uint64 s4;<br>  uint64 s5;<br>  uint64 s6;<br>  uint64 s7;<br>  uint64 s8;<br>  uint64 s9;<br>  uint64 s10;<br>  uint64 s11;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> &#123;</span> UNUSED, USED, SLEEPING, RUNNABLE, RUNNING, ZOMBIE &#125;;<br><br><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-type">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-type">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-type">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-type">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// wait_lock must be held when using this:</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-type">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">usyscall</span> *<span class="hljs-title">usyscall</span>;</span>   <span class="hljs-comment">// shared data between kernel and user</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-type">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]47.å…¨æ’åˆ—â…¡</title>
    <link href="/2024/10/18/LC-47-%E5%85%A8%E6%8E%92%E5%88%97%E2%85%A1/"/>
    <url>/2024/10/18/LC-47-%E5%85%A8%E6%8E%92%E5%88%97%E2%85%A1/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®šä¸€ä¸ªå¯åŒ…å«é‡å¤æ•°å­—çš„åºåˆ— <code>nums</code> ï¼Œ<em><strong>æŒ‰ä»»æ„é¡ºåº</strong></em> è¿”å›æ‰€æœ‰ä¸é‡å¤çš„å…¨æ’åˆ—ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>è¿™é“é¢˜ç›®ç»™å®šçš„æ•°ç»„ä¸­å­˜åœ¨é‡å¤æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†æ•°å­—æ’åºï¼Œç„¶ååœ¨æšä¸¾$pos$çš„æ—¶å€™åªæšä¸¾ä¸åŒçš„å…ƒç´ ï¼Œå¦‚æœå½“å‰å…ƒç´ å·²ç»åœ¨å½“å‰ä½ç½®è¢«æšä¸¾è¿‡äº†ï¼Œåˆ™è·³è¿‡ï¼Œä¿è¯æ¯ä¸ªä½ç½®æ¯ä¸ªå…ƒç´ åªä¼šè¢«æšä¸¾ä¸€æ¬¡ã€‚</p><p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è·³è¿‡æ¡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯å•çº¯çš„é‡‡ç”¨å¦‚ä¸‹æ¡ä»¶åˆ¤æ–­ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span> &amp;&amp; nums[i] == nums[i - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå¯¼è‡´æšä¸¾ä¸‹ä¸€ä¸ªä½ç½®çš„æ—¶å€™ï¼Œä¹Ÿæ— æ³•æšä¸¾ç›¸åŒçš„å…ƒç´ ï¼Œæ¯”å¦‚1ï¼Œ1ï¼Œ2ã€‚å½“æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªä½ç½®æšä¸¾äº†1ï¼Œç¬¬äºŒä¸ªä½ç½®å°±ä¸èƒ½æšä¸¾1äº†ï¼Œä¼šè¢«è·³è¿‡ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ¡ä»¶ï¼Œåªæœ‰å½“ä¸Šä¸€ä¸ªä½ç½®çš„é‡å¤å…ƒç´ æ²¡æœ‰è¢«è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰è·³è¿‡ï¼Œå¦åˆ™æˆ‘ä»¬ä¸åº”è¯¥è·³è¿‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span> &amp;&amp; nums[i] == nums[i - <span class="hljs-number">1</span>] &amp;&amp; !visited[i - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">permuteUnique</span>(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums) &#123;<br>        cur = <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(nums.<span class="hljs-built_in">size</span>(), <span class="hljs-number">0</span>);<br>        vis = <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">bool</span>&gt;(nums.<span class="hljs-built_in">size</span>(), <span class="hljs-literal">false</span>);<br>        <span class="hljs-built_in">sort</span>(nums.<span class="hljs-built_in">begin</span>(), nums.<span class="hljs-built_in">end</span>());<br>        <span class="hljs-built_in">backtrack</span>(nums, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">backtrack</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums, <span class="hljs-type">int</span> pos)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (pos == nums.<span class="hljs-built_in">size</span>())<br>        &#123;<br>            ans.<span class="hljs-built_in">push_back</span>(cur);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.<span class="hljs-built_in">size</span>(); ++i)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (vis[i]) <span class="hljs-keyword">continue</span>;<br>            <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span> &amp;&amp; nums[i] == nums[i - <span class="hljs-number">1</span>] &amp;&amp; !vis[i - <span class="hljs-number">1</span>])<br>                <span class="hljs-keyword">continue</span>;<br>            vis[i] = <span class="hljs-literal">true</span>;<br>            cur[pos] = nums[i];<br>            <span class="hljs-built_in">backtrack</span>(nums, pos + <span class="hljs-number">1</span>);<br>            vis[i] = <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; ans;<br>    vector&lt;<span class="hljs-type">int</span>&gt; cur;<br>    vector&lt;<span class="hljs-type">bool</span>&gt; vis;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]46.å…¨æ’åˆ—</title>
    <link href="/2024/10/18/LC-46-%E5%85%A8%E6%8E%92%E5%88%97/"/>
    <url>/2024/10/18/LC-46-%E5%85%A8%E6%8E%92%E5%88%97/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ <code>nums</code> ï¼Œè¿”å›å…¶ <em>æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—</em> ã€‚ä½ å¯ä»¥ <strong>æŒ‰ä»»æ„é¡ºåº</strong> è¿”å›ç­”æ¡ˆã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æ ‡è®°æ•°ç»„"><a href="#æ ‡è®°æ•°ç»„" class="headerlink" title="æ ‡è®°æ•°ç»„"></a>æ ‡è®°æ•°ç»„</h4><p>æ¯æ¬¡æšä¸¾ä¸€ä¸ªä½ç½®$pos$çš„å¯èƒ½çš„å€¼ï¼Œå½“å‰æšä¸¾çš„å€¼åœ¨æ ‡è®°æ•°ç»„ä¸­æ ‡è®°ï¼Œç„¶åç»§ç»­æšä¸¾ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">permute</span>(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums) &#123;<br>        cur = <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(nums.<span class="hljs-built_in">size</span>(), <span class="hljs-number">0</span>);<br>        vis = <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">bool</span>&gt;(nums.<span class="hljs-built_in">size</span>(), <span class="hljs-literal">false</span>);<br>        <span class="hljs-built_in">backtrace</span>(nums, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">backtrack</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> pos)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (pos == nums.<span class="hljs-built_in">size</span>())<br>        &#123;<br>            ans.<span class="hljs-built_in">push_back</span>(cur);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.<span class="hljs-built_in">size</span>(); ++i)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (vis[i]) <span class="hljs-keyword">continue</span>;<br>            vis[i] = <span class="hljs-literal">true</span>;<br>            cur[pos] = nums[i];<br>            <span class="hljs-built_in">backtrace</span>(nums, pos + <span class="hljs-number">1</span>);<br>            vis[i] = <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; ans;<br>    vector&lt;<span class="hljs-type">int</span>&gt; cur;<br>    vector&lt;<span class="hljs-type">bool</span>&gt; vis;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(n)$</p><h4 id="åŸåœ°"><a href="#åŸåœ°" class="headerlink" title="åŸåœ°"></a>åŸåœ°</h4><p>æˆ‘ä»¬å¯ä»¥å°†å½“å‰æšä¸¾çš„å…ƒç´ äº¤æ¢åˆ°æ•°ç»„çš„å‰ç«¯ï¼Œä½¿å¾—$[0, pos]$çš„å…ƒç´ æ˜¯æšä¸¾è¿‡çš„å…ƒç´ ï¼Œè€Œ$[pos + 1, n - 1]$çš„å…ƒç´ æ˜¯å°šæœªæšä¸¾è¿‡çš„å…ƒç´ ï¼Œè¿™æ ·æšä¸¾ä¸‹ä¸ªä½ç½®çš„æ—¶å€™ç›´æ¥ä»$pos+1$å¼€å§‹æšä¸¾ï¼Œå°±èƒ½ä¿è¯æšä¸¾çš„å…ƒç´ ä¸€å®šæ˜¯æœªæšä¸¾è¿‡çš„å…ƒç´ ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">permute</span>(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums) &#123;<br>        <span class="hljs-built_in">backtrack</span>(nums, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">backtrack</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums, <span class="hljs-type">int</span> pos)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (pos == nums.<span class="hljs-built_in">size</span>())<br>        &#123;<br>            ans.<span class="hljs-built_in">push_back</span>(nums);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = pos; i &lt; nums.<span class="hljs-built_in">size</span>(); ++i)<br>        &#123;<br>            <span class="hljs-built_in">swap</span>(nums[i], nums[pos]);<br>            <span class="hljs-built_in">backtrack</span>(nums, pos + <span class="hljs-number">1</span>);<br>            <span class="hljs-built_in">swap</span>(nums[i], nums[pos]);<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; ans;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$.</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
      <tag>å›æº¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]24.æ¥é›¨æ°´</title>
    <link href="/2024/10/18/LC-24-%E6%8E%A5%E9%9B%A8%E6%B0%B4/"/>
    <url>/2024/10/18/LC-24-%E6%8E%A5%E9%9B%A8%E6%B0%B4/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®š <code>n</code> ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º <code>1</code> çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æš´åŠ›"><a href="#æš´åŠ›" class="headerlink" title="æš´åŠ›"></a>æš´åŠ›</h4><p>å¯¹äºæ¯ä¸ªä½ç½® <code>i</code> ï¼Œåˆ†åˆ«æ‰¾åˆ°å…¶å·¦å³çš„æœ€å¤§é«˜åº¦$leftMax$å’Œ$rightMax$ï¼Œé‚£ä¹ˆè¯¥ç‚¹èƒ½æ¥çš„é›¨æ°´å€¼ä¸º$min(leftMax, rightMax) - height_i$. </p><p><strong>æ—¶é—´å¤æ‚åº¦</strong>: $O(n^2)$</p><h4 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h4><p>è§‚å¯Ÿæš´åŠ›ç®—æ³•ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œæ—¶é—´å¤æ‚åº¦é«˜çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºå¯¹äºæ¯ä¸ªä½ç½®ï¼Œå¯»æ‰¾å…¶å·¦å³çš„æœ€å¤§å€¼éœ€è¦$O(n)$çš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ•°ç»„$leftMax$æ¥ç»´æŠ¤æ¯ä¸ªä½ç½®å·¦è¾¹çš„æœ€å¤§å€¼ï¼Œè¿™æ ·åœ¨éå†çš„æ—¶å€™åªéœ€è¦$O(1)$å°±èƒ½æ‰¾åˆ°å…¶å·¦è¾¹çš„æœ€å¤§å€¼ï¼Œå¯¹äºå³è¾¹çš„æœ€å¤§å€¼åŒç†ã€‚</p><p>ä¸ºäº†æ±‚å¾—æ¯ä¸ªä½ç½®å·¦è¾¹çš„æœ€å¤§å€¼ï¼Œè§„å®š$leftMax[i]$è¡¨ç¤ºä½ç½®$i$å·¦è¾¹çš„æœ€å¤§å€¼ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š<br>$$<br>\begin{align}<br>    &amp; leftMax[i] &#x3D; max(leftMax[i - 1], height[i]) \\<br>    &amp; rightMax[i] &#x3D; max(rightMax[i + 1], height[i])<br>\end{align}<br>$$<br>æˆ‘ä»¬åªéœ€è¦ä»å‰å¾€åéå†ä¸€éæ•°ç»„ï¼Œå°±å¯ä»¥å¾—åˆ°$leftMax$ï¼Œä»åå¾€å‰éå†ä¸€éæ•°ç»„ï¼Œå°±å¯ä»¥å¾—åˆ°$rightMax$.æ—¶é—´å¤æ‚åº¦ä¸º$O(n)$.</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">trap</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; height)</span> </span>&#123;<br>        <span class="hljs-type">int</span> n = height.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">leftMax</span><span class="hljs-params">(n, height[<span class="hljs-number">0</span>])</span></span>;<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">rightMax</span><span class="hljs-params">(n, height[n - <span class="hljs-number">1</span>])</span></span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; n; ++i)<br>        &#123;<br>            leftMax[i] = <span class="hljs-built_in">max</span>(leftMax[i - <span class="hljs-number">1</span>], height[i]);<br>            rightMax[n - i - <span class="hljs-number">1</span>] = <span class="hljs-built_in">max</span>(rightMax[n - i], height[n - i - <span class="hljs-number">1</span>]);<br>        &#125;<br>        <span class="hljs-type">int</span> ans = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i)<br>        &#123;<br>            ans += (<span class="hljs-built_in">min</span>(leftMax[i], rightMax[i]) - height[i]); <br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(n)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(n)$</p><h4 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h4><p>è§‚å¯ŸåŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ$leftMax$å’Œ$rightMax$æ•°ç»„æ˜¯å•è°ƒçš„ï¼Œè€Œä¸”æ¯ä¸ªä½ç½®$i$çš„èƒ½æ¥çš„é›¨æ°´åªå–å†³äºå·¦è¾¹å’Œå³è¾¹æœ€å¤§å€¼ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨åŒæŒ‡é’ˆæ¥åšï¼Œè¾¹éå†è¾¹ç»´æŠ¤å·¦å³æœ€å¤§å€¼ã€‚å·¦æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®çš„å·¦è¾¹æœ€å¤§å€¼å°±æ˜¯å½“å‰ä½ç½®$i$çš„å·¦è¾¹çš„æœ€å¤§å€¼ï¼Œå³æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®çš„å³è¾¹æœ€å¤§å€¼å°±æ˜¯å½“å‰ä½ç½®$i$çš„å³è¾¹çš„æœ€å¤§å€¼ã€‚å³ï¼Œå·¦æŒ‡é’ˆçš„å·¦è¾¹æœ€å¤§å€¼æ˜¯ç¡®å®šçš„ï¼Œè€Œå³è¾¹çš„æœ€å¤§å€¼æœ‰å¯èƒ½ä¼šå¢å¤§ï¼Œå³æŒ‡é’ˆçš„å³è¾¹æœ€å¤§å€¼æ˜¯ç¡®å®šçš„ï¼Œè€Œå·¦è¾¹çš„æœ€å¤§å€¼å¯èƒ½ä¼šå¢å¤§ã€‚æ­¤æ—¶ï¼Œå¦‚æœå·¦è¾¹çš„æœ€å¤§å€¼å°äºå³è¾¹çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆå·¦æŒ‡é’ˆæŒ‡å‘ä½ç½®çš„å€¼å°±å¯ä»¥è®¡ç®—äº†ï¼Œå› ä¸ºå…¶åªå–å†³äºå·¦è¾¹çš„æœ€å¤§å€¼ï¼Œå¦‚æœå³è¾¹çš„æœ€å¤§å€¼å°äºå·¦è¾¹çš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆå³æŒ‡é’ˆæŒ‡å‘ä½ç½®çš„å€¼å°±å¯ä»¥è®¡ç®—äº†ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">trap</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; height)</span> </span>&#123;<br>        <span class="hljs-type">int</span> n = height.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-type">int</span> left = <span class="hljs-number">0</span>, right = n - <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> leftMax = height[<span class="hljs-number">0</span>], rightMax = height[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-type">int</span> ans = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (left &lt;= right)<br>        &#123;<br>            leftMax = <span class="hljs-built_in">max</span>(leftMax, height[left]);<br>            rightMax = <span class="hljs-built_in">max</span>(rightMax, height[right]);<br>            <span class="hljs-keyword">if</span> (leftMax &lt;= rightMax)<br>                ans += (leftMax - height[left++]);<br>            <span class="hljs-keyword">else</span> <br>                ans += (rightMax - height[right--]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(n)$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$</p><h4 id="å•è°ƒæ ˆ"><a href="#å•è°ƒæ ˆ" class="headerlink" title="å•è°ƒæ ˆ"></a>å•è°ƒæ ˆ</h4><p>ç”¨ä¸€ä¸ªå•è°ƒæ ˆæ¥ç»´æŠ¤æ•°ç»„ä¸‹æ ‡ï¼Œä¿è¯é è¿‘æ ˆåº•çš„é«˜åº¦ä¸å°äºé è¿‘æ ˆé¡¶çš„é«˜åº¦ã€‚å½“é‡åˆ°ä¸€ä¸ªä½ç½®$i$çš„é«˜åº¦å¤§äºæ ˆé¡¶é«˜åº¦çš„æ—¶å€™ï¼Œå½“å‰ä½ç½®$i$ï¼Œæ ˆé¡¶çš„ä½ç½®$top$ï¼Œæ ˆé¡¶ç¬¬äºŒä¸ªä½ç½®$left$ï¼Œä¸‰è€…å°±å¯èƒ½æ„æˆä¸€ä¸ªå‡¹æ§½ï¼Œèƒ½å¤Ÿæ¥é›¨æ°´($height[left] &gt;&#x3D; height[top], height[i] &gt; height[top], left &lt; top &lt; i$).æ¥çš„é›¨æ°´é‡ç­‰äº$(min(height[left], height[i]) - height[top]) \times (i - left - 1)$.</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">trap</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; height)</span> </span>&#123;<br>        stack&lt;<span class="hljs-type">int</span>&gt; s;<br>        <span class="hljs-type">int</span> ans = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; height.<span class="hljs-built_in">size</span>(); ++i)<br>        &#123;<br>            <span class="hljs-keyword">while</span> (!s.<span class="hljs-built_in">empty</span>() &amp;&amp; height[s.<span class="hljs-built_in">top</span>()] &lt; height[i])<br>            &#123;<br>                <span class="hljs-type">int</span> top = s.<span class="hljs-built_in">top</span>(); s.<span class="hljs-built_in">pop</span>();<br>                <span class="hljs-keyword">if</span> (s.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">break</span>;<br>                <span class="hljs-type">int</span> left = s.<span class="hljs-built_in">top</span>();<br>                ans += ((<span class="hljs-built_in">min</span>(height[left], height[i]) - height[top]) *<br>                        (i - left - <span class="hljs-number">1</span>));<br>            &#125;<br>            s.<span class="hljs-built_in">push</span>(i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(n)$.</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(n)$.</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
      <tag>dp</tag>
      
      <tag>å•è°ƒæ ˆ</tag>
      
      <tag>åŒæŒ‡é’ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]146.LRUç¼“å­˜</title>
    <link href="/2024/10/18/LC-146-LRU%E7%BC%93%E5%AD%98/"/>
    <url>/2024/10/18/LC-146-LRU%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³ <a href="https://baike.baidu.com/item/LRU">LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜</a> çº¦æŸçš„æ•°æ®ç»“æ„ã€‚</p><p>å®ç° <code>LRUCache</code> ç±»ï¼š</p><ul><li><code>LRUCache(int capacity)</code> ä»¥ <strong>æ­£æ•´æ•°</strong> ä½œä¸ºå®¹é‡ <code>capacity</code> åˆå§‹åŒ– LRU ç¼“å­˜</li><li><code>int get(int key)</code> å¦‚æœå…³é”®å­— <code>key</code> å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚</li><li><code>void put(int key, int value)</code> å¦‚æœå…³é”®å­— <code>key</code> å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ <code>value</code> ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ <code>key-value</code> ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ <code>capacity</code> ï¼Œåˆ™åº”è¯¥ <strong>é€å‡º</strong> æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚</li></ul><p>å‡½æ•° <code>get</code> å’Œ <code>put</code> å¿…é¡»ä»¥ <code>O(1)</code> çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸ºäº†æ»¡è¶³å¹³å‡$O(1)$çš„æ—¶é—´å¤æ‚åº¦ï¼Œé‡‡ç”¨å“ˆå¸Œè¡¨+åŒé“¾è¡¨çš„æ–¹å¼å®ç°ã€‚å…¶ä¸­å“ˆå¸Œè¡¨ç”¨æ¥æŸ¥æ‰¾æŒ‡å®šçš„é”®ï¼Œè€ŒåŒé“¾è¡¨åˆ™ç”¨æ¥ç»´æŠ¤è®¿é—®æ—¶é—´ï¼Œå°†æœ€è¿‘è®¿é—®è¿‡çš„å€¼æ”¾åœ¨é“¾è¡¨å¤´ï¼Œæœ€ä¹…æœªä½¿ç”¨çš„å€¼æ”¾åœ¨é˜Ÿå°¾ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">LRUCache</span>(<span class="hljs-type">int</span> cap): <span class="hljs-built_in">capacity</span>(cap), <span class="hljs-built_in">size</span>(<span class="hljs-number">0</span>) &#123;<br>        head = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DLinkedNode</span>();<br>        tail = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DLinkedNode</span>();<br>        head-&gt;next = tail;<br>        tail-&gt;prev = head;<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (cache.<span class="hljs-built_in">find</span>(key) == cache.<span class="hljs-built_in">end</span>()) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        <span class="hljs-keyword">auto</span> node = cache[key];<br>        <span class="hljs-built_in">move2head</span>(node);<br>        <span class="hljs-keyword">return</span> node-&gt;val;<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, <span class="hljs-type">int</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (cache.<span class="hljs-built_in">find</span>(key) != cache.<span class="hljs-built_in">end</span>())<br>        &#123;<br>            <span class="hljs-keyword">auto</span> node = cache[key];<br>            node-&gt;val = value;<br>            <span class="hljs-built_in">move2head</span>(node);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">if</span> (size == capacity)<br>            &#123;<br>                <span class="hljs-comment">// 1.åˆ é™¤LRUå…ƒç´ </span><br>                <span class="hljs-comment">// 1.1 ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤</span><br>                cache.<span class="hljs-built_in">erase</span>(tail-&gt;prev-&gt;key);<br>                <span class="hljs-comment">// 1.2 ä»é“¾è¡¨ä¸­åˆ é™¤</span><br>                tail-&gt;prev-&gt;val = value;<br>                tail-&gt;prev-&gt;key = key;<br>                <span class="hljs-comment">// 2.æ’å…¥æ–°å…ƒç´ </span><br>                cache.<span class="hljs-built_in">emplace</span>(key, tail-&gt;prev);<br>                <span class="hljs-comment">// 3.ç§»åŠ¨åˆ°å¯¹å¤´</span><br>                <span class="hljs-built_in">move2head</span>(tail-&gt;prev);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                ++size;<br>                <span class="hljs-keyword">auto</span> node = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DLinkedNode</span>(key, value);<br>                <span class="hljs-built_in">add2head</span>(node);<br>                cache.<span class="hljs-built_in">emplace</span>(key, node);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    ~<span class="hljs-built_in">LRUCache</span>()<br>    &#123;<br>        <span class="hljs-keyword">delete</span> head;<br>        <span class="hljs-keyword">delete</span> tail;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">DLinkedNode</span>&#123;<br>        <span class="hljs-type">int</span> key, val;<br>        DLinkedNode *prev;<br>        DLinkedNode *next;<br>        <span class="hljs-built_in">DLinkedNode</span>(): <span class="hljs-built_in">key</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">val</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">prev</span>(<span class="hljs-literal">nullptr</span>), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) &#123;&#125;<br>        <span class="hljs-built_in">DLinkedNode</span>(<span class="hljs-type">int</span> k, <span class="hljs-type">int</span> v): <span class="hljs-built_in">key</span>(k), <span class="hljs-built_in">val</span>(v), <span class="hljs-built_in">prev</span>(<span class="hljs-literal">nullptr</span>), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) &#123;&#125;<br>    &#125;;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add2head</span><span class="hljs-params">(DLinkedNode *node)</span></span><br><span class="hljs-function">    </span>&#123;<br>        node-&gt;next = head-&gt;next;<br>        head-&gt;next-&gt;prev = node;<br>        head-&gt;next = node;<br>        node-&gt;prev = head;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">removeNode</span><span class="hljs-params">(DLinkedNode *node)</span></span><br><span class="hljs-function">    </span>&#123;<br>        node-&gt;prev-&gt;next = node-&gt;next;<br>        node-&gt;next-&gt;prev = node-&gt;prev;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">move2head</span><span class="hljs-params">(DLinkedNode *node)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-built_in">removeNode</span>(node);<br>        <span class="hljs-built_in">add2head</span>(node);<br>    &#125;<br>    <br>    unordered_map&lt;<span class="hljs-type">int</span>, DLinkedNode*&gt; cache;<br>    DLinkedNode *head;<br>    DLinkedNode *tail;<br>    <span class="hljs-type">int</span> capacity;<br>    <span class="hljs-type">int</span> size;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Your LRUCache object will be instantiated and called as such:</span><br><span class="hljs-comment"> * LRUCache* obj = new LRUCache(capacity);</span><br><span class="hljs-comment"> * int param_1 = obj-&gt;get(key);</span><br><span class="hljs-comment"> * obj-&gt;put(key,value);</span><br><span class="hljs-comment"> */</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç°ä»£C++è¯­è¨€æ ¸å¿ƒç‰¹æ€§è§£æ Chapter 3</title>
    <link href="/2024/10/09/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-3/"/>
    <url>/2024/10/09/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-3/</url>
    
    <content type="html"><![CDATA[<h1 id="autoå ä½ç¬¦ï¼ˆC-11ï½C-17ï¼‰"><a href="#autoå ä½ç¬¦ï¼ˆC-11ï½C-17ï¼‰" class="headerlink" title="autoå ä½ç¬¦ï¼ˆC++11ï½C++17ï¼‰"></a>autoå ä½ç¬¦ï¼ˆC++11ï½C++17ï¼‰</h1><h2 id="1-é‡æ–°å®šä¹‰çš„autoå…³é”®å­—"><a href="#1-é‡æ–°å®šä¹‰çš„autoå…³é”®å­—" class="headerlink" title="1 é‡æ–°å®šä¹‰çš„autoå…³é”®å­—"></a>1 é‡æ–°å®šä¹‰çš„autoå…³é”®å­—</h2><p>C++11æ ‡å‡†èµ‹äºˆäº†autoæ–°çš„å«ä¹‰ï¼šå£°æ˜å˜é‡æ—¶æ ¹æ®åˆå§‹åŒ–è¡¨è¾¾å¼è‡ªåŠ¨æ¨æ–­è¯¥å˜é‡çš„ç±»å‹ã€å£°æ˜å‡½æ•°æ—¶å‡½æ•°è¿”å›å€¼çš„å ä½ç¬¦ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> i = <span class="hljs-number">5</span>;                      <span class="hljs-comment">// æ¨æ–­ä¸ºint</span><br><span class="hljs-keyword">auto</span> str = <span class="hljs-string">&quot;hello auto&quot;</span>;         <span class="hljs-comment">// æ¨æ–­ä¸ºconst char*</span><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span>-&gt;<span class="hljs-type">int</span>    <span class="hljs-comment">// è¿”å›ç±»å‹åç½®ï¼Œautoä¸ºè¿”å›å€¼å ä½ç¬¦</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a1+a2;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨autoçš„æ—¶å€™æœ‰4ç‚¹éœ€è¦æ³¨æ„ï¼š</p><ol><li><p>å½“ç”¨ä¸€ä¸ªautoå…³é”®å­—å£°æ˜å¤šä¸ªå˜é‡çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨éµä»ç”±å·¦å¾€å³çš„æ¨å¯¼è§„åˆ™ï¼Œä»¥æœ€å·¦è¾¹çš„è¡¨è¾¾å¼æ¨æ–­autoçš„å…·ä½“ç±»å‹</p></li><li><p>å½“ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼åˆå§‹åŒ–autoå£°æ˜çš„å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨æ€»æ˜¯ä½¿ç”¨è¡¨è¾¾èƒ½åŠ›æ›´å¼ºçš„ç±»å‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> i = <span class="hljs-literal">true</span> ? <span class="hljs-number">5</span> : <span class="hljs-number">8.0</span>;    <span class="hljs-comment">// içš„æ•°æ®ç±»å‹ä¸ºdouble</span><br></code></pre></td></tr></table></figure></li><li><p>autoæ— æ³•å£°æ˜éé™æ€æˆå‘˜å˜é‡ã€‚</p><ul><li><p>åœ¨c++11ä¸­é™æ€æˆå‘˜å˜é‡å¯ä»¥ä½¿ç”¨autoå£°æ˜å¹¶åˆå§‹åŒ–ï¼Œä½†å¿…é¡»æ˜¯constçš„ã€‚</p></li><li><p>åœ¨c++17ä¸­å»æ‰äº†å¿…é¡»æ˜¯constçš„é™å®šï¼Œä½†ä»ç„¶åªæ”¯æŒé™æ€æˆå‘˜å˜é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">sometype</span> &#123;<br>    <span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">auto</span> i = <span class="hljs-number">5</span>;    <span class="hljs-comment">// C++17</span><br>&#125;;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>æŒ‰ç…§C++20ä¹‹å‰çš„æ ‡å‡†ï¼Œæ— æ³•åœ¨å‡½æ•°å½¢å‚åˆ—è¡¨ä¸­ä½¿ç”¨autoå£°æ˜å½¢å‚ï¼ˆæ³¨æ„ï¼Œ<strong>åœ¨C++14ä¸­ï¼Œautoå¯ä»¥ä¸ºlambdaè¡¨è¾¾å¼å£°æ˜å½¢å‚</strong>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">echo</span><span class="hljs-params">(<span class="hljs-keyword">auto</span> str)</span> </span>&#123;â€¦&#125; <span class="hljs-comment">// C++20ä¹‹å‰ç¼–è¯‘å¤±è´¥ï¼ŒC++20ç¼–è¯‘æˆåŠŸ</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="2-æ¨å¯¼è§„åˆ™"><a href="#2-æ¨å¯¼è§„åˆ™" class="headerlink" title="2 æ¨å¯¼è§„åˆ™"></a>2 æ¨å¯¼è§„åˆ™</h2><ol><li>å¦‚æœautoå£°æ˜çš„å˜é‡æ˜¯æŒ‰å€¼åˆå§‹åŒ–ï¼ˆæ²¡æœ‰ä½¿ç”¨å¼•ç”¨å’ŒæŒ‡é’ˆï¼‰ï¼Œåˆ™æ¨å¯¼å‡ºçš„ç±»å‹ä¼šå¿½ç•¥cvé™å®šç¬¦ã€‚</li><li>ä½¿ç”¨autoå£°æ˜å˜é‡åˆå§‹åŒ–æ—¶ï¼Œç›®æ ‡å¯¹è±¡å¦‚æœæ˜¯å¼•ç”¨ï¼Œåˆ™å¼•ç”¨å±æ€§ä¼šè¢«å¿½ç•¥</li><li>ä½¿ç”¨autoå’Œä¸‡èƒ½å¼•ç”¨å£°æ˜å˜é‡æ—¶ï¼ˆè§ç¬¬6ç« ï¼‰ï¼Œå¯¹äºå·¦å€¼ä¼šå°†autoæ¨å¯¼ä¸ºå¼•ç”¨ç±»å‹</li><li>ä½¿ç”¨autoå£°æ˜å˜é‡ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–è€…å‡½æ•°ï¼Œåˆ™autoä¼šè¢«æ¨å¯¼ä¸ºå¯¹åº”çš„æŒ‡é’ˆç±»å‹</li><li>å½“autoå…³é”®å­—ä¸åˆ—è¡¨åˆå§‹åŒ–ç»„åˆæ—¶ï¼Œè¿™é‡Œçš„è§„åˆ™æœ‰æ–°è€ä¸¤ä¸ªç‰ˆæœ¬ï¼Œè¿™é‡Œåªä»‹ç»æ–°è§„åˆ™ï¼ˆC++17æ ‡å‡†ï¼‰ã€‚<ul><li>ç›´æ¥ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–ï¼Œåˆ—è¡¨ä¸­å¿…é¡»ä¸ºå•å…ƒç´ ï¼Œå¦åˆ™æ— æ³•ç¼–è¯‘ï¼Œautoç±»å‹è¢«æ¨å¯¼ä¸ºå•å…ƒç´ çš„ç±»å‹ã€‚</li><li>ç”¨ç­‰å·åŠ åˆ—è¡¨åˆå§‹åŒ–ï¼Œåˆ—è¡¨ä¸­å¯ä»¥åŒ…å«å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼Œautoç±»å‹è¢«æ¨å¯¼ä¸º <code>std::initializer_list&lt;T&gt;</code> ï¼Œå…¶ä¸­Tæ˜¯å…ƒç´ ç±»å‹ã€‚è¯·æ³¨æ„ï¼Œåœ¨åˆ—è¡¨ä¸­åŒ…å«å¤šä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</li></ul></li></ol><p><strong>ä¾‹å­</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> <br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Base::f()&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base<br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">    </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Derived::f()&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    Base *b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Derived</span>();<br>    <span class="hljs-keyword">auto</span> b1 = *b;<br>    <span class="hljs-keyword">auto</span> &amp;b2 = *b;<br>    cout &lt;&lt; <span class="hljs-string">&quot;b &quot;</span>;  b-&gt;<span class="hljs-built_in">f</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;b1 &quot;</span>; b<span class="hljs-number">1.f</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;b2 &quot;</span>; b<span class="hljs-number">2.f</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç»“æœ</strong></p><p><img src="/../images/C-%E7%8E%B0%E4%BB%A3C-%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E8%A7%A3%E6%9E%90-Chapter-3/image-20241020170535616.png"></p><h2 id="3-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨auto"><a href="#3-ä»€ä¹ˆæ—¶å€™ä½¿ç”¨auto" class="headerlink" title="3 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨auto"></a>3 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨auto</h2><ol><li><p>å½“ä¸€çœ¼å°±èƒ½çœ‹å‡ºå£°æ˜å˜é‡çš„åˆå§‹åŒ–ç±»å‹çš„æ—¶å€™å¯ä»¥ä½¿ç”¨autoã€‚</p><p>æ¯”å¦‚è¿­ä»£å™¨ç­‰ã€‚</p></li><li><p>å¯¹äºå¤æ‚çš„ç±»å‹ï¼Œä¾‹å¦‚lambdaè¡¨è¾¾å¼ã€bindç­‰ç›´æ¥ä½¿ç”¨autoã€‚</p></li></ol><h2 id="4-è¿”å›ç±»å‹æ¨å¯¼"><a href="#4-è¿”å›ç±»å‹æ¨å¯¼" class="headerlink" title="4 è¿”å›ç±»å‹æ¨å¯¼"></a>4 è¿”å›ç±»å‹æ¨å¯¼</h2><p>C++14æ ‡å‡†æ”¯æŒå¯¹è¿”å›ç±»å‹å£°æ˜ä¸ºautoçš„æ¨å¯¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span> </span>&#123; <span class="hljs-keyword">return</span> a1 + a2; &#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå‡½æ•°ä¸­æœ‰å¤šä¸ªè¿”å›è¯­å¥ï¼Œéœ€è¦ä¿è¯æ¯ä¸ªè¿”å›è¯­å¥è¿”å›çš„ç±»å‹æ˜¯ä¸€è‡´çš„ã€‚</p><h2 id="5-lambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨autoç±»å‹æ¨å¯¼"><a href="#5-lambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨autoç±»å‹æ¨å¯¼" class="headerlink" title="5 lambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨autoç±»å‹æ¨å¯¼"></a>5 lambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨autoç±»å‹æ¨å¯¼</h2><p>åœ¨C++14æ ‡å‡†ä¸­æˆ‘ä»¬è¿˜å¯ä»¥æŠŠautoå†™åˆ°lambdaè¡¨è¾¾å¼çš„å½¢å‚ä¸­ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªæ³›å‹çš„lambdaè¡¨è¾¾å¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> l = [](<span class="hljs-keyword">auto</span> a1, <span class="hljs-keyword">auto</span> a2) &#123; <span class="hljs-keyword">return</span> a1 + a2; &#125;;<br><span class="hljs-keyword">auto</span> retval = <span class="hljs-built_in">l</span>(<span class="hljs-number">5</span>, <span class="hljs-number">5.0</span>);<br></code></pre></td></tr></table></figure><p>ambdaè¡¨è¾¾å¼è¿”å›autoå¼•ç”¨çš„æ–¹æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">auto</span> l = [](<span class="hljs-type">int</span> &amp;i)-&gt;<span class="hljs-keyword">auto</span>&amp; &#123; <span class="hljs-keyword">return</span> i; &#125;;<br><span class="hljs-keyword">auto</span> x1 = <span class="hljs-number">5</span>;<br><span class="hljs-keyword">auto</span> &amp;x2 = <span class="hljs-built_in">l</span>(x1);<br><span class="hljs-built_in">assert</span>(&amp;x1 == &amp;x2);    <span class="hljs-comment">// æœ‰ç›¸åŒçš„å†…å­˜åœ°å€</span><br></code></pre></td></tr></table></figure><h2 id="6-éç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦"><a href="#6-éç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦" class="headerlink" title="6 éç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦"></a>6 éç±»å‹æ¨¡æ¿å½¢å‚å ä½ç¬¦</h2><p>C++17æ ‡å‡†å¯¹autoå…³é”®å­—åˆä¸€æ¬¡è¿›è¡Œäº†æ‰©å±•ï¼Œä½¿å®ƒå¯ä»¥ä½œä¸ºéç±»å‹æ¨¡æ¿å½¢å‚çš„å ä½ç¬¦ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯æ¨å¯¼å‡ºæ¥çš„ç±»å‹æ˜¯å¯ä»¥ç”¨ä½œæ¨¡æ¿å½¢å‚çš„ï¼Œå¦åˆ™æ— æ³•é€šè¿‡ç¼–è¯‘.</p><div class="note note-warning">            <p>C++ä¸­æ¨¡æ¿å‚æ•°ä¸èƒ½ä¸ºdoubleç±»å‹ã€‚</p>          </div>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]2343.è£å‰ªæ•°å­—åæŸ¥è¯¢ç¬¬kå°çš„æ•°å­—</title>
    <link href="/2024/10/08/LC-2343-%E8%A3%81%E5%89%AA%E6%95%B0%E5%AD%97%E5%90%8E%E6%9F%A5%E8%AF%A2%E7%AC%ACk%E5%B0%8F%E7%9A%84%E6%95%B0%E5%AD%97/"/>
    <url>/2024/10/08/LC-2343-%E8%A3%81%E5%89%AA%E6%95%B0%E5%AD%97%E5%90%8E%E6%9F%A5%E8%AF%A2%E7%AC%ACk%E5%B0%8F%E7%9A%84%E6%95%B0%E5%AD%97/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„å­—ç¬¦ä¸²æ•°ç»„ <code>nums</code> ï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦ä¸² <strong>é•¿åº¦ç›¸ç­‰</strong> ä¸”åªåŒ…å«æ•°å­—ã€‚</p><p>å†ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„äºŒç»´æ•´æ•°æ•°ç»„ <code>queries</code> ï¼Œå…¶ä¸­ <code>queries[i] = [ki, trimi]</code> ã€‚å¯¹äºæ¯ä¸ª <code>queries[i]</code> ï¼Œä½ éœ€è¦ï¼š</p><ul><li>å°† <code>nums</code> ä¸­æ¯ä¸ªæ•°å­— <strong>è£å‰ª</strong> åˆ°å‰©ä¸‹ <strong>æœ€å³è¾¹</strong> <code>trimi</code> ä¸ªæ•°ä½ã€‚</li><li>åœ¨è£å‰ªè¿‡åçš„æ•°å­—ä¸­ï¼Œæ‰¾åˆ° <code>nums</code> ä¸­ç¬¬ <code>ki</code> å°æ•°å­—å¯¹åº”çš„ <strong>ä¸‹æ ‡</strong> ã€‚å¦‚æœä¸¤ä¸ªè£å‰ªåæ•°å­—ä¸€æ ·å¤§ï¼Œé‚£ä¹ˆä¸‹æ ‡ <strong>æ›´å°</strong> çš„æ•°å­—è§†ä¸ºæ›´å°çš„æ•°å­—ã€‚</li><li>å°† <code>nums</code> ä¸­æ¯ä¸ªæ•°å­—æ¢å¤åˆ°åŸæœ¬å­—ç¬¦ä¸²ã€‚</li></ul><p>è¯·ä½ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸ <code>queries</code> ç›¸ç­‰çš„æ•°ç»„ <code>answer</code>ï¼Œå…¶ä¸­ <code>answer[i]</code>æ˜¯ç¬¬ <code>i</code> æ¬¡æŸ¥è¯¢çš„ç»“æœã€‚</p><p><strong>æç¤ºï¼š</strong></p><ul><li>è£å‰ªåˆ°å‰©ä¸‹æœ€å³è¾¹ <code>x</code> ä¸ªæ•°ä½çš„æ„æ€æ˜¯ä¸æ–­åˆ é™¤æœ€å·¦è¾¹çš„æ•°ä½ï¼Œç›´åˆ°å‰©ä¸‹ <code>x</code> ä¸ªæ•°ä½ã€‚</li><li><code>nums</code> ä¸­çš„å­—ç¬¦ä¸²å¯èƒ½ä¼šæœ‰å‰å¯¼ 0 ã€‚</li></ul><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="å¤§é¡¶å †"><a href="#å¤§é¡¶å †" class="headerlink" title="å¤§é¡¶å †"></a>å¤§é¡¶å †</h4><p>ä¾æ¬¡å¤„ç†æ¯ä¸ªqueryï¼Œå¤„ç†æ¯ä¸ªqueryçš„æ—¶å€™ç”¨å¤§é¡¶å †çš„æ–¹å¼æ‰¾åˆ°ç¬¬kå°çš„æ•°å­—ã€‚</p><p><strong>é‡ç‚¹</strong></p><p>åœ¨è‡ªå®šä¹‰æ¯”è¾ƒæ“ä½œçš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨ <code>substr</code>ï¼Œ<code>substr</code> ä¼šè¿›è¡Œæ‹·è´æ“ä½œï¼Œå¼€é”€è¾ƒé«˜ï¼Œåº”è¯¥ä½¿ç”¨ <code>std::string::compare</code> å¯¹å­ä¸²è¿›è¡Œæ¯”è¾ƒã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">smallestTrimmedNumbers</span><span class="hljs-params">(vector&lt;string&gt;&amp; nums, vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt;&amp; queries)</span> </span>&#123;<br>        vector&lt;<span class="hljs-type">int</span>&gt; ans;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span> &amp; query : queries)<br>        &#123;<br>            ans.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">solveQuery</span>(nums, query[<span class="hljs-number">1</span>], query[<span class="hljs-number">0</span>]));<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">solveQuery</span><span class="hljs-params">(vector&lt;string&gt;&amp; nums, <span class="hljs-type">int</span> trim, <span class="hljs-type">int</span> k)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> n = nums[<span class="hljs-number">0</span>].<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">auto</span> cmp = [trim, n, &amp;nums](<span class="hljs-type">const</span> <span class="hljs-type">int</span> lhs, <span class="hljs-type">const</span> <span class="hljs-type">int</span> rhs)<br>        &#123;<br>            <span class="hljs-type">int</span> res = nums[lhs].<span class="hljs-built_in">compare</span>(n - trim, trim, nums[rhs], n - trim);<br>            <span class="hljs-keyword">return</span> res &lt; <span class="hljs-number">0</span> || (res == <span class="hljs-number">0</span> &amp;&amp; lhs &lt; rhs);<br>        &#125;;<br>        priority_queue&lt;<span class="hljs-type">int</span>, vector&lt;<span class="hljs-type">int</span>&gt;, <span class="hljs-keyword">decltype</span>(cmp)&gt; <span class="hljs-built_in">pq</span>(cmp);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; nums.<span class="hljs-built_in">size</span>(); ++i)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (pq.<span class="hljs-built_in">size</span>() &lt; k) <br>            &#123;<br>                pq.<span class="hljs-built_in">push</span>(i);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">cmp</span>(i, pq.<span class="hljs-built_in">top</span>()))<br>            &#123;<br>                pq.<span class="hljs-built_in">pop</span>();<br>                pq.<span class="hljs-built_in">push</span>(i);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> pq.<span class="hljs-built_in">top</span>();<br>    &#125;<br>&#125;;<br><br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>å‡è®¾æ€»å…±æœ‰$m$ä¸ªqueryï¼Œæ•°å­—æ•°ç»„å¤§å°ä¸º$n$ï¼Œå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º$s$.</p><p>ä¸€ä¸ªqueryçš„æ—¶é—´å¤æ‚åº¦ä¸º$O(ntrim_ilogk_i).$</p><p>æ‰€ä»¥æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n\Sigma_{i&#x3D;1}^mtrim_ilogk_i)$</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š$O(k).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]912.æ’åºæ•°ç»„</title>
    <link href="/2024/10/07/LC-912-%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/"/>
    <url>/2024/10/07/LC-912-%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œè¯·ä½ å°†è¯¥æ•°ç»„å‡åºæ’åˆ—ã€‚</p><p>ä½ å¿…é¡»åœ¨ <strong>ä¸ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°</strong> çš„æƒ…å†µä¸‹è§£å†³é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <code>O(nlog(n))</code>ï¼Œå¹¶ä¸”ç©ºé—´å¤æ‚åº¦å°½å¯èƒ½å°ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h4><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">sortArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class="hljs-built_in">buildHeap</span>(nums);<br>        <span class="hljs-type">int</span> n = nums.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; ++i)<br>        &#123;<br>            <span class="hljs-built_in">swap</span>(nums[<span class="hljs-number">0</span>], nums[n - <span class="hljs-number">1</span> - i]);<br>            <span class="hljs-built_in">heapAdjust</span>(nums, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span> - i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> nums;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">heapAdjust</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums, <span class="hljs-type">int</span> k, <span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> i = <span class="hljs-built_in">left</span>(k);<br>        <span class="hljs-keyword">while</span> (i &lt; n)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> &lt; n &amp;&amp; nums[i] &lt; nums[i<span class="hljs-number">+1</span>])++i;<br>            <span class="hljs-keyword">if</span> (nums[k] &gt;= nums[i]) <span class="hljs-keyword">break</span>;<br>            <span class="hljs-built_in">swap</span>(nums[k], nums[i]);<br>            k = i;<br>            i = <span class="hljs-built_in">left</span>(k);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildHeap</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = nums.<span class="hljs-built_in">size</span>() / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i)<br>        &#123;<br>            <span class="hljs-built_in">heapAdjust</span>(nums, i, nums.<span class="hljs-built_in">size</span>());<br>        &#125;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">left</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(nlogn).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1).$</p><h4 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h4><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">sortArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class="hljs-built_in">quickSort</span>(nums, <span class="hljs-number">0</span>, nums.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> nums;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">quickSort</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> high)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (low &gt;= high) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-type">int</span> pivot_idx = <span class="hljs-built_in">partition</span>(nums, low, high);<br>        <span class="hljs-built_in">quickSort</span>(nums, low, pivot_idx - <span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">quickSort</span>(nums, pivot_idx + <span class="hljs-number">1</span>, high);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">partition</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> high)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-built_in">swap</span>(nums[low], nums[low + <span class="hljs-built_in">rand</span>() % (high - low + <span class="hljs-number">1</span>)]);<br>        <span class="hljs-type">int</span> pivot = nums[low];<br>        <span class="hljs-type">int</span> l = low + <span class="hljs-number">1</span>, r = high;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>        &#123;<br>            <span class="hljs-keyword">while</span> (l &lt;= r &amp;&amp; nums[l] &lt; pivot) ++l;<br>            <span class="hljs-keyword">while</span> (l &lt;= r &amp;&amp; nums[r] &gt; pivot) --r;<br>            <span class="hljs-keyword">if</span> (l &gt;= r) <span class="hljs-keyword">break</span>;<br>            <span class="hljs-built_in">swap</span>(nums[l], nums[r]);<br>            ++l; --r;<br>        &#125;<br>        <span class="hljs-built_in">swap</span>(nums[low], nums[r]);<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$å¹³å‡O(nlogn),æœ€åO(n^2).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$å¹³å‡O(logn)ï¼Œæœ€åO(n).$</p><h4 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h4><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">sortArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class="hljs-built_in">mergeSort</span>(nums, <span class="hljs-number">0</span>, nums.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> nums;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mergeSort</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> high)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (low &gt;= high) <span class="hljs-keyword">return</span>;<br>        <span class="hljs-type">int</span> m = low + ((high - low) &gt;&gt; <span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">mergeSort</span>(nums, low, m);<br>        <span class="hljs-built_in">mergeSort</span>(nums, m<span class="hljs-number">+1</span>, high);<br>        <span class="hljs-built_in">merge</span>(nums, low, m, high);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> mid, <span class="hljs-type">int</span> high)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">buffer</span><span class="hljs-params">(nums.begin() + low, nums.begin() + mid + <span class="hljs-number">1</span>)</span></span>;<br>        <span class="hljs-type">int</span> i, j, k;<br>        <span class="hljs-keyword">for</span> (k = low, i = <span class="hljs-number">0</span>, j = mid + <span class="hljs-number">1</span>; i &lt; buffer.<span class="hljs-built_in">size</span>() &amp;&amp; j &lt;= high; ++k)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (buffer[i] &lt;= nums[j]) nums[k] = buffer[i++];<br>            <span class="hljs-keyword">else</span> nums[k] = nums[j++];<br>        &#125;<br>        <span class="hljs-keyword">while</span> (i &lt; buffer.<span class="hljs-built_in">size</span>()) nums[k++] = buffer[i++];<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(nlogn).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(n).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]215.æ•°ç»„ä¸­çš„ç¬¬kä¸ªæœ€å¤§å…ƒç´ </title>
    <link href="/2024/10/06/LC-215-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACk%E4%B8%AA%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0/"/>
    <url>/2024/10/06/LC-215-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E7%AC%ACk%E4%B8%AA%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®šæ•´æ•°æ•°ç»„ <code>nums</code> å’Œæ•´æ•° <code>k</code>ï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ <code>k</code> ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚</p><p>è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ <code>k</code> ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ <code>k</code> ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p><p>ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code> çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="å¿«é€Ÿé€‰æ‹©"><a href="#å¿«é€Ÿé€‰æ‹©" class="headerlink" title="å¿«é€Ÿé€‰æ‹©"></a>å¿«é€Ÿé€‰æ‹©</h4><p>ç»å…¸ç®—æ³•ï¼Œå¯»æ‰¾ç¬¬kä¸ªå…ƒç´ ã€‚å¯ä»¥å€Ÿç”¨å¿«é€Ÿæ’åºçš„åˆ’åˆ†æ“ä½œï¼Œæ¯æ¬¡åˆ’åˆ†æ“ä½œå°†ä¸€ä¸ªæ¢è½´å…ƒç´ æ”¾ç½®åˆ°å®ƒæ’å¥½åºåçš„æ­£ç¡®ä½ç½®ä¸Šï¼Œä¸”æ‰€æœ‰å°äºç­‰äºæ¢è½´å…ƒç´ çš„å…ƒç´ éƒ½åœ¨è¯¥ä½ç½®ä¹‹å‰ï¼Œæ‰€æœ‰å¤§äºç­‰äºæ¢è½´å…ƒç´ çš„å…ƒç´ éƒ½åœ¨è¯¥ä½ç½®ä¹‹åã€‚å¦‚æœè¿™ä¸ªä½ç½®ç­‰äºkï¼Œåˆ™æˆ‘ä»¬ç›´æ¥è¿”å›è¯¥ä½ç½®ä¸Šçš„å€¼å³å¯ï¼›å¦‚æœè¿™ä¸ªä½ç½®å¤§äºkï¼Œè¯´æ˜æˆ‘ä»¬è¦æ‰¾åˆ°çš„å…ƒç´ ä¸€å®šåœ¨æ¢è½´å…ƒç´ ä¹‹å‰ï¼Œé€’å½’çš„æ±‚è§£ä¸€ä¸ªæ›´å°çš„å­é—®é¢˜å³å¯ï¼›å¦‚æœè¿™ä¸ªä½ç½®å°äºkï¼ŒåŒç†ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> k)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">findKthElement</span>(nums, <span class="hljs-number">0</span>, nums.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>, nums.<span class="hljs-built_in">size</span>() - k);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">findKthElement</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> high, <span class="hljs-type">int</span> k)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> pivot_idx = <span class="hljs-built_in">partition</span>(nums, low, high);<br>        <span class="hljs-keyword">if</span> (pivot_idx == k) <span class="hljs-keyword">return</span> nums[k];<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pivot_idx &gt; k) <span class="hljs-keyword">return</span> <span class="hljs-built_in">findKthElement</span>(nums, low, pivot_idx - <span class="hljs-number">1</span>, k);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">findKthElement</span>(nums, pivot_idx + <span class="hljs-number">1</span>, high, k);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">partition</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> high)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> pivot = nums[low];<br>        <span class="hljs-type">int</span> l = low + <span class="hljs-number">1</span>, r = high;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>        &#123;<br>            <span class="hljs-keyword">while</span> (l &lt;= r &amp;&amp; nums[l] &lt; pivot) ++l;<br>            <span class="hljs-keyword">while</span> (l &lt;= r &amp;&amp; nums[r] &gt; pivot) --r;<br>            <span class="hljs-keyword">if</span> (l &gt;= r) <span class="hljs-keyword">break</span>;<br>            <span class="hljs-built_in">swap</span>(nums[l], nums[r]);<br>            ++l; --r;<br>        &#125;<br>        <span class="hljs-built_in">swap</span>(nums[low], nums[r]);<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ä»£ç ä¸­çš„partitionç®—æ³•ï¼Œè¯¥ç®—æ³•å°†åŒºé—´$[low,high]$åˆ’åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œä¸€ä¸ªåŒºé—´æ˜¯$[low + 1, l)$ï¼Œæ­¤åŒºé—´æ»¡è¶³ä»»æ„å…ƒç´ éƒ½ä¸¥æ ¼å°äºpivotï¼Œå¦ä¸€ä¸ªåŒºé—´æ˜¯$(r, high]$ï¼Œæ­¤åŒºé—´æ»¡è¶³ä»»æ„å…ƒç´ éƒ½ä¸¥æ ¼å¤§äºpivotã€‚å½“è·³å‡ºå¾ªç¯çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§å¯èƒ½ï¼š</p><ol><li>$l &#x3D; r$ï¼Œæ­¤æ—¶$nums[l] &gt;&#x3D; pivot$ä¸”$nums[l] &lt;&#x3D; pivot$ã€‚å³$nums[l] &#x3D; nums[r] &#x3D; pivot$.</li><li>$l &#x3D; r + 1$, æ­¤æ—¶$r &lt; l$ï¼Œå› æ­¤$nums[r] &lt; pivot, nums[l] &gt; pivot$.å› æ­¤$r$æ˜¯æ¢è½´ä½ç½®ã€‚</li></ol><p> æ³¨æ„æ¡ä»¶ä¸­çš„$l &lt;&#x3D; r$çš„ç­‰å·ä¸èƒ½çœç•¥ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿å½“$l &#x3D;&#x3D; r$çš„æ—¶å€™ï¼Œä»ç„¶ä¼šå¯¹è¯¥ä½ç½®çš„å…ƒç´ è¿›è¡Œæ£€æµ‹ï¼Œä½¿ä¹‹æ»¡è¶³åŒºé—´çº¦æŸæ¡ä»¶ã€‚åä¹‹ï¼Œå¦‚æœæˆ‘ä»¬çœç•¥ç­‰å·ï¼Œé‚£ä¹ˆå½“$l &#x3D;&#x3D; r$çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å› ä¸º$l &lt;r$è¿™ä¸ªæ¡ä»¶ä¸æˆç«‹å¯¼è‡´å¾ªç¯æå‰ç»ˆæ­¢ï¼Œè€Œæ²¡æœ‰å¯¹å½“å‰ä½ç½®çš„å…ƒç´ è¿›è¡Œæ£€æµ‹ï¼Œå…¶æœ‰å¯èƒ½ä¸ç¬¦åˆåŒºé—´çš„çº¦æŸæ¡ä»¶ã€‚</p><h4 id="å¤§é¡¶å †"><a href="#å¤§é¡¶å †" class="headerlink" title="å¤§é¡¶å †"></a>å¤§é¡¶å †</h4><p>æˆ‘ä»¬å°†å…ƒç´ ç»´æŠ¤åœ¨ä¸€ä¸ªå¤§é¡¶å †ä¸­ï¼Œç„¶åä¾æ¬¡å–å‡ºçš„ç¬¬kä¸ªå…ƒç´ å³ä¸ºæˆ‘ä»¬æ‰€æ±‚ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> k)</span> </span>&#123;<br>        <span class="hljs-type">int</span> n = nums.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-built_in">buildHeap</span>(nums, n);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= k; ++i)<br>        &#123;<br>            <span class="hljs-built_in">swap</span>(nums[<span class="hljs-number">0</span>], nums[n - i]);<br>            <span class="hljs-built_in">heapAdjust</span>(nums, <span class="hljs-number">0</span>, n - i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> nums[n - k];<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">buildHeap</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums, <span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = n / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i)<br>        &#123;<br>            <span class="hljs-built_in">heapAdjust</span>(nums, i, n);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">heapAdjust</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums, <span class="hljs-type">int</span> k, <span class="hljs-type">int</span> n)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> i = <span class="hljs-built_in">left</span>(k);<br>        <span class="hljs-keyword">while</span> (i &lt; n)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> &lt; n &amp;&amp; nums[i + <span class="hljs-number">1</span>] &gt; nums[i])++i;<br>            <span class="hljs-keyword">if</span> (nums[k] &gt;= nums[i]) <span class="hljs-keyword">break</span>;<br>            <span class="hljs-built_in">swap</span>(nums[k], nums[i]);<br>            k = i;<br>            i = <span class="hljs-built_in">left</span>(k);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">left</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span></span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; &#125;<br>&#125;;<br><br><span class="hljs-comment">// c++æ ‡å‡†åº“ç®—æ³•å®ç°</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">findKthLargest</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums, <span class="hljs-type">int</span> k)</span> </span>&#123;<br>        <span class="hljs-type">int</span> n = nums.<span class="hljs-built_in">size</span>();<br>        <span class="hljs-built_in">make_heap</span>(nums.<span class="hljs-built_in">begin</span>(), nums.<span class="hljs-built_in">end</span>());<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; k; ++i)<br>        &#123;<br>            <span class="hljs-built_in">pop_heap</span>(nums.<span class="hljs-built_in">begin</span>(), nums.<span class="hljs-built_in">end</span>() - i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> nums[n - k];<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>å»ºå †çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n)$ï¼Œæ¯ä¸€æ¬¡åˆ é™¤ä¸€ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(logn)$ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n + klogn).$ </p><p><strong>ç©ºé—´å¤æ‚åº¦</strong></p><p>$O(1).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]191.ä½1çš„ä¸ªæ•°</title>
    <link href="/2024/10/06/LC-191-%E4%BD%8D1%E7%9A%84%E4%B8%AA%E6%95%B0/"/>
    <url>/2024/10/06/LC-191-%E4%BD%8D1%E7%9A%84%E4%B8%AA%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="é€ä½æ•°"><a href="#é€ä½æ•°" class="headerlink" title="é€ä½æ•°"></a>é€ä½æ•°</h4><p>è¿™é¢˜æ¯”è¾ƒç®€å•ï¼Œç›´æ¥çœ‹ä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">hammingWeight</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>&#123;<br>        <span class="hljs-type">size_t</span> hmw = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i != <span class="hljs-built_in">sizeof</span>(n) * <span class="hljs-number">8</span> &amp;&amp; n &gt; <span class="hljs-number">0</span>; ++i, n &gt;&gt;= <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">if</span> (n &amp; <span class="hljs-number">1</span>) hmw += <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> hmw;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(logn).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1).$</p><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>æœ‰ä¸¤ç§ä¼˜åŒ–æ–¹å¼</p><ol><li><p>$n &amp; (n - 1)$. é€šè¿‡è¿™ä¸ªå¼å­ï¼Œå¯ä»¥å°†$n$çš„æœ€ä½çš„1ç½®0.</p><p>è¯æ˜: å¯¹äºä»»æ„$n &#x3D; a_la_{l-1}â€¦a_k100â€¦00,n-1&#x3D;a_la_{l-1}â€¦a_k000â€¦00$ï¼Œ</p><p>åˆ™$n&amp;(n-1) &#x3D; a_la_{l-1}â€¦a{k}000â€¦00$.å³æœ€ä½çš„1ç½®0.</p></li><li><p>$n&amp;(-n)$.é€šè¿‡è¿™ä¸ªå¼å­ï¼Œå¯ä»¥å–å¾—$n$çš„æœ€ä½çš„1çš„å€¼.</p><p>è¯æ˜ï¼šå¯¹äºä»»æ„$n&#x3D;a_la_{l-1}â€¦a_k100â€¦00,$</p><p>$-n &#x3D; \overline{a_la_{l-1}â€¦a_k}011â€¦11 + 1 $</p><p>â€‹       $&#x3D; \overline{a_la_{l-1}â€¦a_k}100â€¦00$</p><p>æ‰€ä»¥$n&amp;(-n)$ç­‰äº$n$çš„æœ€ä½çš„1çš„å€¼.</p></li></ol><p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå¼å­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç®—æ³•è¿›è¡Œä¼˜åŒ–ï¼Œä½¿å¾—æˆ‘ä»¬ç®—æ³•å¾ªç¯çš„æ¬¡æ•°ä¸¥æ ¼çš„ç­‰äº$n$ä¸­1çš„ä¸ªæ•°ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// ä¼˜åŒ–æ–¹å¼1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">hammingWeight</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>&#123;<br>        <span class="hljs-type">size_t</span> hmw = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            ++hmw;<br>            n = (n &amp; (n - <span class="hljs-number">1</span>));<br>        &#125;<br>        <span class="hljs-keyword">return</span> hmw;<br>    &#125;<br>&#125;;<br><span class="hljs-comment">// ä¼˜åŒ–æ–¹å¼2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">hammingWeight</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>&#123;<br>        <span class="hljs-type">size_t</span> hmw = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            ++hmw;<br>            n -= (n &amp; (-n));<br>        &#125;<br>        <span class="hljs-keyword">return</span> hmw;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(logn).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]190.é¢ å€’äºŒè¿›åˆ¶ä½</title>
    <link href="/2024/10/06/LC-190-%E9%A2%A0%E5%80%92%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BD%8D/"/>
    <url>/2024/10/06/LC-190-%E9%A2%A0%E5%80%92%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BD%8D/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>é¢ å€’ç»™å®šçš„ 32 ä½æ— ç¬¦å·æ•´æ•°çš„äºŒè¿›åˆ¶ä½ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æŒ‰ä½é¢ å€’"><a href="#æŒ‰ä½é¢ å€’" class="headerlink" title="æŒ‰ä½é¢ å€’"></a>æŒ‰ä½é¢ å€’</h4><p>æˆ‘ä»¬ä»ä½åˆ°é«˜ä¾æ¬¡å–ç»™å®šæ•°çš„æ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½$i$ï¼Œå°†å…¶æ”¾ç½®åœ¨$31 - i$çš„ä½ç½®ä¸Šå³å¯ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">reverseBits</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> n)</span> </span>&#123;<br>        <span class="hljs-type">uint32_t</span> ans = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span> &amp;&amp; n &gt; <span class="hljs-number">0</span>; ++i, n &gt;&gt;= <span class="hljs-number">1</span>)<br>        &#123;<br>            ans = ans | ((n &amp; <span class="hljs-number">1</span>) &lt;&lt; (<span class="hljs-number">31</span> - i));<br>        &#125;<br>        <span class="hljs-keyword">return</span> ans;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p><p>å› ä¸ºæ¯æ¬¡$n$éƒ½å‡å°ä¸ºåŸæ¥çš„ä¸€åŠï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º$O(logn).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong></p><p>$O(1).$</p><h4 id="åˆ†æ²»"><a href="#åˆ†æ²»" class="headerlink" title="åˆ†æ²»"></a>åˆ†æ²»</h4><p>åˆ†æ²»åªéœ€è¦åˆ†åˆ«å°†å·¦åŠå’Œå³åŠé¢ å€’ï¼Œç„¶åå·¦åŠå’Œå³åŠåœ¨æ•´ä½“é¢ å€’å³å¯ã€‚é‡‡ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹å¼ï¼Œé¦–å…ˆä¸¤ä¸¤ä¸€ç»„ï¼Œäº¤æ¢ç›¸é‚»çš„ä¸¤ä½ï¼Œç„¶åå››ä¸ªå››ä¸ªä¸€ç»„ï¼Œäº¤æ¢ç›¸é‚»çš„å·¦åŠå’Œå³åŠï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><p>ç¼–ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡‡ç”¨æ©ç çš„æŠ€å·§è¿›è¡Œç¼–ç ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œé¢ å€’æ“ä½œã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> M1 = <span class="hljs-number">0x55555555</span>;<br>    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> M2 = <span class="hljs-number">0x33333333</span>;<br>    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> M3 = <span class="hljs-number">0x0f0f0f0f</span>;<br>    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> M4 = <span class="hljs-number">0x00ff00ff</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">uint32_t</span> <span class="hljs-title">reverseBits</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> n)</span> </span>&#123;<br>        n = (n &gt;&gt; <span class="hljs-number">1</span>) &amp; M1 | (n &amp; M1) &lt;&lt; <span class="hljs-number">1</span>;<br>        n = (n &gt;&gt; <span class="hljs-number">2</span>) &amp; M2 | (n &amp; M2) &lt;&lt; <span class="hljs-number">2</span>;<br>        n = (n &gt;&gt; <span class="hljs-number">4</span>) &amp; M3 | (n &amp; M3) &lt;&lt; <span class="hljs-number">4</span>;<br>        n = (n &gt;&gt; <span class="hljs-number">8</span>) &amp; M4 | (n &amp; M4) &lt;&lt; <span class="hljs-number">8</span>;<br>        <span class="hljs-keyword">return</span> (n &gt;&gt; <span class="hljs-number">16</span>) | (n &lt;&lt; <span class="hljs-number">16</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>$O(1).$</p><p><strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>$O(1)$.</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]109.æœ‰åºé“¾è¡¨è½¬æ¢äºŒå‰æœç´¢æ ‘</title>
    <link href="/2024/10/06/LC-109-%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8%E8%BD%AC%E6%8D%A2%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/"/>
    <url>/2024/10/06/LC-109-%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8%E8%BD%AC%E6%8D%A2%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®šä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹  <code>head</code> ï¼Œå…¶ä¸­çš„å…ƒç´  <strong>æŒ‰å‡åºæ’åº</strong> ï¼Œå°†å…¶è½¬æ¢ä¸ºå¹³è¡¡äºŒå‰æœç´¢æ ‘ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="åˆ†æ²»"><a href="#åˆ†æ²»" class="headerlink" title="åˆ†æ²»"></a>åˆ†æ²»</h4><p>æˆ‘ä»¬å°†é“¾è¡¨ä¸­é—´åå·¦çš„ç»“ç‚¹$m*$ä½œä¸ºæ ¹èŠ‚ç‚¹æ„å»ºBSTï¼Œç”±æ­¤å°†åŸé—®é¢˜è§„çº¦ä¸ºä¸¤ä¸ªè§„æ¨¡æ›´å°çš„å­é—®é¢˜ï¼Œåˆ†åˆ«é€’å½’æ±‚è§£ï¼Œå¾—åˆ°å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œå°†å…¶å’Œæ ¹ç»“ç‚¹ç»„åˆåè¿”å›å³å¯ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">ListNode *<span class="hljs-title">findMid</span><span class="hljs-params">(ListNode *head, ListNode *end)</span></span><br><span class="hljs-function">    </span>&#123;<br>        ListNode *slow = head, *fast = head;<br>        <span class="hljs-keyword">while</span> (fast-&gt;next != end &amp;&amp; fast-&gt;next-&gt;next != end)<br>        &#123;<br>            slow = slow-&gt;next;<br>            fast = fast-&gt;next-&gt;next;<br>        &#125;<br>        <span class="hljs-keyword">return</span> slow;<br>    &#125;<br>    <span class="hljs-function">TreeNode *<span class="hljs-title">buildBST</span><span class="hljs-params">(ListNode *head, ListNode *end)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (head == end) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-keyword">auto</span> mid = <span class="hljs-built_in">findMid</span>(head, end);<br>        TreeNode *root = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>(mid-&gt;val);<br>        root-&gt;left = <span class="hljs-built_in">buildBST</span>(head, mid);<br>        root-&gt;right = <span class="hljs-built_in">buildBST</span>(mid-&gt;next, end);<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">sortedListToBST</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">buildBST</span>(head, <span class="hljs-literal">nullptr</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>æ¯æ¬¡é€’å½’çš„æ—¶å€™ï¼Œä¸ºäº†æ‰¾åˆ°ä¸­é—´çš„ç»“ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦$O(n)$çš„æ—¶é—´ã€‚</p><p>ç”±æ­¤å¾—åˆ°é€’æ¨æ–¹ç¨‹$W(n) &#x3D; 2W(n&#x2F;2) + O(n).$</p><p>ç”±ä¸»å®šç†ï¼Œè§£å¾—$W(n) &#x3D; \Theta(nlogn).$</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong></p><p>ç©ºé—´å¤æ‚åº¦ä¸ºé€’å½’æ·±åº¦$O(logn).$</p><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºé“¾è¡¨ä¸å…·æœ‰éšæœºè®¿é—®çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ä¸ºäº†æ‰¾åˆ°ä¸­é—´ç»“ç‚¹ï¼Œéœ€è¦èŠ±è´¹$O(n)$çš„æ—¶é—´ã€‚</p><p>ä¸ºäº†å‡å°‘è¿™ä¸ªæ—¶é—´ï¼Œä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œå°†é“¾è¡¨ä¸­çš„å…ƒç´ å­˜å‚¨è¿›æ•°ç»„ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨$O(1)$çš„æ—¶é—´å†…è®¿é—®åˆ°ä¸­é—´ç»“ç‚¹äº†ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ç©ºé—´å¤æ‚åº¦å˜ä¸º$O(n)$.</p><p>é‚£æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥æ—¢ä¿è¯ç©ºé—´å¤æ‚åº¦ä¸æ”¹å˜ï¼Œåˆèƒ½å¤Ÿé™ä½æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿ</p><p>è§‚å¯Ÿå»ºæ ‘çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆåˆå§‹åŒ–æ ¹ç»“ç‚¹ï¼Œç„¶åå»é€’å½’çš„å»ºç«‹å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œä½†å»ºç«‹å·¦å­æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹ç»“ç‚¹çš„å”¯ä¸€ä½œç”¨å°±æ˜¯ä½œä¸ºè¾¹ç•Œï¼Œå®é™…åªä¼šç”¨åˆ°æ ¹èŠ‚ç‚¹å·¦è¾¹çš„ç»“ç‚¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹æ ‡æ¥ä»£æ›¿æ ¹èŠ‚ç‚¹ï¼Œå…ˆå»ºç«‹å·¦å­æ ‘ï¼Œç„¶åå»ºç«‹æ ¹ç»“ç‚¹ï¼Œä¹‹åå†å»ºç«‹å³å­æ ‘ã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆç±»ä¼¼ä¸­åºéå†çš„è¿‡ç¨‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å†æ¯æ¬¡é€’å½’çš„æ—¶å€™ï¼Œå°†å¤´ç»“ç‚¹åç§»ï¼Œè¿™æ ·åœ¨é€’å½’å¤„ç†å®Œå·¦å­æ ‘ä¹‹åï¼Œå¤´ç»“ç‚¹çš„ä½ç½®åˆšå¥½æŒ‡å‘æˆ‘ä»¬éœ€è¦çš„ä¸­é—´ç»“ç‚¹çš„ä½ç½®ï¼Œä»è€Œæ— éœ€èŠ±è´¹$O(n)$çš„æ—¶é—´å¤æ‚åº¦å»å®šä½ä¸­é—´èŠ‚ç‚¹ã€‚</p><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">getLength</span><span class="hljs-params">(ListNode *head)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-type">int</span> length = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (head) <br>        &#123;<br>            ++length;<br>            head = head-&gt;next;<br>        &#125;<br>        <span class="hljs-keyword">return</span> length;<br>    &#125;<br>    <span class="hljs-comment">// [l, r]</span><br>    <span class="hljs-function">TreeNode *<span class="hljs-title">buildBST</span><span class="hljs-params">(ListNode *&amp;head, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (l &gt; r) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-keyword">auto</span> root = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>();<br>        <span class="hljs-type">int</span> m = l + ((r - l) &gt;&gt; <span class="hljs-number">1</span>);<br>        root-&gt;left = <span class="hljs-built_in">buildBST</span>(head, l, m - <span class="hljs-number">1</span>);<br>        root-&gt;val = head-&gt;val;<br>        head = head-&gt;next;<br>        root-&gt;right = <span class="hljs-built_in">buildBST</span>(head, m + <span class="hljs-number">1</span>, r);<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">sortedListToBST</span><span class="hljs-params">(ListNode* head)</span> </span>&#123;<br>        <span class="hljs-type">int</span> length = <span class="hljs-built_in">getLength</span>(head);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">buildBST</span>(head, <span class="hljs-number">0</span>, length - <span class="hljs-number">1</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>é€’æ¨æ–¹ç¨‹$W(n) &#x3D; 2W(n&#x2F;2) + O(1).$</p><p>ç”±ä¸»å®šç†ï¼Œ$W(n) &#x3D; \Theta(n).$</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong> </p><p>ç©ºé—´å¤æ‚åº¦ç­‰äºé€’å½’æ·±åº¦$O(logn).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]105.ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘</title>
    <link href="/2024/10/06/LC-105-%E4%BB%8E%E5%89%8D%E5%BA%8F%E4%B8%8E%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    <url>/2024/10/06/LC-105-%E4%BB%8E%E5%89%8D%E5%BA%8F%E4%B8%8E%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97%E6%9E%84%E9%80%A0%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ <code>preorder</code> å’Œ <code>inorder</code> ï¼Œå…¶ä¸­ <code>preorder</code> æ˜¯äºŒå‰æ ‘çš„<strong>å…ˆåºéå†</strong>ï¼Œ <code>inorder</code> æ˜¯åŒä¸€æ£µæ ‘çš„<strong>ä¸­åºéå†</strong>ï¼Œè¯·æ„é€ äºŒå‰æ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å…ˆåºåºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ ‘çš„æ ¹ï¼Œåœ¨ä¸­åºåºåˆ—ä¸­å®šä½åˆ°è¿™ä¸ªå…ƒç´ ï¼Œè¯¥å…ƒç´ çš„å·¦è¾¹éƒ½æ˜¯å·¦å­æ ‘ä¸­çš„ç»“ç‚¹ï¼Œå³è¾¹éƒ½æ˜¯å³å­æ ‘ä¸­çš„ç»“ç‚¹ï¼Œæ®æ­¤ï¼Œå¯ä»¥å°†é—®é¢˜è§„çº¦ä¸ºä¸¤ä¸ªæ›´å°çš„å­é—®é¢˜ï¼Œé€’å½’æ±‚è§£ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for a binary tree node.</span><br><span class="hljs-comment"> * struct TreeNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     TreeNode *left;</span><br><span class="hljs-comment"> *     TreeNode *right;</span><br><span class="hljs-comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left),</span><br><span class="hljs-comment"> * right(right) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">buildTree</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; preorder, vector&lt;<span class="hljs-type">int</span>&gt;&amp; inorder)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">buildTreeHelper</span>(preorder, <span class="hljs-number">0</span>, preorder.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>, inorder, <span class="hljs-number">0</span>,<br>                               inorder.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">buildTreeHelper</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; preorder, <span class="hljs-type">size_t</span> l1, <span class="hljs-type">size_t</span> r1,</span></span><br><span class="hljs-params"><span class="hljs-function">                              vector&lt;<span class="hljs-type">int</span>&gt;&amp; inorder, <span class="hljs-type">size_t</span> l2, <span class="hljs-type">size_t</span> r2)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (l1 &gt; r1 || l2 &gt; r2) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-keyword">if</span> (l1 == r1)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>(preorder[l1]);<br>        <span class="hljs-keyword">auto</span> root_iter = <span class="hljs-built_in">find</span>(inorder.<span class="hljs-built_in">cbegin</span>(), inorder.<span class="hljs-built_in">cend</span>(), preorder[l1]);<br>        <span class="hljs-type">size_t</span> root_pos = root_iter - inorder.<span class="hljs-built_in">begin</span>();<br>        <span class="hljs-type">size_t</span> left_size = root_pos - l2, right_size = r2 - root_pos;<br>        TreeNode* root = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>(preorder[l1]);<br>        root-&gt;left = <span class="hljs-built_in">buildTreeHelper</span>(preorder, l1 + <span class="hljs-number">1</span>, l1 + left_size, inorder,<br>                                     l2, root_pos - <span class="hljs-number">1</span>);<br>        root-&gt;right = <span class="hljs-built_in">buildTreeHelper</span>(preorder, l1 + left_size + <span class="hljs-number">1</span>, r1, inorder,<br>                                      root_pos + <span class="hljs-number">1</span>, r2);<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>å¯ä»¥å¾—åˆ°å¹³å‡æ—¶é—´å¤æ‚åº¦çš„é€’æ¨æ–¹ç¨‹$A(n) &#x3D; \frac{2}{n} \Sigma_{i&#x3D;1}^{n-1}A(i) + O(n).$</p><p>è§£å¾—$A(n) &#x3D; \Theta(nlogn).$</p><p><strong>ä¼˜åŒ–</strong>ï¼š</p><p>å¦‚æœæˆ‘ä»¬åœ¨å¤„ç†ä¹‹å‰ï¼Œå…ˆå°†indorderæ•°ç»„çš„å€¼å’Œå…¶ä¸‹è¡¨å»ºç«‹ä¸€ä¸ªå“ˆå¸Œæ˜ å°„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡é€’å½’çš„æ—¶å€™å¹³å‡åªéœ€è¦$O(1)$çš„æ—¶é—´å°±å¯ä»¥åœ¨inorderä¸­æ‰¾åˆ°æ ‘çš„æ ¹ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">buildTree</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; preorder, vector&lt;<span class="hljs-type">int</span>&gt;&amp; inorder)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i != inorder.<span class="hljs-built_in">size</span>(); ++i)<br>            val_to_posi_[inorder[i]] = i;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">buildTreeHelper</span>(preorder, <span class="hljs-number">0</span>, preorder.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>, inorder, <span class="hljs-number">0</span>,<br>                               inorder.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-function">TreeNode* <span class="hljs-title">buildTreeHelper</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; preorder, <span class="hljs-type">size_t</span> l1, <span class="hljs-type">size_t</span> r1,</span></span><br><span class="hljs-params"><span class="hljs-function">                              vector&lt;<span class="hljs-type">int</span>&gt;&amp; inorder, <span class="hljs-type">size_t</span> l2, <span class="hljs-type">size_t</span> r2)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (l1 &gt; r1 || l2 &gt; r2) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-keyword">if</span> (l1 == r1)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>(preorder[l1]);<br>        <span class="hljs-type">size_t</span> root_pos = val_to_posi_[preorder[l1]];<br>        <span class="hljs-type">size_t</span> left_size = root_pos - l2, right_size = r2 - root_pos;<br>        TreeNode* root = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>(preorder[l1]);<br>        root-&gt;left = <span class="hljs-built_in">buildTreeHelper</span>(preorder, l1 + <span class="hljs-number">1</span>, l1 + left_size, inorder,<br>                                     l2, root_pos - <span class="hljs-number">1</span>);<br>        root-&gt;right = <span class="hljs-built_in">buildTreeHelper</span>(preorder, l1 + left_size + <span class="hljs-number">1</span>, r1, inorder,<br>                                      root_pos + <span class="hljs-number">1</span>, r2);<br>        <span class="hljs-keyword">return</span> root;<br>    &#125;<br><span class="hljs-keyword">private</span>:<br>    unordered_map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">size_t</span>&gt; val_to_posi_;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š</p><p>ä¼˜åŒ–åçš„é€’æ¨æ–¹ç¨‹ä¸º$A(n) &#x3D; \frac{2}{n} \Sigma_{i&#x3D;1}^{n-1}A(i) + O(1).$</p><p>è§£å¾—$A(n) &#x3D; \Theta(n).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]53.æœ€å¤§å­æ•°ç»„å’Œ</title>
    <link href="/2024/10/06/LC-53-%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84%E5%92%8C/"/>
    <url>/2024/10/06/LC-53-%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84%E5%92%8C/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p>å­æ•°ç»„æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h4><p>ç”¨ <code>max</code> ç»´æŠ¤æœ€å¤§å­æ•°ç»„å’Œï¼Œ<code>cur_b</code> ç»´æŠ¤å½“å‰å­æ•°ç»„çš„èµ·å§‹ä½ç½®ï¼Œ<code>cur</code> ç»´æŠ¤å½“å‰å­æ•°ç»„çš„å’Œï¼Œ<code>i</code> ç»´æŠ¤å½“å‰éå†çš„ä½ç½®ï¼Œæ¯éå†åˆ°ä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å°†å½“å‰ä½ç½®çš„å€¼åŠ åˆ° <code>cur</code> ä¸Šï¼Œç„¶ååˆ¤æ–­ <code>cur</code> æ˜¯å¦å°äº <code>max</code> ï¼Œå¦‚æœå¤§äº <code>max</code> ï¼Œåˆ™æ›´æ–° <code>max</code> ï¼Œä¹‹åå†åˆ¤æ–­ <code>cur</code> æ˜¯å¦å°äº <code>0</code> ï¼Œå¦‚æœ <code>cur</code> å·²ç»å°äº <code>0</code> äº†ï¼Œåˆ™æ›´æ–° <code>cur_b</code> ä¸º <code>i+1</code> ï¼Œç„¶åç»§ç»­éå†ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">maxSubArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class="hljs-type">int</span> max = numeric_limits&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">min</span>(), cur = <span class="hljs-number">0</span>;<br>        <span class="hljs-type">size_t</span> cur_b = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i != nums.<span class="hljs-built_in">size</span>(); ++i)<br>        &#123;<br>            cur += nums[i];<br>            <span class="hljs-keyword">if</span> (cur &gt; max) max = cur;<br>            <span class="hljs-keyword">if</span> (cur &lt; <span class="hljs-number">0</span>) <br>            &#123;<br>                cur_b = i + <span class="hljs-number">1</span>;<br>                cur = <span class="hljs-number">0</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> max;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š$O(n)$.</p><h4 id="åˆ†æ²»"><a href="#åˆ†æ²»" class="headerlink" title="åˆ†æ²»"></a>åˆ†æ²»</h4><p>å‚è€ƒleetcodeå®˜æ–¹é¢˜è§£<a href="https://leetcode.cn/problems/maximum-subarray/solutions/228009/zui-da-zi-xu-he-by-leetcode-solution/?envType=problem-list-v2&envId=divide-and-conquer">53. æœ€å¤§å­æ•°ç»„å’Œ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a>ã€‚</p><p>é¦–å…ˆçº¦å®šå¯¹äºåŒºé—´$[l,r]$ï¼Œ$[l, m]$ä¸ºå®ƒçš„å·¦å­åŒºé—´ï¼Œ$[m + 1, r]$ä¸ºå®ƒçš„å³å­åŒºé—´ï¼Œå…¶ä¸­$m &#x3D; (l + r) &#x2F; 2$.</p><p>ä¸ºäº†æ±‚å¾—åŒºé—´$[l,r]$çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œæˆ‘ä»¬å¯ä»¥é€’å½’çš„å»æ±‚å®ƒçš„å·¦å³å­åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œç„¶åæƒ³åŠæ³•è·å¾—å½“å‰åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œå½“å‰åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ol><li>åŒºé—´$[l,r]$çš„æœ€å¤§å­æ•°ç»„å’Œç­‰äºå…¶å·¦å­åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œã€‚</li><li>åŒºé—´$[l,r]$çš„æœ€å¤§å­æ•°ç»„å’Œç­‰äºå…¶å³å­åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œã€‚</li><li>åŒºé—´$[l,r]$çš„æœ€å¤§å­æ•°ç»„å’Œä¸ºæŸä¸ªè·¨è¶Šå·¦å³å­åŒºé—´çš„å­æ•°ç»„çš„å’Œã€‚</li></ol><p>ä¸ºäº†å¤„ç†æƒ…å†µ3ï¼Œå¯¹äºæ¯ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸¤ä¸ªå˜é‡$lsum$å’Œ$rsum$ï¼Œå…¶ä¸­$lsum$ç»´æŠ¤äº†å½“å‰åŒºé—´ä»¥$l$ä¸ºèµ·ç‚¹çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œ$rsum$ç»´æŠ¤äº†å½“å‰åŒºé—´ä»¥$r$ä¸ºç»ˆç‚¹çš„æœ€å¤§å­æ•°ç»„å’Œã€‚</p><p>æœ‰äº†è¿™ä¸¤ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¤„ç†æƒ…å†µ3äº†ã€‚å³å½“å‰åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œåº”è¯¥æ˜¯å…¶å·¦åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œå³åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œä»¥åŠå·¦åŒºé—´çš„$rsum$åŠ å³åŒºé—´çš„$lsum$ï¼Œè¿™ä¸‰è€…å–å¤§ã€‚</p><p> é‚£æˆ‘ä»¬åº”è¯¥å¦‚ä½•ç»´æŠ¤è¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Ÿä¸éš¾å‘ç°ï¼ŒåŒºé—´$[l,r]$çš„$lsum$åº”è¯¥æ˜¯å…¶å·¦åŒºé—´çš„$lsum$å’Œå·¦åŒºé—´çš„å’ŒåŠ å³åŒºé—´çš„$lsum$ï¼Œè¿™ä¸¤è€…å–å¤§ï¼›åŒç†$rsum$åº”è¯¥æ˜¯å³åŒºé—´çš„$rsum$å’Œå³åŒºé—´çš„å’ŒåŠ å·¦åŒºé—´çš„$rsum$ï¼Œè¿™ä¸¤è€…å–å¤§ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬é¢å¤–ç»´æŠ¤ä¸€ä¸ªå˜é‡$isum$ç”¨æ¥è®°å½•åŒºé—´å’Œã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ç”¨å˜é‡$msum$æ¥ç»´æŠ¤å½“å‰åŒºé—´çš„æœ€å¤§å­æ•°ç»„å’Œã€‚<br>$$<br>\begin{align}<br>    &amp; msum &#x3D; max(l.msum, r.msum, l.rsum + r.lsum) \\<br>    &amp; isum &#x3D; l.isum + r.isum \\<br>    &amp; lsum &#x3D; max(l.lsum, l.isum + r.lsum) \\<br>    &amp; rsum &#x3D; max(r.rsum, r.isum + l.rsum)<br>\end{align}<br>$$<br><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Status</span><br>    &#123;<br>        <span class="hljs-type">int</span> lsum, rsum;<br>        <span class="hljs-type">int</span> isum, msum;<br>    &#125;;<br>    <span class="hljs-function">Status <span class="hljs-title">maxSubArrayHelper</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt; &amp;nums, <span class="hljs-type">size_t</span> l, <span class="hljs-type">size_t</span> r)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (l == r) <span class="hljs-keyword">return</span> &#123;nums[l], nums[l], nums[l], nums[l]&#125;;<br>        <span class="hljs-type">size_t</span> m = l + ((r - l) &gt;&gt; <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">auto</span> lstatus = <span class="hljs-built_in">maxSubArrayHelper</span>(nums, l, m);<br>        <span class="hljs-keyword">auto</span> rstatus = <span class="hljs-built_in">maxSubArrayHelper</span>(nums, m + <span class="hljs-number">1</span>, r);<br>        <span class="hljs-type">int</span> isum = lstatus.isum + rstatus.isum;<br>        <span class="hljs-type">int</span> lsum = <span class="hljs-built_in">max</span>(lstatus.lsum, lstatus.isum + rstatus.lsum);<br>        <span class="hljs-type">int</span> rsum = <span class="hljs-built_in">max</span>(rstatus.rsum, rstatus.isum + lstatus.rsum);<br>        <span class="hljs-type">int</span> msum = <span class="hljs-built_in">max</span>(lstatus.rsum + rstatus.lsum, <br>                       <span class="hljs-built_in">max</span>(lstatus.msum, rstatus.msum));<br>        <span class="hljs-keyword">return</span> &#123;lsum, rsum, isum, msum&#125;;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">maxSubArray</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">maxSubArrayHelper</span>(nums, <span class="hljs-number">0</span>, nums.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> status.msum;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p><p>é€’æ¨æ–¹ç¨‹ï¼š$W(n) &#x3D; 2W(n&#x2F;2) + O(1)$</p><p>ç”±ä¸»å®šç†ï¼Œè§£å¾—$W(n) &#x3D; \Theta(n)$.</p><p><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š</p><p>å› ä¸ºé‡‡ç”¨äº†é€’å½’ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸ºé€’å½’æ·±åº¦$O(logn)$.</p><blockquote><p>ã€Œæ–¹æ³•äºŒã€ç›¸è¾ƒäºã€Œæ–¹æ³•ä¸€ã€æ¥è¯´ï¼Œæ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†é€’å½’ï¼Œå¹¶ä¸”ç»´æŠ¤äº†å››ä¸ªä¿¡æ¯çš„ç»“æ„ä½“ï¼Œè¿è¡Œçš„æ—¶é—´ç•¥é•¿ï¼Œç©ºé—´å¤æ‚åº¦ä¹Ÿä¸å¦‚æ–¹æ³•ä¸€ä¼˜ç§€ï¼Œè€Œä¸”éš¾ä»¥ç†è§£ã€‚é‚£ä¹ˆè¿™ç§æ–¹æ³•å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å¯¹äºè¿™é“é¢˜è€Œè¨€ï¼Œç¡®å®æ˜¯å¦‚æ­¤çš„ã€‚ä½†æ˜¯ä»”ç»†è§‚å¯Ÿã€Œæ–¹æ³•äºŒã€ï¼Œå®ƒä¸ä»…å¯ä»¥è§£å†³åŒºé—´ [0,nâˆ’1]ï¼Œè¿˜å¯ä»¥ç”¨äºè§£å†³ä»»æ„çš„å­åŒºé—´ [l,r] çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æŠŠ [0,nâˆ’1] åˆ†æ²»ä¸‹å»å‡ºç°çš„æ‰€æœ‰å­åŒºé—´çš„ä¿¡æ¯éƒ½ç”¨å †å¼å­˜å‚¨çš„æ–¹å¼è®°å¿†åŒ–ä¸‹æ¥ï¼Œå³å»ºæˆä¸€æ£µçœŸæ­£çš„æ ‘ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ O(logn) çš„æ—¶é—´å†…æ±‚åˆ°ä»»æ„åŒºé—´å†…çš„ç­”æ¡ˆï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¿®æ”¹åºåˆ—ä¸­çš„å€¼ï¼Œåšä¸€äº›ç®€å•çš„ç»´æŠ¤ï¼Œä¹‹åä»ç„¶å¯ä»¥åœ¨ O(logn) çš„æ—¶é—´å†…æ±‚åˆ°ä»»æ„åŒºé—´å†…çš„ç­”æ¡ˆï¼Œå¯¹äºå¤§è§„æ¨¡æŸ¥è¯¢çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿ä¾¿ä½“ç°äº†å‡ºæ¥ã€‚è¿™æ£µæ ‘å°±æ˜¯ä¸Šæ–‡æåŠçš„ä¸€ç§ç¥å¥‡çš„æ•°æ®ç»“æ„â€”â€”çº¿æ®µæ ‘ã€‚</p><p>ä½œè€…ï¼šåŠ›æ‰£å®˜æ–¹é¢˜è§£<br>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/maximum-subarray/solutions/228009/zui-da-zi-xu-he-by-leetcode-solution/">https://leetcode.cn/problems/maximum-subarray/solutions/228009/zui-da-zi-xu-he-by-leetcode-solution/</a><br>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ç±»å‹æç«¯å€¼</title>
    <link href="/2024/10/06/C-%E7%B1%BB%E5%9E%8B%E6%9E%81%E7%AB%AF%E5%80%BC/"/>
    <url>/2024/10/06/C-%E7%B1%BB%E5%9E%8B%E6%9E%81%E7%AB%AF%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ C++ ä¸­ï¼Œä¸åŒç±»å‹æœ‰å„è‡ªçš„æç«¯å€¼ï¼ŒåŒ…æ‹¬æœ€å°å€¼ã€æœ€å¤§å€¼å’Œè¡¨ç¤ºç‰¹æ®Šæƒ…å†µçš„å€¼ï¼ˆå¦‚æ— ç©·å¤§ã€æœªå®šä¹‰å€¼ç­‰ï¼‰ã€‚è¿™äº›æç«¯å€¼åœ¨ç®—æ³•å’Œç¼–ç¨‹ä¸­ç»å¸¸è¢«ä½¿ç”¨ï¼Œæ¯”å¦‚è®¾ç½®è¾¹ç•Œæ¡ä»¶ã€åˆå§‹åŒ–å˜é‡ç­‰ã€‚ä¸‹é¢å°†ä»‹ç»å„ä¸ªåŸºæœ¬ç±»å‹çš„æç«¯å€¼åŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚</p><h3 id="1-æ•´å‹ç±»å‹"><a href="#1-æ•´å‹ç±»å‹" class="headerlink" title="1. æ•´å‹ç±»å‹"></a>1. <strong>æ•´å‹ç±»å‹</strong></h3><h4 id="å¸¸è§çš„æ•´å‹ç±»å‹"><a href="#å¸¸è§çš„æ•´å‹ç±»å‹" class="headerlink" title="å¸¸è§çš„æ•´å‹ç±»å‹"></a>å¸¸è§çš„æ•´å‹ç±»å‹</h4><ul><li><code>int</code>ï¼šæ ‡å‡†æ•´å‹</li><li><code>long</code>ï¼šè¾ƒå¤§çš„æ•´å‹</li><li><code>long long</code>ï¼šæ›´å¤§çš„æ•´å‹</li><li><code>unsigned int</code>ï¼šæ— ç¬¦å·æ•´å‹ï¼Œä¸èƒ½è¡¨ç¤ºè´Ÿæ•°</li><li><code>char</code>ï¼šå­—ç¬¦ç±»å‹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª 1 å­—èŠ‚çš„æ•´æ•°</li></ul><h4 id="è·å–æ•´å‹æç«¯å€¼"><a href="#è·å–æ•´å‹æç«¯å€¼" class="headerlink" title="è·å–æ•´å‹æç«¯å€¼"></a>è·å–æ•´å‹æç«¯å€¼</h4><p>åœ¨ C++ ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>limits</code> å¤´æ–‡ä»¶ä¸­çš„ <code>std::numeric_limits</code> ç±»æ¥è·å–æ•´å‹ï¼ˆä»¥åŠå…¶ä»–ç±»å‹ï¼‰çš„æç«¯å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;limits&gt;</span>  <span class="hljs-comment">// å¤´æ–‡ä»¶</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;int çš„æœ€å°å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">min</span>() &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;int çš„æœ€å¤§å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">max</span>() &lt;&lt; std::endl;<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;unsigned int çš„æœ€å¤§å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">max</span>() &lt;&lt; std::endl;<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;long long çš„æœ€å°å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt;::<span class="hljs-built_in">min</span>() &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;long long çš„æœ€å¤§å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt;::<span class="hljs-built_in">max</span>() &lt;&lt; std::endl;<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;char çš„æœ€å°å€¼: &quot;</span> &lt;&lt; +std::numeric_limits&lt;<span class="hljs-type">char</span>&gt;::<span class="hljs-built_in">min</span>() &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;char çš„æœ€å¤§å€¼: &quot;</span> &lt;&lt; +std::numeric_limits&lt;<span class="hljs-type">char</span>&gt;::<span class="hljs-built_in">max</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// ä½¿ç”¨ + å¼ºåˆ¶è½¬æ¢ä¸º int ç±»å‹è¾“å‡º</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ•´å‹ç±»å‹çš„æç«¯å€¼æ€»ç»“"><a href="#æ•´å‹ç±»å‹çš„æç«¯å€¼æ€»ç»“" class="headerlink" title="æ•´å‹ç±»å‹çš„æç«¯å€¼æ€»ç»“"></a>æ•´å‹ç±»å‹çš„æç«¯å€¼æ€»ç»“</h4><ul><li><code>std::numeric_limits&lt;int&gt;::min()</code>ï¼šè¿”å› <code>int</code> ç±»å‹çš„æœ€å°å€¼ï¼ˆä¾‹å¦‚ <code>-2147483648</code>ï¼‰ã€‚</li><li><code>std::numeric_limits&lt;int&gt;::max()</code>ï¼šè¿”å› <code>int</code> ç±»å‹çš„æœ€å¤§å€¼ï¼ˆä¾‹å¦‚ <code>2147483647</code>ï¼‰ã€‚</li><li><code>std::numeric_limits&lt;unsigned int&gt;::max()</code>ï¼šè¿”å›æ— ç¬¦å·æ•´å‹çš„æœ€å¤§å€¼ï¼ˆä¾‹å¦‚ <code>4294967295</code>ï¼‰ã€‚</li><li><code>std::numeric_limits&lt;long long&gt;::min()</code> å’Œ <code>max()</code>ï¼šå¯¹äº <code>long long</code> ç±»å‹ï¼Œè¿”å›æœ€å°å’Œæœ€å¤§å€¼ã€‚</li><li><code>std::numeric_limits&lt;char&gt;::min()</code> å’Œ <code>max()</code>ï¼šè¿”å› <code>char</code> ç±»å‹çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼ˆ-128 åˆ° 127ï¼‰ã€‚</li></ul><p>è¿™äº›æç«¯å€¼é€šå¸¸ç”¨äºåˆå§‹åŒ–è¾¹ç•Œå€¼æˆ–é™åˆ¶è¾“å…¥å€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> largest = std::numeric_limits&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">min</span>();  <span class="hljs-comment">// åˆå§‹åŒ–ä¸ºæœ€å°å€¼ï¼Œä¿è¯æ¥ä¸‹æ¥çš„æ•°éƒ½æ¯”å®ƒå¤§</span><br></code></pre></td></tr></table></figure><h3 id="2-æµ®ç‚¹ç±»å‹"><a href="#2-æµ®ç‚¹ç±»å‹" class="headerlink" title="2. æµ®ç‚¹ç±»å‹"></a>2. <strong>æµ®ç‚¹ç±»å‹</strong></h3><h4 id="å¸¸è§çš„æµ®ç‚¹ç±»å‹"><a href="#å¸¸è§çš„æµ®ç‚¹ç±»å‹" class="headerlink" title="å¸¸è§çš„æµ®ç‚¹ç±»å‹"></a>å¸¸è§çš„æµ®ç‚¹ç±»å‹</h4><ul><li><code>float</code>ï¼šå•ç²¾åº¦æµ®ç‚¹æ•°</li><li><code>double</code>ï¼šåŒç²¾åº¦æµ®ç‚¹æ•°</li><li><code>long double</code>ï¼šæ‰©å±•ç²¾åº¦æµ®ç‚¹æ•°</li></ul><h4 id="è·å–æµ®ç‚¹ç±»å‹çš„æç«¯å€¼"><a href="#è·å–æµ®ç‚¹ç±»å‹çš„æç«¯å€¼" class="headerlink" title="è·å–æµ®ç‚¹ç±»å‹çš„æç«¯å€¼"></a>è·å–æµ®ç‚¹ç±»å‹çš„æç«¯å€¼</h4><p>æµ®ç‚¹ç±»å‹åŒæ ·å¯ä»¥ä½¿ç”¨ <code>std::numeric_limits</code> æ¥è·å–å…¶æç«¯å€¼ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è·å–ç‰¹æ®Šå€¼å¦‚æ— ç©·å¤§å’Œéæ•°å€¼ï¼ˆNaNï¼‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;limits&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;float çš„æœ€å°å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">min</span>() &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;float çš„æœ€å¤§å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">max</span>() &lt;&lt; std::endl;<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;double çš„æœ€å°å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">double</span>&gt;::<span class="hljs-built_in">min</span>() &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;double çš„æœ€å¤§å€¼: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">double</span>&gt;::<span class="hljs-built_in">max</span>() &lt;&lt; std::endl;<br>    <br>    <span class="hljs-comment">// ç‰¹æ®Šå€¼</span><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;float æ— ç©·å¤§: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">infinity</span>() &lt;&lt; std::endl;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;float NaNï¼ˆéæ•°å€¼ï¼‰: &quot;</span> &lt;&lt; std::numeric_limits&lt;<span class="hljs-type">float</span>&gt;::<span class="hljs-built_in">quiet_NaN</span>() &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æµ®ç‚¹ç±»å‹çš„æç«¯å€¼æ€»ç»“"><a href="#æµ®ç‚¹ç±»å‹çš„æç«¯å€¼æ€»ç»“" class="headerlink" title="æµ®ç‚¹ç±»å‹çš„æç«¯å€¼æ€»ç»“"></a>æµ®ç‚¹ç±»å‹çš„æç«¯å€¼æ€»ç»“</h4><ul><li><code>std::numeric_limits&lt;float&gt;::min()</code>ï¼šè¿”å› <code>float</code> ç±»å‹çš„æœ€å°æ­£æ•°ï¼ˆæ³¨æ„æ˜¯æ­£æ•°ï¼‰ã€‚</li><li><code>std::numeric_limits&lt;float&gt;::max()</code>ï¼šè¿”å› <code>float</code> ç±»å‹çš„æœ€å¤§å€¼ã€‚</li><li><code>std::numeric_limits&lt;float&gt;::lowest()</code>ï¼šè¿”å› <code>float</code> ç±»å‹çš„è´Ÿæ•°æœ€å°å€¼ã€‚</li><li><code>std::numeric_limits&lt;float&gt;::infinity()</code>ï¼šè¿”å›æ­£æ— ç©·å¤§ã€‚</li><li><code>std::numeric_limits&lt;float&gt;::quiet_NaN()</code>ï¼šè¿”å›éæ•°å€¼ï¼ˆNaNï¼‰ã€‚</li></ul><p>æµ®ç‚¹æ•°çš„è¿™äº›å€¼é€šå¸¸ç”¨äºæ•°å€¼ç®—æ³•ä¸­çš„è¾¹ç•Œæ£€æµ‹ï¼Œå°¤å…¶æ˜¯ <code>NaN</code> å’Œ <code>infinity</code>ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥æ£€æµ‹éæ³•æ“ä½œæˆ–æº¢å‡ºæƒ…å†µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (result == std::numeric_limits&lt;<span class="hljs-type">double</span>&gt;::<span class="hljs-built_in">infinity</span>()) &#123;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Overflow detected!&quot;</span> &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-å¸ƒå°”ç±»å‹"><a href="#3-å¸ƒå°”ç±»å‹" class="headerlink" title="3. å¸ƒå°”ç±»å‹"></a>3. <strong>å¸ƒå°”ç±»å‹</strong></h3><p>å¸ƒå°”ç±»å‹çš„æç«¯å€¼ç›¸å¯¹ç®€å•ï¼Œå®ƒåªæœ‰ä¸¤ä¸ªå€¼ï¼š</p><ul><li><code>true</code></li><li><code>false</code></li></ul><h3 id="4-ç‰¹æ®Šçš„æç«¯å€¼"><a href="#4-ç‰¹æ®Šçš„æç«¯å€¼" class="headerlink" title="4. ç‰¹æ®Šçš„æç«¯å€¼"></a>4. <strong>ç‰¹æ®Šçš„æç«¯å€¼</strong></h3><h4 id="nullptr"><a href="#nullptr" class="headerlink" title="nullptr"></a><code>nullptr</code></h4><p>å¯¹äºæŒ‡é’ˆç±»å‹ï¼Œ<code>nullptr</code> è¡¨ç¤ºç©ºæŒ‡é’ˆï¼Œä½œä¸ºæŒ‡é’ˆçš„æç«¯å€¼ä½¿ç”¨ã€‚åœ¨ C++11 ä¹‹å‰ï¼Œé€šå¸¸ä½¿ç”¨ <code>NULL</code>ï¼Œä½† <code>nullptr</code> æ˜¯æ›´æ¨èçš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå…·æœ‰æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span>* ptr = <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// åˆå§‹åŒ–ä¸ºç©ºæŒ‡é’ˆ</span><br></code></pre></td></tr></table></figure><h4 id="size-t"><a href="#size-t" class="headerlink" title="size_t"></a><code>size_t</code></h4><p><code>size_t</code> æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå¸¸ç”¨äºè¡¨ç¤ºæ•°ç»„ä¸‹æ ‡æˆ–å¤§å°ã€‚å®ƒçš„æç«¯å€¼å¯ä»¥é€šè¿‡ <code>std::numeric_limits&lt;size_t&gt;::max()</code> è·å–ã€‚é€šå¸¸ç”¨æ¥è¡¨ç¤ºä¸å­˜åœ¨çš„ç´¢å¼•å€¼ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">size_t</span> invalidIndex = std::numeric_limits&lt;<span class="hljs-type">size_t</span>&gt;::<span class="hljs-built_in">max</span>();<br></code></pre></td></tr></table></figure><h3 id="5-å¦‚ä½•ä½¿ç”¨æç«¯å€¼"><a href="#5-å¦‚ä½•ä½¿ç”¨æç«¯å€¼" class="headerlink" title="5. å¦‚ä½•ä½¿ç”¨æç«¯å€¼"></a>5. <strong>å¦‚ä½•ä½¿ç”¨æç«¯å€¼</strong></h3><p>æç«¯å€¼åœ¨å¾ˆå¤šæƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼š</p><h4 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1. åˆå§‹åŒ–"></a>1. <strong>åˆå§‹åŒ–</strong></h4><p>åˆå§‹åŒ–å˜é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æœ€å°å€¼å’Œæœ€å¤§å€¼ä½œä¸ºèµ·å§‹æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯»æ‰¾æœ€å¤§å€¼æ—¶ï¼Œå°†å˜é‡åˆå§‹åŒ–ä¸ºæœ€å°å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> maxValue = std::numeric_limits&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">min</span>();<br></code></pre></td></tr></table></figure><h4 id="2-è¾¹ç•Œæ£€æµ‹"><a href="#2-è¾¹ç•Œæ£€æµ‹" class="headerlink" title="2. è¾¹ç•Œæ£€æµ‹"></a>2. <strong>è¾¹ç•Œæ£€æµ‹</strong></h4><p>é€šè¿‡åˆ¤æ–­å€¼æ˜¯å¦æ¥è¿‘æœ€å¤§æˆ–æœ€å°å€¼ï¼Œå¯ä»¥æ£€æµ‹å‡ºæº¢å‡ºã€æ— æ•ˆè¾“å…¥ç­‰å¼‚å¸¸æƒ…å†µã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> (someValue &gt; std::numeric_limits&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">max</span>()) &#123;<br>    <span class="hljs-comment">// å¤„ç†æº¢å‡º</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-æµ®ç‚¹æ•°å¼‚å¸¸å¤„ç†"><a href="#3-æµ®ç‚¹æ•°å¼‚å¸¸å¤„ç†" class="headerlink" title="3. æµ®ç‚¹æ•°å¼‚å¸¸å¤„ç†"></a>3. <strong>æµ®ç‚¹æ•°å¼‚å¸¸å¤„ç†</strong></h4><p>åœ¨æµ®ç‚¹æ•°è¿ç®—ä¸­ï¼Œæ£€æµ‹ <code>NaN</code> å’Œæ— ç©·å¤§æ˜¯å¸¸è§çš„éœ€æ±‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">double</span> result = <span class="hljs-built_in">someComputation</span>();<br><span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">isnan</span>(result)) &#123;<br>    <span class="hljs-comment">// å¤„ç†éæ•°å€¼æƒ…å†µ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>C++ æä¾›äº†æ ‡å‡†çš„ <code>std::numeric_limits</code> ç±»æ¥è·å–å„ç§æ•°æ®ç±»å‹çš„æç«¯å€¼ï¼ŒåŒ…æ‹¬æ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹ã€æŒ‡é’ˆç­‰ã€‚</li><li>è¿™äº›æç«¯å€¼å¯¹äºè¾¹ç•Œæ£€æŸ¥ã€åˆå§‹åŒ–å’Œå¼‚å¸¸å¤„ç†éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¸®åŠ©ç¼–å†™æ›´å¥å£®çš„ä»£ç ã€‚</li><li>äº†è§£å¹¶å–„ç”¨è¿™äº›æç«¯å€¼å¯¹äºç¼–å†™å¥å£®çš„ç®—æ³•å’Œå¤„ç†æç«¯æƒ…å†µéå¸¸é‡è¦ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]ä¼˜å…ˆé˜Ÿåˆ—</title>
    <link href="/2024/10/05/C-%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/"/>
    <url>/2024/10/05/C-%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/</url>
    
    <content type="html"><![CDATA[<p>C++ ä¸­çš„ <strong>ä¼˜å…ˆé˜Ÿåˆ—</strong>ï¼ˆ<code>priority_queue</code>ï¼‰æ˜¯ä¸€ä¸ªå®¹å™¨é€‚é…å™¨ï¼Œç”¨æ¥ç®¡ç†å¸¦ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œå†…éƒ¨é‡‡ç”¨<strong>å †</strong>ï¼ˆé€šå¸¸æ˜¯<strong>äºŒå‰å †</strong>ï¼‰æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºã€‚ä¼˜å…ˆé˜Ÿåˆ—ä¿è¯æ¯æ¬¡å–å‡ºçš„å…ƒç´ æ˜¯é˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚</p><span id="more"></span><h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. åŸºæœ¬æ¦‚å¿µ"></a>1. <strong>åŸºæœ¬æ¦‚å¿µ</strong></h3><p>ä¼˜å…ˆé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå…ƒç´ ä¹‹é—´æœ‰ä¼˜å…ˆçº§å…³ç³»ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„å…ƒç´ æ˜¯<strong>å¤§é¡¶å †</strong>ï¼Œå³æ¯æ¬¡å‡ºé˜Ÿçš„å…ƒç´ æ˜¯ä¼˜å…ˆçº§æœ€é«˜ï¼ˆå€¼æœ€å¤§ï¼‰çš„å…ƒç´ ã€‚</p><h3 id="2-å¸¸ç”¨æ“ä½œ"><a href="#2-å¸¸ç”¨æ“ä½œ" class="headerlink" title="2. å¸¸ç”¨æ“ä½œ"></a>2. <strong>å¸¸ç”¨æ“ä½œ</strong></h3><p>C++ æä¾›äº†æ ‡å‡†åº“ä¸­çš„ <code>priority_queue</code> ç±»ï¼Œå¸¸è§çš„æ“ä½œå¦‚ä¸‹ï¼š</p><ul><li><strong><code>push()</code></strong>: å°†å…ƒç´ æ’å…¥é˜Ÿåˆ—ã€‚</li><li><strong><code>pop()</code></strong>: ç§»é™¤é˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚</li><li><strong><code>top()</code></strong>: è¿”å›é˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œä½†ä¸ç§»é™¤ã€‚</li><li><strong><code>empty()</code></strong>: åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚</li><li><strong><code>size()</code></strong>: è¿”å›é˜Ÿåˆ—ä¸­å…ƒç´ çš„æ•°é‡ã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::priority_queue&lt;<span class="hljs-type">int</span>&gt; pq;<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">10</span>);<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">30</span>);<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">20</span>);<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Top element: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡º 30</span><br>    pq.<span class="hljs-built_in">pop</span>();<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Top element after pop: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡º 20</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°"><a href="#3-è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°" class="headerlink" title="3. è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°"></a>3. <strong>è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°</strong></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>priority_queue</code> æ˜¯ä¸€ä¸ª<strong>å¤§é¡¶å †</strong>ï¼Œå³æœ€å¤§çš„å…ƒç´ ä¼˜å…ˆå‡ºé˜Ÿã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰ä¼˜å…ˆçº§ï¼ˆä¾‹å¦‚å®ç°<strong>å°é¡¶å †</strong>æˆ–è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’æ¯”è¾ƒå‡½æ•°æˆ–è€…ä»¿å‡½æ•°æ¥å®ç°ã€‚</p><ul><li><strong>å°é¡¶å †å®ç°</strong>ï¼ˆä½¿ç”¨å†…ç½®æ¯”è¾ƒå™¨ <code>std::greater&lt;T&gt;</code>ï¼‰ï¼š</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::priority_queue&lt;<span class="hljs-type">int</span>, std::vector&lt;<span class="hljs-type">int</span>&gt;, std::greater&lt;<span class="hljs-type">int</span>&gt;&gt; pq;<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">10</span>);<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">30</span>);<br>    pq.<span class="hljs-built_in">push</span>(<span class="hljs-number">20</span>);<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Top element: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>() &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡º 10</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>è‡ªå®šä¹‰ç»“æ„ä½“çš„æ¯”è¾ƒ</strong>ï¼š</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Task</span> &#123;<br>    <span class="hljs-type">int</span> priority;<br>    std::string name;<br>    <br>    <span class="hljs-comment">// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°</span><br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-type">const</span> Task&amp; other) <span class="hljs-type">const</span> &#123;<br>        <span class="hljs-keyword">return</span> priority &lt; other.priority;  <span class="hljs-comment">// ä¼˜å…ˆçº§ä½çš„ä»»åŠ¡æ”¾åœ¨å‰é¢</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::priority_queue&lt;Task&gt; pq;<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Task1&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Task3&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Task2&quot;</span>&#125;);<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Top task: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().name &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡º Task3</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>ä»¿å‡½æ•°</strong></li></ul><p>åœ¨ C++ ä¸­ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨å†…ç½®çš„æ¯”è¾ƒå‡½æ•°ï¼ˆå¦‚ <code>std::greater&lt;T&gt;</code>ï¼‰ï¼Œè¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„<strong>ä»¿å‡½æ•°</strong>æ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—çš„è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯ä»¿å‡½æ•°ï¼Ÿ</strong></p><p><strong>ä»¿å‡½æ•°</strong>ï¼ˆFunctorï¼‰æ˜¯æŒ‡åƒå‡½æ•°ä¸€æ ·ä½¿ç”¨çš„å¯¹è±¡ã€‚å®ƒæ˜¯é€šè¿‡åœ¨ç±»ä¸­é‡è½½ <code>operator()</code> è¿ç®—ç¬¦å®ç°çš„ã€‚å½“ä¸€ä¸ªå¯¹è±¡å®ç°äº†è¿™ä¸ªè¿ç®—ç¬¦ï¼Œå®ƒå°±å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ã€‚ä»¿å‡½æ•°çš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥ä¿å­˜çŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¼˜å…ˆé˜Ÿåˆ—ç­‰æ•°æ®ç»“æ„ä¸­æä¾›çµæ´»çš„è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘ã€‚</p><p><strong>ä½¿ç”¨ä»¿å‡½æ•°å®ç°è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘</strong></p><p>åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¿å‡½æ•°æ¥è‡ªå®šä¹‰ä¼˜å…ˆçº§çš„æ¯”è¾ƒè§„åˆ™ï¼Œä¾‹å¦‚å¯ä»¥æ ¹æ®æŸä¸ªå±æ€§æ’åºï¼Œæˆ–è€…å¤æ‚çš„å¤šå±‚æ¬¡æ¯”è¾ƒã€‚</p><p><strong>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ä»¿å‡½æ•°æ’åº</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»»åŠ¡ç»“æ„ä½“ <code>Task</code>ï¼Œå…¶ä¸­æœ‰ <code>priority</code> å’Œ <code>name</code> ä¸¤ä¸ªæˆå‘˜ã€‚æˆ‘ä»¬å¸Œæœ›æ ¹æ® <code>priority</code> æ¥å®šä¹‰ä¼˜å…ˆé˜Ÿåˆ—çš„é¡ºåºï¼Œä½†æˆ‘ä»¬æƒ³è¦ç”¨ä»¿å‡½æ•°è€Œä¸æ˜¯ç»“æ„ä½“ä¸­çš„ <code>&lt;</code> è¿ç®—ç¬¦æ¥è¿›è¡Œæ¯”è¾ƒã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// ä»»åŠ¡ç»“æ„ä½“</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Task</span> &#123;<br>    <span class="hljs-type">int</span> priority;<br>    std::string name;<br>&#125;;<br><br><span class="hljs-comment">// è‡ªå®šä¹‰ä»¿å‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒ Task çš„ä¼˜å…ˆçº§</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">TaskCompare</span> &#123;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-type">const</span> Task&amp; t1, <span class="hljs-type">const</span> Task&amp; t2)</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> t<span class="hljs-number">1.</span>priority &lt; t<span class="hljs-number">2.</span>priority;  <span class="hljs-comment">// ä¼˜å…ˆçº§ä½çš„ä»»åŠ¡æ’åœ¨é˜Ÿåˆ—åé¢</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ä»¿å‡½æ•° TaskCompare ä½œä¸ºä¼˜å…ˆé˜Ÿåˆ—çš„æ¯”è¾ƒå‡½æ•°</span><br>    std::priority_queue&lt;Task, std::vector&lt;Task&gt;, TaskCompare&gt; pq;<br><br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Task1&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Task3&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Task2&quot;</span>&#125;);<br><br>    <span class="hljs-keyword">while</span> (!pq.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Top task: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().name &lt;&lt; <span class="hljs-string">&quot; with priority &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().priority &lt;&lt; std::endl;<br>        pq.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä»¿å‡½æ•°ä¸å‡½æ•°æŒ‡é’ˆçš„åŒºåˆ«</strong></p><p>ä»¿å‡½æ•°ä¸ä¼ ç»Ÿçš„å‡½æ•°æŒ‡é’ˆç›¸æ¯”æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li><strong>çŠ¶æ€ä¿æŒ</strong>ï¼šä»¿å‡½æ•°å¯ä»¥æºå¸¦çŠ¶æ€ï¼ˆé€šè¿‡æˆå‘˜å˜é‡ï¼‰ï¼Œè€Œå‡½æ•°æŒ‡é’ˆåªèƒ½è°ƒç”¨ä¸å¸¦çŠ¶æ€çš„å‡½æ•°ã€‚</li><li><strong>å†…è”ä¼˜åŒ–</strong>ï¼šç¼–è¯‘å™¨é€šå¸¸èƒ½å¤Ÿå°†ä»¿å‡½æ•°å†…è”ï¼Œä»è€Œæé«˜è¿è¡Œæ—¶æ•ˆç‡ï¼Œè€Œå‡½æ•°æŒ‡é’ˆçš„è°ƒç”¨éœ€è¦é€šè¿‡æŒ‡é’ˆé—´æ¥è°ƒç”¨ï¼Œæ•ˆç‡è¾ƒä½ã€‚</li></ol><p><strong>ç¤ºä¾‹ï¼šå¸¦çŠ¶æ€çš„ä»¿å‡½æ•°</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¿å‡½æ•°ä¿å­˜ä¸€äº›é¢å¤–çš„çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰ä¼˜å…ˆé˜Ÿåˆ—çš„é¡ºåºï¼ŒåŒæ—¶æ ¹æ®ä¸€ä¸ªç»™å®šçš„é˜ˆå€¼æ¥åŠ¨æ€å†³å®šä»»åŠ¡çš„ä¼˜å…ˆçº§æ¯”è¾ƒã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// ä»»åŠ¡ç»“æ„ä½“</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Task</span> &#123;<br>    <span class="hljs-type">int</span> priority;<br>    std::string name;<br>&#125;;<br><br><span class="hljs-comment">// å¸¦çŠ¶æ€çš„ä»¿å‡½æ•°</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DynamicTaskCompare</span> &#123;<br>    <span class="hljs-type">int</span> threshold;  <span class="hljs-comment">// æ¯”è¾ƒä»»åŠ¡ä¼˜å…ˆçº§çš„é˜ˆå€¼</span><br>    <br>    <span class="hljs-built_in">DynamicTaskCompare</span>(<span class="hljs-type">int</span> t) : <span class="hljs-built_in">threshold</span>(t) &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(<span class="hljs-type">const</span> Task&amp; t1, <span class="hljs-type">const</span> Task&amp; t2)</span> <span class="hljs-type">const</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (t<span class="hljs-number">1.</span>priority &gt;= threshold &amp;&amp; t<span class="hljs-number">2.</span>priority &lt; threshold) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// t1 ä¼˜å…ˆ</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (t<span class="hljs-number">1.</span>priority &lt; threshold &amp;&amp; t<span class="hljs-number">2.</span>priority &gt;= threshold) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// t2 ä¼˜å…ˆ</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> t<span class="hljs-number">1.</span>priority &lt; t<span class="hljs-number">2.</span>priority;  <span class="hljs-comment">// ä¼˜å…ˆçº§å¤§çš„ä»»åŠ¡æ’åœ¨å‰é¢</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// ä½¿ç”¨å¸¦çŠ¶æ€çš„ä»¿å‡½æ•°è¿›è¡Œä¼˜å…ˆçº§æ¯”è¾ƒ</span><br>    std::priority_queue&lt;Task, std::vector&lt;Task&gt;, DynamicTaskCompare&gt; <span class="hljs-built_in">pq</span>(<span class="hljs-built_in">DynamicTaskCompare</span>(<span class="hljs-number">2</span>));<br>    <br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Task1&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Task3&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Task2&quot;</span>&#125;);<br><br>    <span class="hljs-keyword">while</span> (!pq.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Top task: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().name &lt;&lt; <span class="hljs-string">&quot; with priority &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().priority &lt;&lt; std::endl;<br>        pq.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>DynamicTaskCompare</code> ä»¿å‡½æ•°é€šè¿‡ <code>threshold</code> è¿™ä¸ªçŠ¶æ€æ¥åŠ¨æ€å†³å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ã€‚è¿™ä¸ªç‰¹æ€§åœ¨æŸäº›åŠ¨æ€æ’åºåœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p><strong>ä»¿å‡½æ•°ä¸ Lambda è¡¨è¾¾å¼</strong></p><p>C++11 å¼•å…¥äº† <strong>Lambda è¡¨è¾¾å¼</strong>ï¼Œå®ƒå¯ä»¥æä¾›ç±»ä¼¼ä»¿å‡½æ•°çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä»£ç æ›´åŠ ç®€æ´ã€‚å¦‚æœæ¯”è¾ƒé€»è¾‘éå¸¸ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼ä»£æ›¿ä»¿å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Task</span> &#123;<br>    <span class="hljs-type">int</span> priority;<br>    std::string name;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">auto</span> compare = [](<span class="hljs-type">const</span> Task&amp; t1, <span class="hljs-type">const</span> Task&amp; t2) &#123;<br>        <span class="hljs-keyword">return</span> t<span class="hljs-number">1.</span>priority &lt; t<span class="hljs-number">2.</span>priority;  <span class="hljs-comment">// ä¼˜å…ˆçº§ä½çš„ä»»åŠ¡æ’åœ¨é˜Ÿåˆ—åé¢</span><br>    &#125;;<br><br>    std::priority_queue&lt;Task, std::vector&lt;Task&gt;, <span class="hljs-keyword">decltype</span>(compare)&gt; <span class="hljs-built_in">pq</span>(compare);<br><br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Task1&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">3</span>, <span class="hljs-string">&quot;Task3&quot;</span>&#125;);<br>    pq.<span class="hljs-built_in">push</span>(&#123;<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Task2&quot;</span>&#125;);<br><br>    <span class="hljs-keyword">while</span> (!pq.<span class="hljs-built_in">empty</span>()) &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Top task: &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().name &lt;&lt; <span class="hljs-string">&quot; with priority &quot;</span> &lt;&lt; pq.<span class="hljs-built_in">top</span>().priority &lt;&lt; std::endl;<br>        pq.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-åº•å±‚å®ç°"><a href="#4-åº•å±‚å®ç°" class="headerlink" title="4. åº•å±‚å®ç°"></a>4. <strong>åº•å±‚å®ç°</strong></h3><p><code>priority_queue</code> çš„åº•å±‚å®ç°é€šå¸¸ä¾èµ–äº<strong>å †</strong>ï¼Œå…·ä½“æ¥è¯´æ˜¯ <strong>äºŒå‰å †</strong>ã€‚C++ æ ‡å‡†åº“ä½¿ç”¨ <strong><code>std::vector</code></strong> ä½œä¸ºåº•å±‚å­˜å‚¨å®¹å™¨æ¥ä¿å­˜å…ƒç´ ï¼Œå¹¶é€šè¿‡å †çš„æ“ä½œæ¥ä¿æŒä¼˜å…ˆé˜Ÿåˆ—çš„æ€§è´¨ã€‚</p><ul><li><strong>å †æ“ä½œ</strong>ï¼š<ul><li>æ’å…¥å…ƒç´ æ—¶ï¼Œä¼šè°ƒç”¨å †çš„ <strong>ä¸Šæµ®æ“ä½œ</strong>ï¼Œç¡®ä¿æ–°å…ƒç´ æ’å…¥åå †çš„ç»“æ„ä¿æŒå®Œæ•´ã€‚</li><li>åˆ é™¤æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…ƒç´ æ—¶ï¼Œä¼šè°ƒç”¨ <strong>ä¸‹æ²‰æ“ä½œ</strong>ï¼Œå°†å †é¡¶å…ƒç´ ä¸å­èŠ‚ç‚¹äº¤æ¢ï¼Œç¡®ä¿å †çš„æœ‰åºæ€§ã€‚</li></ul></li></ul><p>C++ æ ‡å‡†åº“æä¾›äº†ç”¨äºå †æ“ä½œçš„ç®—æ³•ï¼š</p><ul><li><p><strong><code>std::make_heap</code></strong>: å°†èŒƒå›´å†…çš„å…ƒç´ æ„é€ æˆå †ã€‚</p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šå°†ä¸€ä¸ªæ— åºçš„èŒƒå›´è½¬æ¢ä¸ºä¸€ä¸ªå †ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåˆ›å»ºä¸€ä¸ª <strong>æœ€å¤§å †</strong>ï¼ˆå³å †é¡¶æ˜¯æœ€å¤§å€¼ï¼‰ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’è‡ªå®šä¹‰æ¯”è¾ƒå™¨åˆ›å»ºæœ€å°å †æˆ–å…¶ä»–ç±»å‹çš„å †ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">make_heap</span><span class="hljs-params">(RandomIt first, RandomIt last)</span></span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>å‚æ•°</strong>ï¼š</p><p><code>first</code> å’Œ <code>last</code> æŒ‡å‘èŒƒå›´çš„èµ·å§‹å’Œç»“æŸï¼Œè¡¨ç¤ºè¦æ„å»ºå †çš„èŒƒå›´ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::vector&lt;<span class="hljs-type">int</span>&gt; v = &#123;<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>&#125;;<br>    <br>    <span class="hljs-comment">// æ„å»ºä¸€ä¸ªæœ€å¤§å †</span><br>    std::<span class="hljs-built_in">make_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Max heap: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : v) &#123;<br>        std::cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;  <span class="hljs-comment">// è¾“å‡º: 9 6 5 5 1 4 2 1 3</span><br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong><code>std::push_heap</code></strong>: å‘å †ä¸­æ’å…¥å…ƒç´ ã€‚</p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šåœ¨ä¸€ä¸ªå †ä¸­æ’å…¥æ–°å…ƒç´ ï¼ˆå³å°†æ–°å…ƒç´ æ·»åŠ åˆ°å®¹å™¨æœ«å°¾åï¼Œé€šè¿‡ <code>push_heap</code> è°ƒæ•´å®¹å™¨ä½¿å…¶é‡æ–°æˆä¸ºåˆæ³•çš„å †ç»“æ„ï¼‰ã€‚ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å…ˆæŠŠæ–°å…ƒç´ æ‰‹åŠ¨æ’å…¥åˆ°å®¹å™¨æœ«å°¾ï¼Œå†è°ƒç”¨ <code>push_heap</code>ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_heap</span><span class="hljs-params">(RandomIt first, RandomIt last)</span></span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>å‚æ•°</strong>ï¼š</p><p><code>first</code> å’Œ <code>last</code> æŒ‡å‘å †çš„èµ·å§‹å’Œç»“æŸï¼Œå…¶ä¸­ <code>last</code> ä¸ºæ–°æ’å…¥çš„å…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::vector&lt;<span class="hljs-type">int</span>&gt; v = &#123;<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>&#125;;<br>    std::<span class="hljs-built_in">make_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());<br>    <br>    <span class="hljs-comment">// ç§»é™¤å †é¡¶å…ƒç´ </span><br>    std::<span class="hljs-built_in">pop_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());  <span class="hljs-comment">// 9 è¢«ç§»åŠ¨åˆ°æœ«å°¾</span><br>    v.<span class="hljs-built_in">pop_back</span>();  <span class="hljs-comment">// å®é™…ç§»é™¤è¯¥å…ƒç´ </span><br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Heap after pop: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : v) &#123;<br>        std::cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;  <span class="hljs-comment">// è¾“å‡º: 6 5 5 3 1 4 2 1</span><br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong><code>std::pop_heap</code></strong>: ä»å †ä¸­åˆ é™¤å…ƒç´ ã€‚</p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šå°†å †é¡¶å…ƒç´ ç§»åˆ°å®¹å™¨çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒå…¶ä»–å…ƒç´ çš„å †ç»“æ„ï¼ˆå³é‡æ–°è°ƒæ•´å‰©ä½™å…ƒç´ æˆä¸ºä¸€ä¸ªåˆæ³•çš„å †ï¼‰ã€‚æ³¨æ„ï¼Œ<code>pop_heap</code> åªæ˜¯å°†å †é¡¶å…ƒç´ ç§»åˆ°æœ«å°¾ï¼Œä¸ä¼šä»å®¹å™¨ä¸­ç§»é™¤å®ƒï¼Œå¿…é¡»æ‰‹åŠ¨ä½¿ç”¨ <code>container.pop_back()</code>ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">pop_heap</span><span class="hljs-params">(RandomIt first, RandomIt last)</span></span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>å‚æ•°</strong>ï¼š</p><p><code>first</code> å’Œ <code>last</code> æŒ‡å‘å †çš„èµ·å§‹å’Œç»“æŸï¼Œ<code>last</code> æŒ‡å‘çš„å…ƒç´ å°†æ˜¯æ–°å †é¡¶å…ƒç´ åçš„ç¬¬ä¸€ä¸ªéå †å…ƒç´ ï¼ˆå³æœ«å°¾å…ƒç´ ï¼‰ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::vector&lt;<span class="hljs-type">int</span>&gt; v = &#123;<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>&#125;;<br>    std::<span class="hljs-built_in">make_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());<br>    <br>    <span class="hljs-comment">// ç§»é™¤å †é¡¶å…ƒç´ </span><br>    std::<span class="hljs-built_in">pop_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());  <span class="hljs-comment">// 9 è¢«ç§»åŠ¨åˆ°æœ«å°¾</span><br>    v.<span class="hljs-built_in">pop_back</span>();  <span class="hljs-comment">// å®é™…ç§»é™¤è¯¥å…ƒç´ </span><br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Heap after pop: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : v) &#123;<br>        std::cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;  <span class="hljs-comment">// è¾“å‡º: 6 5 5 3 1 4 2 1</span><br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong><code>std::sort_heap</code></strong>: å¯¹å †ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚</p><ul><li><p><strong>åŠŸèƒ½</strong>ï¼šå¯¹ä¸€ä¸ªå †è¿›è¡Œæ’åºã€‚æ³¨æ„ï¼Œè°ƒç”¨ <code>sort_heap</code> åï¼Œå †ç»“æ„å°†è¢«ç ´åï¼Œä½†æ•°ç»„ä¼šæŒ‰å‡åºæ’åºï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚è¿™å°±æ˜¯å †æ’åºçš„å…³é”®æ­¥éª¤ã€‚</p></li><li><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">sort_heap</span><span class="hljs-params">(RandomIt first, RandomIt last)</span></span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>å‚æ•°</strong>ï¼š</p><p><code>first</code> å’Œ <code>last</code> æŒ‡å‘å †çš„èµ·å§‹å’Œç»“æŸã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    std::vector&lt;<span class="hljs-type">int</span>&gt; v = &#123;<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>&#125;;<br>    std::<span class="hljs-built_in">make_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());<br>    <br>    <span class="hljs-comment">// å¯¹å †è¿›è¡Œæ’åº</span><br>    std::<span class="hljs-built_in">sort_heap</span>(v.<span class="hljs-built_in">begin</span>(), v.<span class="hljs-built_in">end</span>());<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Sorted heap: &quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : v) &#123;<br>        std::cout &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;  <span class="hljs-comment">// è¾“å‡º: 1 1 2 3 4 5 5 6 9</span><br>    &#125;<br>    std::cout &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="5-æ€§èƒ½åˆ†æ"><a href="#5-æ€§èƒ½åˆ†æ" class="headerlink" title="5. æ€§èƒ½åˆ†æ"></a>5. <strong>æ€§èƒ½åˆ†æ</strong></h3><p><code>priority_queue</code> çš„æ—¶é—´å¤æ‚åº¦ä¸å…¶åº•å±‚å †å®ç°ç›´æ¥ç›¸å…³ã€‚ç”±äºä½¿ç”¨å †ç»“æ„ï¼Œä»¥ä¸‹æ˜¯å¸¸è§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ï¼š</p><ul><li><strong>æ’å…¥å…ƒç´ ï¼ˆpushï¼‰</strong>: O(log n)ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œä¸Šæµ®æ“ä½œã€‚</li><li><strong>å–æœ€å¤§&#x2F;æœ€å°å…ƒç´ ï¼ˆtopï¼‰</strong>: O(1)ï¼Œåªéœ€è¿”å›å †é¡¶å…ƒç´ ã€‚</li><li><strong>åˆ é™¤æœ€å¤§&#x2F;æœ€å°å…ƒç´ ï¼ˆpopï¼‰</strong>: O(log n)ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œä¸‹æ²‰æ“ä½œã€‚</li></ul><p>ç”±äº <code>priority_queue</code> æ˜¯åŸºäºäºŒå‰å †çš„å®ç°ï¼Œå› æ­¤å®ƒå…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼Œé€‚åˆç”¨äºéœ€è¦é¢‘ç¹æ’å…¥å’Œåˆ é™¤æœ€å¤§ï¼ˆæœ€å°ï¼‰å…ƒç´ çš„åœºæ™¯ã€‚</p><p>åœ¨åˆ†æ C++ ä¸­ä¸å †æ“ä½œç›¸å…³çš„ <code>make_heap</code>ã€<code>pop_heap</code>ã€<code>push_heap</code> å’Œ <code>sort_heap</code> å‡½æ•°çš„æ€§èƒ½æ—¶ï¼Œä¸»è¦è€ƒè™‘å †çš„æ€§è´¨å’Œè¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ã€‚å †æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œé€šå¸¸ä½¿ç”¨æ•°ç»„æ¥å®ç°ï¼Œå †çš„é«˜åº¦æ˜¯ <code>O(log n)</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯å †ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</p><ol><li><strong><code>make_heap</code> çš„æ€§èƒ½åˆ†æ</strong></li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>make_heap</code> å‡½æ•°å°†ä¸€ä¸ªæ— åºçš„åºåˆ—è½¬åŒ–ä¸ºä¸€ä¸ªåˆæ³•çš„å †ã€‚</li><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code>O(n)</code>ã€‚</li></ul><p>è™½ç„¶æ¯æ¬¡æ’å…¥ä¸€ä¸ªå…ƒç´ åˆ°å †çš„å¤æ‚åº¦ä¸º <code>O(log n)</code>ï¼Œçœ‹ä¼¼å°† <code>n</code> ä¸ªå…ƒç´ æ’å…¥åˆ°å †ä¸­ä¼šå¯¼è‡´ <code>O(n log n)</code> çš„æ—¶é—´å¤æ‚åº¦ã€‚ç„¶è€Œï¼Œ<code>make_heap</code> ä½¿ç”¨äº†ä¸€ç§è‡ªåº•å‘ä¸Šçš„å»ºå †æ–¹æ³•ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code>ã€‚</p><p><strong>åˆ†æ</strong>ï¼š</p><ul><li>è‡ªé¡¶å‘ä¸‹æ’å…¥çš„å¤æ‚åº¦ä¸º <code>O(n log n)</code>ï¼Œä½† <code>make_heap</code> é‡‡ç”¨çš„æ˜¯è‡ªåº•å‘ä¸Šçš„å»ºå †æ–¹æ³•ï¼Œå®ƒä»å †çš„æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œé€æ­¥è°ƒæ•´å­å †çš„é¡ºåºï¼Œæœ€ç»ˆæ„å»ºå‡ºä¸€ä¸ªå®Œæ•´çš„å †ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹çš„è°ƒæ•´æœ€å¤šç§»åŠ¨ <code>log n</code> æ­¥ï¼Œä½†è¾ƒä½å±‚çš„èŠ‚ç‚¹æ•°é‡å¤šï¼Œä¸”è°ƒæ•´æ‰€éœ€çš„ç§»åŠ¨æ­¥æ•°è¾ƒå°‘ï¼Œå› æ­¤æ•´ä½“å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œå³ <code>O(n)</code>ã€‚</li></ul><ol start="2"><li><strong><code>pop_heap</code> çš„æ€§èƒ½åˆ†æ</strong></li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>pop_heap</code> å°†å †é¡¶å…ƒç´ ï¼ˆæœ€å¤§æˆ–æœ€å°å€¼ï¼‰ç§»åŠ¨åˆ°åºåˆ—çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒå‰©ä½™åºåˆ—çš„å †ç»“æ„ã€‚</li><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code>O(log n)</code>ã€‚</li></ul><p><strong>åˆ†æ</strong>ï¼š</p><ul><li><code>pop_heap</code> å…ˆå°†å †é¡¶å…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åå¯¹äº¤æ¢åçš„å †ï¼ˆé™¤å»æœ€åä¸€ä¸ªå…ƒç´ ï¼‰è¿›è¡Œä¸‹æ²‰æ“ä½œï¼ˆå³è°ƒæ•´å †ï¼‰ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹é€å±‚å‘ä¸‹è°ƒæ•´ï¼Œä»¥ä¿æŒå †çš„æ€§è´¨ã€‚</li><li>ä¸‹æ²‰æ“ä½œçš„æœ€åæƒ…å†µä¸‹éœ€è¦è¿›è¡Œ <code>log n</code> æ¬¡æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º <code>O(log n)</code>ã€‚</li></ul><ol start="3"><li><strong><code>push_heap</code> çš„æ€§èƒ½åˆ†æ</strong></li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>push_heap</code> åœ¨åºåˆ—çš„æœ«å°¾æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå¹¶è°ƒæ•´åºåˆ—ä½¿å…¶ä»ç„¶æ»¡è¶³å †çš„æ€§è´¨ã€‚</li><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code>O(log n)</code>ã€‚</li></ul><p><strong>åˆ†æ</strong>ï¼š</p><ul><li>å½“å°†ä¸€ä¸ªæ–°å…ƒç´ æ·»åŠ åˆ°å †ä¸­æ—¶ï¼Œå®ƒé¦–å…ˆè¢«æ’å…¥åˆ°å †çš„æœ«å°¾ã€‚ç„¶åé€šè¿‡ä¸Šæµ®æ“ä½œï¼Œå°†è¯¥å…ƒç´ å‘ä¸Šç§»åŠ¨ï¼Œç›´åˆ°æ»¡è¶³å †çš„æ€§è´¨ã€‚</li><li>ä¸Šæµ®æ“ä½œåœ¨æœ€åæƒ…å†µä¸‹å¯èƒ½éœ€è¦ä»å †çš„åº•éƒ¨ç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹ï¼Œè¿™éœ€è¦æœ€å¤š <code>log n</code> æ­¥æ“ä½œï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º <code>O(log n)</code>ã€‚</li></ul><ol start="4"><li><strong><code>sort_heap</code> çš„æ€§èƒ½åˆ†æ</strong></li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>sort_heap</code> å°†å †æ’åºä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚å®ƒé€šè¿‡ä¾æ¬¡è°ƒç”¨ <code>pop_heap</code>ï¼Œå°†å †é¡¶å…ƒç´ ç§»åˆ°åºåˆ—æœ«å°¾ï¼Œå¹¶è°ƒæ•´å‰©ä½™åºåˆ—ä¸ºä¸€ä¸ªåˆæ³•çš„å †ï¼Œæœ€ç»ˆå®Œæˆæ’åºã€‚</li><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code>O(n log n)</code>ã€‚</li></ul><p><strong>åˆ†æ</strong>ï¼š</p><ul><li>å †æ’åºæ˜¯é€šè¿‡é‡å¤è°ƒç”¨ <code>pop_heap</code> å®ç°çš„ï¼Œ<code>pop_heap</code> æ¯æ¬¡å°†å †é¡¶å…ƒç´ ç§»åŠ¨åˆ°æœ«å°¾ï¼Œç„¶åè°ƒæ•´å‰©ä½™çš„å †ï¼Œå¤æ‚åº¦ä¸º <code>O(log n)</code>ã€‚</li><li>å› ä¸º <code>sort_heap</code> éœ€è¦å¯¹ <code>n</code> ä¸ªå…ƒç´ ä¾æ¬¡è°ƒç”¨ <code>pop_heap</code>ï¼Œå› æ­¤æ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n log n)</code>ã€‚</li></ul><h3 id="6-ä½¿ç”¨åœºæ™¯"><a href="#6-ä½¿ç”¨åœºæ™¯" class="headerlink" title="6. ä½¿ç”¨åœºæ™¯"></a>6. <strong>ä½¿ç”¨åœºæ™¯</strong></h3><p>ä¼˜å…ˆé˜Ÿåˆ—å¹¿æ³›ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p><ul><li><strong>ä»»åŠ¡è°ƒåº¦</strong>ï¼šæ ¹æ®ä¼˜å…ˆçº§å®‰æ’ä»»åŠ¡æ‰§è¡Œé¡ºåºã€‚</li><li><strong>å›¾ç®—æ³•</strong>ï¼šå¦‚ Dijkstra æœ€çŸ­è·¯å¾„ç®—æ³•ã€A* æœç´¢ç®—æ³•ç­‰ã€‚</li><li><strong>äº‹ä»¶é©±åŠ¨æ¨¡æ‹Ÿ</strong>ï¼šå¤„ç†æ—¶é—´æ•æ„Ÿçš„äº‹ä»¶ã€‚</li><li><strong>åŠ¨æ€æ’åºé—®é¢˜</strong>ï¼šå®æ—¶è·å–æœ€å¤§æˆ–æœ€å°å…ƒç´ çš„æƒ…å†µã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]23.åˆå¹¶kä¸ªå‡åºé“¾è¡¨</title>
    <link href="/2024/10/05/LC-23-%E5%90%88%E5%B9%B6k%E4%B8%AA%E5%8D%87%E5%BA%8F%E9%93%BE%E8%A1%A8/"/>
    <url>/2024/10/05/LC-23-%E5%90%88%E5%B9%B6k%E4%B8%AA%E5%8D%87%E5%BA%8F%E9%93%BE%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚</p><p>è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="åˆ†æ²»"><a href="#åˆ†æ²»" class="headerlink" title="åˆ†æ²»"></a>åˆ†æ²»</h4><p>å°†kä¸ªé“¾è¡¨ä¸¤ä¸¤é…å¯¹åˆå¹¶ä¸ºä¸€ä¸ªæ›´é•¿çš„æœ‰åºé“¾è¡¨ï¼Œå°†åŸé—®é¢˜è§„çº¦ä¸ºè§„æ¨¡æ›´å°çš„å­é—®é¢˜ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * struct ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode *next;</span><br><span class="hljs-comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">ListNode *<span class="hljs-title">mergeTwoLists</span><span class="hljs-params">(ListNode *h1, ListNode *h2)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (h1 == <span class="hljs-literal">nullptr</span> || h2 == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> h1 ? h1 : h2;<br>        ListNode dummy, *tail = &amp;dummy;<br>        <span class="hljs-keyword">while</span> (h1 &amp;&amp; h2)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (h1-&gt;val &lt;= h2-&gt;val)<br>            &#123;<br>                tail-&gt;next = h1;<br>                h1 = h1-&gt;next;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                tail-&gt;next = h2;<br>                h2 = h2-&gt;next;<br>            &#125;<br>            tail = tail-&gt;next;<br>        &#125;<br>        tail-&gt;next = h1 ? h1 : h2;<br>        <span class="hljs-keyword">return</span> dummy.next;<br>    &#125;<br>    <span class="hljs-comment">// [l,r]</span><br>    <span class="hljs-function">ListNode *<span class="hljs-title">merge</span><span class="hljs-params">(vector&lt;ListNode*&gt; &amp;lists, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (l == r) <span class="hljs-keyword">return</span> lists[l];<br>        <span class="hljs-keyword">if</span> (l &gt; r) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>        <span class="hljs-type">int</span> mid = l + ((r - l) &gt;&gt; <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">mergeTwoLists</span>(<span class="hljs-built_in">merge</span>(lists, l, mid), <span class="hljs-built_in">merge</span>(lists, mid + <span class="hljs-number">1</span>, r));<br>    &#125;<br>    <span class="hljs-function">ListNode* <span class="hljs-title">mergeKLists</span><span class="hljs-params">(vector&lt;ListNode*&gt;&amp; lists)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">merge</span>(lists, <span class="hljs-number">0</span>, lists.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>æ³¨æ„39è¡Œè®¡ç®—ä¸­ä½æ•°çš„æ–¹æ³•ï¼Œé€šå¸¸çš„æ–¹æ³•æ˜¯ <code>(l + r) / 2</code> ï¼Œè¿™ç§æ–¹æ³•åœ¨lå’Œrè¿‡å¤§çš„æ—¶å€™å¯èƒ½ä¼šå‘ç”Ÿæº¢å‡ºçš„é—®é¢˜ï¼Œå› æ­¤æ›´å¥½çš„æ–¹æ³•æ˜¯ <code>l + ((r - l) &gt;&gt; 1)</code> ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯æ³¨æ„åé¢çš„æ‹¬å·ä¸è¦çœç•¥ï¼Œå› ä¸ºåŠ æ³•çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚</p>          </div><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>é€’æ¨æ–¹ç¨‹ï¼š$W(k) &#x3D; W(k&#x2F;2) + k&#x2F;2 \times 2n, å…¶ä¸­nä¸ºæ¯ä¸ªé“¾è¡¨çš„å¹³å‡é•¿åº¦.$</p><p>è§£è¿™ä¸ªé€’æ¨æ–¹ç¨‹å¯ä»¥å¾—åˆ°$W(k) &#x3D; O(knlogk).$</p><h4 id="ä¼˜å…ˆé˜Ÿåˆ—"><a href="#ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆé˜Ÿåˆ—"></a><a href="https://erlsrnby04.github.io/2024/10/05/C-%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/">ä¼˜å…ˆé˜Ÿåˆ—</a></h4><p>å¦ä¸€ç§æ€è·¯æ˜¯å°†kä¸ªé“¾è¡¨çš„å¤´ç»“ç‚¹é€šè¿‡ä¸€ä¸ªå°é¡¶å †æ¥ç»´æŠ¤ï¼Œæ¯æ¬¡å–å‡ºæœ€å°çš„ç»“ç‚¹ï¼Œç„¶åå°†è¯¥ç»“ç‚¹ä¸‹ä¸€ä¸ªç»“ç‚¹é‡æ–°æ’å…¥å°é¡¶å †ä¸­ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * struct ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode *next;</span><br><span class="hljs-comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span><br><span class="hljs-comment"> * &#125;;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">ListNode* <span class="hljs-title">mergeKLists</span><span class="hljs-params">(vector&lt;ListNode*&gt;&amp; lists)</span> </span>&#123;<br>        <span class="hljs-keyword">auto</span> cmp = [](<span class="hljs-type">const</span> ListNode *lhs, <span class="hljs-type">const</span> ListNode *rhs)<br>        &#123;<br>            <span class="hljs-keyword">return</span> lhs-&gt;val &gt; rhs-&gt;val;<br>        &#125;;<br>        priority_queue&lt;ListNode*, vector&lt;ListNode*&gt;, <span class="hljs-keyword">decltype</span>(cmp)&gt; <span class="hljs-built_in">pq</span>(cmp);<br>        ListNode dummy, *tail = &amp;dummy;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> list : lists) <br>            <span class="hljs-keyword">if</span> (list) pq.<span class="hljs-built_in">push</span>(list);<br>        <span class="hljs-keyword">while</span> (!pq.<span class="hljs-built_in">empty</span>())<br>        &#123;<br>            tail-&gt;next = pq.<span class="hljs-built_in">top</span>(); pq.<span class="hljs-built_in">pop</span>();<br>            tail = tail-&gt;next;<br>            <span class="hljs-keyword">if</span> (tail-&gt;next) pq.<span class="hljs-built_in">push</span>(tail-&gt;next);<br>        &#125;<br>        <span class="hljs-keyword">return</span> dummy.next;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>å°é¡¶å †ä¸­æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯$O(logk)$ï¼Œæ‰€æœ‰ç»“ç‚¹éƒ½éœ€è¦è¿›é˜Ÿä¸€æ¬¡ï¼Œå‡ºé˜Ÿä¸€æ¬¡ï¼Œå› æ­¤ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(knlogk)$ï¼Œå’Œåˆ†æ²»ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸€æ ·ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[LC]4.å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</title>
    <link href="/2024/10/05/LC-4-%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%AD%A3%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/"/>
    <url>/2024/10/05/LC-4-%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%AD%A3%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>ç»™å®šä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º <code>m</code> å’Œ <code>n</code> çš„æ­£åºï¼ˆä»å°åˆ°å¤§ï¼‰æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›è¿™ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ <strong>ä¸­ä½æ•°</strong> ã€‚</p><p>ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º <code>O(log (m+n))</code> ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><h4 id="æš´åŠ›è§£"><a href="#æš´åŠ›è§£" class="headerlink" title="æš´åŠ›è§£"></a>æš´åŠ›è§£</h4><p>ç›´æ¥å½’å¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼Œç„¶åæ±‚ä¸­ä½æ•°å³å¯</p><p><strong>æ—¶é—´å¤æ‚åº¦</strong> ï¼š$O(m+n)$</p><h4 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h4><p>å…ˆè€ƒè™‘æ›´ä¸€èˆ¬çš„é—®é¢˜ï¼Œæ‰¾ç¬¬$k$å°çš„æ•°ã€‚</p><p>ä¸ºäº†æ‰¾åˆ°ç¬¬$k$å°çš„æ•°ï¼Œå…ˆè€ƒè™‘$A[k&#x2F;2 - 1]$å’Œ$B[k&#x2F;2 - 1]$ï¼Œè¿™åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ol><li><p>$A[k&#x2F;2 - 1] &lt; B[k&#x2F;2 - 1]$ :</p><p>$å‘½é¢˜:A[0,1,â€¦,k&#x2F;2-1]ä¸­çš„æ•°ä¸ä¼šæ˜¯ç¬¬kå°çš„æ•°$</p><p>$è¯æ˜:A[k&#x2F;2 - 1]æ˜¯A[0,1,â€¦,k&#x2F;2-1]ä¸­æœ€å¤§çš„æ•°ï¼Œ$</p><p>$è€ŒA[k&#x2F;2-1]ä¹‹å‰æœ€å¤šæœ‰k&#x2F;2-1+k&#x2F;2-1 &#x3D; k-2ä¸ªå…ƒç´ ,$</p><p>$å› æ­¤A[k&#x2F;2-1]è‡³å¤šæ˜¯ç¬¬k-1å°çš„å…ƒç´ .$</p><p>å› æ­¤ï¼Œå¯¹äºæ­¤ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸¢å¼ƒ$A[0,1,â€¦,k&#x2F;2-1]$ä¸­çš„å…ƒç´ ï¼Œå¹¶ç›¸åº”çš„æ›´æ–°$k$ï¼Œæ±‚è§£ä¸€ä¸ªè§„æ¨¡æ›´å°çš„å­é—®é¢˜.</p></li><li><p>$A[k&#x2F;2 - 1] &gt; B[k &#x2F; 2 -1]$</p><p>åŒç†ï¼Œå¯¹äºæ­¤ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸¢å¼ƒ$B[0,1,â€¦,k&#x2F;2-1]$ä¸­çš„å…ƒç´ ï¼Œå¹¶ç›¸åº”çš„æ›´æ–°$k$.</p></li><li><p>$A[k&#x2F;2-1] &#x3D; B[k&#x2F;2 -1]$</p><p>è¯¥æƒ…å†µå¯ä»¥å¹¶å…¥æƒ…å†µ1.</p></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å½“$k&#x2F;2-1$è¶Šç•Œçš„æƒ…å†µï¼Œæ­¤æ—¶æˆ‘ä»¬å–æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å³å¯ï¼Œæ›´æ–°$k$çš„æ—¶å€™è¦ç›¸åº”çš„ä¿®æ”¹ã€‚</p><p>å½“$k&#x3D;1$çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦è¿”å›ä¸¤ä¸ªæ•°ç»„é¦–å…ƒç´ ä¸­çš„è¾ƒå°è€…å³å¯ã€‚</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-comment">// k ä»1å¼€å§‹</span><br>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">findKthElement</span><span class="hljs-params">(<span class="hljs-type">const</span> vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums1, </span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-type">const</span> vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums2, </span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-type">size_t</span> k)</span></span><br><span class="hljs-function">    </span>&#123;<br>    <span class="hljs-type">size_t</span> l1 = <span class="hljs-number">0</span>, l2 = <span class="hljs-number">0</span>, m = nums<span class="hljs-number">1.</span><span class="hljs-built_in">size</span>(), n = nums<span class="hljs-number">2.</span><span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (l1 == m)<br>            <span class="hljs-keyword">return</span> nums2[l2 + k - <span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (l2 == n)<br>                <span class="hljs-keyword">return</span> nums1[l1 + k - <span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (k == <span class="hljs-number">1</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(nums1[l1], nums2[l2]);<br>        <span class="hljs-type">size_t</span> m1 = <span class="hljs-built_in">min</span>(l1 + k/<span class="hljs-number">2</span> - <span class="hljs-number">1</span>, m - <span class="hljs-number">1</span>);<br>            <span class="hljs-type">size_t</span> m2 = <span class="hljs-built_in">min</span>(l2 + k/<span class="hljs-number">2</span> - <span class="hljs-number">1</span>, n - <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">if</span> (nums1[m1] &lt;= nums2[m2])<br>            &#123;<br>                k -= (m1 - l1 + <span class="hljs-number">1</span>);<br>                l1 = m1 + <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                k -= (m2 - l2 + <span class="hljs-number">1</span>);<br>                l2 = m2 + <span class="hljs-number">1</span>;<br>            &#125;<br>&#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">findMedianSortedArrays</span><span class="hljs-params">(vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums1, vector&lt;<span class="hljs-type">int</span>&gt;&amp; nums2)</span> </span>&#123;<br>      <span class="hljs-type">size_t</span> length = nums<span class="hljs-number">1.</span><span class="hljs-built_in">size</span>() + nums<span class="hljs-number">2.</span><span class="hljs-built_in">size</span>();<br>        <span class="hljs-keyword">if</span> (length % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">findKthElement</span>(nums1, nums2, length / <span class="hljs-number">2</span> + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">return</span> (<span class="hljs-built_in">findKthElement</span>(nums1, nums2, length / <span class="hljs-number">2</span>) + <br>                    <span class="hljs-built_in">findKthElement</span>(nums1, nums2, length / <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)) / <span class="hljs-number">2.0</span>;<br>    &#125;<br>    <br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong></p><p>å› ä¸ºæ¯æ¬¡$k$éƒ½ä¼šå‡å°‘ä¸€åŠï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸º$O(logk) &#x3D; O(log(m+n)).$</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
      <tag>leetcode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Lab3 page tables</title>
    <link href="/2024/10/05/MIT-6-1810-Lab3-page-tables/"/>
    <url>/2024/10/05/MIT-6-1810-Lab3-page-tables/</url>
    
    <content type="html"><![CDATA[<h2 id="1-Inspect-a-user-process-page-table-easy"><a href="#1-Inspect-a-user-process-page-table-easy" class="headerlink" title="1 Inspect a user-process page table (easy)"></a>1 Inspect a user-process page table (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">easy</a>)</h2><p><img src="/../images/MIT-6-1810-Lab3-page-tables/image-20241005151513827.png"></p><p><img src="/../images/MIT-6-1810-Lab3-page-tables/image-20241005151435200.png"></p><table><thead><tr><th>PTE</th><th>é€»è¾‘å†…å®¹</th><th>æƒé™ä½</th></tr></thead><tbody><tr><td>va 0x0 pte 0x21FC885B pa 0x87F22000 perm 0x5B</td><td>text</td><td>AUXRV</td></tr><tr><td>va 0x1000 pte 0x21FC7C17 pa 0x87F1F000 perm 0x17</td><td>data</td><td>UWRV</td></tr><tr><td>va 0x2000 pte 0x21FC7807 pa 0x87F1E000 perm 0x7</td><td>guard page</td><td>WRV</td></tr><tr><td>va 0x3000 pte 0x21FC74D7 pa 0x87F1D000 perm 0xD7</td><td>stack</td><td>DAUWRV</td></tr><tr><td>va 0x4000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0x5000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0x6000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0x7000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0x8000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0x9000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFF6000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFF7000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFF8000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFF9000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFFA000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFFB000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFFC000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFFD000 pte 0x0 pa 0x0 perm 0x0</td><td>unused</td><td></td></tr><tr><td>va 0xFFFFE000 pte 0x21FD08C7 pa 0x87F42000 perm 0xC7</td><td>trapframe</td><td>DAWRV</td></tr><tr><td>va 0xFFFFF000 pte 0x2000184B pa 0x80006000 perm 0x4B</td><td>trampoline</td><td>AXRV</td></tr></tbody></table><h2 id="2-Speed-up-system-calls-easy"><a href="#2-Speed-up-system-calls-easy" class="headerlink" title="2 Speed up system calls (easy)"></a>2 Speed up system calls (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">easy</a>)</h2><p>Some operating systems (e.g., Linux) speed up certain system calls by sharing data in a read-only region between userspace and the kernel. This eliminates the need for kernel crossings when performing these system calls. To help you learn how to insert mappings into a page table, your first task is to implement this optimization for the <code>getpid()</code> system call in xv6.</p><div class="note note-primary">            <p>When each process is created, map one read-only page at USYSCALL (a virtual address defined in <code>memlayout.h</code>). At the start of this page, store a <code>struct usyscall</code> (also defined in <code>memlayout.h</code>), and initialize it to store the PID of the current process. For this lab, <code>ugetpid()</code> has been provided on the userspace side and will automatically use the USYSCALL mapping. You will receive full credit for this part of the lab if the <code>ugetpid</code> test case passes when running <code>pgtbltest</code>.</p>          </div><p>è¿™é“é¢˜ç›®è¦æ±‚æˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œå°†ä¸€ä¸ªåªè¯»çš„ç‰©ç†é¡µæ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ <code>USYSCALL</code> ï¼Œè¿™æ ·å¯ä»¥åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´å…±äº«ä¸€äº›æ•°æ®ï¼ˆå†…æ ¸å°†æŒ‡å®šçš„æ•°æ®æš´éœ²ç»™ç”¨æˆ·ï¼Œä½¿å¾—å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´å†…è®¿é—®ï¼‰ã€‚é€šè¿‡åœ¨ç”¨æˆ·ç©ºé—´æä¾›ç›¸åº”çš„æ¥å£ï¼Œå¯ä»¥å®Œæˆä¸€äº›ç®€å•çš„ç³»ç»Ÿè°ƒç”¨è€Œæ— éœ€è¿›è¡Œç”¨æˆ·åˆ°å†…æ ¸çš„åˆ‡æ¢ã€‚</p><p>å¤§è‡´çš„æ€è·¯å¦‚ä¸‹ï¼š</p><p>åœ¨åˆ›å»ºè¿›ç¨‹çš„æ—¶å€™ç”³è¯·ç‰©ç†å†…å­˜ï¼Œé”€æ¯è¿›ç¨‹çš„æ—¶å€™é‡Šæ”¾ç‰©ç†å†…å­˜ï¼Œåˆ›å»ºé¡µè¡¨çš„æ—¶å€™è¿›è¡Œæ˜ å°„ï¼Œé”€æ¯é¡µè¡¨çš„æ—¶å€™å–æ¶ˆæ˜ å°„ã€‚</p><ol><li><p>åœ¨procç»“æ„ä½“ä¸­æ·»åŠ ä¸€ä¸ª <code>struct usyscall *usyscall</code> ç”¨æ¥å­˜æ”¾è¯¥é¡µé¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-comment">// ...</span><br>    <br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">usyscall</span> *<span class="hljs-title">usyscall</span>;</span>   <span class="hljs-comment">// shared data between kernel and user</span><br>  <br>  <span class="hljs-comment">// ...</span><br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨åˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œç”³è¯·ä¸€ä¸ªç‰©ç†é¡µï¼Œå‚è€ƒtrapframe.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/proc.c</span><br><br><span class="hljs-comment">// Allocate a usyscall page.</span><br><span class="hljs-comment">// Look in the process table for an UNUSED proc.</span><br><span class="hljs-comment">// If found, initialize state required to run in the kernel,</span><br><span class="hljs-comment">// and return with p-&gt;lock held.</span><br><span class="hljs-comment">// If there are no free procs, or a memory allocation fails, return 0.</span><br><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> proc*<br><span class="hljs-title function_">allocproc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <br><span class="hljs-comment">// Allocate a usyscall page</span><br>    <span class="hljs-keyword">if</span>((p-&gt;usyscall = (<span class="hljs-keyword">struct</span> usyscall *)kalloc()) == <span class="hljs-number">0</span>)&#123;<br>        freeproc(p);<br>        release(&amp;p-&gt;lock);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    p-&gt;usyscall-&gt;pid = p-&gt;pid;<br>    <br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨åˆ›å»ºé¡µè¡¨æ—¶å°†è¯¥ç‰©ç†é¡µæ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ <code>USYSCALL</code>ï¼Œæƒé™ä½è®¾ç½®ä¸º <code>PTE_U | PTE_R</code>.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/proc.c</span><br><br><span class="hljs-comment">// Create a user page table for a given process, with no user memory,</span><br><span class="hljs-comment">// but with trampoline and trapframe pages.</span><br><span class="hljs-type">pagetable_t</span><br><span class="hljs-title function_">proc_pagetable</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> proc *p)</span><br>&#123;<br>  <span class="hljs-comment">// ...</span><br><br>    <span class="hljs-comment">// map the usyscall page just below the trapframe page </span><br>    <span class="hljs-keyword">if</span>(mappages(pagetable, USYSCALL, PGSIZE,<br>              (uint64)(p-&gt;usyscall), PTE_R | PTE_U) &lt; <span class="hljs-number">0</span>)&#123;<br>        uvmunmap(pagetable, TRAMPOLINE, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>        uvmunmap(pagetable, TRAPFRAME, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>        uvmfree(pagetable, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é‡Šæ”¾é¡µè¡¨çš„æ—¶å€™å–æ¶ˆæ˜ å°„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//kernel/proc.c</span><br><br><span class="hljs-comment">// Free a process&#x27;s page table, and free the</span><br><span class="hljs-comment">// physical memory it refers to.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">proc_freepagetable</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable, uint64 sz)</span><br>&#123;<br>  uvmunmap(pagetable, TRAMPOLINE, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  uvmunmap(pagetable, TRAPFRAME, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  uvmunmap(pagetable, USYSCALL, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>  uvmfree(pagetable, sz);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨é”€æ¯è¿›ç¨‹çš„æ—¶å€™ï¼Œå°†è¯¥é¡µå†…å­˜é‡Šæ”¾</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// free a proc structure and the data hanging from it,</span><br><span class="hljs-comment">// including user pages.</span><br><span class="hljs-comment">// p-&gt;lock must be held.</span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span><br><span class="hljs-title function_">freeproc</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> proc *p)</span><br>&#123;<br><span class="hljs-comment">// ...</span><br>    <br>    <span class="hljs-keyword">if</span>(p-&gt;usyscall)<br>    kfree((<span class="hljs-type">void</span>*)p-&gt;usyscall);<br>    p-&gt;usyscall = <span class="hljs-number">0</span>;<br>   <br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="3-Print-a-page-table-easy"><a href="#3-Print-a-page-table-easy" class="headerlink" title="3 Print a page table (easy)"></a>3 Print a page table (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">easy</a>)</h2><div class="note note-primary">            <p>We added a system call <code>kpgtbl()</code>, which calls <code>vmprint()</code> in <code>vm.c</code>. It takes a <code>pagetable_t</code> argument, and your job is to print that pagetable in the format described below.</p>          </div><p>è¿™é¢˜é€šè¿‡é€’å½’å®ç°ï¼Œå‚è€ƒfreewalkã€‚æ³¨æ„è™šæ‹Ÿåœ°å€vaï¼Œå½“éå†3çº§é¡µè¡¨çš„æ—¶å€™ï¼Œæ¯éå†ä¸€ä¸ªé¡µè¡¨é¡¹ï¼Œvaå˜åŒ–<code>512*512*PGSIZE</code>ï¼Œ2çº§1çº§ä»¥æ­¤ç±»æ¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">vmprinthelper</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable, <span class="hljs-type">int</span> level, uint64 va)</span><br>&#123;<br>  uint64 sz = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (level == <span class="hljs-number">2</span>) sz = <span class="hljs-number">512</span> * <span class="hljs-number">512</span> * PGSIZE;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (level == <span class="hljs-number">1</span>) sz = <span class="hljs-number">512</span> * PGSIZE;<br>  <span class="hljs-keyword">else</span> sz = PGSIZE;<br>  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">512</span>; i++, va += sz)&#123;<br>    <span class="hljs-type">pte_t</span> pte = pagetable[i];<br>    <span class="hljs-keyword">if</span> ((pte &amp; PTE_V) == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span> - level; ++j) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; ..&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p: &quot;</span>, (<span class="hljs-type">void</span>*)va);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pte %p pa %p\n&quot;</span>, (<span class="hljs-type">void</span>*)pte, (<span class="hljs-type">void</span>*)PTE2PA(pte));<br>    <span class="hljs-keyword">if</span> ((pte &amp; (PTE_R|PTE_W|PTE_X)) == <span class="hljs-number">0</span>)<br>      vmprinthelper((<span class="hljs-type">void</span>*)PTE2PA(pte), level - <span class="hljs-number">1</span>, va);<br>  &#125;<br>&#125;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">vmprint</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable)</span> &#123;<br>  <span class="hljs-comment">// your code here</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;page table %p\n&quot;</span>, pagetable);<br>  vmprinthelper(pagetable, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-Use-superpages-moderate-hard"><a href="#4-Use-superpages-moderate-hard" class="headerlink" title="4 Use superpages (moderate)&#x2F;(hard)"></a>4 Use superpages (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">moderate</a>)&#x2F;(<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">hard</a>)</h2><div class="note note-primary">            <p>Your job is to modify the xv6 kernel to use superpages. In particular, if a user program calls sbrk() with a size of 2 megabytes or more, and the newly created address range includes one or more areas that are two-megabyte-aligned and at least two megabytes in size, the kernel should use a single superpage (instead of hundreds of ordinary pages). You will receive full credit for this part of the lab if the <code>superpg_test</code> test case passes when running <code>pgtbltest</code>.</p>          </div><p>æœ¬é¢˜è¦æ±‚å®ç°superpage</p><ul><li><p>ä¿®æ”¹å†…å­˜å¸ƒå±€ï¼Œåœ¨å¯ä¾›åˆ†é…çš„ç‰©ç†å†…å­˜ä¸­é¢„ç•™å‡ºä¸€å—åŒºåŸŸç”¨äºsuperpage</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// memlayout.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> KERNBASE 0x80000000L</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SUPERBASE (KERNBASE + 112*1024*1024)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PHYSTOP (KERNBASE + 128*1024*1024)</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹kallo.cä¸­çš„ä»£ç ï¼Œåœ¨åˆå§‹åŒ– <code>kmem</code> çš„æ—¶å€™é¢„ç•™å‡ºä¸€å®šç‰©ç†ç©ºé—´ç»™superpage</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kallo.c</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">kinit</span><span class="hljs-params">()</span><br>&#123;<br>  initlock(&amp;kmem.lock, <span class="hljs-string">&quot;kmem&quot;</span>);<br>  freerange(end, (<span class="hljs-type">void</span>*)SUPERBASE);<br>  superinit();<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å¢åŠ ä¸€ä¸ª <code>supermem</code> é“¾è¡¨ï¼Œç”¨äºç®¡ç†æ‰€æœ‰ç©ºé—²çš„superpageï¼Œå¹¶è¿›è¡Œç›¸åº”çš„åˆå§‹åŒ–å·¥ä½œï¼ˆå‚è€ƒkmemï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kalloc.c</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">freelist</span>;</span><br>&#125; kmem, supermem;<br><br><span class="hljs-type">void</span><br><span class="hljs-title function_">superinit</span><span class="hljs-params">()</span><br>&#123;<br>  initlock(&amp;supermem.lock, <span class="hljs-string">&quot;supermem&quot;</span>);<br>  <span class="hljs-type">char</span> *p = (<span class="hljs-type">char</span>*) SUPERPGROUNDUP(SUPERBASE);<br>  <span class="hljs-keyword">for</span> (; p + SUPERPGSIZE &lt;= (<span class="hljs-type">char</span>*)PHYSTOP; p += SUPERPGSIZE)<br>    superfree(p);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ·»åŠ  <code>superalloc</code> å’Œ <code>superfree</code> å‡½æ•°ï¼Œç”¨äºåˆ†é…å’Œé‡Šæ”¾superpage</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">superfree</span><span class="hljs-params">(<span class="hljs-type">void</span> *pa)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">r</span>;</span><br><br>  <span class="hljs-keyword">if</span>(((uint64)pa % SUPERPGSIZE) != <span class="hljs-number">0</span> || (<span class="hljs-type">char</span>*)pa &lt; (<span class="hljs-type">char</span>*)SUPERBASE || (uint64)pa &gt;= PHYSTOP)<br>    panic(<span class="hljs-string">&quot;superfree&quot;</span>);<br><br>  <span class="hljs-comment">// Fill with junk to catch dangling refs.</span><br>  <span class="hljs-built_in">memset</span>(pa, <span class="hljs-number">1</span>, SUPERPGSIZE);<br><br>  r = (<span class="hljs-keyword">struct</span> run*)pa;<br><br>  acquire(&amp;supermem.lock);<br>  r-&gt;next = supermem.freelist;<br>  supermem.freelist = r;<br>  release(&amp;supermem.lock);<br>&#125;<br><br><span class="hljs-comment">// Allocate one 2MB page of physical memory.</span><br><span class="hljs-comment">// Returns a pointer that the kernel can use.</span><br><span class="hljs-comment">// Returns 0 if the memory cannot be allocated.</span><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">superalloc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">r</span>;</span><br><br>  acquire(&amp;supermem.lock);<br>  r = supermem.freelist;<br>  <span class="hljs-keyword">if</span>(r)<br>    supermem.freelist = r-&gt;next;<br>  release(&amp;supermem.lock);<br><br>  <span class="hljs-keyword">if</span>(r)<br>    <span class="hljs-built_in">memset</span>((<span class="hljs-type">char</span>*)r, <span class="hljs-number">5</span>, SUPERPGSIZE); <span class="hljs-comment">// fill with junk</span><br>  <span class="hljs-keyword">return</span> (<span class="hljs-type">void</span>*)r;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç”¨æˆ·åœ¨è°ƒç”¨ <code>sbrk</code> ç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…ä¼šå»è°ƒç”¨ <code>uvmalloc</code> å‡½æ•°ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>uvmalloc</code> å‡½æ•°ï¼Œæ ¹æ®å‚æ•°è¿›è¡Œä¸åŒçš„åˆ†é…ç­–ç•¥ã€‚å…·ä½“çš„ï¼Œæˆ‘ä»¬å…ˆåˆ†é…æ™®é€šçš„pageï¼Œç›´åˆ°è™šæ‹Ÿåœ°å€å¯¹é½åˆ°äº†2MBçš„ä½ç½®ä¸Šï¼Œç„¶åæˆ‘ä»¬å°½å¯èƒ½å¤šçš„åˆ†é…superpageï¼Œæœ€åæœ‰å¯èƒ½è¿˜ä¼šå‰©ä¸‹ä¸€äº›éœ€è¦åˆ†é…çš„å†…å­˜ï¼Œä½†æ˜¯ä¸è¶³ä¸€ä¸ªsuperpageï¼Œæˆ–è€…æˆ‘ä»¬å·²ç»æ²¡æœ‰superpageå¯ä¾›åˆ†é…äº†ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†é…æ™®é€šçš„pageï¼Œç›´åˆ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Allocate PTEs and physical memory to grow process from oldsz to</span><br><span class="hljs-comment">// newsz, which need not be page aligned.  Returns new size or 0 on error.</span><br>uint64<br><span class="hljs-title function_">uvmalloc</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable, uint64 oldsz, uint64 newsz, <span class="hljs-type">int</span> xperm)</span><br>&#123;<br>  <span class="hljs-type">char</span> *mem;<br>  uint64 a;<br>  <span class="hljs-type">int</span> sz;<br><br>  <span class="hljs-keyword">if</span>(newsz &lt; oldsz)<br>    <span class="hljs-keyword">return</span> oldsz;<br>  <span class="hljs-comment">// page ... page superpage ... superpage page ... page</span><br>  oldsz = PGROUNDUP(oldsz);<br>  <br>  <span class="hljs-comment">// åˆ†é…pageç›´åˆ°å¯¹é½</span><br>  <span class="hljs-keyword">for</span>(a = oldsz; a &lt; SUPERPGROUNDUP(oldsz) &amp;&amp; a &lt; newsz; a += sz)&#123;<br>    sz = PGSIZE;<br>    mem = kalloc();<br>    <span class="hljs-keyword">if</span>(mem == <span class="hljs-number">0</span>)&#123;<br>      uvmdealloc(pagetable, a, oldsz);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> LAB_SYSCALL</span><br>    <span class="hljs-built_in">memset</span>(mem, <span class="hljs-number">0</span>, sz);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">if</span>(mappages(pagetable, a, sz, (uint64)mem, PTE_R|PTE_U|xperm) != <span class="hljs-number">0</span>)&#123;<br>      kfree(mem);<br>      uvmdealloc(pagetable, a, oldsz);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// å°½å¯èƒ½å¤šçš„åˆ†é…superpage</span><br>  <span class="hljs-keyword">for</span> (; a + SUPERPGSIZE &lt; newsz; a += sz)<br>  &#123;<br>    sz = SUPERPGSIZE;<br>    mem = superalloc();<br>    <span class="hljs-keyword">if</span> (mem == <span class="hljs-number">0</span>)&#123;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">memset</span>(mem, <span class="hljs-number">0</span>, sz);<br>    <span class="hljs-keyword">if</span> (mappages(pagetable, a, sz, (uint64)mem, PTE_R|PTE_U|xperm) != <span class="hljs-number">0</span>)&#123;<br>      superfree(mem);<br>      uvmdealloc(pagetable, a, oldsz);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <br>  <span class="hljs-comment">// ä¸ºå‰©ä½™å†…å­˜åˆ†é…page</span><br>  <span class="hljs-keyword">for</span>(; a &lt; newsz; a += sz)&#123;<br>    sz = PGSIZE;<br>    mem = kalloc();<br>    <span class="hljs-keyword">if</span>(mem == <span class="hljs-number">0</span>)&#123;<br>      uvmdealloc(pagetable, a, oldsz);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-built_in">memset</span>(mem, <span class="hljs-number">0</span>, sz);<br>    <span class="hljs-keyword">if</span>(mappages(pagetable, a, sz, (uint64)mem, PTE_R|PTE_U|xperm) != <span class="hljs-number">0</span>)&#123;<br>      kfree(mem);<br>      uvmdealloc(pagetable, a, oldsz);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> newsz;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨ <code>uvmalloc</code> ä¸­ç”³è¯·åˆ°å†…å­˜ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡µè¡¨ä¸­æ·»åŠ å¯¹åº”çš„é¡µè¡¨é¡¹ã€‚superpageåªéœ€è¦åœ¨ä¸€çº§é¡µè¡¨ä¸­è®¾ç½®å³å¯ï¼Œå› ä¸ºä¸€ä¸ªä¸€çº§é¡µè¡¨å¯¹åº”512ä¸ªé¡µï¼Œå³2MBã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>mappages</code> å‡½æ•°ï¼Œæ¥è¿›è¡Œç›¸åº”çš„æ˜ å°„ã€‚æˆ‘ä»¬æ ¹æ®paçš„å€¼æ¥åŒºåˆ†å½“å‰æ˜ å°„çš„æ˜¯pageè¿˜æ˜¯superpageï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦ç›¸åº”çš„ <code>superwalk</code> æ¥è·å–<code>superpage</code> å¯¹åº”çš„é¡µè¡¨é¡¹ï¼Œ<code>walk</code> è·å¾—çš„é¡µè¡¨é¡¹æ˜¯0çº§é¡µè¡¨ä¸­çš„ï¼Œ<code>superwalk</code> è·å¾—1çº§é¡µè¡¨ä¸­çš„é¡µè¡¨é¡¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">pte_t</span> *<br><span class="hljs-title function_">superwalk</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable, uint64 va, <span class="hljs-type">int</span> alloc)</span><br>&#123;<br>  <span class="hljs-keyword">if</span>(va &gt;= MAXVA)<br>    panic(<span class="hljs-string">&quot;superwalk&quot;</span>);<br><br>  <span class="hljs-type">pte_t</span> *pte = &amp;pagetable[PX(<span class="hljs-number">2</span>, va)];<br>  <span class="hljs-keyword">if</span>(*pte &amp; PTE_V) &#123;<br>    pagetable = (<span class="hljs-type">pagetable_t</span>)PTE2PA(*pte);<br>    <span class="hljs-keyword">return</span> &amp;pagetable[PX(<span class="hljs-number">1</span>, va)];<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span>(!alloc || (pagetable = (<span class="hljs-type">pde_t</span>*)kalloc()) == <span class="hljs-number">0</span>)<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">memset</span>(pagetable, <span class="hljs-number">0</span>, PGSIZE);<br>    *pte = PA2PTE(pagetable) | PTE_V;<br>    <span class="hljs-keyword">return</span> &amp;pagetable[PX(<span class="hljs-number">1</span>, va)];<br>  &#125;<br>&#125;<br><span class="hljs-comment">// Create PTEs for virtual addresses starting at va that refer to</span><br><span class="hljs-comment">// physical addresses starting at pa.</span><br><span class="hljs-comment">// va and size MUST be page-aligned.</span><br><span class="hljs-comment">// Returns 0 on success, -1 if walk() couldn&#x27;t</span><br><span class="hljs-comment">// allocate a needed page-table page.</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">mappages</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable, uint64 va, uint64 size, uint64 pa, <span class="hljs-type">int</span> perm)</span><br>&#123;<br>  uint64 a, last;<br>  uint64 pgsize;<br>  <span class="hljs-type">pte_t</span> *pte;<br>  <span class="hljs-keyword">if</span> (pa &gt;= SUPERBASE) pgsize = SUPERPGSIZE;<br>  <span class="hljs-keyword">else</span> pgsize = PGSIZE;<br>  <span class="hljs-keyword">if</span>((va % pgsize) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;mappages: va not aligned&quot;</span>);<br><br>  <span class="hljs-keyword">if</span>((size % pgsize) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;mappages: size not aligned&quot;</span>);<br><br>  <span class="hljs-keyword">if</span>(size == <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;mappages: size&quot;</span>);<br>  <br>  a = va;<br>  last = va + size - pgsize;<br>  <span class="hljs-keyword">for</span>(;;)&#123;<br>    <span class="hljs-keyword">if</span>(pgsize == PGSIZE &amp;&amp; (pte = walk(pagetable, a, <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>)<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">if</span> (pgsize == SUPERPGSIZE &amp;&amp; (pte = superwalk(pagetable, a, <span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>)<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">if</span>(*pte &amp; PTE_V)<br>      panic(<span class="hljs-string">&quot;mappages: remap&quot;</span>);<br>    *pte = PA2PTE(pa) | perm | PTE_V;<br>    <span class="hljs-keyword">if</span>(a == last)<br>      <span class="hljs-keyword">break</span>;<br>    a += pgsize;<br>    pa += pgsize;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ†é…å®Œäº†å†…å­˜ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¤„ç†é‡Šæ”¾å†…å­˜ã€‚é‡Šæ”¾å†…å­˜è°ƒç”¨ <code>uvmdealloc</code> ï¼Œè¯¥å‡½æ•°è°ƒç”¨ <code>uvmunmap</code> å‡½æ•°å»è¿›è¡Œå®é™…çš„é‡Šæ”¾æ“ä½œã€‚æˆ‘ä»¬åŒæ ·æ ¹æ®è·å¾—çš„paæ¥åˆ¤æ–­å½“å‰é‡Šæ”¾çš„æ˜¯pageè¿˜æ˜¯superpageã€‚è¿™é‡Œè·å–vaå¯¹åº”çš„é¡µè¡¨é¡¹å¯ä»¥ç»Ÿä¸€ç”¨ <code>walk</code> ï¼Œå› ä¸º <code>walk</code> é‡åˆ°å¶å­ç»“ç‚¹çš„æ—¶å€™ä¼šç›´æ¥è¿”å›ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Remove npages of mappings starting from va. va must be</span><br><span class="hljs-comment">// page-aligned. The mappings must exist.</span><br><span class="hljs-comment">// Optionally free the physical memory.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">uvmunmap</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> pagetable, uint64 va, uint64 npages, <span class="hljs-type">int</span> do_free)</span><br>&#123;<br>  uint64 a;<br>  <span class="hljs-type">pte_t</span> *pte;<br>  <span class="hljs-type">int</span> sz;<br><br>  <span class="hljs-keyword">if</span>((va % PGSIZE) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;uvmunmap: not aligned&quot;</span>);<br><br>  <span class="hljs-keyword">for</span>(a = va; a &lt; va + npages*PGSIZE; a += sz)&#123;<br>    sz = PGSIZE;<br>    <span class="hljs-keyword">if</span>((pte = walk(pagetable, a, <span class="hljs-number">0</span>)) == <span class="hljs-number">0</span>)<br>      panic(<span class="hljs-string">&quot;uvmunmap: walk&quot;</span>);<br>    <span class="hljs-keyword">if</span>((*pte &amp; PTE_V) == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;va=%ld pte=%ld\n&quot;</span>, a, *pte);<br>      panic(<span class="hljs-string">&quot;uvmunmap: not mapped&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(PTE_FLAGS(*pte) == PTE_V)<br>      panic(<span class="hljs-string">&quot;uvmunmap: not a leaf&quot;</span>);<br>    uint64 pa = PTE2PA(*pte);<br>    <span class="hljs-keyword">if</span> (pa &gt;= SUPERBASE)&#123;<br>      a += SUPERPGSIZE;<br>      a -= sz;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(do_free)&#123;<br>      uint64 pa = PTE2PA(*pte);<br>      <span class="hljs-keyword">if</span> (pa &gt;= SUPERBASE) superfree((<span class="hljs-type">void</span>*)pa);<br>      <span class="hljs-keyword">else</span> kfree((<span class="hljs-type">void</span>*)pa);<br>    &#125;<br>    *pte = <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ <code>fork</code> çš„æ—¶å€™ä¼šæ‹·è´å†…å­˜ï¼Œè°ƒç”¨çš„æ˜¯ <code>uvmcopy</code> ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ã€‚å…¶å®å°±æ˜¯éå†çˆ¶è¿›ç¨‹ç”¨æˆ·ç©ºé—´çš„å†…å­˜ï¼Œæ ¹æ®å†…å­˜çš„paåˆ¤æ–­è¯¥é¡µæ˜¯pageè¿˜æ˜¯superpageï¼Œç„¶åè¿›è¡Œç›¸åº”çš„ç”³è¯·å¹¶å¤åˆ¶ï¼Œæœ€ååœ¨æ–°è¿›ç¨‹çš„é¡µè¡¨ä¸­æ·»åŠ ç›¸åº”çš„é¡µè¡¨é¡¹å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Given a parent process&#x27;s page table, copy</span><br><span class="hljs-comment">// its memory into a child&#x27;s page table.</span><br><span class="hljs-comment">// Copies both the page table and the</span><br><span class="hljs-comment">// physical memory.</span><br><span class="hljs-comment">// returns 0 on success, -1 on failure.</span><br><span class="hljs-comment">// frees any allocated pages on failure.</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">uvmcopy</span><span class="hljs-params">(<span class="hljs-type">pagetable_t</span> old, <span class="hljs-type">pagetable_t</span> new, uint64 sz)</span><br>&#123;<br>  <span class="hljs-type">pte_t</span> *pte;<br>  uint64 pa, i;<br>  uint flags;<br>  <span class="hljs-type">char</span> *mem;<br>  <span class="hljs-type">int</span> szinc;<br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; sz; i += szinc)&#123;<br>    szinc = PGSIZE;<br>    <span class="hljs-keyword">if</span>((pte = walk(old, i, <span class="hljs-number">0</span>)) == <span class="hljs-number">0</span>)<br>      panic(<span class="hljs-string">&quot;uvmcopy: pte should exist&quot;</span>);<br>    <span class="hljs-keyword">if</span>((*pte &amp; PTE_V) == <span class="hljs-number">0</span>)<br>      panic(<span class="hljs-string">&quot;uvmcopy: page not present&quot;</span>);<br>    pa = PTE2PA(*pte);<br>    flags = PTE_FLAGS(*pte);<br>    <span class="hljs-keyword">if</span> (pa &gt;= SUPERBASE)&#123;<br>      szinc = SUPERPGSIZE;<br>      <span class="hljs-keyword">if</span> ((mem = superalloc()) == <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">goto</span> err;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((mem = kalloc()) == <span class="hljs-number">0</span>) <br>      <span class="hljs-keyword">goto</span> err;<br>    memmove(mem, (<span class="hljs-type">char</span>*)pa, szinc);<br>    <span class="hljs-keyword">if</span>(mappages(new, i, szinc, (uint64)mem, flags) != <span class="hljs-number">0</span>)&#123;<br>      <span class="hljs-keyword">if</span> (szinc == PGSIZE) kfree(mem);<br>      <span class="hljs-keyword">else</span> superfree(mem);<br>      <span class="hljs-keyword">goto</span> err;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br> err:<br>  uvmunmap(new, <span class="hljs-number">0</span>, i / PGSIZE, <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-æµ‹è¯•ç»“æœ"><a href="#5-æµ‹è¯•ç»“æœ" class="headerlink" title="5 æµ‹è¯•ç»“æœ"></a>5 æµ‹è¯•ç»“æœ</h2><p><img src="/../images/MIT-6-1810-Lab3-page-tables/image-20241018200421898.png"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Lab2 system calls</title>
    <link href="/2024/10/04/MIT-6-1810-Lab2-system-calls/"/>
    <url>/2024/10/04/MIT-6-1810-Lab2-system-calls/</url>
    
    <content type="html"><![CDATA[<h2 id="1-Using-gdb-easy"><a href="#1-Using-gdb-easy" class="headerlink" title="1 Using gdb(easy)"></a>1 Using gdb(easy)</h2><h3 id="gdbé…ç½®"><a href="#gdbé…ç½®" class="headerlink" title="gdbé…ç½®"></a>gdbé…ç½®</h3><p><strong>ä½¿ç”¨gdbè°ƒè¯•</strong></p><ol><li>è¿è¡Œ <code>make qemu-gdb</code> å‘½ä»¤</li><li>å¦å¤–ä¸€ä¸ªçª—å£ä¸­è¿è¡Œ <code>riscv-64-unknown-elf-gdb kernel/kernel</code> å‘½ä»¤</li><li>ç„¶ååœ¨gdbç¯å¢ƒä¸­è¿è¡Œ <code>(gdb) target remote localhost:26000</code> å‘½ä»¤å³å¯</li></ol><p>3ä¸­çš„ç«¯å£å·åœ¨.gdbinitæ–‡ä»¶ä¸­æŸ¥çœ‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># .gdbinit</span><br><span class="hljs-built_in">set</span> confirm off<br><span class="hljs-built_in">set</span> architecture riscv:rv64<br>target remote 127.0.0.1:26000 <span class="hljs-comment"># å¦‚æœä½¿ç”¨vscodeè°ƒè¯• éœ€è¦åˆ é™¤è¿™è¡Œ</span><br>symbol-file kernel/kernel<br><span class="hljs-built_in">set</span> disassemble-next-line auto<br><span class="hljs-built_in">set</span> riscv use-compressed-breakpoints <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨vscodeè°ƒè¯•</strong></p><ol><li><p>è¿è¡Œ <code>make qemu-gdb</code> å‘½ä»¤</p></li><li><p>å°†ä¸Šè¿°.gdbinitæ–‡ä»¶ä¸­çš„ç¬¬4è¡Œåˆ é™¤</p></li><li><p>é…ç½®vscodeçš„launch.jsonæ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.2.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;configurations&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;debug xv6&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cppdbg&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;request&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;launch&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;program&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;/kernel/kernel&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;stopAtEntry&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;cwd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;miDebuggerServerAddress&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;localhost:26000&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// æŒ‰ç…§.gdbinitä¸­çš„ç«¯å£å·</span><br>            <span class="hljs-attr">&quot;miDebuggerPath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/opt/riscv/bin/riscv64-unknown-elf-gdb&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// gdbç›®å½•</span><br>            <span class="hljs-attr">&quot;environment&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;externalConsole&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;MIMode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;gdb&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;setupCommands&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pretty printing&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;-enable-pretty-printing&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;ignoreFailures&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;logging&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-comment">// &quot;engineLogging&quot;: true,</span><br>                <span class="hljs-comment">// &quot;programOutput&quot;: true,</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>ç‚¹å‡»vscodeä¸­çš„è°ƒè¯•ï¼Œç¨‹åºåˆ°è¾¾å†…æ ¸mainçš„åœ°å€</p></li><li><p>åœ¨vscodeåº•éƒ¨çš„è°ƒè¯•æ§åˆ¶å°è¾“å…¥å‘½ä»¤ <code>-exec file user/_sleep</code> åˆ‡æ¢ç¬¦å·è¡¨ä¸ºsleep.cæ–‡ä»¶</p></li><li><p>åœ¨sleep.cä¸­æ‰“æ–­ç‚¹ï¼Œè¿›è¡Œè°ƒè¯•å³å¯</p></li></ol><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><ol><li><p>Looking at the backtrace output, which function called <code>syscall</code>?</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004201106119.png"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯usertrapè¿™ä¸ªå‡½æ•°è°ƒç”¨äº†syscallå‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">usertrap</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> which_dev = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">if</span>((r_sstatus() &amp; SSTATUS_SPP) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;usertrap: not from user mode&quot;</span>);<br><br>  <span class="hljs-comment">// send interrupts and exceptions to kerneltrap(),</span><br>  <span class="hljs-comment">// since we&#x27;re now in the kernel.</span><br>  w_stvec((uint64)kernelvec);<br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  <br>  <span class="hljs-comment">// save user program counter.</span><br>  p-&gt;trapframe-&gt;epc = r_sepc();<br>  <br>  <span class="hljs-keyword">if</span>(r_scause() == <span class="hljs-number">8</span>)&#123;<br>    <span class="hljs-comment">// system call</span><br><br>    <span class="hljs-keyword">if</span>(killed(p))<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br><br>    <span class="hljs-comment">// sepc points to the ecall instruction,</span><br>    <span class="hljs-comment">// but we want to return to the next instruction.</span><br>    p-&gt;trapframe-&gt;epc += <span class="hljs-number">4</span>;<br><br>    <span class="hljs-comment">// an interrupt will change sepc, scause, and sstatus,</span><br>    <span class="hljs-comment">// so enable only now that we&#x27;re done with those registers.</span><br>    intr_on();<br><br>    syscall();<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((which_dev = devintr()) != <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-comment">// ok</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usertrap(): unexpected scause 0x%lx pid=%d\n&quot;</span>, r_scause(), p-&gt;pid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;            sepc=0x%lx stval=0x%lx\n&quot;</span>, r_sepc(), r_stval());<br>    setkilled(p);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span>(killed(p))<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br><br>  <span class="hljs-comment">// give up the CPU if this is a timer interrupt.</span><br>  <span class="hljs-keyword">if</span>(which_dev == <span class="hljs-number">2</span>)<br>    yield();<br><br>  usertrapret();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œusertrapä¸­æ ¹æ®scauseå¯„å­˜å™¨åˆ¤æ–­trapåŸå› ï¼Œç„¶åè¿›å…¥ä¸åŒçš„åˆ†æ”¯è¿›è¡Œå¤„ç†ã€‚å¯¹äºç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒè°ƒç”¨syscallå‡½æ•°å¤„ç†ã€‚</p></li><li><p>What is the value of <code>p-&gt;trapframe-&gt;a7</code> and what does that value represent? (Hint: look <code>user/initcode.S</code>, the first user program xv6 starts.)</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004202903699.png"></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œa7å¯„å­˜å™¨çš„å€¼æ˜¯7ï¼Œè¿™å¯¹åº”çš„æ˜¯7å·ç³»ç»Ÿè°ƒç”¨ï¼Œå³SYS_execã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># initcode.S<br>la a0, init<br>la a1, argv<br>li a7, SYS_exec<br>ecall<br></code></pre></td></tr></table></figure><p>ä»initcode.Sä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç å°†SYS_execçš„å€¼è½½å…¥å¯„å­˜å™¨a7ä¸­ï¼Œç„¶åæ‰§è¡Œecallå‘½ä»¤ã€‚è¿™è¡¨ç¤ºä¹‹åè¦æ‰§è¡Œexecç³»ç»Ÿè°ƒç”¨ã€‚</p></li><li><p>What was the previous mode that the CPU was in?</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004203351293.png"></p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004203406232.png"></p><p>ç”±å›¾å¯çŸ¥ï¼Œsstatuså¯„å­˜å™¨çš„ç¬¬8ä½æ˜¯0ï¼Œè¡¨ç¤ºä¹‹å‰CPUå¤„äºç”¨æˆ·æ¨¡å¼ã€‚</p></li><li><p>Write down the assembly instruction the kernel is panicing at. Which register corresponds to the variable <code>num</code>?</p><p>å°†syscallä¸­çš„ <code>num = p-&gt;trapframe-&gt;a7</code> ä¿®æ”¹ä¸º <code>num = *(int*)0</code> ç„¶åé‡æ–°è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004203951088.png"></p><p>åœ¨kernel.asmæ–‡ä»¶ä¸­æœç´¢sepcçš„å€¼ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004204352232.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­£æ˜¯æˆ‘ä»¬ä¿®æ”¹çš„æŒ‡ä»¤å¯¼è‡´å†…æ ¸panicï¼Œå˜é‡ <code>num</code> å¯¹åº”å¯„å­˜å™¨a3.</p><p>é‡æ–°è¿è¡Œgdbï¼Œåœ¨ä¸Šé¢sepcæŒ‡å‡ºçš„æŒ‡ä»¤å¤„æ‰“æ–­ç‚¹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004205040251.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå‡ºé”™çš„æŒ‡ä»¤æ­£æ˜¯è¯¥æ¡ä¿®æ”¹è¿‡çš„æŒ‡ä»¤ã€‚</p></li><li><p>Why does the kernel crash? Hint: look at figure 3-3 in the text; is address 0 mapped in the kernel address space? Is that confirmed by the value in <code>scause</code> above? (See description of <code>scause</code> in <a href="https://pdos.csail.mit.edu/6.828/2024/labs/n//github.com/riscv/riscv-isa-manual/releases/download/Priv-v1.12/riscv-privileged-20211203.pdf">RISC-V privileged instructions</a>)</p><p>ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå†…æ ¸åœ°å€ç©ºé—´ä¸­çš„åœ°å€0å¹¶æœªè¿›è¡Œæ˜ å°„ï¼Œå› æ­¤æ— æ³•è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥å†…æ ¸å‡ºé”™çš„åŸå› åº”è¯¥æ˜¯å†…å­˜è®¿é—®é”™è¯¯ã€‚</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004205745856.png"></p><p>scauseå¯„å­˜å™¨çš„å€¼ä¸º0xdï¼ŒæŸ¥çœ‹å¯¹åº”çš„åŸå› ä¸ºload page faultï¼Œè¿™å°è¯äº†ä¸Šè¿°çš„æ¨ç†ã€‚</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004210005557.png"></p></li><li><p>What is the name of the process that was running when the kernel paniced? What is its process id (<code>pid</code>)?</p><p>ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿›ç¨‹çš„åå­—æ˜¯initcodeï¼Œpidä¸º1.</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241004210316235.png"></p></li></ol><h2 id="2-System-call-tracing-moderate"><a href="#2-System-call-tracing-moderate" class="headerlink" title="2 System call tracing (moderate)"></a>2 System call tracing (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">moderate</a>)</h2><div class="note note-primary">            <p>In this assignment you will add a system call tracing feature that may help you when debugging later labs. Youâ€™ll create a new <code>trace</code> system call that will control tracing. It should take one argument, an integer â€œmaskâ€, whose bits specify which system calls to trace. For example, to trace the fork system call, a program calls <code>trace(1 &lt;&lt; SYS_fork)</code>, where <code>SYS_fork</code> is a syscall number from <code>kernel/syscall.h</code>. You have to modify the xv6 kernel to print a line when each system call is about to return, if the system callâ€™s number is set in the mask. The line should contain the process id, the name of the system call and the return value; you donâ€™t need to print the system call arguments. The <code>trace</code> system call should enable tracing for the process that calls it and any children that it subsequently forks, but should not affect other processes.</p>          </div><p>æœ¬é¢˜è¦æ±‚æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨æ¥è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨çš„é¡ºåºã€‚</p><p>ä¸ºäº†æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œéœ€è¦è¿›è¡Œä¸€ä¸‹å‡ æ­¥ï¼š</p><ol><li><p>åœ¨user&#x2F;user.hæ–‡ä»¶ä¸­å£°æ˜ç³»ç»Ÿè°ƒç”¨çš„å‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// user/user.h</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">trace</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span>;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨user&#x2F;usys.plæ·»åŠ ä¸€ä¸ªstubï¼Œä¹‹åmakefileä¼šæ‰§è¡Œperlè„šæœ¬åœ¨user&#x2F;usys.Sä¸­ç”Ÿæˆå®é™…çš„stubæ±‡ç¼–æŒ‡ä»¤ã€‚</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">// user/usys.pl<br>entry(<span class="hljs-string">&quot;trace&quot;</span>);<br></code></pre></td></tr></table></figure></li><li><p>åœ¨kernel&#x2F;syscall.hä¸­æ·»åŠ ç³»ç»Ÿè°ƒç”¨å·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/syscall.h</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SYS_trace  22</span><br></code></pre></td></tr></table></figure></li><li><p>åœ¨kernel&#x2F;syscall.cä¸­æ·»åŠ ç³»ç»Ÿè°ƒç”¨çš„å¤–éƒ¨å£°æ˜ï¼Œå¹¶ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¡¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/syscall.c</span><br><span class="hljs-keyword">extern</span> uint64 <span class="hljs-title function_">sys_trace</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>; <span class="hljs-comment">// å¤–éƒ¨å£°æ˜</span><br><br><span class="hljs-type">static</span> <span class="hljs-title function_">uint64</span> <span class="hljs-params">(*syscalls[])</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> = &#123; <span class="hljs-comment">// ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨è¡¨</span><br>[SYS_fork]    sys_fork,<br><span class="hljs-comment">// ...</span><br>[SYS_trace]   sys_trace,<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨kernelå¯¹åº”çš„æ–‡ä»¶ä¸­å®ç°ç³»ç»Ÿè°ƒç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/sysproc.c</span><br>uint64<br><span class="hljs-title function_">sys_trace</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> mask;<br>  argint(<span class="hljs-number">0</span>, &amp;mask);<br>  myproc()-&gt;tracemask = mask;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>æœ¬é¢˜æ¶‰åŠçš„ä»£ç ä¸å¤æ‚ï¼Œä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>ä¿®æ”¹procç»“æ„ä½“ï¼Œåœ¨è¯¥ç»“æ„ä½“ä¸­æ·»åŠ ä¸€ä¸ªmaskå˜é‡ï¼Œç”¨æ¥æŒ‡ç¤ºéœ€è¦è·Ÿè¸ªçš„ç³»ç»Ÿè°ƒç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/proc.h</span><br><span class="hljs-comment">// Per-process state</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> &#123;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">spinlock</span> <span class="hljs-title">lock</span>;</span><br><br>  <span class="hljs-comment">// p-&gt;lock must be held when using these:</span><br>  <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">procstate</span> <span class="hljs-title">state</span>;</span>        <span class="hljs-comment">// Process state</span><br>  <span class="hljs-type">void</span> *chan;                  <span class="hljs-comment">// If non-zero, sleeping on chan</span><br>  <span class="hljs-type">int</span> killed;                  <span class="hljs-comment">// If non-zero, have been killed</span><br>  <span class="hljs-type">int</span> xstate;                  <span class="hljs-comment">// Exit status to be returned to parent&#x27;s wait</span><br>  <span class="hljs-type">int</span> pid;                     <span class="hljs-comment">// Process ID</span><br><br>  <span class="hljs-comment">// wait_lock must be held when using this:</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">parent</span>;</span>         <span class="hljs-comment">// Parent process</span><br><br>  <span class="hljs-comment">// these are private to the process, so p-&gt;lock need not be held.</span><br>  uint64 kstack;               <span class="hljs-comment">// Virtual address of kernel stack</span><br>  uint64 sz;                   <span class="hljs-comment">// Size of process memory (bytes)</span><br>  <span class="hljs-type">pagetable_t</span> pagetable;       <span class="hljs-comment">// User page table</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trapframe</span> *<span class="hljs-title">trapframe</span>;</span> <span class="hljs-comment">// data page for trampoline.S</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">context</span> <span class="hljs-title">context</span>;</span>      <span class="hljs-comment">// swtch() here to run process</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">ofile</span>[<span class="hljs-title">NOFILE</span>];</span>  <span class="hljs-comment">// Open files</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">inode</span> *<span class="hljs-title">cwd</span>;</span>           <span class="hljs-comment">// Current directory</span><br>  <span class="hljs-type">char</span> name[<span class="hljs-number">16</span>];               <span class="hljs-comment">// Process name (debugging)</span><br>  <span class="hljs-type">int</span> tracemask;               <span class="hljs-comment">// trace mask (debugging)</span><br>&#125;;<br><br></code></pre></td></tr></table></figure></li><li><p>å®ç°sys_traceï¼Œå°†ç³»ç»Ÿè°ƒç”¨å‚æ•°å­˜å‚¨åˆ°è¿›ç¨‹çš„procç»“æ„ä½“ä¸­</p><p>å¦‚ä¸Š5æ‰€ç¤ºã€‚</p></li><li><p>ä¿®æ”¹syscallå‡½æ•°ï¼Œåœ¨ç³»ç»Ÿè°ƒç”¨è¿”å›ä¹‹å‰ï¼Œæ ¹æ®maskè¿›è¡Œç›¸åº”çš„è¾“å‡º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/syscall.c</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">syscall</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> num;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  num = p-&gt;trapframe-&gt;a7;<br>  <span class="hljs-keyword">if</span>(num &gt; <span class="hljs-number">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;<br>    <span class="hljs-comment">// Use num to lookup the system call function for num, call it,</span><br>    <span class="hljs-comment">// and store its return value in p-&gt;trapframe-&gt;a0</span><br>    p-&gt;trapframe-&gt;a0 = syscalls[num]();<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-number">1</span> &lt;&lt; num) &amp; (p-&gt;tracemask))<br>    &#123;<br>      acquire(&amp;p-&gt;lock);<br>      <span class="hljs-type">int</span> pid = p-&gt;pid;<br>      release(&amp;p-&gt;lock);<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: syscall %s -&gt; %ld\n&quot;</span>, pid, syscallnames[num], p-&gt;trapframe-&gt;a0);<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %s: unknown sys call %d\n&quot;</span>,<br>            p-&gt;pid, p-&gt;name, num);<br>    p-&gt;trapframe-&gt;a0 = <span class="hljs-number">-1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹forkå‡½æ•°ï¼Œå°†maskæ‹·è´åˆ°å­è¿›ç¨‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// kernel/proc.c</span><br><span class="hljs-comment">// Create a new process, copying the parent.</span><br><span class="hljs-comment">// Sets up child kernel stack to return as if from fork() system call.</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">fork</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> i, pid;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">np</span>;</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  <span class="hljs-comment">// Allocate process.</span><br>  <span class="hljs-keyword">if</span>((np = allocproc()) == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Copy user memory from parent to child.</span><br>  <span class="hljs-keyword">if</span>(uvmcopy(p-&gt;pagetable, np-&gt;pagetable, p-&gt;sz) &lt; <span class="hljs-number">0</span>)&#123;<br>    freeproc(np);<br>    release(&amp;np-&gt;lock);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  np-&gt;sz = p-&gt;sz;<br><br>  <span class="hljs-comment">// copy saved user registers.</span><br>  *(np-&gt;trapframe) = *(p-&gt;trapframe);<br><br>  <span class="hljs-comment">// Cause fork to return 0 in the child.</span><br>  np-&gt;trapframe-&gt;a0 = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// increment reference counts on open file descriptors.</span><br>  <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; NOFILE; i++)<br>    <span class="hljs-keyword">if</span>(p-&gt;ofile[i])<br>      np-&gt;ofile[i] = filedup(p-&gt;ofile[i]);<br>  np-&gt;cwd = idup(p-&gt;cwd);<br><br>  safestrcpy(np-&gt;name, p-&gt;name, <span class="hljs-keyword">sizeof</span>(p-&gt;name));<br><br>  pid = np-&gt;pid;<br><br>  <span class="hljs-comment">// copy tracemask from the parent;</span><br>  np-&gt;tracemask = p-&gt;tracemask;<br><br>  release(&amp;np-&gt;lock);<br><br>  acquire(&amp;wait_lock);<br>  np-&gt;parent = p;<br>  release(&amp;wait_lock);<br><br>  acquire(&amp;np-&gt;lock);<br>  np-&gt;state = RUNNABLE;<br>  release(&amp;np-&gt;lock);<br><br>  <span class="hljs-keyword">return</span> pid;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241005125441092.png"></p><h2 id="3-Attack-xv6-moderate"><a href="#3-Attack-xv6-moderate" class="headerlink" title="3 Attack xv6 (moderate)"></a>3 Attack xv6 (<a href="https://pdos.csail.mit.edu/6.828/2024/labs/guidance.html">moderate</a>)</h2><div class="note note-primary">            <p><code>user/secret.c</code> writes an 8-byte secret in its memory and then exits (which frees its memory). Your goal is to add a few lines of code to <code>user/attack.c</code> to find the secret that a previous execution of <code>secret.c</code> wrote to memory, and write the 8 secret bytes to file descriptor 2. Youâ€™ll receive full credit if <code>attacktest</code> prints: â€œOK: secret is ebb.ebbâ€. (Note: the secret may be different for each run of <code>attacktest</code>.)</p><p>You are allowed to modify <code>user/attack.c</code>, but you cannot make any other changes: you cannot modify the xv6 kernel sources, secret.c, attacktest.c, etc.</p>          </div><p>æœ¬é¢˜æŒ‡å‡ºxv6ä¸­æ•…æ„å¼•å…¥äº†å‡ ä¸ªbugï¼Œåœ¨ç”³è¯·å†…å­˜å’Œé‡Šæ”¾å†…å­˜åï¼Œæ•…æ„ä¸æ¸…é™¤å…¶ä¸­çš„å†…å®¹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹é€€å‡ºåï¼Œç«‹å³ç”³è¯·åˆ°å®ƒç”³è¯·çš„å†…å­˜ï¼Œä»è€Œè®¿é—®åˆ°å¦å¤–è¿›ç¨‹çš„å†…å®¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// secret.c</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>  <span class="hljs-keyword">if</span>(argc != <span class="hljs-number">2</span>)&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: secret the-secret\n&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-type">char</span> *end = sbrk(PGSIZE*<span class="hljs-number">32</span>);<br>  end = end + <span class="hljs-number">9</span> * PGSIZE;<br>  <span class="hljs-built_in">strcpy</span>(end, <span class="hljs-string">&quot;my very very very secret pw is:   &quot;</span>);<br>  <span class="hljs-built_in">strcpy</span>(end+<span class="hljs-number">32</span>, argv[<span class="hljs-number">1</span>]);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œsecret.cä¸­ç”³è¯·äº†32é¡µçš„å†…å­˜ï¼Œç„¶ååœ¨ç¬¬9é¡µä¸­ç¬¬32å­—èŠ‚å¤„å†™å…¥8ä¸ªå­—èŠ‚çš„å†…å®¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// attack.c</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>  <span class="hljs-comment">// your code here.  you should write the secret to fd 2 using write</span><br>  <span class="hljs-comment">// (e.g., write(2, secret, 8)</span><br>  <span class="hljs-type">char</span> *end = sbrk(PGSIZE *<span class="hljs-number">32</span>);<br>  end = end + PGSIZE * <span class="hljs-number">16</span>;<br>  <span class="hljs-type">char</span> secret[<span class="hljs-number">8</span> + <span class="hljs-number">1</span>];<br>  secret[<span class="hljs-number">8</span>] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">strcpy</span>(secret, end + <span class="hljs-number">32</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, secret);<br>  write(<span class="hljs-number">2</span>, secret, <span class="hljs-number">8</span>);<br>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨attack.cä¸­åŒæ ·ç”³è¯·32é¡µå†…å­˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥æŸ¥çœ‹ç¬¬9é¡µçš„å†…å®¹ï¼Œå‘ç°ä¸å¯¹ï¼Œè¿™æ˜¯å› ä¸ºxv6ç®¡ç†ç©ºé—²é¡µæ˜¯é€šè¿‡ <code>freelist</code> é“¾è¡¨æ¥ç®¡ç†çš„ï¼Œå½“ç”³è¯·å†…å­˜æ—¶ï¼Œä»é“¾è¡¨å¤´éƒ¨å–ä¸‹ä¸€ä¸ªé¡µé¢ï¼Œä½†é‡Šæ”¾ä¸€é¡µå†…å­˜çš„æ—¶å€™ï¼Œä½¿ç”¨å¤´æ’æ³•å°†å†…å­˜é¡µæ’å…¥åˆ°é“¾è¡¨ä¸­ï¼Œè¿™æ ·å°±ä¼šå‘ˆç°å‡ºæ ˆçš„æ€§è´¨ã€‚æ¥ä¸‹æ¥ï¼Œå°è¯•æŸ¥çœ‹ç¬¬22é¡µçš„å†…å®¹ï¼Œå‘ç°ä»ç„¶ä¸å¯¹ï¼Œæœ€åé€šè¿‡å°è¯•å‘ç°ï¼Œå®é™…çš„å†…å®¹åœ¨ç¬¬17é¡µã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Allocate one 4096-byte page of physical memory.</span><br><span class="hljs-comment">// Returns a pointer that the kernel can use.</span><br><span class="hljs-comment">// Returns 0 if the memory cannot be allocated.</span><br><span class="hljs-type">void</span> *<br><span class="hljs-title function_">kalloc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">r</span>;</span><br>  acquire(&amp;kmem.lock);<br>  r = kmem.freelist;<br>  <span class="hljs-keyword">if</span>(r) &#123;<br>    kmem.freelist = r-&gt;next;<br>  &#125;<br>  release(&amp;kmem.lock);<br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> LAB_SYSCALL</span><br>  <span class="hljs-keyword">if</span>(r)<br>    <span class="hljs-built_in">memset</span>((<span class="hljs-type">char</span>*)r, <span class="hljs-number">5</span>, PGSIZE); <span class="hljs-comment">// fill with junk</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  <span class="hljs-keyword">return</span> (<span class="hljs-type">void</span>*)r;<br>&#125;<br><br><span class="hljs-comment">// Free the page of physical memory pointed at by pa,</span><br><span class="hljs-comment">// which normally should have been returned by a</span><br><span class="hljs-comment">// call to kalloc().  (The exception is when</span><br><span class="hljs-comment">// initializing the allocator; see kinit above.)</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">kfree</span><span class="hljs-params">(<span class="hljs-type">void</span> *pa)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">run</span> *<span class="hljs-title">r</span>;</span><br><br>  <span class="hljs-keyword">if</span>(((uint64)pa % PGSIZE) != <span class="hljs-number">0</span> || (<span class="hljs-type">char</span>*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)<br>    panic(<span class="hljs-string">&quot;kfree&quot;</span>);<br><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> LAB_SYSCALL</span><br>  <span class="hljs-comment">// Fill with junk to catch dangling refs.</span><br>  <span class="hljs-built_in">memset</span>(pa, <span class="hljs-number">1</span>, PGSIZE);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>  <br>  r = (<span class="hljs-keyword">struct</span> run*)pa;<br><br>  acquire(&amp;kmem.lock);<br>  r-&gt;next = kmem.freelist;<br>  kmem.freelist = r;<br>  release(&amp;kmem.lock);<br>&#125;<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p><code>user/secret.c</code> copies the secret bytes to memory whose address is 32 bytes after the start of a page. Change the 32 to 0 and you should see that your attack doesnâ€™t work anymore; why not?</p>          </div><p>è¿™æ˜¯å› ä¸ºxv6ç®¡ç†ç©ºé—²é¡µæ˜¯é€šè¿‡é“¾è¡¨æ¥ç®¡ç†çš„ï¼Œå®ƒå°†é“¾è¡¨çš„ç»“ç‚¹ç›´æ¥å­˜æ”¾åœ¨ç©ºé—²é¡µå¼€å§‹çš„ <code>run</code> ç»“æ„ä½“ä¸­ï¼Œå› æ­¤é‡Šæ”¾ä¸€é¡µå†…å­˜çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šä¿®æ”¹å…¶0å­—èŠ‚å¤„ä¸€æ®µç©ºé—´çš„å†…å®¹ï¼Œç”¨æ¥å­˜æ”¾é“¾è¡¨ç»“ç‚¹ï¼Œæ‰€ä»¥å¦‚æœå°†å†…å®¹å­˜æ”¾åœ¨0å­—èŠ‚å¤„ï¼Œä¸€å®šä¼šè¢«è¦†ç›–æ‰ã€‚</p><p>ç»“æœï¼š</p><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241005144408816.png"></p><h2 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4 æµ‹è¯•"></a>4 æµ‹è¯•</h2><p><img src="/../images/MIT-6-1810-Lab2-system-calls/image-20241005144503714.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]static</title>
    <link href="/2024/10/04/C-static/"/>
    <url>/2024/10/04/C-static/</url>
    
    <content type="html"><![CDATA[<p>åœ¨C++ä¸­ï¼Œ<code>static</code>å˜é‡æœ‰ä¸åŒçš„ç”¨é€”å’Œä½œç”¨ï¼Œå–å†³äºå®ƒåœ¨ç¨‹åºä¸­çš„å£°æ˜ä½ç½®ã€‚å®ƒå¯ä»¥ç”¨äºå±€éƒ¨å˜é‡ã€ç±»æˆå‘˜å˜é‡å’Œå…¨å±€å˜é‡ã€‚</p><span id="more"></span><h3 id="1-å±€éƒ¨staticå˜é‡"><a href="#1-å±€éƒ¨staticå˜é‡" class="headerlink" title="1. å±€éƒ¨staticå˜é‡"></a>1. <strong>å±€éƒ¨<code>static</code>å˜é‡</strong></h3><p>å±€éƒ¨<code>static</code>å˜é‡æ˜¯åœ¨å‡½æ•°æˆ–ä»£ç å—ä¸­å£°æ˜çš„<code>static</code>å˜é‡ã€‚å®ƒä¸æ™®é€šå±€éƒ¨å˜é‡çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p><ul><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå±€éƒ¨<code>static</code>å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»ç¬¬ä¸€æ¬¡æ‰§è¡Œåˆ°è¯¥å£°æ˜å¼€å§‹ï¼Œç›´åˆ°ç¨‹åºç»“æŸã€‚å³ä½¿å‡½æ•°å¤šæ¬¡è¢«è°ƒç”¨ï¼Œå®ƒçš„å€¼ä¹Ÿä¼šåœ¨ä¸åŒçš„è°ƒç”¨ä¹‹é—´ä¿æŒä¸å˜ã€‚</li><li><strong>ä½œç”¨åŸŸ</strong>ï¼šå®ƒçš„ä½œç”¨åŸŸä»…é™äºå‡½æ•°æˆ–ä»£ç å—ï¼Œä¸èƒ½è¢«å‡½æ•°å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">example</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> count = <span class="hljs-number">0</span>;  <span class="hljs-comment">// åªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–</span><br>    count++;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Count: &quot;</span> &lt;&lt; count &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">example</span>();  <span class="hljs-comment">// è¾“å‡ºï¼š1</span><br>    <span class="hljs-built_in">example</span>();  <span class="hljs-comment">// è¾“å‡ºï¼š2</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-ç±»çš„staticæˆå‘˜å˜é‡"><a href="#2-ç±»çš„staticæˆå‘˜å˜é‡" class="headerlink" title="2. ç±»çš„staticæˆå‘˜å˜é‡"></a>2. <strong>ç±»çš„<code>static</code>æˆå‘˜å˜é‡</strong></h3><p>ç±»ä¸­çš„<code>static</code>æˆå‘˜å˜é‡æ˜¯å±äºæ•´ä¸ªç±»çš„ï¼Œè€Œä¸æ˜¯å±äºæŸä¸ªå¯¹è±¡çš„ã€‚å®ƒåœ¨æ‰€æœ‰ç±»çš„å®ä¾‹é—´å…±äº«ï¼ŒåŒä¸€ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªå˜é‡ï¼Œå¹¶ä¸”å®ƒçš„å€¼å¯¹æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><ul><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šé™æ€æˆå‘˜å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»ç¨‹åºå¼€å§‹ï¼Œåˆ°ç¨‹åºç»“æŸã€‚</li><li><strong>è®¿é—®æ–¹å¼</strong>ï¼šå¯ä»¥é€šè¿‡ç±»åæˆ–ç±»çš„å¯¹è±¡æ¥è®¿é—®ï¼Œä½†æ¨èä½¿ç”¨ç±»åæ¥è®¿é—®ã€‚</li><li><strong>åˆå§‹åŒ–</strong>ï¼šé™æ€æˆå‘˜å˜é‡å¿…é¡»åœ¨ç±»å®šä¹‰ä½“å¤–è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸èƒ½åœ¨ç±»å†…éƒ¨ç›´æ¥èµ‹å€¼ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> staticVar;<br>&#125;;<br><br><span class="hljs-type">int</span> MyClass::staticVar = <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨ç±»å®šä¹‰å¤–åˆå§‹åŒ–</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass::staticVar = <span class="hljs-number">10</span>;  <span class="hljs-comment">// é€šè¿‡ç±»åè®¿é—®</span><br>    MyClass obj1, obj2;<br>    std::cout &lt;&lt; obj<span class="hljs-number">1.</span>staticVar &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š10</span><br>    obj<span class="hljs-number">2.</span>staticVar = <span class="hljs-number">20</span>;<br>    std::cout &lt;&lt; obj<span class="hljs-number">1.</span>staticVar &lt;&lt; std::endl;  <span class="hljs-comment">// è¾“å‡ºï¼š20 (å…±äº«å˜é‡)</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-å…¨å±€staticå˜é‡æˆ–å‡½æ•°"><a href="#3-å…¨å±€staticå˜é‡æˆ–å‡½æ•°" class="headerlink" title="3. å…¨å±€staticå˜é‡æˆ–å‡½æ•°"></a>3. <strong>å…¨å±€<code>static</code>å˜é‡æˆ–å‡½æ•°</strong></h3><p>å¦‚æœåœ¨å‡½æ•°å¤–éƒ¨å£°æ˜<code>static</code>å˜é‡æˆ–å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨åŸŸå°†è¢«é™åˆ¶åœ¨å®šä¹‰å®ƒçš„æ–‡ä»¶ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåªèƒ½åœ¨è¯¥æ–‡ä»¶ä¸­è®¿é—®ï¼Œä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶é“¾æ¥æˆ–è®¿é—®ã€‚é€šå¸¸ï¼Œè¿™ç§ç”¨æ³•ç”¨äºéšè—æ¨¡å—çš„å…¨å±€å˜é‡ï¼Œä½¿å¾—å®ƒä»¬ä¸ä¼šæ±¡æŸ“å…¶ä»–æ–‡ä»¶çš„å‘½åç©ºé—´ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åœ¨file1.cppä¸­</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> globalStaticVar = <span class="hljs-number">100</span>;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">function</span><span class="hljs-params">()</span> </span>&#123;<br>    std::cout &lt;&lt; globalStaticVar &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-comment">// åœ¨file2.cppä¸­</span><br><span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> <span class="hljs-title">function</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">function</span>();  <span class="hljs-comment">// è¾“å‡ºï¼š100</span><br>    <span class="hljs-comment">// ä¸èƒ½ç›´æ¥è®¿é—®globalStaticVarï¼Œå› ä¸ºå®ƒæ˜¯file1.cppçš„é™æ€å˜é‡</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-ç±»staticæˆå‘˜å‡½æ•°"><a href="#4-ç±»staticæˆå‘˜å‡½æ•°" class="headerlink" title="4. ç±»staticæˆå‘˜å‡½æ•°"></a>4. <strong>ç±»<code>static</code>æˆå‘˜å‡½æ•°</strong></h3><p>å¦‚æœåœ¨ç±»ä¸­å£°æ˜ä¸€ä¸ª<code>static</code>æˆå‘˜å‡½æ•°ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å¯ä»¥åœ¨æ²¡æœ‰å¯¹è±¡å®ä¾‹çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚<code>static</code>æˆå‘˜å‡½æ•°åªèƒ½è®¿é—®ç±»çš„<code>static</code>æˆå‘˜å˜é‡æˆ–å…¶ä»–<code>static</code>æˆå‘˜å‡½æ•°ï¼Œä¸èƒ½è®¿é—®éé™æ€æˆå‘˜ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> staticVar;<br><br>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">staticFunction</span><span class="hljs-params">()</span> </span>&#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Static variable: &quot;</span> &lt;&lt; staticVar &lt;&lt; std::endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-type">int</span> MyClass::staticVar = <span class="hljs-number">42</span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass::<span class="hljs-built_in">staticFunction</span>();  <span class="hljs-comment">// å¯ä»¥åœ¨æ²¡æœ‰å¯¹è±¡çš„æƒ…å†µä¸‹è°ƒç”¨</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>å±€éƒ¨<code>static</code>å˜é‡</strong>ï¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªç¨‹åºï¼Œä½œç”¨åŸŸé™äºå‡½æ•°å†…ã€‚</li><li><strong>ç±»çš„<code>static</code>æˆå‘˜å˜é‡</strong>ï¼šåœ¨ç±»çš„æ‰€æœ‰å¯¹è±¡ä¹‹é—´å…±äº«ï¼Œå¿…é¡»åœ¨ç±»å¤–è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li><strong>å…¨å±€<code>static</code>å˜é‡</strong>ï¼šä½œç”¨åŸŸé™åˆ¶åœ¨å®šä¹‰å®ƒçš„æ–‡ä»¶ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–æ–‡ä»¶è®¿é—®ã€‚</li><li><strong>ç±»çš„<code>static</code>æˆå‘˜å‡½æ•°</strong>ï¼šæ— éœ€åˆ›å»ºå¯¹è±¡å³å¯è°ƒç”¨ï¼Œåªèƒ½è®¿é—®<code>static</code>æˆå‘˜ã€‚</li></ul><p>è¿™äº›ç‰¹æ€§ä½¿å¾—<code>static</code>å…³é”®å­—åœ¨C++ä¸­å¹¿æ³›ç”¨äºæ§åˆ¶å˜é‡å’Œå‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸã€ä½œç”¨åŸŸå’Œè®¿é—®æƒé™ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 16</title>
    <link href="/2024/10/04/C-C-Primer-Chapter-16/"/>
    <url>/2024/10/04/C-C-Primer-Chapter-16/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹"><a href="#æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹" class="headerlink" title="æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹"></a>æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</h1><h2 id="16-1-å®šä¹‰æ¨¡æ¿"><a href="#16-1-å®šä¹‰æ¨¡æ¿" class="headerlink" title="16.1 å®šä¹‰æ¨¡æ¿"></a>16.1 å®šä¹‰æ¨¡æ¿</h2><h3 id="16-1-1-å‡½æ•°æ¨¡æ¿"><a href="#16-1-1-å‡½æ•°æ¨¡æ¿" class="headerlink" title="16.1.1 å‡½æ•°æ¨¡æ¿"></a>16.1.1 å‡½æ•°æ¨¡æ¿</h3><p>ä¸€ä¸ª<strong>å‡½æ•°æ¨¡æ¿</strong>å°±æ˜¯ä¸€ä¸ªå…¬å¼ï¼Œå¯ç”¨æ¥ç”Ÿæˆé’ˆå¯¹ç‰¹å®šç±»å‹çš„å‡½æ•°ç‰ˆæœ¬ã€‚</p><p>æ¨¡æ¿å®šä¹‰ä»¥å…³é”®å­—templateå¼€å§‹ï¼Œåè·Ÿä¸€ä¸ªæ¨¡æ¿å‚æ•°åˆ—è¡¨ï¼ˆtemplate parameter listï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡æ¿å‚æ•°ï¼ˆtemplate parameterï¼‰çš„åˆ—è¡¨ï¼Œç”¨å°äºå·ï¼ˆ&lt;ï¼‰å’Œå¤§äºå·ï¼ˆ&gt;ï¼‰åŒ…å›´èµ·æ¥ã€‚</p><p>æ¨¡æ¿å‚æ•°è¡¨ç¤ºåœ¨ç±»æˆ–å‡½æ•°å®šä¹‰ä¸­ç”¨åˆ°çš„ç±»å‹æˆ–å€¼ã€‚å½“ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œæˆ‘ä»¬ï¼ˆéšå¼åœ°æˆ–æ˜¾å¼åœ°ï¼‰æŒ‡å®šæ¨¡æ¿å®å‚ï¼ˆtemplate argumentï¼‰ï¼Œå°†å…¶ç»‘å®šåˆ°æ¨¡æ¿å‚æ•°ä¸Šã€‚</p><p><strong>å®ä¾‹åŒ–å‡½æ•°æ¨¡æ¿</strong></p><p>å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨ï¼ˆé€šå¸¸ï¼‰ç”¨å‡½æ•°å®å‚æ¥ä¸ºæˆ‘ä»¬æ¨æ–­æ¨¡æ¿å®å‚ã€‚</p><p>ç¼–è¯‘å™¨ç”¨æ¨æ–­å‡ºçš„æ¨¡æ¿å‚æ•°æ¥ä¸ºæˆ‘ä»¬å®ä¾‹åŒ–ï¼ˆinstantiateï¼‰ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„å‡½æ•°ã€‚å½“ç¼–è¯‘å™¨å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡æ¿æ—¶ï¼Œå®ƒä½¿ç”¨å®é™…çš„æ¨¡æ¿å®å‚ä»£æ›¿å¯¹åº”çš„æ¨¡æ¿å‚æ•°æ¥åˆ›å»ºå‡ºæ¨¡æ¿çš„ä¸€ä¸ªæ–°â€œå®ä¾‹â€ã€‚</p><p><strong>æ¨¡æ¿ç±»å‹å‚æ•°</strong></p><p>ç±»å‹å‚æ•°å‰å¿…é¡»ä½¿ç”¨å…³é”®å­—classæˆ–typename</p><p><strong>éç±»å‹æ¨¡æ¿å‚æ•°</strong></p><div class="note note-primary">            <p>éç±»å‹æ¨¡æ¿å‚æ•°çš„æ¨¡æ¿å®å‚å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚</p>          </div><p>é™¤äº†å®šä¹‰ç±»å‹å‚æ•°ï¼Œè¿˜å¯ä»¥åœ¨æ¨¡æ¿ä¸­å®šä¹‰éç±»å‹å‚æ•°ï¼ˆnontype parameterï¼‰ã€‚ä¸€ä¸ªéç±»å‹å‚æ•°è¡¨ç¤ºä¸€ä¸ªå€¼è€Œéä¸€ä¸ªç±»å‹ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç‰¹å®šçš„ç±»å‹åè€Œéå…³é”®å­—classæˆ–typenameæ¥æŒ‡å®šéç±»å‹å‚æ•°ã€‚</p><p>å½“ä¸€ä¸ªæ¨¡æ¿è¢«å®ä¾‹åŒ–æ—¶ï¼Œéç±»å‹å‚æ•°è¢«ä¸€ä¸ªç”¨æˆ·æä¾›çš„æˆ–ç¼–è¯‘å™¨æ¨æ–­å‡ºçš„å€¼æ‰€ä»£æ›¿ã€‚è¿™äº›å€¼å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬58é¡µï¼‰ï¼Œä»è€Œå…è®¸ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å®ä¾‹åŒ–æ¨¡æ¿ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªcompareç‰ˆæœ¬å¤„ç†å­—ç¬¦ä¸²å­—é¢å¸¸é‡ã€‚è¿™ç§å­—é¢å¸¸é‡æ˜¯const charçš„æ•°ç»„ã€‚ç”±äºä¸èƒ½æ‹·è´ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è‡ªå·±çš„å‚æ•°å®šä¹‰ä¸ºæ•°ç»„çš„å¼•ç”¨ï¼ˆå‚è§6.2.4èŠ‚ï¼Œç¬¬195é¡µï¼‰ã€‚ç”±äºæˆ‘ä»¬å¸Œæœ›èƒ½æ¯”è¾ƒä¸åŒé•¿åº¦çš„å­—ç¬¦ä¸²å­—é¢å¸¸é‡ï¼Œå› æ­¤ä¸ºæ¨¡æ¿å®šä¹‰äº†ä¸¤ä¸ªéç±»å‹çš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªæ¨¡æ¿å‚æ•°è¡¨ç¤ºç¬¬ä¸€ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºç¬¬äºŒä¸ªæ•°ç»„çš„é•¿åº¦</p><p><img src="/../images/C-C-Primer-Chapter-16/image-20241004124101870.png"></p><p>ä¸€ä¸ªéç±»å‹å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ª<strong>æ•´å‹</strong>ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡æˆ–å‡½æ•°ç±»å‹çš„<strong>æŒ‡é’ˆæˆ–ï¼ˆå·¦å€¼ï¼‰å¼•ç”¨</strong>ã€‚ç»‘å®šåˆ°éç±»å‹æ•´å‹å‚æ•°çš„å®å‚å¿…é¡»æ˜¯ä¸€ä¸ª<strong>å¸¸é‡è¡¨è¾¾å¼</strong>ã€‚ç»‘å®šåˆ°æŒ‡é’ˆæˆ–å¼•ç”¨éç±»å‹å‚æ•°çš„å®å‚å¿…é¡»<strong>å…·æœ‰é™æ€çš„ç”Ÿå­˜æœŸ</strong>ï¼ˆå‚è§ç¬¬12ç« ï¼Œç¬¬400é¡µï¼‰ã€‚</p><p><strong>inlineå’Œconstexprçš„å‡½æ•°æ¨¡æ¿</strong></p><p>inlineæˆ–constexprè¯´æ˜ç¬¦æ”¾åœ¨æ¨¡æ¿å‚æ•°åˆ—è¡¨ä¹‹åï¼Œè¿”å›ç±»å‹ä¹‹å‰</p><p><strong>ç¼–å†™ç±»å‹æ— å…³çš„ä»£ç </strong></p><p>ç¼–å†™æ³›å‹ä»£ç çš„ä¸¤ä¸ªé‡è¦åŸåˆ™ï¼š</p><ul><li>æ¨¡æ¿ä¸­çš„å‡½æ•°å‚æ•°æ˜¯constçš„å¼•ç”¨ã€‚ï¼ˆæ”¯æŒä¸èƒ½æ‹·è´çš„å¯¹è±¡ï¼Œå¤„ç†å¤§å¯¹è±¡æ—¶æ•ˆç‡æ›´é«˜ï¼‰</li><li>å‡½æ•°ä½“ä¸­çš„æ¡ä»¶åˆ¤æ–­ä»…ä½¿ç”¨&lt;æ¯”è¾ƒè¿ç®—ã€‚ï¼ˆé™ä½å¯¹å¤„ç†ç±»å‹çš„è¦æ±‚ï¼‰</li></ul><p><strong>æ¨¡æ¿ç¼–è¯‘</strong></p><p>å½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªæ¨¡æ¿å®šä¹‰æ—¶ï¼Œå®ƒå¹¶ä¸ç”Ÿæˆä»£ç ã€‚åªæœ‰å½“æˆ‘ä»¬å®ä¾‹åŒ–å‡ºæ¨¡æ¿çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šç”Ÿæˆä»£ç ã€‚</p><p>ä¸ºäº†ç”Ÿæˆä¸€ä¸ªå®ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨éœ€è¦æŒæ¡å‡½æ•°æ¨¡æ¿æˆ–ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°çš„å®šä¹‰ã€‚å› æ­¤ï¼Œä¸éæ¨¡æ¿ä»£ç ä¸åŒï¼Œæ¨¡æ¿çš„å¤´æ–‡ä»¶é€šå¸¸æ—¢åŒ…æ‹¬å£°æ˜ä¹ŸåŒ…æ‹¬å®šä¹‰ã€‚</p><p><strong>å…³é”®æ¦‚å¿µï¼šæ¨¡æ¿å’Œå¤´æ–‡ä»¶</strong></p><p>æ¨¡æ¿åŒ…å«ä¸¤ç§åå­—ï¼š</p><ul><li>é‚£äº›ä¸ä¾èµ–äºæ¨¡æ¿å‚æ•°çš„åå­—</li><li>é‚£äº›ä¾èµ–äºæ¨¡æ¿å‚æ•°çš„åå­—</li></ul><p>å½“ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œæ‰€æœ‰ä¸ä¾èµ–äºæ¨¡æ¿å‚æ•°çš„åå­—éƒ½å¿…é¡»æ˜¯å¯è§çš„ï¼Œè¿™æ˜¯ç”±æ¨¡æ¿çš„æä¾›è€…æ¥ä¿è¯çš„ã€‚è€Œä¸”ï¼Œæ¨¡æ¿çš„æä¾›è€…å¿…é¡»ä¿è¯ï¼Œå½“æ¨¡æ¿è¢«å®ä¾‹åŒ–æ—¶ï¼Œæ¨¡æ¿çš„å®šä¹‰ï¼ŒåŒ…æ‹¬ç±»æ¨¡æ¿çš„æˆå‘˜çš„å®šä¹‰ï¼Œä¹Ÿå¿…é¡»æ˜¯å¯è§çš„ã€‚</p><p>ç”¨æ¥å®ä¾‹åŒ–æ¨¡æ¿çš„æ‰€æœ‰å‡½æ•°ã€ç±»å‹ä»¥åŠä¸ç±»å‹å…³è”çš„è¿ç®—ç¬¦çš„å£°æ˜éƒ½å¿…é¡»æ˜¯å¯è§çš„ï¼Œè¿™æ˜¯ç”±æ¨¡æ¿çš„ç”¨æˆ·æ¥ä¿è¯çš„ã€‚</p><p>é€šè¿‡ç»„ç»‡è‰¯å¥½çš„ç¨‹åºç»“æ„ï¼Œæ°å½“ä½¿ç”¨å¤´æ–‡ä»¶ï¼Œè¿™äº›è¦æ±‚éƒ½å¾ˆå®¹æ˜“æ»¡è¶³ã€‚æ¨¡æ¿çš„è®¾è®¡è€…åº”è¯¥æä¾›ä¸€ä¸ªå¤´æ–‡ä»¶ï¼ŒåŒ…å«æ¨¡æ¿å®šä¹‰ä»¥åŠåœ¨ç±»æ¨¡æ¿æˆ–æˆå‘˜å®šä¹‰ä¸­ç”¨åˆ°çš„æ‰€æœ‰åå­—çš„å£°æ˜ã€‚æ¨¡æ¿çš„ç”¨æˆ·å¿…é¡»åŒ…å«æ¨¡æ¿çš„å¤´æ–‡ä»¶ï¼Œä»¥åŠç”¨æ¥å®ä¾‹åŒ–æ¨¡æ¿çš„ä»»ä½•ç±»å‹çš„å¤´æ–‡ä»¶ã€‚</p><p><strong>å¤§å¤šæ•°ç¼–è¯‘é”™è¯¯åœ¨å®ä¾‹åŒ–æœŸé—´æŠ¥å‘Š</strong></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]å€¼åˆå§‹åŒ–å’Œé»˜è®¤åˆå§‹åŒ–</title>
    <link href="/2024/09/30/C-%E5%80%BC%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
    <url>/2024/09/30/C-%E5%80%BC%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>åœ¨C++ä¸­ï¼Œåˆå§‹åŒ–æ–¹å¼å¤šç§å¤šæ ·ï¼Œå…¶ä¸­<strong>å€¼åˆå§‹åŒ–ï¼ˆvalue initializationï¼‰</strong>å’Œ<strong>é»˜è®¤åˆå§‹åŒ–ï¼ˆdefault initializationï¼‰</strong>æ˜¯ä¸¤ç§å¸¸è§çš„åˆå§‹åŒ–æ–¹å¼ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºæ˜¯å¦å¯¹å˜é‡èµ‹åˆå§‹å€¼ä»¥åŠå¦‚ä½•èµ‹å€¼ã€‚</p><h3 id="1-å€¼åˆå§‹åŒ–ï¼ˆValue-Initializationï¼‰"><a href="#1-å€¼åˆå§‹åŒ–ï¼ˆValue-Initializationï¼‰" class="headerlink" title="1. å€¼åˆå§‹åŒ–ï¼ˆValue Initializationï¼‰"></a>1. <strong>å€¼åˆå§‹åŒ–ï¼ˆValue Initializationï¼‰</strong></h3><p>å€¼åˆå§‹åŒ–æŒ‡çš„æ˜¯å°†å˜é‡æ˜ç¡®åœ°åˆå§‹åŒ–ä¸ºé›¶æˆ–ç©ºå€¼ã€‚ä¸åŒç±»å‹çš„æ•°æ®ä¼šæ ¹æ®å…¶ç±»å‹è¢«èµ‹äºˆâ€œé›¶å€¼â€ï¼š</p><ul><li>æ•°å€¼ç±»å‹ï¼ˆå¦‚<code>int</code>ã€<code>float</code>ã€<code>double</code>ï¼‰ï¼šåˆå§‹åŒ–ä¸º<code>0</code>ã€‚</li><li>æŒ‡é’ˆç±»å‹ï¼šåˆå§‹åŒ–ä¸º<code>nullptr</code>ã€‚</li><li>ç”¨æˆ·è‡ªå®šä¹‰ç±»ç±»å‹ï¼šè°ƒç”¨å…¶é»˜è®¤æ„é€ å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</li></ul><p>å€¼åˆå§‹åŒ–å¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><ul><li><p>ä½¿ç”¨ç©ºçš„å¤§æ‹¬å·<code>&#123;&#125;</code>æˆ–<code>()</code>åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼š</p></li><li><p>å¯¹äºç±»ç±»å‹ï¼Œå¦‚æœç±»æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„æ„é€ å‡½æ•°ï¼Œåˆ™æˆå‘˜ä¼šè¿›è¡Œå€¼åˆå§‹åŒ–ã€‚</p></li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> printer = [](<span class="hljs-type">int</span> x, <span class="hljs-type">double</span> y, <span class="hljs-type">int</span> *p, A a, B b)&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; <span class="hljs-string">&quot; &quot;</span><br>             &lt;&lt; <span class="hljs-string">&quot;y = &quot;</span> &lt;&lt; y &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;p = &quot;</span> &lt;&lt; p &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;a.x = &quot;</span> &lt;&lt; a.x &lt;&lt; <span class="hljs-string">&quot; a.y = &quot;</span> &lt;&lt; a.y &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;b.x = &quot;</span> &lt;&lt; b.x &lt;&lt; <span class="hljs-string">&quot; b.y = &quot;</span> &lt;&lt; b.y &lt;&lt; endl;<br>    &#125;;<br>    <span class="hljs-comment">// å€¼åˆå§‹åŒ–</span><br>    <span class="hljs-type">int</span> x&#123;&#125;; <span class="hljs-type">double</span> y&#123;&#125;;<br>    <span class="hljs-type">int</span> *p&#123;&#125;;<br>    A a&#123;&#125;; B b&#123;&#125;;<br>    <span class="hljs-built_in">printer</span>(x, y, p, a, b);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/../images/C-%E5%80%BC%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%BB%98%E8%AE%A4%E5%88%9D%E5%A7%8B%E5%8C%96/image-20240930111807883.png"></p><h3 id="2-é»˜è®¤åˆå§‹åŒ–ï¼ˆDefault-Initializationï¼‰"><a href="#2-é»˜è®¤åˆå§‹åŒ–ï¼ˆDefault-Initializationï¼‰" class="headerlink" title="2. é»˜è®¤åˆå§‹åŒ–ï¼ˆDefault Initializationï¼‰"></a>2. <strong>é»˜è®¤åˆå§‹åŒ–ï¼ˆDefault Initializationï¼‰</strong></h3><p>é»˜è®¤åˆå§‹åŒ–æ˜¯æŒ‡åœ¨å˜é‡å®šä¹‰æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼åœ°ä¸ºå…¶æä¾›åˆå§‹å€¼ï¼Œç¼–è¯‘å™¨ä¼šå¯¹å®ƒè¿›è¡Œé»˜è®¤çš„å¤„ç†ã€‚</p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚<code>int</code>ã€<code>float</code>ï¼‰ï¼šä¸ä¼šè¿›è¡Œä»»ä½•åˆå§‹åŒ–ï¼Œå¯èƒ½åŒ…å«æœªå®šä¹‰å€¼ï¼ˆåƒåœ¾å€¼ï¼‰ã€‚</li><li>æŒ‡é’ˆç±»å‹ï¼šä¹Ÿæ˜¯æœªå®šä¹‰çš„ï¼ŒæŒ‡é’ˆæ²¡æœ‰è¢«åˆå§‹åŒ–åˆ°<code>nullptr</code>ã€‚</li><li>ç±»ç±»å‹ï¼šå¦‚æœç±»å®šä¹‰äº†é»˜è®¤æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå¯¹è±¡å°†è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°ã€‚</li></ul><p>é»˜è®¤åˆå§‹åŒ–å¸¸åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿï¼š</p><ul><li><p>é€šè¿‡ä¸åŠ æ‹¬å·æˆ–ç­‰å·çš„æ–¹å¼å£°æ˜å¯¹è±¡ï¼š</p></li><li><p>å¯¹äºç±»ç±»å‹ï¼Œå¦‚æœç±»æœ‰ç”¨æˆ·å®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™ä¼šè°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œå¦åˆ™ï¼Œç±»æˆå‘˜å°†é»˜è®¤åˆå§‹åŒ–ã€‚</p></li></ul><p>åœ¨C++ä¸­ï¼Œé»˜è®¤åˆå§‹åŒ–å’Œå€¼åˆå§‹åŒ–çš„è¡Œä¸ºå¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹çœ‹èµ·æ¥ç›¸åŒï¼Œä½†å®ƒä»¬çš„åº•å±‚æœºåˆ¶å´æœ‰æ‰€ä¸åŒã€‚ä½ é‡åˆ°çš„æƒ…å†µæ˜¯ï¼Œé»˜è®¤åˆå§‹åŒ–å’Œå€¼åˆå§‹åŒ–çš„ç»“æœç›¸åŒï¼Œé€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç§åœºæ™¯ä¸‹ï¼š</p><h3 id="3-å…¨å±€å˜é‡å’Œé™æ€å˜é‡"><a href="#3-å…¨å±€å˜é‡å’Œé™æ€å˜é‡" class="headerlink" title="3. å…¨å±€å˜é‡å’Œé™æ€å˜é‡"></a>3. <strong>å…¨å±€å˜é‡å’Œé™æ€å˜é‡</strong></h3><p>åœ¨C++ä¸­ï¼Œ<strong>å…¨å±€å˜é‡</strong>å’Œ<strong>é™æ€å˜é‡</strong>æ€»æ˜¯è¢«<strong>é›¶åˆå§‹åŒ–</strong>ï¼Œæ— è®ºä½ æ˜¯å¦æ˜¾å¼åœ°å¯¹å®ƒä»¬è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™æ„å‘³ç€å³ä½¿ä½ ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–ï¼Œå®ƒä»¬ä¹Ÿä¼šè¢«åˆå§‹åŒ–ä¸ºé›¶å€¼ã€‚</p><h4 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> global_var;  <span class="hljs-comment">// å…¨å±€å˜é‡ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º0</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> static_var;  <span class="hljs-comment">// é™æ€å±€éƒ¨å˜é‡ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º0</span><br>    <span class="hljs-type">int</span> local_var;  <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œé»˜è®¤åˆå§‹åŒ–ï¼Œæœªå®šä¹‰ï¼ˆåƒåœ¾å€¼ï¼‰</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€å˜é‡<code>global_var</code>å’Œé™æ€å˜é‡<code>static_var</code>å³ä½¿æ²¡æœ‰æ˜¾å¼åœ°è¿›è¡Œå€¼åˆå§‹åŒ–ï¼Œé»˜è®¤åˆå§‹åŒ–æ—¶ä¹Ÿä¼šè¢«è®¾ç½®ä¸º0ã€‚è¿™æ˜¯C++æ ‡å‡†è§„å®šçš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 15</title>
    <link href="/2024/09/29/C-C-Primer-Chapter-15/"/>
    <url>/2024/09/29/C-C-Primer-Chapter-15/</url>
    
    <content type="html"><![CDATA[<h1 id="é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡"><a href="#é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡" class="headerlink" title="é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡"></a>é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡</h1><span id="more"></span><p>é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡åŸºäºä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µï¼šæ•°æ®æŠ½è±¡ã€ç»§æ‰¿å’ŒåŠ¨æ€ç»‘å®šã€‚</p><p>ç»§æ‰¿å’ŒåŠ¨æ€ç»‘å®šå¯¹ç¨‹åºçš„ç¼–å†™æœ‰ä¸¤æ–¹é¢çš„å½±å“ï¼šä¸€æ˜¯æˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°å®šä¹‰ä¸å…¶ä»–ç±»ç›¸ä¼¼ä½†ä¸å®Œå…¨ç›¸åŒçš„æ–°ç±»ï¼›äºŒæ˜¯åœ¨ä½¿ç”¨è¿™äº›å½¼æ­¤ç›¸ä¼¼çš„ç±»ç¼–å†™ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¿½ç•¥æ‰å®ƒä»¬çš„åŒºåˆ«ã€‚</p><h2 id="15-1-OOPï¼šæ¦‚è¿°"><a href="#15-1-OOPï¼šæ¦‚è¿°" class="headerlink" title="15.1 OOPï¼šæ¦‚è¿°"></a>15.1 OOPï¼šæ¦‚è¿°</h2><p>é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ï¼ˆobject-oriented programmingï¼‰çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ•°æ®æŠ½è±¡ã€ç»§æ‰¿å’ŒåŠ¨æ€ç»‘å®šã€‚é€šè¿‡ä½¿ç”¨æ•°æ®æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç±»çš„æ¥å£ä¸å®ç°åˆ†ç¦»ï¼ˆè§ç¬¬7ç« ï¼‰ï¼›ä½¿ç”¨ç»§æ‰¿ï¼Œå¯ä»¥å®šä¹‰ç›¸ä¼¼çš„ç±»å‹å¹¶å¯¹å…¶ç›¸ä¼¼å…³ç³»å»ºæ¨¡ï¼›ä½¿ç”¨åŠ¨æ€ç»‘å®šï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¿½ç•¥ç›¸ä¼¼ç±»å‹çš„åŒºåˆ«ï¼Œè€Œä»¥ç»Ÿä¸€çš„æ–¹å¼ä½¿ç”¨å®ƒä»¬çš„å¯¹è±¡ã€‚</p><p><strong>ç»§æ‰¿</strong></p><p>é€šè¿‡ç»§æ‰¿ï¼ˆinheritanceï¼‰è”ç³»åœ¨ä¸€èµ·çš„ç±»æ„æˆä¸€ç§å±‚æ¬¡å…³ç³»ã€‚é€šå¸¸åœ¨å±‚æ¬¡å…³ç³»çš„æ ¹éƒ¨æœ‰ä¸€ä¸ª<strong>åŸºç±»ï¼ˆbase classï¼‰</strong>ï¼Œå…¶ä»–ç±»åˆ™ç›´æ¥æˆ–é—´æ¥åœ°ä»åŸºç±»ç»§æ‰¿è€Œæ¥ï¼Œè¿™äº›ç»§æ‰¿å¾—åˆ°çš„ç±»ç§°ä¸º<strong>æ´¾ç”Ÿç±»ï¼ˆderived classï¼‰</strong>ã€‚åŸºç±»è´Ÿè´£å®šä¹‰åœ¨å±‚æ¬¡å…³ç³»ä¸­æ‰€æœ‰ç±»<strong>å…±åŒæ‹¥æœ‰çš„æˆå‘˜</strong>ï¼Œè€Œæ¯ä¸ªæ´¾ç”Ÿç±»å®šä¹‰å„è‡ª<strong>ç‰¹æœ‰çš„æˆå‘˜</strong>ã€‚</p><p>åœ¨C++è¯­è¨€ä¸­ï¼ŒåŸºç±»å°†ç±»å‹ç›¸å…³çš„å‡½æ•°ä¸æ´¾ç”Ÿç±»ä¸åšæ”¹å˜ç›´æ¥ç»§æ‰¿çš„å‡½æ•°åŒºåˆ†å¯¹å¾…ã€‚å¯¹äºæŸäº›å‡½æ•°ï¼ŒåŸºç±»å¸Œæœ›å®ƒçš„æ´¾ç”Ÿç±»å„è‡ªå®šä¹‰é€‚åˆè‡ªèº«çš„ç‰ˆæœ¬ï¼Œæ­¤æ—¶åŸºç±»å°±å°†è¿™äº›å‡½æ•°å£°æ˜æˆ<strong>è™šå‡½æ•°ï¼ˆvirtual functionï¼‰</strong>ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929224029399.png"></p><p>æ´¾ç”Ÿç±»å¿…é¡»é€šè¿‡ä½¿ç”¨<strong>ç±»æ´¾ç”Ÿåˆ—è¡¨ï¼ˆclass derivation listï¼‰</strong>æ˜ç¡®æŒ‡å‡ºå®ƒæ˜¯ä»å“ªä¸ªï¼ˆå“ªäº›ï¼‰åŸºç±»ç»§æ‰¿è€Œæ¥çš„ã€‚ç±»æ´¾ç”Ÿåˆ—è¡¨çš„å½¢å¼æ˜¯ï¼šé¦–å…ˆæ˜¯ä¸€ä¸ªå†’å·ï¼Œåé¢ç´§è·Ÿä»¥é€—å·åˆ†éš”çš„åŸºç±»åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªåŸºç±»å‰é¢å¯ä»¥æœ‰è®¿é—®è¯´æ˜ç¬¦</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929224100105.png"></p><p>æ´¾ç”Ÿç±»å¿…é¡»åœ¨å…¶å†…éƒ¨å¯¹æ‰€æœ‰é‡æ–°å®šä¹‰çš„è™šå‡½æ•°è¿›è¡Œå£°æ˜ã€‚C++11æ–°æ ‡å‡†å…è®¸æ´¾ç”Ÿç±»æ˜¾å¼åœ°æ³¨æ˜å®ƒå°†ä½¿ç”¨å“ªä¸ªæˆå‘˜å‡½æ•°æ”¹å†™åŸºç±»çš„è™šå‡½æ•°ï¼Œå…·ä½“æªæ–½æ˜¯åœ¨è¯¥å‡½æ•°çš„å½¢å‚åˆ—è¡¨ä¹‹åå¢åŠ ä¸€ä¸ª<strong>overrideå…³é”®å­—</strong>ã€‚</p><p><strong>åŠ¨æ€ç»‘å®š</strong></p><div class="note note-primary">            <p>åœ¨C++è¯­è¨€ä¸­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨åŸºç±»çš„å¼•ç”¨ï¼ˆæˆ–æŒ‡é’ˆï¼‰è°ƒç”¨ä¸€ä¸ªè™šå‡½æ•°æ—¶å°†å‘ç”ŸåŠ¨æ€ç»‘å®šã€‚</p>          </div><p>é€šè¿‡ä½¿ç”¨<strong>åŠ¨æ€ç»‘å®šï¼ˆdynamic bindingï¼‰</strong>ï¼Œæˆ‘ä»¬èƒ½ç”¨åŒä¸€æ®µä»£ç åˆ†åˆ«å¤„ç†Quoteå’ŒBulk_quoteçš„å¯¹è±¡ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929224258001.png"></p><p>æˆ‘ä»¬æ—¢èƒ½ä½¿ç”¨åŸºç±»Quoteçš„å¯¹è±¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œä¹Ÿèƒ½ä½¿ç”¨æ´¾ç”Ÿç±»Bulk_quoteçš„å¯¹è±¡è°ƒç”¨å®ƒï¼›åˆå› ä¸ºprint_totalæ˜¯ä½¿ç”¨å¼•ç”¨ç±»å‹è°ƒç”¨net_priceå‡½æ•°çš„ï¼Œæ‰€ä»¥å‡ºäº15.2.1èŠ‚ï¼ˆç¬¬528é¡µï¼‰å°†è¦è§£é‡Šçš„åŸå› ï¼Œå®é™…ä¼ å…¥print_totalçš„å¯¹è±¡ç±»å‹å°†å†³å®šåˆ°åº•æ‰§è¡Œnet_priceçš„å“ªä¸ªç‰ˆæœ¬.</p><p>åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­å‡½æ•°çš„è¿è¡Œç‰ˆæœ¬ç”±å®å‚å†³å®šï¼Œå³åœ¨è¿è¡Œæ—¶é€‰æ‹©å‡½æ•°çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥åŠ¨æ€ç»‘å®šæœ‰æ—¶åˆè¢«ç§°ä¸º<strong>è¿è¡Œæ—¶ç»‘å®šï¼ˆrun-time bindingï¼‰ã€‚</strong></p><h2 id="15-2-å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»"><a href="#15-2-å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»" class="headerlink" title="15.2 å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»"></a>15.2 å®šä¹‰åŸºç±»å’Œæ´¾ç”Ÿç±»</h2><h3 id="15-2-1-å®šä¹‰åŸºç±»"><a href="#15-2-1-å®šä¹‰åŸºç±»" class="headerlink" title="15.2.1 å®šä¹‰åŸºç±»"></a>15.2.1 å®šä¹‰åŸºç±»</h3><div class="note note-primary">            <p>åŸºç±»é€šå¸¸éƒ½åº”è¯¥å®šä¹‰ä¸€ä¸ªè™šææ„å‡½æ•°ï¼Œå³ä½¿è¯¥å‡½æ•°ä¸æ‰§è¡Œä»»ä½•å®é™…æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>          </div><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929224513032.png"></p><p><strong>æˆå‘˜å‡½æ•°ä¸ç»§æ‰¿</strong></p><p>æ´¾ç”Ÿç±»å¯ä»¥ç»§æ‰¿å…¶åŸºç±»çš„æˆå‘˜ï¼Œç„¶è€Œå½“é‡åˆ°å¦‚net_priceè¿™æ ·ä¸ç±»å‹ç›¸å…³çš„æ“ä½œæ—¶ï¼Œæ´¾ç”Ÿç±»å¿…é¡»å¯¹å…¶é‡æ–°å®šä¹‰ã€‚æ¢å¥è¯è¯´ï¼Œæ´¾ç”Ÿç±»éœ€è¦å¯¹è¿™äº›æ“ä½œæä¾›è‡ªå·±çš„æ–°å®šä¹‰ä»¥<strong>è¦†ç›–ï¼ˆoverrideï¼‰</strong>ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„æ—§å®šä¹‰ã€‚</p><p>åœ¨C++è¯­è¨€ä¸­ï¼ŒåŸºç±»å¿…é¡»å°†å®ƒçš„ä¸¤ç§æˆå‘˜å‡½æ•°åŒºåˆ†å¼€æ¥ï¼š</p><ul><li>ä¸€ç§æ˜¯åŸºç±»å¸Œæœ›å…¶æ´¾ç”Ÿç±»è¿›è¡Œè¦†ç›–çš„å‡½æ•°ï¼›</li><li>å¦ä¸€ç§æ˜¯åŸºç±»å¸Œæœ›æ´¾ç”Ÿç±»ç›´æ¥ç»§æ‰¿è€Œä¸è¦æ”¹å˜çš„å‡½æ•°ã€‚</li></ul><p>å¯¹äºå‰è€…ï¼ŒåŸºç±»é€šå¸¸å°†å…¶å®šä¹‰ä¸ºè™šå‡½æ•°ï¼ˆvirtualï¼‰ã€‚å½“æˆ‘ä»¬ä½¿ç”¨æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œè¯¥è°ƒç”¨å°†è¢«åŠ¨æ€ç»‘å®šã€‚</p><p>ä»»ä½•<strong>æ„é€ å‡½æ•°ä¹‹å¤–çš„éé™æ€å‡½æ•°</strong>ï¼ˆå‚è§7.6èŠ‚ï¼Œç¬¬268é¡µï¼‰éƒ½å¯ä»¥æ˜¯è™šå‡½æ•°ã€‚å…³é”®å­—virtual<strong>åªèƒ½å‡ºç°åœ¨ç±»å†…éƒ¨çš„å£°æ˜è¯­å¥ä¹‹å‰</strong>è€Œä¸èƒ½ç”¨äºç±»å¤–éƒ¨çš„å‡½æ•°å®šä¹‰ã€‚å¦‚æœåŸºç±»æŠŠä¸€ä¸ªå‡½æ•°å£°æ˜æˆè™šå‡½æ•°ï¼Œåˆ™è¯¥å‡½æ•°åœ¨æ´¾ç”Ÿç±»ä¸­éšå¼åœ°ä¹Ÿæ˜¯è™šå‡½æ•°ã€‚</p><p>æˆå‘˜å‡½æ•°å¦‚æœæ²¡è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œåˆ™å…¶è§£æè¿‡ç¨‹å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶è€Œéè¿è¡Œæ—¶ã€‚</p><p><strong>è®¿é—®æ§åˆ¶ä¸ç»§æ‰¿</strong></p><p>æ´¾ç”Ÿç±»å¯ä»¥ç»§æ‰¿å®šä¹‰åœ¨åŸºç±»ä¸­çš„æˆå‘˜ï¼Œä½†æ˜¯æ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°ä¸ä¸€å®šæœ‰æƒè®¿é—®ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„æˆå‘˜ã€‚å’Œå…¶ä»–ä½¿ç”¨åŸºç±»çš„ä»£ç ä¸€æ ·ï¼Œ<strong>æ´¾ç”Ÿç±»èƒ½è®¿é—®å…¬æœ‰æˆå‘˜ï¼Œè€Œä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜ã€‚</strong>ä¸è¿‡åœ¨æŸäº›æ—¶å€™åŸºç±»ä¸­è¿˜æœ‰è¿™æ ·ä¸€ç§æˆå‘˜ï¼ŒåŸºç±»å¸Œæœ›å®ƒçš„æ´¾ç”Ÿç±»æœ‰æƒè®¿é—®è¯¥æˆå‘˜ï¼ŒåŒæ—¶ç¦æ­¢å…¶ä»–ç”¨æˆ·è®¿é—®ã€‚æˆ‘ä»¬ç”¨<strong>å—ä¿æŠ¤çš„ï¼ˆprotectedï¼‰</strong>è®¿é—®è¿ç®—ç¬¦è¯´æ˜è¿™æ ·çš„æˆå‘˜ã€‚</p><h3 id="15-2-2-å®šä¹‰æ´¾ç”Ÿç±»"><a href="#15-2-2-å®šä¹‰æ´¾ç”Ÿç±»" class="headerlink" title="15.2.2 å®šä¹‰æ´¾ç”Ÿç±»"></a>15.2.2 å®šä¹‰æ´¾ç”Ÿç±»</h3><p>æ´¾ç”Ÿç±»å¿…é¡»é€šè¿‡ä½¿ç”¨ç±»æ´¾ç”Ÿåˆ—è¡¨ï¼ˆclass derivation listï¼‰æ˜ç¡®æŒ‡å‡ºå®ƒæ˜¯ä»å“ªä¸ªï¼ˆå“ªäº›ï¼‰åŸºç±»ç»§æ‰¿è€Œæ¥çš„ã€‚ç±»æ´¾ç”Ÿåˆ—è¡¨çš„å½¢å¼æ˜¯ï¼šé¦–å…ˆæ˜¯ä¸€ä¸ªå†’å·ï¼Œåé¢ç´§è·Ÿä»¥é€—å·åˆ†éš”çš„åŸºç±»åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªåŸºç±»å‰é¢å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§è®¿é—®è¯´æ˜ç¬¦ä¸­çš„ä¸€ä¸ªï¼špublicã€protectedæˆ–è€…privateã€‚</p><p>æ´¾ç”Ÿç±»å¿…é¡»å°†å…¶ç»§æ‰¿è€Œæ¥çš„æˆå‘˜å‡½æ•°ä¸­éœ€è¦è¦†ç›–çš„é‚£äº›é‡æ–°å£°æ˜ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929225239979.png"></p><p><strong>æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°</strong></p><p>æ´¾ç”Ÿç±»ç»å¸¸ï¼ˆä½†ä¸æ€»æ˜¯ï¼‰è¦†ç›–å®ƒç»§æ‰¿çš„è™šå‡½æ•°ã€‚å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰è¦†ç›–å…¶åŸºç±»ä¸­çš„æŸä¸ªè™šå‡½æ•°ï¼Œåˆ™è¯¥è™šå‡½æ•°çš„è¡Œä¸ºç±»ä¼¼äºå…¶ä»–çš„æ™®é€šæˆå‘˜ï¼Œæ´¾ç”Ÿç±»ä¼šç›´æ¥ç»§æ‰¿å…¶åœ¨åŸºç±»ä¸­çš„ç‰ˆæœ¬ã€‚</p><p>æ´¾ç”Ÿç±»å¯ä»¥åœ¨å®ƒè¦†ç›–çš„å‡½æ•°å‰ä½¿ç”¨virtualå…³é”®å­—ï¼Œä½†ä¸æ˜¯éå¾—è¿™ä¹ˆåšã€‚æˆ‘ä»¬å°†åœ¨15.3èŠ‚ï¼ˆç¬¬538é¡µï¼‰ä»‹ç»å…¶åŸå› ï¼ŒC++11æ–°æ ‡å‡†å…è®¸æ´¾ç”Ÿç±»æ˜¾å¼åœ°æ³¨æ˜å®ƒä½¿ç”¨æŸä¸ªæˆå‘˜å‡½æ•°è¦†ç›–äº†å®ƒç»§æ‰¿çš„è™šå‡½æ•°ã€‚å…·ä½“åšæ³•æ˜¯</p><ul><li>åœ¨å½¢å‚åˆ—è¡¨åé¢</li><li>æˆ–è€…åœ¨constæˆå‘˜å‡½æ•°ï¼ˆå‚è§7.1.2èŠ‚ï¼Œç¬¬231é¡µï¼‰çš„constå…³é”®å­—åé¢</li><li>æˆ–è€…åœ¨å¼•ç”¨æˆå‘˜å‡½æ•°ï¼ˆå‚è§13.6.3èŠ‚ï¼Œç¬¬483é¡µï¼‰çš„å¼•ç”¨é™å®šç¬¦åé¢</li></ul><p>æ·»åŠ ä¸€ä¸ªå…³é”®å­—overrideã€‚</p><p><strong>æ´¾ç”Ÿç±»å¯¹è±¡åŠæ´¾ç”Ÿç±»å‘åŸºç±»çš„ç±»å‹è½¬æ¢</strong></p><div class="note note-primary">            <p>åœ¨æ´¾ç”Ÿç±»å¯¹è±¡ä¸­å«æœ‰ä¸å…¶åŸºç±»å¯¹åº”çš„ç»„æˆéƒ¨åˆ†ï¼Œè¿™ä¸€äº‹å®æ˜¯ç»§æ‰¿çš„å…³é”®æ‰€åœ¨ã€‚</p>          </div><p>ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡åŒ…å«å¤šä¸ªç»„æˆéƒ¨åˆ†ï¼šä¸€ä¸ªå«æœ‰æ´¾ç”Ÿç±»è‡ªå·±å®šä¹‰çš„ï¼ˆéé™æ€ï¼‰æˆå‘˜çš„å­å¯¹è±¡ï¼Œä»¥åŠä¸€ä¸ªä¸è¯¥æ´¾ç”Ÿç±»ç»§æ‰¿çš„åŸºç±»å¯¹åº”çš„å­å¯¹è±¡ï¼Œå¦‚æœæœ‰å¤šä¸ªåŸºç±»ï¼Œé‚£ä¹ˆè¿™æ ·çš„å­å¯¹è±¡ä¹Ÿæœ‰å¤šä¸ªã€‚</p><p>C++æ ‡å‡†å¹¶æ²¡æœ‰æ˜ç¡®è§„å®šæ´¾ç”Ÿç±»çš„å¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•åˆ†å¸ƒï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®¤ä¸ºBulk_quoteçš„å¯¹è±¡åŒ…å«å¦‚å›¾15.1æ‰€ç¤ºçš„ä¸¤éƒ¨åˆ†ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929225929820.png"></p><p>å› ä¸ºåœ¨æ´¾ç”Ÿç±»å¯¹è±¡ä¸­å«æœ‰ä¸å…¶åŸºç±»å¯¹åº”çš„ç»„æˆéƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½æŠŠæ´¾ç”Ÿç±»çš„å¯¹è±¡å½“æˆåŸºç±»å¯¹è±¡æ¥ä½¿ç”¨ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿèƒ½å°†åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ç»‘å®šåˆ°æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„åŸºç±»éƒ¨åˆ†ä¸Šã€‚è¿™ç§è½¬æ¢é€šå¸¸ç§°ä¸º<strong>æ´¾ç”Ÿç±»åˆ°åŸºç±»çš„ï¼ˆderived-to-baseï¼‰ç±»å‹è½¬æ¢ã€‚</strong></p><p><strong>æ´¾ç”Ÿç±»æ„é€ å‡½æ•°</strong></p><div class="note note-primary">            <p>æ¯ä¸ªç±»æ§åˆ¶å®ƒè‡ªå·±çš„æˆå‘˜åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>          </div><div class="note note-primary">            <p>é¦–å…ˆåˆå§‹åŒ–åŸºç±»çš„éƒ¨åˆ†ï¼Œç„¶åæŒ‰ç…§å£°æ˜çš„é¡ºåºä¾æ¬¡åˆå§‹åŒ–æ´¾ç”Ÿç±»çš„æˆå‘˜ã€‚</p>          </div><p>å°½ç®¡åœ¨æ´¾ç”Ÿç±»å¯¹è±¡ä¸­å«æœ‰ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„æˆå‘˜ï¼Œä½†æ˜¯æ´¾ç”Ÿç±»å¹¶ä¸èƒ½ç›´æ¥åˆå§‹åŒ–è¿™äº›æˆå‘˜ã€‚å’Œå…¶ä»–åˆ›å»ºäº†åŸºç±»å¯¹è±¡çš„ä»£ç ä¸€æ ·ï¼Œæ´¾ç”Ÿç±»ä¹Ÿå¿…é¡»ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–å®ƒçš„åŸºç±»éƒ¨åˆ†ã€‚</p><p><strong>æ´¾ç”Ÿç±»ä½¿ç”¨åŸºç±»çš„æˆå‘˜</strong></p><p>æ´¾ç”Ÿç±»å¯ä»¥è®¿é—®åŸºç±»çš„å…¬æœ‰æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜</p><p><strong>å…³é”®æ¦‚å¿µï¼šéµå¾ªåŸºç±»çš„æ¥å£</strong></p><p>å¿…é¡»æ˜ç¡®ä¸€ç‚¹ï¼šæ¯ä¸ªç±»è´Ÿè´£å®šä¹‰å„è‡ªçš„æ¥å£ã€‚è¦æƒ³ä¸ç±»çš„å¯¹è±¡äº¤äº’å¿…é¡»ä½¿ç”¨è¯¥ç±»çš„æ¥å£ï¼Œå³ä½¿è¿™ä¸ªå¯¹è±¡æ˜¯æ´¾ç”Ÿç±»çš„åŸºç±»éƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å› æ­¤ï¼Œæ´¾ç”Ÿç±»å¯¹è±¡ä¸èƒ½ç›´æ¥åˆå§‹åŒ–åŸºç±»çš„æˆå‘˜ã€‚å°½ç®¡ä»è¯­æ³•ä¸Šæ¥è¯´æˆ‘ä»¬å¯ä»¥åœ¨æ´¾ç”Ÿç±»æ„é€ å‡½æ•°ä½“å†…ç»™å®ƒçš„å…¬æœ‰æˆ–å—ä¿æŠ¤çš„åŸºç±»æˆå‘˜èµ‹å€¼ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦è¿™ä¹ˆåšã€‚å’Œä½¿ç”¨åŸºç±»çš„å…¶ä»–åœºåˆä¸€æ ·ï¼Œæ´¾ç”Ÿç±»åº”è¯¥éµå¾ªåŸºç±»çš„æ¥å£ï¼Œå¹¶ä¸”é€šè¿‡è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–é‚£äº›ä»åŸºç±»ä¸­ç»§æ‰¿è€Œæ¥çš„æˆå‘˜ã€‚</p><p><strong>ç»§æ‰¿ä¸é™æ€æˆå‘˜</strong></p><p>å¦‚æœåŸºç±»å®šä¹‰äº†ä¸€ä¸ªé™æ€æˆå‘˜ï¼ˆå‚è§7.6èŠ‚ï¼Œç¬¬268é¡µï¼‰ï¼Œåˆ™åœ¨æ•´ä¸ªç»§æ‰¿ä½“ç³»ä¸­åªå­˜åœ¨è¯¥æˆå‘˜çš„å”¯ä¸€å®šä¹‰ã€‚ä¸è®ºä»åŸºç±»ä¸­æ´¾ç”Ÿå‡ºæ¥å¤šå°‘ä¸ªæ´¾ç”Ÿç±»ï¼Œå¯¹äºæ¯ä¸ªé™æ€æˆå‘˜æ¥è¯´éƒ½åªå­˜åœ¨å”¯ä¸€çš„å®ä¾‹ã€‚</p><p>é™æ€æˆå‘˜éµå¾ªé€šç”¨çš„è®¿é—®æ§åˆ¶è§„åˆ™ï¼Œå¦‚æœåŸºç±»ä¸­çš„æˆå‘˜æ˜¯privateçš„ï¼Œåˆ™æ´¾ç”Ÿç±»æ— æƒè®¿é—®å®ƒã€‚å‡è®¾æŸé™æ€æˆå‘˜æ˜¯å¯è®¿é—®çš„ï¼Œåˆ™æˆ‘ä»¬æ—¢èƒ½é€šè¿‡åŸºç±»ä½¿ç”¨å®ƒä¹Ÿèƒ½é€šè¿‡æ´¾ç”Ÿç±»ä½¿ç”¨å®ƒ</p><p><strong>æ´¾ç”Ÿç±»çš„å£°æ˜</strong></p><p>æ´¾ç”Ÿç±»çš„å£°æ˜ä¸å…¶ä»–ç±»å·®åˆ«ä¸å¤§ï¼ˆå‚è§7.3.3èŠ‚ï¼Œç¬¬250é¡µï¼‰ï¼Œå£°æ˜ä¸­åŒ…å«ç±»åä½†æ˜¯ä¸åŒ…å«å®ƒçš„æ´¾ç”Ÿåˆ—è¡¨ã€‚</p><p><strong>è¢«ç”¨ä½œåŸºç±»çš„ç±»</strong></p><p>å¦‚æœæˆ‘ä»¬æƒ³å°†æŸä¸ªç±»ç”¨ä½œåŸºç±»ï¼Œåˆ™è¯¥ç±»å¿…é¡»å·²ç»å®šä¹‰è€Œéä»…ä»…å£°æ˜ã€‚</p><p><strong>é˜²æ­¢ç»§æ‰¿çš„å‘ç”Ÿ</strong></p><p>æœ‰æ—¶æˆ‘ä»¬ä¼šå®šä¹‰è¿™æ ·ä¸€ç§ç±»ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å…¶ä»–ç±»ç»§æ‰¿å®ƒï¼Œæˆ–è€…ä¸æƒ³è€ƒè™‘å®ƒæ˜¯å¦é€‚åˆä½œä¸ºä¸€ä¸ªåŸºç±»ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼ŒC++11æ–°æ ‡å‡†æä¾›äº†ä¸€ç§é˜²æ­¢ç»§æ‰¿å‘ç”Ÿçš„æ–¹æ³•ï¼Œå³åœ¨ç±»ååè·Ÿä¸€ä¸ª<strong>å…³é”®å­—final</strong></p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929230835841.png"></p><h3 id="15-2-3-ç±»å‹è½¬æ¢ä¸ç»§æ‰¿"><a href="#15-2-3-ç±»å‹è½¬æ¢ä¸ç»§æ‰¿" class="headerlink" title="15.2.3 ç±»å‹è½¬æ¢ä¸ç»§æ‰¿"></a>15.2.3 ç±»å‹è½¬æ¢ä¸ç»§æ‰¿</h3><p>å¯ä»¥å°†åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ç»‘å®šåˆ°æ´¾ç”Ÿç±»å¯¹è±¡ä¸Šæœ‰ä¸€å±‚æä¸ºé‡è¦çš„å«ä¹‰ï¼šå½“ä½¿ç”¨åŸºç±»çš„å¼•ç”¨ï¼ˆæˆ–æŒ‡é’ˆï¼‰æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šè¯¥å¼•ç”¨ï¼ˆæˆ–æŒ‡é’ˆï¼‰æ‰€ç»‘å®šå¯¹è±¡çš„çœŸå®ç±»å‹ã€‚è¯¥å¯¹è±¡å¯èƒ½æ˜¯åŸºç±»çš„å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯æ´¾ç”Ÿç±»çš„å¯¹è±¡ã€‚</p><div class="note note-primary">            <p>å’Œå†…ç½®æŒ‡é’ˆä¸€æ ·ï¼Œæ™ºèƒ½æŒ‡é’ˆç±»ï¼ˆå‚è§12.1èŠ‚ï¼Œç¬¬400é¡µï¼‰ä¹Ÿæ”¯æŒæ´¾ç”Ÿç±»å‘åŸºç±»çš„ç±»å‹è½¬æ¢ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡çš„æŒ‡é’ˆå­˜å‚¨åœ¨ä¸€ä¸ªåŸºç±»çš„æ™ºèƒ½æŒ‡é’ˆå†…</p>          </div><p><strong>é™æ€ç±»å‹ä¸åŠ¨æ€ç±»å‹</strong></p><p>è¡¨è¾¾å¼çš„<strong>é™æ€ç±»å‹</strong>åœ¨ç¼–è¯‘æ—¶æ€»æ˜¯å·²çŸ¥çš„ï¼Œå®ƒæ˜¯å˜é‡å£°æ˜æ—¶çš„ç±»å‹æˆ–è¡¨è¾¾å¼ç”Ÿæˆçš„ç±»å‹ï¼›<strong>åŠ¨æ€ç±»å‹</strong>åˆ™æ˜¯å˜é‡æˆ–è¡¨è¾¾å¼è¡¨ç¤ºçš„å†…å­˜ä¸­çš„å¯¹è±¡çš„ç±»å‹ã€‚åŠ¨æ€ç±»å‹ç›´åˆ°è¿è¡Œæ—¶æ‰å¯çŸ¥ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“print_totalè°ƒç”¨net_priceæ—¶ï¼Œæˆ‘ä»¬çŸ¥é“itemçš„é™æ€ç±»å‹æ˜¯Quote&amp;ï¼Œå®ƒçš„åŠ¨æ€ç±»å‹åˆ™ä¾èµ–äºitemç»‘å®šçš„å®å‚ï¼ŒåŠ¨æ€ç±»å‹ç›´åˆ°åœ¨è¿è¡Œæ—¶è°ƒç”¨è¯¥å‡½æ•°æ—¶æ‰ä¼šçŸ¥é“ã€‚å¦‚æœæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªBulk_quoteå¯¹è±¡ç»™print_totalï¼Œåˆ™itemçš„é™æ€ç±»å‹å°†ä¸å®ƒçš„åŠ¨æ€ç±»å‹ä¸ä¸€è‡´ã€‚</p><p><strong>å¦‚æœè¡¨è¾¾å¼æ—¢ä¸æ˜¯å¼•ç”¨ä¹Ÿä¸æ˜¯æŒ‡é’ˆï¼Œåˆ™å®ƒçš„åŠ¨æ€ç±»å‹æ°¸è¿œä¸é™æ€ç±»å‹ä¸€è‡´ã€‚</strong></p><p><strong>ä¸å­˜åœ¨ä»åŸºç±»å‘æ´¾ç”Ÿç±»çš„éšå¼ç±»å‹è½¬æ¢</strong></p><p>ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šæŸä¸ªç‰¹å®šçš„è½¬æ¢åœ¨è¿è¡Œæ—¶æ˜¯å¦å®‰å…¨ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨åªèƒ½é€šè¿‡æ£€æŸ¥æŒ‡é’ˆæˆ–å¼•ç”¨çš„é™æ€ç±»å‹æ¥æ¨æ–­è¯¥è½¬æ¢æ˜¯å¦åˆæ³•ã€‚å¦‚æœåœ¨åŸºç±»ä¸­å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè™šå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨dynamic_castï¼ˆå‚è§19.2.1èŠ‚ï¼Œç¬¬730é¡µï¼‰è¯·æ±‚ä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œè¯¥è½¬æ¢çš„å®‰å…¨æ£€æŸ¥å°†åœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬å·²çŸ¥æŸä¸ªåŸºç±»å‘æ´¾ç”Ÿç±»çš„è½¬æ¢æ˜¯å®‰å…¨çš„ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨static_castï¼ˆå‚è§4.11.3èŠ‚ï¼Œç¬¬144é¡µï¼‰æ¥å¼ºåˆ¶è¦†ç›–æ‰ç¼–è¯‘å™¨çš„æ£€æŸ¥å·¥ä½œã€‚</p><p><strong>åœ¨å¯¹è±¡ä¹‹é—´ä¸å­˜åœ¨ç±»å‹è½¬æ¢</strong></p><div class="note note-primary">            <p>å½“æˆ‘ä»¬ç”¨ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡ä¸ºä¸€ä¸ªåŸºç±»å¯¹è±¡åˆå§‹åŒ–æˆ–èµ‹å€¼æ—¶ï¼Œåªæœ‰è¯¥æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„åŸºç±»éƒ¨åˆ†ä¼šè¢«æ‹·è´ã€ç§»åŠ¨æˆ–èµ‹å€¼ï¼Œå®ƒçš„æ´¾ç”Ÿç±»éƒ¨åˆ†å°†è¢«å¿½ç•¥æ‰ã€‚</p>          </div><p>æ´¾ç”Ÿç±»å‘åŸºç±»çš„è‡ªåŠ¨ç±»å‹è½¬æ¢åªå¯¹æŒ‡é’ˆæˆ–å¼•ç”¨ç±»å‹æœ‰æ•ˆï¼Œåœ¨æ´¾ç”Ÿç±»ç±»å‹å’ŒåŸºç±»ç±»å‹ä¹‹é—´ä¸å­˜åœ¨è¿™æ ·çš„è½¬æ¢ã€‚</p><h2 id="15-3-è™šå‡½æ•°"><a href="#15-3-è™šå‡½æ•°" class="headerlink" title="15.3 è™šå‡½æ•°"></a>15.3 è™šå‡½æ•°</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨åŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆè°ƒç”¨ä¸€ä¸ªè™šæˆå‘˜å‡½æ•°æ—¶ä¼šæ‰§è¡ŒåŠ¨æ€ç»‘å®šã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨æŸä¸ªå‡½æ•°ï¼Œåˆ™æ— é¡»ä¸ºè¯¥å‡½æ•°æä¾›å®šä¹‰ï¼ˆå‚è§6.1.2èŠ‚ï¼Œç¬¬186é¡µï¼‰ã€‚ä½†æ˜¯æˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸€ä¸ªè™šå‡½æ•°éƒ½æä¾›å®šä¹‰ï¼Œè€Œä¸ç®¡å®ƒæ˜¯å¦è¢«ç”¨åˆ°äº†ï¼Œè¿™æ˜¯å› ä¸ºè¿ç¼–è¯‘å™¨ä¹Ÿæ— æ³•ç¡®å®šåˆ°åº•ä¼šä½¿ç”¨å“ªä¸ªè™šå‡½æ•°ã€‚</p><p><strong>å¯¹è™šå‡½æ•°çš„è°ƒç”¨å¯èƒ½åœ¨è¿è¡Œæ—¶æ‰è¢«è§£æ</strong></p><p>åŠ¨æ€ç»‘å®šåªæœ‰å½“æˆ‘ä»¬é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨è°ƒç”¨è™šå‡½æ•°æ—¶æ‰ä¼šå‘ç”Ÿã€‚å½“æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·æœ‰æ™®é€šç±»å‹ï¼ˆéå¼•ç”¨éæŒ‡é’ˆï¼‰çš„è¡¨è¾¾å¼è°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œåœ¨ç¼–è¯‘æ—¶å°±ä¼šå°†è°ƒç”¨çš„ç‰ˆæœ¬ç¡®å®šä¸‹æ¥ã€‚</p><p><strong>å…³é”®æ¦‚å¿µï¼šC++çš„å¤šæ€æ€§</strong></p><p>OOPçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¤šæ€æ€§ï¼ˆpolymorphismï¼‰ã€‚æŠŠå…·æœ‰ç»§æ‰¿å…³ç³»çš„å¤šä¸ªç±»å‹ç§°ä¸ºå¤šæ€ç±»å‹ï¼Œå› ä¸ºæˆ‘ä»¬èƒ½ä½¿ç”¨è¿™äº›ç±»å‹çš„â€œå¤šç§å½¢å¼â€è€Œæ— é¡»åœ¨æ„å®ƒä»¬çš„å·®å¼‚ã€‚å¼•ç”¨æˆ–æŒ‡é’ˆçš„é™æ€ç±»å‹ä¸åŠ¨æ€ç±»å‹ä¸åŒè¿™ä¸€äº‹å®æ­£æ˜¯C++è¯­è¨€æ”¯æŒå¤šæ€æ€§çš„æ ¹æœ¬æ‰€åœ¨ã€‚</p><p><strong>æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°</strong></p><p>å½“æˆ‘ä»¬åœ¨æ´¾ç”Ÿç±»ä¸­è¦†ç›–äº†æŸä¸ªè™šå‡½æ•°æ—¶ï¼Œå¯ä»¥å†ä¸€æ¬¡ä½¿ç”¨virtualå…³é”®å­—æŒ‡å‡ºè¯¥å‡½æ•°çš„æ€§è´¨ã€‚ç„¶è€Œè¿™ä¹ˆåšå¹¶éå¿…é¡»ï¼Œå› ä¸ºä¸€æ—¦æŸä¸ªå‡½æ•°è¢«å£°æ˜æˆè™šå‡½æ•°ï¼Œåˆ™åœ¨æ‰€æœ‰æ´¾ç”Ÿç±»ä¸­å®ƒéƒ½æ˜¯è™šå‡½æ•°ã€‚</p><p>ä¸€ä¸ªæ´¾ç”Ÿç±»çš„å‡½æ•°å¦‚æœè¦†ç›–äº†æŸä¸ªç»§æ‰¿è€Œæ¥çš„è™šå‡½æ•°ï¼Œåˆ™å®ƒçš„å½¢å‚ç±»å‹å¿…é¡»ä¸è¢«å®ƒè¦†ç›–çš„åŸºç±»å‡½æ•°å®Œå…¨ä¸€è‡´ã€‚</p><p>åŒæ ·ï¼Œæ´¾ç”Ÿç±»ä¸­è™šå‡½æ•°çš„è¿”å›ç±»å‹ä¹Ÿå¿…é¡»ä¸åŸºç±»å‡½æ•°åŒ¹é…ã€‚è¯¥è§„åˆ™å­˜åœ¨ä¸€ä¸ªä¾‹å¤–ï¼Œå½“ç±»çš„è™šå‡½æ•°è¿”å›ç±»å‹æ˜¯ç±»æœ¬èº«çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ—¶ï¼Œä¸Šè¿°è§„åˆ™æ— æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœDç”±Bæ´¾ç”Ÿå¾—åˆ°ï¼Œåˆ™åŸºç±»çš„è™šå‡½æ•°å¯ä»¥è¿”å›Bï¼Šè€Œæ´¾ç”Ÿç±»çš„å¯¹åº”å‡½æ•°å¯ä»¥è¿”å›Dï¼Šï¼Œåªä¸è¿‡è¿™æ ·çš„è¿”å›ç±»å‹è¦æ±‚ä»Dåˆ°Bçš„ç±»å‹è½¬æ¢æ˜¯å¯è®¿é—®çš„ã€‚</p><p><strong>finalå’Œoverrideè¯´æ˜ç¬¦</strong></p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929232926332.png"></p><p>æ´¾ç”Ÿç±»å¦‚æœå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ä¸åŸºç±»ä¸­è™šå‡½æ•°çš„åå­—ç›¸åŒä½†æ˜¯å½¢å‚åˆ—è¡¨ä¸åŒï¼Œè¿™ä»ç„¶æ˜¯åˆæ³•çš„è¡Œä¸ºã€‚ç¼–è¯‘å™¨å°†è®¤ä¸ºæ–°å®šä¹‰çš„è¿™ä¸ªå‡½æ•°ä¸åŸºç±»ä¸­åŸæœ‰çš„å‡½æ•°æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è¿™æ—¶ï¼Œæ´¾ç”Ÿç±»çš„å‡½æ•°å¹¶æ²¡æœ‰è¦†ç›–æ‰åŸºç±»ä¸­çš„ç‰ˆæœ¬ã€‚</p><p>åœ¨C++11æ–°æ ‡å‡†ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨overrideå…³é”®å­—æ¥è¯´æ˜æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯åœ¨ä½¿å¾—ç¨‹åºå‘˜çš„æ„å›¾æ›´åŠ æ¸…æ™°çš„åŒæ—¶è®©ç¼–è¯‘å™¨å¯ä»¥ä¸ºæˆ‘ä»¬å‘ç°ä¸€äº›é”™è¯¯ï¼Œåè€…åœ¨ç¼–ç¨‹å®è·µä¸­æ˜¾å¾—æ›´åŠ é‡è¦ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨overrideæ ‡è®°äº†æŸä¸ªå‡½æ•°ï¼Œä½†è¯¥å‡½æ•°å¹¶æ²¡æœ‰è¦†ç›–å·²å­˜åœ¨çš„è™šå‡½æ•°ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨å°†æŠ¥é”™ã€‚</p><p>è¿˜èƒ½æŠŠæŸä¸ªå‡½æ•°æŒ‡å®šä¸ºfinalï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æŠŠå‡½æ•°å®šä¹‰æˆfinaläº†ï¼Œåˆ™ä¹‹åä»»ä½•å°è¯•è¦†ç›–è¯¥å‡½æ•°çš„æ“ä½œéƒ½å°†å¼•å‘é”™è¯¯ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929232944340.png"></p><p>finalå’Œoverrideè¯´æ˜ç¬¦å‡ºç°åœ¨å½¢å‚åˆ—è¡¨ï¼ˆåŒ…æ‹¬ä»»ä½•constæˆ–å¼•ç”¨ä¿®é¥°ç¬¦ï¼‰ä»¥åŠå°¾ç½®è¿”å›ç±»å‹ï¼ˆå‚è§6.3.3èŠ‚ï¼Œç¬¬206é¡µï¼‰ä¹‹åã€‚</p><p><strong>è™šå‡½æ•°ä¸é»˜è®¤å®å‚</strong></p><div class="note note-primary">            <p>å¦‚æœè™šå‡½æ•°ä½¿ç”¨é»˜è®¤å®å‚ï¼Œåˆ™åŸºç±»å’Œæ´¾ç”Ÿç±»ä¸­å®šä¹‰çš„é»˜è®¤å®å‚æœ€å¥½ä¸€è‡´ã€‚</p>          </div><p>è™šå‡½æ•°ä¹Ÿå¯ä»¥æ‹¥æœ‰é»˜è®¤å®å‚ï¼ˆå‚è§6.5.1èŠ‚ï¼Œç¬¬211é¡µï¼‰ã€‚å¦‚æœæŸæ¬¡å‡½æ•°è°ƒç”¨ä½¿ç”¨äº†é»˜è®¤å®å‚ï¼Œåˆ™è¯¥å®å‚å€¼ç”±æœ¬æ¬¡è°ƒç”¨çš„é™æ€ç±»å‹å†³å®šã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡åŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼Œåˆ™ä½¿ç”¨åŸºç±»ä¸­å®šä¹‰çš„é»˜è®¤å®å‚ï¼Œå³ä½¿å®é™…è¿è¡Œçš„æ˜¯æ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°ç‰ˆæœ¬ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p><strong>å›é¿è™šå‡½æ•°çš„æœºåˆ¶</strong></p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è™šå‡½æ•°çš„è°ƒç”¨ä¸è¦è¿›è¡ŒåŠ¨æ€ç»‘å®šï¼Œè€Œæ˜¯å¼ºè¿«å…¶æ‰§è¡Œè™šå‡½æ•°çš„æŸä¸ªç‰¹å®šç‰ˆæœ¬ã€‚ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦å¯ä»¥å®ç°è¿™ä¸€ç›®çš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç </p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929233126493.png"></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰æˆå‘˜å‡½æ•°ï¼ˆæˆ–å‹å…ƒï¼‰ä¸­çš„ä»£ç æ‰éœ€è¦ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥å›é¿è™šå‡½æ•°çš„æœºåˆ¶ã€‚</p><p>ä»€ä¹ˆæ—¶å€™æˆ‘ä»¬éœ€è¦å›é¿è™šå‡½æ•°çš„é»˜è®¤æœºåˆ¶å‘¢ï¼Ÿé€šå¸¸æ˜¯å½“ä¸€ä¸ªæ´¾ç”Ÿç±»çš„è™šå‡½æ•°è°ƒç”¨å®ƒè¦†ç›–çš„åŸºç±»çš„è™šå‡½æ•°ç‰ˆæœ¬æ—¶ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼ŒåŸºç±»çš„ç‰ˆæœ¬é€šå¸¸å®Œæˆç»§æ‰¿å±‚æ¬¡ä¸­æ‰€æœ‰ç±»å‹éƒ½è¦åšçš„å…±åŒä»»åŠ¡ï¼Œè€Œæ´¾ç”Ÿç±»ä¸­å®šä¹‰çš„ç‰ˆæœ¬éœ€è¦æ‰§è¡Œä¸€äº›ä¸æ´¾ç”Ÿç±»æœ¬èº«å¯†åˆ‡ç›¸å…³çš„æ“ä½œã€‚</p><div class="note note-warning">            <p>å¦‚æœä¸€ä¸ªæ´¾ç”Ÿç±»è™šå‡½æ•°éœ€è¦è°ƒç”¨å®ƒçš„åŸºç±»ç‰ˆæœ¬ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦ï¼Œåˆ™åœ¨è¿è¡Œæ—¶è¯¥è°ƒç”¨å°†è¢«è§£æä¸ºå¯¹æ´¾ç”Ÿç±»ç‰ˆæœ¬è‡ªèº«çš„è°ƒç”¨ï¼Œä»è€Œå¯¼è‡´æ— é™é€’å½’ã€‚</p>          </div><h2 id="15-4-æŠ½è±¡åŸºç±»"><a href="#15-4-æŠ½è±¡åŸºç±»" class="headerlink" title="15.4 æŠ½è±¡åŸºç±»"></a>15.4 æŠ½è±¡åŸºç±»</h2><p><strong>çº¯è™šå‡½æ•°</strong></p><p>å¯ä»¥å°†net_priceå®šä¹‰æˆ<strong>çº¯è™šï¼ˆpure virtualï¼‰å‡½æ•°</strong>ä»è€Œä»¤ç¨‹åºå®ç°æˆ‘ä»¬çš„è®¾è®¡æ„å›¾ï¼Œè¿™æ ·åšå¯ä»¥æ¸…æ™°æ˜äº†åœ°å‘Šè¯‰ç”¨æˆ·å½“å‰è¿™ä¸ªnet_priceå‡½æ•°æ˜¯æ²¡æœ‰å®é™…æ„ä¹‰çš„ã€‚å’Œæ™®é€šçš„è™šå‡½æ•°ä¸ä¸€æ ·ï¼Œä¸€ä¸ªçº¯è™šå‡½æ•°æ— é¡»å®šä¹‰ã€‚æˆ‘ä»¬é€šè¿‡åœ¨å‡½æ•°ä½“çš„ä½ç½®ï¼ˆå³åœ¨å£°æ˜è¯­å¥çš„åˆ†å·ä¹‹å‰ï¼‰ä¹¦å†™&#x3D;0å°±å¯ä»¥å°†ä¸€ä¸ªè™šå‡½æ•°è¯´æ˜ä¸ºçº¯è™šå‡½æ•°ã€‚å…¶ä¸­ï¼Œ&#x3D;0åªèƒ½å‡ºç°åœ¨ç±»å†…éƒ¨çš„è™šå‡½æ•°å£°æ˜è¯­å¥å¤„</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929233710084.png"></p><p>å°½ç®¡æˆ‘ä»¬ä¸èƒ½ç›´æ¥å®šä¹‰è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œä½†æ˜¯Disc_quoteçš„æ´¾ç”Ÿç±»æ„é€ å‡½æ•°å°†ä¼šä½¿ç”¨Disc_quoteçš„æ„é€ å‡½æ•°æ¥æ„å»ºå„ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡çš„Disc_quoteéƒ¨åˆ†ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºçº¯è™šå‡½æ•°æä¾›å®šä¹‰ï¼Œä¸è¿‡å‡½æ•°ä½“å¿…é¡»å®šä¹‰åœ¨ç±»çš„å¤–éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ç±»çš„å†…éƒ¨ä¸ºä¸€ä¸ª&#x3D;0çš„å‡½æ•°æä¾›å‡½æ•°ä½“ã€‚</p><p><strong>å«æœ‰çº¯è™šå‡½æ•°çš„ç±»æ˜¯æŠ½è±¡åŸºç±»</strong></p><p>å«æœ‰ï¼ˆæˆ–è€…æœªç»è¦†ç›–ç›´æ¥ç»§æ‰¿ï¼‰çº¯è™šå‡½æ•°çš„ç±»æ˜¯æŠ½è±¡åŸºç±»ï¼ˆabstract base classï¼‰ã€‚æŠ½è±¡åŸºç±»è´Ÿè´£å®šä¹‰æ¥å£ï¼Œè€Œåç»­çš„å…¶ä»–ç±»å¯ä»¥è¦†ç›–è¯¥æ¥å£ã€‚æˆ‘ä»¬ä¸èƒ½ï¼ˆç›´æ¥ï¼‰åˆ›å»ºä¸€ä¸ªæŠ½è±¡åŸºç±»çš„å¯¹è±¡ã€‚å› ä¸ºDisc_quoteå°†net_priceå®šä¹‰æˆäº†çº¯è™šå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å®šä¹‰Disc_quoteçš„å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰Disc_quoteçš„æ´¾ç”Ÿç±»çš„å¯¹è±¡ï¼Œå‰ææ˜¯è¿™äº›ç±»è¦†ç›–äº†net_priceå‡½æ•°ã€‚</p><p>Disc_quoteçš„æ´¾ç”Ÿç±»å¿…é¡»ç»™å‡ºè‡ªå·±çš„net_priceå®šä¹‰ï¼Œå¦åˆ™å®ƒä»¬ä»å°†æ˜¯æŠ½è±¡åŸºç±»ã€‚</p><p><strong>æ´¾ç”Ÿç±»æ„é€ å‡½æ•°åªåˆå§‹åŒ–å®ƒçš„ç›´æ¥åŸºç±»</strong></p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929233925603.png"></p><p>è¿™ä¸ªç‰ˆæœ¬çš„Bulk_quoteçš„ç›´æ¥åŸºç±»æ˜¯Disc_quoteï¼Œé—´æ¥åŸºç±»æ˜¯Quoteã€‚æ¯ä¸ªBulk_quoteå¯¹è±¡åŒ…å«ä¸‰ä¸ªå­å¯¹è±¡ï¼šä¸€ä¸ªï¼ˆç©ºçš„ï¼‰Bulk_quoteéƒ¨åˆ†ã€ä¸€ä¸ªDisc_quoteå­å¯¹è±¡å’Œä¸€ä¸ªQuoteå­å¯¹è±¡ã€‚è¯¥æ„é€ å‡½æ•°å°†å®ƒçš„å®å‚ä¼ é€’ç»™Disc_quoteçš„æ„é€ å‡½æ•°ï¼ŒéšåDisc_quoteçš„æ„é€ å‡½æ•°ç»§ç»­è°ƒç”¨Quoteçš„æ„é€ å‡½æ•°ã€‚Quoteçš„æ„é€ å‡½æ•°é¦–å…ˆåˆå§‹åŒ–bulkçš„bookNoå’Œpriceæˆå‘˜ï¼Œå½“Quoteçš„æ„é€ å‡½æ•°ç»“æŸåï¼Œå¼€å§‹è¿è¡ŒDisc_quoteçš„æ„é€ å‡½æ•°å¹¶åˆå§‹åŒ–quantityå’Œdiscountæˆå‘˜ï¼Œæœ€åè¿è¡ŒBulk_quoteçš„æ„é€ å‡½æ•°ï¼Œè¯¥å‡½æ•°æ— é¡»æ‰§è¡Œå®é™…çš„åˆå§‹åŒ–æˆ–å…¶ä»–å·¥ä½œã€‚</p><p><strong>å…³é”®æ¦‚å¿µï¼šé‡æ„</strong></p><p>åœ¨Quoteçš„ç»§æ‰¿ä½“ç³»ä¸­å¢åŠ Disc_quoteç±»æ˜¯é‡æ„ï¼ˆrefactoringï¼‰çš„ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ã€‚é‡æ„è´Ÿè´£é‡æ–°è®¾è®¡ç±»çš„ä½“ç³»ä»¥ä¾¿å°†æ“ä½œå’Œ&#x2F;æˆ–æ•°æ®ä»ä¸€ä¸ªç±»ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç±»ä¸­ã€‚å¯¹äºé¢å‘å¯¹è±¡çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œé‡æ„æ˜¯ä¸€ç§å¾ˆæ™®éçš„ç°è±¡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬æ”¹å˜äº†æ•´ä¸ªç»§æ‰¿ä½“ç³»ï¼Œé‚£äº›ä½¿ç”¨äº†Bulk_quoteæˆ–Quoteçš„ä»£ç ä¹Ÿæ— é¡»è¿›è¡Œä»»ä½•æ”¹åŠ¨ã€‚ä¸è¿‡ä¸€æ—¦ç±»è¢«é‡æ„ï¼ˆæˆ–ä»¥å…¶ä»–æ–¹å¼è¢«æ”¹å˜ï¼‰ï¼Œå°±æ„å‘³ç€æˆ‘ä»¬å¿…é¡»é‡æ–°ç¼–è¯‘å«æœ‰è¿™äº›ç±»çš„ä»£ç äº†ã€‚</p><p><strong>å—ä¿æŠ¤çš„æˆå‘˜</strong></p><p>ä¸€ä¸ªç±»ä½¿ç”¨protectedå…³é”®å­—æ¥å£°æ˜é‚£äº›å®ƒå¸Œæœ›ä¸æ´¾ç”Ÿç±»åˆ†äº«ä½†æ˜¯ä¸æƒ³è¢«å…¶ä»–å…¬å…±è®¿é—®ä½¿ç”¨çš„æˆå‘˜ã€‚</p><ul><li>å’Œç§æœ‰æˆå‘˜ç±»ä¼¼ï¼Œå—ä¿æŠ¤çš„æˆå‘˜å¯¹äºç±»çš„ç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è®¿é—®çš„ã€‚</li><li>å’Œå…¬æœ‰æˆå‘˜ç±»ä¼¼ï¼Œå—ä¿æŠ¤çš„æˆå‘˜å¯¹äºæ´¾ç”Ÿç±»çš„æˆå‘˜å’Œå‹å…ƒæ¥è¯´æ˜¯å¯è®¿é—®çš„ã€‚</li><li>æ­¤å¤–ï¼Œprotectedè¿˜æœ‰å¦å¤–ä¸€æ¡é‡è¦çš„æ€§è´¨ã€‚æ´¾ç”Ÿç±»çš„æˆå‘˜æˆ–å‹å…ƒåªèƒ½é€šè¿‡æ´¾ç”Ÿç±»å¯¹è±¡æ¥è®¿é—®åŸºç±»çš„å—ä¿æŠ¤æˆå‘˜ã€‚æ´¾ç”Ÿç±»å¯¹äºä¸€ä¸ªåŸºç±»å¯¹è±¡ä¸­çš„å—ä¿æŠ¤æˆå‘˜æ²¡æœ‰ä»»ä½•è®¿é—®ç‰¹æƒã€‚</li></ul><p>ä¸ºäº†ç†è§£æœ€åä¸€æ¡è§„åˆ™ï¼Œè¯·è€ƒè™‘å¦‚ä¸‹çš„ä¾‹å­</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929234449633.png"></p><p>å¦‚æœæ´¾ç”Ÿç±»ï¼ˆåŠå…¶å‹å…ƒï¼‰èƒ½è®¿é—®åŸºç±»å¯¹è±¡çš„å—ä¿æŠ¤æˆå‘˜ï¼Œåˆ™ä¸Šé¢çš„ç¬¬äºŒä¸ªclobberï¼ˆæ¥å—ä¸€ä¸ªBase&amp;ï¼‰å°†æ˜¯åˆæ³•çš„ã€‚è¯¥å‡½æ•°ä¸æ˜¯Baseçš„å‹å…ƒï¼Œä½†æ˜¯å®ƒä»ç„¶èƒ½å¤Ÿæ”¹å˜ä¸€ä¸ªBaseå¯¹è±¡çš„å†…å®¹ã€‚å¦‚æœæŒ‰ç…§è¿™æ ·çš„æ€è·¯ï¼Œåˆ™æˆ‘ä»¬åªè¦å®šä¹‰ä¸€ä¸ªå½¢å¦‚Sneaky çš„æ–°ç±»å°±èƒ½éå¸¸ç®€å•åœ°è§„é¿æ‰protectedæä¾›çš„è®¿é—®ä¿æŠ¤äº†ã€‚</p><p>è¦æƒ³é˜»æ­¢ä»¥ä¸Šçš„ç”¨æ³•ï¼Œæˆ‘ä»¬å°±è¦åšå‡ºå¦‚ä¸‹è§„å®šï¼Œå³æ´¾ç”Ÿç±»çš„æˆå‘˜å’Œå‹å…ƒåªèƒ½è®¿é—®æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„åŸºç±»éƒ¨åˆ†çš„å—ä¿æŠ¤æˆå‘˜ï¼›å¯¹äºæ™®é€šçš„åŸºç±»å¯¹è±¡ä¸­çš„æˆå‘˜ä¸å…·æœ‰ç‰¹æ®Šçš„è®¿é—®æƒé™ã€‚</p><p><strong>å…¬æœ‰ã€ç§æœ‰å’Œå—ä¿æŠ¤ç»§æ‰¿</strong></p><p>æŸä¸ªç±»å¯¹å…¶ç»§æ‰¿è€Œæ¥çš„æˆå‘˜çš„è®¿é—®æƒé™å—åˆ°ä¸¤ä¸ªå› ç´ å½±å“ï¼šä¸€æ˜¯åœ¨åŸºç±»ä¸­è¯¥æˆå‘˜çš„è®¿é—®è¯´æ˜ç¬¦ï¼ŒäºŒæ˜¯åœ¨æ´¾ç”Ÿç±»çš„æ´¾ç”Ÿåˆ—è¡¨ä¸­çš„è®¿é—®è¯´æ˜ç¬¦ã€‚</p><p>æ´¾ç”Ÿè®¿é—®è¯´æ˜ç¬¦å¯¹äº<strong>æ´¾ç”Ÿç±»çš„æˆå‘˜ï¼ˆåŠå‹å…ƒï¼‰</strong>èƒ½å¦è®¿é—®å…¶ç›´æ¥åŸºç±»çš„æˆå‘˜æ²¡ä»€ä¹ˆå½±å“ã€‚å¯¹åŸºç±»æˆå‘˜çš„è®¿é—®æƒé™åªä¸åŸºç±»ä¸­çš„è®¿é—®è¯´æ˜ç¬¦æœ‰å…³ã€‚</p><p>æ´¾ç”Ÿè®¿é—®è¯´æ˜ç¬¦çš„ç›®çš„æ˜¯<strong>æ§åˆ¶æ´¾ç”Ÿç±»ç”¨æˆ·ï¼ˆåŒ…æ‹¬æ´¾ç”Ÿç±»çš„æ´¾ç”Ÿç±»åœ¨å†…ï¼‰</strong>å¯¹äºåŸºç±»æˆå‘˜çš„è®¿é—®æƒé™ã€‚</p><p><strong>æ´¾ç”Ÿç±»å‘åŸºç±»è½¬æ¢çš„å¯è®¿é—®æ€§</strong></p><p>æ´¾ç”Ÿç±»å‘åŸºç±»çš„è½¬æ¢ï¼ˆå‚è§15.2.2èŠ‚ï¼Œç¬¬530é¡µï¼‰æ˜¯å¦å¯è®¿é—®ç”±ä½¿ç”¨è¯¥è½¬æ¢çš„ä»£ç å†³å®šï¼ŒåŒæ—¶æ´¾ç”Ÿç±»çš„æ´¾ç”Ÿè®¿é—®è¯´æ˜ç¬¦ä¹Ÿä¼šæœ‰å½±å“ã€‚å‡å®šDç»§æ‰¿è‡ªBï¼š</p><ul><li>åªæœ‰å½“Då…¬æœ‰åœ°ç»§æ‰¿Bæ—¶ï¼Œç”¨æˆ·ä»£ç æ‰èƒ½ä½¿ç”¨æ´¾ç”Ÿç±»å‘åŸºç±»çš„è½¬æ¢ï¼›å¦‚æœDç»§æ‰¿Bçš„æ–¹å¼æ˜¯å—ä¿æŠ¤çš„æˆ–è€…ç§æœ‰çš„ï¼Œåˆ™ç”¨æˆ·ä»£ç ä¸èƒ½ä½¿ç”¨è¯¥è½¬æ¢ã€‚</li><li>ä¸è®ºDä»¥ä»€ä¹ˆæ–¹å¼ç»§æ‰¿Bï¼ŒDçš„æˆå‘˜å‡½æ•°å’Œå‹å…ƒéƒ½èƒ½ä½¿ç”¨æ´¾ç”Ÿç±»å‘åŸºç±»çš„è½¬æ¢ï¼›æ´¾ç”Ÿç±»å‘å…¶ç›´æ¥åŸºç±»çš„ç±»å‹è½¬æ¢å¯¹äºæ´¾ç”Ÿç±»çš„æˆå‘˜å’Œå‹å…ƒæ¥è¯´æ°¸è¿œæ˜¯å¯è®¿é—®çš„ã€‚</li><li>å¦‚æœDç»§æ‰¿Bçš„æ–¹å¼æ˜¯å…¬æœ‰çš„æˆ–è€…å—ä¿æŠ¤çš„ï¼Œåˆ™Dçš„æ´¾ç”Ÿç±»çš„æˆå‘˜å’Œå‹å…ƒå¯ä»¥ä½¿ç”¨Då‘Bçš„ç±»å‹è½¬æ¢ï¼›åä¹‹ï¼Œå¦‚æœDç»§æ‰¿Bçš„æ–¹å¼æ˜¯ç§æœ‰çš„ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ã€‚</li></ul><p><strong>å…³é”®æ¦‚å¿µï¼šç±»çš„è®¾è®¡ä¸å—ä¿æŠ¤çš„æˆå‘˜</strong></p><p>ä¸è€ƒè™‘ç»§æ‰¿çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸€ä¸ªç±»æœ‰ä¸¤ç§ä¸åŒçš„ç”¨æˆ·ï¼šæ™®é€šç”¨æˆ·å’Œç±»çš„å®ç°è€…ã€‚å…¶ä¸­ï¼Œæ™®é€šç”¨æˆ·ç¼–å†™çš„ä»£ç ä½¿ç”¨ç±»çš„å¯¹è±¡ï¼Œè¿™éƒ¨åˆ†ä»£ç åªèƒ½è®¿é—®ç±»çš„å…¬æœ‰ï¼ˆæ¥å£ï¼‰æˆå‘˜ï¼›å®ç°è€…åˆ™è´Ÿè´£ç¼–å†™ç±»çš„æˆå‘˜å’Œå‹å…ƒçš„ä»£ç ï¼Œæˆå‘˜å’Œå‹å…ƒæ—¢èƒ½è®¿é—®ç±»çš„å…¬æœ‰éƒ¨åˆ†ï¼Œä¹Ÿèƒ½è®¿é—®ç±»çš„ç§æœ‰ï¼ˆå®ç°ï¼‰éƒ¨åˆ†ã€‚</p><p>å¦‚æœè¿›ä¸€æ­¥è€ƒè™‘ç»§æ‰¿çš„è¯å°±ä¼šå‡ºç°ç¬¬ä¸‰ç§ç”¨æˆ·ï¼Œå³æ´¾ç”Ÿç±»ã€‚åŸºç±»æŠŠå®ƒå¸Œæœ›æ´¾ç”Ÿç±»èƒ½å¤Ÿä½¿ç”¨çš„éƒ¨åˆ†å£°æ˜æˆå—ä¿æŠ¤çš„ã€‚æ™®é€šç”¨æˆ·ä¸èƒ½è®¿é—®å—ä¿æŠ¤çš„æˆå‘˜ï¼Œè€Œæ´¾ç”Ÿç±»åŠå…¶å‹å…ƒä»æ—§ä¸èƒ½è®¿é—®ç§æœ‰æˆå‘˜ã€‚</p><p>å’Œå…¶ä»–ç±»ä¸€æ ·ï¼ŒåŸºç±»åº”è¯¥å°†å…¶æ¥å£æˆå‘˜å£°æ˜ä¸ºå…¬æœ‰çš„ï¼›åŒæ—¶å°†å±äºå…¶å®ç°çš„éƒ¨åˆ†åˆ†æˆä¸¤ç»„ï¼šä¸€ç»„å¯ä¾›æ´¾ç”Ÿç±»è®¿é—®ï¼Œå¦ä¸€ç»„åªèƒ½ç”±åŸºç±»åŠåŸºç±»çš„å‹å…ƒè®¿é—®ã€‚å¯¹äºå‰è€…åº”è¯¥å£°æ˜ä¸ºå—ä¿æŠ¤çš„ï¼Œè¿™æ ·æ´¾ç”Ÿç±»å°±èƒ½åœ¨å®ç°è‡ªå·±çš„åŠŸèƒ½æ—¶ä½¿ç”¨åŸºç±»çš„è¿™äº›æ“ä½œå’Œæ•°æ®ï¼›å¯¹äºåè€…åº”è¯¥å£°æ˜ä¸ºç§æœ‰çš„ã€‚</p><p><strong>å‹å…ƒä¸ç»§æ‰¿</strong></p><p>åŸºç±»çš„å‹å…ƒåœ¨è®¿é—®æ´¾ç”Ÿç±»æˆå‘˜æ—¶ä¸å…·æœ‰ç‰¹æ®Šæ€§ï¼Œç±»ä¼¼çš„ï¼Œæ´¾ç”Ÿç±»çš„å‹å…ƒä¹Ÿä¸èƒ½éšæ„è®¿é—®åŸºç±»çš„æˆå‘˜</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929235349712.png"></p><p>Palæ˜¯Baseçš„å‹å…ƒï¼Œæ‰€ä»¥Palèƒ½å¤Ÿè®¿é—®Baseå¯¹è±¡çš„æˆå‘˜ï¼Œè¿™ç§å¯è®¿é—®æ€§åŒ…æ‹¬äº†Baseå¯¹è±¡å†…åµŒåœ¨å…¶æ´¾ç”Ÿç±»å¯¹è±¡ä¸­çš„æƒ…å†µã€‚</p><p><strong>æ”¹å˜ä¸ªåˆ«æˆå‘˜çš„å¯è®¿é—®æ€§</strong></p><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ”¹å˜æ´¾ç”Ÿç±»ç»§æ‰¿çš„æŸä¸ªåå­—çš„è®¿é—®çº§åˆ«ï¼Œé€šè¿‡ä½¿ç”¨usingå£°æ˜ï¼ˆå‚è§3.1èŠ‚ï¼Œç¬¬74é¡µï¼‰å¯ä»¥è¾¾åˆ°è¿™ä¸€ç›®çš„</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240929235518822.png"></p><p>å› ä¸ºDerivedä½¿ç”¨äº†ç§æœ‰ç»§æ‰¿ï¼Œæ‰€ä»¥ç»§æ‰¿è€Œæ¥çš„æˆå‘˜sizeå’Œnï¼ˆåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼‰æ˜¯Derivedçš„ç§æœ‰æˆå‘˜ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä½¿ç”¨usingå£°æ˜è¯­å¥æ”¹å˜äº†è¿™äº›æˆå‘˜çš„å¯è®¿é—®æ€§ã€‚æ”¹å˜ä¹‹åï¼ŒDerivedçš„ç”¨æˆ·å°†å¯ä»¥ä½¿ç”¨sizeæˆå‘˜ï¼Œè€ŒDerivedçš„æ´¾ç”Ÿç±»å°†èƒ½ä½¿ç”¨nã€‚</p><p>é€šè¿‡åœ¨ç±»çš„å†…éƒ¨ä½¿ç”¨usingå£°æ˜è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥ç±»çš„ç›´æ¥æˆ–é—´æ¥åŸºç±»ä¸­çš„ä»»ä½•å¯è®¿é—®æˆå‘˜ï¼ˆä¾‹å¦‚ï¼Œéç§æœ‰æˆå‘˜ï¼‰æ ‡è®°å‡ºæ¥ã€‚</p><div class="note note-primary">            <p>æ´¾ç”Ÿç±»åªèƒ½ä¸ºé‚£äº›å®ƒå¯ä»¥è®¿é—®çš„åå­—æä¾›usingå£°æ˜ã€‚</p>          </div><p><strong>é»˜è®¤çš„ç»§æ‰¿ä¿æŠ¤çº§åˆ«</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨classå…³é”®å­—å®šä¹‰çš„æ´¾ç”Ÿç±»æ˜¯ç§æœ‰ç»§æ‰¿çš„ï¼›è€Œä½¿ç”¨structå…³é”®å­—å®šä¹‰çš„æ´¾ç”Ÿç±»æ˜¯å…¬æœ‰ç»§æ‰¿çš„ã€‚</p><h2 id="15-6-ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ"><a href="#15-6-ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ" class="headerlink" title="15.6 ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ"></a>15.6 ç»§æ‰¿ä¸­çš„ç±»ä½œç”¨åŸŸ</h2><p>æ¯ä¸ªç±»å®šä¹‰è‡ªå·±çš„ä½œç”¨åŸŸï¼ˆå‚è§7.4èŠ‚ï¼Œç¬¬253é¡µï¼‰ï¼Œåœ¨è¿™ä¸ªä½œç”¨åŸŸå†…æˆ‘ä»¬å®šä¹‰ç±»çš„æˆå‘˜ã€‚å½“å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ï¼Œæ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸåµŒå¥—ï¼ˆå‚è§2.2.4èŠ‚ï¼Œç¬¬43é¡µï¼‰åœ¨å…¶åŸºç±»çš„ä½œç”¨åŸŸä¹‹å†…ã€‚å¦‚æœä¸€ä¸ªåå­—åœ¨æ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸå†…æ— æ³•æ­£ç¡®è§£æï¼Œåˆ™ç¼–è¯‘å™¨å°†ç»§ç»­åœ¨å¤–å±‚çš„åŸºç±»ä½œç”¨åŸŸä¸­å¯»æ‰¾è¯¥åå­—çš„å®šä¹‰ã€‚</p><p><strong>åœ¨ç¼–è¯‘æ—¶è¿›è¡Œåå­—æŸ¥æ‰¾</strong></p><p>ä¸€ä¸ªå¯¹è±¡ã€å¼•ç”¨æˆ–æŒ‡é’ˆçš„é™æ€ç±»å‹ï¼ˆå‚è§15.2.3èŠ‚ï¼Œç¬¬532é¡µï¼‰å†³å®šäº†è¯¥å¯¹è±¡çš„å“ªäº›æˆå‘˜æ˜¯å¯è§çš„ã€‚å³ä½¿é™æ€ç±»å‹ä¸åŠ¨æ€ç±»å‹å¯èƒ½ä¸ä¸€è‡´ï¼ˆå½“ä½¿ç”¨åŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆæ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½ä½¿ç”¨å“ªäº›æˆå‘˜ä»ç„¶æ˜¯ç”±é™æ€ç±»å‹å†³å®šçš„ã€‚</p><p><strong>åå­—å†²çªä¸ç»§æ‰¿</strong></p><p>å’Œå…¶ä»–ä½œç”¨åŸŸä¸€æ ·ï¼Œæ´¾ç”Ÿç±»ä¹Ÿèƒ½é‡ç”¨å®šä¹‰åœ¨å…¶ç›´æ¥åŸºç±»æˆ–é—´æ¥åŸºç±»ä¸­çš„åå­—ï¼Œæ­¤æ—¶å®šä¹‰åœ¨å†…å±‚ä½œç”¨åŸŸï¼ˆå³æ´¾ç”Ÿç±»ï¼‰çš„åå­—å°†éšè—å®šä¹‰åœ¨å¤–å±‚ä½œç”¨åŸŸï¼ˆå³åŸºç±»ï¼‰çš„åå­—ï¼ˆå‚è§2.2.4èŠ‚ï¼Œç¬¬43é¡µï¼‰</p><p><strong>é€šè¿‡ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥ä½¿ç”¨éšè—çš„æˆå‘˜</strong></p><p>å¯ä»¥é€šè¿‡ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥ä½¿ç”¨ä¸€ä¸ªè¢«éšè—çš„åŸºç±»æˆå‘˜</p><div class="note note-primary">            <p>é™¤äº†è¦†ç›–ç»§æ‰¿è€Œæ¥çš„è™šå‡½æ•°ä¹‹å¤–ï¼Œæ´¾ç”Ÿç±»æœ€å¥½ä¸è¦é‡ç”¨å…¶ä»–å®šä¹‰åœ¨åŸºç±»ä¸­çš„åå­—ã€‚</p>          </div><p><strong>å…³é”®æ¦‚å¿µï¼šåå­—æŸ¥æ‰¾ä¸ç»§æ‰¿</strong></p><p>ç†è§£å‡½æ•°è°ƒç”¨çš„è§£æè¿‡ç¨‹å¯¹äºç†è§£C++çš„ç»§æ‰¿è‡³å…³é‡è¦ï¼Œå‡å®šæˆ‘ä»¬è°ƒç”¨p-&gt;memï¼ˆï¼‰ï¼ˆæˆ–è€…obj.memï¼ˆï¼‰ï¼‰ï¼Œåˆ™ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹4ä¸ªæ­¥éª¤ï¼š</p><ol><li>é¦–å…ˆç¡®å®špï¼ˆæˆ–objï¼‰çš„é™æ€ç±»å‹ã€‚å› ä¸ºæˆ‘ä»¬è°ƒç”¨çš„æ˜¯ä¸€ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥è¯¥ç±»å‹å¿…ç„¶æ˜¯ç±»ç±»å‹ã€‚</li><li>åœ¨pï¼ˆæˆ–objï¼‰çš„é™æ€ç±»å‹å¯¹åº”çš„ç±»ä¸­æŸ¥æ‰¾memã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä¾æ¬¡åœ¨ç›´æ¥åŸºç±»ä¸­ä¸æ–­æŸ¥æ‰¾ç›´è‡³åˆ°è¾¾ç»§æ‰¿é“¾çš„é¡¶ç«¯ã€‚å¦‚æœæ‰¾éäº†è¯¥ç±»åŠå…¶åŸºç±»ä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç¼–è¯‘å™¨å°†æŠ¥é”™ã€‚</li><li>ä¸€æ—¦æ‰¾åˆ°äº†memï¼Œå°±è¿›è¡Œå¸¸è§„çš„ç±»å‹æ£€æŸ¥ï¼ˆå‚è§6.1èŠ‚ï¼Œç¬¬183é¡µï¼‰ä»¥ç¡®è®¤å¯¹äºå½“å‰æ‰¾åˆ°çš„memï¼Œæœ¬æ¬¡è°ƒç”¨æ˜¯å¦åˆæ³•ã€‚</li><li>å‡è®¾è°ƒç”¨åˆæ³•ï¼Œåˆ™ç¼–è¯‘å™¨å°†æ ¹æ®è°ƒç”¨çš„æ˜¯å¦æ˜¯è™šå‡½æ•°è€Œäº§ç”Ÿä¸åŒçš„ä»£ç ï¼š<ul><li>å¦‚æœmemæ˜¯è™šå‡½æ•°ä¸”æˆ‘ä»¬æ˜¯é€šè¿‡å¼•ç”¨æˆ–æŒ‡é’ˆè¿›è¡Œçš„è°ƒç”¨ï¼Œåˆ™ç¼–è¯‘å™¨äº§ç”Ÿçš„ä»£ç å°†åœ¨è¿è¡Œæ—¶ç¡®å®šåˆ°åº•è¿è¡Œè¯¥è™šå‡½æ•°çš„å“ªä¸ªç‰ˆæœ¬ï¼Œä¾æ®æ˜¯å¯¹è±¡çš„åŠ¨æ€ç±»å‹ã€‚</li><li>åä¹‹ï¼Œå¦‚æœmemä¸æ˜¯è™šå‡½æ•°æˆ–è€…æˆ‘ä»¬æ˜¯é€šè¿‡å¯¹è±¡ï¼ˆè€Œéå¼•ç”¨æˆ–æŒ‡é’ˆï¼‰è¿›è¡Œçš„è°ƒç”¨ï¼Œåˆ™ç¼–è¯‘å™¨å°†äº§ç”Ÿä¸€ä¸ªå¸¸è§„å‡½æ•°è°ƒç”¨ã€‚</li></ul></li></ol><p><strong>ä¸€å¦‚å¾€å¸¸ï¼Œåå­—æŸ¥æ‰¾å…ˆäºç±»å‹æ£€æŸ¥</strong></p><p>å£°æ˜åœ¨å†…å±‚ä½œç”¨åŸŸçš„å‡½æ•°å¹¶ä¸ä¼šé‡è½½å£°æ˜åœ¨å¤–å±‚ä½œç”¨åŸŸçš„å‡½æ•°ï¼ˆå‚è§6.4.1èŠ‚ï¼Œç¬¬210é¡µï¼‰ã€‚å› æ­¤ï¼Œå®šä¹‰æ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°ä¹Ÿä¸ä¼šé‡è½½å…¶åŸºç±»ä¸­çš„æˆå‘˜ã€‚</p><p><strong>è™šå‡½æ•°ä¸ä½œç”¨åŸŸ</strong></p><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ç†è§£ä¸ºä»€ä¹ˆåŸºç±»ä¸æ´¾ç”Ÿç±»ä¸­çš„è™šå‡½æ•°å¿…é¡»æœ‰ç›¸åŒçš„å½¢å‚åˆ—è¡¨äº†ï¼ˆå‚è§15.3èŠ‚ï¼Œç¬¬537é¡µï¼‰ã€‚å‡å¦‚åŸºç±»ä¸æ´¾ç”Ÿç±»çš„è™šå‡½æ•°æ¥å—çš„å®å‚ä¸åŒï¼Œåˆ™æˆ‘ä»¬å°±æ— æ³•é€šè¿‡åŸºç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆè°ƒç”¨æ´¾ç”Ÿç±»çš„è™šå‡½æ•°äº†ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240930103221575.png"></p><p><strong>è¦†ç›–é‡è½½çš„å‡½æ•°</strong></p><p>æˆå‘˜å‡½æ•°æ— è®ºæ˜¯å¦æ˜¯è™šå‡½æ•°éƒ½èƒ½è¢«é‡è½½ã€‚æ´¾ç”Ÿç±»å¯ä»¥è¦†ç›–é‡è½½å‡½æ•°çš„0ä¸ªæˆ–å¤šä¸ªå®ä¾‹ã€‚å¦‚æœæ´¾ç”Ÿç±»å¸Œæœ›æ‰€æœ‰çš„é‡è½½ç‰ˆæœ¬å¯¹äºå®ƒæ¥è¯´éƒ½æ˜¯å¯è§çš„ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦è¦†ç›–æ‰€æœ‰çš„ç‰ˆæœ¬ï¼Œæˆ–è€…ä¸€ä¸ªä¹Ÿä¸è¦†ç›–ã€‚</p><p>æœ‰æ—¶ä¸€ä¸ªç±»ä»…éœ€è¦†ç›–é‡è½½é›†åˆä¸­çš„ä¸€äº›è€Œéå…¨éƒ¨å‡½æ•°ï¼Œæ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¾—ä¸è¦†ç›–åŸºç±»ä¸­çš„æ¯ä¸€ä¸ªç‰ˆæœ¬çš„è¯ï¼Œæ˜¾ç„¶æ“ä½œå°†æå…¶çƒ¦çã€‚</p><p>ä¸€ç§å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºé‡è½½çš„æˆå‘˜æä¾›ä¸€æ¡usingå£°æ˜è¯­å¥ï¼ˆå‚è§15.5èŠ‚ï¼Œç¬¬546é¡µï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ— é¡»è¦†ç›–åŸºç±»ä¸­çš„æ¯ä¸€ä¸ªé‡è½½ç‰ˆæœ¬äº†ã€‚usingå£°æ˜è¯­å¥æŒ‡å®šä¸€ä¸ªåå­—è€Œä¸æŒ‡å®šå½¢å‚åˆ—è¡¨ï¼Œæ‰€ä»¥ä¸€æ¡åŸºç±»æˆå‘˜å‡½æ•°çš„usingå£°æ˜è¯­å¥å°±å¯ä»¥æŠŠè¯¥å‡½æ•°çš„æ‰€æœ‰é‡è½½å®ä¾‹æ·»åŠ åˆ°æ´¾ç”Ÿç±»ä½œç”¨åŸŸä¸­ã€‚æ­¤æ—¶ï¼Œæ´¾ç”Ÿç±»åªéœ€è¦å®šä¹‰å…¶ç‰¹æœ‰çš„å‡½æ•°å°±å¯ä»¥äº†ï¼Œè€Œæ— é¡»ä¸ºç»§æ‰¿è€Œæ¥çš„å…¶ä»–å‡½æ•°é‡æ–°å®šä¹‰ã€‚</p><p>ç±»å†…usingå£°æ˜çš„ä¸€èˆ¬è§„åˆ™åŒæ ·é€‚ç”¨äºé‡è½½å‡½æ•°çš„åå­—ï¼ˆå‚è§15.5èŠ‚ï¼Œç¬¬546é¡µï¼‰ï¼›åŸºç±»å‡½æ•°çš„æ¯ä¸ªå®ä¾‹åœ¨æ´¾ç”Ÿç±»ä¸­éƒ½å¿…é¡»æ˜¯å¯è®¿é—®çš„ã€‚å¯¹æ´¾ç”Ÿç±»æ²¡æœ‰é‡æ–°å®šä¹‰çš„é‡è½½ç‰ˆæœ¬çš„è®¿é—®å®é™…ä¸Šæ˜¯å¯¹usingå£°æ˜ç‚¹çš„è®¿é—®ã€‚</p><h2 id="15-7-æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶"><a href="#15-7-æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶" class="headerlink" title="15.7 æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶"></a>15.7 æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶</h2><h3 id="15-7-1-è™šææ„å‡½æ•°"><a href="#15-7-1-è™šææ„å‡½æ•°" class="headerlink" title="15.7.1 è™šææ„å‡½æ•°"></a>15.7.1 è™šææ„å‡½æ•°</h3><p>ç»§æ‰¿å…³ç³»å¯¹åŸºç±»æ‹·è´æ§åˆ¶æœ€ç›´æ¥çš„å½±å“æ˜¯åŸºç±»é€šå¸¸åº”è¯¥å®šä¹‰ä¸€ä¸ªè™šææ„å‡½æ•°ï¼ˆå‚è§15.2.1èŠ‚ï¼Œç¬¬528é¡µï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åŠ¨æ€åˆ†é…ç»§æ‰¿ä½“ç³»ä¸­çš„å¯¹è±¡äº†ã€‚</p><p>å› ä¸ºæŒ‡é’ˆæˆ–è€…å¼•ç”¨çš„é™æ€ç±»å‹å¯èƒ½ä¸å®é™…æŒ‡å‘å¯¹è±¡çš„åŠ¨æ€ç±»å‹ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ææ„å‡½æ•°åº”è¯¥è¢«å£°æ˜ä¸ºè™šå‡½æ•°ï¼Œè¿™æ ·åœ¨ææ„çš„æ—¶å€™å¯ä»¥åŠ¨æ€ç»‘å®šï¼Œæ‰§è¡ŒåŠ¨æ€ç±»å‹çš„ææ„å‡½æ•°ï¼Œä»¥ç¡®ä¿ææ„æ­£ç¡®ã€‚</p><p><strong>è™šææ„å‡½æ•°å°†é˜»æ­¢åˆæˆç§»åŠ¨æ“ä½œ</strong></p><p>åŸºç±»éœ€è¦ä¸€ä¸ªè™šææ„å‡½æ•°è¿™ä¸€äº‹å®è¿˜ä¼šå¯¹åŸºç±»å’Œæ´¾ç”Ÿç±»çš„å®šä¹‰äº§ç”Ÿå¦å¤–ä¸€ä¸ªé—´æ¥çš„å½±å“ï¼šå¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†ææ„å‡½æ•°ï¼Œå³ä½¿å®ƒé€šè¿‡&#x3D;defaultçš„å½¢å¼ä½¿ç”¨äº†åˆæˆçš„ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šä¸ºè¿™ä¸ªç±»åˆæˆç§»åŠ¨æ“ä½œï¼ˆå‚è§13.6.2èŠ‚ï¼Œç¬¬475é¡µï¼‰ã€‚</p><h3 id="15-7-2-åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿"><a href="#15-7-2-åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿" class="headerlink" title="15.7.2 åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿"></a>15.7.2 åˆæˆæ‹·è´æ§åˆ¶ä¸ç»§æ‰¿</h3><p>åŸºç±»æˆ–æ´¾ç”Ÿç±»çš„åˆæˆæ‹·è´æ§åˆ¶æˆå‘˜çš„è¡Œä¸ºä¸å…¶ä»–åˆæˆçš„æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦æˆ–ææ„å‡½æ•°ç±»ä¼¼ï¼šå®ƒä»¬å¯¹ç±»æœ¬èº«çš„æˆå‘˜ä¾æ¬¡è¿›è¡Œåˆå§‹åŒ–ã€èµ‹å€¼æˆ–é”€æ¯çš„æ“ä½œã€‚æ­¤å¤–ï¼Œè¿™äº›åˆæˆçš„æˆå‘˜è¿˜è´Ÿè´£ä½¿ç”¨ç›´æ¥åŸºç±»ä¸­å¯¹åº”çš„æ“ä½œå¯¹ä¸€ä¸ªå¯¹è±¡çš„ç›´æ¥åŸºç±»éƒ¨åˆ†è¿›è¡Œåˆå§‹åŒ–ã€èµ‹å€¼æˆ–é”€æ¯çš„æ“ä½œã€‚</p><p><strong>æ´¾ç”Ÿç±»ä¸­åˆ é™¤çš„æ‹·è´æ§åˆ¶ä¸åŸºç±»çš„å…³ç³»</strong></p><p>å°±åƒå…¶ä»–ä»»ä½•ç±»çš„æƒ…å†µä¸€æ ·ï¼ŒåŸºç±»æˆ–æ´¾ç”Ÿç±»ä¹Ÿèƒ½å‡ºäºåŒæ ·çš„åŸå› å°†å…¶åˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°æˆ–è€…ä»»ä½•ä¸€ä¸ªæ‹·è´æ§åˆ¶æˆå‘˜å®šä¹‰æˆè¢«åˆ é™¤çš„å‡½æ•°ï¼ˆå‚è§13.1.6èŠ‚ï¼Œç¬¬450é¡µå’Œ13.6.2èŠ‚ï¼Œç¬¬475é¡µï¼‰ã€‚</p><p>æ­¤å¤–ï¼ŒæŸäº›å®šä¹‰åŸºç±»çš„æ–¹å¼ä¹Ÿå¯èƒ½å¯¼è‡´æœ‰çš„æ´¾ç”Ÿç±»æˆå‘˜æˆä¸ºè¢«åˆ é™¤çš„å‡½æ•°ï¼š</p><ul><li>å¦‚æœåŸºç±»ä¸­çš„é»˜è®¤æ„é€ å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æˆ–ææ„å‡½æ•°æ˜¯è¢«åˆ é™¤çš„å‡½æ•°æˆ–è€…ä¸å¯è®¿é—®ï¼ˆå‚è§15.5èŠ‚ï¼Œç¬¬543é¡µï¼‰ï¼Œåˆ™æ´¾ç”Ÿç±»ä¸­å¯¹åº”çš„æˆå‘˜å°†æ˜¯è¢«åˆ é™¤çš„ï¼ŒåŸå› æ˜¯ç¼–è¯‘å™¨ä¸èƒ½ä½¿ç”¨åŸºç±»æˆå‘˜æ¥æ‰§è¡Œæ´¾ç”Ÿç±»å¯¹è±¡åŸºç±»éƒ¨åˆ†çš„æ„é€ ã€èµ‹å€¼æˆ–é”€æ¯æ“ä½œã€‚</li><li>å¦‚æœåœ¨åŸºç±»ä¸­æœ‰ä¸€ä¸ªä¸å¯è®¿é—®æˆ–åˆ é™¤æ‰çš„ææ„å‡½æ•°ï¼Œåˆ™æ´¾ç”Ÿç±»ä¸­åˆæˆçš„é»˜è®¤å’Œæ‹·è´æ„é€ å‡½æ•°å°†æ˜¯è¢«åˆ é™¤çš„ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•é”€æ¯æ´¾ç”Ÿç±»å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†ã€‚</li><li>å’Œè¿‡å»ä¸€æ ·ï¼Œç¼–è¯‘å™¨å°†ä¸ä¼šåˆæˆä¸€ä¸ªåˆ é™¤æ‰çš„ç§»åŠ¨æ“ä½œã€‚å½“æˆ‘ä»¬ä½¿ç”¨&#x3D;defaultè¯·æ±‚ä¸€ä¸ªç§»åŠ¨æ“ä½œæ—¶ï¼Œå¦‚æœåŸºç±»ä¸­çš„å¯¹åº”æ“ä½œæ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼Œé‚£ä¹ˆæ´¾ç”Ÿç±»ä¸­è¯¥å‡½æ•°å°†æ˜¯è¢«åˆ é™¤çš„ï¼ŒåŸå› æ˜¯æ´¾ç”Ÿç±»å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†ä¸å¯ç§»åŠ¨ã€‚åŒæ ·ï¼Œå¦‚æœåŸºç±»çš„ææ„å‡½æ•°æ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼Œåˆ™æ´¾ç”Ÿç±»çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¹Ÿå°†æ˜¯è¢«åˆ é™¤çš„ã€‚</li></ul><p><strong>ç§»åŠ¨æ“ä½œä¸ç»§æ‰¿</strong></p><p>å¤§å¤šæ•°åŸºç±»éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè™šææ„å‡½æ•°ã€‚å› æ­¤åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸºç±»é€šå¸¸ä¸å«æœ‰åˆæˆçš„ç§»åŠ¨æ“ä½œï¼Œè€Œä¸”åœ¨å®ƒçš„æ´¾ç”Ÿç±»ä¸­ä¹Ÿæ²¡æœ‰åˆæˆçš„ç§»åŠ¨æ“ä½œã€‚</p><p>å› ä¸ºåŸºç±»ç¼ºå°‘ç§»åŠ¨æ“ä½œä¼šé˜»æ­¢æ´¾ç”Ÿç±»æ‹¥æœ‰è‡ªå·±çš„åˆæˆç§»åŠ¨æ“ä½œï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ç¡®å®éœ€è¦æ‰§è¡Œç§»åŠ¨æ“ä½œæ—¶åº”è¯¥é¦–å…ˆåœ¨åŸºç±»ä¸­è¿›è¡Œå®šä¹‰ã€‚æˆ‘ä»¬çš„Quoteå¯ä»¥ä½¿ç”¨åˆæˆçš„ç‰ˆæœ¬ï¼Œä¸è¿‡å‰ææ˜¯Quoteå¿…é¡»æ˜¾å¼åœ°å®šä¹‰è¿™äº›æˆå‘˜ã€‚ä¸€æ—¦Quoteå®šä¹‰äº†è‡ªå·±çš„ç§»åŠ¨æ“ä½œï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åŒæ—¶æ˜¾å¼åœ°å®šä¹‰æ‹·è´æ“ä½œã€‚</p><h3 id="15-7-3-æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜"><a href="#15-7-3-æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜" class="headerlink" title="15.7.3 æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜"></a>15.7.3 æ´¾ç”Ÿç±»çš„æ‹·è´æ§åˆ¶æˆå‘˜</h3><p>æ´¾ç”Ÿç±»çš„æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°åœ¨æ‹·è´å’Œç§»åŠ¨è‡ªæœ‰æˆå‘˜çš„åŒæ—¶ï¼Œä¹Ÿè¦æ‹·è´å’Œç§»åŠ¨åŸºç±»éƒ¨åˆ†çš„æˆå‘˜ã€‚ç±»ä¼¼çš„ï¼Œæ´¾ç”Ÿç±»èµ‹å€¼è¿ç®—ç¬¦ä¹Ÿå¿…é¡»ä¸ºå…¶åŸºç±»éƒ¨åˆ†çš„æˆå‘˜èµ‹å€¼ã€‚ææ„å‡½æ•°åªè´Ÿè´£é”€æ¯æ´¾ç”Ÿç±»è‡ªå·±åˆ†é…çš„èµ„æºã€‚</p><p><strong>å®šä¹‰æ´¾ç”Ÿç±»çš„æ‹·è´æˆ–ç§»åŠ¨æ„é€ å‡½æ•°</strong></p><p>å½“ä¸ºæ´¾ç”Ÿç±»å®šä¹‰æ‹·è´æˆ–ç§»åŠ¨æ„é€ å‡½æ•°æ—¶ï¼ˆå‚è§13.1.1èŠ‚ï¼Œç¬¬440é¡µå’Œ13.6.2èŠ‚ï¼Œç¬¬473é¡µï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¯¹åº”çš„åŸºç±»æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240930105340630.png"></p><div class="note note-warning">            <p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸºç±»é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–æ´¾ç”Ÿç±»å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ‹·è´ï¼ˆæˆ–ç§»åŠ¨ï¼‰åŸºç±»éƒ¨åˆ†ï¼Œåˆ™å¿…é¡»åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸­æ˜¾å¼åœ°ä½¿ç”¨åŸºç±»çš„æ‹·è´ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ„é€ å‡½æ•°ã€‚</p>          </div><p><strong>æ´¾ç”Ÿç±»èµ‹å€¼è¿ç®—ç¬¦</strong></p><p>ä¸æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°ä¸€æ ·ï¼Œæ´¾ç”Ÿç±»çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå‚è§13.1.2èŠ‚ï¼Œç¬¬443é¡µå’Œ13.6.2èŠ‚ï¼Œç¬¬474é¡µï¼‰ä¹Ÿå¿…é¡»æ˜¾å¼åœ°ä¸ºå…¶åŸºç±»éƒ¨åˆ†èµ‹å€¼</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240930105530059.png"></p><p><strong>æ´¾ç”Ÿç±»ææ„å‡½æ•°</strong></p><p>å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†æ˜¯éšå¼é”€æ¯çš„ã€‚å› æ­¤ï¼Œå’Œæ„é€ å‡½æ•°åŠèµ‹å€¼è¿ç®—ç¬¦ä¸åŒçš„æ˜¯ï¼Œæ´¾ç”Ÿç±»ææ„å‡½æ•°åªè´Ÿè´£é”€æ¯ç”±æ´¾ç”Ÿç±»è‡ªå·±åˆ†é…çš„èµ„æºã€‚</p><p>å¯¹è±¡é”€æ¯çš„é¡ºåºæ­£å¥½ä¸å…¶åˆ›å»ºçš„é¡ºåºç›¸åï¼šæ´¾ç”Ÿç±»ææ„å‡½æ•°é¦–å…ˆæ‰§è¡Œï¼Œç„¶åæ˜¯åŸºç±»çš„ææ„å‡½æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ²¿ç€ç»§æ‰¿ä½“ç³»çš„åæ–¹å‘ç›´è‡³æœ€åã€‚</p><p><strong>åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</strong></p><p>å¦‚æœæ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°è°ƒç”¨äº†æŸä¸ªè™šå‡½æ•°ï¼Œåˆ™æˆ‘ä»¬åº”è¯¥æ‰§è¡Œä¸æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°æ‰€å±ç±»å‹ç›¸å¯¹åº”çš„è™šå‡½æ•°ç‰ˆæœ¬ã€‚</p><h3 id="15-7-4-ç»§æ‰¿çš„æ„é€ å‡½æ•°"><a href="#15-7-4-ç»§æ‰¿çš„æ„é€ å‡½æ•°" class="headerlink" title="15.7.4 ç»§æ‰¿çš„æ„é€ å‡½æ•°"></a>15.7.4 ç»§æ‰¿çš„æ„é€ å‡½æ•°</h3><p>åœ¨C++11æ–°æ ‡å‡†ä¸­ï¼Œæ´¾ç”Ÿç±»èƒ½å¤Ÿé‡ç”¨å…¶ç›´æ¥åŸºç±»å®šä¹‰çš„æ„é€ å‡½æ•°ã€‚å°½ç®¡å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œè¿™äº›æ„é€ å‡½æ•°å¹¶éä»¥å¸¸è§„çš„æ–¹å¼ç»§æ‰¿è€Œæ¥ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸å¦¨å§‘ä¸”ç§°å…¶ä¸ºâ€œç»§æ‰¿â€çš„ã€‚ä¸€ä¸ªç±»åªåˆå§‹åŒ–å®ƒçš„ç›´æ¥åŸºç±»ï¼Œå‡ºäºåŒæ ·çš„åŸå› ï¼Œä¸€ä¸ªç±»ä¹Ÿåªç»§æ‰¿å…¶ç›´æ¥åŸºç±»çš„æ„é€ å‡½æ•°ã€‚</p><p>ç±»ä¸èƒ½ç»§æ‰¿é»˜è®¤ã€æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°ã€‚å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰ç›´æ¥å®šä¹‰è¿™äº›æ„é€ å‡½æ•°ï¼Œåˆ™ç¼–è¯‘å™¨å°†ä¸ºæ´¾ç”Ÿç±»åˆæˆå®ƒä»¬ã€‚</p><p>æ´¾ç”Ÿç±»ç»§æ‰¿åŸºç±»æ„é€ å‡½æ•°çš„æ–¹å¼æ˜¯æä¾›ä¸€æ¡æ³¨æ˜äº†ï¼ˆç›´æ¥ï¼‰åŸºç±»åçš„usingå£°æ˜è¯­å¥ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-15/image-20240930110151289.png"></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œusingå£°æ˜è¯­å¥åªæ˜¯ä»¤æŸä¸ªåå­—åœ¨å½“å‰ä½œç”¨åŸŸå†…å¯è§ã€‚è€Œå½“ä½œç”¨äºæ„é€ å‡½æ•°æ—¶ï¼Œusingå£°æ˜è¯­å¥å°†ä»¤ç¼–è¯‘å™¨äº§ç”Ÿä»£ç ã€‚å¯¹äºåŸºç±»çš„æ¯ä¸ªæ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨éƒ½ç”Ÿæˆä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„æ´¾ç”Ÿç±»æ„é€ å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹äºåŸºç±»çš„æ¯ä¸ªæ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨éƒ½åœ¨æ´¾ç”Ÿç±»ä¸­ç”Ÿæˆä¸€ä¸ªå½¢å‚åˆ—è¡¨å®Œå…¨ç›¸åŒçš„æ„é€ å‡½æ•°ã€‚</p><p>å¦‚æœæ´¾ç”Ÿç±»å«æœ‰è‡ªå·±çš„æ•°æ®æˆå‘˜ï¼Œåˆ™è¿™äº›æˆå‘˜å°†è¢«é»˜è®¤åˆå§‹åŒ–ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬238é¡µï¼‰ã€‚</p><p><strong>ç»§æ‰¿çš„æ„é€ å‡½æ•°çš„ç‰¹ç‚¹</strong></p><p>å’Œæ™®é€šæˆå‘˜çš„usingå£°æ˜ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°çš„usingå£°æ˜ä¸ä¼šæ”¹å˜è¯¥æ„é€ å‡½æ•°çš„è®¿é—®çº§åˆ«ã€‚ä¾‹å¦‚ï¼Œä¸ç®¡usingå£°æ˜å‡ºç°åœ¨å“ªå„¿ï¼ŒåŸºç±»çš„ç§æœ‰æ„é€ å‡½æ•°åœ¨æ´¾ç”Ÿç±»ä¸­è¿˜æ˜¯ä¸€ä¸ªç§æœ‰æ„é€ å‡½æ•°ï¼›å—ä¿æŠ¤çš„æ„é€ å‡½æ•°å’Œå…¬æœ‰æ„é€ å‡½æ•°ä¹Ÿæ˜¯åŒæ ·çš„è§„åˆ™ã€‚</p><p>è€Œä¸”ï¼Œä¸€ä¸ªusingå£°æ˜è¯­å¥ä¸èƒ½æŒ‡å®šexplicitæˆ–constexprã€‚å¦‚æœåŸºç±»çš„æ„é€ å‡½æ•°æ˜¯explicitï¼ˆå‚è§7.5.4èŠ‚ï¼Œç¬¬265é¡µï¼‰æˆ–è€…constexprï¼ˆå‚è§7.5.6èŠ‚ï¼Œç¬¬267é¡µï¼‰ï¼Œåˆ™ç»§æ‰¿çš„æ„é€ å‡½æ•°ä¹Ÿæ‹¥æœ‰ç›¸åŒçš„å±æ€§ã€‚</p><p>å½“ä¸€ä¸ªåŸºç±»æ„é€ å‡½æ•°å«æœ‰é»˜è®¤å®å‚ï¼ˆå‚è§6.5.1èŠ‚ï¼Œç¬¬211é¡µï¼‰æ—¶ï¼Œè¿™äº›å®å‚å¹¶ä¸ä¼šè¢«ç»§æ‰¿ã€‚ç›¸åï¼Œæ´¾ç”Ÿç±»å°†è·å¾—å¤šä¸ªç»§æ‰¿çš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­æ¯ä¸ªæ„é€ å‡½æ•°åˆ†åˆ«çœç•¥æ‰ä¸€ä¸ªå«æœ‰é»˜è®¤å®å‚çš„å½¢å‚ã€‚</p><p>å¦‚æœåŸºç±»å«æœ‰å‡ ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™é™¤äº†ä¸¤ä¸ªä¾‹å¤–æƒ…å†µï¼Œå¤§å¤šæ•°æ—¶å€™æ´¾ç”Ÿç±»ä¼šç»§æ‰¿æ‰€æœ‰è¿™äº›æ„é€ å‡½æ•°ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªä¾‹å¤–æ˜¯æ´¾ç”Ÿç±»å¯ä»¥ç»§æ‰¿ä¸€éƒ¨åˆ†æ„é€ å‡½æ•°ï¼Œè€Œä¸ºå…¶ä»–æ„é€ å‡½æ•°å®šä¹‰è‡ªå·±çš„ç‰ˆæœ¬ã€‚å¦‚æœæ´¾ç”Ÿç±»å®šä¹‰çš„æ„é€ å‡½æ•°ä¸åŸºç±»çš„æ„é€ å‡½æ•°å…·æœ‰ç›¸åŒçš„å‚æ•°åˆ—è¡¨ï¼Œåˆ™è¯¥æ„é€ å‡½æ•°å°†ä¸ä¼šè¢«ç»§æ‰¿ã€‚å®šä¹‰åœ¨æ´¾ç”Ÿç±»ä¸­çš„æ„é€ å‡½æ•°å°†æ›¿æ¢ç»§æ‰¿è€Œæ¥çš„æ„é€ å‡½æ•°ã€‚</li><li>ç¬¬äºŒä¸ªä¾‹å¤–æ˜¯é»˜è®¤ã€æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šè¢«ç»§æ‰¿ã€‚è¿™äº›æ„é€ å‡½æ•°æŒ‰ç…§æ­£å¸¸è§„åˆ™è¢«åˆæˆã€‚ç»§æ‰¿çš„æ„é€ å‡½æ•°ä¸ä¼šè¢«ä½œä¸ºç”¨æˆ·å®šä¹‰çš„æ„é€ å‡½æ•°æ¥ä½¿ç”¨ï¼Œå› æ­¤ï¼Œå¦‚æœä¸€ä¸ªç±»åªå«æœ‰ç»§æ‰¿çš„æ„é€ å‡½æ•°ï¼Œåˆ™å®ƒä¹Ÿå°†æ‹¥æœ‰ä¸€ä¸ªåˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°ã€‚</li></ul><h2 id="15-8-å®¹å™¨ä¸ç»§æ‰¿"><a href="#15-8-å®¹å™¨ä¸ç»§æ‰¿" class="headerlink" title="15.8 å®¹å™¨ä¸ç»§æ‰¿"></a>15.8 å®¹å™¨ä¸ç»§æ‰¿</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨å®¹å™¨å­˜æ”¾ç»§æ‰¿ä½“ç³»ä¸­çš„å¯¹è±¡æ—¶ï¼Œé€šå¸¸å¿…é¡»é‡‡å–é—´æ¥å­˜å‚¨çš„æ–¹å¼ã€‚å› ä¸ºä¸å…è®¸åœ¨å®¹å™¨ä¸­ä¿å­˜ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½æŠŠå…·æœ‰ç»§æ‰¿å…³ç³»çš„å¤šç§ç±»å‹çš„å¯¹è±¡ç›´æ¥å­˜æ”¾åœ¨å®¹å™¨å½“ä¸­ã€‚</p><p><strong>åœ¨å®¹å™¨ä¸­æ”¾ç½®ï¼ˆæ™ºèƒ½ï¼‰æŒ‡é’ˆè€Œéå¯¹è±¡</strong></p><p>å½“æˆ‘ä»¬å¸Œæœ›åœ¨å®¹å™¨ä¸­å­˜æ”¾å…·æœ‰ç»§æ‰¿å…³ç³»çš„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šå­˜æ”¾çš„é€šå¸¸æ˜¯åŸºç±»çš„æŒ‡é’ˆï¼ˆæ›´å¥½çš„é€‰æ‹©æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼ˆå‚è§12.1èŠ‚ï¼Œç¬¬400é¡µï¼‰ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[ç®—æ³•]å¿«é€Ÿå¹‚ç®—æ³•</title>
    <link href="/2024/09/28/%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E5%B9%82%E7%AE%97%E6%B3%95/"/>
    <url>/2024/09/28/%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E5%B9%82%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="å¿«é€Ÿå¹‚ç®—æ³•"><a href="#å¿«é€Ÿå¹‚ç®—æ³•" class="headerlink" title="å¿«é€Ÿå¹‚ç®—æ³•"></a>å¿«é€Ÿå¹‚ç®—æ³•</h1><span id="more"></span><h2 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1 é¢˜ç›®"></a>1 é¢˜ç›®</h2><p>è®¾$a$æ˜¯ä¸€ä¸ªç»™å®šå®æ•°ï¼Œè®¡ç®—$a^n$ï¼Œå…¶ä¸­$n$æ˜¯è‡ªç„¶æ•°ã€‚</p><h2 id="2-è§£æ³•"><a href="#2-è§£æ³•" class="headerlink" title="2 è§£æ³•"></a>2 è§£æ³•</h2><h3 id="2-1-æš´åŠ›è§£"><a href="#2-1-æš´åŠ›è§£" class="headerlink" title="2.1 æš´åŠ›è§£"></a>2.1 æš´åŠ›è§£</h3><p>æš´åŠ›è§£æ¯”è¾ƒç›´è§‚ï¼Œç›´æ¥å¯¹$a$è¿›è¡Œ$n-1$æ¬¡ç›¸ä¹˜å³å¯ã€‚</p><p>æ—¶é—´å¤æ‚åº¦ä¸º$O(n)$.</p><h3 id="2-2-å¿«é€Ÿå¹‚-é€’å½’"><a href="#2-2-å¿«é€Ÿå¹‚-é€’å½’" class="headerlink" title="2.2 å¿«é€Ÿå¹‚-é€’å½’"></a>2.2 å¿«é€Ÿå¹‚-é€’å½’</h3><p>è€ƒè™‘åˆ†æ²»çš„æ–¹æ³•ï¼Œé¦–å…ˆå°†é—®é¢˜è§„çº¦ä¸ºä¸€ä¸ªæ›´å°çš„å­é—®é¢˜ï¼Œè®¡ç®—$a^{n&#x2F;2}$ï¼Œè®¡ç®—å‡ºçš„ç»“æœåªéœ€è¦åœ¨ç›¸ä¹˜ä¸€æ¬¡å³å¯å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚è¿™é‡Œéœ€è¦å¯¹$n$çš„å¥‡å¶æ€§è¿›è¡Œåˆ†æƒ…å†µè®¨è®ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>\begin{align}<br>    &amp; a^n &#x3D; a^{n &#x2F; 2} \times a^{n &#x2F; 2} \qquad nä¸ºå¶æ•° \\<br>    &amp; a^n &#x3D; a^{(n - 1) &#x2F; 2} \times a^{(n - 1) &#x2F; 2} \times a \qquad nä¸ºå¥‡æ•°<br>\end{align}<br>$$<br><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>è¯¥é€’å½’ç®—æ³•çš„é€’æ¨æ–¹ç¨‹ä¸º<br>$$<br>W(n) &#x3D;<br>\begin{cases}<br>    &amp; W(n&#x2F;2) + O(1) \\<br>    &amp; W(1) &#x3D; 0<br>\end{cases}<br>$$<br>è¯¥é€’æ¨æ–¹ç¨‹ç¬¦åˆä¸»å®šç†çš„ç¬¬äºŒç§æƒ…å†µï¼Œç”±æ­¤å¯å¾—è¯¥ç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦$W(n) &#x3D; O(logn)$.</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">fastExponentiation</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">unsigned</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">auto</span> result = <span class="hljs-built_in">fastExponentiation</span>(a, n / <span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">if</span> (n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> result * result;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> result * result * a;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-å¿«é€Ÿå¹‚-è¿­ä»£"><a href="#2-3-å¿«é€Ÿå¹‚-è¿­ä»£" class="headerlink" title="2.3 å¿«é€Ÿå¹‚-è¿­ä»£"></a>2.3 å¿«é€Ÿå¹‚-è¿­ä»£</h3><p>è§‚å¯Ÿé€’å½’ç‰ˆæœ¬ï¼Œå¯¹äº$a^{10}$ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¿«é€Ÿå¹‚è®¡ç®—$a^{10}$çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>$$<br>a^{10} &#x3D; (a^5)^2 &#x3D; (a^2 * a^3)^2 &#x3D; ((a * a)^2 * a)^2<br>$$<br>å› ä¸ºä¸¤ä¸ªåŒåº•çš„å¹‚ç›¸ä¹˜å¯ä»¥è½¬æ¢ä¸ºæŒ‡æ•°ç›¸åŠ ï¼Œå› æ­¤ä¸ºäº†è®¡ç®—$a^n$ï¼Œæˆ‘ä»¬åªéœ€è¦æ±‚å‡ºä¸€ä¸ªåºåˆ—$d_n &#x3D; [d1, d2, â€¦, d_k]$ï¼Œä½¿å¾—${\Sigma_{i&#x3D;1}^{k}d_i} &#x3D; n$ï¼Œå¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚è§£$a^{d_i}$ï¼Œå¹¶å°†æ‰€æœ‰ç»“æœç´¯ä¹˜è·å¾—åŸé—®é¢˜çš„è§£ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•æ±‚å¾—è¿™ä¸ªåºåˆ—$d_n$å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†$n$è¡¨ç¤ºæˆäºŒè¿›åˆ¶å½¢å¼ï¼Œæ‰€æœ‰äºŒè¿›åˆ¶ä½ä¸º1çš„æƒç»„æˆçš„é›†åˆå³æˆ‘ä»¬è¦æ±‚çš„$d_n$.</p><p><strong>æ—¶é—´å¤æ‚åº¦</strong></p><p>æˆ‘ä»¬å°†æ±‚è§£è¿‡ç¨‹èå…¥åˆ°æ±‚ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„è¿‡ç¨‹ä¸­ï¼Œå› æ­¤æœ€åæ—¶é—´å¤æ‚åº¦ä¸º$W(n) &#x3D; O(logn)$ï¼Œ</p><p><strong>ä»£ç </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">fastExponentiation</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">unsigned</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">unsigned</span> bit = <span class="hljs-number">0</span>;  <br>    <span class="hljs-type">double</span> res = <span class="hljs-number">1</span>;    <br>    <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        bit = n % <span class="hljs-number">2</span>;<br>        n &gt;&gt;= <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (bit) res *= a;<br>        a *= a;<br>    &#125;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-æ‰©å±•"><a href="#3-æ‰©å±•" class="headerlink" title="3 æ‰©å±•"></a>3 æ‰©å±•</h2><p>è¯¥æ€æƒ³å¯ä»¥ç”¨äºæ±‚è§£Fibonacciæ•°åˆ—ã€‚</p><p><strong>å®šç†</strong></p><p>è®¾$Fn$ä¸ºç¬¬$n$ä¸ªFibonacciæ•°ï¼Œé‚£ä¹ˆæœ‰</p><p><img src="/../images/%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E5%B9%82%E7%AE%97%E6%B3%95/image-20240928232343898.png"></p><p>é€šè¿‡æ•°å­¦å½’çº³æ³•å¯ä»¥è¯æ˜ä¸Šè¿°å®šç†ã€‚</p><p>ç”±å®šç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¡ç®—Fibonacciæ•°è½¬æ¢ä¸ºçŸ©é˜µçš„$n$æ¬¡å¹‚ï¼Œå› ä¸ºè®¡ç®—äºŒé˜¶çŸ©é˜µç›¸ä¹˜åªéœ€è¦8æ¬¡ä¹˜æ³•ï¼Œå³å¸¸æ•°æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–æ±‚Fibonacciæ•°çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦åˆ°$O(logn)$.</p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[ç®—æ³•]åˆ†æ²»ç­–ç•¥</title>
    <link href="/2024/09/28/%E7%AE%97%E6%B3%95-%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/"/>
    <url>/2024/09/28/%E7%AE%97%E6%B3%95-%E5%88%86%E6%B2%BB%E7%AD%96%E7%95%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆ†æ²»ç­–ç•¥"><a href="#åˆ†æ²»ç­–ç•¥" class="headerlink" title="åˆ†æ²»ç­–ç•¥"></a>åˆ†æ²»ç­–ç•¥</h1><span id="more"></span><h2 id="1-åŸºæœ¬æ€æƒ³"><a href="#1-åŸºæœ¬æ€æƒ³" class="headerlink" title="1 åŸºæœ¬æ€æƒ³"></a>1 åŸºæœ¬æ€æƒ³</h2><p>å°†è§„æ¨¡ä¸ºnçš„åŸé—®é¢˜è§„çº¦ä¸ºè§„æ¨¡æ›´å°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­é—®é¢˜ï¼Œé€’å½’æˆ–è¿­ä»£æ±‚è§£æ¯ä¸ªå­é—®é¢˜ï¼Œç„¶åæŠŠå­é—®é¢˜çš„è§£è¿›è¡Œç»¼åˆï¼Œä»è€Œå¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚</p><p>éœ€è¦æ³¨æ„ï¼š</p><ol><li>å­é—®é¢˜ä¸åŸé—®é¢˜æ€§è´¨å®Œå…¨ä¸€è‡´</li><li>å­é—®é¢˜ä¹‹é—´å¯ä»¥å½¼æ­¤ç‹¬ç«‹çš„æ±‚è§£</li><li>é€’å½’åœæ­¢æ—¶çš„å­é—®é¢˜å¯ä»¥ç›´æ¥æ±‚è§£ï¼ˆå¸¸æ•°æ—¶é—´ï¼‰</li><li>å½“å­é—®é¢˜åˆ’åˆ†æ¯”è¾ƒå‡åŒ€çš„æ—¶å€™ï¼Œæ—¶é—´å¤æ‚åº¦ç›¸å¯¹è¾ƒä½</li></ol><p><strong>ä¸€èˆ¬åˆ†æ²»ç®—æ³•ä¼ªä»£ç æè¿°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pseudocode">if |P| &lt;= c then S(p)                   // é€’å½’å‡ºå£ å°è§„æ¨¡çš„é—®é¢˜ç›´æ¥æ±‚è§£<br>divide P into P1, P2, ..., Pk// è§„çº¦ä¸ºkä¸ªå­é—®é¢˜<br>for i = 1 to k do<br>yi &lt;- Divide-and-Conquer(Pi)// é€’å½’æ±‚è§£å­é—®é¢˜<br>return Merge(y1, y2, ..., yk)           // ç»¼åˆå­é—®é¢˜çš„è§£<br></code></pre></td></tr></table></figure><h2 id="2-åˆ†ææŠ€æœ¯"><a href="#2-åˆ†ææŠ€æœ¯" class="headerlink" title="2 åˆ†ææŠ€æœ¯"></a>2 åˆ†ææŠ€æœ¯</h2><p>åˆ†æ²»ç®—æ³•é€šå¸¸æ˜¯é€’å½’ç®—æ³•ï¼Œåˆ†ææ—¶é—´å¤æ‚åº¦éœ€è¦æ±‚è§£é€’æ¨æ–¹ç¨‹ï¼Œå¸¸è§çš„é€’æ¨æ–¹ç¨‹æœ‰ä»¥ä¸‹ä¸¤ç±»ï¼š<br>$$<br>\begin{aligned}<br>    &amp; T\left(n\right)&#x3D;\sum_{i&#x3D;1}^{k}a_{i}T\left(n-i\right)+f\left(n\right) \\<br>    &amp; T\left(n\right)&#x3D;aT\left(\frac{n}{b}\right)+d\left(n\right)<br>\end{aligned}<br>$$<br>å¯¹äºç¬¬ä¸€ç±»æ–¹ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£ã€é€’å½’æ ‘ã€å°è¯•æ³•æ±‚è§£ï¼›</p><p>å¯¹äºç¬¬äºŒç±»æ–¹ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨è¿­ä»£ã€é€’å½’æ ‘ã€ä¸»å®šç†æ³•æ±‚è§£ï¼›</p><h3 id="ä¸»å®šç†"><a href="#ä¸»å®šç†" class="headerlink" title="ä¸»å®šç†"></a>ä¸»å®šç†</h3><p>$$<br>\begin{align}<br>    a \geq 1, b &gt; 1 ä¸ºå¸¸æ•°ï¼Œf(n)ä¸ºå‡½æ•°ï¼ŒT(n)ä¸ºéè´Ÿæ•´æ•°ï¼Œä¸”T(n)&#x3D;aT(n&#x2F;b)+f(n)<br>\end{align}<br>$$</p><p>$$<br>\begin{align}<br> &amp; \qquad(1)è‹¥ f(n)&#x3D;O(n^{\log_ba-\varepsilon}),\varepsilon&gt;0,<br>     åˆ™ T(n)&#x3D;\Theta(n^{\log_ba}). \\<br> &amp; \qquad(2)è‹¥ f(n)&#x3D;\Theta(n^{\log_ba}),<br>    åˆ™ T(n)&#x3D;\Theta(n^{\log_ba}\operatorname{log}n).  \\<br> &amp; \qquad(3)è‹¥ f(n)&#x3D;\Omega(n^{\log_ba+\varepsilon}),\varepsilon&gt;0, ä¸”å¯¹äºæŸä¸ªå¸¸æ•°cå’Œæ‰€æœ‰å……åˆ†å¤§çš„n, æœ‰ af(n&#x2F;b)\leqslant cf(n), åˆ™ T(n)&#x3D;\Theta(f(n)).<br>\end{align}<br>$$</p><h2 id="3-æ”¹è¿›åˆ†æ²»ç®—æ³•çš„é€”å¾„"><a href="#3-æ”¹è¿›åˆ†æ²»ç®—æ³•çš„é€”å¾„" class="headerlink" title="3 æ”¹è¿›åˆ†æ²»ç®—æ³•çš„é€”å¾„"></a>3 æ”¹è¿›åˆ†æ²»ç®—æ³•çš„é€”å¾„</h2><p>æ”¹è¿›ç®—æ³•ä¸»è¦æœ‰ä¸¤ç§é€”å¾„ï¼š</p><ol><li>å‡å°‘å­é—®é¢˜ä¸ªæ•°</li><li>é€šè¿‡é¢„å¤„ç†å‡å°‘é€’å½’è¿‡ç¨‹ä¸­çš„å·¥ä½œé‡</li></ol><h3 id="3-1-é€šè¿‡ä»£æ•°å˜æ¢å‡å°‘å­é—®é¢˜ä¸ªæ•°"><a href="#3-1-é€šè¿‡ä»£æ•°å˜æ¢å‡å°‘å­é—®é¢˜ä¸ªæ•°" class="headerlink" title="3.1 é€šè¿‡ä»£æ•°å˜æ¢å‡å°‘å­é—®é¢˜ä¸ªæ•°"></a>3.1 é€šè¿‡ä»£æ•°å˜æ¢å‡å°‘å­é—®é¢˜ä¸ªæ•°</h3><p>è¿™ç§æ–¹æ³•ä¸»è¦æ€æƒ³æ˜¯æœ‰çš„å­é—®é¢˜çš„è§£å¯ä»¥é€šè¿‡ç®€å•çš„è®¡ç®—ç”±å…¶ä»–å­é—®é¢˜çš„è§£è·å¾—ï¼Œé‚£ä¹ˆè¯¥å­é—®é¢˜å°±ä¸å¿…é€’å½’æ±‚è§£ï¼Œç”±æ­¤å‡å°‘äº†å­é—®é¢˜çš„ä¸ªæ•°ã€‚</p><p>ä¾‹å­ï¼š</p><ol><li>æ•´æ•°ä¹˜æ³•</li><li>StrassençŸ©é˜µä¹˜æ³•</li></ol><h3 id="3-2-åˆ©ç”¨é¢„å¤„ç†å‡å°‘é€’å½’å†…éƒ¨çš„è®¡ç®—é‡"><a href="#3-2-åˆ©ç”¨é¢„å¤„ç†å‡å°‘é€’å½’å†…éƒ¨çš„è®¡ç®—é‡" class="headerlink" title="3.2 åˆ©ç”¨é¢„å¤„ç†å‡å°‘é€’å½’å†…éƒ¨çš„è®¡ç®—é‡"></a>3.2 åˆ©ç”¨é¢„å¤„ç†å‡å°‘é€’å½’å†…éƒ¨çš„è®¡ç®—é‡</h3><p>è¿™ç§æ–¹æ³•çš„ä¸»è¦æ€æƒ³æ˜¯é€šè¿‡é¢„å¤„ç†ï¼Œå‡å°‘é€’å½’å†…éƒ¨çš„è®¡ç®—é‡ï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ–ç®—æ³•çš„ç›®çš„ã€‚</p><p>ä¾‹å­ï¼šå¹³é¢ä¸Šæœ€é‚»è¿‘ç‚¹å¯¹</p><h2 id="4-å…¸å‹å®ä¾‹"><a href="#4-å…¸å‹å®ä¾‹" class="headerlink" title="4 å…¸å‹å®ä¾‹"></a>4 å…¸å‹å®ä¾‹</h2><p><a href="https://erlsrnby04.github.io/2024/09/28/%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E5%B9%82%E7%AE%97%E6%B3%95/">å¿«é€Ÿå¹‚ç®—æ³•</a></p>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>åˆ†æ²»ç®—æ³•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>algorithm</tag>
      
      <tag>åˆ†æ²»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å†…æ ¸èµ›]ç³»ç»Ÿè°ƒç”¨å®ç°</title>
    <link href="/2024/09/28/%E5%86%85%E6%A0%B8%E8%B5%9B-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AE%9E%E7%8E%B0/"/>
    <url>/2024/09/28/%E5%86%85%E6%A0%B8%E8%B5%9B-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ç³»ç»Ÿè°ƒç”¨å®ç°"><a href="#ç³»ç»Ÿè°ƒç”¨å®ç°" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨å®ç°"></a>ç³»ç»Ÿè°ƒç”¨å®ç°</h1><span id="more"></span><h1 id="ç³»ç»Ÿè°ƒç”¨çš„è¯´æ˜ä»¥åŠè°ƒç”¨æ–¹å¼"><a href="#ç³»ç»Ÿè°ƒç”¨çš„è¯´æ˜ä»¥åŠè°ƒç”¨æ–¹å¼" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨çš„è¯´æ˜ä»¥åŠè°ƒç”¨æ–¹å¼"></a>ç³»ç»Ÿè°ƒç”¨çš„è¯´æ˜ä»¥åŠè°ƒç”¨æ–¹å¼</h1><p>ç³»ç»Ÿè°ƒç”¨æ–¹å¼éµå¾ªRISC-V ABI,å³è°ƒç”¨å·å­˜æ”¾åœ¨a7å¯„å­˜å™¨ä¸­,6ä¸ªå‚æ•°åˆ†åˆ«å‚¨å­˜åœ¨a0-a5å¯„å­˜å™¨<br>ä¸­,è¿”å›å€¼ä¿å­˜åœ¨a0ä¸­ã€‚</p><p>ä¸»è¦å‚è€ƒäº†Linux 5.10 syscallsï¼Œè¯¦ç»†è¯·å‚è§ï¼š<a href="https://man7.org/linux/man-pages/man2/syscalls.2.html">https://man7.org/linux/man-pages/man2/syscalls.2.html</a></p><h2 id="å¦‚ä½•æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨"><a href="#å¦‚ä½•æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨" class="headerlink" title="å¦‚ä½•æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨"></a>å¦‚ä½•æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨</h2><ol><li>åœ¨user.hæ–‡ä»¶ä¸­æ·»åŠ ç³»ç»Ÿè°ƒç”¨å°è£…åçš„å‡½æ•°å£°æ˜</li><li>åœ¨usys.plæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªentry</li><li>åœ¨syscall.hä¸­æ·»åŠ å¯¹åº”çš„å®</li><li>åœ¨syscall.cä¸­æ·»åŠ å‡½æ•°çš„å£°æ˜ï¼Œå¹¶æ›´æ–°ç³»ç»Ÿè°ƒç”¨è¡¨</li><li>æ ¹æ®åŠŸèƒ½ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å†…æ ¸æ¨¡å—ï¼Œè¿›è¡Œå®ç°ã€‚</li></ol><h2 id="æ–‡ä»¶ç³»ç»Ÿç›¸å…³"><a href="#æ–‡ä»¶ç³»ç»Ÿç›¸å…³" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿç›¸å…³"></a>æ–‡ä»¶ç³»ç»Ÿç›¸å…³</h2><h3 id="define-SYS-getcwd-17ï¼ˆ10-17ï¼‰"><a href="#define-SYS-getcwd-17ï¼ˆ10-17ï¼‰" class="headerlink" title="#define SYS_getcwd 17ï¼ˆ10.17ï¼‰"></a>#define SYS_getcwd 17ï¼ˆ10.17ï¼‰</h3><p>åŠŸèƒ½ï¼šè·å–å½“å‰å·¥ä½œç›®å½•ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li><p>char *bufï¼šä¸€å—ç¼“å­˜åŒºï¼Œç”¨äºä¿å­˜å½“å‰å·¥ä½œç›®å½•çš„å­—ç¬¦ä¸²ã€‚å½“bufè®¾ä¸ºNULLï¼Œç”±ç³»ç»Ÿæ¥åˆ†é…ç¼“å­˜åŒºã€‚</p></li><li><p>sizeï¼šbufç¼“å­˜åŒºçš„å¤§å°ã€‚</p></li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å›å½“å‰å·¥ä½œç›®å½•çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚å¤±è´¥ï¼Œåˆ™è¿”å›NULLã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> *buf, <span class="hljs-type">size_t</span> size;<br><span class="hljs-type">long</span> ret = syscall(SYS_getcwd, buf, size);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-pipe2-59-10-29"><a href="#define-SYS-pipe2-59-10-29" class="headerlink" title="#define SYS_pipe2 59 (10.29)"></a>#define SYS_pipe2 59 (10.29)</h3><p>åŠŸèƒ½ï¼šåˆ›å»ºç®¡é“ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>fd[2]ï¼šç”¨äºä¿å­˜2ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å…¶ä¸­ï¼Œfd[0]ä¸ºç®¡é“çš„è¯»å‡ºç«¯ï¼Œfd[1]ä¸ºç®¡é“çš„å†™å…¥ç«¯ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›0ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">int</span> fd[<span class="hljs-number">2</span>]<span class="hljs-comment">;</span><br><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_pipe2, fd, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-dup-23-10-29"><a href="#define-SYS-dup-23-10-29" class="headerlink" title="#define SYS_dup 23 (10.29)"></a>#define SYS_dup 23 (10.29)</h3><p>åŠŸèƒ½ï¼šå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>fdï¼šè¢«å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">int</span> fd<span class="hljs-comment">;</span><br><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_dup, fd)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-dup3-24-10-29"><a href="#define-SYS-dup3-24-10-29" class="headerlink" title="#define SYS_dup3 24 (10.29)"></a>#define SYS_dup3 24 (10.29)</h3><p>åŠŸèƒ½ï¼šå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶æŒ‡å®šäº†æ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>oldï¼šè¢«å¤åˆ¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>newï¼šæ–°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-type">int</span> <span class="hljs-keyword">old</span>, <span class="hljs-type">int</span> <span class="hljs-keyword">new</span>;<br><span class="hljs-type">int</span> ret <span class="hljs-operator">=</span> syscall(SYS_dup3, <span class="hljs-keyword">old</span>, <span class="hljs-keyword">new</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-chdir-49-ï¼ˆ10-29ï¼‰"><a href="#define-SYS-chdir-49-ï¼ˆ10-29ï¼‰" class="headerlink" title="#define SYS_chdir 49 ï¼ˆ10.29ï¼‰"></a>#define SYS_chdir 49 ï¼ˆ10.29ï¼‰</h3><p>åŠŸèƒ½ï¼šåˆ‡æ¢å·¥ä½œç›®å½•ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>pathï¼šéœ€è¦åˆ‡æ¢åˆ°çš„ç›®å½•ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›0ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">const <span class="hljs-type">char</span> *<span class="hljs-type">path</span>;<br><span class="hljs-type">int</span> ret = syscall(SYS_chdir, <span class="hljs-type">path</span>);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-openat-56-ï¼ˆ10-29ï¼‰"><a href="#define-SYS-openat-56-ï¼ˆ10-29ï¼‰" class="headerlink" title="#define SYS_openat 56 ï¼ˆ10.29ï¼‰"></a>#define SYS_openat 56 ï¼ˆ10.29ï¼‰</h3><p>åŠŸèƒ½ï¼šæ‰“å¼€æˆ–åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li><p>fdï¼šæ–‡ä»¶æ‰€åœ¨ç›®å½•çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p></li><li><p>filenameï¼šè¦æ‰“å¼€æˆ–åˆ›å»ºçš„æ–‡ä»¶åã€‚å¦‚ä¸ºç»å¯¹è·¯å¾„ï¼Œåˆ™å¿½ç•¥fdã€‚å¦‚ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä¸”fdæ˜¯AT_FDCWDï¼Œåˆ™filenameæ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•æ¥è¯´çš„ã€‚å¦‚ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä¸”fdæ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåˆ™filenameæ˜¯ç›¸å¯¹äºfdæ‰€æŒ‡å‘çš„ç›®å½•æ¥è¯´çš„ã€‚</p></li><li><p>flagsï¼šå¿…é¡»åŒ…å«å¦‚ä¸‹è®¿é—®æ¨¡å¼çš„å…¶ä¸­ä¸€ç§ï¼šO_RDONLYï¼ŒO_WRONLYï¼ŒO_RDWRã€‚è¿˜å¯ä»¥åŒ…å«æ–‡ä»¶åˆ›å»ºæ ‡å¿—å’Œæ–‡ä»¶çŠ¶æ€æ ‡å¿—ã€‚</p></li><li><p>modeï¼šæ–‡ä»¶çš„æ‰€æœ‰æƒæè¿°ã€‚è¯¦è§<code>man 7 inode </code>ã€‚</p></li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">int</span> flags, <span class="hljs-type">mode_t</span> mode;<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_openat, fd, filename, flags, mode);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-close-57-ï¼ˆ10-29ï¼‰"><a href="#define-SYS-close-57-ï¼ˆ10-29ï¼‰" class="headerlink" title="#define SYS_close 57 ï¼ˆ10.29ï¼‰"></a>#define SYS_close 57 ï¼ˆ10.29ï¼‰</h3><p>åŠŸèƒ½ï¼šå…³é—­ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>fdï¼šè¦å…³é—­çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›0ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">int</span> fd<span class="hljs-comment">;</span><br><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_close, fd)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-getdents64-61-12-11"><a href="#define-SYS-getdents64-61-12-11" class="headerlink" title="#define SYS_getdents64 61 (12.11)"></a>#define SYS_getdents64 61 (12.11)</h3><p>åŠŸèƒ½ï¼šè·å–ç›®å½•çš„æ¡ç›®;</p><p>è¾“å…¥ï¼š</p><ul><li><p>fdï¼šæ‰€è¦è¯»å–ç›®å½•çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p></li><li><p>bufï¼šä¸€ä¸ªç¼“å­˜åŒºï¼Œç”¨äºä¿å­˜æ‰€è¯»å–ç›®å½•çš„ä¿¡æ¯ã€‚ç¼“å­˜åŒºçš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> &#123;</span><br>    uint64 d_ino;<span class="hljs-comment">// ç´¢å¼•ç»“ç‚¹å·</span><br>    int64 d_off;<span class="hljs-comment">// åˆ°ä¸‹ä¸€ä¸ªdirentçš„åç§»</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> d_reclen;<span class="hljs-comment">// å½“å‰direntçš„é•¿åº¦</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> d_type;<span class="hljs-comment">// æ–‡ä»¶ç±»å‹</span><br>    <span class="hljs-type">char</span> d_name[];<span class="hljs-comment">//æ–‡ä»¶å</span><br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>lenï¼šbufçš„å¤§å°ã€‚</p></li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚å½“åˆ°ç›®å½•ç»“å°¾ï¼Œåˆ™è¿”å›0ã€‚å¤±è´¥ï¼Œåˆ™è¿”å›-1ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> dirent *buf, size_t <span class="hljs-built_in">len</span><br><span class="hljs-type">int</span> ret = syscall(SYS_getdents64, fd, buf, <span class="hljs-built_in">len</span>);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-read-63-ï¼ˆ10-29ï¼‰"><a href="#define-SYS-read-63-ï¼ˆ10-29ï¼‰" class="headerlink" title="#define SYS_read 63 ï¼ˆ10.29ï¼‰"></a>#define SYS_read 63 ï¼ˆ10.29ï¼‰</h3><p>åŠŸèƒ½ï¼šä»ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸­è¯»å–ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>fdï¼šè¦è¯»å–æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>bufï¼šä¸€ä¸ªç¼“å­˜åŒºï¼Œç”¨äºå­˜æ”¾è¯»å–çš„å†…å®¹ã€‚</li><li>countï¼šè¦è¯»å–çš„å­—èŠ‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚å¦‚ä¸º0ï¼Œè¡¨ç¤ºæ–‡ä»¶ç»“æŸã€‚é”™è¯¯ï¼Œåˆ™è¿”å›-1ã€‚</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">int fd, void *<span class="hljs-keyword">buf, </span>size_t <span class="hljs-built_in">count</span>;<br>ssize_t ret = <span class="hljs-keyword">syscall(SYS_read, </span>fd, <span class="hljs-keyword">buf, </span><span class="hljs-built_in">count</span>);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-write-64-ï¼ˆ10-29ï¼‰"><a href="#define-SYS-write-64-ï¼ˆ10-29ï¼‰" class="headerlink" title="#define SYS_write 64 ï¼ˆ10.29ï¼‰"></a>#define SYS_write 64 ï¼ˆ10.29ï¼‰</h3><p>åŠŸèƒ½ï¼šä»ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸­å†™å…¥ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>fdï¼šè¦å†™å…¥æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>bufï¼šä¸€ä¸ªç¼“å­˜åŒºï¼Œç”¨äºå­˜æ”¾è¦å†™å…¥çš„å†…å®¹ã€‚</li><li>countï¼šè¦å†™å…¥çš„å­—èŠ‚æ•°ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›å†™å…¥çš„å­—èŠ‚æ•°ã€‚é”™è¯¯ï¼Œåˆ™è¿”å›-1ã€‚</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">int</span> fd, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> count;<br><span class="hljs-type">ssize_t</span> ret = <span class="hljs-built_in">syscall</span>(SYS_write, fd, buf, count);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-linkat-37-12-13"><a href="#define-SYS-linkat-37-12-13" class="headerlink" title="#define SYS_linkat 37 (12.13)"></a>#define SYS_linkat 37 (12.13)</h3><p>åŠŸèƒ½ï¼šåˆ›å»ºæ–‡ä»¶çš„é“¾æ¥ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>olddirfdï¼šåŸæ¥çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>oldpathï¼šæ–‡ä»¶åŸæ¥çš„åå­—ã€‚å¦‚æœoldpathæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™å®ƒæ˜¯ç›¸å¯¹äºolddirfdç›®å½•è€Œè¨€çš„ã€‚å¦‚æœoldpathæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¸”olddirfdçš„å€¼ä¸ºAT_FDCWDï¼Œåˆ™å®ƒæ˜¯ç›¸å¯¹äºå½“å‰è·¯å¾„è€Œè¨€çš„ã€‚å¦‚æœoldpathæ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™olddirfdè¢«å¿½ç•¥ã€‚</li><li>newdirfdï¼šæ–°æ–‡ä»¶åæ‰€åœ¨çš„ç›®å½•ã€‚</li><li>newpathï¼šæ–‡ä»¶çš„æ–°åå­—ã€‚newpathçš„ä½¿ç”¨è§„åˆ™åŒoldpathã€‚</li><li>flagsï¼šåœ¨2.6.18å†…æ ¸ä¹‹å‰ï¼Œåº”ç½®ä¸º0ã€‚å…¶å®ƒçš„å€¼è¯¦è§<code>man 2 linkat</code>ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›0ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> olddirfd, <span class="hljs-type">char</span> *oldpath, <span class="hljs-type">int</span> newdirfd, <span class="hljs-type">char</span> *newpath, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_linkat, olddirfd, oldpath, newdirfd, newpath, flags);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-unlinkat-35-12-13"><a href="#define-SYS-unlinkat-35-12-13" class="headerlink" title="#define SYS_unlinkat 35 (12.13)"></a>#define SYS_unlinkat 35 (12.13)</h3><p>åŠŸèƒ½ï¼šç§»é™¤æŒ‡å®šæ–‡ä»¶çš„é“¾æ¥(å¯ç”¨äºåˆ é™¤æ–‡ä»¶)ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>dirfdï¼šè¦åˆ é™¤çš„é“¾æ¥æ‰€åœ¨çš„ç›®å½•ã€‚</li><li>pathï¼šè¦åˆ é™¤çš„é“¾æ¥çš„åå­—ã€‚å¦‚æœpathæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™å®ƒæ˜¯ç›¸å¯¹äºdirfdç›®å½•è€Œè¨€çš„ã€‚å¦‚æœpathæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¸”dirfdçš„å€¼ä¸ºAT_FDCWDï¼Œåˆ™å®ƒæ˜¯ç›¸å¯¹äºå½“å‰è·¯å¾„è€Œè¨€çš„ã€‚å¦‚æœpathæ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™dirfdè¢«å¿½ç•¥ã€‚</li><li>flagsï¼šå¯è®¾ç½®ä¸º0æˆ–AT_REMOVEDIRã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›0ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">int</span> dirfd, <span class="hljs-type">char</span> *<span class="hljs-type">path</span>, unsigned <span class="hljs-type">int</span> flags;<br>syscall(SYS_unlinkat, dirfd, <span class="hljs-type">path</span>, flags);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-mkdirat-34-ï¼ˆ10-29ï¼‰"><a href="#define-SYS-mkdirat-34-ï¼ˆ10-29ï¼‰" class="headerlink" title="#define SYS_mkdirat 34 ï¼ˆ10.29ï¼‰"></a>#define SYS_mkdirat 34 ï¼ˆ10.29ï¼‰</h3><p>åŠŸèƒ½ï¼šåˆ›å»ºç›®å½•ï¼›</p><p>è¾“å…¥ï¼š</p><ul><li>dirfdï¼šè¦åˆ›å»ºçš„ç›®å½•æ‰€åœ¨çš„ç›®å½•çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>pathï¼šè¦åˆ›å»ºçš„ç›®å½•çš„åç§°ã€‚å¦‚æœpathæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™å®ƒæ˜¯ç›¸å¯¹äºdirfdç›®å½•è€Œè¨€çš„ã€‚å¦‚æœpathæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¸”dirfdçš„å€¼ä¸ºAT_FDCWDï¼Œåˆ™å®ƒæ˜¯ç›¸å¯¹äºå½“å‰è·¯å¾„è€Œè¨€çš„ã€‚å¦‚æœpathæ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™dirfdè¢«å¿½ç•¥ã€‚</li><li>modeï¼šæ–‡ä»¶çš„æ‰€æœ‰æƒæè¿°ã€‚è¯¦è§<code>man 7 inode </code>ã€‚</li></ul><p>è¿”å›å€¼ï¼šæˆåŠŸæ‰§è¡Œï¼Œè¿”å›0ã€‚å¤±è´¥ï¼Œè¿”å›-1ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> dirfd, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">mode_t</span> mode;<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_mkdirat, dirfd, path, mode);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-umount2-39"><a href="#define-SYS-umount2-39" class="headerlink" title="#define SYS_umount2 39"></a>#define SYS_umount2 39</h3><ul><li>åŠŸèƒ½ï¼šå¸è½½æ–‡ä»¶ç³»ç»Ÿï¼›</li><li>è¾“å…¥ï¼šæŒ‡å®šå¸è½½ç›®å½•ï¼Œå¸è½½å‚æ•°ï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼›</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *special, <span class="hljs-type">int</span> flags;<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_umount2, special, flags);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-mount-40"><a href="#define-SYS-mount-40" class="headerlink" title="#define SYS_mount 40"></a>#define SYS_mount 40</h3><ul><li>åŠŸèƒ½ï¼šæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼›</li><li>è¾“å…¥ï¼š<ul><li>special: æŒ‚è½½è®¾å¤‡ï¼›</li><li>dir: æŒ‚è½½ç‚¹ï¼›</li><li>fstype: æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼›</li><li>flags: æŒ‚è½½å‚æ•°ï¼›</li><li>data: ä¼ é€’ç»™æ–‡ä»¶ç³»ç»Ÿçš„å­—ç¬¦ä¸²å‚æ•°ï¼Œå¯ä¸ºNULLï¼›</li></ul></li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼›</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *special, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *dir, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *fstype, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags, <span class="hljs-type">const</span> <span class="hljs-type">void</span> *data;<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_mount, special, dir, fstype, flags, data);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-fstat-80-12-13"><a href="#define-SYS-fstat-80-12-13" class="headerlink" title="#define SYS_fstat 80 (12.13)"></a>#define SYS_fstat 80 (12.13)</h3><ul><li>åŠŸèƒ½ï¼šè·å–æ–‡ä»¶çŠ¶æ€ï¼›</li><li>è¾“å…¥ï¼š<ul><li>fd: æ–‡ä»¶å¥æŸ„ï¼›</li><li>kst: æ¥æ”¶ä¿å­˜æ–‡ä»¶çŠ¶æ€çš„æŒ‡é’ˆï¼›</li></ul></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">kstat</span> &#123;<br><span class="hljs-type">dev_t</span> st_dev;<br><span class="hljs-type">ino_t</span> st_ino;<br><span class="hljs-type">mode_t</span> st_mode;<br><span class="hljs-type">nlink_t</span> st_nlink;<br><span class="hljs-type">uid_t</span> st_uid;<br><span class="hljs-type">gid_t</span> st_gid;<br><span class="hljs-type">dev_t</span> st_rdev;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> __pad;<br><span class="hljs-type">off_t</span> st_size;<br><span class="hljs-type">blksize_t</span> st_blksize;<br><span class="hljs-type">int</span> __pad2;<br><span class="hljs-type">blkcnt_t</span> st_blocks;<br><span class="hljs-type">long</span> st_atime_sec;<br><span class="hljs-type">long</span> st_atime_nsec;<br><span class="hljs-type">long</span> st_mtime_sec;<br><span class="hljs-type">long</span> st_mtime_nsec;<br><span class="hljs-type">long</span> st_ctime_sec;<br><span class="hljs-type">long</span> st_ctime_nsec;<br><span class="hljs-type">unsigned</span> __unused[<span class="hljs-number">2</span>];<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼›</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">int</span> fd<span class="hljs-comment">;</span><br>struct kstat kst<span class="hljs-comment">;</span><br><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_fstat, fd, &amp;kst)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h2 id="è¿›ç¨‹ç®¡ç†ç›¸å…³"><a href="#è¿›ç¨‹ç®¡ç†ç›¸å…³" class="headerlink" title="è¿›ç¨‹ç®¡ç†ç›¸å…³"></a>è¿›ç¨‹ç®¡ç†ç›¸å…³</h2><h3 id="define-SYS-clone-220-ï¼ˆ10-26ï¼‰"><a href="#define-SYS-clone-220-ï¼ˆ10-26ï¼‰" class="headerlink" title="#define SYS_clone 220 ï¼ˆ10.26ï¼‰"></a>#define SYS_clone 220 ï¼ˆ10.26ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼›</li><li>è¾“å…¥ï¼š<ul><li>flags: åˆ›å»ºçš„æ ‡å¿—ï¼Œå¦‚SIGCHLDï¼›</li><li>stack: æŒ‡å®šæ–°è¿›ç¨‹çš„æ ˆï¼Œå¯ä¸º0ï¼›</li><li>ptid: çˆ¶çº¿ç¨‹IDï¼›</li><li>tls: TLSçº¿ç¨‹æœ¬åœ°å­˜å‚¨æè¿°ç¬¦ï¼›</li><li>ctid: å­çº¿ç¨‹IDï¼›</li></ul></li><li>è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›å­è¿›ç¨‹çš„çº¿ç¨‹IDï¼Œå¤±è´¥è¿”å›-1ï¼›</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">pid_t</span> ret = <span class="hljs-built_in">syscall</span>(SYS_clone, flags, stack, ptid, tls, ctid)<br></code></pre></td></tr></table></figure><h3 id="define-SYS-execve-221-ï¼ˆ10-26ï¼‰"><a href="#define-SYS-execve-221-ï¼ˆ10-26ï¼‰" class="headerlink" title="#define SYS_execve 221 ï¼ˆ10.26ï¼‰"></a>#define SYS_execve 221 ï¼ˆ10.26ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šæ‰§è¡Œä¸€ä¸ªæŒ‡å®šçš„ç¨‹åºï¼›</li><li>è¾“å…¥ï¼š<ul><li>path: å¾…æ‰§è¡Œç¨‹åºè·¯å¾„åç§°ï¼Œ</li><li>argv: ç¨‹åºçš„å‚æ•°ï¼Œ </li><li>envp: ç¯å¢ƒå˜é‡çš„æ•°ç»„æŒ‡é’ˆ</li></ul></li><li>è¿”å›å€¼ï¼šæˆåŠŸä¸è¿”å›ï¼Œå¤±è´¥è¿”å›-1ï¼›</li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">char</span> *<span class="hljs-type">const</span> argv[], <span class="hljs-type">char</span> *<span class="hljs-type">const</span> envp[];<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_execve, path, argv, envp);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-wait4-260ï¼ˆ10-26ï¼‰"><a href="#define-SYS-wait4-260ï¼ˆ10-26ï¼‰" class="headerlink" title="#define SYS_wait4 260ï¼ˆ10.26ï¼‰"></a>#define SYS_wait4 260ï¼ˆ10.26ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šç­‰å¾…è¿›ç¨‹æ”¹å˜çŠ¶æ€;</li><li>è¾“å…¥ï¼š<ul><li>pid: æŒ‡å®šè¿›ç¨‹IDï¼Œå¯ä¸º-1ç­‰å¾…ä»»ä½•å­è¿›ç¨‹ï¼›</li><li>status: æ¥æ”¶çŠ¶æ€çš„æŒ‡é’ˆï¼›</li><li>options: é€‰é¡¹ï¼šWNOHANGï¼ŒWUNTRACEDï¼ŒWCONTINUEDï¼›</li></ul></li><li>è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›è¿›ç¨‹IDï¼›å¦‚æœæŒ‡å®šäº†WNOHANGï¼Œä¸”è¿›ç¨‹è¿˜æœªæ”¹å˜çŠ¶æ€ï¼Œç›´æ¥è¿”å›0ï¼›å¤±è´¥åˆ™è¿”å›-1ï¼›</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">pid_t</span> pid, <span class="hljs-type">int</span> *status, <span class="hljs-type">int</span> options;<br><span class="hljs-type">pid_t</span> ret = <span class="hljs-built_in">syscall</span>(SYS_wait4, pid, status, options);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-exit-93-ï¼ˆ10-26ï¼‰"><a href="#define-SYS-exit-93-ï¼ˆ10-26ï¼‰" class="headerlink" title="#define SYS_exit 93 ï¼ˆ10.26ï¼‰"></a>#define SYS_exit 93 ï¼ˆ10.26ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šè§¦å‘è¿›ç¨‹ç»ˆæ­¢ï¼Œæ— è¿”å›å€¼ï¼›</li><li>è¾“å…¥ï¼šç»ˆæ­¢çŠ¶æ€å€¼ï¼›</li><li>è¿”å›å€¼ï¼šæ— è¿”å›å€¼ï¼›</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">int</span> ec;<br><span class="hljs-keyword">syscall</span>(SYS_exit, ec);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-getppid-173-ï¼ˆ10-25ï¼‰"><a href="#define-SYS-getppid-173-ï¼ˆ10-25ï¼‰" class="headerlink" title="#define SYS_getppid 173 ï¼ˆ10.25ï¼‰"></a>#define SYS_getppid 173 ï¼ˆ10.25ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šè·å–çˆ¶è¿›ç¨‹IDï¼›</li><li>è¾“å…¥ï¼šç³»ç»Ÿè°ƒç”¨IDï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›çˆ¶è¿›ç¨‹IDï¼›</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">pid_t ret <span class="hljs-operator">=</span> syscall(SYS_getppid)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-getpid-172-ï¼ˆ10-25ï¼‰"><a href="#define-SYS-getpid-172-ï¼ˆ10-25ï¼‰" class="headerlink" title="#define SYS_getpid 172 ï¼ˆ10.25ï¼‰"></a>#define SYS_getpid 172 ï¼ˆ10.25ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šè·å–è¿›ç¨‹IDï¼›</li><li>è¾“å…¥ï¼šç³»ç»Ÿè°ƒç”¨IDï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›è¿›ç¨‹IDï¼›</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">pid_t ret <span class="hljs-operator">=</span> syscall(SYS_getpid)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h2 id="å†…å­˜ç®¡ç†ç›¸å…³"><a href="#å†…å­˜ç®¡ç†ç›¸å…³" class="headerlink" title="å†…å­˜ç®¡ç†ç›¸å…³"></a>å†…å­˜ç®¡ç†ç›¸å…³</h2><h3 id="define-SYS-brk-214-ï¼ˆ10-26ï¼‰"><a href="#define-SYS-brk-214-ï¼ˆ10-26ï¼‰" class="headerlink" title="#define SYS_brk 214 ï¼ˆ10.26ï¼‰"></a>#define SYS_brk 214 ï¼ˆ10.26ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šä¿®æ”¹æ•°æ®æ®µçš„å¤§å°ï¼›</li><li>è¾“å…¥ï¼šæŒ‡å®šå¾…ä¿®æ”¹çš„åœ°å€ï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-built_in">uint</span>ptr_t brk;<br><span class="hljs-built_in">uint</span>ptr_t ret = syscall(SYS_brk, brk);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-munmap-215-12-13"><a href="#define-SYS-munmap-215-12-13" class="headerlink" title="#define SYS_munmap 215 (12.13)"></a>#define SYS_munmap 215 (12.13)</h3><ul><li>åŠŸèƒ½ï¼šå°†æ–‡ä»¶æˆ–è®¾å¤‡å–æ¶ˆæ˜ å°„åˆ°å†…å­˜ä¸­ï¼›</li><li>è¾“å…¥ï¼šæ˜ å°„çš„æŒ‡å®šåœ°å€åŠåŒºé—´ï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">void</span> *<span class="hljs-keyword">start</span>, size_t len<br><span class="hljs-type">int</span> ret = syscall(SYS_munmap, <span class="hljs-keyword">start</span>, len);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-mmap-222-12-13"><a href="#define-SYS-mmap-222-12-13" class="headerlink" title="#define SYS_mmap 222 (12.13)"></a>#define SYS_mmap 222 (12.13)</h3><ul><li>åŠŸèƒ½ï¼šå°†æ–‡ä»¶æˆ–è®¾å¤‡æ˜ å°„åˆ°å†…å­˜ä¸­ï¼›</li><li>è¾“å…¥ï¼š<ul><li>start: æ˜ å°„èµ·å§‹ä½ç½®ï¼Œ</li><li>len: é•¿åº¦ï¼Œ</li><li>prot: æ˜ å°„çš„å†…å­˜ä¿æŠ¤æ–¹å¼ï¼Œå¯å–ï¼šPROT_EXEC, PROT_READ, PROT_WRITE, PROT_NONE</li><li>flags: æ˜ å°„æ˜¯å¦ä¸å…¶ä»–è¿›ç¨‹å…±äº«çš„æ ‡å¿—ï¼Œ</li><li>fd: æ–‡ä»¶å¥æŸ„ï¼Œ</li><li>off: æ–‡ä»¶åç§»é‡ï¼›</li></ul></li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›å·²æ˜ å°„åŒºåŸŸçš„æŒ‡é’ˆï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">void</span> *<span class="hljs-keyword">start</span>, size_t len, <span class="hljs-type">int</span> prot, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> fd, off_t <span class="hljs-keyword">off</span><br>long ret = syscall(SYS_mmap, <span class="hljs-keyword">start</span>, len, prot, flags, fd, <span class="hljs-keyword">off</span>);<br></code></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="define-SYS-times-153-12-10"><a href="#define-SYS-times-153-12-10" class="headerlink" title="#define SYS_times 153  (12.10)"></a>#define SYS_times 153  (12.10)</h3><ul><li>åŠŸèƒ½ï¼šè·å–è¿›ç¨‹æ—¶é—´ï¼›</li><li>è¾“å…¥ï¼štmsç»“æ„ä½“æŒ‡é’ˆï¼Œç”¨äºè·å–ä¿å­˜å½“å‰è¿›ç¨‹çš„è¿è¡Œæ—¶é—´æ•°æ®ï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›å·²ç»è¿‡å»çš„æ»´ç­”æ•°ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">tms</span> *tms;<br><span class="hljs-type">clock_t</span> ret = <span class="hljs-built_in">syscall</span>(SYS_times, tms);<br></code></pre></td></tr></table></figure><h3 id="define-SYS-uname-160-12-13"><a href="#define-SYS-uname-160-12-13" class="headerlink" title="#define SYS_uname 160 (12.13)"></a>#define SYS_uname 160 (12.13)</h3><ul><li>åŠŸèƒ½ï¼šæ‰“å°ç³»ç»Ÿä¿¡æ¯ï¼›</li><li>è¾“å…¥ï¼šutsnameç»“æ„ä½“æŒ‡é’ˆç”¨äºè·å¾—ç³»ç»Ÿä¿¡æ¯æ•°æ®ï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">struct utsname *uts<span class="hljs-comment">;</span><br><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_uname, uts)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-sched-yield-124-ï¼ˆ10-25ï¼‰"><a href="#define-SYS-sched-yield-124-ï¼ˆ10-25ï¼‰" class="headerlink" title="#define SYS_sched_yield 124 ï¼ˆ10.25ï¼‰"></a>#define SYS_sched_yield 124 ï¼ˆ10.25ï¼‰</h3><ul><li>åŠŸèƒ½ï¼šè®©å‡ºè°ƒåº¦å™¨ï¼›</li><li>è¾“å…¥ï¼šç³»ç»Ÿè°ƒç”¨IDï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_sched_yield)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-gettimeofday-169-12-11"><a href="#define-SYS-gettimeofday-169-12-11" class="headerlink" title="#define SYS_gettimeofday 169 (12.11)"></a>#define SYS_gettimeofday 169 (12.11)</h3><ul><li>åŠŸèƒ½ï¼šè·å–æ—¶é—´ï¼›</li><li>è¾“å…¥ï¼š timespecç»“æ„ä½“æŒ‡é’ˆç”¨äºè·å¾—æ—¶é—´å€¼ï¼›</li><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">struct timespec *ts<span class="hljs-comment">;</span><br><span class="hljs-keyword">int</span> <span class="hljs-keyword">ret</span> = <span class="hljs-keyword">syscall</span>(SYS_gettimeofday, ts, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="define-SYS-nanosleep-101-12-11"><a href="#define-SYS-nanosleep-101-12-11" class="headerlink" title="#define SYS_nanosleep 101 (12.11)"></a>#define SYS_nanosleep 101 (12.11)</h3><ul><li>åŠŸèƒ½ï¼šæ‰§è¡Œçº¿ç¨‹ç¡çœ ï¼Œsleep()åº“å‡½æ•°åŸºäºæ­¤ç³»ç»Ÿè°ƒç”¨ï¼›</li><li>è¾“å…¥ï¼šç¡çœ çš„æ—¶é—´é—´éš”ï¼›</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">timespec</span> &#123;<br><span class="hljs-type">time_t</span> tv_sec;        <span class="hljs-comment">/* ç§’ */</span><br><span class="hljs-type">long</span>   tv_nsec;       <span class="hljs-comment">/* çº³ç§’, èŒƒå›´åœ¨0~999999999 */</span><br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1;</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">timespec</span> *req, <span class="hljs-keyword">struct</span> <span class="hljs-title class_">timespec</span> *rem;<br><span class="hljs-type">int</span> ret = <span class="hljs-built_in">syscall</span>(SYS_nanosleep, req, rem);<br></code></pre></td></tr></table></figure><h2 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">static inline _u64 internal_syscall(long n, _u64 _<span class="hljs-built_in">a0</span>, _u64 _<span class="hljs-built_in">a1</span>, _u64 _<span class="hljs-built_in">a2</span>, _u64<br>_<span class="hljs-built_in">a3</span>, _u64 _<span class="hljs-built_in">a4</span>, _u64 _<span class="hljs-built_in">a5</span>) &#123;<br>register _u64 <span class="hljs-built_in">a0</span> asm(<span class="hljs-string">&quot;a0&quot;</span>) = _<span class="hljs-built_in">a0</span>;<br>register _u64 <span class="hljs-built_in">a1</span> asm(<span class="hljs-string">&quot;a1&quot;</span>) = _<span class="hljs-built_in">a1</span>;<br>register _u64 <span class="hljs-built_in">a2</span> asm(<span class="hljs-string">&quot;a2&quot;</span>) = _<span class="hljs-built_in">a2</span>;<br>register _u64 <span class="hljs-built_in">a3</span> asm(<span class="hljs-string">&quot;a3&quot;</span>) = _<span class="hljs-built_in">a3</span>;<br>register _u64 <span class="hljs-built_in">a4</span> asm(<span class="hljs-string">&quot;a4&quot;</span>) = _<span class="hljs-built_in">a4</span>;<br>register _u64 <span class="hljs-built_in">a5</span> asm(<span class="hljs-string">&quot;a5&quot;</span>) = _<span class="hljs-built_in">a5</span>;<br>register long <span class="hljs-keyword">syscall_id </span>asm(<span class="hljs-string">&quot;a7&quot;</span>) = n;<br>asm volatile (<span class="hljs-string">&quot;ecall&quot;</span> : <span class="hljs-string">&quot;+r&quot;</span>(<span class="hljs-built_in">a0</span>) : <span class="hljs-string">&quot;r&quot;</span>(<span class="hljs-built_in">a1</span>), <span class="hljs-string">&quot;r&quot;</span>(<span class="hljs-built_in">a2</span>), <span class="hljs-string">&quot;r&quot;</span>(<span class="hljs-built_in">a3</span>), <span class="hljs-string">&quot;r&quot;</span>(<span class="hljs-built_in">a4</span>), <span class="hljs-string">&quot;r&quot;</span><br>(<span class="hljs-built_in">a5</span>), <span class="hljs-string">&quot;r&quot;</span>(<span class="hljs-keyword">syscall_id));</span><br><span class="hljs-keyword"></span>return <span class="hljs-built_in">a0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Xv6</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Xv6 Chapter 5</title>
    <link href="/2024/09/27/MIT-6-1810-Xv6-Chapter-5/"/>
    <url>/2024/09/27/MIT-6-1810-Xv6-Chapter-5/</url>
    
    <content type="html"><![CDATA[<h1 id="Interrupts-and-device-drivers"><a href="#Interrupts-and-device-drivers" class="headerlink" title="Interrupts and device drivers"></a>Interrupts and device drivers</h1><span id="more"></span><p>é©±åŠ¨ç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­èµ·ç€ç®¡ç†ç¡¬ä»¶è®¾å¤‡çš„é‡è¦ä½œç”¨ã€‚å®ƒè´Ÿè´£é…ç½®è®¾å¤‡ç¡¬ä»¶ã€å¯åŠ¨æ“ä½œã€å¤„ç†ä¸­æ–­ï¼Œå¹¶ä¸å¯èƒ½åœ¨ç­‰å¾…è®¾å¤‡è¾“å…¥&#x2F;è¾“å‡ºï¼ˆI&#x2F;Oï¼‰çš„è¿›ç¨‹è¿›è¡Œåè°ƒã€‚é©±åŠ¨ç¨‹åºä»£ç æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸å®ƒç®¡ç†çš„è®¾å¤‡å¹¶å‘æ‰§è¡Œã€‚æ­¤å¤–ï¼Œé©±åŠ¨ç¨‹åºå¿…é¡»ç†è§£è®¾å¤‡çš„ç¡¬ä»¶æ¥å£ï¼Œè€Œè¿™äº›æ¥å£å¾€å¾€æ¯”è¾ƒå¤æ‚ï¼Œç”šè‡³æ–‡æ¡£ä¸å…¨ã€‚</p><p>éœ€è¦æ“ä½œç³»ç»Ÿå…³æ³¨çš„è®¾å¤‡é€šå¸¸å¯ä»¥é…ç½®ä¸ºç”Ÿæˆä¸­æ–­ï¼Œä¸­æ–­æ˜¯ä¸€ç§é™·é˜±ï¼ˆtrapï¼‰ã€‚å†…æ ¸çš„é™·é˜±å¤„ç†ä»£ç è¯†åˆ«å‡ºè®¾å¤‡è§¦å‘äº†ä¸­æ–­ï¼Œå¹¶è°ƒç”¨é©±åŠ¨ç¨‹åºçš„ä¸­æ–­å¤„ç†ç¨‹åºã€‚åœ¨ <strong>xv6</strong> æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªè°ƒåº¦è¿‡ç¨‹å‘ç”Ÿåœ¨ <code>devintr</code>ï¼ˆkernel&#x2F;trap.c:185ï¼‰ä¸­ã€‚</p><p>è®¸å¤šè®¾å¤‡é©±åŠ¨ç¨‹åºåœ¨ä¸¤ç§ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç ï¼šä¸ŠåŠéƒ¨åˆ†åœ¨è¿›ç¨‹çš„å†…æ ¸çº¿ç¨‹ä¸­è¿è¡Œï¼Œè€Œä¸‹åŠéƒ¨åˆ†åœ¨ä¸­æ–­å‘ç”Ÿæ—¶æ‰§è¡Œã€‚ä¸ŠåŠéƒ¨åˆ†é€šå¸¸é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ <code>read</code> å’Œ <code>write</code>ï¼‰è¢«è°ƒç”¨ï¼Œè¦æ±‚è®¾å¤‡æ‰§è¡ŒI&#x2F;Oæ“ä½œã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½è¯·æ±‚ç¡¬ç›˜è¯»å–ä¸€ä¸ªæ•°æ®å—ï¼Œå¹¶ç­‰å¾…æ“ä½œå®Œæˆã€‚æœ€ç»ˆï¼Œè®¾å¤‡å®Œæˆæ“ä½œå¹¶è§¦å‘ä¸­æ–­ã€‚é©±åŠ¨ç¨‹åºçš„ä¸­æ–­å¤„ç†ç¨‹åºä½œä¸ºä¸‹åŠéƒ¨åˆ†è¿è¡Œï¼Œç¡®å®šå®Œæˆäº†ä»€ä¹ˆæ“ä½œï¼Œå¿…è¦æ—¶å”¤é†’ç­‰å¾…çš„è¿›ç¨‹ï¼Œå¹¶æŒ‡ç¤ºç¡¬ä»¶ç»§ç»­å¤„ç†ä»»ä½•ç­‰å¾…çš„æ“ä½œã€‚</p><h2 id="5-1-Code-Console-input"><a href="#5-1-Code-Console-input" class="headerlink" title="5.1  Code: Console input"></a>5.1  Code: Console input</h2><p>æ§åˆ¶å°é©±åŠ¨ç¨‹åºï¼ˆkernel&#x2F;console.cï¼‰æ˜¯é©±åŠ¨ç¨‹åºç»“æ„çš„ç®€å•ç¤ºä¾‹ã€‚è¯¥é©±åŠ¨ç¨‹åºé€šè¿‡è¿æ¥åˆ°RISC-Vçš„UARTä¸²å£ç¡¬ä»¶æ¥æ”¶äººç±»è¾“å…¥çš„å­—ç¬¦ã€‚æ§åˆ¶å°é©±åŠ¨ç¨‹åºæ¯æ¬¡ç´¯ç§¯ä¸€è¡Œè¾“å…¥ï¼Œå¤„ç†ç‰¹æ®Šå­—ç¬¦å¦‚é€€æ ¼é”®å’ŒControl-Uã€‚ç”¨æˆ·è¿›ç¨‹ï¼ˆå¦‚shellï¼‰ä½¿ç”¨<code>read</code>ç³»ç»Ÿè°ƒç”¨ä»æ§åˆ¶å°è·å–è¾“å…¥ã€‚å½“ä½ åœ¨QEMUä¸­å‘xv6è¾“å…¥å†…å®¹æ—¶ï¼Œä½ çš„æŒ‰é”®é€šè¿‡QEMUæ¨¡æ‹Ÿçš„UARTç¡¬ä»¶ä¼ é€’åˆ°xv6ã€‚</p><p>é©±åŠ¨ç¨‹åºä¸UARTç¡¬ä»¶é€šä¿¡ï¼ŒUARTç¡¬ä»¶æ˜¯ç”±QEMUæ¨¡æ‹Ÿçš„16550èŠ¯ç‰‡ã€‚åœ¨çœŸå®è®¡ç®—æœºä¸­ï¼Œ16550èŠ¯ç‰‡ç®¡ç†è¿æ¥åˆ°ç»ˆç«¯æˆ–å…¶ä»–è®¡ç®—æœºçš„RS232ä¸²è¡Œé“¾æ¥ã€‚è€Œåœ¨QEMUä¸­ï¼Œå®ƒè¿æ¥åˆ°ä½ çš„é”®ç›˜å’Œæ˜¾ç¤ºå™¨ã€‚</p><p>UARTç¡¬ä»¶é€šè¿‡å†…å­˜æ˜ å°„çš„æ§åˆ¶å¯„å­˜å™¨å‘ˆç°ç»™è½¯ä»¶ã€‚å³ï¼ŒRISC-Vç¡¬ä»¶å°†ä¸€äº›ç‰©ç†åœ°å€è¿æ¥åˆ°UARTè®¾å¤‡ï¼Œå› æ­¤å¯¹è¿™äº›åœ°å€çš„åŠ è½½å’Œå­˜å‚¨æ“ä½œå°†ä¸è®¾å¤‡ç¡¬ä»¶äº¤äº’ï¼Œè€Œéä¸RAMäº¤äº’ã€‚UARTçš„å†…å­˜æ˜ å°„åœ°å€ä»<code>0x10000000</code>ï¼ˆå³<code>UART0</code>ï¼‰å¼€å§‹ï¼ˆå®šä¹‰åœ¨<code>kernel/memlayout.h:21</code>ï¼‰ã€‚UARTæ§åˆ¶å¯„å­˜å™¨æ˜¯å®½åº¦ä¸ºä¸€ä¸ªå­—èŠ‚çš„ä¸€ç»„å¯„å­˜å™¨ï¼Œå…¶åç§»é‡å®šä¹‰åœ¨<code>kernel/uart.c:22</code>ã€‚ä¾‹å¦‚ï¼ŒLSRå¯„å­˜å™¨åŒ…å«æŒ‡ç¤ºæ˜¯å¦æœ‰è¾“å…¥å­—ç¬¦ç­‰å¾…è¢«è½¯ä»¶è¯»å–çš„ä½ã€‚è¿™äº›å­—ç¬¦ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å¯ä»RHRå¯„å­˜å™¨è¯»å–ã€‚æ¯æ¬¡è¯»å–ä¸€ä¸ªå­—ç¬¦åï¼ŒUARTç¡¬ä»¶ä¼šä»å†…éƒ¨FIFOä¸­åˆ é™¤è¯¥å­—ç¬¦ï¼Œå¹¶åœ¨FIFOä¸ºç©ºæ—¶æ¸…é™¤LSRä¸­çš„â€œreadyâ€ä½ã€‚UARTçš„å‘é€ç¡¬ä»¶ä¸æ¥æ”¶ç¡¬ä»¶åŸºæœ¬ç‹¬ç«‹ï¼›å¦‚æœè½¯ä»¶å‘THRå†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼ŒUARTä¼šå‘é€è¯¥å­—èŠ‚ã€‚</p><p>xv6çš„<code>main</code>å‡½æ•°é€šè¿‡è°ƒç”¨<code>consoleinit</code>ï¼ˆkernel&#x2F;console.c:182ï¼‰åˆå§‹åŒ–UARTç¡¬ä»¶ã€‚è¯¥ä»£ç é…ç½®UARTï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡æ¥æ”¶åˆ°ä¸€ä¸ªè¾“å…¥å­—èŠ‚æ—¶ç”Ÿæˆæ¥æ”¶ä¸­æ–­ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡å®Œæˆå‘é€ä¸€ä¸ªè¾“å‡ºå­—èŠ‚æ—¶ç”Ÿæˆå‘é€å®Œæˆä¸­æ–­ï¼ˆkernel&#x2F;uart.c:53ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">consoleinit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  initlock(&amp;cons.lock, <span class="hljs-string">&quot;cons&quot;</span>);<br><br>  uartinit();<br><br>  <span class="hljs-comment">// connect read and write system calls</span><br>  <span class="hljs-comment">// to consoleread and consolewrite.</span><br>  devsw[CONSOLE].read = consoleread;<br>  devsw[CONSOLE].write = consolewrite;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>xv6çš„shellé€šè¿‡<code>init.c</code>æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆuser&#x2F;init.c:19ï¼‰ä»æ§åˆ¶å°è¯»å–æ•°æ®ã€‚å¯¹<code>read</code>ç³»ç»Ÿè°ƒç”¨çš„è¯·æ±‚é€šè¿‡å†…æ ¸åˆ°è¾¾<code>consoleread</code>ï¼ˆkernel&#x2F;console.c:80ï¼‰ã€‚<code>consoleread</code>ç­‰å¾…è¾“å…¥é€šè¿‡ä¸­æ–­åˆ°è¾¾å¹¶ç¼“å­˜åœ¨<code>cons.buf</code>ä¸­ï¼Œå°†è¾“å…¥å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶åœ¨æ•´è¡Œåˆ°è¾¾åè¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰è¾“å…¥å®Œæ•´çš„ä¸€è¡Œï¼Œä»»ä½•æ­£åœ¨è¯»å–çš„è¿›ç¨‹ä¼šåœ¨<code>sleep</code>è°ƒç”¨ä¸­ç­‰å¾…ï¼ˆkernel&#x2F;console.c:96ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//</span><br><span class="hljs-comment">// user read()s from the console go here.</span><br><span class="hljs-comment">// copy (up to) a whole input line to dst.</span><br><span class="hljs-comment">// user_dist indicates whether dst is a user</span><br><span class="hljs-comment">// or kernel address.</span><br><span class="hljs-comment">//</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">consoleread</span><span class="hljs-params">(<span class="hljs-type">int</span> user_dst, uint64 dst, <span class="hljs-type">int</span> n)</span><br>&#123;<br>  uint target;<br>  <span class="hljs-type">int</span> c;<br>  <span class="hljs-type">char</span> cbuf;<br><br>  target = n;<br>  acquire(&amp;cons.lock);<br>  <span class="hljs-keyword">while</span>(n &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-comment">// wait until interrupt handler has put some</span><br>    <span class="hljs-comment">// input into cons.buffer.</span><br>    <span class="hljs-keyword">while</span>(cons.r == cons.w)&#123;<br>      <span class="hljs-keyword">if</span>(killed(myproc()))&#123;<br>        release(&amp;cons.lock);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>      &#125;<br>      sleep(&amp;cons.r, &amp;cons.lock);<br>    &#125;<br><br>    c = cons.buf[cons.r++ % INPUT_BUF_SIZE];<br><br>    <span class="hljs-keyword">if</span>(c == C(<span class="hljs-string">&#x27;D&#x27;</span>))&#123;  <span class="hljs-comment">// end-of-file</span><br>      <span class="hljs-keyword">if</span>(n &lt; target)&#123;<br>        <span class="hljs-comment">// Save ^D for next time, to make sure</span><br>        <span class="hljs-comment">// caller gets a 0-byte result.</span><br>        cons.r--;<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// copy the input byte to the user-space buffer.</span><br>    cbuf = c;<br>    <span class="hljs-keyword">if</span>(either_copyout(user_dst, dst, &amp;cbuf, <span class="hljs-number">1</span>) == <span class="hljs-number">-1</span>)<br>      <span class="hljs-keyword">break</span>;<br><br>    dst++;<br>    --n;<br><br>    <span class="hljs-keyword">if</span>(c == <span class="hljs-string">&#x27;\n&#x27;</span>)&#123;<br>      <span class="hljs-comment">// a whole line has arrived, return to</span><br>      <span class="hljs-comment">// the user-level read().</span><br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  release(&amp;cons.lock);<br><br>  <span class="hljs-keyword">return</span> target - n;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå­—ç¬¦æ—¶ï¼ŒUARTç¡¬ä»¶è¯·æ±‚RISC-Vè§¦å‘ä¸­æ–­ï¼Œä»è€Œæ¿€æ´»xv6çš„é™·é˜±å¤„ç†ç¨‹åºã€‚é™·é˜±å¤„ç†ç¨‹åºè°ƒç”¨<code>devintr</code>ï¼ˆkernel&#x2F;trap.c:185ï¼‰ï¼Œè¯¥å‡½æ•°é€šè¿‡æŸ¥çœ‹RISC-Vçš„<code>scause</code>å¯„å­˜å™¨å‘ç°ä¸­æ–­æ¥è‡ªå¤–éƒ¨è®¾å¤‡ã€‚ç„¶åå®ƒè¯·æ±‚åä¸ºPLICçš„ç¡¬ä»¶å•å…ƒï¼ˆkernel&#x2F;trap.c:193ï¼‰å‘ŠçŸ¥ä¸­æ–­çš„è®¾å¤‡ã€‚å¦‚æœä¸­æ–­æ¥è‡ªUARTï¼Œ<code>devintr</code>ä¼šè°ƒç”¨<code>uartintr</code>ã€‚</p><p><code>uartintr</code>ï¼ˆkernel&#x2F;uart.c:177ï¼‰ä»UARTç¡¬ä»¶è¯»å–ä»»ä½•ç­‰å¾…çš„è¾“å…¥å­—ç¬¦ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™<code>consoleintr</code>ï¼ˆkernel&#x2F;console.c:136ï¼‰ï¼›å®ƒä¸ä¼šç­‰å¾…å­—ç¬¦ï¼Œå› ä¸ºå°†æ¥è¾“å…¥ä¼šè§¦å‘æ–°çš„ä¸­æ–­ã€‚<code>consoleintr</code>çš„ä»»åŠ¡æ˜¯å°†è¾“å…¥å­—ç¬¦ç´¯ç§¯åˆ°<code>cons.buf</code>ä¸­ï¼Œç›´åˆ°ä¸€æ•´è¡Œåˆ°è¾¾ã€‚<code>consoleintr</code>ä¼šç‰¹æ®Šå¤„ç†é€€æ ¼é”®å’Œå…¶ä»–ä¸€äº›å­—ç¬¦ã€‚å½“æ¢è¡Œç¬¦åˆ°è¾¾æ—¶ï¼Œ<code>consoleintr</code>ä¼šå”¤é†’ç­‰å¾…çš„<code>consoleread</code>ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//</span><br><span class="hljs-comment">// the console input interrupt handler.</span><br><span class="hljs-comment">// uartintr() calls this for input character.</span><br><span class="hljs-comment">// do erase/kill processing, append to cons.buf,</span><br><span class="hljs-comment">// wake up consoleread() if a whole line has arrived.</span><br><span class="hljs-comment">//</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">consoleintr</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span><br>&#123;<br>  acquire(&amp;cons.lock);<br><br>  <span class="hljs-keyword">switch</span>(c)&#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-title function_">C</span><span class="hljs-params">(<span class="hljs-string">&#x27;P&#x27;</span>)</span>:  <span class="hljs-comment">// Print process list.</span><br>    <span class="hljs-title function_">procdump</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-title function_">C</span><span class="hljs-params">(<span class="hljs-string">&#x27;U&#x27;</span>)</span>:  <span class="hljs-comment">// Kill line.</span><br>    <span class="hljs-title function_">while</span><span class="hljs-params">(cons.e != cons.w &amp;&amp;</span><br><span class="hljs-params">          cons.buf[(cons.e<span class="hljs-number">-1</span>) % INPUT_BUF_SIZE] != <span class="hljs-string">&#x27;\n&#x27;</span>)</span>&#123;<br>      cons.e--;<br>      consputc(BACKSPACE);<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-title function_">C</span><span class="hljs-params">(<span class="hljs-string">&#x27;H&#x27;</span>)</span>: <span class="hljs-comment">// Backspace</span><br>  <span class="hljs-keyword">case</span> &#x27;\x7f&#x27;: <span class="hljs-comment">// Delete key</span><br>    <span class="hljs-title function_">if</span><span class="hljs-params">(cons.e != cons.w)</span>&#123;<br>      cons.e--;<br>      consputc(BACKSPACE);<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">default</span>:<br>    <span class="hljs-keyword">if</span>(c != <span class="hljs-number">0</span> &amp;&amp; cons.e-cons.r &lt; INPUT_BUF_SIZE)&#123;<br>      c = (c == <span class="hljs-string">&#x27;\r&#x27;</span>) ? <span class="hljs-string">&#x27;\n&#x27;</span> : c;<br><br>      <span class="hljs-comment">// echo back to the user.</span><br>      consputc(c);<br><br>      <span class="hljs-comment">// store for consumption by consoleread().</span><br>      cons.buf[cons.e++ % INPUT_BUF_SIZE] = c;<br><br>      <span class="hljs-keyword">if</span>(c == <span class="hljs-string">&#x27;\n&#x27;</span> || c == C(<span class="hljs-string">&#x27;D&#x27;</span>) || cons.e-cons.r == INPUT_BUF_SIZE)&#123;<br>        <span class="hljs-comment">// wake up consoleread() if a whole line (or end-of-file)</span><br>        <span class="hljs-comment">// has arrived.</span><br>        cons.w = cons.e;<br>        wakeup(&amp;cons.r);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <br>  release(&amp;cons.lock);<br>&#125;<br><br><span class="hljs-comment">// handle a uart interrupt, raised because input has</span><br><span class="hljs-comment">// arrived, or the uart is ready for more output, or</span><br><span class="hljs-comment">// both. called from devintr().</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">uartintr</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-comment">// read and process incoming characters.</span><br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-type">int</span> c = uartgetc();<br>    <span class="hljs-keyword">if</span>(c == <span class="hljs-number">-1</span>)<br>      <span class="hljs-keyword">break</span>;<br>    consoleintr(c);<br>  &#125;<br><br>  <span class="hljs-comment">// send buffered characters.</span><br>  acquire(&amp;uart_tx_lock);<br>  uartstart();<br>  release(&amp;uart_tx_lock);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€æ—¦è¢«å”¤é†’ï¼Œ<code>consoleread</code>ä¼šæ£€æµ‹åˆ°<code>cons.buf</code>ä¸­æœ‰ä¸€æ•´è¡Œï¼Œå°†å…¶å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶é€šè¿‡ç³»ç»Ÿè°ƒç”¨æœºåˆ¶è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p><h2 id="5-2-Code-Console-output"><a href="#5-2-Code-Console-output" class="headerlink" title="5.2  Code: Console output"></a>5.2  Code: Console output</h2><p>åœ¨æ§åˆ¶å°è¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ä¸Šè¿›è¡Œçš„<code>write</code>ç³»ç»Ÿè°ƒç”¨æœ€ç»ˆä¼šåˆ°è¾¾<code>uartputc</code>ï¼ˆkernel&#x2F;uart.c:87ï¼‰ã€‚è®¾å¤‡é©±åŠ¨ç¨‹åºç»´æŠ¤ä¸€ä¸ªè¾“å‡ºç¼“å†²åŒºï¼ˆ<code>uart_tx_buf</code>ï¼‰ï¼Œè¿™æ ·å†™å…¥çš„è¿›ç¨‹ä¸éœ€è¦ç­‰å¾…UARTå®Œæˆå‘é€æ“ä½œï¼›ç›¸åï¼Œ<code>uartputc</code>ä¼šå°†æ¯ä¸ªå­—ç¬¦æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ï¼Œå¹¶è°ƒç”¨<code>uartstart</code>æ¥å¯åŠ¨è®¾å¤‡çš„ä¼ è¾“ï¼ˆå¦‚æœè®¾å¤‡å°šæœªä¼ è¾“ï¼‰ï¼Œç„¶åç«‹å³è¿”å›ã€‚å”¯ä¸€ä¼šå¯¼è‡´<code>uartputc</code>ç­‰å¾…çš„æƒ…å†µæ˜¯ç¼“å†²åŒºå·²æ»¡ã€‚</p><p>æ¯æ¬¡UARTå®Œæˆå‘é€ä¸€ä¸ªå­—èŠ‚æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªä¸­æ–­ã€‚<code>uartintr</code>ä¼šè°ƒç”¨<code>uartstart</code>ï¼Œè¯¥å‡½æ•°æ£€æŸ¥è®¾å¤‡æ˜¯å¦ç¡®å®å®Œæˆäº†å‘é€ï¼Œå¹¶å°†ä¸‹ä¸€ä¸ªç¼“å†²çš„è¾“å‡ºå­—ç¬¦äº¤ç»™è®¾å¤‡ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹å‘æ§åˆ¶å°å†™å…¥å¤šä¸ªå­—èŠ‚ï¼Œé€šå¸¸ç¬¬ä¸€ä¸ªå­—èŠ‚ä¼šé€šè¿‡<code>uartputc</code>è°ƒç”¨<code>uartstart</code>å‘é€ï¼Œå‰©ä½™çš„ç¼“å†²å­—èŠ‚åˆ™ç”±<code>uartstart</code>åœ¨UARTå‘é€å®Œæˆä¸­æ–­åˆ°æ¥æ—¶è°ƒç”¨<code>uartintr</code>å‘é€ã€‚</p><p>éœ€è¦æ³¨æ„çš„ä¸€ä¸ªé€šç”¨æ¨¡å¼æ˜¯é€šè¿‡ç¼“å†²å’Œä¸­æ–­å°†è®¾å¤‡æ´»åŠ¨ä¸è¿›ç¨‹æ´»åŠ¨è§£è€¦ã€‚å³ä½¿æ²¡æœ‰è¿›ç¨‹åœ¨ç­‰å¾…è¯»å–ï¼Œæ§åˆ¶å°é©±åŠ¨ç¨‹åºä»ç„¶å¯ä»¥å¤„ç†è¾“å…¥ï¼›ä¹‹åçš„è¯»å–æ“ä½œå°†èƒ½å¤Ÿçœ‹åˆ°è¿™äº›è¾“å…¥ã€‚åŒæ ·ï¼Œè¿›ç¨‹å¯ä»¥å‘é€è¾“å‡ºè€Œä¸å¿…ç­‰å¾…è®¾å¤‡çš„å“åº”ã€‚è¿™ç§è§£è€¦å¯ä»¥é€šè¿‡å…è®¸è¿›ç¨‹ä¸è®¾å¤‡I&#x2F;Oå¹¶å‘æ‰§è¡Œæ¥æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨è®¾å¤‡è¾ƒæ…¢ï¼ˆå¦‚UARTï¼‰æˆ–éœ€è¦ç«‹å³å¤„ç†ï¼ˆå¦‚å›æ˜¾è¾“å…¥å­—ç¬¦ï¼‰çš„æƒ…å†µä¸‹ã€‚è¿™ç§æ€æƒ³æœ‰æ—¶è¢«ç§°ä¸ºI&#x2F;Oå¹¶å‘ã€‚</p><h2 id="5-3-Concurrency-in-drivers"><a href="#5-3-Concurrency-in-drivers" class="headerlink" title="5.3 Concurrency in drivers"></a>5.3 Concurrency in drivers</h2><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°åœ¨<code>consoleread</code>å’Œ<code>consoleintr</code>ä¸­è°ƒç”¨äº†<code>acquire</code>å‡½æ•°ã€‚è¿™äº›è°ƒç”¨ç”¨äºè·å–é”ï¼Œä»¥ä¿æŠ¤æ§åˆ¶å°é©±åŠ¨ç¨‹åºçš„æ•°æ®ç»“æ„å…å—å¹¶å‘è®¿é—®çš„å½±å“ã€‚è¿™é‡Œæœ‰ä¸‰ç§å¹¶å‘çš„æ½œåœ¨å±é™©ï¼šä¸¤ä¸ªè¿›ç¨‹åœ¨ä¸åŒçš„CPUä¸ŠåŒæ—¶è°ƒç”¨<code>consoleread</code>ï¼›ç¡¬ä»¶å¯èƒ½è¯·æ±‚CPUåœ¨è¯¥CPUå·²ç»åœ¨æ‰§è¡Œ<code>consoleread</code>æ—¶ä¼ é€’æ§åˆ¶å°ï¼ˆå®é™…ä¸Šæ˜¯UARTï¼‰çš„ä¸­æ–­ï¼›ç¡¬ä»¶å¯èƒ½åœ¨ä¸åŒçš„CPUä¸Šä¼ é€’æ§åˆ¶å°ä¸­æ–­ï¼Œè€Œæ­¤æ—¶<code>consoleread</code>æ­£åœ¨æ‰§è¡Œã€‚ç¬¬å…­ç« è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨é”æ¥ç¡®ä¿è¿™äº›å¹¶å‘é—®é¢˜ä¸ä¼šå¯¼è‡´é”™è¯¯çš„ç»“æœã€‚</p><p>å¹¶å‘å¯¹é©±åŠ¨ç¨‹åºçš„å¦ä¸€ä¸ªå½±å“æ˜¯ï¼ŒæŸä¸ªè¿›ç¨‹å¯èƒ½æ­£åœ¨ç­‰å¾…è®¾å¤‡è¾“å…¥ï¼Œä½†è¾“å…¥åˆ°æ¥çš„ä¸­æ–­å¯èƒ½å‘ç”Ÿåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆç”šè‡³æ˜¯æ²¡æœ‰è¿›ç¨‹è¿è¡Œçš„æƒ…å†µä¸‹ï¼‰ã€‚å› æ­¤ï¼Œä¸­æ–­å¤„ç†ç¨‹åºä¸å…è®¸è€ƒè™‘å®ƒæ‰€ä¸­æ–­çš„è¿›ç¨‹æˆ–ä»£ç ã€‚ä¾‹å¦‚ï¼Œä¸­æ–­å¤„ç†ç¨‹åºä¸èƒ½å®‰å…¨åœ°è°ƒç”¨<code>copyout</code>ï¼Œå› ä¸ºå®ƒä¾èµ–äºå½“å‰è¿›ç¨‹çš„é¡µè¡¨ã€‚ä¸­æ–­å¤„ç†ç¨‹åºé€šå¸¸æ‰§è¡Œçš„å·¥ä½œç›¸å¯¹è¾ƒå°‘ï¼ˆä¾‹å¦‚ï¼Œåªæ˜¯å°†è¾“å…¥æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­ï¼‰ï¼Œç„¶åå”¤é†’ä¸ŠåŠéƒ¨åˆ†ä»£ç æ¥å®Œæˆå…¶ä½™å·¥ä½œã€‚</p><h2 id="5-4-Timer-interrupts"><a href="#5-4-Timer-interrupts" class="headerlink" title="5.4 Timer interrupts"></a>5.4 Timer interrupts</h2><p>Xv6 ä½¿ç”¨å®šæ—¶å™¨ä¸­æ–­æ¥ç»´æŠ¤å½“å‰æ—¶é—´çš„æ¦‚å¿µï¼Œå¹¶åœ¨è®¡ç®—å¯†é›†å‹è¿›ç¨‹ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚å®šæ—¶å™¨ä¸­æ–­æ¥è‡ªè¿æ¥åˆ°æ¯ä¸ª RISC-V CPU çš„æ—¶é’Ÿç¡¬ä»¶ã€‚Xv6 é€šè¿‡ç¼–ç¨‹ä½¿æ¯ä¸ª CPU çš„æ—¶é’Ÿç¡¬ä»¶å®šæœŸä¸­æ–­ CPUã€‚</p><p><code>start.c</code>ä¸­çš„ä»£ç ï¼ˆkernel&#x2F;start.c:53ï¼‰è®¾ç½®äº†ä¸€äº›æ§åˆ¶ä½ï¼Œå…è®¸ç›‘ç£æ¨¡å¼è®¿é—®å®šæ—¶å™¨æ§åˆ¶å¯„å­˜å™¨ï¼Œç„¶åè¯·æ±‚ç¬¬ä¸€æ¬¡å®šæ—¶å™¨ä¸­æ–­ã€‚å®šæ—¶å™¨æ§åˆ¶å¯„å­˜å™¨åŒ…å«ä¸€ä¸ªç¡¬ä»¶ä»¥ç¨³å®šé€Ÿç‡é€’å¢çš„è®¡æ•°ï¼Œè¿™è¡¨ç¤ºå½“å‰æ—¶é—´ã€‚<code>stimecmp</code>å¯„å­˜å™¨åˆ™åŒ…å« CPU å°†è§¦å‘å®šæ—¶å™¨ä¸­æ–­çš„æ—¶é—´ï¼›é€šè¿‡å°†<code>stimecmp</code>è®¾ç½®ä¸ºå½“å‰æ—¶é—´åŠ ä¸Š<code>x</code>ï¼Œå¯ä»¥å®‰æ’åœ¨<code>x</code>ä¸ªæ—¶é—´å•ä½åè§¦å‘ä¸­æ–­ã€‚å¯¹äº QEMU çš„ RISC-V æ¨¡æ‹Ÿï¼Œ1000000 ä¸ªæ—¶é—´å•ä½å¤§çº¦ç­‰äºååˆ†ä¹‹ä¸€ç§’ã€‚</p><p>å®šæ—¶å™¨ä¸­æ–­åƒå…¶ä»–è®¾å¤‡ä¸­æ–­ä¸€æ ·ï¼Œé€šè¿‡<code>usertrap</code>æˆ–<code>kerneltrap</code>å’Œ<code>devintr</code>åˆ°è¾¾ã€‚å®šæ—¶å™¨ä¸­æ–­åˆ°æ¥æ—¶ï¼Œ<code>scause</code>å¯„å­˜å™¨çš„ä½ä½è¢«è®¾ç½®ä¸º5ï¼›<code>trap.c</code>ä¸­çš„<code>devintr</code>æ£€æµ‹åˆ°è¿™ç§æƒ…å†µå¹¶è°ƒç”¨<code>clockintr</code>ï¼ˆkernel&#x2F;trap.c:164ï¼‰ã€‚è¯¥å‡½æ•°é€’å¢<code>ticks</code>å˜é‡ï¼Œä»è€Œä½¿å†…æ ¸èƒ½å¤Ÿè·Ÿè¸ªæ—¶é—´çš„æµé€ã€‚ä¸ºé¿å…åœ¨å¤šCPUæƒ…å†µä¸‹æ—¶é—´æµé€åŠ é€Ÿï¼Œé€’å¢æ“ä½œä»…å‘ç”Ÿåœ¨ä¸€ä¸ªCPUä¸Šã€‚<code>clockintr</code>å”¤é†’ä»»ä½•åœ¨<code>sleep</code>ç³»ç»Ÿè°ƒç”¨ä¸­ç­‰å¾…çš„è¿›ç¨‹ï¼Œå¹¶é€šè¿‡å†™å…¥<code>stimecmp</code>æ¥å®‰æ’ä¸‹ä¸€ä¸ªå®šæ—¶å™¨ä¸­æ–­ã€‚</p><p><code>devintr</code>å¯¹äºå®šæ—¶å™¨ä¸­æ–­è¿”å›2ï¼Œä»¥æŒ‡ç¤º<code>kerneltrap</code>æˆ–<code>usertrap</code>è°ƒç”¨<code>yield</code>ï¼Œä»è€Œä½¿ CPU å¯ä»¥åœ¨å¯è¿è¡Œçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œå¤šè·¯å¤ç”¨ã€‚</p><p>å®šæ—¶å™¨ä¸­æ–­åœ¨å†…æ ¸ä»£ç ä¸­å¯èƒ½ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<code>usertrap</code>çš„æ—©æœŸä»£ç åœ¨å¯ç”¨ä¸­æ–­ä¹‹å‰è¦è°¨æ…ä¿å­˜çŠ¶æ€ï¼ˆå¦‚<code>sepc</code>ï¼‰ã€‚è¿™äº›ä¸Šä¸‹æ–‡åˆ‡æ¢æ„å‘³ç€å†…æ ¸ä»£ç å¿…é¡»ä»¥èƒ½å¤Ÿåœ¨æ²¡æœ‰è­¦å‘Šçš„æƒ…å†µä¸‹ä»ä¸€ä¸ª CPU è½¬ç§»åˆ°å¦ä¸€ä¸ª CPU çš„æ–¹å¼ç¼–å†™ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Xv6 Chapter 4</title>
    <link href="/2024/09/26/MIT-6-1810-Xv6-Chapter-4/"/>
    <url>/2024/09/26/MIT-6-1810-Xv6-Chapter-4/</url>
    
    <content type="html"><![CDATA[<h1 id="Traps-and-system-calls"><a href="#Traps-and-system-calls" class="headerlink" title="Traps and system calls"></a>Traps and system calls</h1><span id="more"></span><p>æœ‰ä¸‰ç§æƒ…å†µä¼šå¯¼è‡´CPUæš‚åœæ™®é€šæŒ‡ä»¤çš„æ‰§è¡Œï¼Œå¹¶å¼ºåˆ¶è½¬ç§»æ§åˆ¶æƒåˆ°å¤„ç†è¯¥äº‹ä»¶çš„ç‰¹æ®Šä»£ç ã€‚</p><ol><li>ç³»ç»Ÿè°ƒç”¨ï¼šå½“ç”¨æˆ·ç¨‹åºæ‰§è¡Œ <code>ecall</code> æŒ‡ä»¤è¯·æ±‚å†…æ ¸ä¸ºå…¶æ‰§è¡ŒæŸé¡¹æ“ä½œæ—¶ï¼Œå°±ä¼šå‘ç”Ÿç³»ç»Ÿè°ƒç”¨ã€‚</li><li>å¼‚å¸¸ï¼šå½“æŒ‡ä»¤ï¼ˆæ— è®ºæ˜¯ç”¨æˆ·æŒ‡ä»¤è¿˜æ˜¯å†…æ ¸æŒ‡ä»¤ï¼‰æ‰§è¡Œäº†éæ³•æ“ä½œæ—¶ï¼Œä¾‹å¦‚é™¤ä»¥é›¶æˆ–ä½¿ç”¨æ— æ•ˆçš„è™šæ‹Ÿåœ°å€ï¼Œå°±ä¼šè§¦å‘å¼‚å¸¸ã€‚</li><li>è®¾å¤‡ä¸­æ–­ï¼šå½“æŸä¸ªè®¾å¤‡å‘å‡ºä¿¡å·è¡¨ç¤ºå®ƒéœ€è¦å¤„ç†æ—¶ï¼Œä¾‹å¦‚ç£ç›˜ç¡¬ä»¶å®Œæˆäº†è¯»å†™è¯·æ±‚ï¼Œå°±ä¼šå‘ç”Ÿè®¾å¤‡ä¸­æ–­ã€‚</li></ol><p>xv6ä¸­ç”¨trapæ¥ä»£è¡¨ä»¥ä¸Šä¸‰ç§æƒ…å†µã€‚é€šå¸¸çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>trapå¼ºåˆ¶å°†æ§åˆ¶æƒè½¬ç§»åˆ°å†…æ ¸</li><li>å†…æ ¸ä¿å­˜å¯„å­˜å™¨å’Œå…¶ä»–çŠ¶æ€</li><li>å†…æ ¸æ‰§è¡Œç›¸åº”çš„å¤„ç†ä»£ç </li><li>å†…æ ¸æ¢å¤å¯„å­˜å™¨å’Œå…¶ä»–çŠ¶æ€ï¼Œè·³è½¬åˆ°åŸæ¥çš„ä»£ç ç»§ç»­æ‰§è¡Œ</li></ol><p>Xv6 çš„trapå¤„ç†åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p><ol><li>ç¬¬ä¸€é˜¶æ®µæ˜¯ RISC-V CPU æ‰§è¡Œçš„ç¡¬ä»¶æ“ä½œ</li><li>ç¬¬äºŒé˜¶æ®µæ˜¯ä¸€äº›æ±‡ç¼–æŒ‡ä»¤ç”¨äºå‡†å¤‡å†…æ ¸ C ä»£ç </li><li>ç¬¬ä¸‰é˜¶æ®µæ˜¯ C å‡½æ•°å†³å®šå¦‚ä½•å¤„ç†é™·é˜±</li><li>æœ€åæ˜¯ç³»ç»Ÿè°ƒç”¨æˆ–è®¾å¤‡é©±åŠ¨ç¨‹åºæœåŠ¡ä¾‹ç¨‹ã€‚</li></ol><p>å°½ç®¡è¿™ä¸‰ç§trapç±»å‹ä¹‹é—´æœ‰å¾ˆå¤šå…±åŒç‚¹ï¼Œç†è®ºä¸Šå¯ä»¥ç”¨ä¸€æ¡ä»£ç è·¯å¾„å¤„ç†æ‰€æœ‰trapï¼Œä½†å®é™…ä¸Šå°†æ¥è‡ªç”¨æˆ·ç©ºé—´å’Œæ¥è‡ªå†…æ ¸ç©ºé—´çš„trapåˆ†å¼€å¤„ç†æ›´ä¸ºæ–¹ä¾¿ã€‚å¤„ç†trapçš„å†…æ ¸ä»£ç ï¼ˆæ±‡ç¼–æˆ– Cï¼‰é€šå¸¸è¢«ç§°ä¸ºå¤„ç†ç¨‹åºï¼Œæœ€å¼€å§‹çš„å¤„ç†ç¨‹åºæŒ‡ä»¤é€šå¸¸ç”¨æ±‡ç¼–ç¼–å†™ï¼Œç§°ä¸ºå‘é‡ï¼ˆvectorï¼‰ã€‚</p><h2 id="4-1-RISC-V-trap-machinery"><a href="#4-1-RISC-V-trap-machinery" class="headerlink" title="4.1 RISC-V trap machinery"></a>4.1 RISC-V trap machinery</h2><p>æ¯ä¸ªRISC-Vçš„CPUéƒ½æœ‰ä¸€å¥—æ§åˆ¶å¯„å­˜å™¨ï¼Œå†…æ ¸å¯ä»¥è¯»å†™è¿™äº›æ§åˆ¶å¯„å­˜å™¨æ¥å‘Šè¯‰CPUå¦‚ä½•å¤„ç†trapæˆ–è€…äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆtrapã€‚riscv.hä¸­åŒ…å«äº†xv6ç”¨åˆ°çš„å®šä¹‰ã€‚</p><p>ä¸€äº›æ¯”è¾ƒé‡è¦çš„å¯„å­˜å™¨ï¼š</p><ul><li><strong>stvec</strong>ï¼šå†…æ ¸åœ¨æ­¤å¯„å­˜å™¨ä¸­å†™å…¥trapå¤„ç†ç¨‹åºçš„åœ°å€ï¼›RISC-V å‘ç”Ÿtrapæ—¶ä¼šè·³è½¬åˆ° <code>stvec</code> ä¸­çš„åœ°å€å»å¤„ç†trapã€‚</li><li><strong>sepc</strong>ï¼šå‘ç”Ÿtrapæ—¶ï¼ŒRISC-V å°†ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰çš„å€¼ä¿å­˜åˆ°æ­¤å¯„å­˜å™¨ä¸­ï¼ˆå› ä¸º PC éšåä¼šè¢« <code>stvec</code> ä¸­çš„å€¼è¦†ç›–ï¼‰ã€‚<code>sret</code>ï¼ˆä»é™·é˜±è¿”å›ï¼‰æŒ‡ä»¤ä¼šå°† <code>sepc</code> çš„å€¼å¤åˆ¶å› PCã€‚å†…æ ¸å¯ä»¥é€šè¿‡å†™å…¥ <code>sepc</code> æ¥æ§åˆ¶ <code>sret</code> çš„è¿”å›åœ°å€ã€‚</li><li><strong>scause</strong>ï¼šRISC-V åœ¨æ­¤å¯„å­˜å™¨ä¸­å­˜å‚¨ä¸€ä¸ªæ•°å­—ï¼Œæè¿°trapå‘ç”Ÿçš„åŸå› ã€‚</li><li><strong>sscratch</strong>ï¼štrapå¤„ç†ç¨‹åºä½¿ç”¨æ­¤å¯„å­˜å™¨å¸®åŠ©é¿å…åœ¨ä¿å­˜ç”¨æˆ·å¯„å­˜å™¨ä¹‹å‰è¦†ç›–å®ƒä»¬ã€‚</li><li><strong>sstatus</strong>ï¼š<code>sstatus</code> ä¸­çš„ SIEï¼ˆsupervisor interrupt enableï¼‰ ä½æ§åˆ¶è®¾å¤‡ä¸­æ–­æ˜¯å¦å¯ç”¨ã€‚å¦‚æœå†…æ ¸æ¸…é™¤ SIE ä½ï¼ŒRISC-V å°†æ¨è¿Ÿè®¾å¤‡ä¸­æ–­ï¼Œç›´åˆ°å†…æ ¸è®¾ç½® SIE ä½ã€‚SPP ä½åˆ™æŒ‡ç¤ºtrapæ˜¯æ¥è‡ªç”¨æˆ·æ€è¿˜æ˜¯Sæ€ï¼Œå¹¶ä¸”æ§åˆ¶ <code>sret</code> çš„è¿”å›æ€ã€‚</li></ul><p>ä»¥ä¸Šå¯„å­˜å™¨åªèƒ½åœ¨Sæ€è®¿é—®ï¼Œç”¨æˆ·æ€ä¸èƒ½è®¿é—®ã€‚æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„ä¸€å¥—æ§åˆ¶å¯„å­˜å™¨ï¼Œåœ¨æŸä¸ªæ—¶é—´å¯èƒ½æœ‰å¤šä¸ªCPUåœ¨å¤„ç†trapã€‚</p><p>å½“éœ€è¦å¤„ç†ä¸€ä¸ªtrapæ—¶ï¼Œ<strong>ç¡¬ä»¶è¿›è¡Œå¦‚ä¸‹æ“ä½œ</strong>ï¼š</p><ol><li>å¦‚æœsstatusä¸­çš„SIEä½æ²¡æœ‰è®¾ç½®ï¼Œå¹¶ä¸”trapçš„ç§ç±»æ˜¯è®¾å¤‡ä¸­æ–­ï¼Œåˆ™ä¸è¿›è¡Œä¸‹åˆ—æ“ä½œã€‚</li><li>æ¸…é™¤sstatusä¸­çš„SIEä½æ¥ç¦ç”¨è®¾å¤‡ä¸­æ–­ã€‚</li><li>å°†pcçš„å€¼æ‹·è´åˆ°sepcä¸­</li><li>å°†å½“å‰çš„æ¨¡å¼ä¿å­˜åˆ°sstatusä¸­çš„SPPä½ä¸­</li><li>è®¾ç½®scauseå¯„å­˜å™¨çš„å€¼æ¥æ ‡è¯†trapçš„åŸå› </li><li>åˆ‡æ¢åˆ°Sæ€</li><li>å°†stvecçš„å€¼æ‹·è´åˆ°pc</li><li>å¼€å§‹æ‰§è¡ŒpcæŒ‡å‘çš„æŒ‡ä»¤</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¡¬ä»¶å¹¶ä¸è´Ÿè´£å°†é¡µè¡¨åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨ï¼Œä¹Ÿä¸è´Ÿè´£åˆ‡æ¢åˆ°å†…æ ¸æ ˆï¼Œä¹Ÿä¸ä¼šä¿å­˜é™¤äº†pcä»¥å¤–çš„å…¶ä»–å¯„å­˜å™¨çš„å€¼ï¼Œå› æ­¤å†…æ ¸çš„è½¯ä»¶å¿…é¡»è´Ÿè´£è¿™äº›ã€‚</p><h2 id="4-2-Traps-from-user-space"><a href="#4-2-Traps-from-user-space" class="headerlink" title="4.2 Traps from user space"></a>4.2 Traps from user space</h2><p>xv6ä¸­å¤„ç†æ¥è‡ªç”¨æˆ·æ€çš„trapçš„è·¯å¾„å¤§æ¦‚å¦‚ä¸‹ï¼š</p><ol><li>uservecï¼ˆkernel&#x2F;trampoline.Sï¼‰</li><li>usertrapï¼ˆkernel&#x2F;trap.cï¼‰</li><li>è¿”å›åï¼Œusertrapretï¼ˆkernel&#x2F;trap.cï¼‰</li><li>userretï¼ˆkernel&#x2F;trampoline.Sï¼‰</li></ol><p>Xv6 çš„trapå¤„ç†è®¾è®¡ä¸­ä¸€ä¸ªé‡è¦çš„é™åˆ¶æ˜¯ RISC-V ç¡¬ä»¶åœ¨è§¦å‘trapæ—¶ä¸ä¼šåˆ‡æ¢é¡µè¡¨ã€‚è¿™æ„å‘³ç€ <code>stvec</code> ä¸­çš„trapå¤„ç†ç¨‹åºåœ°å€å¿…é¡»åœ¨ç”¨æˆ·é¡µè¡¨ä¸­æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æ˜ å°„ï¼Œå› ä¸ºtrapå¤„ç†ä»£ç å¼€å§‹æ‰§è¡Œæ—¶ï¼Œç”¨æˆ·é¡µè¡¨ä»ç„¶ç”Ÿæ•ˆã€‚æ­¤å¤–ï¼ŒXv6 çš„trapå¤„ç†ä»£ç è¿˜éœ€è¦åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨ï¼›ä¸ºäº†åœ¨åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨åèƒ½å¤Ÿç»§ç»­æ‰§è¡Œï¼Œå†…æ ¸é¡µè¡¨ä¹Ÿå¿…é¡»ä¸º <code>stvec</code> æŒ‡å‘çš„å¤„ç†ç¨‹åºåœ°å€æä¾›æ˜ å°„ã€‚</p><p>Xv6 é€šè¿‡ä½¿ç”¨trampoline pageæ¥æ»¡è¶³è¿™äº›è¦æ±‚ã€‚è¯¥é¡µåŒ…å«äº† <code>uservec</code>ï¼Œå³ Xv6 çš„trapå¤„ç†ä»£ç ï¼Œè€Œ <code>stvec</code> æŒ‡å‘è¿™ä¸ªä»£ç ã€‚è¯¥é¡µè¢«æ˜ å°„åœ¨æ¯ä¸ªè¿›ç¨‹çš„é¡µè¡¨ä¸­ï¼Œåœ°å€æ˜¯ <code>TRAMPOLINE</code>ï¼Œè¯¥é¡µåŒæ ·ä¹Ÿè¢«æ˜ å°„åœ¨å†…æ ¸é¡µè¡¨ä¸­çš„ <code>TRAMPOLINE</code> åœ°å€ä¸Šã€‚ç”±äºè¯¥é¡µåœ¨å†…æ ¸åœ°å€ç©ºé—´ä¸­å’Œç”¨æˆ·åœ°å€ç©ºé—´ä¸­æ˜ å°„åœ¨ç›¸åŒçš„åœ°å€ï¼Œå› æ­¤trapå¤„ç†ç¨‹åºåœ¨åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨åå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p><p><code>uservec</code> çš„ä»£ç åœ¨ <code>trampoline.S</code> æ–‡ä»¶ä¸­ï¼ˆkernel&#x2F;trampoline.S:22ï¼‰ã€‚å½“ <code>uservec</code> å¼€å§‹æ‰§è¡Œæ—¶ï¼Œæ‰€æœ‰32ä¸ªå¯„å­˜å™¨éƒ½åŒ…å«äº†è¢«ä¸­æ–­çš„ç”¨æˆ·ä»£ç çš„å€¼ã€‚è¿™äº›32ä¸ªå¯„å­˜å™¨çš„å€¼éœ€è¦ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾¿ç¨åå†…æ ¸åœ¨è¿”å›ç”¨æˆ·ç©ºé—´ä¹‹å‰æ¢å¤å®ƒä»¬ã€‚å°†è¿™äº›å€¼å­˜å‚¨åˆ°å†…å­˜éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯„å­˜å™¨æ¥å­˜æ”¾å†…å­˜åœ°å€ï¼Œä½†æ­¤æ—¶æ²¡æœ‰ä»»ä½•é€šç”¨å¯„å­˜å™¨å¯ç”¨ã€‚RISC-V æä¾›äº† <code>sscratch</code> å¯„å­˜å™¨ä½œä¸ºå¸®åŠ©ã€‚åœ¨ <code>uservec</code> çš„å¼€å¤´ï¼Œ<code>csrw</code> æŒ‡ä»¤å°† <code>a0</code> ä¿å­˜åˆ° <code>sscratch</code> ä¸­ã€‚è¿™æ ·ï¼Œ<code>uservec</code> å°±æœ‰äº†ä¸€ä¸ªå¯„å­˜å™¨ï¼ˆ<code>a0</code>ï¼‰å¯ä»¥ä½¿ç”¨ã€‚</p><p><code>uservec</code> çš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä¿å­˜32ä¸ªç”¨æˆ·å¯„å­˜å™¨ã€‚å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…äº†ä¸€é¡µå†…å­˜ç”¨äºä¿å­˜ä¸€ä¸ª <code>trapframe</code> ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«ä¿å­˜è¿™32ä¸ªç”¨æˆ·å¯„å­˜å™¨çš„ç©ºé—´ï¼ˆè§ kernel&#x2F;proc.h:43ï¼‰ã€‚å› ä¸ºæ­¤æ—¶ <code>satp</code> ä»ç„¶æŒ‡å‘ç”¨æˆ·é¡µè¡¨ï¼Œå› æ­¤ <code>uservec</code> éœ€è¦ <code>trapframe</code> æ˜ å°„åˆ°ç”¨æˆ·åœ°å€ç©ºé—´ä¸­ã€‚Xv6 å°†æ¯ä¸ªè¿›ç¨‹çš„ <code>trapframe</code> æ˜ å°„åœ¨è¯¥è¿›ç¨‹ç”¨æˆ·é¡µè¡¨ä¸­çš„è™šæ‹Ÿåœ°å€ <code>TRAPFRAME</code>ï¼Œè¿™ä¸ªåœ°å€ä½äº <code>TRAMPOLINE</code> çš„ä¸‹æ–¹ã€‚æ¯ä¸ªè¿›ç¨‹çš„ <code>p-&gt;trapframe</code> ä¹ŸæŒ‡å‘ <code>trapframe</code>ï¼Œä½†ä½¿ç”¨çš„æ˜¯ç‰©ç†åœ°å€ï¼Œä»¥ä¾¿å†…æ ¸é€šè¿‡å†…æ ¸é¡µè¡¨è®¿é—®å®ƒã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// memlayout.h</span><br><span class="hljs-comment">// map the trampoline page to the highest address,</span><br><span class="hljs-comment">// in both user and kernel space.</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TRAMPOLINE (MAXVA - PGSIZE)</span><br><br><span class="hljs-comment">// User memory layout.</span><br><span class="hljs-comment">// Address zero first:</span><br><span class="hljs-comment">//   text</span><br><span class="hljs-comment">//   original data and bss</span><br><span class="hljs-comment">//   fixed-size stack</span><br><span class="hljs-comment">//   expandable heap</span><br><span class="hljs-comment">//   ...</span><br><span class="hljs-comment">//   TRAPFRAME (p-&gt;trapframe, used by the trampoline)</span><br><span class="hljs-comment">//   TRAMPOLINE (the same page as in the kernel)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TRAPFRAME (TRAMPOLINE - PGSIZE)</span><br></code></pre></td></tr></table></figure><p>å› æ­¤ï¼Œ<code>uservec</code> å°†åœ°å€ <code>TRAPFRAME</code> åŠ è½½åˆ° <code>a0</code> ä¸­ï¼Œå¹¶å°†æ‰€æœ‰ç”¨æˆ·å¯„å­˜å™¨ä¿å­˜åœ¨æ­¤å¤„ï¼ŒåŒ…æ‹¬ä» <code>sscratch</code> ä¸­è¯»å–çš„<code>a0</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># trampoline.S<br># save user a0 in sscratch so<br># a0 can be used to get at TRAPFRAME.<br>csrw sscratch, a0<br><br># each process has a separate p-&gt;trapframe memory area,<br># but it&#x27;s mapped to the same virtual address<br># (TRAPFRAME) in every process&#x27;s user page table.<br>li a0, TRAPFRAME<br><br># save the user registers in TRAPFRAME<br>sd ra, 40(a0)<br>sd sp, 48(a0)<br>sd gp, 56(a0)<br>sd tp, 64(a0)<br>sd t0, 72(a0)<br>sd t1, 80(a0)<br>sd t2, 88(a0)<br>sd s0, 96(a0)<br>sd s1, 104(a0)<br>sd a1, 120(a0)<br>sd a2, 128(a0)<br>sd a3, 136(a0)<br>sd a4, 144(a0)<br>sd a5, 152(a0)<br>sd a6, 160(a0)<br>sd a7, 168(a0)<br>sd s2, 176(a0)<br>sd s3, 184(a0)<br>sd s4, 192(a0)<br>sd s5, 200(a0)<br>sd s6, 208(a0)<br>sd s7, 216(a0)<br>sd s8, 224(a0)<br>sd s9, 232(a0)<br>sd s10, 240(a0)<br>sd s11, 248(a0)<br>sd t3, 256(a0)<br>sd t4, 264(a0)<br>sd t5, 272(a0)<br>sd t6, 280(a0)<br><br># save the user a0 in p-&gt;trapframe-&gt;a0<br>csrr t0, sscratch<br>sd t0, 112(a0)<br></code></pre></td></tr></table></figure><p><code>trapframe</code> è¿˜åŒ…å«å½“å‰è¿›ç¨‹çš„å†…æ ¸æ ˆåœ°å€ã€å½“å‰ CPU çš„ hartidã€<code>usertrap</code> å‡½æ•°çš„åœ°å€ä»¥åŠå†…æ ¸é¡µè¡¨çš„åœ°å€ã€‚<code>uservec</code> ä»ä¸­è¯»å–è¿™äº›å€¼ï¼Œå°† <code>satp</code> åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨ï¼Œå¹¶è·³è½¬åˆ° <code>usertrap</code>ã€‚æ³¨æ„åœ¨åˆ‡æ¢é¡µè¡¨ä¹‹å‰ä»¥åŠä¹‹åéœ€è¦æ‰§è¡Œ <code>sfence.vma</code> æŒ‡ä»¤ï¼Œç¬¬ä¸€æ¬¡ç¡®ä¿æ‰€æœ‰ä¹‹å‰çš„å†…å­˜æ“ä½œä½¿ç”¨çš„éƒ½æ˜¯ç”¨æˆ·é¡µè¡¨ï¼Œå¹¶ä¸”æ“ä½œéƒ½å·²ç»å®Œæˆï¼Œç„¶ååˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨ï¼Œå†æ¬¡æ‰§è¡Œè¯¥æŒ‡ä»¤ï¼Œç¡®ä¿TLBä¸­ç¼“å­˜çš„ä¹‹å‰ç”¨æˆ·é¡µè¡¨çš„PTEéƒ½å·²ç»è¢«åˆ·æ–°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># initialize kernel stack pointer, from p-&gt;trapframe-&gt;kernel_sp<br>ld sp, 8(a0)<br><br># make tp hold the current hartid, from p-&gt;trapframe-&gt;kernel_hartid<br>ld tp, 32(a0)<br><br># load the address of usertrap(), from p-&gt;trapframe-&gt;kernel_trap<br>ld t0, 16(a0)<br><br># fetch the kernel page table address, from p-&gt;trapframe-&gt;kernel_satp.<br>ld t1, 0(a0)<br><br># wait for any previous memory operations to complete, so that<br># they use the user page table.<br>sfence.vma zero, zero<br><br># install the kernel page table.<br>csrw satp, t1<br><br># flush now-stale user entries from the TLB.<br>sfence.vma zero, zero<br><br># jump to usertrap(), which does not return<br>jr t0<br></code></pre></td></tr></table></figure><p><code>usertrap</code> çš„ä»»åŠ¡æ˜¯ç¡®å®šé™·é˜±çš„åŸå› ï¼Œè¿›è¡Œå¤„ç†å¹¶è¿”å›ï¼ˆè§ kernel&#x2F;trap.c:37ï¼‰ã€‚å®ƒé¦–å…ˆå°† <code>stvec</code> æ”¹ä¸ºæŒ‡å‘ <code>kernelvec</code>ï¼Œä»¥ä¾¿å†…æ ¸ä¸­å‘ç”Ÿçš„é™·é˜±ç”± <code>kernelvec</code> å¤„ç†ã€‚å®ƒä¿å­˜ <code>sepc</code> å¯„å­˜å™¨ï¼ˆç¡¬ä»¶ä¿å­˜çš„ç”¨æˆ·ç¨‹åºè®¡æ•°å™¨ï¼‰ï¼Œå› ä¸º <code>usertrap</code> å¯èƒ½ä¼šè°ƒç”¨ <code>yield</code> åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…æ ¸çº¿ç¨‹ï¼Œè€Œè¯¥è¿›ç¨‹å¯èƒ½ä¼šè¿”å›ç”¨æˆ·ç©ºé—´ï¼Œå¹¶ä¿®æ”¹ <code>sepc</code>ã€‚æ ¹æ®scauseå¯„å­˜å™¨çš„å€¼è¿›è¡ŒtrapåŸå› çš„åˆ¤æ–­ï¼ˆç”±ç¡¬ä»¶è®¾ç½®ï¼‰ï¼šå¦‚æœé™·é˜±æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œ<code>usertrap</code> è°ƒç”¨ <code>syscall</code> å¤„ç†ï¼›å¦‚æœæ˜¯è®¾å¤‡ä¸­æ–­ï¼Œè°ƒç”¨ <code>devintr</code>ï¼›å¦åˆ™æ˜¯å¼‚å¸¸ï¼Œå†…æ ¸ä¼šç»ˆæ­¢å‡ºé”™çš„è¿›ç¨‹ã€‚åœ¨å¤„ç†ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨è·¯å¾„ä¼šå°†ä¿å­˜çš„ç”¨æˆ·ç¨‹åºè®¡æ•°å™¨å¢åŠ 4ï¼Œå› ä¸º RISC-V åœ¨ç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œä¼šå°†ç¨‹åºè®¡æ•°å™¨åœç•™åœ¨ <code>ecall</code> æŒ‡ä»¤ä¸Šï¼Œä½†ç”¨æˆ·ä»£ç éœ€è¦ä»åç»­çš„æŒ‡ä»¤ç»§ç»­æ‰§è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//</span><br><span class="hljs-comment">// handle an interrupt, exception, or system call from user space.</span><br><span class="hljs-comment">// called from trampoline.S</span><br><span class="hljs-comment">//</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">usertrap</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> which_dev = <span class="hljs-number">0</span>;<br>  <br>  <span class="hljs-comment">// SPPåœ¨trapå‘ç”Ÿçš„æ—¶å€™ç”±ç¡¬ä»¶è®¾ç½®</span><br>  <span class="hljs-keyword">if</span>((r_sstatus() &amp; SSTATUS_SPP) != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;usertrap: not from user mode&quot;</span>);<br><br>  <span class="hljs-comment">// send interrupts and exceptions to kerneltrap(),</span><br>  <span class="hljs-comment">// since we&#x27;re now in the kernel.</span><br>  w_stvec((uint64)kernelvec);<br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  <br>  <span class="hljs-comment">// save user program counter.</span><br>  p-&gt;trapframe-&gt;epc = r_sepc();<br>  <br>  <span class="hljs-comment">// scauseçš„å€¼ç”±ç¡¬ä»¶è®¾ç½®</span><br>  <span class="hljs-keyword">if</span>(r_scause() == <span class="hljs-number">8</span>)&#123;<br>    <span class="hljs-comment">// system call</span><br><br>    <span class="hljs-keyword">if</span>(killed(p))<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br><br>    <span class="hljs-comment">// sepc points to the ecall instruction,</span><br>    <span class="hljs-comment">// but we want to return to the next instruction.</span><br>    p-&gt;trapframe-&gt;epc += <span class="hljs-number">4</span>;<br><br>    <span class="hljs-comment">// an interrupt will change sepc, scause, and sstatus,</span><br>    <span class="hljs-comment">// so enable only now that we&#x27;re done with those registers.</span><br>    <span class="hljs-comment">// å‘ç”Ÿtrapçš„æ—¶å€™ï¼Œç¡¬ä»¶ä¼šå…³é—­è®¾å¤‡ä¸­æ–­</span><br>    intr_on();<br><br>    syscall();<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((which_dev = devintr()) != <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-comment">// è®¾å¤‡ä¸­æ–­</span><br>    <span class="hljs-comment">// ok</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">// å¼‚å¸¸</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;usertrap(): unexpected scause 0x%lx pid=%d\n&quot;</span>, r_scause(), p-&gt;pid);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;            sepc=0x%lx stval=0x%lx\n&quot;</span>, r_sepc(), r_stval());<br>    setkilled(p);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span>(killed(p))<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br><br>  <span class="hljs-comment">// give up the CPU if this is a timer interrupt.</span><br>  <span class="hljs-keyword">if</span>(which_dev == <span class="hljs-number">2</span>)<br>    yield();<br><br>  usertrapret();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿”å›ç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨ <code>usertrapret</code>ï¼ˆè§ kernel&#x2F;trap.c:90ï¼‰ã€‚è¿™ä¸ªå‡½æ•°è®¾ç½® RISC-V æ§åˆ¶å¯„å­˜å™¨ï¼Œä¸ºç”¨æˆ·ç©ºé—´çš„æœªæ¥é™·é˜±åšå¥½å‡†å¤‡ï¼šå°† <code>stvec</code> è®¾ç½®ä¸º <code>uservec</code> å¹¶å‡†å¤‡ <code>trapframe</code> å­—æ®µï¼Œè¿™æ˜¯ <code>uservec</code> ä¾èµ–çš„å†…å®¹ã€‚<code>usertrapret</code> å°† <code>sepc</code> è®¾ç½®ä¸ºå…ˆå‰ä¿å­˜çš„ç”¨æˆ·ç¨‹åºè®¡æ•°å™¨ã€‚æœ€åï¼Œ<code>usertrapret</code> è°ƒç”¨ä½äºtrampoline pageä¸Šçš„ <code>userret</code>ï¼Œè¯¥å‡½æ•°çš„ä»£ç æ˜ å°„åœ¨ç”¨æˆ·å’Œå†…æ ¸é¡µè¡¨ä¸­ï¼ŒåŸå› æ˜¯ <code>userret</code> çš„æ±‡ç¼–ä»£ç éœ€è¦åˆ‡æ¢é¡µè¡¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//</span><br><span class="hljs-comment">// return to user space</span><br><span class="hljs-comment">//</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">usertrapret</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br><br>  <span class="hljs-comment">// we&#x27;re about to switch the destination of traps from</span><br>  <span class="hljs-comment">// kerneltrap() to usertrap(), so turn off interrupts until</span><br>  <span class="hljs-comment">// we&#x27;re back in user space, where usertrap() is correct.</span><br>  intr_off();<br><br>  <span class="hljs-comment">// send syscalls, interrupts, and exceptions to uservec in trampoline.S</span><br>  uint64 trampoline_uservec = TRAMPOLINE + (uservec - trampoline);<br>  w_stvec(trampoline_uservec);<br><br>  <span class="hljs-comment">// set up trapframe values that uservec will need when</span><br>  <span class="hljs-comment">// the process next traps into the kernel.</span><br>  p-&gt;trapframe-&gt;kernel_satp = r_satp();         <span class="hljs-comment">// kernel page table</span><br>  p-&gt;trapframe-&gt;kernel_sp = p-&gt;kstack + PGSIZE; <span class="hljs-comment">// process&#x27;s kernel stack</span><br>  p-&gt;trapframe-&gt;kernel_trap = (uint64)usertrap;<br>  p-&gt;trapframe-&gt;kernel_hartid = r_tp();         <span class="hljs-comment">// hartid for cpuid()</span><br><br>  <span class="hljs-comment">// set up the registers that trampoline.S&#x27;s sret will use</span><br>  <span class="hljs-comment">// to get to user space.</span><br>  <br>  <span class="hljs-comment">// set S Previous Privilege mode to User.</span><br>  <span class="hljs-comment">// è®¾ç½®SPPä¸º0 å½“ä½¿ç”¨sretè¿”å›çš„æ—¶å€™ ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç”¨æˆ·æ€</span><br>  <span class="hljs-comment">// è®¾ç½®SPIEä¸º1 å½“ä½¿ç”¨sretè¿”å›çš„æ—¶å€™ ä¼šè‡ªåŠ¨ä½¿èƒ½è®¾å¤‡ä¸­æ–­</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> x = r_sstatus();<br>  x &amp;= ~SSTATUS_SPP; <span class="hljs-comment">// clear SPP to 0 for user mode</span><br>  x |= SSTATUS_SPIE; <span class="hljs-comment">// enable interrupts in user mode</span><br>  w_sstatus(x);<br><br>  <span class="hljs-comment">// set S Exception Program Counter to the saved user pc.</span><br>  w_sepc(p-&gt;trapframe-&gt;epc);<br><br>  <span class="hljs-comment">// tell trampoline.S the user page table to switch to.</span><br>  uint64 satp = MAKE_SATP(p-&gt;pagetable);<br><br>  <span class="hljs-comment">// jump to userret in trampoline.S at the top of memory, which </span><br>  <span class="hljs-comment">// switches to the user page table, restores user registers,</span><br>  <span class="hljs-comment">// and switches to user mode with sret.</span><br>  uint64 trampoline_userret = TRAMPOLINE + (userret - trampoline);<br>  ((<span class="hljs-type">void</span> (*)(uint64))trampoline_userret)(satp);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>usertrapret</code> è°ƒç”¨ <code>userret</code> æ—¶ï¼Œå°†è¿›ç¨‹çš„ç”¨æˆ·é¡µè¡¨çš„æŒ‡é’ˆä¼ é€’ç»™ <code>a0</code>ï¼ˆè§ kernel&#x2F;trampoline.S:101ï¼‰ã€‚<code>userret</code> å°† <code>satp</code> åˆ‡æ¢åˆ°è¿›ç¨‹çš„ç”¨æˆ·é¡µè¡¨ã€‚å›æƒ³ä¸€ä¸‹ï¼Œç”¨æˆ·é¡µè¡¨æ˜ å°„äº†trampoline pageå’Œ <code>TRAPFRAME</code>ï¼Œä½†æ²¡æœ‰å…¶ä»–å†…æ ¸å†…å®¹ã€‚trampoline pageåœ¨ç”¨æˆ·å’Œå†…æ ¸é¡µè¡¨ä¸­çš„ç›¸åŒè™šæ‹Ÿåœ°å€æ˜ å°„å…è®¸ <code>userret</code> åœ¨åˆ‡æ¢ <code>satp</code> åç»§ç»­æ‰§è¡Œã€‚ä»æ­¤æ—¶å¼€å§‹ï¼Œ<code>userret</code> èƒ½ä½¿ç”¨çš„å”¯ä¸€æ•°æ®æ˜¯å¯„å­˜å™¨çš„å†…å®¹å’Œ <code>trapframe</code> çš„å†…å®¹ã€‚<code>userret</code> å°† <code>TRAPFRAME</code> åœ°å€åŠ è½½åˆ° <code>a0</code>ï¼Œé€šè¿‡ <code>a0</code> ä» <code>trapframe</code> ä¸­æ¢å¤ä¿å­˜çš„ç”¨æˆ·å¯„å­˜å™¨ï¼Œæ¢å¤ä¿å­˜çš„ <code>a0</code>ï¼Œå¹¶æ‰§è¡Œ <code>sret</code> è¿”å›ç”¨æˆ·ç©ºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs assembly">userret:<br>    # userret(pagetable)<br>    # called by usertrapret() in trap.c to<br>    # switch from kernel to user.<br>    # a0: user page table, for satp.<br><br>    # switch to the user page table.<br>    sfence.vma zero, zero<br>    csrw satp, a0<br>    sfence.vma zero, zero<br><br>    li a0, TRAPFRAME<br><br>    # restore all but a0 from TRAPFRAME<br>    ld ra, 40(a0)<br>    ld sp, 48(a0)<br>    ld gp, 56(a0)<br>    ld tp, 64(a0)<br>    ld t0, 72(a0)<br>    ld t1, 80(a0)<br>    ld t2, 88(a0)<br>    ld s0, 96(a0)<br>    ld s1, 104(a0)<br>    ld a1, 120(a0)<br>    ld a2, 128(a0)<br>    ld a3, 136(a0)<br>    ld a4, 144(a0)<br>    ld a5, 152(a0)<br>    ld a6, 160(a0)<br>    ld a7, 168(a0)<br>    ld s2, 176(a0)<br>    ld s3, 184(a0)<br>    ld s4, 192(a0)<br>    ld s5, 200(a0)<br>    ld s6, 208(a0)<br>    ld s7, 216(a0)<br>    ld s8, 224(a0)<br>    ld s9, 232(a0)<br>    ld s10, 240(a0)<br>    ld s11, 248(a0)<br>    ld t3, 256(a0)<br>    ld t4, 264(a0)<br>    ld t5, 272(a0)<br>    ld t6, 280(a0)<br><br># restore user a0<br>    ld a0, 112(a0)<br><br>    # return to user mode and user pc.<br>    # usertrapret() set up sstatus and sepc.<br>    sret<br></code></pre></td></tr></table></figure><h2 id="4-3-Codeï¼šCalling-system-calls"><a href="#4-3-Codeï¼šCalling-system-calls" class="headerlink" title="4.3 Codeï¼šCalling system calls"></a>4.3 Codeï¼šCalling system calls</h2><p>é¦–å…ˆå°†ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æ”¾è¿›å¯„å­˜å™¨a0-a6ä¸­ï¼Œç„¶åå°†ç³»ç»Ÿè°ƒç”¨å·æ”¾è¿›å¯„å­˜å™¨a7ä¸­ã€‚ <code>usertrap</code> ä¼šåˆ¤æ–­å½“å‰å‘ç”Ÿçš„trapæ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åè°ƒç”¨ <code>syscall</code> å‡½æ•°å»æ‰§è¡Œã€‚ <code>syscall</code> å‡½æ•°ä»trapframeä¸­å–å¾—å‚æ•°å’Œç³»ç»Ÿè°ƒç”¨å·ï¼Œç„¶åç”¨ç³»ç»Ÿè°ƒç”¨å·ä½œä¸ºç´¢å¼•å–å¾—ç³»ç»Ÿè°ƒç”¨å¤„ç†ç¨‹åºçš„åœ°å€æ‰§è¡Œã€‚å½“ç³»ç»Ÿè°ƒç”¨è¿”å›çš„æ—¶å€™ï¼Œä¼šæŠŠè¿”å›å€¼å­˜æ”¾åœ¨ <code>p-&gt;trapframe-&gt;a0</code> ä¸­ã€‚</p><p>initcode.Sç³»ç»Ÿè°ƒç”¨ <code>exec(init, argv)</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># exec(init, argv)<br>.globl start<br>start:<br>    la a0, init<br>    la a1, argv<br>    li a7, SYS_exec<br>    ecallÂ·<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span><br><span class="hljs-title function_">syscall</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> num;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  <span class="hljs-comment">// a7ä¸­å­˜æ”¾äº†ç³»ç»Ÿè°ƒç”¨å·</span><br>  <span class="hljs-comment">// ç³»ç»Ÿè°ƒç”¨ä¹‹å‰å­˜æ”¾åˆ°a7ä¸­</span><br>  num = p-&gt;trapframe-&gt;a7;<br>  <span class="hljs-keyword">if</span>(num &gt; <span class="hljs-number">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;<br>    <span class="hljs-comment">// Use num to lookup the system call function for num, call it,</span><br>    <span class="hljs-comment">// and store its return value in p-&gt;trapframe-&gt;a0</span><br>    p-&gt;trapframe-&gt;a0 = syscalls[num]();<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d %s: unknown sys call %d\n&quot;</span>,<br>            p-&gt;pid, p-&gt;name, num);<br>    p-&gt;trapframe-&gt;a0 = <span class="hljs-number">-1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-4-Codeï¼šSystem-call-arguments"><a href="#4-4-Codeï¼šSystem-call-arguments" class="headerlink" title="4.4 Codeï¼šSystem call arguments"></a>4.4 Codeï¼šSystem call arguments</h2><p>ç³»ç»Ÿè°ƒç”¨éœ€è¦è·å–ç”¨æˆ·è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°ã€‚è¿™ä¸ªå‚æ•°æœ€å¼€å§‹è¢«æ”¾åˆ°ç”¨æˆ·å¯„å­˜å™¨ä¸­ï¼Œä¹‹ååœ¨ <code>usertrap</code> ä¸­è¢«ä¿å­˜åˆ°trapframeä¸­ã€‚å†…æ ¸é€šè¿‡ <code>argint</code> ã€<code>argaddr</code> ã€<code>argfd</code> ä»trapframeä¸­è·å–ç¬¬nä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼ˆæ•´æ•°ã€æŒ‡é’ˆã€æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚å®ƒä»¬éƒ½é€šè¿‡ <code>argraw</code> æ¥è·å–trapframeä¸­çš„å¯„å­˜å™¨çš„å€¼ã€‚syscallåœ¨usertrapä¸­æ‰§è¡Œï¼Œæ­¤æ—¶å·²ç»åˆ‡æ¢åˆ°Sæ€ï¼Œå¯„å­˜å™¨çš„å€¼éƒ½è¢«ä¿å­˜åˆ°trapframeä¸­ï¼Œä½†æ˜¯ç”±äºå·²ç»åˆ‡æ¢åˆ°å†…æ ¸é¡µè¡¨ï¼Œå› æ­¤æ— æ³•é€šè¿‡è™šæ‹Ÿåœ°å€è®¿é—®trapframeï¼Œå¯ä»¥é€šè¿‡p-&gt;trapframeç›´æ¥è·å–trapframeçš„ç‰©ç†åœ°å€è¿›è¡Œè®¿é—®ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> uint64<br><span class="hljs-title function_">argraw</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  <span class="hljs-keyword">switch</span> (n) &#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>    <span class="hljs-keyword">return</span> p-&gt;trapframe-&gt;a0;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">return</span> p-&gt;trapframe-&gt;a1;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>    <span class="hljs-keyword">return</span> p-&gt;trapframe-&gt;a2;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>    <span class="hljs-keyword">return</span> p-&gt;trapframe-&gt;a3;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>    <span class="hljs-keyword">return</span> p-&gt;trapframe-&gt;a4;<br>  <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>    <span class="hljs-keyword">return</span> p-&gt;trapframe-&gt;a5;<br>  &#125;<br>  panic(<span class="hljs-string">&quot;argraw&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><br><span class="hljs-comment">// Fetch the nth 32-bit system call argument.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">argint</span><span class="hljs-params">(<span class="hljs-type">int</span> n, <span class="hljs-type">int</span> *ip)</span><br>&#123;<br>  *ip = argraw(n);<br>&#125;<br><br><span class="hljs-comment">// Retrieve an argument as a pointer.</span><br><span class="hljs-comment">// Doesn&#x27;t check for legality, since</span><br><span class="hljs-comment">// copyin/copyout will do that.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">argaddr</span><span class="hljs-params">(<span class="hljs-type">int</span> n, uint64 *ip)</span><br>&#123;<br>  *ip = argraw(n);<br>&#125;<br><br><span class="hljs-comment">// Fetch the nth word-sized system call argument as a null-terminated string.</span><br><span class="hljs-comment">// Copies into buf, at most max.</span><br><span class="hljs-comment">// Returns string length if OK (including nul), -1 if error.</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">argstr</span><span class="hljs-params">(<span class="hljs-type">int</span> n, <span class="hljs-type">char</span> *buf, <span class="hljs-type">int</span> max)</span><br>&#123;<br>  uint64 addr;<br>  argaddr(n, &amp;addr);<br>  <span class="hljs-keyword">return</span> fetchstr(addr, buf, max);<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰äº›ç³»ç»Ÿè°ƒç”¨ä¼šä¼ é€’æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè¿™ä¼šå¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>ç”¨æˆ·ç¨‹åºå¯èƒ½æ˜¯æ¶æ„çš„æˆ–è€…æœ‰bugï¼Œå¯¼è‡´ä¼ é€’è¿›æ¥çš„åœ°å€æ˜¯æ— æ•ˆçš„ã€‚</li><li>ç”±äºå†…æ ¸é¡µè¡¨å’Œç”¨æˆ·é¡µè¡¨æ˜ å°„ä¸åŒï¼Œç”¨æˆ·ä¼ é€’çš„åœ°å€æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚</li></ol><p>å†…æ ¸æä¾›äº†å‡½æ•°æ¥ä»ç”¨æˆ·åœ°å€ä¸­è¯»å†™æ•°æ®ã€‚</p><p> <code>exec</code> ä½¿ç”¨ <code>fetchstr</code> æ¥ä»ç”¨æˆ·ç©ºé—´ä¸­è·å–ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ã€‚ <code>fetchstr</code> è°ƒç”¨ <code>copyinstr</code> æ¥å®Œæˆæ•°æ®æ‹·è´çš„ä»»åŠ¡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Fetch the nul-terminated string at addr from the current process.</span><br><span class="hljs-comment">// Returns length of string, not including nul, or -1 for error.</span><br><span class="hljs-type">int</span><br><span class="hljs-title function_">fetchstr</span><span class="hljs-params">(uint64 addr, <span class="hljs-type">char</span> *buf, <span class="hljs-type">int</span> max)</span><br>&#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc</span> *<span class="hljs-title">p</span> =</span> myproc();<br>  <span class="hljs-keyword">if</span>(copyinstr(p-&gt;pagetable, buf, addr, max) &lt; <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">strlen</span>(buf);<br>&#125;<br></code></pre></td></tr></table></figure><p> <code>copyinstr</code> è‡³å¤šä»ç”¨æˆ·é¡µè¡¨pagetableä¸­çš„è™šæ‹Ÿåœ°å€srcvaæŒ‡å®šçš„åœ°æ–¹æ‹·è´maxå­—èŠ‚åˆ°dstæŒ‡å®šçš„åœ°æ–¹ã€‚</p><p>å› ä¸ºpagetableä¸æ˜¯å½“å‰çš„é¡µè¡¨ï¼Œæ‰€ä»¥ <code>copyinstr</code> ä½¿ç”¨ <code>walkaddr</code> åœ¨pagetableä¸­æŸ¥æ‰¾è™šæ‹Ÿåœ°å€srcvaï¼Œå¹¶è·å¾—ç›¸åº”çš„ç‰©ç†åœ°å€pa0ã€‚ä¹‹åå¯ä»¥ç›´æ¥è¿›è¡Œæ‹·è´æ“ä½œã€‚ç±»ä¼¼çš„ï¼Œ<code>copyout</code> å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚</p><h2 id="4-5-Traps-from-kernel-space"><a href="#4-5-Traps-from-kernel-space" class="headerlink" title="4.5 Traps from kernel space"></a>4.5 Traps from kernel space</h2><p>xv6ä»¥ä¸€ç§ä¸åŒçš„æ–¹å¼å¤„ç†æ¥è‡ªå†…æ ¸çš„trapã€‚å½“è¿›å…¥å†…æ ¸åï¼Œusertrapä¼šå°†stvecçš„å€¼æŒ‡å‘kernelvecã€‚å› ä¸ºæ‰§è¡Œkernelvecçš„æ—¶å€™ï¼Œä¸€å®šå·²ç»åœ¨Sæ€äº†ï¼Œsatpå·²ç»æ˜¯å†…æ ¸é¡µè¡¨ï¼Œå¹¶ä¸”spä¹ŸæŒ‡å‘å†…æ ¸æ ˆã€‚kernelvecå°†32ä¸ªå¯„å­˜å™¨çš„å€¼ä¿å­˜åˆ°å†…æ ¸æ ˆä¸­ã€‚ä¹‹åä¼šè·³è½¬åˆ°kerneltrapæ‰§è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs assembly">kernelvec:<br>    # make room to save registers.<br>    addi sp, sp, -256<br><br>    # save caller-saved registers.<br>    sd ra, 0(sp)<br>    sd sp, 8(sp)<br>    sd gp, 16(sp)<br>    sd tp, 24(sp)<br>    sd t0, 32(sp)<br>    sd t1, 40(sp)<br>    sd t2, 48(sp)<br>    sd a0, 72(sp)<br>    sd a1, 80(sp)<br>    sd a2, 88(sp)<br>    sd a3, 96(sp)<br>    sd a4, 104(sp)<br>    sd a5, 112(sp)<br>    sd a6, 120(sp)<br>    sd a7, 128(sp)<br>    sd t3, 216(sp)<br>    sd t4, 224(sp)<br>    sd t5, 232(sp)<br>    sd t6, 240(sp)<br><br>    # call the C trap handler in trap.c<br>    call kerneltrap<br></code></pre></td></tr></table></figure><p>kerneltrapåªå¤„ç†ä¸¤ç§ç±»å‹çš„trapï¼šè®¾å¤‡ä¸­æ–­å’Œå¼‚å¸¸ã€‚å®ƒè°ƒç”¨devintræ¥å¤„ç†è®¾å¤‡ä¸­æ–­ã€‚å¦‚æœä¸æ˜¯è®¾å¤‡ä¸­æ–­ï¼Œé‚£å°±ä¸€å®šæ˜¯å¼‚å¸¸ï¼Œå†…æ ¸ä¸­çš„å¼‚å¸¸é€šå¸¸æ„å‘³ç€fatal errorï¼Œå†…æ ¸è°ƒç”¨panicä¹‹ååœæ­¢æ‰§è¡Œã€‚</p><p>å¦‚æœkerneltrapå¤„ç†çš„æ˜¯æ—¶é’Ÿä¸­æ–­ï¼Œå¹¶ä¸”å½“å‰è¿›ç¨‹çš„å†…æ ¸çº¿ç¨‹æ­£åœ¨è¿è¡Œï¼Œkerneltrapä¼šè°ƒç”¨yieldå°†CPUä½¿ç”¨æƒè®©å‡ºæ¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// interrupts and exceptions from kernel code go here via kernelvec,</span><br><span class="hljs-comment">// on whatever the current kernel stack is.</span><br><span class="hljs-type">void</span> <br><span class="hljs-title function_">kerneltrap</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> which_dev = <span class="hljs-number">0</span>;<br>  uint64 sepc = r_sepc();<br>  uint64 sstatus = r_sstatus();<br>  uint64 scause = r_scause();<br>  <br>  <span class="hljs-keyword">if</span>((sstatus &amp; SSTATUS_SPP) == <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;kerneltrap: not from supervisor mode&quot;</span>);<br>  <span class="hljs-keyword">if</span>(intr_get() != <span class="hljs-number">0</span>)<br>    panic(<span class="hljs-string">&quot;kerneltrap: interrupts enabled&quot;</span>);<br><br>  <span class="hljs-keyword">if</span>((which_dev = devintr()) == <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-comment">// interrupt or trap from an unknown source</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;scause=0x%lx sepc=0x%lx stval=0x%lx\n&quot;</span>, scause, r_sepc(), r_stval());<br>    panic(<span class="hljs-string">&quot;kerneltrap&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// give up the CPU if this is a timer interrupt.</span><br>  <span class="hljs-keyword">if</span>(which_dev == <span class="hljs-number">2</span> &amp;&amp; myproc() != <span class="hljs-number">0</span>)<br>    yield();<br><br>  <span class="hljs-comment">// the yield() may have caused some traps to occur,</span><br>  <span class="hljs-comment">// so restore trap registers for use by kernelvec.S&#x27;s sepc instruction.</span><br>  w_sepc(sepc);<br>  w_sstatus(sstatus);<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“kerneltrapå®Œæˆåï¼Œå®ƒéœ€è¦è¿”å›ä¹‹å‰è¢«ä¸­æ–­çš„ä»£ç ç»§ç»­æ‰§è¡Œã€‚å› ä¸ºyieldå¯èƒ½ä¼šç ´åsepcå’Œsstatusä¸­çš„å€¼ï¼Œæ‰€ä»¥kerneltrapéœ€è¦åœ¨å¼€å§‹çš„æ—¶å€™ä¿å­˜å®ƒä»¬ã€‚å› æ­¤ï¼Œkerneltrapå®Œæˆåéœ€è¦å…ˆæ¢å¤è¿™äº›æ§åˆ¶å¯„å­˜å™¨çš„å€¼ï¼Œç„¶åè¿”å›åˆ°kernelvecã€‚kernelvecä»æ ˆä¸­æ¢å¤å¯„å­˜å™¨çš„å€¼ï¼Œç„¶åæ‰§è¡ŒsretæŒ‡ä»¤ï¼Œå°†sepcçš„å€¼æ‹·è´åˆ°pcä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># restore registers.<br>    ld ra, 0(sp)<br>    ld sp, 8(sp)<br>    ld gp, 16(sp)<br>    # not tp (contains hartid), in case we moved CPUs<br>    ld t0, 32(sp)<br>    ld t1, 40(sp)<br>    ld t2, 48(sp)<br>    ld a0, 72(sp)<br>    ld a1, 80(sp)<br>    ld a2, 88(sp)<br>    ld a3, 96(sp)<br>    ld a4, 104(sp)<br>    ld a5, 112(sp)<br>    ld a6, 120(sp)<br>    ld a7, 128(sp)<br>    ld t3, 216(sp)<br>    ld t4, 224(sp)<br>    ld t5, 232(sp)<br>    ld t6, 240(sp)<br><br>    addi sp, sp, 256<br><br>    # return to whatever we were doing in the kernel.<br>    sret<br></code></pre></td></tr></table></figure><p>å½“ä»ç”¨æˆ·æ€è¿›å…¥å†…æ ¸çš„æ—¶å€™ï¼Œxv6ä¼šè®¾ç½®CPUçš„stvecæŒ‡å‘kernelvecã€‚åœ¨å†…æ ¸å¼€å§‹æ‰§è¡Œå’ŒstvecæŒ‡å‘kernelvecä¹‹é—´ä¼šæœ‰ä¸€æ®µæ—¶é—´ï¼ˆæ‰§è¡Œuservecçš„ä»£ç çš„æ—¶å€™å·²ç»å¤„äºSæ€ï¼Œä½†æ˜¯ç›´åˆ°usertrapä¸­æ‰ä¿®æ”¹stvecçš„å€¼æŒ‡å‘kernelvecï¼‰ï¼ŒRISC-Våœ¨å¤„ç†ä¸€ä¸ªtrapçš„æ—¶å€™å…³é—­è®¾å¤‡ä¸­æ–­ï¼Œusertrapç›´åˆ°è®¾ç½®å¥½stvecä¹‹åæ‰é‡æ–°ä½¿èƒ½è®¾å¤‡ä¸­æ–­ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿è¿™æ®µæ—¶é—´ä¸ä¼šæœ‰è®¾å¤‡ä¸­æ–­ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´æ¥è‡ªSæ€çš„trapé”™è¯¯çš„è¢«uservecå¤„ç†ã€‚</p><h2 id="4-6-Page-fault-exceptions"><a href="#4-6-Page-fault-exceptions" class="headerlink" title="4.6 Page-fault exceptions"></a>4.6 Page-fault exceptions</h2><p>xv6å¯¹å¼‚å¸¸çš„å¤„ç†æ¯”è¾ƒç®€å•ï¼Œå¦‚æœå¼‚å¸¸æ¥è‡ªç”¨æˆ·æ€ï¼Œåˆ™å†…æ ¸æ€æ­»å‘ç”Ÿå¼‚å¸¸çš„è¿›ç¨‹ï¼Œå¦‚æœå¼‚å¸¸æ¥è‡ªSæ€ï¼Œåˆ™å†…æ ¸panicsã€‚çœŸå®çš„æ“ä½œç³»ç»Ÿå¾€å¾€æœ‰æ›´åŠ å¤æ‚çš„å¤„ç†æ–¹å¼ã€‚</p><p><strong>å†™æ—¶å¤åˆ¶</strong></p><p>è®¸å¤šå†…æ ¸é€šè¿‡é¡µé”™è¯¯æ¥å®ç°å†™å®å¤åˆ¶ï¼ˆcopy on writeï¼Œ COWï¼‰forkã€‚è€ƒè™‘xv6å®ç°çš„forkï¼Œé€šè¿‡uvmcopyåˆ†é…å†…å­˜å¹¶å°†çˆ¶è¿›ç¨‹çš„å†…å­˜æ‹·è´ä¸€ä»½ã€‚å¦‚æœå¯ä»¥å…±äº«çˆ¶è¿›ç¨‹çš„å†…å­˜å°†æé«˜æ•ˆç‡ï¼Œç„¶åï¼Œæ™®é€šçš„å®ç°å°†å¯¼è‡´çˆ¶å­è¿›ç¨‹äº’ç›¸å¹²æ‰°ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œçˆ¶å­è¿›ç¨‹å¯ä»¥é€šè¿‡æ°å½“çš„è®¾ç½®é¡µè¡¨æƒé™å’Œé¡µé”™è¯¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å½“ï¼š</p><ul><li>æŸä¸ªè™šæ‹Ÿåœ°å€åœ¨é¡µè¡¨ä¸­æ²¡æœ‰æ˜ å°„</li><li>é¡µè¡¨é¡¹çš„vä½ç½®0</li><li>é¡µè¡¨é¡¹çš„æŸäº›æƒé™ä½ç¦æ­¢æ“ä½œ</li></ul><p>çš„æ—¶å€™ï¼ŒCPUä¼šå‘èµ·ä¸€ä¸ªé¡µé”™è¯¯å¼‚å¸¸ã€‚</p><p>xv6ä¸­åŒºåˆ†ä¸‰ç§é¡µé”™è¯¯ï¼š</p><ol><li>è¯»é¡µé”™è¯¯</li><li>å†™é¡µé”™è¯¯</li><li>æŒ‡ä»¤é¡µé”™è¯¯</li></ol><p>é€šè¿‡scauseå¯„å­˜å™¨æŒ‡æ˜é¡µé”™è¯¯çš„ç§ç±»ï¼Œstvalå¯„å­˜å™¨ä¿å­˜å‘ç”Ÿé”™è¯¯çš„è™šæ‹Ÿåœ°å€ã€‚</p><p>COWforkçš„æƒ³æ³•æ˜¯åˆå§‹çš„æ—¶å€™çˆ¶å­è¿›ç¨‹å…±äº«ç›¸åŒçš„ç‰©ç†é¡µï¼Œä½†æ˜¯çˆ¶å­è¿›ç¨‹é¡µè¡¨ä¸­ç›¸åº”çš„é¡µè¡¨é¡¹æ ‡è®°ä¸ºåªè¯»ï¼ˆPTE_Wç½®0ï¼‰ã€‚çˆ¶å­è¿›ç¨‹å¯ä»¥é¡ºåˆ©çš„è¯»å…±äº«çš„é¡µï¼Œä½†æ˜¯å½“ä»»ä½•ä¸€ä¸ªè¿›ç¨‹è¯•å›¾å†™å…±äº«çš„é¡µçš„æ—¶å€™ï¼Œä¼šå¼•å‘ä¸€ä¸ªé¡µé”™è¯¯ã€‚å†…æ ¸æ­¤æ—¶åœ¨å¤åˆ¶ä¸€ä»½å…±äº«çš„é¡µé¢ï¼Œç„¶åä¿®æ”¹ç›¸åº”è¿›ç¨‹çš„é¡µè¡¨ä¸­çš„é¡µè¡¨é¡¹ï¼Œç„¶åè¿”å›åˆ°å‘ç”Ÿå¼‚å¸¸çš„æŒ‡ä»¤é‡æ–°æ‰§è¡Œã€‚</p><p>COWéœ€è¦ä¸€ä¸ªè®°å½•æ¥å¸®åŠ©å†³å®šä»€ä¹ˆæ—¶å€™å¯ä»¥é‡Šæ”¾æ‰ä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œå› ä¸ºæ¯ä¸ªç‰©ç†é¡µé¢å¯èƒ½ä¼šè¢«å¤šä¸ªè¿›ç¨‹å…±äº«ã€‚æœ‰äº†è¿™ä¸ªè®°å½•ï¼Œåœ¨å‘ç”Ÿå†™é¡µé”™è¯¯çš„æ—¶å€™ï¼Œå†…æ ¸å¯ä»¥æ ¹æ®è®°å½•æ¥æŸ¥çœ‹å½“å‰å…±äº«è¿™ä¸ªç‰©ç†é¡µé¢çš„è¿›ç¨‹æ•°ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆå°±æ— éœ€è¿›è¡Œå¤åˆ¶ï¼ˆå‡è®¾çˆ¶å­è¿›ç¨‹å…±äº«ä¸€ä¸ªé¡µé¢ï¼Œç„¶åå­è¿›ç¨‹é€€å‡ºäº†ï¼Œçˆ¶è¿›ç¨‹æ­¤æ—¶å†å†™ä¼šè§¦å‘é¡µé”™è¯¯ï¼Œä½†æ˜¯æ— éœ€å¤åˆ¶ï¼‰ã€‚</p><p><strong>lazy allocation</strong></p><p>é€šè¿‡é¡µé”™è¯¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°lazy allocationã€‚å½“ä¸€ä¸ªè¿›ç¨‹é€šè¿‡sbrkç”³è¯·æ›´å¤šå†…å­˜çš„æ—¶å€™ï¼Œå†…æ ¸ä»…ä»…è®°å½•å¤§å°çš„æ›´æ”¹ï¼Œä½†æ˜¯ä¸å®é™…ç”³è¯·ç‰©ç†é¡µå’Œåˆ›å»ºé¡µè¡¨é¡¹ã€‚ä½†åœ¨è¿™äº›æ–°çš„è™šæ‹Ÿåœ°å€ä¸Šå‘ç”Ÿé¡µé”™è¯¯çš„æ—¶å€™ï¼Œå†…æ ¸å†å®é™…å»ç”³è¯·ç‰©ç†å†…å­˜ã€‚</p><ul><li><p>lazy allocationçš„ä¼˜åŠ¿ï¼š</p><ol><li>å› ä¸ºåº”ç”¨æ€»æ˜¯ä¼šç”³è¯·æ›´å¤šçš„å†…å­˜ï¼ˆå®é™…ä¸éœ€è¦è¿™ä¹ˆå¤šï¼‰ï¼Œæ‰€ä»¥lazy allocationå¾ˆæœ‰å¿…è¦ã€‚</li><li>å½“åº”ç”¨ç”³è¯·å¾ˆå¤§çš„å†…å­˜çš„æ—¶å€™ï¼Œä¸€æ¬¡sbrkçš„å¼€é”€æ˜¯å¾ˆå¤§çš„ï¼Œå¯ä»¥é€šè¿‡lazy allocationå¹³å‡è¿™äº›å¼€é”€ã€‚</li></ol></li><li><p>lazy allocationçš„ç¼ºç‚¹ï¼š</p><p>ä¼šå¼•å‘é¡µé”™è¯¯ï¼Œå¯¼è‡´ç”¨æˆ·æ€åˆ°Sæ€çš„åˆ‡æ¢ã€‚å¯ä»¥é€šè¿‡æ¯æ¬¡ç”³è¯·ä¸€è¿ä¸²çš„é¡µæ¥å‡å°‘é¡µé”™è¯¯çš„æ¬¡æ•°ï¼›ä¹Ÿå¯ä»¥é€šè¿‡ç‰¹åŒ–é¡µé”™è¯¯çš„ä»£ç æ¥é™ä½å¼€é”€ã€‚</p></li></ul><p><strong>è¯·æ±‚åˆ†é¡µ</strong></p><p>åœ¨xv6ä¸­ï¼Œè°ƒç”¨execçš„æ—¶å€™ä¼šæŠŠç¨‹åºçš„å®Œæ•´é•œåƒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœé•œåƒå¾ˆå¤§ï¼Œè¿™ä¸ªå¼€é”€ä¼šéå¸¸å¤§ã€‚ç°ä»£æ“ä½œç³»ç»Ÿé€šè¿‡è¯·æ±‚åˆ†é¡µæœºåˆ¶æ¥åˆ†æ‘Šè¿™ä¸ªå¼€é”€ã€‚é€šå¸¸åªæ˜¯åœ¨é¡µè¡¨ä¸­å»ºç«‹ç›¸åº”çš„é¡µè¡¨é¡¹ï¼Œä½†å¹¶ä¸å®é™…è¯»å–ç¡¬ç›˜ï¼Œå°†é¡µè¡¨é¡¹çš„PTE_Vå­—æ®µç½®0ï¼Œå½“ç¨‹åºå®é™…è®¿é—®è¯¥è™šæ‹Ÿåœ°å€æŒ‡å‘çš„å†…å®¹çš„æ—¶å€™ï¼Œåœ¨å°†ç‰©ç†é¡µè¯»å…¥å†…å­˜ã€‚</p><p>è¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„ç¨‹åºå¯èƒ½éœ€è¦çš„å†…å­˜è¶…å‡ºè®¡ç®—æœºçš„ RAMã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å®ç°ç£ç›˜åˆ†é¡µã€‚å…¶åŸºæœ¬æ€è·¯æ˜¯å°†ä»…ä¸€éƒ¨åˆ†ç”¨æˆ·é¡µé¢å­˜å‚¨åœ¨ RAM ä¸­ï¼Œè€Œå°†å…¶ä½™é¡µé¢å­˜å‚¨åœ¨ç£ç›˜çš„åˆ†é¡µåŒºåŸŸä¸­ã€‚å†…æ ¸ä¼šå°†å¯¹åº”äºå­˜å‚¨åœ¨åˆ†é¡µåŒºåŸŸï¼ˆå³ä¸åœ¨ RAM ä¸­ï¼‰çš„å†…å­˜çš„é¡µè¡¨é¡¹ï¼ˆPTEï¼‰æ ‡è®°ä¸ºæ— æ•ˆã€‚å¦‚æœåº”ç”¨ç¨‹åºå°è¯•ä½¿ç”¨å·²ç»åˆ†é¡µåˆ°ç£ç›˜çš„é¡µé¢ï¼Œå°±ä¼šå‘ç”Ÿé¡µé¢é”™è¯¯ï¼Œæ­¤æ—¶éœ€è¦å°†è¯¥é¡µé¢è°ƒå…¥ï¼šå†…æ ¸çš„trapå¤„ç†ç¨‹åºå°†åˆ†é…ä¸€é¡µç‰©ç† RAMï¼Œå°†é¡µé¢ä»ç£ç›˜è¯»å…¥ RAMï¼Œå¹¶ä¿®æ”¹ç›¸å…³çš„ PTE ä»¥æŒ‡å‘è¯¥ RAMã€‚</p><p>å¦‚æœéœ€è¦è°ƒå…¥çš„é¡µé¢æ—¶æ²¡æœ‰ç©ºé—²çš„ç‰©ç† RAMï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…æ ¸å¿…é¡»é¦–å…ˆé€šè¿‡å°†ä¸€é¡µç‰©ç†å†…å­˜åˆ†é¡µå‡ºå»æˆ–é©±é€åˆ°ç£ç›˜çš„åˆ†é¡µåŒºåŸŸæ¥é‡Šæ”¾ä¸€é¡µç‰©ç†é¡µé¢ï¼Œå¹¶å°†å¼•ç”¨è¯¥ç‰©ç†é¡µé¢çš„ PTE æ ‡è®°ä¸ºæ— æ•ˆã€‚é©±é€æ“ä½œå¼€é”€è¾ƒå¤§ï¼Œå› æ­¤åˆ†é¡µæ€§èƒ½æœ€ä½³çš„æƒ…å†µæ˜¯å°½é‡å°‘å‘ç”Ÿé¡µé¢é”™è¯¯ï¼šå¦‚æœåº”ç”¨ç¨‹åºåªä½¿ç”¨å…¶å†…å­˜é¡µé¢çš„ä¸€ä¸ªå­é›†ï¼Œè€Œè¿™äº›å­é›†çš„å¹¶é›†å¯ä»¥åˆ†é…åœ¨ RAM ä¸­ï¼Œè¿™ç§å±æ€§é€šå¸¸è¢«ç§°ä¸ºè‰¯å¥½çš„å±€éƒ¨æ€§ã€‚</p><p>åœ¨è®¸å¤šè™šæ‹Ÿå†…å­˜æŠ€æœ¯ä¸­ï¼Œå†…æ ¸é€šå¸¸ä»¥å¯¹åº”ç”¨ç¨‹åºé€æ˜çš„æ–¹å¼å®ç°ç£ç›˜åˆ†é¡µã€‚å°½ç®¡ç¡¬ä»¶æä¾›äº†å¤§é‡çš„ RAMï¼Œä½†è®¡ç®—æœºé€šå¸¸ä¼šæœ‰å¾ˆå°‘æˆ–æ²¡æœ‰ç©ºé—²çš„ç‰©ç†å†…å­˜ã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸åœ¨ä¸€å°æœºå™¨ä¸Šå¤šè·¯å¤ç”¨å¤šä¸ªå®¢æˆ·ï¼Œä»¥é«˜æ•ˆåˆ©ç”¨ç¡¬ä»¶æˆæœ¬ï¼›å¦ä¸€ä¸ªä¾‹å­æ˜¯ç”¨æˆ·åœ¨æ™ºèƒ½æ‰‹æœºä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œè€Œç‰©ç†å†…å­˜åˆéå¸¸æœ‰é™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†é…ä¸€ä¸ªé¡µé¢å¯èƒ½éœ€è¦é¦–å…ˆé©±é€ä¸€ä¸ªç°æœ‰é¡µé¢ã€‚å› æ­¤ï¼Œå½“ç©ºé—²ç‰©ç†å†…å­˜ç¨€ç¼ºæ—¶ï¼Œåˆ†é…æˆæœ¬è¾ƒé«˜ã€‚</p><p>æ‡’æƒ°åˆ†é…å’ŒæŒ‰éœ€åˆ†é¡µåœ¨ç©ºé—²å†…å­˜ç¨€ç¼ºä¸”ç¨‹åºä»…ç§¯æä½¿ç”¨å…¶åˆ†é…å†…å­˜çš„ä¸€éƒ¨åˆ†æ—¶å°¤å…¶æœ‰åˆ©ã€‚è¿™äº›æŠ€æœ¯è¿˜å¯ä»¥é¿å…åœ¨é¡µé¢è¢«åˆ†é…æˆ–åŠ è½½ä½†ä»æœªä½¿ç”¨æˆ–åœ¨ä½¿ç”¨ä¹‹å‰è¢«é©±é€æ—¶æµªè´¹çš„å·¥ä½œã€‚</p><p>ç»“åˆåˆ†é¡µå’Œé¡µé¢é”™è¯¯å¼‚å¸¸çš„å…¶ä»–ç‰¹æ€§åŒ…æ‹¬è‡ªåŠ¨æ‰©å±•å †æ ˆå’Œå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆmemory-mapped filesï¼‰ï¼Œå³ç¨‹åºé€šè¿‡ <code>mmap</code> ç³»ç»Ÿè°ƒç”¨æ˜ å°„åˆ°å…¶åœ°å€ç©ºé—´çš„æ–‡ä»¶ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥é€šè¿‡åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤è¯»å–å’Œå†™å…¥è¿™äº›æ–‡ä»¶ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Xv6 Chapter 3</title>
    <link href="/2024/09/25/MIT-6-1810-Xv6-Chapter-3/"/>
    <url>/2024/09/25/MIT-6-1810-Xv6-Chapter-3/</url>
    
    <content type="html"><![CDATA[<h1 id="Page-tables"><a href="#Page-tables" class="headerlink" title="Page tables"></a>Page tables</h1><span id="more"></span><h2 id="3-1-Paging-hardware"><a href="#3-1-Paging-hardware" class="headerlink" title="3.1 Paging hardware"></a>3.1 Paging hardware</h2><p>RISC-Vçš„æŒ‡ä»¤æ“æ§çš„æ˜¯è™šæ‹Ÿåœ°å€ï¼Œè€Œç‰©ç†å†…å­˜æ˜¯æŒ‰ç…§ç‰©ç†åœ°å€ç´¢å¼•çš„ã€‚é¡µè¡¨ç¡¬ä»¶è´Ÿè´£è¿›è¡Œè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„è½¬æ¢ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-3/image-20240925134044836.png"></p><p>xv6è¿è¡Œåœ¨Sv39 RISC-Vä¸Šï¼Œåªä½¿ç”¨64ä½è™šæ‹Ÿåœ°å€çš„ä½39ä½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¡µè¡¨é€»è¾‘ä¸Šæ˜¯ä¸€ä¸ª2^27æ¬¡æ–¹çš„é¡µè¡¨é¡¹ï¼ˆPage table entrieï¼ŒPTEï¼‰æ•°ç»„ï¼Œæ¯ä¸ªPTEåŒ…å«44ä½ç‰©ç†é¡µç ï¼ˆPhysical page numberï¼Œ PPNï¼‰å’Œä¸€äº›æ ‡è¯†ä½ã€‚é¡µè¡¨ç¡¬ä»¶å°†è™šæ‹Ÿåœ°å€ä½39ä½çš„é«˜27ä½ä½œä¸ºé¡µè¡¨ç´¢å¼•ï¼Œç„¶åå°†å–å¾—çš„44ä½PPNä½œä¸ºé«˜44ä½ï¼Œè™šæ‹Ÿåœ°å€çš„ä½12ä½ä½œä¸ºé¡µå†…åç§»ï¼Œè·å¾—ä¸€ä¸ª56ä½çš„ç‰©ç†åœ°å€ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-3/image-20240925143042508.png"></p><p>xv6ä¸­é‡‡å–çš„æ˜¯ä¸‰çº§é¡µè¡¨ï¼Œç¬¬ä¸€çº§é¡µè¡¨é¡µçš„ç‰©ç†èµ·å§‹åœ°å€ç”±satpå¯„å­˜å™¨ä¿å­˜ï¼Œ27ä½çš„é«˜9ä½ç”¨æ¥ç´¢å¼•ç¬¬ä¸€çº§é¡µè¡¨ï¼Œç¬¬ä¸€çº§é¡µè¡¨é¡µè¡¨é¡¹çš„PPNå­—æ®µæ˜¯ç¬¬äºŒçº§é¡µè¡¨é¡µçš„èµ·å§‹ç‰©ç†åœ°å€ï¼Œ27ä½çš„ä¸­é—´9ä½ç”¨æ¥ç´¢å¼•ç¬¬äºŒçº§é¡µè¡¨ï¼Œå…¶é¡µè¡¨é¡¹çš„PPNå­—æ®µæ˜¯ç¬¬ä¸‰çº§é¡µè¡¨é¡µçš„èµ·å§‹ç‰©ç†åœ°å€ï¼Œ27ä½çš„ä½9ä½ç”¨æ¥ç´¢å¼•ç¬¬ä¸‰çº§é¡µè¡¨ï¼Œå…¶é¡µè¡¨é¡¹çš„PPNå­—æ®µæ˜¯å®é™…è®¿é—®å†…å­˜é¡µçš„ç‰©ç†åœ°å€ã€‚æ¯çº§é¡µè¡¨é¡µå¤§å°ä¸ºä¸€é¡µï¼ŒåŒ…å«512ä¸ªé¡µè¡¨é¡¹ã€‚</p><p>åœ¨ä¸Šè¿°åœ°å€è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªé¡µè¡¨é¡¹ä¸å­˜åœ¨ï¼Œéƒ½ä¼šå¼•å‘ä¸€ä¸ªé¡µé¢é”™è¯¯å¼‚å¸¸ï¼ˆpage fault exceptionï¼‰ï¼Œç”±å†…æ ¸è´Ÿè´£å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚</p><p>é‡‡å–è¿™ç§å¤šçº§é¡µè¡¨çš„å¥½å¤„æ˜¯èŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œç”¨ä¸åˆ°çš„é¡µè¡¨é¡µå°†ä¸ä¼šå æ®ç©ºé—´ï¼›ç¼ºç‚¹æ˜¯åœ¨åœ°å€è½¬åŒ–çš„æ—¶å€™éœ€è¦è¿›è¡Œå¤šæ¬¡è®¿é—®ã€‚ä»¥ä¸‰çº§é¡µè¡¨ä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦è®¿é—®ç¬¬ä¸€çº§é¡µè¡¨è·å–ç¬¬äºŒçº§é¡µè¡¨çš„ç‰©ç†åœ°å€ï¼Œç„¶åéœ€è¦è®¿é—®ç¬¬äºŒçº§é¡µè¡¨è·å–ç¬¬ä¸‰çº§é¡µè¡¨çš„ç‰©ç†åœ°å€ï¼Œå†è®¿é—®ç¬¬ä¸‰çº§é¡µè¡¨è·å–å®é™…ç‰©ç†é¡µçš„ç‰©ç†åœ°å€ï¼Œä¹‹åæ‰èƒ½è®¿é—®æˆ‘ä»¬å®é™…éœ€è¦è¯»å–çš„æ•°æ®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒCPUå¯ä»¥å°†ä¸€äº›é¡µè¡¨é¡¹ç¼“å­˜åˆ°TLBï¼ˆTranslation Look-aside Bufferï¼‰ä¸­ï¼Œè¿™æ ·ï¼Œå¦‚æœåœ¨TLBä¸­å‘½ä¸­ï¼Œåˆ™ç›´æ¥å¯ä»¥æ‹¿åˆ°å®é™…ç‰©ç†é¡µçš„ç‰©ç†åœ°å€ï¼Œä¸éœ€è¦è¿›è¡Œé¢å¤–çš„è®¿å­˜æ“ä½œã€‚</p><p>xv6ä¸­å’Œé¡µè¡¨ç¡¬ä»¶ç›¸å…³çš„ç»“æ„å®šä¹‰åœ¨ï¼ˆkernel&#x2F;riscv.hï¼‰ä¸­ã€‚</p><p>æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„satpå¯„å­˜å™¨ï¼Œè¯¥å¯„å­˜å™¨æŒ‡å®šäº†ç¬¬ä¸€çº§é¡µè¡¨çš„ç‰©ç†åœ°å€ã€‚</p><h2 id="3-2-Kernel-address-space"><a href="#3-2-Kernel-address-space" class="headerlink" title="3.2 Kernel address space"></a>3.2 Kernel address space</h2><p>xv6ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªé¡µè¡¨ï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªå•ç‹¬çš„é¡µè¡¨æŒ‡æ˜å†…æ ¸åœ°å€ç©ºé—´ã€‚å†…æ ¸é…ç½®å†…å­˜ç©ºé—´çš„å¸ƒå±€ä½¿å…¶å¯ä»¥è®¿é—®ç‰©ç†å†…å­˜å’Œå„ç§è®¾å¤‡èµ„æºï¼Œå¦‚å›¾3.3æ‰€ç¤ºã€‚å†…æ ¸å†…å­˜å¸ƒå±€ç”¨åˆ°çš„å¸¸é‡å®šä¹‰åœ¨kernel&#x2F;memlayout.hé‡Œã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-3/image-20240925145411714.png"></p><p>QEMU æ¨¡æ‹Ÿäº†ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼Œç‰©ç†å†…å­˜ï¼ˆRAMï¼‰ä»ç‰©ç†åœ°å€ 0x80000000 å¼€å§‹ï¼Œè‡³å°‘å»¶ç»­åˆ° 0x88000000ï¼Œç§°ä¸º PHYSTOPã€‚QEMU è¿˜åŒ…å«äº† I&#x2F;O è®¾å¤‡ï¼Œæ¯”å¦‚ç£ç›˜æ¥å£ã€‚è¿™äº›è®¾å¤‡æ¥å£é€šè¿‡å†…å­˜æ˜ å°„æ§åˆ¶å¯„å­˜å™¨æš´éœ²ç»™è½¯ä»¶ï¼Œè¿™äº›å¯„å­˜å™¨ä½äºç‰©ç†åœ°å€ç©ºé—´çš„ 0x80000000 ä¹‹ä¸‹ã€‚å†…æ ¸å¯ä»¥é€šè¿‡è¯»å–æˆ–å†™å…¥è¿™äº›ç‰¹æ®Šçš„ç‰©ç†åœ°å€ä¸è®¾å¤‡è¿›è¡Œäº¤äº’ï¼›è¿™æ ·çš„è¯»å†™æ“ä½œæ˜¯ä¸è®¾å¤‡ç¡¬ä»¶ç›´æ¥é€šä¿¡ï¼Œè€Œä¸æ˜¯ä¸ RAM è¿›è¡Œäº¤äº’ã€‚ç¬¬ 4 ç« å°†è§£é‡Š xv6 å¦‚ä½•ä¸è¿™äº›è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚</p><p>å†…æ ¸é€šè¿‡â€œç›´æ¥æ˜ å°„â€è®¿é—® RAM å’Œå†…å­˜æ˜ å°„çš„è®¾å¤‡å¯„å­˜å™¨ï¼Œå³å°†èµ„æºæ˜ å°„åˆ°ä¸ç‰©ç†åœ°å€ç›¸åŒçš„è™šæ‹Ÿåœ°å€ã€‚ä¾‹å¦‚ï¼Œå†…æ ¸æœ¬èº«ä½äºè™šæ‹Ÿåœ°å€ç©ºé—´å’Œç‰©ç†å†…å­˜ä¸­çš„  <code>KERNBASE=0x80000000</code> ã€‚ç›´æ¥æ˜ å°„ç®€åŒ–äº†å†…æ ¸è¯»å–æˆ–å†™å…¥ç‰©ç†å†…å­˜çš„ä»£ç ã€‚</p><ul><li><p><strong>ç›´æ¥æ˜ å°„</strong>ï¼šåœ¨ç›´æ¥æ˜ å°„ä¸­ï¼Œè™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ç›¸ç­‰ï¼Œè¿™æ„å‘³ç€å†…æ ¸å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åœ°å€æ¥è®¿é—®å†…å­˜ã€‚è¿™ç§æ–¹å¼ä½¿å¾—å†…æ ¸åœ¨å¤„ç†ç‰©ç†å†…å­˜æ—¶æ›´åŠ ç®€ä¾¿ï¼Œä¸éœ€è¦é¢å¤–çš„åœ°å€è½¬æ¢ã€‚</p></li><li><p><strong>å†…å­˜åˆ†é…ç¤ºä¾‹</strong>ï¼šä¾‹å¦‚ï¼Œåœ¨ <code>fork</code> ç³»ç»Ÿè°ƒç”¨ä¸­ï¼Œå½“ä¸ºå­è¿›ç¨‹åˆ†é…ç”¨æˆ·å†…å­˜æ—¶ï¼Œåˆ†é…å™¨è¿”å›çš„æ˜¯ç‰©ç†å†…å­˜åœ°å€ã€‚ç”±äºå†…æ ¸é‡‡ç”¨ç›´æ¥æ˜ å°„ï¼Œ<code>fork</code> å¯ä»¥ç›´æ¥å°†è¿™ä¸ªç‰©ç†åœ°å€ä½œä¸ºè™šæ‹Ÿåœ°å€ä½¿ç”¨ï¼Œå°†çˆ¶è¿›ç¨‹çš„ç”¨æˆ·å†…å­˜å†…å®¹å¤åˆ¶åˆ°å­è¿›ç¨‹ä¸­ã€‚è¿™å‡å°‘äº†éœ€è¦è¿›è¡Œåœ°å€è½¬æ¢çš„å¤æ‚æ€§ã€‚</p></li></ul><p>åœ¨å†…æ ¸çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œæœ‰å‡ ä¸ªåœ°å€å¹¶ä¸æ˜¯ç›´æ¥æ˜ å°„çš„ï¼ŒåŒ…æ‹¬ï¼š</p><ol><li><p><strong>Trampoline Page</strong></p><ul><li><p><strong>æ˜ å°„ä½ç½®</strong>ï¼šTrampoline é¡µä½äºè™šæ‹Ÿåœ°å€ç©ºé—´çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”ç”¨æˆ·é¡µé¢è¡¨ä¹Ÿå…·æœ‰ç›¸åŒçš„æ˜ å°„ã€‚</p></li><li><p><strong>ä½œç”¨</strong>ï¼šTrampoline é¡µç”¨äºå®ç°ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰åŠŸèƒ½ã€‚å®ƒçš„ç‰©ç†é¡µé¢ï¼ˆå­˜æ”¾ Trampoline ä»£ç ï¼‰åœ¨å†…æ ¸çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­è¢«æ˜ å°„äº†ä¸¤æ¬¡ï¼šä¸€æ¬¡åœ¨è™šæ‹Ÿç©ºé—´çš„é¡¶éƒ¨ï¼Œå¦ä¸€æ¬¡æ˜¯ç›´æ¥æ˜ å°„çš„åœ°å€ã€‚</p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šè¿™ç§è®¾è®¡å±•ç¤ºäº†é¡µé¢è¡¨çš„çµæ´»ä½¿ç”¨ï¼Œèƒ½å¤Ÿåœ¨éœ€è¦æ—¶åŒæ—¶ä½¿ç”¨ä¸åŒçš„æ˜ å°„ã€‚</p></li></ul></li><li><p><strong>Kernel Stack Pages</strong></p><ul><li><p><strong>æ¯ä¸ªè¿›ç¨‹çš„å†…æ ¸æ ˆ</strong>ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…æ ¸æ ˆï¼Œè¿™äº›æ ˆæ˜ å°„åœ¨é«˜åœ°å€ï¼Œä»¥ä¾¿åœ¨å®ƒä»¬ä¸‹é¢ä¿ç•™ä¸€ä¸ªæœªæ˜ å°„çš„ä¿æŠ¤é¡µï¼ˆguard pageï¼‰ã€‚</p></li><li><p><strong>ä¿æŠ¤é¡µ</strong>ï¼šä¿æŠ¤é¡µçš„é¡µè¡¨é¡¹ï¼ˆPTEï¼‰æ˜¯æ— æ•ˆçš„ï¼ˆå³ PTE_V æ²¡æœ‰è®¾ç½®ï¼‰ï¼Œå› æ­¤å¦‚æœå†…æ ¸æ ˆæº¢å‡ºï¼Œå®ƒå°†å¯èƒ½å¯¼è‡´å¼‚å¸¸ï¼Œä»è€Œå¼•å‘å†…æ ¸ææ…Œï¼ˆpanicï¼‰ã€‚æ²¡æœ‰ä¿æŠ¤é¡µçš„æƒ…å†µä¸‹ï¼Œæº¢å‡ºçš„æ ˆå¯èƒ½ä¼šè¦†ç›–å…¶ä»–å†…æ ¸å†…å­˜ï¼Œå¯¼è‡´é”™è¯¯æ“ä½œã€‚</p></li><li><p><strong>æ˜ å°„è®¾è®¡</strong>ï¼šå†…æ ¸é€šè¿‡é«˜å†…å­˜æ˜ å°„ä½¿ç”¨è¿™äº›æ ˆï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥æ˜ å°„çš„åœ°å€è®¿é—®å®ƒä»¬ã€‚å¦‚æœåªä½¿ç”¨ç›´æ¥æ˜ å°„è€Œä¸è®¾ç½®ä¿æŠ¤é¡µï¼Œå¤„ç†ä¿æŠ¤é¡µå°†æ¶‰åŠå–æ¶ˆæ˜ å°„åŸæœ¬æŒ‡å‘ç‰©ç†å†…å­˜çš„è™šæ‹Ÿåœ°å€ï¼Œè¿™å°†å˜å¾—éš¾ä»¥ä½¿ç”¨ã€‚</p></li></ul></li></ol><p><strong>æƒé™è®¾ç½®</strong></p><ul><li><strong>Trampoline é¡µå’Œå†…æ ¸æ–‡æœ¬çš„æ˜ å°„</strong>ï¼šè¿™äº›é¡µé¢çš„æƒé™è®¾ç½®ä¸º PTE_Rï¼ˆå¯è¯»ï¼‰å’Œ PTE_Xï¼ˆå¯æ‰§è¡Œï¼‰ï¼Œå†…æ ¸å¯ä»¥ä»è¿™äº›é¡µé¢è¯»å–å’Œæ‰§è¡ŒæŒ‡ä»¤ã€‚</li><li><strong>å…¶ä»–é¡µé¢çš„æ˜ å°„</strong>ï¼šå…¶ä»–é¡µé¢çš„æƒé™è®¾ç½®ä¸º PTE_Rï¼ˆå¯è¯»ï¼‰å’Œ PTE_Wï¼ˆå¯å†™ï¼‰ï¼Œå…è®¸å†…æ ¸è¯»å–å’Œå†™å…¥è¿™äº›é¡µé¢çš„å†…å­˜ã€‚</li><li><strong>ä¿æŠ¤é¡µçš„æ˜ å°„</strong>ï¼šä¿æŠ¤é¡µçš„æ˜ å°„æ˜¯æ— æ•ˆçš„ï¼Œä»¥é˜²æ­¢è®¿é—®ã€‚</li></ul><h2 id="3-3-Code-creating-an-address-space"><a href="#3-3-Code-creating-an-address-space" class="headerlink" title="3.3  Code: creating an address space"></a>3.3  Code: creating an address space</h2><p>xv6ä¸­å¤§å¤šæ•°æ“æ§åœ°å€ç©ºé—´å’Œé¡µè¡¨çš„ä»£ç åœ¨vm.cä¸­ã€‚</p><p>æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯ <code>pagetable_t</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€çº§é¡µè¡¨çš„æŒ‡é’ˆï¼Œå®ƒè¦ä¹ˆæŒ‡å‘å†…æ ¸é¡µè¡¨ï¼Œè¦ä¹ˆæŒ‡å‘è¿›ç¨‹è‡ªå·±çš„é¡µè¡¨ã€‚</p><p>æ ¸å¿ƒå‡½æ•°æœ‰ï¼š</p><ul><li><code>walk</code> - æ‰¾åˆ°ä¸€ä¸ªè™šæ‹Ÿåœ°å€å¯¹åº”çš„PTE</li><li><code>mappages</code> - ä¸ºæ–°çš„æ˜ å°„è®¾ç«‹PTE</li></ul><p>ä»¥kvmä¸ºå‰ç¼€çš„å‡½æ•°æ“ä½œå†…æ ¸é¡µè¡¨ï¼›ä»¥uvmä¸ºå‰ç¼€çš„å‡½æ•°æ“ä½œè¿›ç¨‹é¡µè¡¨ï¼›å…¶å®ƒå‡½æ•°ä¸¤è€…éƒ½å¯ä»¥æ“ä½œã€‚</p><p>åœ¨ xv6 æ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>copyout</code> å’Œ <code>copyin</code> å‡½æ•°ç”¨äºå°†æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·è™šæ‹Ÿåœ°å€å’Œä»ç”¨æˆ·è™šæ‹Ÿåœ°å€å¤åˆ¶æ•°æ®ï¼Œè¿™äº›åœ°å€ä½œä¸ºç³»ç»Ÿè°ƒç”¨å‚æ•°ä¼ å…¥ã€‚è¿™äº›å‡½æ•°åœ¨ <code>vm.c</code> æ–‡ä»¶ä¸­å®ç°ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦æ˜¾å¼åœ°è½¬æ¢è¿™äº›åœ°å€ä»¥æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†å†…å­˜ã€‚</p><p><strong>å†…æ ¸çš„é¡µè¡¨åˆ›å»º</strong>ï¼š</p><ul><li>åœ¨å¯åŠ¨åºåˆ—çš„æ—©æœŸï¼Œ<code>main</code> å‡½æ•°è°ƒç”¨ <code>kvminit</code> æ¥åˆ›å»ºå†…æ ¸çš„é¡µè¡¨ã€‚æ­¤è°ƒç”¨å‘ç”Ÿåœ¨ xv6 å¯ç”¨åˆ†é¡µä¹‹å‰ï¼Œå› æ­¤åœ°å€ç›´æ¥æŒ‡å‘ç‰©ç†å†…å­˜ã€‚</li><li><code>kvmmake</code> é¦–å…ˆåˆ†é…ä¸€é¡µç‰©ç†å†…å­˜ï¼Œç”¨äºå­˜æ”¾æ ¹é¡µé¢è¡¨ã€‚ç„¶åï¼Œå®ƒè°ƒç”¨ <code>kvmmap</code> å®‰è£…å†…æ ¸æ‰€éœ€çš„åœ°å€è½¬æ¢ï¼ŒåŒ…æ‹¬å†…æ ¸çš„æŒ‡ä»¤å’Œæ•°æ®ã€åˆ° PHYSTOP çš„ç‰©ç†å†…å­˜ï¼Œä»¥åŠå®é™…ä¸Šæ˜¯è®¾å¤‡çš„å†…å­˜èŒƒå›´ã€‚</li></ul><p><strong>åˆ†é…å†…æ ¸æ ˆ</strong>ï¼š</p><ul><li><code>proc_mapstacks</code> ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªå†…æ ¸æ ˆã€‚å®ƒè°ƒç”¨ <code>kvmmap</code> å°†æ¯ä¸ªæ ˆæ˜ å°„åˆ°ç”± <code>KSTACK</code> ç”Ÿæˆçš„è™šæ‹Ÿåœ°å€ï¼Œè¿™æ ·å¯ä»¥ä¸ºæ— æ•ˆçš„æ ˆä¿æŠ¤é¡µç•™å‡ºç©ºé—´ã€‚</li></ul><p><strong>é¡µé¢æ˜ å°„çš„å®‰è£…</strong>ï¼š</p><ul><li><code>kvmmap</code> è°ƒç”¨ <code>mappages</code>ï¼Œå°†è™šæ‹Ÿåœ°å€èŒƒå›´æ˜ å°„åˆ°ç›¸åº”çš„ç‰©ç†åœ°å€èŒƒå›´ã€‚å¯¹äºèŒƒå›´å†…çš„æ¯ä¸ªè™šæ‹Ÿåœ°å€ï¼Œ<code>mappages</code> åˆ†åˆ«å¤„ç†ï¼Œå¹¶æŒ‰é¡µé—´éš”è¿›è¡Œæ˜ å°„ã€‚</li><li>å¯¹äºæ¯ä¸ªéœ€è¦æ˜ å°„çš„è™šæ‹Ÿåœ°å€ï¼Œ<code>mappages</code> è°ƒç”¨ <code>walk</code> æ‰¾åˆ°è¯¥åœ°å€çš„é¡µé¢è¡¨é¡¹ï¼ˆPTEï¼‰ã€‚ç„¶åï¼Œå®ƒåˆå§‹åŒ– PTEï¼Œä»¥ä¿å­˜ç›¸å…³çš„ç‰©ç†é¡µé¢ç¼–å·ã€æ‰€éœ€çš„æƒé™ï¼ˆPTE_Wã€PTE_X å’Œ&#x2F;æˆ– PTE_Rï¼‰ï¼Œå¹¶è®¾ç½® PTE_V å°† PTE æ ‡è®°ä¸ºæœ‰æ•ˆã€‚</li></ul><p><strong>PTE æŸ¥æ‰¾</strong></p><ul><li><strong>walk å‡½æ•°</strong>ï¼š<code>walk</code> å‡½æ•°æ¨¡æ‹Ÿ RISC-V çš„åˆ†é¡µç¡¬ä»¶ï¼Œé€çº§æŸ¥æ‰¾è™šæ‹Ÿåœ°å€çš„ PTEã€‚å®ƒä½¿ç”¨æ¯çº§åœ°å€çš„ 9 ä½è™šæ‹Ÿåœ°å€ç´¢å¼•ç›¸å…³çš„é¡µé¢ç›®å½•é¡µã€‚æ¯ä¸€å±‚ä¸­ï¼Œå®ƒæ‰¾åˆ°çš„æ˜¯ä¸‹ä¸€å±‚é¡µé¢ç›®å½•é¡µçš„ PTEï¼Œæˆ–è€…æ˜¯æœ€ç»ˆé¡µé¢çš„ PTEã€‚</li><li>å¦‚æœä¸€çº§æˆ–äºŒçº§é¡µé¢ç›®å½•é¡µä¸­çš„ PTE æ— æ•ˆï¼Œåˆ™æ‰€éœ€çš„ç›®å½•é¡µå°šæœªåˆ†é…ï¼›å¦‚æœ <code>alloc</code> å‚æ•°è¢«è®¾ç½®ï¼Œ<code>walk</code> å°†åˆ†é…ä¸€ä¸ªæ–°çš„é¡µé¢è¡¨é¡µï¼Œå¹¶å°†å…¶ç‰©ç†åœ°å€æ”¾å…¥ PTE ä¸­ã€‚å®ƒè¿”å›æ ‘ä¸­æœ€ä½å±‚çš„ PTE åœ°å€ã€‚</li></ul><p><strong>ç‰©ç†å†…å­˜ä¸è™šæ‹Ÿåœ°å€çš„ç›´æ¥æ˜ å°„</strong></p><p>ä¸Šè¿°ä»£ç ä¾èµ–äºç‰©ç†å†…å­˜ç›´æ¥æ˜ å°„åˆ°å†…æ ¸è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå½“ <code>walk</code> å‡½æ•°å‘ä¸‹æŸ¥æ‰¾é¡µé¢è¡¨æ—¶ï¼Œå®ƒä» PTE ä¸­æå–ä¸‹ä¸€å±‚é¡µé¢è¡¨çš„ç‰©ç†åœ°å€ï¼Œç„¶åå°†è¯¥åœ°å€ç”¨ä½œè™šæ‹Ÿåœ°å€ä»¥è·å–ä¸‹ä¸€å±‚çš„ PTEã€‚æ‰€ä»¥å¿…é¡»ä¿è¯æ˜¯é‡‡ç”¨ç›´æ¥æ˜ å°„ã€‚</p><p><strong>å®‰è£…å†…æ ¸é¡µè¡¨</strong></p><ul><li><code>main</code> è°ƒç”¨ <code>kvminithart</code> å®‰è£…å†…æ ¸é¡µé¢è¡¨ã€‚å®ƒå°†æ ¹é¡µé¢è¡¨çš„ç‰©ç†åœ°å€å†™å…¥ <code>satp</code> å¯„å­˜å™¨ã€‚æ­¤åï¼ŒCPU å°†ä½¿ç”¨å†…æ ¸é¡µé¢è¡¨è¿›è¡Œåœ°å€è½¬æ¢ã€‚ç”±äºå†…æ ¸ä½¿ç”¨ç›´æ¥æ˜ å°„ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤çš„è™šæ‹Ÿåœ°å€å°†æ­£ç¡®æ˜ å°„åˆ°å¯¹åº”çš„ç‰©ç†å†…å­˜åœ°å€ã€‚</li></ul><p><strong>TLB</strong></p><p>åœ¨ RISC-V CPU ä¸­ï¼Œé¡µè¡¨é¡¹ä¼šè¢«ç¼“å­˜åˆ°è½¬æ¢åå¤‡ç¼“å†²åŒºï¼ˆTLBï¼‰ä¸­ã€‚å½“ xv6 ä¿®æ”¹é¡µè¡¨æ—¶ï¼Œå¿…é¡»é€šçŸ¥ CPU ä½¿å¯¹åº”çš„ TLB ç¼“å­˜æ¡ç›®å¤±æ•ˆã€‚å¦‚æœä¸è¿™æ ·åšï¼ŒTLB å¯èƒ½ä¼šåœ¨åç»­ä½¿ç”¨æ—§çš„ç¼“å­˜æ˜ å°„ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æŒ‡å‘çš„ç‰©ç†é¡µé¢è¢«åˆ†é…ç»™å…¶ä»–è¿›ç¨‹ï¼Œä»è€Œä½¿ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿè®¿é—®æˆ–ç¯¡æ”¹å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ã€‚</p><p><strong>TLB å¤±æ•ˆæœºåˆ¶</strong></p><ul><li><p><strong>sfence.vma æŒ‡ä»¤</strong>ï¼š</p><p>RISC-V æä¾›äº† <code>sfence.vma</code> æŒ‡ä»¤ï¼Œç”¨äºåˆ·æ–°å½“å‰ CPU çš„ TLBã€‚xv6 åœ¨ <code>kvminithart</code> ä¸­é‡æ–°åŠ è½½ <code>satp</code> å¯„å­˜å™¨åæ‰§è¡Œæ­¤æŒ‡ä»¤ï¼ŒåŒæ—¶åœ¨åˆ‡æ¢åˆ°ç”¨æˆ·é¡µé¢è¡¨çš„ Trampoline ä»£ç ä¸­ä¹Ÿä¼šè°ƒç”¨å®ƒï¼ˆåœ¨ <code>kernel/trampoline.S:89</code> å¤„ï¼‰ã€‚</p></li><li><p><strong>ç¡®ä¿æ—§è¡¨æ ¼çš„å®Œæ•´æ€§</strong>ï¼š</p><p>åœ¨æ›´æ”¹ <code>satp</code> ä¹‹å‰ï¼Œä¹Ÿéœ€è¦å‘å‡º <code>sfence.vma</code> æŒ‡ä»¤ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æœªå®Œæˆçš„åŠ è½½å’Œå­˜å‚¨æ“ä½œå·²å®Œæˆã€‚è¿™ä¸€ç­‰å¾…è¿‡ç¨‹ç¡®ä¿å…ˆå‰å¯¹é¡µè¡¨çš„æ›´æ–°å®Œæˆï¼ŒåŒæ—¶ä¿è¯ä¹‹å‰çš„åŠ è½½å’Œå­˜å‚¨ä½¿ç”¨æ—§çš„é¡µè¡¨ï¼Œè€Œä¸æ˜¯æ–°çš„ã€‚</p></li></ul><p><strong>åœ°å€ç©ºé—´æ ‡è¯†ç¬¦ï¼ˆASIDsï¼‰</strong></p><ul><li>ä¸ºäº†é¿å…åˆ·æ–°æ•´ä¸ª TLBï¼ŒRISC-V CPU å¯èƒ½æ”¯æŒåœ°å€ç©ºé—´æ ‡è¯†ç¬¦ï¼ˆASIDsï¼‰ã€‚è¿™æ ·ï¼Œå†…æ ¸å¯ä»¥ä»…åˆ·æ–°ç‰¹å®šåœ°å€ç©ºé—´çš„ TLB æ¡ç›®ï¼Œè€Œæ— éœ€å½±å“å…¶ä»–åœ°å€ç©ºé—´ã€‚</li><li>ç„¶è€Œï¼Œxv6 å¹¶æœªä½¿ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå› æ­¤æ¯æ¬¡ä¿®æ”¹é¡µè¡¨æ—¶ä»éœ€å®Œå…¨åˆ·æ–° TLBã€‚</li></ul><h2 id="3-4-Physical-memory-allocation"><a href="#3-4-Physical-memory-allocation" class="headerlink" title="3.4 Physical memory allocation"></a>3.4 Physical memory allocation</h2><p>xv6ä½¿ç”¨ä»‹äºå†…æ ¸æœ«å°¾å’ŒPHYSTOPç›´æ¥çš„ç‰©ç†å†…å­˜æ¥è¿›è¡Œè¿è¡Œæ—¶åˆ†é…ã€‚é€šè¿‡é¡µé¢é“¾è¡¨æ¥ç»´æŠ¤ç©ºé—²é¡µé¢ï¼Œå½“åˆ†é…çš„æ—¶å€™éœ€è¦ä»é“¾è¡¨ä¸­ç§»é™¤åˆ†é…çš„é¡µé¢ï¼Œå½“é‡Šæ”¾çš„æ—¶å€™éœ€è¦å°†é¡µé¢æ·»åŠ åˆ°é“¾è¡¨ä¸­ã€‚</p><h2 id="3-5-Codeï¼šPhysical-memory-allocator"><a href="#3-5-Codeï¼šPhysical-memory-allocator" class="headerlink" title="3.5 Codeï¼šPhysical memory allocator"></a>3.5 Codeï¼šPhysical memory allocator</h2><p>åˆ†é…å™¨ä»£ç åœ¨kalloc.cä¸­ã€‚</p><p>åˆ†é…å™¨çš„æ•°æ®ç»“æ„æ˜¯ç©ºé—²é¡µé¢çš„é“¾è¡¨ã€‚é“¾è¡¨ä¸­çš„å…ƒç´ æ˜¯ <code>struct run</code> ï¼Œè¿™äº›ç»“æ„ä½“ä¿å­˜åœ¨ç›¸åº”çš„ç©ºé—²é¡µé¢å†…ã€‚é“¾è¡¨è¢«ä¸€ä¸ªè‡ªæ—‹é”ä¿æŠ¤ã€‚</p><p> <code>main</code> è°ƒç”¨ <code>kinit</code> æ¥åˆå§‹åŒ–è¿™ä¸ªåˆ†é…å™¨ã€‚ <code>kinit</code> è´Ÿè´£åˆå§‹åŒ–é“¾è¡¨ï¼Œç»´æŠ¤æ¯ä¸ªç©ºé—²é¡µé¢ã€‚ç”¨åˆ°äº† <code>freerange</code> å’Œ <code>kfree</code>ã€‚</p><h2 id="3-6-Process-address-space"><a href="#3-6-Process-address-space" class="headerlink" title="3.6 Process address space"></a>3.6 Process address space</h2><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œè¿›ç¨‹åˆ‡æ¢çš„æ—¶å€™ä¼šæ›´æ¢é¡µè¡¨ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-3/image-20240925173235081.png"></p><p>å†…æ ¸åœ¨ç”¨æˆ·åœ°å€ç©ºé—´çš„é¡¶éƒ¨æ˜ å°„äº†ä¸€é¡µåŒ…å« trampoline ä»£ç çš„é¡µé¢ï¼Œè¯¥é¡µé¢æ²¡æœ‰è®¾ç½®ç”¨æˆ·è®¿é—®æƒé™ï¼ˆPTE_Uï¼‰ã€‚è¿™æ ·ï¼Œè™½ç„¶è¿™é¡µç‰©ç†å†…å­˜åœ¨æ‰€æœ‰åœ°å€ç©ºé—´ä¸­å¯è§ï¼Œä½†åªæœ‰å†…æ ¸èƒ½å¤Ÿä½¿ç”¨å®ƒã€‚</p><p><strong>å…±äº«é¡µé¢</strong>ï¼š</p><p>è¿™é¡µç‰©ç†å†…å­˜è¢«æ˜ å°„åˆ°æ¯ä¸ªç”¨æˆ·è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œä½†ç”±äºæ²¡æœ‰ç”¨æˆ·è®¿é—®æƒé™ï¼Œç”¨æˆ·è¿›ç¨‹æ— æ³•è®¿é—®æˆ–ä¿®æ”¹è¯¥é¡µã€‚</p><p><strong>å†…æ ¸çš„ç”¨é€”</strong>ï¼š</p><p>è¯¥é¡µé¢çš„ä¸»è¦ç”¨é€”æ˜¯åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œå†…æ ¸å¯ä»¥é€šè¿‡ trampoline ä»£ç å¿«é€Ÿåˆ‡æ¢åˆ°ç”¨æˆ·æ¨¡å¼ã€‚è¿™ç§è®¾è®¡ç®€åŒ–äº†ç”¨æˆ·ä¸å†…æ ¸ä¹‹é—´çš„åˆ‡æ¢è¿‡ç¨‹ã€‚</p><p><strong>å®‰å…¨æ€§</strong>ï¼š</p><p>é€šè¿‡é™åˆ¶ç”¨æˆ·è®¿é—®è¿™é¡µå†…å­˜ï¼Œå†…æ ¸èƒ½å¤Ÿé˜²æ­¢æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œç¡®ä¿ç”¨æˆ·è¿›ç¨‹æ— æ³•å¹²æ‰°æˆ–ç¯¡æ”¹å…³é”®çš„å†…æ ¸ä»£ç ã€‚</p><h2 id="3-7-Codeï¼šsbrk"><a href="#3-7-Codeï¼šsbrk" class="headerlink" title="3.7 Codeï¼šsbrk"></a>3.7 Codeï¼šsbrk</h2><h2 id="3-8-Codeï¼šexec"><a href="#3-8-Codeï¼šexec" class="headerlink" title="3.8 Codeï¼šexec"></a>3.8 Codeï¼šexec</h2>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Xv6 Chapter 2</title>
    <link href="/2024/09/24/MIT-6-1810-Xv6-Chapter-2/"/>
    <url>/2024/09/24/MIT-6-1810-Xv6-Chapter-2/</url>
    
    <content type="html"><![CDATA[<h1 id="Operating-system-organization"><a href="#Operating-system-organization" class="headerlink" title="Operating system organization"></a>Operating system organization</h1><span id="more"></span><p>ä¸€ä¸ªæ“ä½œç³»ç»Ÿå¿…é¡»æ»¡è¶³ä¸‰ä¸ªéœ€æ±‚ï¼š</p><ol><li>å¤ç”¨</li><li>éš”ç¦»</li><li>äº¤äº’</li></ol><p>xv6æ˜¯ç”¨LP64Cå†™çš„ï¼ˆlongå’Œpointeræ˜¯8Bï¼Œintæ˜¯4Bï¼‰ã€‚</p><h2 id="2-1-Abstracting-physical-resources"><a href="#2-1-Abstracting-physical-resources" class="headerlink" title="2.1 Abstracting physical resources"></a>2.1 Abstracting physical resources</h2><p>é€šè¿‡æŠ½è±¡ç¡¬ä»¶èµ„æºï¼Œå¯ä»¥ä½¿æ“ä½œç³»ç»Ÿæ–¹ä¾¿çš„å®ç°å¤ç”¨ã€éš”ç¦»ã€äº¤äº’ã€‚</p><h2 id="2-2-User-modeï¼Œsupervisor-modeï¼Œand-system-calls"><a href="#2-2-User-modeï¼Œsupervisor-modeï¼Œand-system-calls" class="headerlink" title="2.2 User modeï¼Œsupervisor modeï¼Œand system calls"></a>2.2 User modeï¼Œsupervisor modeï¼Œand system calls</h2><p>éš”ç¦»éœ€è¦åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´æœ‰ä¸€æ¡ç¡¬è¾¹ç•Œã€‚</p><p>ä¸ºäº†å®ç°è¿™ç§éš”ç¦»ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä½¿è¿›ç¨‹ä¸èƒ½è®¿é—®æ“ä½œç³»ç»Ÿçš„æŒ‡ä»¤å’Œæ•°æ®ï¼Œä¹Ÿä¸èƒ½è®¿é—®å…¶ä»–è¿›ç¨‹çš„æŒ‡ä»¤å’Œæ•°æ®ã€‚</p><p>CPUä¸ºè¿™ç§éš”ç¦»æä¾›äº†ç¡¬ä»¶æ”¯æŒã€‚RISC-Væœ‰ä¸‰ç§æŒ‡ä»¤æ‰§è¡Œæ¨¡å¼ï¼šæœºå™¨æ¨¡å¼ï¼ˆmachine modeï¼‰ã€å†…æ ¸æ¨¡å¼ï¼ˆsupervisor modeï¼‰ï¼Œç”¨æˆ·æ¨¡å¼ï¼ˆuser modeï¼‰ã€‚</p><p><strong>æœºå™¨æ¨¡å¼ï¼ˆmachine modeï¼‰</strong></p><p>è¯¥æ¨¡å¼çš„æŒ‡ä»¤æœ‰å®Œæ•´çš„ç‰¹æƒã€‚CPUåˆå§‹å¯åŠ¨çš„æ—¶å€™åœ¨è¯¥æ¨¡å¼ï¼Œç„¶ååœ¨bootçš„è¿‡ç¨‹ä¸­è®¾ç½®ç”µè„‘ï¼Œä¹‹åå°±ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ã€‚</p><p><strong>å†…æ ¸æ¨¡å¼ï¼ˆsupervisor modeï¼‰</strong></p><p>è¯¥æ¨¡å¼ä¸‹å¯ä»¥æ‰§è¡Œ<strong>ç‰¹æƒæŒ‡ä»¤</strong>ï¼Œä¾‹å¦‚å¼€å…³ä¸­æ–­ã€è®¿é—®é¡µè¡¨å¯„å­˜å™¨ç­‰ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·æ¨¡å¼ä¸‹çš„è¿›ç¨‹å°è¯•æ‰§è¡Œç‰¹æƒæŒ‡ä»¤ï¼ŒCPUä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯åˆ‡æ¢åˆ°å†…æ ¸æ¨¡å¼ï¼Œç„¶åç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚</p><p>åº”ç”¨æƒ³è¦æ‰§è¡Œå†…æ ¸ä¸­çš„å‡½æ•°å¿…é¡»åˆ‡æ¢åˆ°å†…æ ¸ä¸­æ‰§è¡Œï¼Œä¸”ä¸èƒ½ç›´æ¥æ‰§è¡Œå†…æ ¸å‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ç§ç‰¹æ®Šçš„æŒ‡ä»¤è¿›å…¥å†…æ ¸ï¼ˆRISV-Væä¾›ecallæŒ‡ä»¤ï¼‰ï¼Œä¹‹åå†…æ ¸ä¼šå»æ£€æŸ¥åº”ç”¨ä¼ è¿›æ¥çš„å‚æ•°æ˜¯å¦åˆæ³•ï¼ˆä¾‹å¦‚å†…å­˜æ˜¯å¦è¶Šç•Œï¼Œæ˜¯å¦æœ‰æƒé™æ‰§è¡Œè¿™ç§æ“ä½œç­‰ï¼‰ã€‚ä¹‹æ‰€ä»¥ç”¨é€šè¿‡ç»Ÿä¸€çš„æŒ‡ä»¤æ¥è¿›å…¥å†…æ ¸ï¼Œæ˜¯é˜²æ­¢æœ‰çš„ç¨‹åºè·³è¿‡å‚æ•°æ£€æŸ¥ç­‰æ­¥éª¤ã€‚</p><h2 id="2-3-Kernel-organization"><a href="#2-3-Kernel-organization" class="headerlink" title="2.3 Kernel organization"></a>2.3 Kernel organization</h2><p>è®¾è®¡çš„å…³é”®æ˜¯æ“ä½œç³»ç»Ÿçš„ä»€ä¹ˆéƒ¨åˆ†åº”è¯¥åœ¨å†…æ ¸æ¨¡å¼ä¸‹è¿è¡Œã€‚</p><p><strong>å®å†…æ ¸</strong></p><p>ä¸€ç§æ–¹æ³•æ˜¯å°†æ•´ä¸ªæ“ä½œç³»ç»Ÿæ”¾åœ¨å†…æ ¸ä¸­ï¼Œç§°ä¸ºå®å†…æ ¸ã€‚</p><p>å®å†…æ ¸çš„ä¼˜ç‚¹æ˜¯ä¸ç”¨å†³å®šå“ªéƒ¨åˆ†æ”¾åœ¨å†…æ ¸ï¼›æ“ä½œç³»ç»Ÿä¸åŒéƒ¨åˆ†åˆä½œå®¹æ˜“ã€‚ç¼ºç‚¹æ˜¯ç³»ç»Ÿååˆ†å¤æ‚ï¼Œé”™è¯¯é€šå¸¸ä¼šå¯¼è‡´æ•´ä¸ªå†…æ ¸å´©æºƒã€‚</p><p><strong>å¾®å†…æ ¸</strong></p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯æœ€å°åŒ–å†…æ ¸çš„ä»£ç ï¼Œå°†å¤§éƒ¨åˆ†ç³»ç»ŸåŠŸèƒ½å®ç°åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œç§°ä¸ºå¾®å†…æ ¸ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-2/image-20240924200038764.png"></p><p>åœ¨å¾®å†…æ ¸æ¨¡å¼ä¸‹ï¼Œæ“ä½œç³»ç»Ÿçš„æœ‰äº›éƒ¨åˆ†å¯ä»¥è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼çš„è¿›ç¨‹ä¸­ï¼Œç§°ä¸ºæœåŠ¡å™¨ï¼ˆserverï¼‰ã€‚æ“ä½œç³»ç»Ÿæä¾›ä¸€ç§è¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•ï¼Œç¨‹åºé—´é€šè¿‡äº’ç›¸å‘é€æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡ã€‚</p><h2 id="2-4-Codeï¼šxv6-organization"><a href="#2-4-Codeï¼šxv6-organization" class="headerlink" title="2.4 Codeï¼šxv6 organization"></a>2.4 Codeï¼šxv6 organization</h2><p>xv6 çš„å†…æ ¸æºä»£ç ä½äº <code>kernel/</code> å­ç›®å½•ä¸­ï¼Œæºä»£ç è¢«åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œéµå¾ªä¸€å®šçš„æ¨¡å—åŒ–æ¦‚å¿µã€‚å›¾ 2.2 åˆ—å‡ºäº†è¿™äº›æ–‡ä»¶ã€‚æ¨¡å—ä¹‹é—´çš„æ¥å£åœ¨ <code>defs.h</code>ï¼ˆå³ <code>kernel/defs.h</code>ï¼‰ä¸­å®šä¹‰ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-2/image-20240924200752501.png"></p><h2 id="2-5-Process-overview"><a href="#2-5-Process-overview" class="headerlink" title="2.5 Process overview"></a>2.5 Process overview</h2><p>xv6ä¸­éš”ç¦»çš„æœ€å°å•å…ƒæ˜¯è¿›ç¨‹ã€‚</p><p>å†…æ ¸å®ç°è¿›ç¨‹çš„æœºåˆ¶åŒ…æ‹¬ç”¨æˆ·&#x2F;ç‰¹æƒæ¨¡å¼æ ‡å¿—ã€åœ°å€ç©ºé—´ä»¥åŠçº¿ç¨‹çš„æ—¶é—´ç‰‡åˆ†é…ã€‚</p><p>è¿›ç¨‹ç»™ç¨‹åºæä¾›äº†ä¸€ç§è‡ªå·±æ‹¥æœ‰æ•´ä¸ªåœ°å€ç©ºé—´å’ŒCPUçš„å‡è±¡ã€‚</p><p>xv6 ä½¿ç”¨é¡µè¡¨ï¼ˆç”±ç¡¬ä»¶å®ç°ï¼‰ä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚RISC-V é¡µè¡¨å°†è™šæ‹Ÿåœ°å€ï¼ˆRISC-V æŒ‡ä»¤æ“ä½œçš„åœ°å€ï¼‰è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼ˆCPU å‘é€åˆ°ä¸»å†…å­˜çš„åœ°å€ï¼‰ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-2/image-20240924202734337.png"></p><p>xv6 ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„é¡µè¡¨ï¼Œå®šä¹‰è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚å¦‚å›¾ 2.3 æ‰€ç¤ºï¼Œåœ°å€ç©ºé—´ä»è™šæ‹Ÿåœ°å€é›¶å¼€å§‹ï¼ŒåŒ…æ‹¬è¿›ç¨‹çš„ç”¨æˆ·å†…å­˜ã€‚é¦–å…ˆæ˜¯æŒ‡ä»¤ï¼Œç„¶åæ˜¯å…¨å±€å˜é‡ï¼Œå†æ˜¯æ ˆï¼Œæœ€åæ˜¯â€œå †â€åŒºåŸŸï¼ˆç”¨äº <code>malloc</code>ï¼‰ï¼Œè¯¥åŒºåŸŸå¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•ã€‚é™åˆ¶è¿›ç¨‹åœ°å€ç©ºé—´æœ€å¤§å¤§å°çš„å› ç´ æœ‰å¾ˆå¤šï¼šRISC-V çš„æŒ‡é’ˆå®½åº¦ä¸º 64 ä½ï¼Œç¡¬ä»¶åœ¨æŸ¥æ‰¾é¡µè¡¨ä¸­çš„è™šæ‹Ÿåœ°å€æ—¶ä»…ä½¿ç”¨ä½ 39 ä½ï¼Œè€Œ xv6 åªä½¿ç”¨è¿™ 39 ä½ä¸­çš„ 38 ä½ã€‚å› æ­¤ï¼Œæœ€å¤§åœ°å€ä¸º (2^{38} - 1 &#x3D; 0x3fffffffff)ï¼Œä¹Ÿå°±æ˜¯ <code>MAXVA</code>ï¼ˆå®šä¹‰åœ¨ kernel&#x2F;riscv.h:378ï¼‰ã€‚åœ¨åœ°å€ç©ºé—´çš„é¡¶éƒ¨ï¼Œxv6 æ”¾ç½®äº†ä¸€ä¸ª 4096 å­—èŠ‚çš„ trampoline é¡µå’Œä¸€ä¸ª trapframe é¡µã€‚xv6 ä½¿ç”¨è¿™ä¸¤ä¸ªé¡µé¢è¿›è¡Œå†…æ ¸çš„åˆ‡æ¢ï¼›trampoline é¡µåŒ…å«åˆ‡æ¢è¿›å‡ºå†…æ ¸çš„ä»£ç ï¼Œè€Œ trapframe ç”¨äºä¿å­˜è¿›ç¨‹çš„ç”¨æˆ·å¯„å­˜å™¨ï¼Œå…·ä½“å†…å®¹åœ¨ç¬¬å››ç« ä¸­è§£é‡Šã€‚</p><p>å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤å„è‡ªçš„çŠ¶æ€ï¼Œå­˜æ”¾åœ¨procç»“æ„ä½“é‡Œï¼ˆkernel&#x2F;proc.hï¼š85ï¼‰ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæ§åˆ¶çº¿ç¨‹ï¼ˆç®€ç§°çº¿ç¨‹ï¼‰ï¼Œå®ƒä¿å­˜æ‰§è¡Œè¯¥è¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€ã€‚åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œçº¿ç¨‹å¯èƒ½åœ¨ CPU ä¸Šæ‰§è¡Œï¼Œæˆ–è€…å¤„äºæŒ‚èµ·çŠ¶æ€ï¼ˆæœªæ‰§è¡Œä½†èƒ½å¤Ÿåœ¨æœªæ¥æ¢å¤æ‰§è¡Œï¼‰ã€‚è¦åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢ CPUï¼Œå†…æ ¸ä¼šæŒ‚èµ·å½“å‰åœ¨è¯¥ CPU ä¸Šè¿è¡Œçš„çº¿ç¨‹å¹¶ä¿å­˜å…¶çŠ¶æ€ï¼Œç„¶åæ¢å¤å¦ä¸€ä¸ªè¿›ç¨‹ä¹‹å‰æŒ‚èµ·çš„çº¿ç¨‹çš„çŠ¶æ€ã€‚çº¿ç¨‹çš„å¤§éƒ¨åˆ†çŠ¶æ€ï¼ˆå±€éƒ¨å˜é‡ã€å‡½æ•°è°ƒç”¨çš„è¿”å›åœ°å€ï¼‰å­˜å‚¨åœ¨çº¿ç¨‹çš„æ ˆä¸Šã€‚</p><p>æ¯ä¸ªè¿›ç¨‹æœ‰ä¸¤ä¸ªæ ˆï¼šç”¨æˆ·æ ˆå’Œå†…æ ¸æ ˆï¼ˆp-&gt;kstackï¼‰ã€‚å½“è¿›ç¨‹æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤æ—¶ï¼Œä»…ä½¿ç”¨å…¶ç”¨æˆ·æ ˆï¼Œè€Œå†…æ ¸æ ˆä¸ºç©ºã€‚å½“è¿›ç¨‹è¿›å…¥å†…æ ¸ï¼ˆè¿›è¡Œç³»ç»Ÿè°ƒç”¨æˆ–ä¸­æ–­ï¼‰æ—¶ï¼Œå†…æ ¸ä»£ç åœ¨è¿›ç¨‹çš„å†…æ ¸æ ˆä¸Šæ‰§è¡Œï¼›åœ¨è¿›ç¨‹å¤„äºå†…æ ¸çŠ¶æ€æ—¶ï¼Œå…¶ç”¨æˆ·æ ˆä»ç„¶ä¿å­˜ç€æ•°æ®ï¼Œä½†ä¸å†è¢«ä¸»åŠ¨ä½¿ç”¨ã€‚è¿›ç¨‹çš„çº¿ç¨‹åœ¨æ´»è·ƒä½¿ç”¨ç”¨æˆ·æ ˆå’Œå†…æ ¸æ ˆä¹‹é—´äº¤æ›¿åˆ‡æ¢ã€‚å†…æ ¸æ ˆæ˜¯ç‹¬ç«‹çš„ï¼ˆå¹¶ä¸”å—åˆ°ä¿æŠ¤ï¼Œé˜²æ­¢ç”¨æˆ·ä»£ç ç ´åï¼‰ï¼Œä»¥ç¡®ä¿å³ä½¿è¿›ç¨‹ç ´åäº†å…¶ç”¨æˆ·æ ˆï¼Œå†…æ ¸ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œã€‚</p><p>è¿›ç¨‹å¯ä»¥é€šè¿‡æ‰§è¡Œ RISC-V çš„ <code>ecall</code> æŒ‡ä»¤æ¥å‘èµ·ç³»ç»Ÿè°ƒç”¨ã€‚æ­¤æŒ‡ä»¤æå‡ç¡¬ä»¶ç‰¹æƒçº§ï¼Œå¹¶å°†ç¨‹åºè®¡æ•°å™¨æ›´æ”¹ä¸ºå†…æ ¸å®šä¹‰çš„å…¥å£ç‚¹ã€‚å…¥å£ç‚¹çš„ä»£ç åˆ‡æ¢åˆ°è¿›ç¨‹çš„å†…æ ¸æ ˆï¼Œå¹¶æ‰§è¡Œå®ç°ç³»ç»Ÿè°ƒç”¨çš„å†…æ ¸æŒ‡ä»¤ã€‚å½“ç³»ç»Ÿè°ƒç”¨å®Œæˆæ—¶ï¼Œå†…æ ¸åˆ‡æ¢å›ç”¨æˆ·æ ˆï¼Œå¹¶é€šè¿‡è°ƒç”¨ <code>sret</code> æŒ‡ä»¤è¿”å›ç”¨æˆ·ç©ºé—´ï¼Œè¿™å°†é™ä½ç¡¬ä»¶ç‰¹æƒçº§ï¼Œå¹¶åœ¨ç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤åç»§ç»­æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ã€‚è¿›ç¨‹çš„çº¿ç¨‹å¯ä»¥åœ¨å†…æ ¸ä¸­â€œé˜»å¡â€ï¼Œä»¥ç­‰å¾… I&#x2F;O æ“ä½œå®Œæˆï¼Œå¹¶åœ¨ I&#x2F;O å®Œæˆåä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹æ¢å¤ã€‚</p><p><code>p-&gt;state</code> æŒ‡ç¤ºè¿›ç¨‹çš„çŠ¶æ€ï¼Œå¯èƒ½æ˜¯å·²åˆ†é…ã€å‡†å¤‡è¿è¡Œã€å½“å‰åœ¨ CPU ä¸Šè¿è¡Œã€ç­‰å¾… I&#x2F;O æˆ–æ­£åœ¨é€€å‡ºã€‚</p><p><code>p-&gt;pagetable</code> ä¿å­˜è¿›ç¨‹çš„é¡µè¡¨ï¼Œæ ¼å¼ç¬¦åˆ RISC-V ç¡¬ä»¶çš„è¦æ±‚ã€‚xv6 ä½¿å¾—åˆ†é¡µç¡¬ä»¶åœ¨æ‰§è¡Œè¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´æ—¶ä½¿ç”¨ <code>p-&gt;pagetable</code>ã€‚è¿›ç¨‹çš„é¡µè¡¨è¿˜è®°å½•äº†åˆ†é…ç»™è¯¥è¿›ç¨‹å­˜å‚¨å†…å­˜çš„ç‰©ç†é¡µçš„åœ°å€ã€‚</p><p>æ€»ä¹‹ï¼Œè¿›ç¨‹ç»“åˆäº†ä¸¤ä¸ªè®¾è®¡ç†å¿µï¼šåœ°å€ç©ºé—´ä½¿è¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„å†…å­˜çš„é”™è§‰ï¼Œçº¿ç¨‹ä½¿è¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„ CPU çš„é”™è§‰ã€‚åœ¨ xv6 ä¸­ï¼Œè¿›ç¨‹ç”±ä¸€ä¸ªåœ°å€ç©ºé—´å’Œä¸€ä¸ªçº¿ç¨‹ç»„æˆã€‚åœ¨å®é™…çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹å¯èƒ½æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä»¥åˆ©ç”¨å¤šä¸ª CPUã€‚</p><h2 id="2-6-Codeï¼šstarting-xv6ï¼Œthe-first-process-and-system-call"><a href="#2-6-Codeï¼šstarting-xv6ï¼Œthe-first-process-and-system-call" class="headerlink" title="2.6 Codeï¼šstarting xv6ï¼Œthe first process and system call"></a>2.6 Codeï¼šstarting xv6ï¼Œthe first process and system call</h2><p>å½“RISC-Vè®¡ç®—æœºä¸Šç”µåï¼Œé¦–å…ˆä¼šåˆå§‹åŒ–ç¡¬ä»¶ï¼Œç„¶åæ‰§è¡Œä¸€ä¸ªå­˜æ”¾åœ¨ROMä¸­çš„boot loaderã€‚bool loaderè´Ÿè´£æŠŠxv6å†…æ ¸è£…è½½è¿›å†…å­˜ä¸­ã€‚ç„¶åï¼Œåœ¨æœºå™¨æ¨¡å¼ä¸‹ï¼ŒCPUä»_entry(kernel&#x2F;entry.S:7)å¼€å§‹æ‰§è¡Œxv6ã€‚å¼€å§‹æ—¶é¡µè¡¨è£…ç½®è¢«å…³é—­ï¼Œè™šæ‹Ÿåœ°å€ç›´æ¥è¢«æ˜ å°„åˆ°å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚</p><p>loaderå°†å†…æ ¸è£…åœ¨åˆ°ç‰©ç†åœ°å€0x80000000ï¼Œä¹‹æ‰€ä»¥è£…è½½åˆ°è¿™é‡Œï¼Œæ˜¯å› ä¸º0x0-0x80000000åŒ…å«äº†IOè®¾å¤‡ã€‚</p><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ <code>_entry.S</code> ä¸ºæ¯ä¸ªCPUéƒ½å‡†å¤‡äº†ä¸€ä¸ªæ ˆã€‚é€šè¿‡ <code>csrr</code> æŒ‡ä»¤å–å¾—å½“å‰hartçš„idï¼ˆé€šå¸¸ä»0å¼€å§‹ï¼‰ï¼Œå¹¶ä»¥è¯¥idä¸ºåç§»ï¼Œå°†ä¸åŒCPUçš„æ ˆé”™å¼€ã€‚xv6åœ¨ <code>start.c</code> ï¼ˆkernel&#x2F;start.cï¼š11ï¼‰ä¸­å£°æ˜äº†ä¸€ä¸ªåˆå§‹æ ˆæ•°ç»„ï¼Œ <code>stack0</code> ã€‚ <code>_entry</code> ä¸­çš„æŒ‡ä»¤å°†spæ”¹ä¸º <code>stack0+4096 * hartid</code> ï¼ˆæ ˆé¡¶ï¼‰ã€‚ä¹‹å <code>_entry</code> è°ƒç”¨ <code>start</code> ï¼ˆkernel&#x2F;start.cï¼š15ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs assembly">        # qemu -kernel loads the kernel at 0x80000000<br>        # and causes each hart (i.e. CPU) to jump there.<br>        # kernel.ld causes the following code to<br>        # be placed at 0x80000000.<br>.section .text<br>.global _entry<br>_entry:<br>        # set up a stack for C.<br>        # stack0 is declared in start.c,<br>        # with a 4096-byte stack per CPU.<br>        # sp = stack0 + (hartid * 4096)<br>        la sp, stack0<br>        li a0, 1024*4<br>        csrr a1, mhartid<br>        addi a1, a1, 1<br>        mul a0, a0, a1<br>        add sp, sp, a0<br>        # jump to start() in start.c<br>        call start<br>spin:<br>        j spin<br><br></code></pre></td></tr></table></figure><p> <code>start</code> æ‰§è¡Œä¸€äº›åªèƒ½åœ¨æœºå™¨æ¨¡å¼ä¸‹æ‰§è¡Œçš„é…ç½®ï¼Œç„¶åè½¬å…¥å†…æ ¸æ¨¡å¼ã€‚ä¸ºäº†è¿›å…¥å†…æ ¸æ¨¡å¼ï¼ŒRISC-Væä¾›äº†æŒ‡ä»¤ <code>mret</code> ï¼Œè¿™æ¡æŒ‡ä»¤é€šå¸¸ç”¨æ¥ä»å†…æ ¸æ¨¡å¼åˆ°æœºå™¨æ¨¡å¼çš„è°ƒç”¨è¿”å›ã€‚ <code>start</code> å¹¶ä¸ä¸Šè¿°çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨è®¾ç½®ä½¿ä¹‹å¥½åƒæ˜¯è¿™ç§æƒ…å†µã€‚é¦–å…ˆï¼Œè®¾ç½®mstatuså¯„å­˜å™¨ä¸ºSæ€ï¼Œç„¶åè®¾ç½®mepcå¯„å­˜å™¨ä¸ºmainçš„åœ°å€ï¼Œæ¥ä¸‹æ¥åœ¨è¿›è¡Œä¸€äº›ç›¸åº”çš„é…ç½®ã€‚åœ¨è½¬å…¥å†…æ ¸æ¨¡å¼ä¹‹å‰ï¼Œ <code>start</code> è¿˜ä½¿æ—¶é’ŸèŠ¯ç‰‡èƒ½å¤Ÿäº§ç”Ÿæ—¶é’Ÿä¸­æ–­ã€‚ä¹‹åæ‰§è¡Œ <code>mret</code> æŒ‡ä»¤ï¼Œè°ƒè½¬åˆ° <code>main</code> ç»§ç»­æ‰§è¡Œï¼ˆkernel&#x2F;main.cï¼š11ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;param.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;memlayout.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;riscv.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;defs.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">timerinit</span><span class="hljs-params">()</span>;<br><br><span class="hljs-comment">// entry.S needs one stack per CPU.</span><br>__attribute__ ((aligned (<span class="hljs-number">16</span>))) <span class="hljs-type">char</span> stack0[<span class="hljs-number">4096</span> * NCPU];<br><br><span class="hljs-comment">// entry.S jumps here in machine mode on stack0.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">start</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-comment">// set M Previous Privilege mode to Supervisor, for mret.</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> x = r_mstatus();<br>  x &amp;= ~MSTATUS_MPP_MASK;<br>  x |= MSTATUS_MPP_S;<br>  w_mstatus(x);<br><br>  <span class="hljs-comment">// set M Exception Program Counter to main, for mret.</span><br>  <span class="hljs-comment">// requires gcc -mcmodel=medany</span><br>  w_mepc((uint64)main);<br><br>  <span class="hljs-comment">// disable paging for now.</span><br>  w_satp(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-comment">// delegate all interrupts and exceptions to supervisor mode.</span><br>  w_medeleg(<span class="hljs-number">0xffff</span>);<br>  w_mideleg(<span class="hljs-number">0xffff</span>);<br>  w_sie(r_sie() | SIE_SEIE | SIE_STIE | SIE_SSIE);<br><br>  <span class="hljs-comment">// configure Physical Memory Protection to give supervisor mode</span><br>  <span class="hljs-comment">// access to all of physical memory.</span><br>  w_pmpaddr0(<span class="hljs-number">0x3fffffffffffff</span>ull);<br>  w_pmpcfg0(<span class="hljs-number">0xf</span>);<br><br>  <span class="hljs-comment">// ask for clock interrupts.</span><br>  timerinit();<br><br>  <span class="hljs-comment">// keep each CPU&#x27;s hartid in its tp register, for cpuid().</span><br>  <span class="hljs-type">int</span> id = r_mhartid();<br>  w_tp(id);<br><br>  <span class="hljs-comment">// switch to supervisor mode and jump to main().</span><br>  <span class="hljs-keyword">asm</span> <span class="hljs-title function_">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot;mret&quot;</span>)</span>;<br>&#125;<br><br><span class="hljs-comment">// ask each hart to generate timer interrupts.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">timerinit</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-comment">// enable supervisor-mode timer interrupts.</span><br>  w_mie(r_mie() | MIE_STIE);<br>  <br>  <span class="hljs-comment">// enable the sstc extension (i.e. stimecmp).</span><br>  w_menvcfg(r_menvcfg() | (<span class="hljs-number">1L</span> &lt;&lt; <span class="hljs-number">63</span>)); <br>  <br>  <span class="hljs-comment">// allow supervisor to use stimecmp and time.</span><br>  w_mcounteren(r_mcounteren() | <span class="hljs-number">2</span>);<br>  <br>  <span class="hljs-comment">// ask for the very first timer interrupt.</span><br>  w_stimecmp(r_time() + <span class="hljs-number">1000000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>main</code> é¦–å…ˆåˆå§‹åŒ–å‡ ä¸ªè®¾åˆ«å’Œå­ç³»ç»Ÿï¼Œç„¶åé€šè¿‡è°ƒç”¨ <code>userinit</code> ï¼ˆkernel&#x2F;proc.cï¼‰æ¥åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ã€‚ç¬¬ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œä¸€ä¸ªç”¨RISC-Væ±‡ç¼–å†™çš„å°ç¨‹åºï¼Œè¿™ä¸ªå°ç¨‹åºæ‰§è¡Œäº†xv6ä¸­çš„ç¬¬ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸ªå°ç¨‹åºåœ¨initcode.Sä¸­ï¼Œå®ƒå®é™…æ‰§è¡Œäº† <code>exec(init, argv)</code> ã€‚ å®ƒå°† <code>exec</code> ç³»ç»Ÿè°ƒç”¨å·ï¼ˆSYS_EXECï¼‰loadè¿›å¯„å­˜å™¨a7ï¼Œç„¶åæ‰§è¡Œ <code>ecall</code> æŒ‡ä»¤é‡æ–°è¿›å…¥å†…æ ¸ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;param.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;memlayout.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;riscv.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;defs.h&quot;</span></span><br><br><span class="hljs-keyword">volatile</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> started = <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">// start() jumps here in supervisor mode on all CPUs.</span><br><span class="hljs-type">void</span><br><span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-keyword">if</span>(cpuid() == <span class="hljs-number">0</span>)&#123;<br>    consoleinit();<br>    printfinit();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;xv6 kernel is booting\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    kinit();         <span class="hljs-comment">// physical page allocator</span><br>    kvminit();       <span class="hljs-comment">// create kernel page table</span><br>    kvminithart();   <span class="hljs-comment">// turn on paging</span><br>    procinit();      <span class="hljs-comment">// process table</span><br>    trapinit();      <span class="hljs-comment">// trap vectors</span><br>    trapinithart();  <span class="hljs-comment">// install kernel trap vector</span><br>    plicinit();      <span class="hljs-comment">// set up interrupt controller</span><br>    plicinithart();  <span class="hljs-comment">// ask PLIC for device interrupts</span><br>    binit();         <span class="hljs-comment">// buffer cache</span><br>    iinit();         <span class="hljs-comment">// inode table</span><br>    fileinit();      <span class="hljs-comment">// file table</span><br>    virtio_disk_init(); <span class="hljs-comment">// emulated hard disk</span><br>    userinit();      <span class="hljs-comment">// first user process</span><br>    __sync_synchronize();<br>    started = <span class="hljs-number">1</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">while</span>(started == <span class="hljs-number">0</span>)<br>      ;<br>    __sync_synchronize();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hart %d starting\n&quot;</span>, cpuid());<br>    kvminithart();    <span class="hljs-comment">// turn on paging</span><br>    trapinithart();   <span class="hljs-comment">// install kernel trap vector</span><br>    plicinithart();   <span class="hljs-comment">// ask PLIC for device interrupts</span><br>  &#125;<br><br>  scheduler();        <br>&#125;<br></code></pre></td></tr></table></figure><p>å†…æ ¸åœ¨ <code>syscall</code> ä¸­ä½¿ç”¨a7å¯„å­˜å™¨ä¸­çš„å€¼å»è°ƒç”¨æŒ‡å®šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå³ <code>exec</code> ã€‚ç³»ç»Ÿè°ƒç”¨è¡¨ï¼ˆsystem call tableï¼‰ï¼ˆkernel&#x2F;syscall.cï¼š107ï¼‰å°†SYS_EXECæ˜ å°„åˆ°ç³»ç»Ÿè°ƒç”¨ <code>sys_exec</code> ã€‚ä¹‹å <code>exec</code> ä¼šæŠŠå†…å­˜å’Œå¯„å­˜å™¨æ›¿æ¢ä¸º <code>init</code> ï¼ˆuser&#x2F;init.cï¼š15ï¼‰çš„å†…å­˜é•œåƒã€‚</p><p>å½“å†…æ ¸å®Œæˆ <code>exec</code> è°ƒç”¨åï¼Œä¼šè¿”å›ç”¨æˆ·ç©ºé—´æ‰§è¡Œ <code>init</code> å‡½æ•°ã€‚è¯¥å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å°è®¾å¤‡æ–‡ä»¶ï¼Œå¹¶é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ 0ã€1 å’Œ 2 æ‰“å¼€å®ƒã€‚éšåï¼Œ<code>init</code> åœ¨è¯¥æ§åˆ¶å°ä¸Šå¯åŠ¨ shellï¼Œè‡³æ­¤ï¼Œç³»ç»Ÿå·²ç»å¯åŠ¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// init: The initial user-level program</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/spinlock.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/sleeplock.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/fs.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/file.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/fcntl.h&quot;</span></span><br><br><span class="hljs-type">char</span> *argv[] = &#123; <span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-number">0</span> &#125;;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> pid, wpid;<br><br>  <span class="hljs-keyword">if</span>(open(<span class="hljs-string">&quot;console&quot;</span>, O_RDWR) &lt; <span class="hljs-number">0</span>)&#123;<br>    mknod(<span class="hljs-string">&quot;console&quot;</span>, CONSOLE, <span class="hljs-number">0</span>);<br>    open(<span class="hljs-string">&quot;console&quot;</span>, O_RDWR);<br>  &#125;<br>  dup(<span class="hljs-number">0</span>);  <span class="hljs-comment">// stdout</span><br>  dup(<span class="hljs-number">0</span>);  <span class="hljs-comment">// stderr</span><br><br>  <span class="hljs-keyword">for</span>(;;)&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;init: starting sh\n&quot;</span>);<br>    pid = fork();<br>    <span class="hljs-keyword">if</span>(pid &lt; <span class="hljs-number">0</span>)&#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;init: fork failed\n&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(pid == <span class="hljs-number">0</span>)&#123;<br>      exec(<span class="hljs-string">&quot;sh&quot;</span>, argv);<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;init: exec sh failed\n&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">for</span>(;;)&#123;<br>      <span class="hljs-comment">// this call to wait() returns if the shell exits,</span><br>      <span class="hljs-comment">// or if a parentless process exits.</span><br>      wpid = wait((<span class="hljs-type">int</span> *) <span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">if</span>(wpid == pid)&#123;<br>        <span class="hljs-comment">// the shell exited; restart it.</span><br>        <span class="hljs-keyword">break</span>;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(wpid &lt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;init: wait returned an error\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// it was a parentless process; do nothing.</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.1810]Xv6 Chapter 1</title>
    <link href="/2024/09/24/MIT-6-1810-Xv6-Chapter-1/"/>
    <url>/2024/09/24/MIT-6-1810-Xv6-Chapter-1/</url>
    
    <content type="html"><![CDATA[<h1 id="Operating-system-interfaces"><a href="#Operating-system-interfaces" class="headerlink" title="Operating system interfaces"></a>Operating system interfaces</h1><span id="more"></span><p>æ“ä½œç³»ç»Ÿçš„å·¥ä½œæ˜¯ï¼š</p><ol><li>åœ¨å¤šä¸ªç¨‹åºé—´å…±äº«ä¸€å°ç”µè„‘</li><li>æä¾›ä¸€å¥—æ¯”ç¡¬ä»¶æ›´æœ‰ç”¨çš„æœåŠ¡</li></ol><p>æ“ä½œç³»ç»Ÿï¼š</p><ol><li>ç®¡ç†å¹¶æŠ½è±¡åº•å±‚ç¡¬ä»¶</li><li>åœ¨å¤šä¸ªç¨‹åºé—´å…±äº«ç¡¬ä»¶</li><li>æä¾›ä¸€ç§å—æ§çš„ç¨‹åºäº¤äº’æ–¹å¼</li></ol><p>æ“ä½œç³»ç»Ÿæ˜¯é€šè¿‡æ¥å£æ¥å‘ç¨‹åºæä¾›æœåŠ¡çš„ã€‚</p><p>æ¯ä¸ªè¿›ç¨‹ï¼ˆè¿è¡Œä¸­çš„ç¨‹åºï¼‰ï¼Œéƒ½æœ‰æŒ‡ä»¤ã€æ•°æ®ã€æ ˆã€‚</p><p>è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ã€‚</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-1/image-20240924132438222.png"></p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-1/image-20240924132532714.png"></p><h2 id="1-1-Processes-and-memory"><a href="#1-1-Processes-and-memory" class="headerlink" title="1.1 Processes and memory"></a>1.1 Processes and memory</h2><p>è¿›ç¨‹ç”±ç”¨æˆ·ç©ºé—´çš„å†…å­˜ï¼ˆæŒ‡ä»¤ã€æ•°æ®ã€æ ˆï¼‰å’Œä¸€äº›çŠ¶æ€ç»„æˆã€‚xv6æ˜¯åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„PIDæ¥æ ‡è¯†ã€‚</p><p><strong><code>fork</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p><code>fork</code>ç³»ç»Ÿè°ƒç”¨å®Œå…¨å¤åˆ¶è°ƒç”¨è€…çš„å†…å­˜ç»™æ–°è¿›ç¨‹ï¼Œç„¶ååœ¨åŸè¿›ç¨‹å’Œæ–°è¿›ç¨‹ä¸­è¿”å›ï¼ŒåŸè¿›ç¨‹ä¸­è¿”å›å€¼ä¸ºæ–°è¿›ç¨‹çš„PIDï¼Œæ–°è¿›ç¨‹ä¸­çš„è¿”å›å€¼ä¸º0ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„å†…å­˜ç©ºé—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä»½è‡ªå·±çš„æ‹·è´ã€‚</p><p><strong><code>wait</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p><code>wait</code>ç³»ç»Ÿè°ƒç”¨è¿”å›å½“å‰è¿›ç¨‹çš„ä¸€ä¸ªé€€å‡ºçš„å­è¿›ç¨‹çš„PIDï¼Œå¹¶ä¸”å°†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€æ‹·è´åˆ°æŒ‡å®šå†…å­˜ä¸­ã€‚å¦‚æœæ²¡æœ‰é€€å‡ºçš„å­è¿›ç¨‹ï¼Œ<code>wait</code>é˜»å¡ç­‰å¾…ã€‚å¦‚æœå½“å‰è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼Œ<code>wait</code>ç«‹å³è¿”å›-1ã€‚å¦‚æœä¸å…³å¿ƒå­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ª0åœ°å€ã€‚</p><p><strong><code>exec</code>ç³»ç»Ÿè°ƒç”¨</strong></p><p><code>exec</code>ç³»ç»Ÿè°ƒç”¨è´Ÿè´£ç”¨å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½æ–°çš„å†…å­˜é•œåƒï¼Œæ›¿æ¢è°ƒç”¨è¿›ç¨‹çš„å†…å­˜ã€‚è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¿…é¡»éµå¾ªç‰¹å®šæ ¼å¼ï¼Œå®šä¹‰äº†æ–‡ä»¶çš„å„ä¸ªéƒ¨åˆ†ï¼Œä¾‹å¦‚å“ªäº›éƒ¨åˆ†åŒ…å«æŒ‡ä»¤å’Œæ•°æ®ï¼Œä»¥åŠä»å“ªä¸ªæŒ‡ä»¤å¼€å§‹æ‰§è¡Œã€‚åœ¨ xv6 ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ ELFï¼ˆå¯æ‰§è¡Œä¸å¯é“¾æ¥æ ¼å¼ï¼‰ï¼Œè¯¦è§ç¬¬ä¸‰ç« ã€‚</p><p>é€šå¸¸ï¼Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ˜¯é€šè¿‡ç¼–è¯‘ç¨‹åºæºä»£ç ç”Ÿæˆçš„ã€‚å½“ <code>exec</code> æˆåŠŸè°ƒç”¨æ—¶ï¼Œæ§åˆ¶æƒä¸ä¼šè¿”å›åˆ°åŸç¨‹åºï¼Œè€Œæ˜¯ä» ELF å¤´éƒ¨æŒ‡å®šçš„å…¥å£ç‚¹å¼€å§‹æ‰§è¡Œæ–°åŠ è½½çš„æŒ‡ä»¤ã€‚<code>exec</code> éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°å’Œä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼ŒåŒ…å«ä¼ é€’ç»™æ–°è¿›ç¨‹çš„å‚æ•°ã€‚å¤§å¤šæ•°ç¨‹åºé€šå¸¸ä¼šå¿½ç•¥æ‰å­—ç¬¦ä¸²æ•°ç»„çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æ˜¯ç¨‹åºçš„åå­—ã€‚</p><p><strong>ä¸ºä»€ä¹ˆ <code>fork</code> å’Œ <code>exec</code> æ˜¯åˆ†ç¦»çš„</strong></p><p>æ“ä½œç³»ç»Ÿåˆ©ç”¨è¿™ç§åˆ†ç¦»æœºåˆ¶å®ç°IOé‡å®šå‘ã€‚åŒæ—¶ï¼Œä¸ºäº†é¿å…åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ç„¶åé©¬ä¸Šè°ƒç”¨ <code>exec</code> è°ƒæ¢æ‰å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡è™šæ‹Ÿå†…å­˜çš„ä¸€äº›æŠ€å·§æ¥ä¼˜åŒ–ï¼Œä¾‹å¦‚copy on writeã€‚</p><p><strong>ç”³è¯·å†…å­˜</strong></p><p>xv6å¤§å¤šæ•°æ—¶å€™éšå¼ç”³è¯·ç”¨æˆ·ç©ºé—´çš„å†…å­˜ï¼Œä½†æ˜¯è¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ <code>sbrk(n)</code> æ¥ç”³è¯·æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè¯¥å‡½æ•°è¿”å›ç”³è¯·å†…å­˜çš„èµ·å§‹åœ°å€ã€‚</p><h2 id="1-2-I-O-and-File-descriptors"><a href="#1-2-I-O-and-File-descriptors" class="headerlink" title="1.2 I&#x2F;O and File descriptors"></a>1.2 I&#x2F;O and File descriptors</h2><p>æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨ç€ä¸€ä¸ªå†…æ ¸ç®¡ç†çš„objectï¼Œè¿›ç¨‹å¯ä»¥ä»è¿™ä¸ªobjectè¯»ï¼Œæˆ–å‘è¿™ä¸ªobjectå†™ã€‚</p><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡</p><ol><li>æ‰“å¼€æ–‡ä»¶ã€ç›®å½•ã€è®¾åˆ«</li><li>åˆ›å»ºç®¡é“ï¼›</li><li>duplicatingä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</li></ol><p>æ¥è·å¾—æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>æ–‡ä»¶æè¿°ç¬¦è¿™ç§æŠ½è±¡ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¸ç”¨å…³æ³¨æ–‡ä»¶çš„ç§ç±»ï¼Œæ— è®ºæ˜¯æ–‡ä»¶ã€ç®¡é“ã€è®¾å¤‡ï¼Œæˆ‘ä»¬éƒ½å°†ä»–ä»¬è§†ä¸ºå­—èŠ‚æµæ¥å¤„ç†ã€‚</p><p>å†…éƒ¨ï¼Œxv6å†…æ ¸å°†æ–‡ä»¶æè¿°ç¬¦ç”¨ä½œæ¯ä¸ªè¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶è¡¨çš„ç´¢å¼•ã€‚é€šå¸¸ï¼Œä¸€ä¸ªè¿›ç¨‹ä»æ–‡ä»¶æè¿°ç¬¦0è¯»å–è¾“å…¥ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ï¼Œå‘æ–‡ä»¶æè¿°ç¬¦1è¾“å‡ºï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ï¼Œå°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶æè¿°ç¬¦2ï¼ˆæ ‡å‡†é”™è¯¯ï¼‰ã€‚</p><p><strong><code>read(fd, buf, n)</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨ä»fdæŒ‡å‘çš„objectè¯»å–è‡³å¤šnä¸ªå­—èŠ‚ï¼Œæ‹·è´åˆ°bufå†…ï¼Œå¹¶è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚</p><p>æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½æœ‰ä¸€ä¸ªå…³è”çš„åç§»é‡ï¼Œ<code>read</code> ä¼šæ›´æ–°è¿™ä¸ªåç§»é‡ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªæœªè¢«è¯»å–çš„å­—èŠ‚ã€‚</p><p>å½“æ²¡æœ‰æ›´å¤šçš„å­—èŠ‚å¯è¯»æ—¶ï¼Œ<code>read</code> ä¼šè¿”å›0ã€‚</p><p> <strong><code>write(fd, buf, n)</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨å‘fdå†™nä¸ªå­—èŠ‚ï¼Œè¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°ã€‚åªæœ‰å½“é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼Œå®é™…å†™å…¥çš„å­—èŠ‚æ•°æ‰ä¸ç­‰äºnã€‚</p><p> <strong><code>close(fd)</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨é‡Šæ”¾ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿ä¹‹å¯ä»¥ä¸ºä¹‹åçš„æ–‡ä»¶ä½¿ç”¨ã€‚</p><p>ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦æ€»æ˜¯å½“å‰è¿›ç¨‹ä¸­æœ€å°çš„æœªä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p> <strong><code>fork</code> å’Œæ–‡ä»¶æè¿°ç¬¦</strong></p><p><code>fork</code> ä¼šå°†çˆ¶è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶è¡¨å¤åˆ¶ç»™å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶æ˜¯ä¸€æ ·çš„ã€‚</p><p><code>exec</code>  ä¼šæ›¿æ¢è°ƒç”¨è¿›ç¨‹çš„å†…å­˜ï¼Œä½†æ˜¯ä¼šä¿ç•™æ‰“å¼€æ–‡ä»¶è¡¨ã€‚</p><p>è¿™ç§è¡Œä¸ºä½¿å¾—shellå¯ä»¥ç®€å•çš„å®ç°IOé‡å®šå‘ã€‚</p><p> <code>cat &lt; input.txt</code> çš„ç®€å•å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> *argv[<span class="hljs-number">2</span>];<br>argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;cat&quot;</span>;<br>argv[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (fork() == <span class="hljs-number">0</span>)<br>&#123;<br>    <span class="hljs-comment">// child</span><br>    close(<span class="hljs-number">0</span>);<br>    open(<span class="hljs-string">&quot;input.txt&quot;</span>, O_RDONLY);<br>    exec(<span class="hljs-string">&quot;/bin/cat&quot;</span>, argv);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³é”®ç‚¹æ˜¯å­è¿›ç¨‹å…ˆå…³é—­äº†æ–‡ä»¶æè¿°ç¬¦0ï¼Œç„¶åå†æ‰“å¼€input.txtï¼Œè¿™æ˜¯æ“ä½œç³»ç»Ÿä¼šå°†æ–‡ä»¶æè¿°ç¬¦0åˆ†é…ç»™è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦å¹¶ä¸ä¼šè¢«æ”¹å˜ï¼Œå› ä¸ºå­è¿›ç¨‹æœ‰ä¸€å¼ è‡ªå·±çš„æ‰“å¼€æ–‡ä»¶è¡¨ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶forkä¼šå¤åˆ¶æ‰“å¼€æ–‡ä»¶è¡¨ï¼Œä½†æ˜¯æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦å…³è”çš„åç§»åœ¨çˆ¶å­è¿›ç¨‹é—´æ˜¯å…±äº«çš„ã€‚</p><p> <strong><code>open</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›ç›¸åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯(kerenl&#x2F;fcntl.h)ï¼š</p><ul><li>O_RDONLY</li><li>O_WRONLY</li><li>O_RDWR</li><li>O_CREATE</li><li>O_TRUNC</li></ul><p> <strong><code>dup(fd)</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘ç›¸åŒobjectçš„æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å…±äº«åç§»ï¼Œç±»ä¼¼forkã€‚</p><blockquote><p>Two file descriptors share an offset if they were derived from the same original file descriptor by a sequence of fork and dup calls. Otherwise file descriptors do not share offsets, even if they resulted from open calls for the same file</p></blockquote><p>é€šè¿‡ <code>fork</code> å’Œ <code>dup</code> è·å¾—çš„æ–‡ä»¶æè¿°ç¬¦å’Œéƒ½å…±äº«ç›¸åŒçš„åç§»ã€‚</p><h2 id="1-3-Pipes"><a href="#1-3-Pipes" class="headerlink" title="1.3 Pipes"></a>1.3 Pipes</h2><p>ç®¡é“æ˜¯å†…æ ¸ä¸­çš„ä¸€ä¸ªå°ç¼“å†²åŒºï¼Œé€šè¿‡ä¸€å¯¹æ–‡ä»¶æè¿°ç¬¦æš´éœ²ç»™è¿›ç¨‹ã€‚è¿™æ˜¯è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚</p><p> <strong><code>pipe</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡é“ï¼Œå¹¶å°†ä¸€å¯¹æ–‡ä»¶æè¿°ç¬¦æ”¾åˆ°å‚æ•°æŒ‡å®šçš„æ•´æ•°æ•°ç»„ä¸­ã€‚</p><p>å¦‚æœæ²¡æœ‰å¯è¯»æ•°æ®ï¼Œè¯»ä¸€ä¸ªç®¡é“å¯èƒ½ä¼šï¼š</p><ul><li>é˜»å¡ç›´åˆ°æ•°æ®åˆ°æ¥</li><li>é˜»å¡ç›´åˆ°æ‰€æœ‰å¯¹ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦è¢«å…³é—­</li></ul><p>ç¬¬äºŒç§æƒ…å†µä¼šè¿”å›0ã€‚</p><p>ç®¡é“ç›¸è¾ƒä¸´æ—¶æ–‡ä»¶çš„ä¼˜åŠ¿ï¼š</p><ol><li>ç®¡é“ä¼šè‡ªåŠ¨æ¸…ç†</li><li>ç®¡é“å¯ä»¥å¤„ç†ä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œè€Œä¸´æ—¶æ–‡ä»¶å¿…é¡»è¦æ±‚ç¡¬ç›˜æœ‰è¶³å¤Ÿçš„ç©ºé—´</li><li>ç®¡é“å…è®¸ç®¡é“çš„ä¸åŒé˜¶æ®µå¹¶è¡Œæ‰§è¡Œ</li></ol><h2 id="1-4-File-system"><a href="#1-4-File-system" class="headerlink" title="1.4 File system"></a>1.4 File system</h2><p>xv6æ–‡ä»¶ç³»ç»Ÿæä¾›æ•°æ®æ–‡ä»¶ï¼ŒåŒ…å«å­—èŠ‚æµï¼›æä¾›ç›®å½•ï¼ŒåŒ…å«æŒ‡å‘æ•°æ®æ–‡ä»¶å’Œå…¶ä»–ç›®å½•æ–‡ä»¶çš„å¼•ç”¨ã€‚</p><p>ç›®å½•ä»¥æ ‘çš„å½¢å¼ç»„ç»‡ï¼Œä»¥&#x2F;å¼€å§‹çš„è·¯å¾„ä»¥æ ¹ç›®å½•ä¸ºæ ¹ï¼Œä¸ä»¥&#x2F;å¼€å§‹çš„è·¯å¾„ä»¥å½“å‰è¿›ç¨‹å½“å‰çš„å·¥ä½œç›®å½•ä¸ºæ ¹ï¼ˆå¯ä»¥é€šè¿‡<code>chdir</code>ç³»ç»Ÿè°ƒç”¨æ¥æ”¹å˜ï¼‰ã€‚</p><p><code>mkdir</code> ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ï¼Œ<code>open</code> ç³»ç»Ÿè°ƒç”¨é€šè¿‡æŒ‡å®š <code>O_CREATE</code> é€‰é¡¹æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®æ–‡ä»¶ï¼Œ <code>mknode</code> ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„è®¾å¤‡æ–‡ä»¶ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨é€šè¿‡ä¸¤ä¸ªå‚æ•°æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå†…æ ¸è®¾å¤‡ï¼ˆä¸»ã€å‰¯è®¾å¤‡å·ï¼‰ã€‚</p><p>æ–‡ä»¶åå’Œæ–‡ä»¶æœ¬èº«æ˜¯ä¸åŒçš„ã€‚åŒä¸€ä¸ªæ–‡ä»¶ç”±ä¸€ä¸ªå”¯ä¸€çš„inodeæ¥æ ‡è¯†ï¼›åŒä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶åï¼Œå³é“¾æ¥ã€‚</p><p>æ¯ä¸ªé“¾æ¥ç”±ä¸€ä¸ªç›®å½•ä¸­çš„ç›®å½•é¡¹ç»„æˆï¼Œè¿™ä¸ªç›®å½•é¡¹åŒ…å«ä¸€ä¸ªæ–‡ä»¶åä»¥åŠä¸€ä¸ªæŒ‡å‘æ–‡ä»¶inodeçš„æŒ‡é’ˆã€‚</p><p>æ¯ä¸ªinodeä¿å­˜ç€æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ç§ç±»ï¼Œé•¿åº¦ï¼Œç£ç›˜ä½ç½®ï¼Œä»¥åŠé“¾æ¥æ•°ç­‰ã€‚</p><p> <strong><code>fstat</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨ä»inodeä¸­è·å–æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¹¶å°†æ•°æ®å¡«å…¥ <code>stat</code> ç»“æ„ä½“ä¸­ã€‚ï¼ˆkernel&#x2F;stat.hï¼‰</p><p><img src="/../images/MIT-6-1810-Xv6-Chapter-1/image-20240924153124059.png"></p><p> <strong><code>link</code> ç³»ç»Ÿè°ƒç”¨</strong></p><p>è¯¥ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªé“¾æ¥ã€‚è¯»å†™è¯¥é“¾æ¥å’Œè¯»å†™åŸæ–‡ä»¶æ“ä½œçš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚</p><p> <code>unlink</code> ç³»ç»Ÿè°ƒç”¨</p><p>è¯¥ç³»ç»Ÿè°ƒç”¨åˆ é™¤ä¸€ä¸ªé“¾æ¥ã€‚åªæœ‰å½“æŒ‡å‘åŒä¸€ä¸ªinodeçš„æ‰€æœ‰é“¾æ¥éƒ½è¢«åˆ é™¤çš„æ—¶å€™ï¼Œæ‰ä¼šçœŸæ­£é‡Šæ”¾inodeå’Œæ–‡ä»¶å†…å®¹ã€‚</p><p>ä¸€ç§çº¦å®šä¿—ç§°çš„åˆ›å»ºä¸€ä¸ªä¸´æ—¶inodeæ–¹æ³•:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">fd = open(<span class="hljs-string">&quot;/tmp/xyz&quot;</span>, O_CREATE | O_RDWR);<br>unlink(<span class="hljs-string">&quot;/tmp/xyz&quot;</span>);<br></code></pre></td></tr></table></figure><p>å½“è¿›ç¨‹è°ƒç”¨closeæˆ–è€…é€€å‡ºåï¼Œè¿™ä¸ªinodeä¼šè¢«è‡ªåŠ¨æ¸…ç†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++] è¿”å›å€¼ä¼˜åŒ–</title>
    <link href="/2024/09/22/C-%E8%BF%94%E5%9B%9E%E5%80%BC%E4%BC%98%E5%8C%96/"/>
    <url>/2024/09/22/C-%E8%BF%94%E5%9B%9E%E5%80%BC%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯è¿”å›å€¼ä¼˜åŒ–ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯è¿”å›å€¼ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿”å›å€¼ä¼˜åŒ–ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯è¿”å›å€¼ä¼˜åŒ–ï¼Ÿ</h3><p><strong>è¿”å›å€¼ä¼˜åŒ–</strong>ï¼ˆReturn Value Optimization, RVOï¼‰æ˜¯C++ç¼–è¯‘å™¨çš„ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºå‡å°‘ä¸å¿…è¦çš„å¯¹è±¡æ‹·è´ï¼Œç‰¹åˆ«æ˜¯åœ¨å‡½æ•°è¿”å›ä¸´æ—¶å¯¹è±¡çš„åœºæ™¯ä¸­ã€‚RVO å¯ä»¥æ˜¾è‘—æé«˜ç¨‹åºæ€§èƒ½ï¼Œå¹¶å‡å°‘ä¸´æ—¶å¯¹è±¡çš„ç”Ÿæˆå’Œææ„æ“ä½œã€‚</p><span id="more"></span><p>åœ¨C++ä¸­ï¼Œå‡½æ•°è¿”å›å€¼é€šå¸¸ä¼šæ¶‰åŠä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ã€‚ä¾‹å¦‚ï¼Œå½“å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œé€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡æ¥å­˜å‚¨è¿”å›å€¼ï¼Œç„¶åå°†å…¶æ‹·è´åˆ°æ¥æ”¶è¿”å›å€¼çš„å˜é‡ä¸­ã€‚è¿”å›å€¼ä¼˜åŒ–ï¼ˆRVOï¼‰æ˜¯ç¼–è¯‘å™¨çš„ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒé¿å…äº†è¿™äº›ä¸´æ—¶å¯¹è±¡çš„æ‹·è´æ“ä½œã€‚</p><h3 id="RVOçš„å·¥ä½œæœºåˆ¶"><a href="#RVOçš„å·¥ä½œæœºåˆ¶" class="headerlink" title="RVOçš„å·¥ä½œæœºåˆ¶"></a>RVOçš„å·¥ä½œæœºåˆ¶</h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹æ¶‰åŠä¸¤æ­¥ï¼š</p><ol><li>åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯å‡½æ•°å†…çš„å±€éƒ¨å¯¹è±¡ï¼‰ã€‚</li><li>å°†è¿™ä¸ªä¸´æ—¶å¯¹è±¡æ‹·è´æˆ–ç§»åŠ¨åˆ°è°ƒç”¨è€…æä¾›çš„ç›®æ ‡ä½ç½®ã€‚</li></ol><p><strong>RVO</strong>é€šè¿‡ç›´æ¥åœ¨ç›®æ ‡ä½ç½®æ„é€ è¿”å›çš„å¯¹è±¡ï¼Œè·³è¿‡äº†ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºï¼Œä»è€Œé¿å…äº†æ‹·è´æˆ–ç§»åŠ¨æ“ä½œã€‚</p><h3 id="ä¾‹å­ï¼ˆæ— RVO-vs-æœ‰RVOï¼‰"><a href="#ä¾‹å­ï¼ˆæ— RVO-vs-æœ‰RVOï¼‰" class="headerlink" title="ä¾‹å­ï¼ˆæ— RVO vs. æœ‰RVOï¼‰"></a>ä¾‹å­ï¼ˆæ— RVO vs. æœ‰RVOï¼‰</h3><h4 id="æ²¡æœ‰RVOæ—¶ï¼š"><a href="#æ²¡æœ‰RVOæ—¶ï¼š" class="headerlink" title="æ²¡æœ‰RVOæ—¶ï¼š"></a>æ²¡æœ‰RVOæ—¶ï¼š</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">MyClass</span>() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;Constructor&quot;</span> &lt;&lt; std::endl; &#125;<br>    <span class="hljs-built_in">MyClass</span>(<span class="hljs-type">const</span> MyClass&amp;) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;Copy Constructor&quot;</span> &lt;&lt; std::endl; &#125;<br>    ~<span class="hljs-built_in">MyClass</span>() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;Destructor&quot;</span> &lt;&lt; std::endl; &#125;<br>&#125;;<br><br><span class="hljs-function">MyClass <span class="hljs-title">createObject</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass obj;<br>    <span class="hljs-keyword">return</span> obj;  <span class="hljs-comment">// è¿”å›å±€éƒ¨å¯¹è±¡ï¼Œä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass newObj = <span class="hljs-built_in">createObject</span>();  <span class="hljs-comment">// æ¥æ”¶è¿”å›å€¼ï¼Œä¼šå†æ¬¡æ‹·è´</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>createObject()</code>å‡½æ•°è¿”å›ä¸€ä¸ªå±€éƒ¨å¯¹è±¡ <code>obj</code>ï¼Œåœ¨æ²¡æœ‰RVOçš„æƒ…å†µä¸‹ï¼š</p><ol><li>é¦–å…ˆæ„é€ å±€éƒ¨å¯¹è±¡ <code>obj</code>ã€‚</li><li>ç„¶åè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°å°† <code>obj</code>æ‹·è´åˆ°ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼ˆç”¨æ¥ä¿å­˜è¿”å›å€¼ï¼‰ã€‚</li><li>æœ€åå°†è¿™ä¸ªä¸´æ—¶å¯¹è±¡æ‹·è´åˆ° <code>newObj</code>ä¸­ã€‚</li></ol><p>å› æ­¤ï¼Œä¼šæ¶‰åŠä¸¤æ¬¡æ‹·è´æ„é€ è°ƒç”¨ï¼Œè¿™æ ·çš„æ‹·è´æ˜¯æ€§èƒ½ä¸Šçš„æµªè´¹ã€‚</p><h4 id="æœ‰RVOæ—¶ï¼š"><a href="#æœ‰RVOæ—¶ï¼š" class="headerlink" title="æœ‰RVOæ—¶ï¼š"></a>æœ‰RVOæ—¶ï¼š</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">MyClass <span class="hljs-title">createObject</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass obj;<br>    <span class="hljs-keyword">return</span> obj;  <span class="hljs-comment">// RVOä¼˜åŒ–ï¼Œç›´æ¥åœ¨è¿”å›ä½ç½®æ„é€ </span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    MyClass newObj = <span class="hljs-built_in">createObject</span>();  <span class="hljs-comment">// ç›´æ¥åœ¨newObjä¸Šæ„é€ å¯¹è±¡ï¼Œæ— éœ€æ‹·è´</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å¯ç”¨RVOçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šè·³è¿‡ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºï¼Œç›´æ¥åœ¨ <code>newObj</code>çš„å†…å­˜ä½ç½®ä¸Šæ„é€  <code>obj</code>ï¼Œé¿å…äº†ä¸å¿…è¦çš„æ‹·è´æ“ä½œã€‚</p><h3 id="RVOçš„ç±»å‹"><a href="#RVOçš„ç±»å‹" class="headerlink" title="RVOçš„ç±»å‹"></a>RVOçš„ç±»å‹</h3><ol><li><strong>å‘½åè¿”å›å€¼ä¼˜åŒ–ï¼ˆNamed Return Value Optimization, NRVOï¼‰</strong>ï¼šNRVOæ˜¯RVOçš„ä¸€ç§å½¢å¼ï¼Œå‘ç”Ÿåœ¨è¿”å›å€¼æ˜¯å‘½åçš„å±€éƒ¨å˜é‡æ—¶ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå‘½åçš„å±€éƒ¨å¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥åœ¨è°ƒç”¨è€…çš„å†…å­˜ç©ºé—´ä¸­æ„é€ è¯¥å¯¹è±¡ï¼Œè€Œä¸æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡ã€‚</li><li><strong>æ ‡å‡†RVO</strong>ï¼šæ ‡å‡†RVOå‘ç”Ÿåœ¨è¿”å›ä¸€ä¸ªæœªå‘½åçš„ä¸´æ—¶å¯¹è±¡æ—¶ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªä¸´æ—¶æ„é€ çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å±€éƒ¨å˜é‡ã€‚è¿™ç§ä¼˜åŒ–åœ¨C++17åæ˜¯å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œä¸å†ä¾èµ–äºç¼–è¯‘å™¨æ˜¯å¦é€‰æ‹©è¿›è¡Œä¼˜åŒ–ã€‚</li></ol><h3 id="C-17-ä¸­çš„å¼ºåˆ¶RVO"><a href="#C-17-ä¸­çš„å¼ºåˆ¶RVO" class="headerlink" title="C++17 ä¸­çš„å¼ºåˆ¶RVO"></a>C++17 ä¸­çš„å¼ºåˆ¶RVO</h3><p>ä»C++17å¼€å§‹ï¼Œæ ‡å‡†RVOæˆä¸ºå¼ºåˆ¶è¡Œä¸ºï¼Œç¼–è¯‘å™¨å¿…é¡»æ‰§è¡Œè¿”å›å€¼ä¼˜åŒ–ï¼Œä¸å†éœ€è¦æ‹·è´æˆ–ç§»åŠ¨ä¸´æ—¶å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">MyClass <span class="hljs-title">createObject</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">MyClass</span>();  <span class="hljs-comment">// C++17ä¸­ï¼Œç›´æ¥åœ¨è¿”å›ä½ç½®æ„é€ å¯¹è±¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨C++17ä¹‹å‰ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šé€‰æ‹©ä¸è¿›è¡Œä¼˜åŒ–ï¼Œä½†ä»C++17å¼€å§‹ï¼Œç¼–è¯‘å™¨å¿…é¡»ç›´æ¥åœ¨ç›®æ ‡ä½ç½®æ„é€ è¿”å›çš„å¯¹è±¡ï¼Œä»è€Œå®Œå…¨æ¶ˆé™¤äº†ä¸´æ—¶å¯¹è±¡å’Œæ‹·è´æ„é€ çš„å¼€é”€ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><strong>RVO</strong>ï¼ˆè¿”å›å€¼ä¼˜åŒ–ï¼‰æ˜¯ä¸€ç§ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥åœ¨å‡½æ•°è¿”å›å¯¹è±¡æ—¶é¿å…ä¸å¿…è¦çš„ä¸´æ—¶å¯¹è±¡æ‹·è´ã€‚</li><li><strong>NRVO</strong>ï¼ˆå‘½åè¿”å›å€¼ä¼˜åŒ–ï¼‰æ˜¯RVOçš„ä¸€ç§å½¢å¼ï¼Œåº”ç”¨äºè¿”å›å‘½åçš„å±€éƒ¨å˜é‡ã€‚</li><li><strong>C++17</strong>ä¸­å¼ºåˆ¶æ‰§è¡Œäº†RVOï¼Œç¼–è¯‘å™¨å¿…é¡»ä¼˜åŒ–è¿”å›ä¸´æ—¶å¯¹è±¡çš„åœºæ™¯ï¼Œè¿›ä¸€æ­¥æé«˜äº†ç¨‹åºæ•ˆç‡ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 14</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-14/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-14/</url>
    
    <content type="html"><![CDATA[<h1 id="é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢"><a href="#é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢" class="headerlink" title="é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢"></a>é‡è½½è¿ç®—ä¸ç±»å‹è½¬æ¢</h1><span id="more"></span><h2 id="14-1-åŸºæœ¬æ¦‚å¿µ"><a href="#14-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="14.1 åŸºæœ¬æ¦‚å¿µ"></a>14.1 åŸºæœ¬æ¦‚å¿µ</h2><p>é‡è½½çš„è¿ç®—ç¬¦æ˜¯å…·æœ‰ç‰¹æ®Šåå­—çš„å‡½æ•°ï¼šå®ƒä»¬çš„åå­—ç”±å…³é”®å­—operatorå’Œå…¶åè¦å®šä¹‰çš„è¿ç®—ç¬¦å·å…±åŒç»„æˆã€‚</p><p>é™¤äº†é‡è½½çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦operatorï¼ˆï¼‰ä¹‹å¤–ï¼Œå…¶ä»–é‡è½½è¿ç®—ç¬¦ä¸èƒ½å«æœ‰é»˜è®¤å®å‚ï¼ˆå‚è§6.5.1èŠ‚ï¼Œç¬¬211é¡µï¼‰ã€‚</p><p>å¦‚æœä¸€ä¸ªè¿ç®—ç¬¦å‡½æ•°æ˜¯æˆå‘˜å‡½æ•°ï¼Œåˆ™å®ƒçš„ç¬¬ä¸€ä¸ªï¼ˆå·¦ä¾§ï¼‰è¿ç®—å¯¹è±¡ç»‘å®šåˆ°éšå¼çš„thisæŒ‡é’ˆä¸Šï¼ˆå‚è§7.1.2èŠ‚ï¼Œç¬¬231é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240928234553638.png"></p><p><strong>ç›´æ¥è°ƒç”¨ä¸€ä¸ªé‡è½½çš„è¿ç®—ç¬¦å‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240928234624906.png"></p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240928234642641.png"></p><p><strong>æŸäº›è¿ç®—ç¬¦ä¸åº”è¯¥è¢«é‡è½½</strong></p><div class="note note-primary">            <p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸åº”è¯¥é‡è½½é€—å·ã€å–åœ°å€ã€é€»è¾‘ä¸å’Œé€»è¾‘æˆ–è¿ç®—ç¬¦ã€‚</p>          </div><p>æŸäº›è¿ç®—ç¬¦æŒ‡å®šäº†è¿ç®—å¯¹è±¡æ±‚å€¼çš„é¡ºåºã€‚å› ä¸ºä½¿ç”¨é‡è½½çš„è¿ç®—ç¬¦æœ¬è´¨ä¸Šæ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ï¼Œæ‰€ä»¥è¿™äº›å…³äºè¿ç®—å¯¹è±¡æ±‚å€¼é¡ºåºçš„è§„åˆ™æ— æ³•åº”ç”¨åˆ°é‡è½½çš„è¿ç®—ç¬¦ä¸Šã€‚ç‰¹åˆ«æ˜¯ï¼Œ</p><ul><li>é€»è¾‘ä¸è¿ç®—ç¬¦</li><li>é€»è¾‘æˆ–è¿ç®—ç¬¦ï¼ˆå‚è§4.3èŠ‚ï¼Œç¬¬126é¡µï¼‰</li><li>é€—å·è¿ç®—ç¬¦ï¼ˆå‚è§4.10èŠ‚ï¼Œç¬¬140é¡µï¼‰</li></ul><p>çš„è¿ç®—å¯¹è±¡æ±‚å€¼é¡ºåºè§„åˆ™æ— æ³•ä¿ç•™ä¸‹æ¥ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ&amp;&amp;å’Œ||è¿ç®—ç¬¦çš„é‡è½½ç‰ˆæœ¬ä¹Ÿæ— æ³•ä¿ç•™å†…ç½®è¿ç®—ç¬¦çš„çŸ­è·¯æ±‚å€¼å±æ€§ï¼Œä¸¤ä¸ªè¿ç®—å¯¹è±¡æ€»æ˜¯ä¼šè¢«æ±‚å€¼ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªåŸå› ä½¿å¾—æˆ‘ä»¬ä¸€èˆ¬ä¸é‡è½½é€—å·è¿ç®—ç¬¦å’Œå–åœ°å€è¿ç®—ç¬¦ï¼šC++è¯­è¨€å·²ç»å®šä¹‰äº†è¿™ä¸¤ç§è¿ç®—ç¬¦ç”¨äºç±»ç±»å‹å¯¹è±¡æ—¶çš„ç‰¹æ®Šå«ä¹‰ï¼Œè¿™ä¸€ç‚¹ä¸å¤§å¤šæ•°è¿ç®—ç¬¦éƒ½ä¸ç›¸åŒã€‚</p><p><strong>ä½¿ç”¨ä¸å†…ç½®ç±»å‹ä¸€è‡´çš„å«ä¹‰</strong></p><ul><li>å¦‚æœç±»æ‰§è¡ŒIOæ“ä½œï¼Œåˆ™å®šä¹‰ç§»ä½è¿ç®—ç¬¦ä½¿å…¶ä¸å†…ç½®ç±»å‹çš„IOä¿æŒä¸€è‡´ã€‚</li><li>å¦‚æœç±»çš„æŸä¸ªæ“ä½œæ˜¯æ£€æŸ¥ç›¸ç­‰æ€§ï¼Œåˆ™å®šä¹‰operator&#x3D;&#x3D;ï¼›å¦‚æœç±»æœ‰äº†operator&#x3D;&#x3D;ï¼Œæ„å‘³ç€å®ƒé€šå¸¸ä¹Ÿåº”è¯¥æœ‰operatorï¼&#x3D;ã€‚</li><li>å¦‚æœç±»åŒ…å«ä¸€ä¸ªå†…åœ¨çš„å•åºæ¯”è¾ƒæ“ä½œï¼Œåˆ™å®šä¹‰operator&lt;ï¼›å¦‚æœç±»æœ‰äº†operator&lt;ï¼Œåˆ™å®ƒä¹Ÿåº”è¯¥å«æœ‰å…¶ä»–å…³ç³»æ“ä½œã€‚</li><li>é‡è½½è¿ç®—ç¬¦çš„è¿”å›ç±»å‹é€šå¸¸æƒ…å†µä¸‹åº”è¯¥ä¸å…¶å†…ç½®ç‰ˆæœ¬çš„è¿”å›ç±»å‹å…¼å®¹ï¼šé€»è¾‘è¿ç®—ç¬¦å’Œå…³ç³»è¿ç®—ç¬¦åº”è¯¥è¿”å›boolï¼Œç®—æœ¯è¿ç®—ç¬¦åº”è¯¥è¿”å›ä¸€ä¸ªç±»ç±»å‹çš„å€¼ï¼Œèµ‹å€¼è¿ç®—ç¬¦å’Œå¤åˆèµ‹å€¼è¿ç®—ç¬¦åˆ™åº”è¯¥è¿”å›å·¦ä¾§è¿ç®—å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚</li></ul><p><strong>èµ‹å€¼å’Œå¤åˆèµ‹å€¼è¿ç®—ç¬¦</strong></p><p>èµ‹å€¼è¿ç®—ç¬¦çš„è¡Œä¸ºä¸å¤åˆç‰ˆæœ¬çš„ç±»ä¼¼ï¼šèµ‹å€¼ä¹‹åï¼Œå·¦ä¾§è¿ç®—å¯¹è±¡å’Œå³ä¾§è¿ç®—å¯¹è±¡çš„å€¼ç›¸ç­‰ï¼Œå¹¶ä¸”è¿ç®—ç¬¦åº”è¯¥è¿”å›å®ƒå·¦ä¾§è¿ç®—å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚</p><p><strong>é€‰æ‹©ä½œä¸ºæˆå‘˜æˆ–è€…éæˆå‘˜</strong></p><ul><li>èµ‹å€¼ï¼ˆ&#x3D;ï¼‰ã€ä¸‹æ ‡ï¼ˆ[ ]ï¼‰ã€è°ƒç”¨ï¼ˆï¼ˆ ï¼‰ï¼‰å’Œæˆå‘˜è®¿é—®ç®­å¤´ï¼ˆ-&gt;ï¼‰è¿ç®—ç¬¦å¿…é¡»æ˜¯æˆå‘˜ã€‚</li><li>å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä¸€èˆ¬æ¥è¯´åº”è¯¥æ˜¯æˆå‘˜ï¼Œä½†å¹¶éå¿…é¡»ï¼Œè¿™ä¸€ç‚¹ä¸èµ‹å€¼è¿ç®—ç¬¦ç•¥æœ‰ä¸åŒã€‚</li><li>æ”¹å˜å¯¹è±¡çŠ¶æ€çš„è¿ç®—ç¬¦æˆ–è€…ä¸ç»™å®šç±»å‹å¯†åˆ‡ç›¸å…³çš„è¿ç®—ç¬¦ï¼Œå¦‚é€’å¢ã€é€’å‡å’Œè§£å¼•ç”¨è¿ç®—ç¬¦ï¼Œé€šå¸¸åº”è¯¥æ˜¯æˆå‘˜</li><li>å…·æœ‰å¯¹ç§°æ€§çš„è¿ç®—ç¬¦å¯èƒ½è½¬æ¢ä»»æ„ä¸€ç«¯çš„è¿ç®—å¯¹è±¡ï¼Œä¾‹å¦‚ç®—æœ¯ã€ç›¸ç­‰æ€§ã€å…³ç³»å’Œä½è¿ç®—ç¬¦ç­‰ï¼Œå› æ­¤å®ƒä»¬é€šå¸¸åº”è¯¥æ˜¯æ™®é€šçš„éæˆå‘˜å‡½æ•°ã€‚</li></ul><h2 id="14-2-è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦"><a href="#14-2-è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦" class="headerlink" title="14.2 è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦"></a>14.2 è¾“å…¥å’Œè¾“å‡ºè¿ç®—ç¬¦</h2><h3 id="14-2-1-é‡è½½è¾“å‡ºè¿ç®—ç¬¦"><a href="#14-2-1-é‡è½½è¾“å‡ºè¿ç®—ç¬¦" class="headerlink" title="14.2.1 é‡è½½è¾“å‡ºè¿ç®—ç¬¦&lt;&lt;"></a>14.2.1 é‡è½½è¾“å‡ºè¿ç®—ç¬¦&lt;&lt;</h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå½¢å‚ï¼šéå¸¸é‡ <code>ostream</code> çš„å¼•ç”¨</li><li>ç¬¬äºŒä¸ªå½¢å‚ï¼šå¸¸é‡ç±»ç±»å‹çš„å¼•ç”¨</li><li>è¿”å›å€¼ï¼šè¿”å›ç¬¬ä¸€ä¸ª <code>ostream</code> çš„å½¢å‚çš„å¼•ç”¨</li></ul><p><strong>è¾“å‡ºè¿ç®—ç¬¦å°½é‡å‡å°‘æ ¼å¼åŒ–æ“ä½œ</strong></p><p><strong>è¾“å…¥è¾“å‡ºè¿ç®—ç¬¦å¿…é¡»æ˜¯éæˆå‘˜å‡½æ•°</strong></p><p>IOè¿ç®—ç¬¦é€šå¸¸éœ€è¦è¯»å†™ç±»çš„éå…¬æœ‰æ•°æ®æˆå‘˜ï¼Œæ‰€ä»¥IOè¿ç®—ç¬¦ä¸€èˆ¬è¢«å£°æ˜ä¸º<strong>å‹å…ƒ</strong>ï¼ˆå‚è§7.2.1èŠ‚ï¼Œç¬¬241é¡µï¼‰ã€‚</p><h3 id="14-2-2-é‡è½½è¾“å…¥è¿ç®—ç¬¦"><a href="#14-2-2-é‡è½½è¾“å…¥è¿ç®—ç¬¦" class="headerlink" title="14.2.2 é‡è½½è¾“å…¥è¿ç®—ç¬¦&gt;&gt;"></a>14.2.2 é‡è½½è¾“å…¥è¿ç®—ç¬¦&gt;&gt;</h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå½¢å‚ï¼šå°†è¦è¯»å–çš„æµçš„å¼•ç”¨</li><li>ç¬¬äºŒä¸ªå½¢å‚ï¼šå°†è¦è¯»å…¥åˆ°çš„å¯¹è±¡çš„å¼•ç”¨</li><li>è¿”å›å€¼ï¼šè¿”å›ç¬¬ä¸€ä¸ªå½¢å‚çš„å¼•ç”¨</li></ul><div class="note note-primary">            <p>è¾“å…¥è¿ç®—ç¬¦å¿…é¡»å¤„ç†è¾“å…¥å¯èƒ½å¤±è´¥çš„æƒ…å†µï¼Œè€Œè¾“å‡ºè¿ç®—ç¬¦ä¸éœ€è¦ã€‚</p>          </div><p><strong>è¾“å…¥æ—¶çš„é”™è¯¯</strong></p><ul><li>å½“æµå«æœ‰é”™è¯¯ç±»å‹çš„æ•°æ®æ—¶è¯»å–æ“ä½œå¯èƒ½å¤±è´¥ã€‚ä¾‹å¦‚åœ¨è¯»å–å®ŒbookNoåï¼Œè¾“å…¥è¿ç®—ç¬¦å‡å®šæ¥ä¸‹æ¥è¯»å…¥çš„æ˜¯ä¸¤ä¸ªæ•°å­—æ•°æ®ï¼Œä¸€æ—¦è¾“å…¥çš„ä¸æ˜¯æ•°å­—æ•°æ®ï¼Œåˆ™è¯»å–æ“ä½œåŠåç»­å¯¹æµçš„å…¶ä»–ä½¿ç”¨éƒ½å°†å¤±è´¥ã€‚</li><li>å½“è¯»å–æ“ä½œåˆ°è¾¾æ–‡ä»¶æœ«å°¾æˆ–è€…é‡åˆ°è¾“å…¥æµçš„å…¶ä»–é”™è¯¯æ—¶ä¹Ÿä¼šå¤±è´¥ã€‚</li></ul><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929000103050.png"></p><p><strong>æ ‡ç¤ºé”™è¯¯</strong></p><p>ä¸€äº›è¾“å…¥è¿ç®—ç¬¦éœ€è¦åšæ›´å¤šæ•°æ®éªŒè¯çš„å·¥ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„è¾“å…¥è¿ç®—ç¬¦å¯èƒ½éœ€è¦æ£€æŸ¥bookNoæ˜¯å¦ç¬¦åˆè§„èŒƒçš„æ ¼å¼ã€‚åœ¨è¿™æ ·çš„ä¾‹å­ä¸­ï¼Œå³ä½¿ä»æŠ€æœ¯ä¸Šæ¥çœ‹IOæ˜¯æˆåŠŸçš„ï¼Œè¾“å…¥è¿ç®—ç¬¦ä¹Ÿåº”è¯¥è®¾ç½®æµçš„æ¡ä»¶çŠ¶æ€ä»¥æ ‡ç¤ºå‡ºå¤±è´¥ä¿¡æ¯ï¼ˆå‚è§8.1.2èŠ‚ï¼Œç¬¬279é¡µï¼‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¾“å…¥è¿ç®—ç¬¦åªè®¾ç½®failbitã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè®¾ç½®eofbitè¡¨ç¤ºæ–‡ä»¶è€—å°½ï¼Œè€Œè®¾ç½®badbitè¡¨ç¤ºæµè¢«ç ´åã€‚æœ€å¥½çš„æ–¹å¼æ˜¯ç”±IOæ ‡å‡†åº“è‡ªå·±æ¥æ ‡ç¤ºè¿™äº›é”™è¯¯ã€‚</p><h2 id="14-3-ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦"><a href="#14-3-ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦" class="headerlink" title="14.3 ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦"></a>14.3 ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦</h2><p>é€šå¸¸æƒ…å†µä¸‹ï¼š</p><ul><li>ç®—æœ¯å’Œå…³ç³»è¿ç®—ç¬¦å®šä¹‰æˆéæˆå‘˜å‡½æ•°ä»¥å…è®¸å¯¹å·¦ä¾§æˆ–å³ä¾§çš„è¿ç®—å¯¹è±¡è¿›è¡Œè½¬æ¢ï¼ˆå‚è§14.1èŠ‚ï¼Œç¬¬492é¡µï¼‰ã€‚</li><li>å› ä¸ºè¿™äº›è¿ç®—ç¬¦ä¸€èˆ¬ä¸éœ€è¦æ”¹å˜è¿ç®—å¯¹è±¡çš„çŠ¶æ€ï¼Œæ‰€ä»¥å½¢å‚éƒ½æ˜¯å¸¸é‡çš„å¼•ç”¨ã€‚</li></ul><p>å¦‚æœç±»å®šä¹‰äº†ç®—æœ¯è¿ç®—ç¬¦ï¼Œåˆ™å®ƒä¸€èˆ¬ä¹Ÿä¼šå®šä¹‰ä¸€ä¸ªå¯¹åº”çš„å¤åˆèµ‹å€¼è¿ç®—ç¬¦ã€‚æ­¤æ—¶ï¼Œæœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨å¤åˆèµ‹å€¼æ¥å®šä¹‰ç®—æœ¯è¿ç®—ç¬¦</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929000558278.png"></p><h3 id="14-3-1-ç›¸ç­‰è¿ç®—ç¬¦"><a href="#14-3-1-ç›¸ç­‰è¿ç®—ç¬¦" class="headerlink" title="14.3.1 ç›¸ç­‰è¿ç®—ç¬¦"></a>14.3.1 ç›¸ç­‰è¿ç®—ç¬¦</h3><ul><li>å¦‚æœä¸€ä¸ªç±»å«æœ‰åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„æ“ä½œï¼Œåˆ™å®ƒæ˜¾ç„¶åº”è¯¥æŠŠå‡½æ•°å®šä¹‰æˆoperator&#x3D;&#x3D;è€Œéä¸€ä¸ªæ™®é€šçš„å‘½åå‡½æ•°ï¼šå› ä¸ºç”¨æˆ·è‚¯å®šå¸Œæœ›èƒ½ä½¿ç”¨&#x3D;&#x3D;æ¯”è¾ƒå¯¹è±¡ï¼Œæ‰€ä»¥æä¾›äº†&#x3D;&#x3D;å°±æ„å‘³ç€ç”¨æˆ·æ— é¡»å†è´¹æ—¶è´¹åŠ›åœ°å­¦ä¹ å¹¶è®°å¿†ä¸€ä¸ªå…¨æ–°çš„å‡½æ•°åå­—ã€‚æ­¤å¤–ï¼Œç±»å®šä¹‰äº†&#x3D;&#x3D;è¿ç®—ç¬¦ä¹‹åä¹Ÿæ›´å®¹æ˜“ä½¿ç”¨æ ‡å‡†åº“å®¹å™¨å’Œç®—æ³•ã€‚</li><li>å¦‚æœç±»å®šä¹‰äº†operator&#x3D;&#x3D;ï¼Œåˆ™è¯¥è¿ç®—ç¬¦åº”è¯¥èƒ½åˆ¤æ–­ä¸€ç»„ç»™å®šçš„å¯¹è±¡ä¸­æ˜¯å¦å«æœ‰é‡å¤æ•°æ®ã€‚</li><li>é€šå¸¸æƒ…å†µä¸‹ï¼Œç›¸ç­‰è¿ç®—ç¬¦åº”è¯¥å…·æœ‰ä¼ é€’æ€§ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœa&#x3D;&#x3D;bå’Œb&#x3D;&#x3D;céƒ½ä¸ºçœŸï¼Œåˆ™a&#x3D;&#x3D;cä¹Ÿåº”è¯¥ä¸ºçœŸã€‚Â·</li><li>å¦‚æœç±»å®šä¹‰äº†operator&#x3D;&#x3D;ï¼Œåˆ™è¿™ä¸ªç±»ä¹Ÿåº”è¯¥å®šä¹‰operatorï¼&#x3D;ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œå½“ä»–ä»¬èƒ½ä½¿ç”¨&#x3D;&#x3D;æ—¶è‚¯å®šä¹Ÿå¸Œæœ›èƒ½ä½¿ç”¨ï¼&#x3D;ï¼Œåä¹‹äº¦ç„¶ã€‚</li><li>ç›¸ç­‰è¿ç®—ç¬¦å’Œä¸ç›¸ç­‰è¿ç®—ç¬¦ä¸­çš„ä¸€ä¸ªåº”è¯¥æŠŠå·¥ä½œå§”æ‰˜ç»™å¦å¤–ä¸€ä¸ªï¼Œè¿™æ„å‘³ç€å…¶ä¸­ä¸€ä¸ªè¿ç®—ç¬¦åº”è¯¥è´Ÿè´£å®é™…æ¯”è¾ƒå¯¹è±¡çš„å·¥ä½œï¼Œè€Œå¦ä¸€ä¸ªè¿ç®—ç¬¦åˆ™åªæ˜¯è°ƒç”¨é‚£ä¸ªçœŸæ­£å·¥ä½œçš„è¿ç®—ç¬¦ã€‚</li></ul><h3 id="14-3-2-å…³ç³»è¿ç®—ç¬¦"><a href="#14-3-2-å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="14.3.2 å…³ç³»è¿ç®—ç¬¦"></a>14.3.2 å…³ç³»è¿ç®—ç¬¦</h3><p>å®šä¹‰äº†ç›¸ç­‰è¿ç®—ç¬¦çš„ç±»ä¹Ÿå¸¸å¸¸ï¼ˆä½†ä¸æ€»æ˜¯ï¼‰åŒ…å«å…³ç³»è¿ç®—ç¬¦ã€‚ç‰¹åˆ«æ˜¯ï¼Œå› ä¸ºå…³è”å®¹å™¨å’Œä¸€äº›ç®—æ³•è¦ç”¨åˆ°å°äºè¿ç®—ç¬¦ï¼Œæ‰€ä»¥å®šä¹‰operator&lt;ä¼šæ¯”è¾ƒæœ‰ç”¨ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹å…³ç³»è¿ç®—ç¬¦åº”è¯¥</p><ul><li>å®šä¹‰é¡ºåºå…³ç³»ï¼Œä»¤å…¶ä¸å…³è”å®¹å™¨ä¸­å¯¹å…³é”®å­—çš„è¦æ±‚ä¸€è‡´ï¼ˆå‚è§11.2.2èŠ‚ï¼Œç¬¬378é¡µï¼‰</li><li>å¦‚æœç±»åŒæ—¶ä¹Ÿå«æœ‰&#x3D;&#x3D;è¿ç®—ç¬¦çš„è¯ï¼Œåˆ™å®šä¹‰ä¸€ç§å…³ç³»ä»¤å…¶ä¸&#x3D;&#x3D;ä¿æŒä¸€è‡´ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡æ˜¯ï¼&#x3D;çš„ï¼Œé‚£ä¹ˆä¸€ä¸ªå¯¹è±¡åº”è¯¥&lt;å¦å¤–ä¸€ä¸ªã€‚</li></ul><p>å°½ç®¡æˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºSales_dataç±»åº”è¯¥æ”¯æŒå…³ç³»è¿ç®—ç¬¦ï¼Œä½†äº‹å®è¯æ˜å¹¶éå¦‚æ­¤ï¼Œå…¶ä¸­çš„ç¼˜ç”±æ¯”è¾ƒå¾®å¦™ï¼Œå€¼å¾—è¯»è€…æ·±æ€ã€‚</p><p>ä¸€å¼€å§‹æˆ‘ä»¬å¯èƒ½ä¼šè®¤ä¸ºåº”è¯¥åƒcompareIsbnï¼ˆå‚è§11.2.2èŠ‚ï¼Œç¬¬379é¡µï¼‰é‚£æ ·å®šä¹‰&lt;ï¼Œè¯¥å‡½æ•°é€šè¿‡æ¯”è¾ƒISBNæ¥å®ç°å¯¹ä¸¤ä¸ªå¯¹è±¡çš„æ¯”è¾ƒã€‚ç„¶è€Œï¼Œå°½ç®¡compareIsbnæä¾›çš„é¡ºåºå…³ç³»ç¬¦åˆè¦æ±‚1ï¼Œä½†æ˜¯å‡½æ•°å¾—åˆ°çš„ç»“æœæ˜¾ç„¶ä¸æˆ‘ä»¬å®šä¹‰çš„&#x3D;&#x3D;ä¸ä¸€è‡´ï¼Œå› æ­¤å®ƒä¸æ»¡è¶³è¦æ±‚2ã€‚</p><p>å¯¹äºSales_dataçš„&#x3D;&#x3D;è¿ç®—ç¬¦æ¥è¯´ï¼Œå¦‚æœä¸¤ç¬”äº¤æ˜“çš„revenueå’Œunits_soldæˆå‘˜ä¸åŒï¼Œé‚£ä¹ˆå³ä½¿å®ƒä»¬çš„ISBNç›¸åŒä¹Ÿæ— æµäºäº‹ï¼Œå®ƒä»¬ä»ç„¶æ˜¯ä¸ç›¸ç­‰çš„ã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰çš„&lt;è¿ç®—ç¬¦ä»…ä»…æ¯”è¾ƒISBNæˆå‘˜ï¼Œé‚£ä¹ˆå°†å‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼šä¸¤ä¸ªISBNç›¸åŒä½†revenueå’Œunits_soldä¸åŒçš„å¯¹è±¡ç»æ¯”è¾ƒæ˜¯ä¸ç›¸ç­‰çš„ï¼Œä½†æ˜¯å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½ä¸æ¯”å¦ä¸€ä¸ªå°ã€‚ç„¶è€Œå®é™…æƒ…å†µæ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸¤ä¸ªå¯¹è±¡å¹¶ä¸”å“ªä¸ªéƒ½ä¸æ¯”å¦ä¸€ä¸ªå°ï¼Œåˆ™ä»é“ç†ä¸Šæ¥è®²è¿™ä¸¤ä¸ªå¯¹è±¡åº”è¯¥æ˜¯ç›¸ç­‰çš„ã€‚</p><p>åŸºäºä¸Šè¿°åˆ†ææˆ‘ä»¬ä¹Ÿè®¸ä¼šè®¤ä¸ºï¼Œåªè¦è®©operator&lt;ä¾æ¬¡æ¯”è¾ƒæ¯ä¸ªæ•°æ®å…ƒç´ å°±èƒ½è§£å†³é—®é¢˜äº†ï¼Œæ¯”æ–¹è¯´è®©operator&lt;å…ˆæ¯”è¾ƒisbnï¼Œç›¸ç­‰çš„è¯ç»§ç»­æ¯”è¾ƒunits_soldï¼Œè¿˜ç›¸ç­‰å†ç»§ç»­æ¯”è¾ƒrevenueã€‚ç„¶è€Œï¼Œè¿™æ ·çš„æ’åºæ²¡æœ‰ä»»ä½•å¿…è¦ã€‚æ ¹æ®å°†æ¥ä½¿ç”¨Sales_dataç±»çš„å®é™…éœ€è¦ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›å…ˆæ¯”è¾ƒunits_soldï¼Œä¹Ÿå¯èƒ½å¸Œæœ›å…ˆæ¯”è¾ƒrevenueã€‚æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›units_soldå°‘çš„å¯¹è±¡â€œå°äºâ€units_soldå¤šçš„å¯¹è±¡ï¼›å¦ä¸€äº›æ—¶å€™ï¼Œåˆ™å¯èƒ½å¸Œæœ›revenueå°‘çš„å¯¹è±¡â€œå°äºâ€revenueå¤šçš„å¯¹è±¡ã€‚å› æ­¤å¯¹äºSales_dataç±»æ¥è¯´ï¼Œä¸å­˜åœ¨ä¸€ç§é€»è¾‘å¯é çš„&lt;å®šä¹‰ï¼Œè¿™ä¸ªç±»ä¸å®šä¹‰&lt;è¿ç®—ç¬¦ä¹Ÿè®¸æ›´å¥½ã€‚</p><blockquote><p>å¦‚æœå­˜åœ¨å”¯ä¸€ä¸€ç§é€»è¾‘å¯é çš„&lt;å®šä¹‰ï¼Œåˆ™åº”è¯¥è€ƒè™‘ä¸ºè¿™ä¸ªç±»å®šä¹‰&lt;è¿ç®—ç¬¦ã€‚å¦‚æœç±»åŒæ—¶è¿˜åŒ…å«&#x3D;&#x3D;ï¼Œåˆ™å½“ä¸”ä»…å½“&lt;çš„å®šä¹‰å’Œ&#x3D;&#x3D;äº§ç”Ÿçš„ç»“æœä¸€è‡´æ—¶æ‰å®šä¹‰&lt;è¿ç®—ç¬¦ã€‚</p></blockquote><h2 id="14-4-èµ‹å€¼è¿ç®—ç¬¦"><a href="#14-4-èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="14.4 èµ‹å€¼è¿ç®—ç¬¦"></a>14.4 èµ‹å€¼è¿ç®—ç¬¦</h2><div class="note note-primary">            <p>æˆ‘ä»¬å¯ä»¥é‡è½½èµ‹å€¼è¿ç®—ç¬¦ã€‚ä¸è®ºå½¢å‚çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œèµ‹å€¼è¿ç®—ç¬¦éƒ½å¿…é¡»å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°ã€‚</p>          </div><p>ä¹‹å‰å·²ç»ä»‹ç»è¿‡<a href="https://erlsrnby04.github.io/2024/09/22/C-C-Primer-Chapter-13/">æ‹·è´èµ‹å€¼å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</a>ï¼ˆå‚è§13.1.2èŠ‚ï¼Œç¬¬443é¡µå’Œ13.6.2èŠ‚ï¼Œç¬¬474é¡µï¼‰ï¼Œå®ƒä»¬å¯ä»¥æŠŠç±»çš„ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™è¯¥ç±»çš„å¦ä¸€ä¸ªå¯¹è±¡ã€‚æ­¤å¤–ï¼Œç±»è¿˜å¯ä»¥å®šä¹‰å…¶ä»–èµ‹å€¼è¿ç®—ç¬¦ä»¥ä½¿ç”¨åˆ«çš„ç±»å‹ä½œä¸ºå³ä¾§è¿ç®—å¯¹è±¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æ‹·è´èµ‹å€¼å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ä¹‹å¤–ï¼Œæ ‡å‡†åº“vectorç±»è¿˜å®šä¹‰äº†ç¬¬ä¸‰ç§èµ‹å€¼è¿ç®—ç¬¦ï¼Œè¯¥è¿ç®—ç¬¦æ¥å—èŠ±æ‹¬å·å†…çš„å…ƒç´ åˆ—è¡¨ä½œä¸ºå‚æ•°ï¼ˆå‚è§9.2.5èŠ‚ï¼Œç¬¬302é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929001537851.png"></p><p><strong>å¤åˆèµ‹å€¼è¿ç®—ç¬¦</strong></p><p>å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä¸éå¾—æ˜¯ç±»çš„æˆå‘˜ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å€¾å‘äºæŠŠåŒ…æ‹¬å¤åˆèµ‹å€¼åœ¨å†…çš„æ‰€æœ‰èµ‹å€¼è¿ç®—éƒ½å®šä¹‰åœ¨ç±»çš„å†…éƒ¨ã€‚ä¸ºäº†ä¸å†…ç½®ç±»å‹çš„å¤åˆèµ‹å€¼ä¿æŒä¸€è‡´ï¼Œç±»ä¸­çš„å¤åˆèµ‹å€¼è¿ç®—ç¬¦ä¹Ÿè¦è¿”å›å…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„å¼•ç”¨ã€‚</p><h2 id="14-5-ä¸‹æ ‡è¿ç®—ç¬¦"><a href="#14-5-ä¸‹æ ‡è¿ç®—ç¬¦" class="headerlink" title="14.5 ä¸‹æ ‡è¿ç®—ç¬¦"></a>14.5 ä¸‹æ ‡è¿ç®—ç¬¦</h2><div class="note note-primary">            <p>ä¸‹æ ‡è¿ç®—ç¬¦å¿…é¡»æ˜¯æˆå‘˜å‡½æ•°ã€‚</p>          </div><p>è¡¨ç¤ºå®¹å™¨çš„ç±»é€šå¸¸å¯ä»¥é€šè¿‡å…ƒç´ åœ¨å®¹å™¨ä¸­çš„ä½ç½®è®¿é—®å…ƒç´ ï¼Œè¿™äº›ç±»ä¸€èˆ¬ä¼šå®šä¹‰ä¸‹æ ‡è¿ç®—ç¬¦operator[]ã€‚</p><p>ä¸ºäº†ä¸ä¸‹æ ‡çš„åŸå§‹å®šä¹‰å…¼å®¹ï¼Œä¸‹æ ‡è¿ç®—ç¬¦é€šå¸¸ä»¥æ‰€è®¿é—®å…ƒç´ çš„å¼•ç”¨ä½œä¸ºè¿”å›å€¼ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸‹æ ‡å¯ä»¥å‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„ä»»æ„ä¸€ç«¯ã€‚è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬æœ€å¥½åŒæ—¶å®šä¹‰ä¸‹æ ‡è¿ç®—ç¬¦çš„å¸¸é‡ç‰ˆæœ¬å’Œéå¸¸é‡ç‰ˆæœ¬ï¼Œå½“ä½œç”¨äºä¸€ä¸ªå¸¸é‡å¯¹è±¡æ—¶ï¼Œä¸‹æ ‡è¿ç®—ç¬¦è¿”å›å¸¸é‡å¼•ç”¨ä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šç»™è¿”å›çš„å¯¹è±¡èµ‹å€¼ã€‚</p><h2 id="14-6-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"><a href="#14-6-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦" class="headerlink" title="14.6 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"></a>14.6 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦</h2><div class="note note-primary">            <p>å®šä¹‰é€’å¢å’Œé€’å‡è¿ç®—ç¬¦çš„ç±»åº”è¯¥åŒæ—¶å®šä¹‰å‰ç½®ç‰ˆæœ¬å’Œåç½®ç‰ˆæœ¬ã€‚è¿™äº›è¿ç®—ç¬¦é€šå¸¸åº”è¯¥è¢«å®šä¹‰æˆç±»çš„æˆå‘˜ã€‚</p>          </div><p>C++è¯­è¨€å¹¶ä¸è¦æ±‚é€’å¢å’Œé€’å‡è¿ç®—ç¬¦å¿…é¡»æ˜¯ç±»çš„æˆå‘˜ï¼Œä½†æ˜¯å› ä¸ºå®ƒä»¬æ”¹å˜çš„æ­£å¥½æ˜¯æ‰€æ“ä½œå¯¹è±¡çš„çŠ¶æ€ï¼Œæ‰€ä»¥å»ºè®®å°†å…¶è®¾å®šä¸ºæˆå‘˜å‡½æ•°ã€‚</p><p><strong>å®šä¹‰å‰ç½®é€’å¢&#x2F;é€’å‡è¿ç®—ç¬¦</strong></p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929002855117.png"></p><p>å‰ç½®è¿ç®—ç¬¦åº”è¯¥è¿”å›é€’å¢æˆ–é€’å‡åå¯¹è±¡çš„å¼•ç”¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929002959564.png"></p><p><strong>åŒºåˆ†å‰ç½®å’Œåç½®è¿ç®—ç¬¦</strong></p><p>åç½®ç‰ˆæœ¬æ¥å—ä¸€ä¸ªé¢å¤–çš„ï¼ˆä¸è¢«ä½¿ç”¨ï¼‰intç±»å‹çš„å½¢å‚ã€‚å½“æˆ‘ä»¬ä½¿ç”¨åç½®è¿ç®—ç¬¦æ—¶ï¼Œç¼–è¯‘å™¨ä¸ºè¿™ä¸ªå½¢å‚æä¾›ä¸€ä¸ªå€¼ä¸º0çš„å®å‚ã€‚å°½ç®¡ä»è¯­æ³•ä¸Šæ¥è¯´åç½®å‡½æ•°å¯ä»¥ä½¿ç”¨è¿™ä¸ªé¢å¤–çš„å½¢å‚ï¼Œä½†æ˜¯åœ¨å®é™…è¿‡ç¨‹ä¸­é€šå¸¸ä¸ä¼šè¿™ä¹ˆåšã€‚è¿™ä¸ªå½¢å‚çš„å”¯ä¸€ä½œç”¨å°±æ˜¯åŒºåˆ†å‰ç½®ç‰ˆæœ¬å’Œåç½®ç‰ˆæœ¬çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯çœŸçš„è¦åœ¨å®ç°åç½®ç‰ˆæœ¬æ—¶å‚ä¸è¿ç®—ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929003040691.png"></p><p>åç½®è¿ç®—ç¬¦åº”è¯¥è¿”å›å¯¹è±¡çš„åŸå€¼ï¼ˆé€’å¢æˆ–é€’å‡ä¹‹å‰çš„å€¼ï¼‰ï¼Œè¿”å›çš„å½¢å¼æ˜¯ä¸€ä¸ªå€¼è€Œéå¼•ç”¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929003107796.png"></p><p>åç½®è¿ç®—ç¬¦è°ƒç”¨å„è‡ªçš„å‰ç½®ç‰ˆæœ¬æ¥å®Œæˆå®é™…çš„å·¥ä½œã€‚</p><h2 id="14-7-æˆå‘˜è®¿é—®è¿ç®—ç¬¦"><a href="#14-7-æˆå‘˜è®¿é—®è¿ç®—ç¬¦" class="headerlink" title="14.7 æˆå‘˜è®¿é—®è¿ç®—ç¬¦"></a>14.7 æˆå‘˜è®¿é—®è¿ç®—ç¬¦</h2><div class="note note-primary">            <p>ç®­å¤´è¿ç®—ç¬¦å¿…é¡»æ˜¯ç±»çš„æˆå‘˜ã€‚è§£å¼•ç”¨è¿ç®—ç¬¦é€šå¸¸ä¹Ÿæ˜¯ç±»çš„æˆå‘˜ï¼Œå°½ç®¡å¹¶éå¿…é¡»å¦‚æ­¤ã€‚</p>          </div><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929003249763.png"></p><p>ç®­å¤´è¿ç®—ç¬¦ä¸æ‰§è¡Œä»»ä½•è‡ªå·±çš„æ“ä½œï¼Œè€Œæ˜¯è°ƒç”¨è§£å¼•ç”¨è¿ç®—ç¬¦å¹¶è¿”å›è§£å¼•ç”¨ç»“æœå…ƒç´ çš„åœ°å€ã€‚</p><p><strong>å¯¹ç®­å¤´è¿ç®—ç¬¦è¿”å›å€¼çš„é™å®š</strong></p><div class="note note-primary">            <p>é‡è½½çš„ç®­å¤´è¿ç®—ç¬¦å¿…é¡»è¿”å›ç±»çš„æŒ‡é’ˆæˆ–è€…è‡ªå®šä¹‰äº†ç®­å¤´è¿ç®—ç¬¦çš„æŸä¸ªç±»çš„å¯¹è±¡ã€‚</p>          </div><h2 id="14-8-å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦"><a href="#14-8-å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦" class="headerlink" title="14.8 å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦"></a>14.8 å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦</h2><div class="note note-primary">            <p>å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦å¿…é¡»æ˜¯æˆå‘˜å‡½æ•°ã€‚ä¸€ä¸ªç±»å¯ä»¥å®šä¹‰å¤šä¸ªä¸åŒç‰ˆæœ¬çš„è°ƒç”¨è¿ç®—ç¬¦ï¼Œç›¸äº’ä¹‹é—´åº”è¯¥åœ¨å‚æ•°æ•°é‡æˆ–ç±»å‹ä¸Šæœ‰æ‰€åŒºåˆ«ã€‚</p>          </div><p>å¦‚æœç±»é‡è½½äº†å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨å‡½æ•°ä¸€æ ·ä½¿ç”¨è¯¥ç±»çš„å¯¹è±¡ã€‚å› ä¸ºè¿™æ ·çš„ç±»åŒæ—¶ä¹Ÿèƒ½å­˜å‚¨çŠ¶æ€ï¼Œæ‰€ä»¥ä¸æ™®é€šå‡½æ•°ç›¸æ¯”å®ƒä»¬æ›´åŠ çµæ´»ã€‚</p><p>å¦‚æœç±»å®šä¹‰äº†è°ƒç”¨è¿ç®—ç¬¦ï¼Œåˆ™è¯¥ç±»çš„å¯¹è±¡ç§°ä½œ<strong>å‡½æ•°å¯¹è±¡ï¼ˆfunction objectï¼‰</strong>ã€‚å› ä¸ºå¯ä»¥è°ƒç”¨è¿™ç§å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´è¿™äº›å¯¹è±¡çš„â€œè¡Œä¸ºåƒå‡½æ•°ä¸€æ ·â€ã€‚</p><p><strong>å«æœ‰çŠ¶æ€çš„å‡½æ•°å¯¹è±¡ç±»</strong></p><p>å‡½æ•°å¯¹è±¡å¸¸å¸¸ä½œä¸ºæ³›å‹ç®—æ³•çš„å®å‚ã€‚</p><h3 id="14-8-1-lambdaæ˜¯å‡½æ•°å¯¹è±¡"><a href="#14-8-1-lambdaæ˜¯å‡½æ•°å¯¹è±¡" class="headerlink" title="14.8.1 lambdaæ˜¯å‡½æ•°å¯¹è±¡"></a>14.8.1 lambdaæ˜¯å‡½æ•°å¯¹è±¡</h3><p>å½“æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªlambdaåï¼Œç¼–è¯‘å™¨å°†è¯¥è¡¨è¾¾å¼ç¿»è¯‘æˆä¸€ä¸ªæœªå‘½åç±»çš„æœªå‘½åå¯¹è±¡ï¼ˆå‚è§10.3.3èŠ‚ï¼Œç¬¬349é¡µï¼‰ã€‚åœ¨lambdaè¡¨è¾¾å¼äº§ç”Ÿçš„ç±»ä¸­å«æœ‰ä¸€ä¸ªé‡è½½çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹lambdaä¸èƒ½æ”¹å˜å®ƒæ•è·çš„å˜é‡ã€‚å› æ­¤åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±lambdaäº§ç”Ÿçš„ç±»å½“ä¸­çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªconstæˆå‘˜å‡½æ•°ã€‚å¦‚æœlambdaè¢«å£°æ˜ä¸ºå¯å˜çš„ï¼Œåˆ™è°ƒç”¨è¿ç®—ç¬¦å°±ä¸æ˜¯constçš„äº†ã€‚</p><p><strong>è¡¨ç¤ºlambdaåŠç›¸åº”æ•è·è¡Œä¸ºçš„ç±»</strong></p><p>å½“ä¸€ä¸ªlambdaè¡¨è¾¾å¼é€šè¿‡å¼•ç”¨æ•è·å˜é‡æ—¶ï¼Œå°†ç”±ç¨‹åºè´Ÿè´£ç¡®ä¿lambdaæ‰§è¡Œæ—¶å¼•ç”¨æ‰€å¼•çš„å¯¹è±¡ç¡®å®å­˜åœ¨ï¼ˆå‚è§10.3.3èŠ‚ï¼Œç¬¬350é¡µï¼‰ã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å¼•ç”¨è€Œæ— é¡»åœ¨lambdaäº§ç”Ÿçš„ç±»ä¸­å°†å…¶å­˜å‚¨ä¸ºæ•°æ®æˆå‘˜ã€‚</p><p>ç›¸åï¼Œé€šè¿‡å€¼æ•è·çš„å˜é‡è¢«æ‹·è´åˆ°lambdaä¸­ï¼ˆå‚è§10.3.3èŠ‚ï¼Œç¬¬350é¡µï¼‰ã€‚å› æ­¤ï¼Œè¿™ç§lambdaäº§ç”Ÿçš„ç±»å¿…é¡»ä¸ºæ¯ä¸ªå€¼æ•è·çš„å˜é‡å»ºç«‹å¯¹åº”çš„æ•°æ®æˆå‘˜ï¼ŒåŒæ—¶åˆ›å»ºæ„é€ å‡½æ•°ï¼Œä»¤å…¶ä½¿ç”¨æ•è·çš„å˜é‡çš„å€¼æ¥åˆå§‹åŒ–æ•°æ®æˆå‘˜ã€‚</p><h3 id="14-8-2-æ ‡å‡†åº“å®šä¹‰çš„å‡½æ•°å¯¹è±¡"><a href="#14-8-2-æ ‡å‡†åº“å®šä¹‰çš„å‡½æ•°å¯¹è±¡" class="headerlink" title="14.8.2 æ ‡å‡†åº“å®šä¹‰çš„å‡½æ•°å¯¹è±¡"></a>14.8.2 æ ‡å‡†åº“å®šä¹‰çš„å‡½æ•°å¯¹è±¡</h3><p>æ ‡å‡†åº“å®šä¹‰äº†ä¸€ç»„è¡¨ç¤ºç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦å’Œé€»è¾‘è¿ç®—ç¬¦çš„ç±»ï¼Œæ¯ä¸ªç±»åˆ†åˆ«å®šä¹‰äº†ä¸€ä¸ªæ‰§è¡Œå‘½åæ“ä½œçš„è°ƒç”¨è¿ç®—ç¬¦ã€‚</p><p>è¿™äº›ç±»éƒ½è¢«å®šä¹‰æˆæ¨¡æ¿çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æŒ‡å®šå…·ä½“çš„åº”ç”¨ç±»å‹ï¼Œè¿™é‡Œçš„ç±»å‹å³è°ƒç”¨è¿ç®—ç¬¦çš„å½¢å‚ç±»å‹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929142537414.png"></p><p><strong>åœ¨ç®—æ³•ä¸­ä½¿ç”¨æ ‡å‡†åº“å‡½æ•°å¯¹è±¡</strong></p><p>è¡¨ç¤ºè¿ç®—ç¬¦çš„å‡½æ•°å¯¹è±¡ç±»å¸¸ç”¨æ¥æ›¿æ¢ç®—æ³•ä¸­çš„é»˜è®¤è¿ç®—ç¬¦ã€‚</p><p>å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹æ’åºç®—æ³•ä½¿ç”¨operator&lt;å°†åºåˆ—æŒ‰ç…§å‡åºæ’åˆ—ã€‚å¦‚æœè¦æ‰§è¡Œé™åºæ’åˆ—çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªgreaterç±»å‹çš„å¯¹è±¡ã€‚è¯¥ç±»å°†äº§ç”Ÿä¸€ä¸ªè°ƒç”¨è¿ç®—ç¬¦å¹¶è´Ÿè´£æ‰§è¡Œå¾…æ’åºç±»å‹çš„å¤§äºè¿ç®—ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929142624574.png"></p><p>æ ‡å‡†åº“è§„å®šå…¶å‡½æ•°å¯¹è±¡å¯¹äºæŒ‡é’ˆåŒæ ·é€‚ç”¨ã€‚æˆ‘ä»¬ä¹‹å‰æ›¾ç»ä»‹ç»è¿‡æ¯”è¾ƒä¸¤ä¸ªæ— å…³æŒ‡é’ˆå°†äº§ç”Ÿæœªå®šä¹‰çš„è¡Œä¸ºï¼ˆå‚è§3.5.3èŠ‚ï¼Œç¬¬107é¡µï¼‰ï¼Œç„¶è€Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›é€šè¿‡æ¯”è¾ƒæŒ‡é’ˆçš„å†…å­˜åœ°å€æ¥sortæŒ‡é’ˆçš„vectorã€‚ç›´æ¥è¿™ä¹ˆåšå°†äº§ç”Ÿæœªå®šä¹‰çš„è¡Œä¸ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†åº“å‡½æ•°å¯¹è±¡æ¥å®ç°è¯¥ç›®çš„</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929142713199.png"></p><h3 id="14-8-3-å¯è°ƒç”¨å¯¹è±¡ä¸function"><a href="#14-8-3-å¯è°ƒç”¨å¯¹è±¡ä¸function" class="headerlink" title="14.8.3 å¯è°ƒç”¨å¯¹è±¡ä¸function"></a>14.8.3 å¯è°ƒç”¨å¯¹è±¡ä¸function</h3><p>C++è¯­è¨€ä¸­æœ‰å‡ ç§å¯è°ƒç”¨çš„å¯¹è±¡ï¼š</p><ul><li>å‡½æ•°</li><li>å‡½æ•°æŒ‡é’ˆ</li><li>lambdaè¡¨è¾¾å¼ï¼ˆå‚è§10.3.2èŠ‚ï¼Œç¬¬346é¡µï¼‰</li><li>bindåˆ›å»ºçš„å¯¹è±¡ï¼ˆå‚è§10.3.4èŠ‚ï¼Œç¬¬354é¡µï¼‰</li><li>é‡è½½äº†å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„ç±»ã€‚</li></ul><p>å¯è°ƒç”¨çš„å¯¹è±¡ä¹Ÿæœ‰ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªlambdaæœ‰å®ƒè‡ªå·±å”¯ä¸€çš„ï¼ˆæœªå‘½åï¼‰ç±»ç±»å‹ï¼›å‡½æ•°åŠå‡½æ•°æŒ‡é’ˆçš„ç±»å‹åˆ™ç”±å…¶è¿”å›å€¼ç±»å‹å’Œå®å‚ç±»å‹å†³å®šï¼Œç­‰ç­‰ã€‚</p><p>ç„¶è€Œï¼Œä¸¤ä¸ªä¸åŒç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡å´å¯èƒ½å…±äº«åŒä¸€ç§<strong>è°ƒç”¨å½¢å¼ï¼ˆcall signatureï¼‰</strong>ã€‚è°ƒç”¨å½¢å¼æŒ‡æ˜äº†è°ƒç”¨è¿”å›çš„ç±»å‹ä»¥åŠä¼ é€’ç»™è°ƒç”¨çš„å®å‚ç±»å‹ã€‚ä¸€ç§è°ƒç”¨å½¢å¼å¯¹åº”ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œä¾‹å¦‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143055617.png"></p><p>æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå®ƒæ¥å—ä¸¤ä¸ªintã€è¿”å›ä¸€ä¸ªintã€‚</p><p><strong>ä¸åŒç±»å‹å¯èƒ½å…·æœ‰ç›¸åŒçš„è°ƒç”¨å½¢å¼</strong></p><p>å¯¹äºå‡ ä¸ªå¯è°ƒç”¨å¯¹è±¡å…±äº«åŒä¸€ç§è°ƒç”¨å½¢å¼çš„æƒ…å†µï¼Œæœ‰æ—¶æˆ‘ä»¬ä¼šå¸Œæœ›æŠŠå®ƒä»¬çœ‹æˆå…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143127827.png"></p><p>ä¸Šé¢è¿™äº›å¯è°ƒç”¨å¯¹è±¡åˆ†åˆ«å¯¹å…¶å‚æ•°æ‰§è¡Œäº†ä¸åŒçš„ç®—æœ¯è¿ç®—ï¼Œå°½ç®¡å®ƒä»¬çš„ç±»å‹å„ä¸ç›¸åŒï¼Œä½†æ˜¯å…±äº«åŒä¸€ç§è°ƒç”¨å½¢å¼ã€‚</p><p>æˆ‘ä»¬å¯èƒ½å¸Œæœ›ä½¿ç”¨è¿™äº›å¯è°ƒç”¨å¯¹è±¡æ„å»ºä¸€ä¸ªç®€å•çš„æ¡Œé¢è®¡ç®—å™¨ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°è¡¨ï¼ˆfunction tableï¼‰ç”¨äºå­˜å‚¨æŒ‡å‘è¿™äº›å¯è°ƒç”¨å¯¹è±¡çš„â€œæŒ‡é’ˆâ€ã€‚å½“ç¨‹åºéœ€è¦æ‰§è¡ŒæŸä¸ªç‰¹å®šçš„æ“ä½œæ—¶ï¼Œä»è¡¨ä¸­æŸ¥æ‰¾è¯¥è°ƒç”¨çš„å‡½æ•°ã€‚</p><p>åœ¨C++è¯­è¨€ä¸­ï¼Œå‡½æ•°è¡¨å¾ˆå®¹æ˜“é€šè¿‡mapæ¥å®ç°ã€‚</p><p>å¯¹äºæ­¤ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè¡¨ç¤ºè¿ç®—ç¬¦ç¬¦å·çš„stringå¯¹è±¡ä½œä¸ºå…³é”®å­—ï¼›ä½¿ç”¨å®ç°è¿ç®—ç¬¦çš„å‡½æ•°ä½œä¸ºå€¼ã€‚å½“æˆ‘ä»¬éœ€è¦æ±‚ç»™å®šè¿ç®—ç¬¦çš„å€¼æ—¶ï¼Œå…ˆé€šè¿‡è¿ç®—ç¬¦ç´¢å¼•mapï¼Œç„¶åè°ƒç”¨æ‰¾åˆ°çš„é‚£ä¸ªå…ƒç´ ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143258114.png"></p><p>æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å½¢å¼å°†addçš„æŒ‡é’ˆæ·»åŠ åˆ°binopsä¸­</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143331235.png"></p><p>ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½å°†modæˆ–è€…divideå­˜å…¥binopsï¼š</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143340872.png"></p><p><strong>æ ‡å‡†åº“functionç±»å‹</strong></p><p>å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º<strong>function</strong>çš„æ–°çš„æ ‡å‡†åº“ç±»å‹è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œfunctionå®šä¹‰åœ¨functionalå¤´æ–‡ä»¶ä¸­ï¼Œè¡¨14.3åˆ—ä¸¾å‡ºäº†functionå®šä¹‰çš„æ“ä½œã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143407352.png"></p><p>functionæ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå½“åˆ›å»ºä¸€ä¸ªå…·ä½“çš„functionç±»å‹æ—¶æˆ‘ä»¬å¿…é¡»æä¾›é¢å¤–çš„ä¿¡æ¯ï¼Œå³è¯¥functionç±»å‹èƒ½å¤Ÿè¡¨ç¤ºçš„å¯¹è±¡çš„è°ƒç”¨å½¢å¼ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143542124.png"></p><p><strong>é‡è½½çš„å‡½æ•°ä¸function</strong></p><p>æˆ‘ä»¬ä¸èƒ½ï¼ˆç›´æ¥ï¼‰å°†é‡è½½å‡½æ•°çš„åå­—å­˜å…¥functionç±»å‹çš„å¯¹è±¡ä¸­</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143643994.png"></p><p>è§£å†³ä¸Šè¿°äºŒä¹‰æ€§é—®é¢˜çš„ä¸€æ¡é€”å¾„æ˜¯å­˜å‚¨å‡½æ•°æŒ‡é’ˆï¼ˆå‚è§6.7èŠ‚ï¼Œç¬¬221é¡µï¼‰è€Œéå‡½æ•°çš„åå­—</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143718359.png"></p><p>ä¹Ÿèƒ½ä½¿ç”¨lambdaæ¥æ¶ˆé™¤äºŒä¹‰æ€§</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929143739573.png"></p><h2 id="14-9-é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦"><a href="#14-9-é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦" class="headerlink" title="14.9 é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦"></a>14.9 é‡è½½ã€ç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦</h2><p>æˆ‘ä»¬åŒæ ·èƒ½å®šä¹‰å¯¹äºç±»ç±»å‹çš„ç±»å‹è½¬æ¢ï¼Œé€šè¿‡å®šä¹‰ç±»å‹è½¬æ¢è¿ç®—ç¬¦å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è½¬æ¢æ„é€ å‡½æ•°å’Œç±»å‹è½¬æ¢è¿ç®—ç¬¦å…±åŒå®šä¹‰äº†ç±»ç±»å‹è½¬æ¢ï¼ˆclass-type conversionsï¼‰ï¼Œè¿™æ ·çš„è½¬æ¢æœ‰æ—¶ä¹Ÿè¢«ç§°ä½œç”¨æˆ·å®šä¹‰çš„ç±»å‹è½¬æ¢ï¼ˆuser-defined conversionsï¼‰ã€‚</p><h3 id="14-9-1-ç±»å‹è½¬æ¢è¿ç®—ç¬¦"><a href="#14-9-1-ç±»å‹è½¬æ¢è¿ç®—ç¬¦" class="headerlink" title="14.9.1 ç±»å‹è½¬æ¢è¿ç®—ç¬¦"></a>14.9.1 ç±»å‹è½¬æ¢è¿ç®—ç¬¦</h3><p>ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼ˆconversion operatorï¼‰æ˜¯ç±»çš„ä¸€ç§ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼Œå®ƒè´Ÿè´£å°†ä¸€ä¸ªç±»ç±»å‹çš„å€¼è½¬æ¢æˆå…¶ä»–ç±»å‹ã€‚ç±»å‹è½¬æ¢å‡½æ•°çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹æ‰€ç¤º</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929144114812.png"></p><div class="note note-primary">            <p>ä¸€ä¸ªç±»å‹è½¬æ¢å‡½æ•°å¿…é¡»æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼›å®ƒä¸èƒ½å£°æ˜è¿”å›ç±»å‹ï¼Œå½¢å‚åˆ—è¡¨ä¹Ÿå¿…é¡»ä¸ºç©ºã€‚ç±»å‹è½¬æ¢å‡½æ•°é€šå¸¸åº”è¯¥æ˜¯constã€‚</p>          </div><p>å…¶ä¸­typeè¡¨ç¤ºæŸç§ç±»å‹ã€‚ç±»å‹è½¬æ¢è¿ç®—ç¬¦å¯ä»¥é¢å‘ä»»æ„ç±»å‹ï¼ˆé™¤äº†voidä¹‹å¤–ï¼‰è¿›è¡Œå®šä¹‰ï¼Œåªè¦è¯¥ç±»å‹èƒ½ä½œä¸ºå‡½æ•°çš„è¿”å›ç±»å‹ï¼ˆå‚è§6.1èŠ‚ï¼Œç¬¬184é¡µï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å…è®¸è½¬æ¢æˆæ•°ç»„æˆ–è€…å‡½æ•°ç±»å‹ï¼Œä½†å…è®¸è½¬æ¢æˆæŒ‡é’ˆï¼ˆåŒ…æ‹¬æ•°ç»„æŒ‡é’ˆåŠå‡½æ•°æŒ‡é’ˆï¼‰æˆ–è€…å¼•ç”¨ç±»å‹ã€‚</p><p>ç±»å‹è½¬æ¢è¿ç®—ç¬¦æ—¢æ²¡æœ‰æ˜¾å¼çš„è¿”å›ç±»å‹ï¼Œä¹Ÿæ²¡æœ‰å½¢å‚ï¼Œè€Œä¸”å¿…é¡»å®šä¹‰æˆç±»çš„æˆå‘˜å‡½æ•°ã€‚ç±»å‹è½¬æ¢è¿ç®—ç¬¦é€šå¸¸ä¸åº”è¯¥æ”¹å˜å¾…è½¬æ¢å¯¹è±¡çš„å†…å®¹ï¼Œå› æ­¤ï¼Œç±»å‹è½¬æ¢è¿ç®—ç¬¦ä¸€èˆ¬è¢«å®šä¹‰æˆconstæˆå‘˜ã€‚</p><p><strong>å®šä¹‰å«æœ‰ç±»å‹è½¬æ¢è¿ç®—ç¬¦çš„ç±»</strong></p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929144255208.png"></p><p>SmallIntç±»æ—¢å®šä¹‰äº†å‘ç±»ç±»å‹çš„è½¬æ¢ï¼Œä¹Ÿå®šä¹‰äº†ä»ç±»ç±»å‹å‘å…¶ä»–ç±»å‹çš„è½¬æ¢ã€‚å…¶ä¸­ï¼Œæ„é€ å‡½æ•°å°†ç®—æœ¯ç±»å‹çš„å€¼è½¬æ¢æˆSmallIntå¯¹è±¡ï¼Œè€Œç±»å‹è½¬æ¢è¿ç®—ç¬¦å°†SmallIntå¯¹è±¡è½¬æ¢æˆint</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929144340414.png"></p><p><strong>æç¤ºï¼šé¿å…è¿‡åº¦ä½¿ç”¨ç±»å‹è½¬æ¢å‡½æ•°</strong></p><p>å’Œä½¿ç”¨é‡è½½è¿ç®—ç¬¦çš„ç»éªŒä¸€æ ·ï¼Œæ˜æ™ºåœ°ä½¿ç”¨ç±»å‹è½¬æ¢è¿ç®—ç¬¦ä¹Ÿèƒ½æå¤§åœ°ç®€åŒ–ç±»è®¾è®¡è€…çš„å·¥ä½œï¼ŒåŒæ—¶ä½¿å¾—ä½¿ç”¨ç±»æ›´åŠ å®¹æ˜“ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨ç±»ç±»å‹å’Œè½¬æ¢ç±»å‹ä¹‹é—´ä¸å­˜åœ¨æ˜æ˜¾çš„æ˜ å°„å…³ç³»ï¼Œåˆ™è¿™æ ·çš„ç±»å‹è½¬æ¢å¯èƒ½å…·æœ‰è¯¯å¯¼æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æŸä¸ªç±»è¡¨ç¤ºDateï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šä¸ºå®ƒæ·»åŠ ä¸€ä¸ªä»Dateåˆ°intçš„è½¬æ¢ã€‚ç„¶è€Œï¼Œç±»å‹è½¬æ¢å‡½æ•°çš„è¿”å›å€¼åº”è¯¥æ˜¯ä»€ä¹ˆï¼Ÿä¸€ç§å¯èƒ½çš„è§£é‡Šæ˜¯ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªåè¿›åˆ¶æ•°ï¼Œä¾æ¬¡è¡¨ç¤ºå¹´ã€æœˆã€æ—¥ï¼Œä¾‹å¦‚ï¼ŒJuly 30ï¼Œ1989å¯èƒ½è½¬æ¢ä¸ºintå€¼19890730ã€‚åŒæ—¶è¿˜å­˜åœ¨å¦å¤–ä¸€ç§åˆç†çš„è§£é‡Šï¼Œå³ç±»å‹è½¬æ¢è¿ç®—ç¬¦è¿”å›çš„intè¡¨ç¤ºçš„æ˜¯ä»æŸä¸ªæ—¶é—´èŠ‚ç‚¹ï¼ˆæ¯”å¦‚January 1ï¼Œ1970ï¼‰å¼€å§‹ç»è¿‡çš„å¤©æ•°ã€‚æ˜¾ç„¶è¿™ä¸¤ç§ç†è§£éƒ½åˆæƒ…åˆç†ï¼Œæ¯•ç«Ÿä»å½¢å¼ä¸Šçœ‹å®ƒä»¬äº§ç”Ÿçš„æ•ˆæœéƒ½æ˜¯è¶Šé åçš„æ—¥æœŸå¯¹åº”çš„æ•´æ•°å€¼è¶Šå¤§ï¼Œè€Œä¸”ä¸¤ç§è½¬æ¢éƒ½æœ‰å®é™…çš„ç”¨å¤„ã€‚</p><p>é—®é¢˜åœ¨äºDateç±»å‹çš„å¯¹è±¡å’Œintç±»å‹çš„å€¼ä¹‹é—´ä¸å­˜åœ¨æ˜ç¡®çš„ä¸€å¯¹ä¸€æ˜ å°„å…³ç³»ã€‚å› æ­¤åœ¨æ­¤ä¾‹ä¸­ï¼Œä¸å®šä¹‰è¯¥ç±»å‹è½¬æ¢è¿ç®—ç¬¦ä¹Ÿè®¸ä¼šæ›´å¥½ã€‚ä½œä¸ºæ›¿ä»£çš„æ‰‹æ®µï¼Œç±»å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæ™®é€šçš„æˆå‘˜å‡½æ•°ä»¥ä»å„ç§ä¸åŒå½¢å¼ä¸­æå–æ‰€éœ€çš„ä¿¡æ¯ã€‚</p><p><strong>ç±»å‹è½¬æ¢è¿ç®—ç¬¦å¯èƒ½äº§ç”Ÿæ„å¤–ç»“æœ</strong></p><p>åœ¨å®è·µä¸­ï¼Œç±»å¾ˆå°‘æä¾›ç±»å‹è½¬æ¢è¿ç®—ç¬¦ã€‚ç„¶è€Œè¿™æ¡ç»éªŒæ³•åˆ™å­˜åœ¨ä¸€ç§ä¾‹å¤–æƒ…å†µï¼šå¯¹äºç±»æ¥è¯´ï¼Œå®šä¹‰å‘boolçš„ç±»å‹è½¬æ¢è¿˜æ˜¯æ¯”è¾ƒæ™®éçš„ç°è±¡ã€‚</p><p>åœ¨C++æ ‡å‡†çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚æœç±»æƒ³å®šä¹‰ä¸€ä¸ªå‘boolçš„ç±»å‹è½¬æ¢ï¼Œåˆ™å®ƒå¸¸å¸¸é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šå› ä¸ºboolæ˜¯ä¸€ç§ç®—æœ¯ç±»å‹ï¼Œæ‰€ä»¥ç±»ç±»å‹çš„å¯¹è±¡è½¬æ¢æˆboolåå°±èƒ½è¢«ç”¨åœ¨ä»»ä½•éœ€è¦ç®—æœ¯ç±»å‹çš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ ·çš„ç±»å‹è½¬æ¢å¯èƒ½å¼•å‘æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œç‰¹åˆ«æ˜¯å½“istreamå«æœ‰å‘boolçš„ç±»å‹è½¬æ¢æ—¶ï¼Œä¸‹é¢çš„ä»£ç ä»å°†ç¼–è¯‘é€šè¿‡</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929144657953.png"></p><p>è¯¥ä»£ç èƒ½ä½¿ç”¨istreamçš„boolç±»å‹è½¬æ¢è¿ç®—ç¬¦å°†cinè½¬æ¢æˆboolï¼Œè€Œè¿™ä¸ªboolå€¼æ¥ç€ä¼šè¢«æå‡æˆintå¹¶ç”¨ä½œå†…ç½®çš„å·¦ç§»è¿ç®—ç¬¦çš„å·¦ä¾§è¿ç®—å¯¹è±¡ã€‚è¿™æ ·ä¸€æ¥ï¼Œæå‡åçš„boolå€¼ï¼ˆ1æˆ–0ï¼‰æœ€ç»ˆä¼šè¢«å·¦ç§»42ä¸ªä½ç½®ã€‚è¿™ä¸€ç»“æœæ˜¾ç„¶ä¸æˆ‘ä»¬çš„é¢„æœŸå¤§ç›¸å¾„åº­ã€‚</p><p><strong>æ˜¾å¼çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦</strong></p><p>ä¸ºäº†é˜²æ­¢è¿™æ ·çš„å¼‚å¸¸æƒ…å†µå‘ç”Ÿï¼ŒC++11æ–°æ ‡å‡†å¼•å…¥äº†<strong>æ˜¾å¼çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼ˆexplicit conversion operatorï¼‰</strong></p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929144747752.png"></p><p>å’Œæ˜¾å¼çš„æ„é€ å‡½æ•°ï¼ˆå‚è§7.5.4èŠ‚ï¼Œç¬¬265é¡µï¼‰ä¸€æ ·ï¼Œç¼–è¯‘å™¨ï¼ˆé€šå¸¸ï¼‰ä¹Ÿä¸ä¼šå°†ä¸€ä¸ªæ˜¾å¼çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ç”¨äºéšå¼ç±»å‹è½¬æ¢</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929144814005.png"></p><p>è¯¥è§„å®šå­˜åœ¨ä¸€ä¸ªä¾‹å¤–ï¼Œå³å¦‚æœè¡¨è¾¾å¼è¢«ç”¨ä½œæ¡ä»¶ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šå°†æ˜¾å¼çš„ç±»å‹è½¬æ¢è‡ªåŠ¨åº”ç”¨äºå®ƒã€‚æ¢å¥è¯è¯´ï¼Œå½“è¡¨è¾¾å¼å‡ºç°åœ¨ä¸‹åˆ—ä½ç½®æ—¶ï¼Œæ˜¾å¼çš„ç±»å‹è½¬æ¢å°†è¢«éšå¼åœ°æ‰§è¡Œï¼š</p><ul><li>ifã€whileåŠdoè¯­å¥çš„æ¡ä»¶éƒ¨åˆ†</li><li>forè¯­å¥å¤´çš„æ¡ä»¶è¡¨è¾¾å¼</li><li>é€»è¾‘éè¿ç®—ç¬¦ï¼ˆï¼ï¼‰ã€é€»è¾‘æˆ–è¿ç®—ç¬¦ï¼ˆ||ï¼‰ã€é€»è¾‘ä¸è¿ç®—ç¬¦ï¼ˆ&amp;&amp;ï¼‰çš„è¿ç®—å¯¹è±¡</li><li>æ¡ä»¶è¿ç®—ç¬¦ï¼ˆï¼Ÿ ï¼šï¼‰çš„æ¡ä»¶è¡¨è¾¾å¼ã€‚</li></ul><p><strong>è½¬æ¢ä¸ºbool</strong></p><p>å‘boolçš„ç±»å‹è½¬æ¢é€šå¸¸ç”¨åœ¨æ¡ä»¶éƒ¨åˆ†ï¼Œå› æ­¤operator boolä¸€èˆ¬å®šä¹‰æˆexplicitçš„ã€‚</p><h3 id="14-9-2-é¿å…æœ‰äºŒä¹‰æ€§çš„ç±»å‹è½¬æ¢"><a href="#14-9-2-é¿å…æœ‰äºŒä¹‰æ€§çš„ç±»å‹è½¬æ¢" class="headerlink" title="14.9.2 é¿å…æœ‰äºŒä¹‰æ€§çš„ç±»å‹è½¬æ¢"></a>14.9.2 é¿å…æœ‰äºŒä¹‰æ€§çš„ç±»å‹è½¬æ¢</h3><p>å¦‚æœç±»ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹è½¬æ¢ï¼Œåˆ™å¿…é¡»ç¡®ä¿åœ¨ç±»ç±»å‹å’Œç›®æ ‡ç±»å‹ä¹‹é—´åªå­˜åœ¨å”¯ä¸€ä¸€ç§è½¬æ¢æ–¹å¼ã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç å°†å¾ˆå¯èƒ½ä¼šå…·æœ‰äºŒä¹‰æ€§ã€‚</p><p>åœ¨ä¸¤ç§æƒ…å†µä¸‹å¯èƒ½äº§ç”Ÿå¤šé‡è½¬æ¢è·¯å¾„</p><ol><li>ä¸¤ä¸ªç±»æä¾›ç›¸åŒçš„ç±»å‹è½¬æ¢ï¼šä¾‹å¦‚ï¼Œå½“Aç±»å®šä¹‰äº†ä¸€ä¸ªæ¥å—Bç±»å¯¹è±¡çš„è½¬æ¢æ„é€ å‡½æ•°ï¼ŒåŒæ—¶Bç±»å®šä¹‰äº†ä¸€ä¸ªè½¬æ¢ç›®æ ‡æ˜¯Aç±»çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦æ—¶ï¼Œæˆ‘ä»¬å°±è¯´å®ƒä»¬æä¾›äº†ç›¸åŒçš„ç±»å‹è½¬æ¢ã€‚</li><li>ç±»å®šä¹‰äº†å¤šä¸ªè½¬æ¢è§„åˆ™ï¼Œè€Œè¿™äº›è½¬æ¢æ¶‰åŠçš„ç±»å‹æœ¬èº«å¯ä»¥é€šè¿‡å…¶ä»–ç±»å‹è½¬æ¢è”ç³»åœ¨ä¸€èµ·ã€‚æœ€å…¸å‹çš„ä¾‹å­æ˜¯ç®—æœ¯è¿ç®—ç¬¦ï¼Œå¯¹æŸä¸ªç»™å®šçš„ç±»æ¥è¯´ï¼Œæœ€å¥½åªå®šä¹‰æœ€å¤šä¸€ä¸ªä¸ç®—æœ¯ç±»å‹æœ‰å…³çš„è½¬æ¢è§„åˆ™ã€‚</li></ol><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929145127895.png"></p><p><strong>äºŒä¹‰æ€§ä¸è½¬æ¢ç›®æ ‡ä¸ºå†…ç½®ç±»å‹çš„å¤šé‡ç±»å‹è½¬æ¢</strong></p><p>ç±»å½“ä¸­å®šä¹‰äº†å¤šä¸ªå‚æ•°éƒ½æ˜¯ç®—æœ¯ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œæˆ–è€…è½¬æ¢ç›®æ ‡éƒ½æ˜¯ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929145239750.png"></p><p><strong>æç¤ºï¼šç±»å‹è½¬æ¢ä¸è¿ç®—ç¬¦</strong></p><ul><li>ä¸è¦ä»¤ä¸¤ä¸ªç±»æ‰§è¡Œç›¸åŒçš„ç±»å‹è½¬æ¢ï¼šå¦‚æœFooç±»æœ‰ä¸€ä¸ªæ¥å—Barç±»å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œåˆ™ä¸è¦åœ¨Barç±»ä¸­å†å®šä¹‰è½¬æ¢ç›®æ ‡æ˜¯Fooç±»çš„ç±»å‹è½¬æ¢è¿ç®—ç¬¦ã€‚</li><li>é¿å…è½¬æ¢ç›®æ ‡æ˜¯å†…ç½®ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢ã€‚ç‰¹åˆ«æ˜¯å½“ä½ å·²ç»å®šä¹‰äº†ä¸€ä¸ªè½¬æ¢æˆç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢æ—¶ï¼Œæ¥ä¸‹æ¥<ul><li>ä¸è¦å†å®šä¹‰æ¥å—ç®—æœ¯ç±»å‹çš„é‡è½½è¿ç®—ç¬¦ã€‚å¦‚æœç”¨æˆ·éœ€è¦ä½¿ç”¨è¿™æ ·çš„è¿ç®—ç¬¦ï¼Œåˆ™ç±»å‹è½¬æ¢æ“ä½œå°†è½¬æ¢ä½ çš„ç±»å‹çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨å†…ç½®çš„è¿ç®—ç¬¦ã€‚</li><li>ä¸è¦å®šä¹‰è½¬æ¢åˆ°å¤šç§ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢ã€‚è®©æ ‡å‡†ç±»å‹è½¬æ¢å®Œæˆå‘å…¶ä»–ç®—æœ¯ç±»å‹è½¬æ¢çš„å·¥ä½œã€‚</li></ul></li></ul><p>ä¸€è¨€ä»¥è”½ä¹‹ï¼šé™¤äº†æ˜¾å¼åœ°å‘boolç±»å‹çš„è½¬æ¢ä¹‹å¤–ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…å®šä¹‰ç±»å‹è½¬æ¢å‡½æ•°å¹¶å°½å¯èƒ½åœ°é™åˆ¶é‚£äº›â€œæ˜¾ç„¶æ­£ç¡®â€çš„éæ˜¾å¼æ„é€ å‡½æ•°ã€‚</p><p><strong>é‡è½½å‡½æ•°ä¸è½¬æ¢æ„é€ å‡½æ•°</strong></p><p>å½“æˆ‘ä»¬è°ƒç”¨é‡è½½çš„å‡½æ•°æ—¶ï¼Œä»å¤šä¸ªç±»å‹è½¬æ¢ä¸­è¿›è¡Œé€‰æ‹©å°†å˜å¾—æ›´åŠ å¤æ‚ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929145705735.png"></p><div class="note note-warning">            <p>å¦‚æœåœ¨è°ƒç”¨é‡è½½å‡½æ•°æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ„é€ å‡½æ•°æˆ–è€…å¼ºåˆ¶ç±»å‹è½¬æ¢æ¥æ”¹å˜å®å‚çš„ç±»å‹ï¼Œåˆ™è¿™é€šå¸¸æ„å‘³ç€ç¨‹åºçš„è®¾è®¡å­˜åœ¨ä¸è¶³ã€‚åœ¨è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼Œå¦‚æœéœ€è¦é¢å¤–çš„æ ‡å‡†ç±»å‹è½¬æ¢ï¼Œåˆ™è¯¥è½¬æ¢çš„çº§åˆ«åªæœ‰å½“æ‰€æœ‰å¯è¡Œå‡½æ•°éƒ½è¯·æ±‚åŒä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ç±»å‹è½¬æ¢æ—¶æ‰æœ‰ç”¨ã€‚å¦‚æœæ‰€éœ€çš„ç”¨æˆ·å®šä¹‰çš„ç±»å‹è½¬æ¢ä¸æ­¢ä¸€ä¸ªï¼Œåˆ™è¯¥è°ƒç”¨å…·æœ‰äºŒä¹‰æ€§ã€‚</p>          </div><p><strong>é‡è½½å‡½æ•°ä¸ç”¨æˆ·å®šä¹‰çš„ç±»å‹è½¬æ¢</strong></p><p>å½“è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼Œå¦‚æœä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç”¨æˆ·å®šä¹‰çš„ç±»å‹è½¬æ¢éƒ½æä¾›äº†å¯è¡ŒåŒ¹é…ï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºè¿™äº›ç±»å‹è½¬æ¢ä¸€æ ·å¥½ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šè€ƒè™‘ä»»ä½•å¯èƒ½å‡ºç°çš„æ ‡å‡†ç±»å‹è½¬æ¢çš„çº§åˆ«ã€‚åªæœ‰å½“é‡è½½å‡½æ•°èƒ½é€šè¿‡åŒä¸€ä¸ªç±»å‹è½¬æ¢å‡½æ•°å¾—åˆ°åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šè€ƒè™‘å…¶ä¸­å‡ºç°çš„æ ‡å‡†ç±»å‹è½¬æ¢ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-14/image-20240929155414735.png"></p><h3 id="14-9-3-å‡½æ•°åŒ¹é…ä¸é‡è½½è¿ç®—ç¬¦"><a href="#14-9-3-å‡½æ•°åŒ¹é…ä¸é‡è½½è¿ç®—ç¬¦" class="headerlink" title="14.9.3 å‡½æ•°åŒ¹é…ä¸é‡è½½è¿ç®—ç¬¦"></a>14.9.3 å‡½æ•°åŒ¹é…ä¸é‡è½½è¿ç®—ç¬¦</h3><p>å¦‚æœæˆ‘ä»¬å¯¹åŒä¸€ä¸ªç±»æ—¢æä¾›äº†è½¬æ¢ç›®æ ‡æ˜¯ç®—æœ¯ç±»å‹çš„ç±»å‹è½¬æ¢ï¼Œä¹Ÿæä¾›äº†é‡è½½çš„è¿ç®—ç¬¦ï¼Œåˆ™å°†ä¼šé‡åˆ°é‡è½½è¿ç®—ç¬¦ä¸å†…ç½®è¿ç®—ç¬¦çš„äºŒä¹‰æ€§é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 13</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-13/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-13/</url>
    
    <content type="html"><![CDATA[<h1 id="æ‹·è´æ§åˆ¶"><a href="#æ‹·è´æ§åˆ¶" class="headerlink" title="æ‹·è´æ§åˆ¶"></a>æ‹·è´æ§åˆ¶</h1><span id="more"></span><p>ä¸€ä¸ªç±»é€šè¿‡å®šä¹‰äº”ç§ç‰¹æ®Šçš„æˆå‘˜å‡½æ•°æ¥æ§åˆ¶è¿™äº›æ“ä½œï¼ŒåŒ…æ‹¬ï¼šæ‹·è´æ„é€ å‡½æ•°ï¼ˆcopy constructorï¼‰ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼ˆcopy-assignment operatorï¼‰ã€ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆmove constructorï¼‰ã€ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼ˆmove-assignment operatorï¼‰å’Œææ„å‡½æ•°ï¼ˆdestructorï¼‰ã€‚</p><h2 id="13-1-æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯"><a href="#13-1-æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯" class="headerlink" title="13.1 æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯"></a>13.1 æ‹·è´ã€èµ‹å€¼ä¸é”€æ¯</h2><h3 id="13-1-1-æ‹·è´æ„é€ å‡½æ•°"><a href="#13-1-1-æ‹·è´æ„é€ å‡½æ•°" class="headerlink" title="13.1.1 æ‹·è´æ„é€ å‡½æ•°"></a>13.1.1 æ‹·è´æ„é€ å‡½æ•°</h3><p>å¦‚æœä¸€ä¸ªæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è‡ªèº«ç±»ç±»å‹çš„å¼•ç”¨ï¼Œä¸”ä»»ä½•é¢å¤–å‚æ•°éƒ½æœ‰é»˜è®¤å€¼ï¼Œåˆ™æ­¤æ„é€ å‡½æ•°æ˜¯æ‹·è´æ„é€ å‡½æ•°ã€‚</p><p>æ‹·è´æ„é€ å‡½æ•°çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹</strong>ï¼ŒåŸå› æˆ‘ä»¬ç¨åè§£é‡Šã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å—éconstå¼•ç”¨çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä½†æ­¤å‚æ•°<strong>å‡ ä¹æ€»æ˜¯ä¸€ä¸ªconstçš„å¼•ç”¨</strong>ã€‚æ‹·è´æ„é€ å‡½æ•°åœ¨å‡ ç§æƒ…å†µä¸‹éƒ½ä¼šè¢«éšå¼åœ°ä½¿ç”¨ã€‚å› æ­¤ï¼Œæ‹·è´æ„é€ å‡½æ•°<strong>é€šå¸¸ä¸åº”è¯¥æ˜¯explicitçš„</strong>ï¼ˆå‚è§7.5.4èŠ‚ï¼Œç¬¬265é¡µï¼‰ã€‚</p><p><strong>åˆæˆæ‹·è´æ„é€ å‡½æ•°</strong></p><p>å³ä½¿æˆ‘ä»¬å®šä¹‰äº†å…¶ä»–æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šä¸ºæˆ‘ä»¬åˆæˆä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°ã€‚</p><p>13.1.6èŠ‚ï¼ˆç¬¬450é¡µï¼‰ä¸­æ‰€è§ï¼Œå¯¹æŸäº›ç±»æ¥è¯´ï¼Œåˆæˆæ‹·è´æ„é€ å‡½æ•°ï¼ˆsynthesized copy constructorï¼‰ç”¨æ¥é˜»æ­¢æˆ‘ä»¬æ‹·è´è¯¥ç±»ç±»å‹çš„å¯¹è±¡ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ‹·è´ä¸€ä¸ªæ•°ç»„ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬102é¡µï¼‰ï¼Œä½†åˆæˆæ‹·è´æ„é€ å‡½æ•°ä¼šé€å…ƒç´ åœ°æ‹·è´ä¸€ä¸ªæ•°ç»„ç±»å‹çš„æˆå‘˜ã€‚</p><p><strong>æ‹·è´åˆå§‹åŒ–</strong></p><p>å½“ä½¿ç”¨ç›´æ¥åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯è¦æ±‚ç¼–è¯‘å™¨ä½¿ç”¨æ™®é€šçš„å‡½æ•°åŒ¹é…ï¼ˆå‚è§6.4èŠ‚ï¼Œç¬¬209é¡µï¼‰æ¥é€‰æ‹©ä¸æˆ‘ä»¬æä¾›çš„å‚æ•°æœ€åŒ¹é…çš„æ„é€ å‡½æ•°ã€‚å½“æˆ‘ä»¬ä½¿ç”¨æ‹·è´åˆå§‹åŒ–ï¼ˆcopy initializationï¼‰æ—¶ï¼Œæˆ‘ä»¬è¦æ±‚ç¼–è¯‘å™¨å°†å³ä¾§è¿ç®—å¯¹è±¡æ‹·è´åˆ°æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡ä¸­ï¼Œå¦‚æœéœ€è¦çš„è¯è¿˜è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼ˆå‚è§7.5.4èŠ‚ï¼Œç¬¬263é¡µï¼‰ã€‚</p><p>æ‹·è´åˆå§‹åŒ–ä¸ä»…åœ¨æˆ‘ä»¬ç”¨&#x3D;å®šä¹‰å˜é‡æ—¶ä¼šå‘ç”Ÿï¼Œåœ¨ä¸‹åˆ—æƒ…å†µä¸‹ä¹Ÿä¼šå‘ç”Ÿ</p><ul><li>å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå®å‚ä¼ é€’ç»™ä¸€ä¸ªéå¼•ç”¨ç±»å‹çš„å½¢å‚</li><li>ä»ä¸€ä¸ªè¿”å›ç±»å‹ä¸ºéå¼•ç”¨ç±»å‹çš„å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡</li><li>ç”¨èŠ±æ‹¬å·åˆ—è¡¨åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ æˆ–ä¸€ä¸ªèšåˆç±»ä¸­çš„æˆå‘˜ï¼ˆå‚è§7.5.5èŠ‚ï¼Œç¬¬266é¡µï¼‰</li></ul><p>å½“æˆ‘ä»¬åˆå§‹åŒ–æ ‡å‡†åº“å®¹å™¨æˆ–æ˜¯è°ƒç”¨å…¶insertæˆ–pushæˆå‘˜ï¼ˆå‚è§9.3.1èŠ‚ï¼Œç¬¬306é¡µï¼‰æ—¶ï¼Œå®¹å™¨ä¼šå¯¹å…¶å…ƒç´ è¿›è¡Œæ‹·è´åˆå§‹åŒ–ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œç”¨emplaceæˆå‘˜åˆ›å»ºçš„å…ƒç´ éƒ½è¿›è¡Œç›´æ¥åˆå§‹åŒ–ï¼ˆå‚è§9.3.1èŠ‚ï¼Œç¬¬308é¡µï¼‰ã€‚</p><p><strong>å‚æ•°å’Œè¿”å›å€¼</strong></p><p>åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå…·æœ‰éå¼•ç”¨ç±»å‹çš„å‚æ•°è¦è¿›è¡Œæ‹·è´åˆå§‹åŒ–ï¼ˆå‚è§6.2.1èŠ‚ï¼Œç¬¬188é¡µï¼‰ã€‚ç±»ä¼¼çš„ï¼Œå½“ä¸€ä¸ªå‡½æ•°å…·æœ‰éå¼•ç”¨çš„è¿”å›ç±»å‹æ—¶ï¼Œè¿”å›å€¼ä¼šè¢«ç”¨æ¥åˆå§‹åŒ–è°ƒç”¨æ–¹çš„ç»“æœï¼ˆå‚è§6.3.2èŠ‚ï¼Œç¬¬201é¡µï¼‰ã€‚</p><p>æ‹·è´æ„é€ å‡½æ•°è¢«ç”¨æ¥åˆå§‹åŒ–éå¼•ç”¨ç±»ç±»å‹å‚æ•°ï¼Œè¿™ä¸€ç‰¹æ€§è§£é‡Šäº†ä¸ºä»€ä¹ˆæ‹·è´æ„é€ å‡½æ•°è‡ªå·±çš„å‚æ•°å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ã€‚</p><p><strong>æ‹·è´åˆå§‹åŒ–çš„é™åˆ¶</strong></p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„åˆå§‹åŒ–å€¼è¦æ±‚é€šè¿‡ä¸€ä¸ªexplicitçš„æ„é€ å‡½æ•°æ¥è¿›è¡Œç±»å‹è½¬æ¢ï¼ˆå‚è§7.5.4èŠ‚ï¼Œç¬¬265é¡µï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨æ‹·è´åˆå§‹åŒ–è¿˜æ˜¯ç›´æ¥åˆå§‹åŒ–å°±ä¸æ˜¯æ— å…³ç´§è¦çš„äº†</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240921002325205.png"></p><p><strong>ç¼–è¯‘å™¨å¯ä»¥ç»•è¿‡æ‹·è´æ„é€ å‡½æ•°</strong></p><p>åœ¨æ‹·è´åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å¯ä»¥ï¼ˆä½†ä¸æ˜¯å¿…é¡»ï¼‰è·³è¿‡æ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œç›´æ¥åˆ›å»ºå¯¹è±¡ã€‚</p><p>ä½†æ˜¯ï¼Œå³ä½¿ç¼–è¯‘å™¨ç•¥è¿‡äº†æ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä½†åœ¨è¿™ä¸ªç¨‹åºç‚¹ä¸Šï¼Œæ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°å¿…é¡»æ˜¯å­˜åœ¨ä¸”å¯è®¿é—®çš„ï¼ˆä¾‹å¦‚ï¼Œä¸èƒ½æ˜¯privateçš„ï¼‰ã€‚</p><h3 id="13-1-2-æ‹·è´èµ‹å€¼è¿ç®—ç¬¦"><a href="#13-1-2-æ‹·è´èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="13.1.2 æ‹·è´èµ‹å€¼è¿ç®—ç¬¦"></a>13.1.2 æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</h3><p>å¦‚æœç±»æœªå®šä¹‰è‡ªå·±çš„æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå®ƒåˆæˆä¸€ä¸ªã€‚</p><p><strong>é‡è½½èµ‹å€¼è¿ç®—ç¬¦</strong></p><p>é‡è½½è¿ç®—ç¬¦æœ¬è´¨ä¸Šæ˜¯å‡½æ•°ï¼Œå…¶åå­—ç”±operatorå…³é”®å­—åæ¥è¡¨ç¤ºè¦å®šä¹‰çš„è¿ç®—ç¬¦çš„ç¬¦å·ç»„æˆã€‚</p><p>æŸäº›è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬èµ‹å€¼è¿ç®—ç¬¦ï¼Œå¿…é¡»å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªè¿ç®—ç¬¦æ˜¯ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œå…¶å·¦ä¾§è¿ç®—å¯¹è±¡å°±ç»‘å®šåˆ°éšå¼çš„thiså‚æ•°ï¼ˆå‚è§7.1.2èŠ‚ï¼Œç¬¬231é¡µï¼‰ã€‚å¯¹äºä¸€ä¸ªäºŒå…ƒè¿ç®—ç¬¦ï¼Œä¾‹å¦‚èµ‹å€¼è¿ç®—ç¬¦ï¼Œå…¶å³ä¾§è¿ç®—å¯¹è±¡ä½œä¸ºæ˜¾å¼å‚æ•°ä¼ é€’ã€‚</p><p>ä¸ºäº†ä¸å†…ç½®ç±»å‹çš„èµ‹å€¼ï¼ˆå‚è§4.4èŠ‚ï¼Œç¬¬129é¡µï¼‰ä¿æŒä¸€è‡´ï¼Œèµ‹å€¼è¿ç®—ç¬¦é€šå¸¸<strong>è¿”å›ä¸€ä¸ªæŒ‡å‘å…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p><p><strong>æ ‡å‡†åº“é€šå¸¸è¦æ±‚ä¿å­˜åœ¨å®¹å™¨ä¸­çš„ç±»å‹è¦å…·æœ‰èµ‹å€¼è¿ç®—ç¬¦ï¼Œä¸”å…¶è¿”å›å€¼æ˜¯å·¦ä¾§è¿ç®—å¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p><blockquote><p>èµ‹å€¼è¿ç®—ç¬¦é€šå¸¸åº”è¯¥è¿”å›ä¸€ä¸ªæŒ‡å‘å…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„å¼•ç”¨ã€‚</p></blockquote><p><strong>åˆæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦</strong></p><p>å¯¹äºæ•°ç»„ç±»å‹çš„æˆå‘˜ï¼Œé€ä¸ªèµ‹å€¼æ•°ç»„å…ƒç´ ã€‚åˆæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦è¿”å›ä¸€ä¸ªæŒ‡å‘å…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„å¼•ç”¨ã€‚</p><h3 id="13-1-3-ææ„å‡½æ•°"><a href="#13-1-3-ææ„å‡½æ•°" class="headerlink" title="13.1.3 ææ„å‡½æ•°"></a>13.1.3 ææ„å‡½æ•°</h3><p>ææ„å‡½æ•°æ‰§è¡Œä¸æ„é€ å‡½æ•°ç›¸åçš„æ“ä½œï¼šæ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡çš„éstaticæ•°æ®æˆå‘˜ï¼Œè¿˜å¯èƒ½åšä¸€äº›å…¶ä»–å·¥ä½œï¼›ææ„å‡½æ•°é‡Šæ”¾å¯¹è±¡ä½¿ç”¨çš„èµ„æºï¼Œå¹¶é”€æ¯å¯¹è±¡çš„éstaticæ•°æ®æˆå‘˜ã€‚</p><p>ææ„å‡½æ•°æ˜¯ç±»çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œåå­—ç”±æ³¢æµªå·æ¥ç±»åæ„æˆã€‚å®ƒæ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿä¸æ¥å—å‚æ•°</p><p>ç”±äºææ„å‡½æ•°ä¸æ¥å—å‚æ•°ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«é‡è½½ã€‚å¯¹ä¸€ä¸ªç»™å®šç±»ï¼Œåªä¼šæœ‰å”¯ä¸€ä¸€ä¸ªææ„å‡½æ•°ã€‚</p><p><strong>ææ„å‡½æ•°å®Œæˆä»€ä¹ˆå·¥ä½œ</strong></p><p>å¦‚åŒæ„é€ å‡½æ•°æœ‰ä¸€ä¸ªåˆå§‹åŒ–éƒ¨åˆ†å’Œä¸€ä¸ªå‡½æ•°ä½“ï¼ˆå‚è§7.5.1èŠ‚ï¼Œç¬¬257é¡µï¼‰ï¼Œææ„å‡½æ•°ä¹Ÿæœ‰ä¸€ä¸ªå‡½æ•°ä½“å’Œä¸€ä¸ªææ„éƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œæˆå‘˜çš„åˆå§‹åŒ–æ˜¯åœ¨å‡½æ•°ä½“æ‰§è¡Œä¹‹å‰å®Œæˆçš„ï¼Œä¸”æŒ‰ç…§å®ƒä»¬åœ¨ç±»ä¸­å‡ºç°çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ã€‚<strong>åœ¨ä¸€ä¸ªææ„å‡½æ•°ä¸­ï¼Œé¦–å…ˆæ‰§è¡Œå‡½æ•°ä½“ï¼Œç„¶åé”€æ¯æˆå‘˜ã€‚æˆå‘˜æŒ‰åˆå§‹åŒ–é¡ºåºçš„é€†åºé”€æ¯ã€‚</strong></p><p><strong>ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨ææ„å‡½æ•°</strong></p><p>æ— è®ºä½•æ—¶ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨å…¶ææ„å‡½æ•°ï¼š</p><ul><li>å˜é‡åœ¨ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶è¢«é”€æ¯ã€‚</li><li>å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå…¶æˆå‘˜è¢«é”€æ¯ã€‚</li><li>å®¹å™¨ï¼ˆæ— è®ºæ˜¯æ ‡å‡†åº“å®¹å™¨è¿˜æ˜¯æ•°ç»„ï¼‰è¢«é”€æ¯æ—¶ï¼Œå…¶å…ƒç´ è¢«é”€æ¯ã€‚</li><li>å¯¹äºåŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼Œå½“å¯¹æŒ‡å‘å®ƒçš„æŒ‡é’ˆåº”ç”¨deleteè¿ç®—ç¬¦æ—¶è¢«é”€æ¯ï¼ˆå‚è§12.1.2èŠ‚ï¼Œç¬¬409é¡µï¼‰ã€‚</li><li>å¯¹äºä¸´æ—¶å¯¹è±¡ï¼Œå½“åˆ›å»ºå®ƒçš„å®Œæ•´è¡¨è¾¾å¼ç»“æŸæ—¶è¢«é”€æ¯ã€‚</li></ul><p><strong>åˆæˆææ„å‡½æ•°</strong></p><p>ç±»ä¼¼æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œå¯¹äºæŸäº›ç±»ï¼Œåˆæˆææ„å‡½æ•°è¢«ç”¨æ¥é˜»æ­¢è¯¥ç±»å‹çš„å¯¹è±¡è¢«é”€æ¯ï¼ˆå‚è§13.1.6èŠ‚ï¼Œç¬¬450é¡µï¼‰ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆæˆææ„å‡½æ•°çš„å‡½æ•°ä½“å°±ä¸ºç©ºã€‚</p><p>è®¤è¯†åˆ°<strong>ææ„å‡½æ•°ä½“è‡ªèº«å¹¶ä¸ç›´æ¥é”€æ¯æˆå‘˜æ˜¯éå¸¸é‡è¦çš„ã€‚</strong>æˆå‘˜æ˜¯åœ¨ææ„å‡½æ•°ä½“ä¹‹åéšå«çš„ææ„é˜¶æ®µä¸­è¢«é”€æ¯çš„ã€‚åœ¨æ•´ä¸ªå¯¹è±¡é”€æ¯è¿‡ç¨‹ä¸­ï¼Œææ„å‡½æ•°ä½“æ˜¯ä½œä¸ºæˆå‘˜é”€æ¯æ­¥éª¤ä¹‹å¤–çš„å¦ä¸€éƒ¨åˆ†è€Œè¿›è¡Œçš„ã€‚</p><h3 id="13-1-4-ä¸‰-äº”æ³•åˆ™"><a href="#13-1-4-ä¸‰-äº”æ³•åˆ™" class="headerlink" title="13.1.4 ä¸‰&#x2F;äº”æ³•åˆ™"></a>13.1.4 ä¸‰&#x2F;äº”æ³•åˆ™</h3><p>æœ‰ä¸‰ä¸ªåŸºæœ¬æ“ä½œå¯ä»¥æ§åˆ¶ç±»çš„æ‹·è´æ“ä½œï¼šæ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦å’Œææ„å‡½æ•°ã€‚è€Œä¸”ï¼Œåœ¨æ–°æ ‡å‡†ä¸‹ï¼Œä¸€ä¸ªç±»è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªç§»åŠ¨æ„é€ å‡½æ•°å’Œä¸€ä¸ªç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å°†åœ¨13.6èŠ‚ï¼ˆç¬¬470é¡µï¼‰ä¸­ä»‹ç»è¿™äº›å†…å®¹ã€‚</p><p><strong>éœ€è¦ææ„å‡½æ•°çš„ç±»ä¹Ÿéœ€è¦æ‹·è´å’Œèµ‹å€¼æ“ä½œ</strong></p><p><strong>éœ€è¦æ‹·è´æ“ä½œçš„ç±»ä¹Ÿéœ€è¦èµ‹å€¼æ“ä½œï¼Œåä¹‹äº¦ç„¶</strong></p><p>æ— è®ºæ˜¯éœ€è¦æ‹·è´æ„é€ å‡½æ•°è¿˜æ˜¯éœ€è¦æ‹·è´èµ‹å€¼è¿ç®—ç¬¦éƒ½ä¸å¿…ç„¶æ„å‘³ç€ä¹Ÿéœ€è¦ææ„å‡½æ•°ã€‚</p><h3 id="13-1-5-ä½¿ç”¨-default"><a href="#13-1-5-ä½¿ç”¨-default" class="headerlink" title="13.1.5 ä½¿ç”¨&#x3D;default"></a>13.1.5 ä½¿ç”¨&#x3D;default</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ‹·è´æ§åˆ¶æˆå‘˜å®šä¹‰ä¸º&#x3D;defaultæ¥æ˜¾å¼åœ°è¦æ±‚ç¼–è¯‘å™¨ç”Ÿæˆåˆæˆçš„ç‰ˆæœ¬ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬237é¡µï¼‰</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240921004332914.png"></p><p>å½“æˆ‘ä»¬åœ¨ç±»å†…ç”¨&#x3D;defaultä¿®é¥°æˆå‘˜çš„å£°æ˜æ—¶ï¼Œåˆæˆçš„å‡½æ•°å°†éšå¼åœ°å£°æ˜ä¸ºå†…è”çš„ï¼ˆå°±åƒä»»ä½•å…¶ä»–ç±»å†…å£°æ˜çš„æˆå‘˜å‡½æ•°ä¸€æ ·ï¼‰ã€‚å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›åˆæˆçš„æˆå‘˜æ˜¯å†…è”å‡½æ•°ï¼Œåº”è¯¥åªå¯¹æˆå‘˜çš„ç±»å¤–å®šä¹‰ä½¿ç”¨&#x3D;defaultï¼Œå°±åƒå¯¹æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æ‰€åšçš„é‚£æ ·ã€‚</p><h3 id="13-1-6-é˜»æ­¢æ‹·è´"><a href="#13-1-6-é˜»æ­¢æ‹·è´" class="headerlink" title="13.1.6 é˜»æ­¢æ‹·è´"></a>13.1.6 é˜»æ­¢æ‹·è´</h3><blockquote><p>å¤§å¤šæ•°ç±»åº”è¯¥å®šä¹‰é»˜è®¤æ„é€ å‡½æ•°ã€æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œæ— è®ºæ˜¯éšå¼åœ°è¿˜æ˜¯æ˜¾å¼åœ°ã€‚</p></blockquote><p>å¯¹æŸäº›ç±»æ¥è¯´ï¼Œè¿™äº›æ“ä½œæ²¡æœ‰åˆç†çš„æ„ä¹‰ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®šä¹‰ç±»æ—¶å¿…é¡»é‡‡ç”¨æŸç§æœºåˆ¶é˜»æ­¢æ‹·è´æˆ–èµ‹å€¼ã€‚ä¾‹å¦‚ï¼Œiostreamç±»é˜»æ­¢äº†æ‹·è´ï¼Œä»¥é¿å…å¤šä¸ªå¯¹è±¡å†™å…¥æˆ–è¯»å–ç›¸åŒçš„IOç¼“å†²ã€‚</p><p><strong>å®šä¹‰åˆ é™¤çš„å‡½æ•°</strong></p><p>åœ¨æ–°æ ‡å‡†ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦å®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°ï¼ˆdeleted functionï¼‰æ¥é˜»æ­¢æ‹·è´ã€‚åˆ é™¤çš„å‡½æ•°æ˜¯è¿™æ ·ä¸€ç§å‡½æ•°ï¼šæˆ‘ä»¬è™½ç„¶å£°æ˜äº†å®ƒä»¬ï¼Œä½†ä¸èƒ½ä»¥ä»»ä½•æ–¹å¼ä½¿ç”¨å®ƒä»¬ã€‚åœ¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨åé¢åŠ ä¸Š&#x3D;deleteæ¥æŒ‡å‡ºæˆ‘ä»¬å¸Œæœ›å°†å®ƒå®šä¹‰ä¸ºåˆ é™¤çš„</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240921004625361.png"></p><p><strong>ä¸&#x3D;defaultä¸åŒï¼Œ&#x3D;deleteå¿…é¡»å‡ºç°åœ¨å‡½æ•°ç¬¬ä¸€æ¬¡å£°æ˜çš„æ—¶å€™</strong></p><p>ä¸&#x3D;defaultçš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å‡½æ•°æŒ‡å®š&#x3D;deleteï¼ˆæˆ‘ä»¬åªèƒ½å¯¹ç¼–è¯‘å™¨å¯ä»¥åˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°æˆ–æ‹·è´æ§åˆ¶æˆå‘˜ä½¿ç”¨&#x3D;defaultï¼‰ã€‚è™½ç„¶åˆ é™¤å‡½æ•°çš„ä¸»è¦ç”¨é€”æ˜¯ç¦æ­¢æ‹·è´æ§åˆ¶æˆå‘˜ï¼Œä½†å½“æˆ‘ä»¬å¸Œæœ›å¼•å¯¼å‡½æ•°åŒ¹é…è¿‡ç¨‹æ—¶ï¼Œåˆ é™¤å‡½æ•°æœ‰æ—¶ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚</p><p><strong>ææ„å‡½æ•°ä¸èƒ½æ˜¯åˆ é™¤çš„æˆå‘˜</strong></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åˆ é™¤ææ„å‡½æ•°ã€‚</p><p>å¯¹äºåˆ é™¤äº†ææ„å‡½æ•°çš„ç±»å‹ï¼Œè™½ç„¶æˆ‘ä»¬ä¸èƒ½å®šä¹‰è¿™ç§ç±»å‹çš„å˜é‡æˆ–æˆå‘˜ï¼Œä½†å¯ä»¥åŠ¨æ€åˆ†é…è¿™ç§ç±»å‹çš„å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä¸èƒ½é‡Šæ”¾è¿™äº›å¯¹è±¡</p><p><strong>åˆæˆçš„æ‹·è´æ§åˆ¶æˆå‘˜å¯èƒ½æ˜¯åˆ é™¤çš„</strong></p><p>å¯¹æŸäº›ç±»æ¥è¯´ï¼Œç¼–è¯‘å™¨å°†è¿™äº›åˆæˆçš„æˆå‘˜å®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°ï¼š</p><ul><li>å¦‚æœç±»çš„æŸä¸ªæˆå‘˜çš„<strong>ææ„å‡½æ•°</strong>æ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼ˆä¾‹å¦‚ï¼Œæ˜¯privateçš„ï¼‰ï¼Œåˆ™ç±»çš„åˆæˆææ„å‡½æ•°è¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</li><li>å¦‚æœç±»çš„æŸä¸ªæˆå‘˜çš„<strong>æ‹·è´æ„é€ å‡½æ•°</strong>æ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼Œåˆ™ç±»çš„åˆæˆæ‹·è´æ„é€ å‡½æ•°è¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</li><li>å¦‚æœç±»çš„æŸä¸ªæˆå‘˜çš„<strong>ææ„å‡½æ•°</strong>æ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼Œåˆ™ç±»åˆæˆçš„æ‹·è´æ„é€ å‡½æ•°ä¹Ÿè¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</li><li>å¦‚æœç±»çš„æŸä¸ªæˆå‘˜çš„<strong>æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</strong>æ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼Œæˆ–æ˜¯ç±»æœ‰ä¸€ä¸ªconstçš„æˆ–å¼•ç”¨æˆå‘˜ï¼Œåˆ™ç±»çš„åˆæˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦è¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</li><li>å¦‚æœç±»çš„æŸä¸ªæˆå‘˜çš„<strong>ææ„å‡½æ•°</strong>æ˜¯åˆ é™¤çš„æˆ–ä¸å¯è®¿é—®çš„ï¼Œæˆ–æ˜¯ç±»æœ‰ä¸€ä¸ªå¼•ç”¨æˆå‘˜ï¼Œå®ƒæ²¡æœ‰ç±»å†…åˆå§‹åŒ–å™¨ï¼ˆå‚è§2.6.1èŠ‚ï¼Œç¬¬65é¡µï¼‰ï¼Œæˆ–æ˜¯ç±»æœ‰ä¸€ä¸ªconstæˆå‘˜ï¼Œå®ƒæ²¡æœ‰ç±»å†…åˆå§‹åŒ–å™¨ä¸”å…¶ç±»å‹æœªæ˜¾å¼å®šä¹‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™è¯¥ç±»çš„é»˜è®¤æ„é€ å‡½æ•°è¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</li></ul><p><strong>æœ¬è´¨ä¸Šï¼Œè¿™äº›è§„åˆ™çš„å«ä¹‰æ˜¯ï¼šå¦‚æœä¸€ä¸ªç±»æœ‰æ•°æ®æˆå‘˜ä¸èƒ½é»˜è®¤æ„é€ ã€æ‹·è´ã€å¤åˆ¶æˆ–é”€æ¯ï¼Œåˆ™å¯¹åº”çš„æˆå‘˜å‡½æ•°å°†è¢«å®šä¹‰ä¸ºåˆ é™¤çš„ã€‚</strong></p><p><strong>privateæ‹·è´æ§åˆ¶</strong></p><p>åœ¨æ–°æ ‡å‡†å‘å¸ƒä¹‹å‰ï¼Œç±»æ˜¯é€šè¿‡å°†å…¶æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦å£°æ˜ä¸ºprivateçš„æ¥é˜»æ­¢æ‹·è´</p><p>å£°æ˜ä½†ä¸å®šä¹‰ä¸€ä¸ªæˆå‘˜å‡½æ•°æ˜¯åˆæ³•çš„ï¼ˆå‚è§6.1.2èŠ‚ï¼Œç¬¬186é¡µï¼‰ï¼Œå¯¹æ­¤åªæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œæˆ‘ä»¬å°†åœ¨15.2.1èŠ‚ï¼ˆç¬¬528é¡µï¼‰ä¸­ä»‹ç»ã€‚è¯•å›¾è®¿é—®ä¸€ä¸ªæœªå®šä¹‰çš„æˆå‘˜å°†å¯¼è‡´ä¸€ä¸ªé“¾æ¥æ—¶é”™è¯¯ã€‚é€šè¿‡å£°æ˜ï¼ˆä½†ä¸å®šä¹‰ï¼‰privateçš„æ‹·è´æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆé˜»æ­¢ä»»ä½•æ‹·è´è¯¥ç±»å‹å¯¹è±¡çš„ä¼å›¾ï¼šè¯•å›¾æ‹·è´å¯¹è±¡çš„ç”¨æˆ·ä»£ç å°†åœ¨ç¼–è¯‘é˜¶æ®µè¢«æ ‡è®°ä¸ºé”™è¯¯ï¼›æˆå‘˜å‡½æ•°æˆ–å‹å…ƒå‡½æ•°ä¸­çš„æ‹·è´æ“ä½œå°†ä¼šå¯¼è‡´é“¾æ¥æ—¶é”™è¯¯ã€‚</p><h2 id="13-2-æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†"><a href="#13-2-æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†" class="headerlink" title="13.2 æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†"></a>13.2 æ‹·è´æ§åˆ¶å’Œèµ„æºç®¡ç†</h2><p>é¦–å…ˆå¿…é¡»ç¡®å®šæ­¤ç±»å‹å¯¹è±¡çš„æ‹·è´è¯­ä¹‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼šå¯ä»¥å®šä¹‰æ‹·è´æ“ä½œï¼Œä½¿ç±»çš„è¡Œä¸ºçœ‹èµ·æ¥åƒä¸€ä¸ªå€¼æˆ–è€…åƒä¸€ä¸ªæŒ‡é’ˆã€‚</p><p>ç±»çš„è¡Œä¸ºåƒä¸€ä¸ªå€¼ï¼Œæ„å‘³ç€å®ƒåº”è¯¥ä¹Ÿæœ‰è‡ªå·±çš„çŠ¶æ€ã€‚å½“æˆ‘ä»¬æ‹·è´ä¸€ä¸ªåƒå€¼çš„å¯¹è±¡æ—¶ï¼Œå‰¯æœ¬å’ŒåŸå¯¹è±¡æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚æ”¹å˜å‰¯æœ¬ä¸ä¼šå¯¹åŸå¯¹è±¡æœ‰ä»»ä½•å½±å“ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»åˆ™å…±äº«çŠ¶æ€ã€‚å½“æˆ‘ä»¬æ‹·è´ä¸€ä¸ªè¿™ç§ç±»çš„å¯¹è±¡æ—¶ï¼Œå‰¯æœ¬å’ŒåŸå¯¹è±¡ä½¿ç”¨ç›¸åŒçš„åº•å±‚æ•°æ®ã€‚æ”¹å˜å‰¯æœ¬ä¹Ÿä¼šæ”¹å˜åŸå¯¹è±¡ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p>åœ¨æˆ‘ä»¬ä½¿ç”¨è¿‡çš„æ ‡å‡†åº“ç±»ä¸­ï¼Œæ ‡å‡†åº“å®¹å™¨å’Œstringç±»çš„è¡Œä¸ºåƒä¸€ä¸ªå€¼ã€‚è€Œä¸å‡ºæ„å¤–çš„ï¼Œshared_ptrç±»æä¾›ç±»ä¼¼æŒ‡é’ˆçš„è¡Œä¸ºï¼Œå°±åƒæˆ‘ä»¬çš„StrBlobç±»ï¼ˆå‚è§12.1.1èŠ‚ï¼Œç¬¬405é¡µï¼‰ä¸€æ ·ï¼ŒIOç±»å‹å’Œunique_pträ¸å…è®¸æ‹·è´æˆ–èµ‹å€¼ï¼Œå› æ­¤å®ƒä»¬çš„è¡Œä¸ºæ—¢ä¸åƒå€¼ä¹Ÿä¸åƒæŒ‡é’ˆã€‚</p><h3 id="13-2-1-è¡Œä¸ºåƒå€¼çš„ç±»"><a href="#13-2-1-è¡Œä¸ºåƒå€¼çš„ç±»" class="headerlink" title="13.2.1 è¡Œä¸ºåƒå€¼çš„ç±»"></a>13.2.1 è¡Œä¸ºåƒå€¼çš„ç±»</h3><p>ä¸ºäº†æä¾›ç±»å€¼çš„è¡Œä¸ºï¼Œå¯¹äºç±»ç®¡ç†çš„èµ„æºï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åº”è¯¥æ‹¥æœ‰ä¸€ä»½è‡ªå·±çš„æ‹·è´ã€‚</p><p><strong>ç±»å€¼æ‹·è´èµ‹å€¼è¿ç®—ç¬¦</strong></p><p>èµ‹å€¼è¿ç®—ç¬¦é€šå¸¸ç»„åˆäº†ææ„å‡½æ•°å’Œæ„é€ å‡½æ•°çš„æ“ä½œã€‚ç±»ä¼¼ææ„å‡½æ•°ï¼Œèµ‹å€¼æ“ä½œä¼šé”€æ¯å·¦ä¾§è¿ç®—å¯¹è±¡çš„èµ„æºã€‚ç±»ä¼¼æ‹·è´æ„é€ å‡½æ•°ï¼Œèµ‹å€¼æ“ä½œä¼šä»å³ä¾§è¿ç®—å¯¹è±¡æ‹·è´æ•°æ®ã€‚ä½†æ˜¯ï¼Œ<strong>éå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™äº›æ“ä½œæ˜¯ä»¥æ­£ç¡®çš„é¡ºåºæ‰§è¡Œçš„ï¼Œå³ä½¿å°†ä¸€ä¸ªå¯¹è±¡èµ‹äºˆå®ƒè‡ªèº«ï¼Œä¹Ÿä¿è¯æ­£ç¡®ã€‚</strong>è€Œä¸”ï¼Œå¦‚æœå¯èƒ½ï¼Œæˆ‘ä»¬ç¼–å†™çš„èµ‹å€¼è¿ç®—ç¬¦è¿˜åº”è¯¥æ˜¯å¼‚å¸¸å®‰å…¨çš„â€”â€”å½“å¼‚å¸¸å‘ç”Ÿæ—¶èƒ½å°†å·¦ä¾§è¿ç®—å¯¹è±¡ç½®äºä¸€ä¸ªæœ‰æ„ä¹‰çš„çŠ¶æ€ï¼ˆå‚è§5.6.2èŠ‚ï¼Œç¬¬175é¡µï¼‰ã€‚</p><p>é€šè¿‡<strong>å…ˆæ‹·è´å³ä¾§è¿ç®—å¯¹è±¡</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†è‡ªèµ‹å€¼æƒ…å†µï¼Œå¹¶èƒ½ä¿è¯åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ä»£ç ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚</p><p><strong>å…³é”®æ¦‚å¿µï¼šèµ‹å€¼è¿ç®—ç¬¦</strong></p><p>å½“ä½ ç¼–å†™èµ‹å€¼è¿ç®—ç¬¦æ—¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦è®°ä½ï¼š</p><ul><li>å¦‚æœå°†ä¸€ä¸ªå¯¹è±¡èµ‹äºˆå®ƒè‡ªèº«ï¼Œèµ‹å€¼è¿ç®—ç¬¦å¿…é¡»èƒ½æ­£ç¡®å·¥ä½œã€‚</li><li>å¤§å¤šæ•°èµ‹å€¼è¿ç®—ç¬¦ç»„åˆäº†ææ„å‡½æ•°å’Œæ‹·è´æ„é€ å‡½æ•°çš„å·¥ä½œã€‚</li></ul><p>å½“ä½ ç¼–å†™ä¸€ä¸ªèµ‹å€¼è¿ç®—ç¬¦æ—¶ï¼Œä¸€ä¸ªå¥½çš„æ¨¡å¼æ˜¯å…ˆå°†å³ä¾§è¿ç®—å¯¹è±¡æ‹·è´åˆ°ä¸€ä¸ªå±€éƒ¨ä¸´æ—¶å¯¹è±¡ä¸­ã€‚å½“æ‹·è´å®Œæˆåï¼Œé”€æ¯å·¦ä¾§è¿ç®—å¯¹è±¡çš„ç°æœ‰æˆå‘˜å°±æ˜¯å®‰å…¨çš„äº†ã€‚ä¸€æ—¦å·¦ä¾§è¿ç®—å¯¹è±¡çš„èµ„æºè¢«é”€æ¯ï¼Œå°±åªå‰©ä¸‹å°†æ•°æ®ä»ä¸´æ—¶å¯¹è±¡æ‹·è´åˆ°å·¦ä¾§è¿ç®—å¯¹è±¡çš„æˆå‘˜ä¸­äº†ã€‚</p><h3 id="13-2-2-å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»"><a href="#13-2-2-å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»" class="headerlink" title="13.2.2 å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»"></a>13.2.2 å®šä¹‰è¡Œä¸ºåƒæŒ‡é’ˆçš„ç±»</h3><p>å¯¹äºè¡Œä¸ºç±»ä¼¼æŒ‡é’ˆçš„ç±»ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå…¶å®šä¹‰æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œæ¥æ‹·è´æŒ‡é’ˆæˆå‘˜æœ¬èº«è€Œä¸æ˜¯å®ƒæŒ‡å‘çš„stringã€‚</p><p>ææ„å‡½æ•°ä¸èƒ½å•æ–¹é¢åœ°é‡Šæ”¾å…³è”çš„stringã€‚åªæœ‰å½“æœ€åä¸€ä¸ªæŒ‡å‘stringçš„HasPtré”€æ¯æ—¶ï¼Œå®ƒæ‰å¯ä»¥é‡Šæ”¾stringã€‚</p><p>ä»¤ä¸€ä¸ªç±»å±•ç°ç±»ä¼¼æŒ‡é’ˆçš„è¡Œä¸ºçš„æœ€å¥½æ–¹æ³•æ˜¯ä½¿ç”¨shared_ptræ¥ç®¡ç†ç±»ä¸­çš„èµ„æºã€‚</p><p>ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ç›´æ¥ç®¡ç†èµ„æºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<strong>å¼•ç”¨è®¡æ•°ï¼ˆreference countï¼‰</strong>ï¼ˆå‚è§12.1.1èŠ‚ï¼Œç¬¬402é¡µï¼‰å°±å¾ˆæœ‰ç”¨äº†ã€‚</p><p><strong>å¼•ç”¨è®¡æ•°</strong></p><p>å¼•ç”¨è®¡æ•°çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>é™¤äº†åˆå§‹åŒ–å¯¹è±¡å¤–ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°ï¼ˆæ‹·è´æ„é€ å‡½æ•°é™¤å¤–ï¼‰è¿˜è¦åˆ›å»ºä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œç”¨æ¥è®°å½•æœ‰å¤šå°‘å¯¹è±¡ä¸æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡å…±äº«çŠ¶æ€ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œåªæœ‰ä¸€ä¸ªå¯¹è±¡å…±äº«çŠ¶æ€ï¼Œå› æ­¤å°†è®¡æ•°å™¨åˆå§‹åŒ–ä¸º1ã€‚</li><li>æ‹·è´æ„é€ å‡½æ•°ä¸åˆ†é…æ–°çš„è®¡æ•°å™¨ï¼Œè€Œæ˜¯æ‹·è´ç»™å®šå¯¹è±¡çš„æ•°æ®æˆå‘˜ï¼ŒåŒ…æ‹¬è®¡æ•°å™¨ã€‚æ‹·è´æ„é€ å‡½æ•°é€’å¢å…±äº«çš„è®¡æ•°å™¨ï¼ŒæŒ‡å‡ºç»™å®šå¯¹è±¡çš„çŠ¶æ€åˆè¢«ä¸€ä¸ªæ–°ç”¨æˆ·æ‰€å…±äº«ã€‚</li><li>ææ„å‡½æ•°é€’å‡è®¡æ•°å™¨ï¼ŒæŒ‡å‡ºå…±äº«çŠ¶æ€çš„ç”¨æˆ·å°‘äº†ä¸€ä¸ªã€‚å¦‚æœè®¡æ•°å™¨å˜ä¸º0ï¼Œåˆ™ææ„å‡½æ•°é‡Šæ”¾çŠ¶æ€ã€‚</li><li>æ‹·è´èµ‹å€¼è¿ç®—ç¬¦é€’å¢å³ä¾§è¿ç®—å¯¹è±¡çš„è®¡æ•°å™¨ï¼Œé€’å‡å·¦ä¾§è¿ç®—å¯¹è±¡çš„è®¡æ•°å™¨ã€‚å¦‚æœå·¦ä¾§è¿ç®—å¯¹è±¡çš„è®¡æ•°å™¨å˜ä¸º0ï¼Œæ„å‘³ç€å®ƒçš„å…±äº«çŠ¶æ€æ²¡æœ‰ç”¨æˆ·äº†ï¼Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦å°±å¿…é¡»é”€æ¯çŠ¶æ€ã€‚</li></ul><p>è®¡æ•°å™¨ä¸èƒ½ç›´æ¥ä½œä¸ºHasPtrå¯¹è±¡çš„æˆå‘˜ã€‚</p><p>è§£å†³æ­¤é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯<strong>å°†è®¡æ•°å™¨ä¿å­˜åœ¨åŠ¨æ€å†…å­˜ä¸­</strong>ã€‚å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåˆ†é…ä¸€ä¸ªæ–°çš„è®¡æ•°å™¨ã€‚å½“æ‹·è´æˆ–èµ‹å€¼å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æ‹·è´æŒ‡å‘è®¡æ•°å™¨çš„æŒ‡é’ˆã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå‰¯æœ¬å’ŒåŸå¯¹è±¡éƒ½ä¼šæŒ‡å‘ç›¸åŒçš„è®¡æ•°å™¨ã€‚</p><p><strong>å®šä¹‰ä¸€ä¸ªä½¿ç”¨å¼•ç”¨è®¡æ•°çš„ç±»</strong></p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240921010258313.png"></p><p><strong>ç±»æŒ‡é’ˆçš„æ‹·è´æˆå‘˜â€œç¯¡æ”¹â€å¼•ç”¨è®¡æ•°</strong></p><p>ææ„å‡½æ•°ä¸èƒ½æ— æ¡ä»¶åœ°delete psâ€”â€”å¯èƒ½è¿˜æœ‰å…¶ä»–å¯¹è±¡æŒ‡å‘è¿™å—å†…å­˜ã€‚ææ„å‡½æ•°åº”è¯¥é€’å‡å¼•ç”¨è®¡æ•°ï¼ŒæŒ‡å‡ºå…±äº«stringçš„å¯¹è±¡å°‘äº†ä¸€ä¸ªã€‚å¦‚æœè®¡æ•°å™¨å˜ä¸º0ï¼Œåˆ™ææ„å‡½æ•°é‡Šæ”¾pså’ŒuseæŒ‡å‘çš„å†…å­˜</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240921010338251.png"></p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240921010440242.png"></p><h2 id="13-3-äº¤æ¢æ“ä½œ"><a href="#13-3-äº¤æ¢æ“ä½œ" class="headerlink" title="13.3 äº¤æ¢æ“ä½œ"></a>13.3 äº¤æ¢æ“ä½œ</h2><p>ç®¡ç†èµ„æºçš„ç±»ä¸€èˆ¬ä¼šå®šä¹‰è‡ªå·±çš„ <code>swap</code> å‡½æ•°ã€‚</p><p>å¯¹äºä¼šé‡æ’å…ƒç´ é¡ºåºçš„ç®—æ³•æ¥è¯´ï¼Œå¦‚æœç±»å®šä¹‰äº†è‡ªå·±çš„<code>swap</code>å‡½æ•°ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¦åˆ™ä½¿ç”¨æ ‡å‡†åº“å®šä¹‰çš„<code>swap</code>ï¼Œè¯¥å‡½æ•°ä¼šè¿›è¡Œä¸€æ¬¡æ‹·è´ä¸¤æ¬¡èµ‹å€¼ã€‚</p><p><strong>ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„swapå‡½æ•°</strong></p><blockquote><p>ä¸æ‹·è´æ§åˆ¶æˆå‘˜ä¸åŒï¼Œswapå¹¶ä¸æ˜¯å¿…è¦çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºåˆ†é…äº†èµ„æºçš„ç±»ï¼Œå®šä¹‰swapå¯èƒ½æ˜¯ä¸€ç§å¾ˆé‡è¦çš„ä¼˜åŒ–æ‰‹æ®µã€‚</p></blockquote><p>ä¸€ä¸ªå…¸å‹çš„å®ç°æ–¹æ³•ï¼Œç”±äºswapçš„å­˜åœ¨å°±æ˜¯ä¸ºäº†ä¼˜åŒ–ä»£ç ï¼Œæˆ‘ä»¬å°†å…¶å£°æ˜ä¸ºinlineå‡½æ•°ï¼ˆå‚è§6.5.2èŠ‚ï¼Œç¬¬213é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240922172223746.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªswapè°ƒç”¨åº”è¯¥éƒ½æ˜¯æœªåŠ é™å®šçš„ã€‚å³ï¼Œæ¯ä¸ªè°ƒç”¨éƒ½åº”è¯¥æ˜¯swapï¼Œè€Œä¸æ˜¯stdï¼šï¼šswapã€‚å¦‚æœå­˜åœ¨ç±»å‹ç‰¹å®šçš„swapç‰ˆæœ¬ï¼Œå…¶åŒ¹é…ç¨‹åº¦ä¼šä¼˜äºstdä¸­å®šä¹‰çš„ç‰ˆæœ¬ï¼ŒåŸå› æˆ‘ä»¬å°†åœ¨16.3èŠ‚ï¼ˆç¬¬616é¡µï¼‰ä¸­è¿›è¡Œè§£é‡Šã€‚</p><p><strong>åœ¨èµ‹å€¼è¿ç®—ç¬¦ä¸­ä½¿ç”¨swap</strong></p><blockquote><p>ä½¿ç”¨æ‹·è´å’Œäº¤æ¢çš„èµ‹å€¼è¿ç®—ç¬¦è‡ªåŠ¨å°±æ˜¯å¼‚å¸¸å®‰å…¨çš„ï¼Œä¸”èƒ½æ­£ç¡®å¤„ç†è‡ªèµ‹å€¼ã€‚</p></blockquote><p>å®šä¹‰swapçš„ç±»é€šå¸¸ç”¨swapæ¥å®šä¹‰å®ƒä»¬çš„èµ‹å€¼è¿ç®—ç¬¦ã€‚è¿™äº›è¿ç®—ç¬¦ä½¿ç”¨äº†ä¸€ç§åä¸ºæ‹·è´å¹¶äº¤æ¢ï¼ˆcopy and swapï¼‰çš„æŠ€æœ¯ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240922172705817.png"></p><h2 id="13-4-æ‹·è´æ§åˆ¶ç¤ºä¾‹"><a href="#13-4-æ‹·è´æ§åˆ¶ç¤ºä¾‹" class="headerlink" title="13.4 æ‹·è´æ§åˆ¶ç¤ºä¾‹"></a>13.4 æ‹·è´æ§åˆ¶ç¤ºä¾‹</h2><p>é€šå¸¸æ¥è¯´åˆ†é…èµ„æºçš„ç±»æ›´éœ€è¦æ‹·è´æ§åˆ¶ï¼Œä½†èµ„æºç®¡ç†å¹¶ä¸æ˜¯ä¸€ä¸ªç±»éœ€è¦å®šä¹‰è‡ªå·±çš„æ‹·è´æ§åˆ¶æˆå‘˜çš„å”¯ä¸€åŸå› ã€‚ä¸€äº›ç±»ä¹Ÿéœ€è¦æ‹·è´æ§åˆ¶æˆå‘˜çš„å¸®åŠ©æ¥è¿›è¡Œç°¿è®°å·¥ä½œæˆ–å…¶ä»–æ“ä½œã€‚</p><p>ä¸¤ä¸ªç±»å‘½åä¸ºMessageå’ŒFolderï¼Œåˆ†åˆ«è¡¨ç¤ºç”µå­é‚®ä»¶ï¼ˆæˆ–è€…å…¶ä»–ç±»å‹çš„ï¼‰æ¶ˆæ¯å’Œæ¶ˆæ¯ç›®å½•ã€‚æ¯ä¸ªMessageå¯¹è±¡å¯ä»¥å‡ºç°åœ¨å¤šä¸ªFolderä¸­ã€‚ä½†æ˜¯ï¼Œä»»æ„ç»™å®šçš„Messageçš„å†…å®¹åªæœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚è¿™æ ·ï¼Œå¦‚æœä¸€æ¡Messageçš„å†…å®¹è¢«æ”¹å˜ï¼Œåˆ™æˆ‘ä»¬ä»å®ƒæ‰€åœ¨çš„ä»»ä½•Folderæ¥æµè§ˆæ­¤Messageæ—¶ï¼Œéƒ½ä¼šçœ‹åˆ°æ”¹å˜åçš„å†…å®¹ã€‚ä¸ºäº†è®°å½•Messageä½äºå“ªäº›Folderä¸­ï¼Œæ¯ä¸ªMessageéƒ½ä¼šä¿å­˜ä¸€ä¸ªå®ƒæ‰€åœ¨Folderçš„æŒ‡é’ˆçš„setï¼ŒåŒæ ·çš„ï¼Œæ¯ä¸ªFolderéƒ½ä¿å­˜ä¸€ä¸ªå®ƒåŒ…å«çš„Messageçš„æŒ‡é’ˆçš„setã€‚</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240922173022597.png"></p><p>Messageç±»ä¼šæä¾›saveå’Œremoveæ“ä½œï¼Œæ¥å‘ä¸€ä¸ªç»™å®šFolderæ·»åŠ ä¸€æ¡Messageæˆ–æ˜¯ä»ä¸­åˆ é™¤ä¸€æ¡Messageã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„Messageï¼Œæˆ‘ä»¬ä¼šæŒ‡æ˜æ¶ˆæ¯å†…å®¹ï¼Œä½†ä¸ä¼šæŒ‡å‡ºFolderã€‚ä¸ºäº†å°†ä¸€æ¡Messageæ”¾åˆ°ä¸€ä¸ªç‰¹å®šFolderä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è°ƒç”¨saveã€‚</p><p>å½“æˆ‘ä»¬æ‹·è´ä¸€ä¸ªMessageæ—¶ï¼Œå‰¯æœ¬å’ŒåŸå¯¹è±¡å°†æ˜¯ä¸åŒçš„Messageå¯¹è±¡ï¼Œä½†ä¸¤ä¸ªMessageéƒ½å‡ºç°åœ¨ç›¸åŒçš„Folderä¸­ã€‚å› æ­¤ï¼Œæ‹·è´Messageçš„æ“ä½œåŒ…æ‹¬æ¶ˆæ¯å†…å®¹å’ŒFolderæŒ‡é’ˆsetçš„æ‹·è´ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸ªåŒ…å«æ­¤æ¶ˆæ¯çš„Folderä¸­éƒ½æ·»åŠ ä¸€ä¸ªæŒ‡å‘æ–°åˆ›å»ºçš„Messageçš„æŒ‡é’ˆã€‚</p><p>å½“æˆ‘ä»¬é”€æ¯ä¸€ä¸ªMessageæ—¶ï¼Œå®ƒå°†ä¸å¤å­˜åœ¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä»åŒ…å«æ­¤æ¶ˆæ¯çš„æ‰€æœ‰Folderä¸­åˆ é™¤æŒ‡å‘æ­¤Messageçš„æŒ‡é’ˆã€‚</p><p>å½“æˆ‘ä»¬å°†ä¸€ä¸ªMessageå¯¹è±¡èµ‹äºˆå¦ä¸€ä¸ªMessageå¯¹è±¡æ—¶ï¼Œå·¦ä¾§Messageçš„å†…å®¹ä¼šè¢«å³ä¾§Messageçš„å†…å®¹æ‰€æ›¿ä»£ã€‚æˆ‘ä»¬è¿˜å¿…é¡»æ›´æ–°Folderé›†åˆï¼Œä»åŸæ¥åŒ…å«å·¦ä¾§Messageçš„Folderä¸­å°†å®ƒåˆ é™¤ï¼Œå¹¶å°†å®ƒæ·»åŠ åˆ°åŒ…å«å³ä¾§Messageçš„Folderä¸­ã€‚</p><p>è§‚å¯Ÿè¿™äº›æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œææ„å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦éƒ½å¿…é¡»ä»åŒ…å«ä¸€æ¡Messageçš„æ‰€æœ‰Folderä¸­åˆ é™¤å®ƒã€‚ç±»ä¼¼çš„ï¼Œæ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦éƒ½è¦å°†ä¸€ä¸ªMessageæ·»åŠ åˆ°ç»™å®šçš„ä¸€ç»„Folderä¸­ã€‚æˆ‘ä»¬å°†å®šä¹‰ä¸¤ä¸ªprivateçš„å·¥å…·å‡½æ•°æ¥å®Œæˆè¿™äº›å·¥ä½œã€‚</p><blockquote><p>æ‹·è´èµ‹å€¼è¿ç®—ç¬¦é€šå¸¸æ‰§è¡Œæ‹·è´æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­ä¹Ÿè¦åšçš„å·¥ä½œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå…¬å…±çš„å·¥ä½œåº”è¯¥æ”¾åœ¨privateçš„å·¥å…·å‡½æ•°ä¸­å®Œæˆã€‚</p></blockquote><p>Folderç±»ä¹Ÿéœ€è¦ç±»ä¼¼çš„æ‹·è´æ§åˆ¶æˆå‘˜ï¼Œæ¥æ·»åŠ æˆ–åˆ é™¤å®ƒä¿å­˜çš„Messageã€‚</p><h2 id="13-5-åŠ¨æ€å†…å­˜ç®¡ç†ç±»"><a href="#13-5-åŠ¨æ€å†…å­˜ç®¡ç†ç±»" class="headerlink" title="13.5 åŠ¨æ€å†…å­˜ç®¡ç†ç±»"></a>13.5 åŠ¨æ€å†…å­˜ç®¡ç†ç±»</h2><p>æŸäº›ç±»éœ€è¦åœ¨è¿è¡Œæ—¶åˆ†é…å¯å˜å¤§å°çš„å†…å­˜ç©ºé—´ã€‚è¿™ç§ç±»é€šå¸¸å¯ä»¥ï¼ˆå¹¶ä¸”å¦‚æœå®ƒä»¬ç¡®å®å¯ä»¥çš„è¯ï¼Œä¸€èˆ¬åº”è¯¥ï¼‰ä½¿ç”¨æ ‡å‡†åº“å®¹å™¨æ¥ä¿å­˜å®ƒä»¬çš„æ•°æ®ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸€ç­–ç•¥å¹¶ä¸æ˜¯å¯¹æ¯ä¸ªç±»éƒ½é€‚ç”¨ï¼›æŸäº›ç±»éœ€è¦è‡ªå·±è¿›è¡Œå†…å­˜åˆ†é…ã€‚è¿™äº›ç±»ä¸€èˆ¬æ¥è¯´å¿…é¡»å®šä¹‰è‡ªå·±çš„æ‹·è´æ§åˆ¶æˆå‘˜æ¥ç®¡ç†æ‰€åˆ†é…çš„å†…å­˜ã€‚</p><p><strong>StrVecç±»çš„è®¾è®¡</strong></p><p>ä½¿ç”¨ä¸€ä¸ªallocatoræ¥è·å¾—åŸå§‹å†…å­˜ï¼ˆå‚è§12.2.2èŠ‚ï¼Œç¬¬427é¡µï¼‰ã€‚ç”±äºallocatoråˆ†é…çš„å†…å­˜æ˜¯æœªæ„é€ çš„ï¼Œæˆ‘ä»¬å°†åœ¨éœ€è¦æ·»åŠ æ–°å…ƒç´ æ—¶ç”¨allocatorçš„constructæˆå‘˜åœ¨åŸå§‹å†…å­˜ä¸­åˆ›å»ºå¯¹è±¡ã€‚ç±»ä¼¼çš„ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ é™¤ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨destroyæˆå‘˜æ¥é”€æ¯å…ƒç´ ã€‚</p><p>æ¯ä¸ªStrVecæœ‰ä¸‰ä¸ªæŒ‡é’ˆæˆå‘˜æŒ‡å‘å…¶å…ƒç´ æ‰€ä½¿ç”¨çš„å†…å­˜ï¼š</p><ul><li>elementsï¼ŒæŒ‡å‘åˆ†é…çš„å†…å­˜ä¸­çš„é¦–å…ƒç´ </li><li>first_freeï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªå®é™…å…ƒç´ ä¹‹åçš„ä½ç½®</li><li>capï¼ŒæŒ‡å‘åˆ†é…çš„å†…å­˜æœ«å°¾ä¹‹åçš„ä½ç½®</li></ul><p><img src="/../images/C-C-Primer-Chapter-13/image-20240922205725442.png"></p><p>StrVecè¿˜æœ‰ä¸€ä¸ªåä¸ºallocçš„é™æ€æˆå‘˜ï¼Œå…¶ç±»å‹ä¸º<code>allocator&lt;string&gt;</code>ã€‚</p><p>è¿˜æœ‰4ä¸ªå·¥å…·å‡½æ•°ï¼š</p><ul><li>alloc_n_copyä¼šåˆ†é…å†…å­˜ï¼Œå¹¶æ‹·è´ä¸€ä¸ªç»™å®šèŒƒå›´ä¸­çš„å…ƒç´ ã€‚</li><li>freeä¼šé”€æ¯æ„é€ çš„å…ƒç´ å¹¶é‡Šæ”¾å†…å­˜ã€‚</li><li>chk_n_allocä¿è¯StrVecè‡³å°‘æœ‰å®¹çº³ä¸€ä¸ªæ–°å…ƒç´ çš„ç©ºé—´ã€‚å¦‚æœæ²¡æœ‰ç©ºé—´æ·»åŠ æ–°å…ƒç´ ï¼Œchk_n_allocä¼šè°ƒç”¨reallocateæ¥åˆ†é…æ›´å¤šå†…å­˜ã€‚</li><li>reallocateåœ¨å†…å­˜ç”¨å®Œæ—¶ä¸ºStrVecåˆ†é…æ–°å†…å­˜ã€‚</li></ul><p><strong>StrVecç±»å®šä¹‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrVec</span><br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">StrVec</span>() :                           <span class="hljs-comment">// allocæˆå‘˜é»˜è®¤åˆå§‹åŒ–</span><br>        <span class="hljs-built_in">elements</span>(<span class="hljs-literal">nullptr</span>),<br>        <span class="hljs-built_in">first_free</span>(<span class="hljs-literal">nullptr</span>),<br>        <span class="hljs-built_in">cap</span>(<span class="hljs-literal">nullptr</span>)<br>    &#123; &#125;<br>    <span class="hljs-built_in">StrVec</span>(<span class="hljs-type">const</span> StrVec &amp;);              <span class="hljs-comment">// æ‹·è´æ„é€ </span><br>    StrVec &amp;<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> StrVec &amp;);   <span class="hljs-comment">// æ‹·è´èµ‹å€¼</span><br>    ~<span class="hljs-built_in">StrVec</span>();                           <span class="hljs-comment">// ææ„å‡½æ•°</span><br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_back</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string &amp;)</span></span>; <span class="hljs-comment">// æ‹·è´å…ƒç´ å¹¶æ·»åŠ åˆ°å®¹å™¨æœ«å°¾</span><br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> first_free - elements; &#125;<br>    <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">capacity</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> cap - elements; &#125;<br>    <span class="hljs-function">std::string *<span class="hljs-title">begin</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> elements; &#125;<br>    <span class="hljs-function">std::string *<span class="hljs-title">end</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> first_free; &#125;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">chk_n_alloc</span><span class="hljs-params">()</span> </span><br><span class="hljs-function">        </span>&#123; <span class="hljs-keyword">if</span> (<span class="hljs-built_in">size</span>() == <span class="hljs-built_in">capacity</span>()) <span class="hljs-built_in">reallocate</span>(); &#125;      <span class="hljs-comment">// è‡³å°‘ä¿è¯å®¹å™¨æœ‰ä¸€ä¸ªç©ºé—²ç©ºé—´</span><br>    std::pair&lt;std::string *, std::string *&gt; alloc_n_copy <span class="hljs-comment">// åˆ†é…å†…å­˜å¹¶æ‹·è´èŒƒå›´å†…å…ƒç´ </span><br>        (<span class="hljs-type">const</span> std::string *, <span class="hljs-type">const</span> std::string *);<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">free</span><span class="hljs-params">()</span></span>;                                         <span class="hljs-comment">// é”€æ¯å…ƒç´ å¹¶é‡Šæ”¾å†…å­˜</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reallocate</span><span class="hljs-params">()</span></span>;                                   <span class="hljs-comment">// é‡æ–°åˆ†é…å†…å­˜å¹¶æ‹·è´å…ƒç´ </span><br>    <span class="hljs-type">static</span> std::allocator&lt;std::string&gt; alloc;            <span class="hljs-comment">// å†…å­˜åˆ†é…å™¨</span><br>    std::string *elements;                               <span class="hljs-comment">// æ•°ç»„é¦–å…ƒç´ </span><br>    std::string *first_free;                             <span class="hljs-comment">// æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ä¹‹åçš„ä½ç½®</span><br>    std::string *cap;                                    <span class="hljs-comment">// æ•°ç»„åˆ†é…å†…å­˜ä¹‹åçš„ä½ç½®</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨construct</strong></p><p>è‹¥æƒ³ä½¿ç”¨åŸå§‹å†…å­˜ï¼Œå¿…é¡»è°ƒç”¨<code>construct</code>åœ¨æ­¤åŸå§‹å†…å­˜ä¸Šæ„é€ ä¸€ä¸ªå¯¹è±¡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">StrVec::push_back</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string &amp;ele)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">chk_n_alloc</span>();<br>    alloc.<span class="hljs-built_in">construct</span>(first_free++, ele);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>push_backé¦–å…ˆè°ƒç”¨chk_n_allocç¡®ä¿æœ‰è¶³å¤Ÿçš„åŸå§‹å†…å­˜æ¥æ„é€ å¯¹è±¡ï¼Œç„¶åç”¨allocatoræ¥æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œconstructçš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å‘å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå…¶ä»–å‚æ•°ç”¨æ¥å†³å®šè°ƒç”¨å“ªä¸ªæ„é€ å‡½æ•°æ¥æ„é€ å¯¹è±¡ï¼Œæ­¤ä¾‹ä¸­è°ƒç”¨stringçš„æ‹·è´æ„é€ å‡½æ•°ã€‚</p><p><strong>alloc_n_copyæˆå‘˜</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">std::pair&lt;std::string *, std::string *&gt; <span class="hljs-title">StrVec::alloc_n_copy</span></span><br><span class="hljs-function">    <span class="hljs-params">(<span class="hljs-type">const</span> std::string *begin, <span class="hljs-type">const</span> std::string *end)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> data = alloc.<span class="hljs-built_in">allocate</span>(end - begin);<br>    <span class="hljs-keyword">return</span> &#123;data, std::<span class="hljs-built_in">uninitialized_copy</span>(begin, end, data)&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>freeæˆå‘˜</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">StrVec::free</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (elements == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> p = elements; p != first_free; ++p)<br>        alloc.<span class="hljs-built_in">destroy</span>(p);<br>    alloc.<span class="hljs-built_in">deallocate</span>(elements, cap - elements);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œdeallocateå‡½æ•°ä¸æ¥å—ç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥å¿…é¡»è¦å…ˆæ£€æŸ¥æŒ‡é’ˆæ˜¯å¦æœªç©ºã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆé”€æ¯å¯¹è±¡ï¼Œç„¶åå†é‡Šæ”¾å†…å­˜ã€‚</p><p><strong>æ‹·è´æ§åˆ¶æˆå‘˜</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c++">StrVec::<span class="hljs-built_in">StrVec</span>(<span class="hljs-type">const</span> StrVec &amp;other)<br>&#123;<br>    <span class="hljs-keyword">auto</span> data =  <span class="hljs-built_in">alloc_n_copy</span>(other.<span class="hljs-built_in">begin</span>(), other.<span class="hljs-built_in">end</span>());<br>    elements = data.first;<br>    first_free = cap = data.second;<br>&#125;<br><br>StrVec &amp;StrVec::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> StrVec &amp;other)   <br>&#123;<br>    <span class="hljs-keyword">auto</span> data = <span class="hljs-built_in">alloc_n_copy</span>(other.<span class="hljs-built_in">begin</span>(), other.<span class="hljs-built_in">end</span>());<br>    <span class="hljs-built_in">free</span>();<br>    elements = data.first;<br>    first_free = cap = data.second;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br><br>StrVec::~<span class="hljs-built_in">StrVec</span>()                           <br>&#123;<br>    <span class="hljs-built_in">free</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡è½½èµ‹å€¼è¿ç®—ç¬¦åœ¨é‡Šæ”¾å†…å­˜ä¹‹å‰ï¼Œå…ˆè°ƒç”¨alloc_n_copyå¤åˆ¶ä¸€ä»½æ•°æ®å‡ºæ¥ï¼Œè¿™æ ·å¯ä»¥å¤„ç†è‡ªèµ‹å€¼é—®é¢˜ã€‚</p><p><strong>åœ¨é‡æ–°åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ç§»åŠ¨è€Œä¸æ˜¯æ‹·è´å…ƒç´ </strong></p><p>åœ¨ç¼–å†™reallocateæˆå‘˜å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬ç¨å¾®æ€è€ƒä¸€ä¸‹æ­¤å‡½æ•°åº”è¯¥åšä»€ä¹ˆã€‚å®ƒåº”è¯¥</p><ul><li>ä¸ºä¸€ä¸ªæ–°çš„ã€æ›´å¤§çš„stringæ•°ç»„åˆ†é…å†…å­˜</li><li>åœ¨å†…å­˜ç©ºé—´çš„å‰ä¸€éƒ¨åˆ†æ„é€ å¯¹è±¡ï¼Œä¿å­˜ç°æœ‰å…ƒç´ </li><li>é”€æ¯åŸå†…å­˜ç©ºé—´ä¸­çš„å…ƒç´ ï¼Œå¹¶é‡Šæ”¾è¿™å—å†…å­˜</li></ul><p>stringçš„è¡Œä¸ºç±»ä¼¼å€¼ï¼Œæ¯ä¸ªstringå¯¹æ„æˆå®ƒçš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šä¿å­˜è‡ªå·±çš„ä¸€ä»½å‰¯æœ¬ã€‚æ‹·è´ä¸€ä¸ªstringå¿…é¡»ä¸ºè¿™äº›å­—ç¬¦åˆ†é…å†…å­˜ç©ºé—´ï¼Œè€Œé”€æ¯ä¸€ä¸ªstringå¿…é¡»é‡Šæ”¾æ‰€å ç”¨çš„å†…å­˜ã€‚</p><p>æ‹·è´ä¸€ä¸ªstringå°±å¿…é¡»çœŸçš„æ‹·è´æ•°æ®ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨æˆ‘ä»¬æ‹·è´äº†ä¸€ä¸ªstringä¹‹åï¼Œå®ƒå°±ä¼šæœ‰ä¸¤ä¸ªç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯reallocateæ‹·è´StrVecä¸­çš„stringï¼Œåˆ™åœ¨æ‹·è´ä¹‹åï¼Œæ¯ä¸ªstringåªæœ‰å”¯ä¸€çš„ç”¨æˆ·ã€‚ä¸€æ—¦å°†å…ƒç´ ä»æ—§ç©ºé—´æ‹·è´åˆ°äº†æ–°ç©ºé—´ï¼Œæˆ‘ä»¬å°±ä¼šç«‹å³é”€æ¯åŸstringã€‚å› æ­¤ï¼Œæ‹·è´è¿™äº›stringä¸­çš„æ•°æ®æ˜¯å¤šä½™çš„ã€‚</p><p><strong>ç§»åŠ¨æ„é€ å‡½æ•°å’Œstdï¼šï¼šmove</strong></p><p>æœ‰ä¸€äº›æ ‡å‡†åº“ç±»ï¼ŒåŒ…æ‹¬stringï¼Œéƒ½å®šä¹‰äº†æ‰€è°“çš„â€œç§»åŠ¨æ„é€ å‡½æ•°â€ã€‚ç§»åŠ¨æ„é€ å‡½æ•°é€šå¸¸æ˜¯å°†èµ„æºä»ç»™å®šå¯¹è±¡â€œç§»åŠ¨â€è€Œä¸æ˜¯æ‹·è´åˆ°æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡ã€‚è€Œä¸”æˆ‘ä»¬çŸ¥é“æ ‡å‡†åº“ä¿è¯â€œç§»åæºâ€ï¼ˆmoved-fromï¼‰stringä»ç„¶ä¿æŒä¸€ä¸ªæœ‰æ•ˆçš„ã€å¯ææ„çš„çŠ¶æ€ã€‚</p><p>moveçš„æ ‡å‡†åº“å‡½æ•°ï¼Œå®ƒå®šä¹‰åœ¨utilityå¤´æ–‡ä»¶ä¸­ã€‚å½“reallocateåœ¨æ–°å†…å­˜ä¸­æ„é€ stringæ—¶ï¼Œå®ƒå¿…é¡»è°ƒç”¨moveæ¥è¡¨ç¤ºå¸Œæœ›ä½¿ç”¨stringçš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼ŒåŸå› æˆ‘ä»¬å°†åœ¨13.6.1èŠ‚ï¼ˆç¬¬470é¡µï¼‰ä¸­è§£é‡Šã€‚å¦‚æœå®ƒæ¼æ‰äº†moveè°ƒç”¨ï¼Œå°†ä¼šä½¿ç”¨stringçš„æ‹·è´æ„é€ å‡½æ•°ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¸ºmoveæä¾›ä¸€ä¸ªusingå£°æ˜ï¼ˆå‚è§3.1èŠ‚ï¼Œç¬¬74é¡µï¼‰ï¼ŒåŸå› å°†åœ¨18.2.3èŠ‚ï¼ˆç¬¬706é¡µï¼‰ä¸­è§£é‡Šã€‚å½“æˆ‘ä»¬ä½¿ç”¨moveæ—¶ï¼Œç›´æ¥è°ƒç”¨stdï¼šï¼šmoveè€Œä¸æ˜¯moveã€‚</p><p><strong>reallocateæˆå‘˜</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">StrVec::reallocate</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> new_size = <span class="hljs-built_in">capacity</span>() ? <span class="hljs-built_in">capacity</span>() * <span class="hljs-number">2</span> : <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">auto</span> new_elements = alloc.<span class="hljs-built_in">allocate</span>(new_size);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i != <span class="hljs-built_in">size</span>(); ++i)<br>        alloc.<span class="hljs-built_in">construct</span>(new_elements + i, std::<span class="hljs-built_in">move</span>(*(elements + i)));<br>    <span class="hljs-built_in">free</span>();<br>    cap = new_elements + new_size; <br>    first_free = new_elements + <span class="hljs-built_in">size</span>();<br>    elements = new_elements;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œéœ€è¦å¤„ç†é»˜è®¤åˆå§‹åŒ–åç¬¬ä¸€æ¬¡è°ƒç”¨reallocateçš„æƒ…å†µï¼Œéœ€è¦åˆ¤æ–­ã€‚</p><p><strong>æµ‹è¯•</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    StrVec vec;<br>    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">&quot;Hello&quot;</span>);<br>    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">&quot;World&quot;</span>);<br>    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">&quot;Test&quot;</span>);<br><br>    <span class="hljs-keyword">auto</span> printVec = [](<span class="hljs-type">const</span> StrVec &amp;vec)<br>    &#123;<br>        std::for_each(vec.<span class="hljs-built_in">begin</span>(), vec.<span class="hljs-built_in">end</span>(), [](<span class="hljs-type">const</span> std::string &amp;s)<br>        &#123;<br>            std::cout &lt;&lt; s &lt;&lt; <span class="hljs-string">&quot; &quot;</span>;<br>        &#125;);<br>        std::cout &lt;&lt; std::endl;<br>    &#125;;<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Original vec: &quot;</span>;<br>    <span class="hljs-built_in">printVec</span>(vec);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Size: &quot;</span> &lt;&lt; vec.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">&quot;, Capacity: &quot;</span> &lt;&lt; vec.<span class="hljs-built_in">capacity</span>() &lt;&lt; std::endl;<br><br>    <span class="hljs-comment">// æµ‹è¯•æ‹·è´æ„é€ å‡½æ•°</span><br>    <span class="hljs-function">StrVec <span class="hljs-title">vecCopy</span><span class="hljs-params">(vec)</span></span>;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Copied vec: &quot;</span>;<br>    <span class="hljs-built_in">printVec</span>(vecCopy);<br><br>    <span class="hljs-comment">// æµ‹è¯•æ‹·è´èµ‹å€¼æ“ä½œç¬¦</span><br>    StrVec vecAssign;<br>    vecAssign = vec;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Assigned vec: &quot;</span>;<br>    <span class="hljs-built_in">printVec</span>(vecAssign);<br><br>    <span class="hljs-comment">// æ·»åŠ æ›´å¤šå…ƒç´ ä»¥è§¦å‘é‡æ–°åˆ†é…</span><br>    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">&quot;More&quot;</span>);<br>    vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">&quot;Strings&quot;</span>);<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Original vec after adding more elements: &quot;</span>;<br>    <span class="hljs-built_in">printVec</span>(vec);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;Size: &quot;</span> &lt;&lt; vec.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">&quot;, Capacity: &quot;</span> &lt;&lt; vec.<span class="hljs-built_in">capacity</span>() &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœ</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923004848131.png"></p><h2 id="13-6-å¯¹è±¡ç§»åŠ¨"><a href="#13-6-å¯¹è±¡ç§»åŠ¨" class="headerlink" title="13.6 å¯¹è±¡ç§»åŠ¨"></a>13.6 å¯¹è±¡ç§»åŠ¨</h2><blockquote><p>æ ‡å‡†åº“å®¹å™¨ã€stringå’Œshared_ptrç±»æ—¢æ”¯æŒç§»åŠ¨ä¹Ÿæ”¯æŒæ‹·è´ã€‚IOç±»å’Œunique_ptrç±»å¯ä»¥ç§»åŠ¨ä½†ä¸èƒ½æ‹·è´ã€‚</p></blockquote><p>åœ¨é‡æ–°åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œä»æ—§å†…å­˜å°†å…ƒç´ æ‹·è´åˆ°æ–°å†…å­˜æ˜¯ä¸å¿…è¦çš„ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ç§»åŠ¨å…ƒç´ ã€‚ä½¿ç”¨ç§»åŠ¨è€Œä¸æ˜¯æ‹·è´çš„å¦ä¸€ä¸ªåŸå› æºäºIOç±»æˆ–unique_ptrè¿™æ ·çš„ç±»ã€‚è¿™äº›ç±»éƒ½åŒ…å«ä¸èƒ½è¢«å…±äº«çš„èµ„æºï¼ˆå¦‚æŒ‡é’ˆæˆ–IOç¼“å†²ï¼‰ã€‚å› æ­¤ï¼Œè¿™äº›ç±»å‹çš„å¯¹è±¡ä¸èƒ½æ‹·è´ä½†å¯ä»¥ç§»åŠ¨ã€‚</p><p>åœ¨æ—§ç‰ˆæœ¬çš„æ ‡å‡†åº“ä¸­ï¼Œå®¹å™¨ä¸­æ‰€ä¿å­˜çš„ç±»å¿…é¡»æ˜¯å¯æ‹·è´çš„ã€‚ä½†åœ¨æ–°æ ‡å‡†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®¹å™¨ä¿å­˜ä¸å¯æ‹·è´çš„ç±»å‹ï¼Œåªè¦å®ƒä»¬èƒ½è¢«ç§»åŠ¨å³å¯ã€‚</p><h3 id="13-6-1-å³å€¼å¼•ç”¨"><a href="#13-6-1-å³å€¼å¼•ç”¨" class="headerlink" title="13.6.1 å³å€¼å¼•ç”¨"></a>13.6.1 å³å€¼å¼•ç”¨</h3><p>ä¸ºäº†æ”¯æŒç§»åŠ¨æ“ä½œï¼Œæ–°æ ‡å‡†å¼•å…¥äº†ä¸€ç§æ–°çš„å¼•ç”¨ç±»å‹â€”â€”å³å€¼å¼•ç”¨ï¼ˆrvalue referenceï¼‰ã€‚æ‰€è°“å³å€¼å¼•ç”¨å°±æ˜¯å¿…é¡»ç»‘å®šåˆ°å³å€¼çš„å¼•ç”¨ã€‚æˆ‘ä»¬é€šè¿‡&amp;&amp;è€Œä¸æ˜¯&amp;æ¥è·å¾—å³å€¼å¼•ç”¨ã€‚å³å€¼å¼•ç”¨æœ‰ä¸€ä¸ªé‡è¦çš„æ€§è´¨â€”â€”<strong>åªèƒ½ç»‘å®šåˆ°ä¸€ä¸ªå°†è¦é”€æ¯çš„å¯¹è±¡ã€‚</strong></p><p>ä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªå·¦å€¼è¡¨è¾¾å¼è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„èº«ä»½ï¼Œè€Œä¸€ä¸ªå³å€¼è¡¨è¾¾å¼è¡¨ç¤ºçš„æ˜¯å¯¹è±¡çš„å€¼ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923005310870.png"></p><p><strong>å·¦å€¼æŒä¹…ï¼›å³å€¼çŸ­æš‚</strong></p><p>å·¦å€¼æœ‰æŒä¹…çš„çŠ¶æ€ï¼Œè€Œå³å€¼è¦ä¹ˆæ˜¯å­—é¢å¸¸é‡ï¼Œè¦ä¹ˆæ˜¯åœ¨è¡¨è¾¾å¼æ±‚å€¼è¿‡ç¨‹ä¸­åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡ã€‚</p><p>å› ä¸ºå³å€¼å¼•ç”¨çš„å¯¹è±¡å³å°†è¢«é”€æ¯ï¼Œä¸”æ²¡æœ‰å…¶ä»–ç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„æ¥ç®¡è¯¥å¯¹è±¡ç®¡ç†çš„èµ„æºã€‚</p><p><strong>å˜é‡æ˜¯å·¦å€¼</strong></p><p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½å°†ä¸€ä¸ªå³å€¼å¼•ç”¨ç»‘å®šåˆ°ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡ä¸Š</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923005534389.png"></p><p><strong>æ ‡å‡†åº“moveå‡½æ•°</strong></p><p>è™½ç„¶ä¸èƒ½å°†ä¸€ä¸ªå³å€¼å¼•ç”¨ç›´æ¥ç»‘å®šåˆ°ä¸€ä¸ªå·¦å€¼ä¸Šï¼Œä½†æˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°å°†ä¸€ä¸ªå·¦å€¼è½¬æ¢ä¸ºå¯¹åº”çš„å³å€¼å¼•ç”¨ç±»å‹ã€‚æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨ä¸€ä¸ªåä¸ºmoveçš„æ–°æ ‡å‡†åº“å‡½æ•°æ¥è·å¾—ç»‘å®šåˆ°å·¦å€¼ä¸Šçš„å³å€¼å¼•ç”¨ï¼Œæ­¤å‡½æ•°å®šä¹‰åœ¨å¤´æ–‡ä»¶utilityä¸­ã€‚moveå‡½æ•°ä½¿ç”¨äº†æˆ‘ä»¬å°†åœ¨16.2.6èŠ‚ï¼ˆç¬¬610é¡µï¼‰ä¸­æè¿°çš„æœºåˆ¶æ¥è¿”å›ç»™å®šå¯¹è±¡çš„å³å€¼å¼•ç”¨ã€‚</p><p>moveè°ƒç”¨å‘Šè¯‰ç¼–è¯‘å™¨ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªå·¦å€¼ï¼Œä½†æˆ‘ä»¬å¸Œæœ›åƒä¸€ä¸ªå³å€¼ä¸€æ ·å¤„ç†å®ƒã€‚æˆ‘ä»¬å¿…é¡»è®¤è¯†åˆ°ï¼Œ<strong>è°ƒç”¨moveå°±æ„å‘³ç€æ‰¿è¯ºï¼šé™¤äº†å¯¹rr1èµ‹å€¼æˆ–é”€æ¯å®ƒå¤–ï¼Œæˆ‘ä»¬å°†ä¸å†ä½¿ç”¨å®ƒã€‚</strong>åœ¨è°ƒç”¨moveä¹‹åï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹ç§»åæºå¯¹è±¡çš„å€¼åšä»»ä½•å‡è®¾ã€‚</p><blockquote><p>æˆ‘ä»¬å¯ä»¥é”€æ¯ä¸€ä¸ªç§»åæºå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥èµ‹äºˆå®ƒæ–°å€¼ï¼Œä½†ä¸èƒ½ä½¿ç”¨ä¸€ä¸ªç§»åæºå¯¹è±¡çš„å€¼ã€‚</p></blockquote><p>ä¸å¤§å¤šæ•°æ ‡å‡†åº“åå­—çš„ä½¿ç”¨ä¸åŒï¼Œå¯¹moveï¼ˆå‚è§13.5èŠ‚ï¼Œç¬¬469é¡µï¼‰æˆ‘ä»¬ä¸æä¾›usingå£°æ˜ï¼ˆå‚è§3.1èŠ‚ï¼Œç¬¬74é¡µï¼‰ã€‚æˆ‘ä»¬ç›´æ¥è°ƒç”¨stdï¼šï¼šmoveè€Œä¸æ˜¯moveï¼Œå…¶åŸå› å°†åœ¨18.2.3èŠ‚ï¼ˆç¬¬707é¡µï¼‰ä¸­è§£é‡Šã€‚</p><h3 id="13-6-2-ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦"><a href="#13-6-2-ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="13.6.2 ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦"></a>13.6.2 ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</h3><p>ç±»ä¼¼æ‹·è´æ„é€ å‡½æ•°ï¼Œç§»åŠ¨æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯¥ç±»ç±»å‹çš„ä¸€ä¸ªå¼•ç”¨ã€‚ä¸åŒäºæ‹·è´æ„é€ å‡½æ•°çš„æ˜¯ï¼Œè¿™ä¸ªå¼•ç”¨å‚æ•°åœ¨ç§»åŠ¨æ„é€ å‡½æ•°ä¸­æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚ä¸æ‹·è´æ„é€ å‡½æ•°ä¸€æ ·ï¼Œä»»ä½•é¢å¤–çš„å‚æ•°éƒ½å¿…é¡»æœ‰é»˜è®¤å®å‚ã€‚</p><p>é™¤äº†å®Œæˆèµ„æºç§»åŠ¨ï¼Œ<strong>ç§»åŠ¨æ„é€ å‡½æ•°è¿˜å¿…é¡»ç¡®ä¿ç§»åæºå¯¹è±¡å¤„äºè¿™æ ·ä¸€ä¸ªçŠ¶æ€â€”â€”é”€æ¯å®ƒæ˜¯æ— å®³çš„ã€‚</strong>ç‰¹åˆ«æ˜¯ï¼Œä¸€æ—¦èµ„æºå®Œæˆç§»åŠ¨ï¼Œæºå¯¹è±¡å¿…é¡»ä¸å†æŒ‡å‘è¢«ç§»åŠ¨çš„èµ„æºâ€”â€”è¿™äº›èµ„æºçš„æ‰€æœ‰æƒå·²ç»å½’å±æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923005824517.png"></p><p><strong>ç§»åŠ¨æ“ä½œã€æ ‡å‡†åº“å®¹å™¨å’Œå¼‚å¸¸</strong></p><p>ç”±äºç§»åŠ¨æ“ä½œâ€œçªƒå–â€èµ„æºï¼Œå®ƒé€šå¸¸ä¸åˆ†é…ä»»ä½•èµ„æºã€‚å› æ­¤ï¼Œç§»åŠ¨æ“ä½œé€šå¸¸ä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚å½“ç¼–å†™ä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„ç§»åŠ¨æ“ä½œæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°†æ­¤äº‹é€šçŸ¥æ ‡å‡†åº“ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œé™¤éæ ‡å‡†åº“çŸ¥é“æˆ‘ä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™å®ƒä¼šè®¤ä¸ºç§»åŠ¨æˆ‘ä»¬çš„ç±»å¯¹è±¡æ—¶å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”ä¸ºäº†å¤„ç†è¿™ç§å¯èƒ½æ€§è€Œåšä¸€äº›é¢å¤–çš„å·¥ä½œã€‚</p><p>ä¸€ç§é€šçŸ¥æ ‡å‡†åº“çš„æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬çš„æ„é€ å‡½æ•°ä¸­æŒ‡æ˜noexceptã€‚noexceptæ˜¯æ–°æ ‡å‡†å¼•å…¥çš„ï¼Œæˆ‘ä»¬å°†åœ¨18.1.4èŠ‚ï¼ˆç¬¬690é¡µï¼‰ä¸­è®¨è®ºæ›´å¤šç»†èŠ‚ã€‚ç›®å‰é‡è¦çš„æ˜¯è¦çŸ¥é“ï¼Œnoexceptæ˜¯æˆ‘ä»¬æ‰¿è¯ºä¸€ä¸ªå‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸çš„ä¸€ç§æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå‡½æ•°çš„å‚æ•°åˆ—è¡¨åæŒ‡å®šnoexceptã€‚åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­ï¼Œnoexceptå‡ºç°åœ¨å‚æ•°åˆ—è¡¨å’Œåˆå§‹åŒ–åˆ—è¡¨å¼€å§‹çš„å†’å·ä¹‹é—´</p><p><strong>æˆ‘ä»¬å¿…é¡»åœ¨ç±»å¤´æ–‡ä»¶çš„å£°æ˜ä¸­å’Œå®šä¹‰ä¸­ï¼ˆå¦‚æœå®šä¹‰åœ¨ç±»å¤–çš„è¯ï¼‰éƒ½æŒ‡å®šnoexceptã€‚</strong></p><blockquote><p>ä¸æŠ›å‡ºå¼‚å¸¸çš„ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦å¿…é¡»æ ‡è®°ä¸ºnoexceptã€‚</p></blockquote><p>ææ¸…æ¥šä¸ºä»€ä¹ˆéœ€è¦noexceptèƒ½å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£æ ‡å‡†åº“æ˜¯å¦‚ä½•ä¸æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹äº¤äº’çš„ã€‚</p><p>æˆ‘ä»¬éœ€è¦æŒ‡å‡ºä¸€ä¸ªç§»åŠ¨æ“ä½œä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ªç›¸äº’å…³è”çš„äº‹å®ï¼šé¦–å…ˆï¼Œè™½ç„¶ç§»åŠ¨æ“ä½œé€šå¸¸ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æŠ›å‡ºå¼‚å¸¸ä¹Ÿæ˜¯å…è®¸çš„ï¼›å…¶æ¬¡ï¼Œæ ‡å‡†åº“å®¹å™¨èƒ½å¯¹å¼‚å¸¸å‘ç”Ÿæ—¶å…¶è‡ªèº«çš„è¡Œä¸ºæä¾›ä¿éšœã€‚ä¾‹å¦‚ï¼Œvectorä¿è¯ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨push_backæ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œvectorè‡ªèº«ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ€è€ƒpush_backå†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚ç±»ä¼¼å¯¹åº”çš„StrVecæ“ä½œï¼ˆå‚è§13.5èŠ‚ï¼Œç¬¬466é¡µï¼‰ï¼Œå¯¹ä¸€ä¸ªvectorè°ƒç”¨push_backå¯èƒ½è¦æ±‚ä¸ºvectoré‡æ–°åˆ†é…å†…å­˜ç©ºé—´ã€‚å½“é‡æ–°åˆ†é…vectorçš„å†…å­˜æ—¶ï¼Œvectorå°†å…ƒç´ ä»æ—§ç©ºé—´ç§»åŠ¨åˆ°æ–°å†…å­˜ä¸­ï¼Œå°±åƒæˆ‘ä»¬åœ¨reallocateä¸­æ‰€åšçš„é‚£æ ·ï¼ˆå‚è§13.5èŠ‚ï¼Œç¬¬469é¡µï¼‰ã€‚å¦‚æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„é‚£æ ·ï¼Œç§»åŠ¨ä¸€ä¸ªå¯¹è±¡é€šå¸¸ä¼šæ”¹å˜å®ƒçš„å€¼ã€‚å¦‚æœé‡æ–°åˆ†é…è¿‡ç¨‹ä½¿ç”¨äº†ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¸”åœ¨ç§»åŠ¨äº†éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨å…ƒç´ åæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚æ—§ç©ºé—´ä¸­çš„ç§»åŠ¨æºå…ƒç´ å·²ç»è¢«æ”¹å˜äº†ï¼Œè€Œæ–°ç©ºé—´ä¸­æœªæ„é€ çš„å…ƒç´ å¯èƒ½å°šä¸å­˜åœ¨ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œvectorå°†ä¸èƒ½æ»¡è¶³è‡ªèº«ä¿æŒä¸å˜çš„è¦æ±‚ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœvectorä½¿ç”¨äº†æ‹·è´æ„é€ å‡½æ•°ä¸”å‘ç”Ÿäº†å¼‚å¸¸ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°æ»¡è¶³è¦æ±‚ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå½“åœ¨æ–°å†…å­˜ä¸­æ„é€ å…ƒç´ æ—¶ï¼Œæ—§å…ƒç´ ä¿æŒä¸å˜ã€‚å¦‚æœæ­¤æ—¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œvectorå¯ä»¥é‡Šæ”¾æ–°åˆ†é…çš„ï¼ˆä½†è¿˜æœªæˆåŠŸæ„é€ çš„ï¼‰å†…å­˜å¹¶è¿”å›ã€‚vectoråŸæœ‰çš„å…ƒç´ ä»ç„¶å­˜åœ¨ã€‚ä¸ºäº†é¿å…è¿™ç§æ½œåœ¨é—®é¢˜ï¼Œé™¤évectorçŸ¥é“å…ƒç´ ç±»å‹çš„ç§»åŠ¨æ„é€ å‡½æ•°ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åœ¨é‡æ–°åˆ†é…å†…å­˜çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒå°±å¿…é¡»ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°è€Œä¸æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</p><p>å¦‚æœå¸Œæœ›åœ¨vectoré‡æ–°åˆ†é…å†…å­˜è¿™ç±»æƒ…å†µä¸‹å¯¹æˆ‘ä»¬è‡ªå®šä¹‰ç±»å‹çš„å¯¹è±¡è¿›è¡Œç§»åŠ¨è€Œä¸æ˜¯æ‹·è´ï¼Œå°±å¿…é¡»æ˜¾å¼åœ°å‘Šè¯‰æ ‡å‡†åº“æˆ‘ä»¬çš„ç§»åŠ¨æ„é€ å‡½æ•°å¯ä»¥å®‰å…¨ä½¿ç”¨ã€‚æˆ‘ä»¬é€šè¿‡å°†ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆåŠç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼‰æ ‡è®°ä¸ºnoexceptæ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p><strong>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</strong></p><p>ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦æ‰§è¡Œä¸ææ„å‡½æ•°å’Œç§»åŠ¨æ„é€ å‡½æ•°ç›¸åŒçš„å·¥ä½œã€‚ä¸ç§»åŠ¨æ„é€ å‡½æ•°ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬çš„ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ä¸æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œæˆ‘ä»¬å°±åº”è¯¥å°†å®ƒæ ‡è®°ä¸ºnoexceptã€‚ç±»ä¼¼æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦å¿…é¡»æ­£ç¡®å¤„ç†è‡ªèµ‹å€¼</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923010734523.png"></p><p>æˆ‘ä»¬è´¹å¿ƒåœ°å»æ£€æŸ¥è‡ªèµ‹å€¼æƒ…å†µçœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªã€‚æ¯•ç«Ÿï¼Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦éœ€è¦å³ä¾§è¿ç®—å¯¹è±¡çš„ä¸€ä¸ªå³å€¼ã€‚æˆ‘ä»¬è¿›è¡Œæ£€æŸ¥çš„åŸå› æ˜¯æ­¤å³å€¼å¯èƒ½æ˜¯moveè°ƒç”¨çš„è¿”å›ç»“æœã€‚ä¸å…¶ä»–ä»»ä½•èµ‹å€¼è¿ç®—ç¬¦ä¸€æ ·ï¼Œå…³é”®ç‚¹æ˜¯æˆ‘ä»¬ä¸èƒ½åœ¨ä½¿ç”¨å³ä¾§è¿ç®—å¯¹è±¡çš„èµ„æºä¹‹å‰å°±é‡Šæ”¾å·¦ä¾§è¿ç®—å¯¹è±¡çš„èµ„æºï¼ˆå¯èƒ½æ˜¯ç›¸åŒçš„èµ„æºï¼‰ã€‚</p><p><strong>ç§»åæºå¯¹è±¡å¿…é¡»å¯ææ„</strong></p><p>é™¤äº†å°†ç§»åæºå¯¹è±¡ç½®ä¸ºææ„å®‰å…¨çš„çŠ¶æ€ä¹‹å¤–ï¼Œç§»åŠ¨æ“ä½œè¿˜å¿…é¡»ä¿è¯å¯¹è±¡ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹è±¡æœ‰æ•ˆå°±æ˜¯æŒ‡å¯ä»¥å®‰å…¨åœ°ä¸ºå…¶èµ‹äºˆæ–°å€¼æˆ–è€…å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨è€Œä¸ä¾èµ–å…¶å½“å‰å€¼ã€‚å¦ä¸€æ–¹é¢ï¼Œç§»åŠ¨æ“ä½œå¯¹ç§»åæºå¯¹è±¡ä¸­ç•™ä¸‹çš„å€¼æ²¡æœ‰ä»»ä½•è¦æ±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¨‹åºä¸åº”è¯¥ä¾èµ–äºç§»åæºå¯¹è±¡ä¸­çš„æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬ä»ä¸€ä¸ªæ ‡å‡†åº“stringæˆ–å®¹å™¨å¯¹è±¡ç§»åŠ¨æ•°æ®æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“ç§»åæºå¯¹è±¡ä»ç„¶ä¿æŒæœ‰æ•ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å®ƒæ‰§è¡Œè¯¸å¦‚emptyæˆ–sizeè¿™äº›æ“ä½œã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å°†ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœã€‚æˆ‘ä»¬å¯èƒ½æœŸæœ›ä¸€ä¸ªç§»åæºå¯¹è±¡æ˜¯ç©ºçš„ï¼Œä½†è¿™å¹¶æ²¡æœ‰ä¿è¯ã€‚</p><p><strong>åˆæˆçš„ç§»åŠ¨æ“ä½œ</strong></p><p>ä¸å¤„ç†æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ä¸€æ ·ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šåˆæˆç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚ä½†æ˜¯ï¼Œåˆæˆç§»åŠ¨æ“ä½œçš„æ¡ä»¶ä¸åˆæˆæ‹·è´æ“ä½œçš„æ¡ä»¶å¤§ä¸ç›¸åŒã€‚</p><p>ä¸æ‹·è´æ“ä½œä¸åŒï¼Œç¼–è¯‘å™¨æ ¹æœ¬ä¸ä¼šä¸ºæŸäº›ç±»åˆæˆç§»åŠ¨æ“ä½œã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†è‡ªå·±çš„æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æˆ–è€…ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šä¸ºå®ƒåˆæˆç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦äº†ã€‚</p><p>åªæœ‰å½“ä¸€ä¸ªç±»æ²¡æœ‰å®šä¹‰ä»»ä½•è‡ªå·±ç‰ˆæœ¬çš„æ‹·è´æ§åˆ¶æˆå‘˜ï¼Œä¸”ç±»çš„æ¯ä¸ªéstaticæ•°æ®æˆå‘˜éƒ½å¯ä»¥ç§»åŠ¨æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºå®ƒåˆæˆç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚</p><blockquote><p>åªæœ‰å½“ä¸€ä¸ªç±»æ²¡æœ‰å®šä¹‰ä»»ä½•è‡ªå·±ç‰ˆæœ¬çš„æ‹·è´æ§åˆ¶æˆå‘˜ï¼Œä¸”å®ƒçš„æ‰€æœ‰æ•°æ®æˆå‘˜éƒ½èƒ½ç§»åŠ¨æ„é€ æˆ–ç§»åŠ¨èµ‹å€¼æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šä¸ºå®ƒåˆæˆç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚</p></blockquote><p>ä¸æ‹·è´æ“ä½œä¸åŒï¼Œç§»åŠ¨æ“ä½œæ°¸è¿œä¸ä¼šéšå¼å®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ˜¾å¼åœ°è¦æ±‚ç¼–è¯‘å™¨ç”Ÿæˆ&#x3D;defaultçš„ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬237é¡µï¼‰ç§»åŠ¨æ“ä½œï¼Œä¸”ç¼–è¯‘å™¨ä¸èƒ½ç§»åŠ¨æ‰€æœ‰æˆå‘˜ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šå°†ç§»åŠ¨æ“ä½œå®šä¹‰ä¸ºåˆ é™¤çš„å‡½æ•°ã€‚</p><p><strong>ç§»åŠ¨å³å€¼ï¼Œæ‹·è´å·¦å€¼ï¼Œä½†å¦‚æœæ²¡æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå³å€¼ä¹Ÿè¢«æ‹·è´</strong></p><p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå‡½æ•°åŒ¹é…è§„åˆ™ä¿è¯è¯¥ç±»å‹çš„å¯¹è±¡ä¼šè¢«æ‹·è´ï¼Œå³ä½¿æˆ‘ä»¬è¯•å›¾é€šè¿‡è°ƒç”¨moveæ¥ç§»åŠ¨å®ƒä»¬æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”¨æ‹·è´æ„é€ å‡½æ•°ä»£æ›¿ç§»åŠ¨æ„é€ å‡½æ•°å‡ ä¹è‚¯å®šæ˜¯å®‰å…¨çš„ï¼ˆèµ‹å€¼è¿ç®—ç¬¦çš„æƒ…å†µç±»ä¼¼ï¼‰ã€‚</p><p><strong>æ‹·è´å¹¶äº¤æ¢èµ‹å€¼è¿ç®—ç¬¦å’Œç§»åŠ¨æ“ä½œ</strong></p><p>æˆ‘ä»¬çš„HasPtrç‰ˆæœ¬å®šä¹‰äº†ä¸€ä¸ªæ‹·è´å¹¶äº¤æ¢èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå‚è§13.3èŠ‚ï¼Œç¬¬459é¡µï¼‰ï¼Œå®ƒæ˜¯å‡½æ•°åŒ¹é…å’Œç§»åŠ¨æ“ä½œé—´ç›¸äº’å…³ç³»çš„ä¸€ä¸ªå¾ˆå¥½çš„ç¤ºä¾‹ã€‚å¦‚æœæˆ‘ä»¬ä¸ºæ­¤ç±»æ·»åŠ ä¸€ä¸ªç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå®ƒå®é™…ä¸Šä¹Ÿä¼šè·å¾—ä¸€ä¸ªç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923011641781.png"></p><p>ç°åœ¨è®©æˆ‘ä»¬è§‚å¯Ÿèµ‹å€¼è¿ç®—ç¬¦ã€‚æ­¤è¿ç®—ç¬¦æœ‰ä¸€ä¸ªéå¼•ç”¨å‚æ•°ï¼Œè¿™æ„å‘³ç€æ­¤å‚æ•°è¦è¿›è¡Œæ‹·è´åˆå§‹åŒ–ï¼ˆå‚è§13.1.1èŠ‚ï¼Œç¬¬441é¡µï¼‰ã€‚ä¾èµ–äºå®å‚çš„ç±»å‹ï¼Œæ‹·è´åˆå§‹åŒ–è¦ä¹ˆä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œè¦ä¹ˆä½¿ç”¨ç§»åŠ¨æ„é€ å‡½æ•°â€”â€”å·¦å€¼è¢«æ‹·è´ï¼Œå³å€¼è¢«ç§»åŠ¨ã€‚</p><p><strong>å»ºè®®ï¼šæ›´æ–°ä¸‰&#x2F;äº”æ³•åˆ™</strong></p><p>æ‰€æœ‰äº”ä¸ªæ‹·è´æ§åˆ¶æˆå‘˜åº”è¯¥çœ‹ä½œä¸€ä¸ªæ•´ä½“ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†ä»»ä½•ä¸€ä¸ªæ‹·è´æ“ä½œï¼Œå®ƒå°±åº”è¯¥å®šä¹‰æ‰€æœ‰äº”ä¸ªæ“ä½œã€‚å¦‚å‰æ‰€è¿°ï¼ŒæŸäº›ç±»å¿…é¡»å®šä¹‰æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦å’Œææ„å‡½æ•°æ‰èƒ½æ­£ç¡®å·¥ä½œï¼ˆå‚è§13.1.4èŠ‚ï¼Œç¬¬447é¡µï¼‰ã€‚è¿™äº›ç±»é€šå¸¸æ‹¥æœ‰ä¸€ä¸ªèµ„æºï¼Œè€Œæ‹·è´æˆå‘˜å¿…é¡»æ‹·è´æ­¤èµ„æºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‹·è´ä¸€ä¸ªèµ„æºä¼šå¯¼è‡´ä¸€äº›é¢å¤–å¼€é”€ã€‚åœ¨è¿™ç§æ‹·è´å¹¶éå¿…è¦çš„æƒ…å†µä¸‹ï¼Œå®šä¹‰äº†ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦çš„ç±»å°±å¯ä»¥é¿å…æ­¤é—®é¢˜ã€‚</p><p><strong>ç§»åŠ¨è¿­ä»£å™¨</strong></p><p>StrVecçš„reallocateæˆå‘˜ï¼ˆå‚è§13.5èŠ‚ï¼Œç¬¬469é¡µï¼‰ä½¿ç”¨äº†ä¸€ä¸ªforå¾ªç¯æ¥è°ƒç”¨constructä»æ—§å†…å­˜å°†å…ƒç´ æ‹·è´åˆ°æ–°å†…å­˜ä¸­ã€‚ä½œä¸ºä¸€ç§æ›¿æ¢æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è°ƒç”¨uninitialized_copyæ¥æ„é€ æ–°åˆ†é…çš„å†…å­˜ï¼Œå°†æ¯”å¾ªç¯æ›´ä¸ºç®€å•ã€‚ä½†æ˜¯ï¼Œuninitialized_copyæ°å¦‚å…¶åï¼šå®ƒå¯¹å…ƒç´ è¿›è¡Œæ‹·è´æ“ä½œã€‚æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰ç±»ä¼¼çš„å‡½æ•°å°†å¯¹è±¡â€œç§»åŠ¨â€åˆ°æœªæ„é€ çš„å†…å­˜ä¸­ã€‚</p><p><strong>æ–°æ ‡å‡†åº“ä¸­å®šä¹‰äº†ä¸€ç§ç§»åŠ¨è¿­ä»£å™¨ï¼ˆmove iteratorï¼‰é€‚é…å™¨ï¼ˆå‚è§10.4èŠ‚ï¼Œç¬¬358é¡µï¼‰ã€‚</strong>ä¸€ä¸ªç§»åŠ¨è¿­ä»£å™¨é€šè¿‡æ”¹å˜ç»™å®šè¿­ä»£å™¨çš„è§£å¼•ç”¨è¿ç®—ç¬¦çš„è¡Œä¸ºæ¥é€‚é…æ­¤è¿­ä»£å™¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªè¿­ä»£å™¨çš„è§£å¼•ç”¨è¿ç®—ç¬¦è¿”å›ä¸€ä¸ªæŒ‡å‘å…ƒç´ çš„å·¦å€¼ã€‚ä¸å…¶ä»–è¿­ä»£å™¨ä¸åŒï¼Œç§»åŠ¨è¿­ä»£å™¨çš„è§£å¼•ç”¨è¿ç®—ç¬¦ç”Ÿæˆä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚</p><p><strong>æˆ‘ä»¬é€šè¿‡è°ƒç”¨æ ‡å‡†åº“çš„make_move_iteratorå‡½æ•°å°†ä¸€ä¸ªæ™®é€šè¿­ä»£å™¨è½¬æ¢ä¸ºä¸€ä¸ªç§»åŠ¨è¿­ä»£å™¨ã€‚</strong>æ­¤å‡½æ•°æ¥å—ä¸€ä¸ªè¿­ä»£å™¨å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªç§»åŠ¨è¿­ä»£å™¨ã€‚</p><p>åŸè¿­ä»£å™¨çš„æ‰€æœ‰å…¶ä»–æ“ä½œåœ¨ç§»åŠ¨è¿­ä»£å™¨ä¸­éƒ½ç…§å¸¸å·¥ä½œã€‚ç”±äºç§»åŠ¨è¿­ä»£å™¨æ”¯æŒæ­£å¸¸çš„è¿­ä»£å™¨æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€å¯¹ç§»åŠ¨è¿­ä»£å™¨ä¼ é€’ç»™ç®—æ³•ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¯ä»¥å°†ç§»åŠ¨è¿­ä»£å™¨ä¼ é€’ç»™uninitialized_copy</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923012046882.png"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ ‡å‡†åº“ä¸ä¿è¯å“ªäº›ç®—æ³•é€‚ç”¨ç§»åŠ¨è¿­ä»£å™¨ï¼Œå“ªäº›ä¸é€‚ç”¨ã€‚ç”±äºç§»åŠ¨ä¸€ä¸ªå¯¹è±¡å¯èƒ½é”€æ¯æ‰åŸå¯¹è±¡ï¼Œå› æ­¤ä½ åªæœ‰åœ¨ç¡®ä¿¡ç®—æ³•åœ¨ä¸ºä¸€ä¸ªå…ƒç´ èµ‹å€¼æˆ–å°†å…¶ä¼ é€’ç»™ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‡½æ•°åä¸å†è®¿é—®å®ƒæ—¶ï¼Œæ‰èƒ½å°†ç§»åŠ¨è¿­ä»£å™¨ä¼ é€’ç»™ç®—æ³•ã€‚</p><p><strong>å»ºè®®ï¼šä¸è¦éšæ„ä½¿ç”¨ç§»åŠ¨æ“ä½œ</strong></p><h3 id="13-6-3-å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°"><a href="#13-6-3-å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°" class="headerlink" title="13.6.3 å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°"></a>13.6.3 å³å€¼å¼•ç”¨å’Œæˆå‘˜å‡½æ•°</h3><p>é™¤äº†æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ä¹‹å¤–ï¼Œå¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°åŒæ—¶æä¾›æ‹·è´å’Œç§»åŠ¨ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿèƒ½ä»ä¸­å—ç›Šã€‚è¿™ç§å…è®¸ç§»åŠ¨çš„æˆå‘˜å‡½æ•°é€šå¸¸ä½¿ç”¨ä¸æ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ç›¸åŒçš„å‚æ•°æ¨¡å¼â€”â€”<strong>ä¸€ä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªæŒ‡å‘constçš„å·¦å€¼å¼•ç”¨ï¼Œç¬¬äºŒä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªæŒ‡å‘éconstçš„å³å€¼å¼•ç”¨ã€‚</strong></p><p>ä¾‹å¦‚ï¼Œå®šä¹‰äº†push_backçš„æ ‡å‡†åº“å®¹å™¨æä¾›ä¸¤ä¸ªç‰ˆæœ¬ï¼šä¸€ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªå³å€¼å¼•ç”¨å‚æ•°ï¼Œè€Œå¦ä¸€ä¸ªç‰ˆæœ¬æœ‰ä¸€ä¸ªconstå·¦å€¼å¼•ç”¨ã€‚å‡å®šXæ˜¯å…ƒç´ ç±»å‹ï¼Œé‚£ä¹ˆè¿™äº›å®¹å™¨å°±ä¼šå®šä¹‰ä»¥ä¸‹ä¸¤ä¸ªpush_backç‰ˆæœ¬</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923012349761.png"></p><blockquote><p>åŒºåˆ†ç§»åŠ¨å’Œæ‹·è´çš„é‡è½½å‡½æ•°é€šå¸¸æœ‰ä¸€ä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªconst T&amp;ï¼Œè€Œå¦ä¸€ä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªT&amp;&amp;ã€‚</p></blockquote><p><strong>å³å€¼å’Œå·¦å€¼å¼•ç”¨æˆå‘˜å‡½æ•°</strong></p><p>é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œè€Œä¸ç®¡è¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªå·¦å€¼è¿˜æ˜¯ä¸€ä¸ªå³å€¼ã€‚ä¾‹å¦‚</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923012527686.png"></p><p>æœ‰æ—¶ï¼Œå³å€¼çš„ä½¿ç”¨æ–¹å¼å¯èƒ½ä»¤äººæƒŠè®¶ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923012611035.png"></p><p>åœ¨æ—§æ ‡å‡†ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•é˜»æ­¢è¿™ç§ä½¿ç”¨æ–¹å¼ã€‚ä¸ºäº†ç»´æŒå‘åå…¼å®¹æ€§ï¼Œæ–°æ ‡å‡†åº“ç±»ä»ç„¶å…è®¸å‘å³å€¼èµ‹å€¼ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨è‡ªå·±çš„ç±»ä¸­é˜»æ­¢è¿™ç§ç”¨æ³•ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å¼ºåˆ¶å·¦ä¾§è¿ç®—å¯¹è±¡ï¼ˆå³ï¼ŒthisæŒ‡å‘çš„å¯¹è±¡ï¼‰æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚</p><p>æˆ‘ä»¬æŒ‡å‡ºthisçš„å·¦å€¼&#x2F;å³å€¼å±æ€§çš„æ–¹å¼ä¸å®šä¹‰constæˆå‘˜å‡½æ•°ç›¸åŒï¼ˆå‚è§7.1.2èŠ‚ï¼Œç¬¬231é¡µï¼‰ï¼Œå³ï¼Œåœ¨å‚æ•°åˆ—è¡¨åæ”¾ç½®ä¸€ä¸ªå¼•ç”¨é™å®šç¬¦ï¼ˆreference qualifierï¼‰</p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923012654396.png"></p><p>å¼•ç”¨é™å®šç¬¦å¯ä»¥æ˜¯&amp;æˆ–&amp;&amp;ï¼Œåˆ†åˆ«æŒ‡å‡ºthiså¯ä»¥æŒ‡å‘ä¸€ä¸ªå·¦å€¼æˆ–å³å€¼ã€‚<strong>ç±»ä¼¼consté™å®šç¬¦ï¼Œå¼•ç”¨é™å®šç¬¦åªèƒ½ç”¨äºï¼ˆéstaticï¼‰æˆå‘˜å‡½æ•°ï¼Œä¸”å¿…é¡»åŒæ—¶å‡ºç°åœ¨å‡½æ•°çš„å£°æ˜å’Œå®šä¹‰ä¸­ã€‚</strong></p><p>å¯¹äº&amp;é™å®šçš„å‡½æ•°ï¼Œæˆ‘ä»¬åªèƒ½å°†å®ƒç”¨äºå·¦å€¼ï¼›å¯¹äº&amp;&amp;é™å®šçš„å‡½æ•°ï¼Œåªèƒ½ç”¨äºå³å€¼</p><p>ä¸€ä¸ªå‡½æ•°å¯ä»¥åŒæ—¶ç”¨constå’Œå¼•ç”¨é™å®šã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå¼•ç”¨é™å®šç¬¦å¿…é¡»è·Ÿéšåœ¨consté™å®šç¬¦ä¹‹å</p><p><strong>é‡è½½å’Œå¼•ç”¨å‡½æ•°</strong></p><p>å°±åƒä¸€ä¸ªæˆå‘˜å‡½æ•°å¯ä»¥æ ¹æ®æ˜¯å¦æœ‰constæ¥åŒºåˆ†å…¶é‡è½½ç‰ˆæœ¬ä¸€æ ·ï¼ˆå‚è§7.3.2èŠ‚ï¼Œç¬¬247é¡µï¼‰ï¼Œå¼•ç”¨é™å®šç¬¦ä¹Ÿå¯ä»¥åŒºåˆ†é‡è½½ç‰ˆæœ¬ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬å¯ä»¥ç»¼åˆå¼•ç”¨é™å®šç¬¦å’Œconstæ¥åŒºåˆ†ä¸€ä¸ªæˆå‘˜å‡½æ•°çš„é‡è½½ç‰ˆæœ¬ã€‚</p><p>å½“æˆ‘ä»¬å®šä¹‰constæˆå‘˜å‡½æ•°æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå”¯ä¸€çš„å·®åˆ«æ˜¯ä¸€ä¸ªç‰ˆæœ¬æœ‰consté™å®šè€Œå¦ä¸€ä¸ªæ²¡æœ‰ã€‚å¼•ç”¨é™å®šçš„å‡½æ•°åˆ™ä¸ä¸€æ ·ã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå…·æœ‰ç›¸åŒåå­—å’Œç›¸åŒå‚æ•°åˆ—è¡¨çš„æˆå‘˜å‡½æ•°ï¼Œå°±å¿…é¡»å¯¹æ‰€æœ‰å‡½æ•°éƒ½åŠ ä¸Šå¼•ç”¨é™å®šç¬¦ï¼Œæˆ–è€…æ‰€æœ‰éƒ½ä¸åŠ </p><p><img src="/../images/C-C-Primer-Chapter-13/image-20240923013042247.png"></p><blockquote><p>å¦‚æœä¸€ä¸ªæˆå‘˜å‡½æ•°æœ‰å¼•ç”¨é™å®šç¬¦ï¼Œåˆ™å…·æœ‰ç›¸åŒå‚æ•°åˆ—è¡¨çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½å¿…é¡»æœ‰å¼•ç”¨é™å®šç¬¦ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 12</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-12/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-12/</url>
    
    <content type="html"><![CDATA[<h1 id="åŠ¨æ€å†…å­˜"><a href="#åŠ¨æ€å†…å­˜" class="headerlink" title="åŠ¨æ€å†…å­˜"></a>åŠ¨æ€å†…å­˜</h1><span id="more"></span><p>é™æ€å†…å­˜ç”¨æ¥ä¿å­˜å±€éƒ¨staticå¯¹è±¡ï¼ˆå‚è§6.6.1èŠ‚ï¼Œç¬¬185é¡µï¼‰ã€ç±»staticæ•°æ®æˆå‘˜ï¼ˆå‚è§7.6èŠ‚ï¼Œç¬¬268é¡µï¼‰ä»¥åŠå®šä¹‰åœ¨ä»»ä½•å‡½æ•°ä¹‹å¤–çš„å˜é‡ã€‚</p><p>æ ˆå†…å­˜ç”¨æ¥ä¿å­˜å®šä¹‰åœ¨å‡½æ•°å†…çš„éstaticå¯¹è±¡ã€‚åˆ†é…åœ¨é™æ€æˆ–æ ˆå†…å­˜ä¸­çš„å¯¹è±¡ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ›å»ºå’Œé”€æ¯ã€‚</p><p>å¯¹äºæ ˆå¯¹è±¡ï¼Œä»…åœ¨å…¶å®šä¹‰çš„ç¨‹åºå—è¿è¡Œæ—¶æ‰å­˜åœ¨ï¼›staticå¯¹è±¡åœ¨ä½¿ç”¨ä¹‹å‰åˆ†é…ï¼Œåœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ã€‚</p><p>é™¤äº†é™æ€å†…å­˜å’Œæ ˆå†…å­˜ï¼Œæ¯ä¸ªç¨‹åºè¿˜æ‹¥æœ‰ä¸€ä¸ªå†…å­˜æ± ã€‚è¿™éƒ¨åˆ†å†…å­˜è¢«ç§°ä½œè‡ªç”±ç©ºé—´ï¼ˆfree storeï¼‰æˆ–å †ï¼ˆheapï¼‰ã€‚ç¨‹åºç”¨å †æ¥å­˜å‚¨åŠ¨æ€åˆ†é…ï¼ˆdynamically allocateï¼‰çš„å¯¹è±¡â€”â€”å³ï¼Œé‚£äº›åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ†é…çš„å¯¹è±¡ã€‚åŠ¨æ€å¯¹è±¡çš„ç”Ÿå­˜æœŸç”±ç¨‹åºæ¥æ§åˆ¶ã€‚</p><h2 id="12-1-åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ"><a href="#12-1-åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="12.1 åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ"></a>12.1 åŠ¨æ€å†…å­˜ä¸æ™ºèƒ½æŒ‡é’ˆ</h2><p>ä¸ºäº†æ›´å®¹æ˜“ï¼ˆåŒæ—¶ä¹Ÿæ›´å®‰å…¨ï¼‰åœ°ä½¿ç”¨åŠ¨æ€å†…å­˜ï¼Œæ–°çš„æ ‡å‡†åº“æä¾›äº†ä¸¤ç§æ™ºèƒ½æŒ‡é’ˆï¼ˆsmart pointerï¼‰ç±»å‹æ¥ç®¡ç†åŠ¨æ€å¯¹è±¡ã€‚æ™ºèƒ½æŒ‡é’ˆçš„è¡Œä¸ºç±»ä¼¼å¸¸è§„æŒ‡é’ˆï¼Œé‡è¦çš„åŒºåˆ«æ˜¯å®ƒè´Ÿè´£è‡ªåŠ¨é‡Šæ”¾æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚æ–°æ ‡å‡†åº“æä¾›çš„è¿™ä¸¤ç§æ™ºèƒ½æŒ‡é’ˆçš„åŒºåˆ«åœ¨äºç®¡ç†åº•å±‚æŒ‡é’ˆçš„æ–¹å¼ï¼šshared_ptrå…è®¸å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼›unique_ptråˆ™â€œç‹¬å â€æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚æ ‡å‡†åº“è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸ºweak_ptrçš„ä¼´éšç±»ï¼Œå®ƒæ˜¯ä¸€ç§å¼±å¼•ç”¨ï¼ŒæŒ‡å‘shared_ptræ‰€ç®¡ç†çš„å¯¹è±¡ã€‚è¿™ä¸‰ç§ç±»å‹éƒ½å®šä¹‰åœ¨memoryå¤´æ–‡ä»¶ä¸­ã€‚</p><h3 id="12-1-1-shared-ptrç±»"><a href="#12-1-1-shared-ptrç±»" class="headerlink" title="12.1.1 shared_ptrç±»"></a>12.1.1 shared_ptrç±»</h3><p><img src="/../images/C-C-Primer-Chapter-12/1726455699143.png"></p><p><img src="/../images/C-C-Primer-Chapter-12/1726455732235.png"></p><p><strong>make_sharedå‡½æ•°</strong></p><p>æœ€å®‰å…¨çš„åˆ†é…å’Œä½¿ç”¨åŠ¨æ€å†…å­˜çš„æ–¹æ³•æ˜¯è°ƒç”¨ä¸€ä¸ªåä¸ºmake_sharedçš„æ ‡å‡†åº“å‡½æ•°ã€‚æ­¤å‡½æ•°åœ¨åŠ¨æ€å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªå¯¹è±¡å¹¶åˆå§‹åŒ–å®ƒï¼Œè¿”å›æŒ‡å‘æ­¤å¯¹è±¡çš„shared_ptrã€‚</p><p>ç±»ä¼¼é¡ºåºå®¹å™¨çš„emplaceæˆå‘˜ï¼ˆå‚è§9.3.1èŠ‚ï¼Œç¬¬308é¡µï¼‰ï¼Œmake_sharedç”¨å…¶å‚æ•°æ¥æ„é€ ç»™å®šç±»å‹çš„å¯¹è±¡ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸ä¼ é€’ä»»ä½•å‚æ•°ï¼Œå¯¹è±¡å°±ä¼šè¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ã€‚</p><p><strong>shared_ptrçš„æ‹·è´å’Œèµ‹å€¼</strong></p><p>å½“è¿›è¡Œæ‹·è´æˆ–èµ‹å€¼æ“ä½œæ—¶ï¼Œæ¯ä¸ªshared_ptréƒ½ä¼šè®°å½•æœ‰å¤šå°‘ä¸ªå…¶ä»–shared_ptræŒ‡å‘ç›¸åŒçš„å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ¯ä¸ªshared_ptréƒ½æœ‰ä¸€ä¸ªå…³è”çš„è®¡æ•°å™¨ï¼Œé€šå¸¸ç§°å…¶ä¸ºå¼•ç”¨è®¡æ•°ï¼ˆreference countï¼‰ã€‚æ— è®ºä½•æ—¶æˆ‘ä»¬æ‹·è´ä¸€ä¸ªshared_ptrï¼Œè®¡æ•°å™¨éƒ½ä¼šé€’å¢ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨ä¸€ä¸ªshared_ptråˆå§‹åŒ–å¦ä¸€ä¸ªshared_ptrï¼Œæˆ–å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼ˆå‚è§6.2.1èŠ‚ï¼Œç¬¬188é¡µï¼‰ä»¥åŠä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼ˆå‚è§6.3.2èŠ‚ï¼Œç¬¬201é¡µï¼‰æ—¶ï¼Œå®ƒæ‰€å…³è”çš„è®¡æ•°å™¨å°±ä¼šé€’å¢ã€‚å½“æˆ‘ä»¬ç»™shared_ptrèµ‹äºˆä¸€ä¸ªæ–°å€¼æˆ–æ˜¯shared_ptrè¢«é”€æ¯ï¼ˆä¾‹å¦‚ä¸€ä¸ªå±€éƒ¨çš„shared_ptrç¦»å¼€å…¶ä½œç”¨åŸŸï¼ˆå‚è§6.1.1èŠ‚ï¼Œç¬¬184é¡µï¼‰ï¼‰æ—¶ï¼Œè®¡æ•°å™¨å°±ä¼šé€’å‡ã€‚</p><p>ä¸€æ—¦ä¸€ä¸ªshared_ptrçš„è®¡æ•°å™¨å˜ä¸º0ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨é‡Šæ”¾è‡ªå·±æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚</p><p><strong>shared_ptrè‡ªåŠ¨é”€æ¯æ‰€ç®¡ç†çš„å¯¹è±¡ï¼Œshared_ptrè¿˜ä¼šè‡ªåŠ¨é‡Šæ”¾ç›¸å…³è”çš„å†…å­˜</strong></p><p>ç”±äºåœ¨æœ€åä¸€ä¸ªshared_ptré”€æ¯å‰å†…å­˜éƒ½ä¸ä¼šé‡Šæ”¾ï¼Œä¿è¯shared_ptråœ¨æ— ç”¨ä¹‹åä¸å†ä¿ç•™å°±éå¸¸é‡è¦äº†ã€‚å¦‚æœä½ å¿˜è®°äº†é”€æ¯ç¨‹åºä¸å†éœ€è¦çš„shared_ptrï¼Œç¨‹åºä»ä¼šæ­£ç¡®æ‰§è¡Œï¼Œä½†ä¼šæµªè´¹å†…å­˜ã€‚share_ptråœ¨æ— ç”¨ä¹‹åä»ç„¶ä¿ç•™çš„ä¸€ç§å¯èƒ½æƒ…å†µæ˜¯ï¼Œä½ å°†shared_ptrå­˜æ”¾åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œéšåé‡æ’äº†å®¹å™¨ï¼Œä»è€Œä¸å†éœ€è¦æŸäº›å…ƒç´ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ç¡®ä¿ç”¨eraseåˆ é™¤é‚£äº›ä¸å†éœ€è¦çš„shared_ptrå…ƒç´ ã€‚</p><blockquote><p>å¦‚æœä½ å°†shared_ptrå­˜æ”¾äºä¸€ä¸ªå®¹å™¨ä¸­ï¼Œè€Œåä¸å†éœ€è¦å…¨éƒ¨å…ƒç´ ï¼Œè€Œåªä½¿ç”¨å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œè¦è®°å¾—ç”¨eraseåˆ é™¤ä¸å†éœ€è¦çš„é‚£äº›å…ƒç´ ã€‚</p></blockquote><p><strong>ä½¿ç”¨äº†åŠ¨æ€ç”Ÿå­˜æœŸçš„èµ„æºçš„ç±»</strong></p><p>ç¨‹åºä½¿ç”¨åŠ¨æ€å†…å­˜å‡ºäºä»¥ä¸‹ä¸‰ç§åŸå› ä¹‹ä¸€ï¼š</p><ul><li>ç¨‹åºä¸çŸ¥é“è‡ªå·±éœ€è¦ä½¿ç”¨å¤šå°‘å¯¹è±¡</li><li>ç¨‹åºä¸çŸ¥é“æ‰€éœ€å¯¹è±¡çš„å‡†ç¡®ç±»å‹</li><li>ç¨‹åºéœ€è¦åœ¨å¤šä¸ªå¯¹è±¡é—´å…±äº«æ•°æ®</li></ul><p>å®¹å™¨ç±»æ˜¯å‡ºäºç¬¬ä¸€ç§åŸå› è€Œä½¿ç”¨åŠ¨æ€å†…å­˜çš„å…¸å‹ä¾‹å­ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬15ç« çœ‹åˆ°å‡ºäºç¬¬äºŒç§åŸå› è€Œä½¿ç”¨åŠ¨æ€å†…å­˜çš„ä¾‹å­ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ƒä½¿ç”¨åŠ¨æ€å†…å­˜æ˜¯ä¸ºäº†è®©å¤šä¸ªå¯¹è±¡èƒ½å…±äº«ç›¸åŒçš„åº•å±‚æ•°æ®ã€‚</p><p>æŸäº›ç±»åˆ†é…çš„èµ„æºå…·æœ‰ä¸åŸå¯¹è±¡ç›¸ç‹¬ç«‹çš„ç”Ÿå­˜æœŸã€‚ä¾‹å¦‚ï¼Œå‡å®šæˆ‘ä»¬å¸Œæœ›å®šä¹‰ä¸€ä¸ªåä¸ºBlobçš„ç±»ï¼Œä¿å­˜ä¸€ç»„å…ƒç´ ã€‚ä¸å®¹å™¨ä¸åŒï¼Œæˆ‘ä»¬å¸Œæœ›Blobå¯¹è±¡çš„ä¸åŒæ‹·è´ä¹‹é—´å…±äº«ç›¸åŒçš„å…ƒç´ ã€‚å³ï¼Œå½“æˆ‘ä»¬æ‹·è´ä¸€ä¸ªBlobæ—¶ï¼ŒåŸBlobå¯¹è±¡åŠå…¶æ‹·è´åº”è¯¥å¼•ç”¨ç›¸åŒçš„åº•å±‚å…ƒç´ ã€‚</p><blockquote><p>ä½¿ç”¨åŠ¨æ€å†…å­˜çš„ä¸€ä¸ªå¸¸è§åŸå› æ˜¯å…è®¸å¤šä¸ªå¯¹è±¡å…±äº«ç›¸åŒçš„çŠ¶æ€ã€‚</p></blockquote><h3 id="12-1-2-ç›´æ¥ç®¡ç†å†…å­˜"><a href="#12-1-2-ç›´æ¥ç®¡ç†å†…å­˜" class="headerlink" title="12.1.2 ç›´æ¥ç®¡ç†å†…å­˜"></a>12.1.2 ç›´æ¥ç®¡ç†å†…å­˜</h3><p><strong>ä½¿ç”¨newåŠ¨æ€åˆ†é…å’Œåˆå§‹åŒ–å¯¹è±¡</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åˆ†é…çš„å¯¹è±¡æ˜¯é»˜è®¤åˆå§‹åŒ–çš„ï¼ˆå‚è§2.2.1èŠ‚ï¼Œç¬¬40é¡µï¼‰ï¼Œè¿™æ„å‘³ç€å†…ç½®ç±»å‹æˆ–ç»„åˆç±»å‹çš„å¯¹è±¡çš„å€¼å°†æ˜¯æœªå®šä¹‰çš„ï¼Œè€Œç±»ç±»å‹å¯¹è±¡å°†ç”¨é»˜è®¤æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚ä¹Ÿå¯ä»¥å¯¹åŠ¨æ€åˆ†é…çš„å¯¹è±¡è¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ï¼Œåªéœ€åœ¨ç±»å‹åä¹‹åè·Ÿä¸€å¯¹ç©ºæ‹¬å·å³å¯</p><p>å¯¹äºå®šä¹‰äº†è‡ªå·±çš„æ„é€ å‡½æ•°ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬235é¡µï¼‰çš„ç±»ç±»å‹ï¼ˆä¾‹å¦‚stringï¼‰æ¥è¯´ï¼Œè¦æ±‚å€¼åˆå§‹åŒ–æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼›ä¸ç®¡é‡‡ç”¨ä»€ä¹ˆå½¢å¼ï¼Œå¯¹è±¡éƒ½ä¼šé€šè¿‡é»˜è®¤æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ã€‚ä½†å¯¹äºå†…ç½®ç±»å‹ï¼Œä¸¤ç§å½¢å¼çš„å·®åˆ«å°±å¾ˆå¤§äº†ï¼›å€¼åˆå§‹åŒ–çš„å†…ç½®ç±»å‹å¯¹è±¡æœ‰ç€è‰¯å¥½å®šä¹‰çš„å€¼ï¼Œè€Œé»˜è®¤åˆå§‹åŒ–çš„å¯¹è±¡çš„å€¼åˆ™æ˜¯æœªå®šä¹‰çš„ã€‚ç±»ä¼¼çš„ï¼Œå¯¹äºç±»ä¸­é‚£äº›ä¾èµ–äºç¼–è¯‘å™¨åˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°çš„å†…ç½®ç±»å‹æˆå‘˜ï¼Œå¦‚æœå®ƒä»¬æœªåœ¨ç±»å†…è¢«åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å€¼ä¹Ÿæ˜¯æœªå®šä¹‰çš„ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬236é¡µï¼‰ã€‚</p><p>å¦‚æœæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ‹¬å·åŒ…å›´çš„åˆå§‹åŒ–å™¨ï¼Œå°±å¯ä»¥ä½¿ç”¨autoï¼ˆå‚è§2.5.2èŠ‚ï¼Œç¬¬61é¡µï¼‰ä»æ­¤åˆå§‹åŒ–å™¨æ¥æ¨æ–­æˆ‘ä»¬æƒ³è¦åˆ†é…çš„å¯¹è±¡çš„ç±»å‹ã€‚ä½†æ˜¯ï¼Œç”±äºç¼–è¯‘å™¨è¦ç”¨åˆå§‹åŒ–å™¨çš„ç±»å‹æ¥æ¨æ–­è¦åˆ†é…çš„ç±»å‹ï¼Œåªæœ‰å½“æ‹¬å·ä¸­ä»…æœ‰å•ä¸€åˆå§‹åŒ–å™¨æ—¶æ‰å¯ä»¥ä½¿ç”¨auto</p><p><img src="/../images/C-C-Primer-Chapter-12/1726457710921.png"></p><p><strong>åŠ¨æ€åˆ†é…çš„constå¯¹è±¡</strong></p><p><img src="/../images/C-C-Primer-Chapter-12/1726457753794.png"></p><p><strong>å†…å­˜è€—å°½</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœnewä¸èƒ½åˆ†é…æ‰€è¦æ±‚çš„å†…å­˜ç©ºé—´ï¼Œå®ƒä¼š<strong>æŠ›å‡ºä¸€ä¸ªç±»å‹ä¸ºbad_allocï¼ˆå‚è§5.6èŠ‚ï¼Œç¬¬173é¡µï¼‰çš„å¼‚å¸¸ã€‚</strong>æˆ‘ä»¬å¯ä»¥æ”¹å˜ä½¿ç”¨newçš„æ–¹å¼æ¥é˜»æ­¢å®ƒæŠ›å‡ºå¼‚å¸¸</p><p><img src="/../images/C-C-Primer-Chapter-12/1726457804949.png"></p><p>è¿™ç§å½¢å¼çš„newä¸ºå®šä½newï¼ˆplacement newï¼‰ï¼Œå…¶åŸå› æˆ‘ä»¬å°†åœ¨19.1.2èŠ‚ï¼ˆç¬¬729é¡µï¼‰ä¸­è§£é‡Šã€‚å®šä½newè¡¨è¾¾å¼å…è®¸æˆ‘ä»¬å‘newä¼ é€’é¢å¤–çš„å‚æ•°ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ç»™å®ƒä¸€ä¸ªç”±æ ‡å‡†åº“å®šä¹‰çš„åä¸ºnothrowçš„å¯¹è±¡ã€‚å¦‚æœå°†nothrowä¼ é€’ç»™newï¼Œæˆ‘ä»¬çš„æ„å›¾æ˜¯å‘Šè¯‰å®ƒä¸èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœè¿™ç§å½¢å¼çš„newä¸èƒ½åˆ†é…æ‰€éœ€å†…å­˜ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆã€‚bad_allocå’Œnothrowéƒ½å®šä¹‰åœ¨å¤´æ–‡ä»¶newä¸­ã€‚</p><p><strong>é‡Šæ”¾åŠ¨æ€å†…å­˜</strong></p><p><strong>æŒ‡é’ˆå€¼å’Œdelete</strong></p><p>æˆ‘ä»¬ä¼ é€’ç»™deleteçš„æŒ‡é’ˆå¿…é¡»æŒ‡å‘åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼ˆå‚è§2.3.2èŠ‚ï¼Œç¬¬48é¡µï¼‰ã€‚é‡Šæ”¾ä¸€å—å¹¶énewåˆ†é…çš„å†…å­˜ï¼Œæˆ–è€…å°†ç›¸åŒçš„æŒ‡é’ˆå€¼é‡Šæ”¾å¤šæ¬¡ï¼Œå…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„</p><p><img src="/../images/C-C-Primer-Chapter-12/1726457904246.png"></p><p><strong>åŠ¨æ€å¯¹è±¡çš„ç”Ÿå­˜æœŸç›´åˆ°è¢«é‡Šæ”¾æ—¶ä¸ºæ­¢</strong></p><p>è¿”å›æŒ‡å‘åŠ¨æ€å†…å­˜çš„æŒ‡é’ˆï¼ˆè€Œä¸æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼‰çš„å‡½æ•°ç»™å…¶è°ƒç”¨è€…å¢åŠ äº†ä¸€ä¸ªé¢å¤–è´Ÿæ‹…â€”â€”è°ƒç”¨è€…å¿…é¡»è®°å¾—é‡Šæ”¾å†…å­˜</p><p><strong>å°å¿ƒï¼šåŠ¨æ€å†…å­˜çš„ç®¡ç†éå¸¸å®¹æ˜“å‡ºé”™</strong></p><p>ä½¿ç”¨newå’Œdeleteç®¡ç†åŠ¨æ€å†…å­˜å­˜åœ¨ä¸‰ä¸ªå¸¸è§é—®é¢˜ï¼š</p><ul><li>å¿˜è®°deleteå†…å­˜ã€‚å¿˜è®°é‡Šæ”¾åŠ¨æ€å†…å­˜ä¼šå¯¼è‡´äººä»¬å¸¸è¯´çš„â€œå†…å­˜æ³„æ¼â€é—®é¢˜ï¼Œå› ä¸ºè¿™ç§å†…å­˜æ°¸è¿œä¸å¯èƒ½è¢«å½’è¿˜ç»™è‡ªç”±ç©ºé—´äº†ã€‚æŸ¥æ‰¾å†…å­˜æ³„éœ²é”™è¯¯æ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºé€šå¸¸åº”ç”¨ç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´åï¼ŒçœŸæ­£è€—å°½å†…å­˜æ—¶ï¼Œæ‰èƒ½æ£€æµ‹åˆ°è¿™ç§é”™è¯¯ã€‚</li><li>ä½¿ç”¨å·²ç»é‡Šæ”¾æ‰çš„å¯¹è±¡ã€‚é€šè¿‡åœ¨é‡Šæ”¾å†…å­˜åå°†æŒ‡é’ˆç½®ä¸ºç©ºï¼Œæœ‰æ—¶å¯ä»¥æ£€æµ‹å‡ºè¿™ç§é”™è¯¯ã€‚</li><li>åŒä¸€å—å†…å­˜é‡Šæ”¾ä¸¤æ¬¡ã€‚å½“æœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„åŠ¨æ€åˆ†é…å¯¹è±¡æ—¶ï¼Œå¯èƒ½å‘ç”Ÿè¿™ç§é”™è¯¯ã€‚å¦‚æœå¯¹å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆè¿›è¡Œäº†deleteæ“ä½œï¼Œå¯¹è±¡çš„å†…å­˜å°±è¢«å½’è¿˜ç»™è‡ªç”±ç©ºé—´äº†ã€‚å¦‚æœæˆ‘ä»¬éšååˆdeleteç¬¬äºŒä¸ªæŒ‡é’ˆï¼Œè‡ªç”±ç©ºé—´å°±å¯èƒ½è¢«ç ´åã€‚ç›¸å¯¹äºæŸ¥æ‰¾å’Œä¿®æ­£è¿™äº›é”™è¯¯æ¥è¯´ï¼Œåˆ¶é€ å‡ºè¿™äº›é”™è¯¯è¦ç®€å•å¾—å¤šã€‚</li></ul><p><strong>deleteä¹‹åé‡ç½®æŒ‡é’ˆå€¼ï¼Œè¿™åªæ˜¯æä¾›äº†æœ‰é™çš„ä¿æŠ¤</strong></p><h3 id="12-1-3-shared-ptrå’Œnewç»“åˆä½¿ç”¨"><a href="#12-1-3-shared-ptrå’Œnewç»“åˆä½¿ç”¨" class="headerlink" title="12.1.3 shared_ptrå’Œnewç»“åˆä½¿ç”¨"></a>12.1.3 shared_ptrå’Œnewç»“åˆä½¿ç”¨</h3><p>å¦‚æœæˆ‘ä»¬ä¸åˆå§‹åŒ–ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒå°±ä¼šè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºæŒ‡é’ˆã€‚å¦‚è¡¨12.3æ‰€ç¤ºï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨newè¿”å›çš„æŒ‡é’ˆæ¥åˆå§‹åŒ–æ™ºèƒ½æŒ‡é’ˆ</p><p><img src="/../images/C-C-Primer-Chapter-12/1726459676176.png"></p><p>æ¥å—æŒ‡é’ˆå‚æ•°çš„æ™ºèƒ½æŒ‡é’ˆæ„é€ å‡½æ•°æ˜¯explicitçš„ï¼ˆå‚è§7.5.4èŠ‚ï¼Œç¬¬265é¡µï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½å°†ä¸€ä¸ªå†…ç½®æŒ‡é’ˆéšå¼è½¬æ¢ä¸ºä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼Œå¿…é¡»ä½¿ç”¨ç›´æ¥åˆå§‹åŒ–å½¢å¼ï¼ˆå‚è§3.2.1èŠ‚ï¼Œç¬¬76é¡µï¼‰æ¥åˆå§‹åŒ–ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆ</p><p><img src="/../images/C-C-Primer-Chapter-12/1726464938912.png"></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç”¨æ¥åˆå§‹åŒ–æ™ºèƒ½æŒ‡é’ˆçš„æ™®é€šæŒ‡é’ˆå¿…é¡»æŒ‡å‘åŠ¨æ€å†…å­˜ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆé»˜è®¤ä½¿ç”¨deleteé‡Šæ”¾å®ƒæ‰€å…³è”çš„å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†æ™ºèƒ½æŒ‡é’ˆç»‘å®šåˆ°ä¸€ä¸ªæŒ‡å‘å…¶ä»–ç±»å‹çš„èµ„æºçš„æŒ‡é’ˆä¸Šï¼Œä½†æ˜¯ä¸ºäº†è¿™æ ·åšï¼Œå¿…é¡»æä¾›è‡ªå·±çš„æ“ä½œæ¥æ›¿ä»£deleteã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726465035838.png"></p><p><img src="/../images/C-C-Primer-Chapter-12/1726465039905.png"></p><p><strong>ä¸è¦æ··åˆä½¿ç”¨æ™®é€šæŒ‡é’ˆå’Œæ™ºèƒ½æŒ‡é’ˆ</strong></p><p>shared_ptrå¯ä»¥åè°ƒå¯¹è±¡çš„ææ„ï¼Œä½†è¿™ä»…é™äºå…¶è‡ªèº«çš„æ‹·è´ï¼ˆä¹Ÿæ˜¯shared_ptrï¼‰ä¹‹é—´ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¨èä½¿ç”¨make_sharedè€Œä¸æ˜¯newçš„åŸå› ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨åˆ†é…å¯¹è±¡çš„åŒæ—¶å°±å°†shared_pträ¸ä¹‹ç»‘å®šï¼Œä»è€Œé¿å…äº†æ— æ„ä¸­å°†åŒä¸€å—å†…å­˜ç»‘å®šåˆ°å¤šä¸ªç‹¬ç«‹åˆ›å»ºçš„shared_pträ¸Šã€‚</p><p><strong>ä¹Ÿä¸è¦ä½¿ç”¨getåˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼</strong></p><p>æ™ºèƒ½æŒ‡é’ˆç±»å‹å®šä¹‰äº†ä¸€ä¸ªåä¸ºgetçš„å‡½æ•°ï¼ˆå‚è§è¡¨12.1ï¼‰ï¼Œå®ƒè¿”å›ä¸€ä¸ªå†…ç½®æŒ‡é’ˆï¼ŒæŒ‡å‘æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„å¯¹è±¡ã€‚æ­¤å‡½æ•°æ˜¯ä¸ºäº†è¿™æ ·ä¸€ç§æƒ…å†µè€Œè®¾è®¡çš„ï¼šæˆ‘ä»¬éœ€è¦å‘ä¸èƒ½ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„ä»£ç ä¼ é€’ä¸€ä¸ªå†…ç½®æŒ‡é’ˆã€‚ä½¿ç”¨getè¿”å›çš„æŒ‡é’ˆçš„ä»£ç ä¸èƒ½deleteæ­¤æŒ‡é’ˆã€‚</p><p>å°†å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆä¹Ÿç»‘å®šåˆ°getè¿”å›çš„æŒ‡é’ˆä¸Šæ˜¯é”™è¯¯çš„ã€‚</p><blockquote><p><strong>getç”¨æ¥å°†æŒ‡é’ˆçš„è®¿é—®æƒé™ä¼ é€’ç»™ä»£ç ï¼Œä½ åªæœ‰åœ¨ç¡®å®šä»£ç ä¸ä¼šdeleteæŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½ä½¿ç”¨getã€‚ç‰¹åˆ«æ˜¯ï¼Œæ°¸è¿œä¸è¦ç”¨getåˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–è€…ä¸ºå¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼ã€‚</strong></p></blockquote><h3 id="12-1-4-æ™ºèƒ½æŒ‡é’ˆå’Œå¼‚å¸¸"><a href="#12-1-4-æ™ºèƒ½æŒ‡é’ˆå’Œå¼‚å¸¸" class="headerlink" title="12.1.4 æ™ºèƒ½æŒ‡é’ˆå’Œå¼‚å¸¸"></a>12.1.4 æ™ºèƒ½æŒ‡é’ˆå’Œå¼‚å¸¸</h3><p>ä¸€ä¸ªç®€å•çš„ç¡®ä¿èµ„æºè¢«é‡Šæ”¾çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆã€‚å¦‚æœä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œå³ä½¿ç¨‹åºå—è¿‡æ—©ç»“æŸï¼Œæ™ºèƒ½æŒ‡é’ˆç±»ä¹Ÿèƒ½ç¡®ä¿åœ¨å†…å­˜ä¸å†éœ€è¦æ—¶å°†å…¶é‡Šæ”¾</p><p><strong>æ™ºèƒ½æŒ‡é’ˆå’Œå“‘ç±»</strong></p><p>åŒ…æ‹¬æ‰€æœ‰æ ‡å‡†åº“ç±»åœ¨å†…çš„å¾ˆå¤šC++ç±»éƒ½å®šä¹‰äº†ææ„å‡½æ•°ï¼ˆå‚è§12.1.1èŠ‚ï¼Œç¬¬402é¡µï¼‰ï¼Œè´Ÿè´£æ¸…ç†å¯¹è±¡ä½¿ç”¨çš„èµ„æºã€‚ä½†æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½æ˜¯è¿™æ ·è‰¯å¥½å®šä¹‰çš„ã€‚ç‰¹åˆ«æ˜¯é‚£äº›ä¸ºCå’ŒC++ä¸¤ç§è¯­è¨€è®¾è®¡çš„ç±»ï¼Œé€šå¸¸éƒ½è¦æ±‚ç”¨æˆ·æ˜¾å¼åœ°é‡Šæ”¾æ‰€ä½¿ç”¨çš„ä»»ä½•èµ„æºã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726466771589.png"></p><p>å¦‚æœconnectionæœ‰ä¸€ä¸ªææ„å‡½æ•°ï¼Œå°±å¯ä»¥åœ¨fç»“æŸæ—¶ç”±ææ„å‡½æ•°è‡ªåŠ¨å…³é—­è¿æ¥ã€‚ä½†æ˜¯ï¼Œconnectionæ²¡æœ‰ææ„å‡½æ•°ã€‚è¿™ä¸ªé—®é¢˜ä¸æˆ‘ä»¬ä¸Šä¸€ä¸ªç¨‹åºä¸­ä½¿ç”¨shared_ptré¿å…å†…å­˜æ³„æ¼å‡ ä¹æ˜¯ç­‰ä»·çš„ã€‚ä½¿ç”¨shared_ptræ¥ä¿è¯connectionè¢«æ­£ç¡®å…³é—­ï¼Œå·²è¢«è¯æ˜æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p><p><strong>ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„é‡Šæ”¾æ“ä½œ</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œshared_ptrå‡å®šå®ƒä»¬æŒ‡å‘çš„æ˜¯åŠ¨æ€å†…å­˜ã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªshared_ptrè¢«é”€æ¯æ—¶ï¼Œå®ƒé»˜è®¤åœ°å¯¹å®ƒç®¡ç†çš„æŒ‡é’ˆè¿›è¡Œdeleteæ“ä½œã€‚ä¸ºäº†ç”¨shared_ptræ¥ç®¡ç†ä¸€ä¸ªconnectionï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ä»£æ›¿deleteã€‚è¿™ä¸ªåˆ é™¤å™¨ï¼ˆdeleterï¼‰å‡½æ•°å¿…é¡»èƒ½å¤Ÿå®Œæˆå¯¹shared_pträ¸­ä¿å­˜çš„æŒ‡é’ˆè¿›è¡Œé‡Šæ”¾çš„æ“ä½œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„åˆ é™¤å™¨å¿…é¡»æ¥å—å•ä¸ªç±»å‹ä¸ºconnectionï¼Šçš„å‚æ•°</p><p><img src="/../images/C-C-Primer-Chapter-12/1726466818477.png"></p><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªshared_ptræ—¶ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªï¼ˆå¯é€‰çš„ï¼‰æŒ‡å‘åˆ é™¤å™¨å‡½æ•°çš„å‚æ•°ï¼ˆå‚è§6.7èŠ‚ï¼Œç¬¬221é¡µï¼‰</p><p><img src="/../images/C-C-Primer-Chapter-12/1726466848414.png"></p><p><strong>æ³¨æ„ï¼šæ™ºèƒ½æŒ‡é’ˆé™·é˜±</strong></p><p>æ™ºèƒ½æŒ‡é’ˆå¯ä»¥æä¾›å¯¹åŠ¨æ€åˆ†é…çš„å†…å­˜å®‰å…¨è€Œåˆæ–¹ä¾¿çš„ç®¡ç†ï¼Œä½†è¿™å»ºç«‹åœ¨æ­£ç¡®ä½¿ç”¨çš„å‰æä¸‹ã€‚ä¸ºäº†æ­£ç¡®ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œæˆ‘ä»¬å¿…é¡»åšæŒä¸€äº›åŸºæœ¬è§„èŒƒï¼š</p><ul><li>ä¸ä½¿ç”¨ç›¸åŒçš„å†…ç½®æŒ‡é’ˆå€¼åˆå§‹åŒ–ï¼ˆæˆ–resetï¼‰å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆã€‚</li><li>ä¸delete getï¼ˆï¼‰è¿”å›çš„æŒ‡é’ˆã€‚</li><li>ä¸ä½¿ç”¨getï¼ˆï¼‰åˆå§‹åŒ–æˆ–resetå¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆã€‚</li><li>å¦‚æœä½ ä½¿ç”¨getï¼ˆï¼‰è¿”å›çš„æŒ‡é’ˆï¼Œè®°ä½å½“æœ€åä¸€ä¸ªå¯¹åº”çš„æ™ºèƒ½æŒ‡é’ˆé”€æ¯åï¼Œä½ çš„æŒ‡é’ˆå°±å˜ä¸ºæ— æ•ˆäº†ã€‚</li><li>å¦‚æœä½ ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„èµ„æºä¸æ˜¯newåˆ†é…çš„å†…å­˜ï¼Œè®°ä½ä¼ é€’ç»™å®ƒä¸€ä¸ªåˆ é™¤å™¨ï¼ˆå‚è§12.1.4èŠ‚ï¼Œç¬¬415é¡µå’Œ12.1.5èŠ‚ï¼Œç¬¬419é¡µï¼‰ã€‚</li></ul><h3 id="12-1-5-unique-ptr"><a href="#12-1-5-unique-ptr" class="headerlink" title="12.1.5 unique_ptr"></a>12.1.5 unique_ptr</h3><p>ä¸€ä¸ªunique_ptrâ€œæ‹¥æœ‰â€å®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚ä¸shared_pträ¸åŒï¼ŒæŸä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªunique_ptræŒ‡å‘ä¸€ä¸ªç»™å®šå¯¹è±¡ã€‚å½“unique_ptrè¢«é”€æ¯æ—¶ï¼Œå®ƒæ‰€æŒ‡å‘çš„å¯¹è±¡ä¹Ÿè¢«é”€æ¯ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726467400523.png"></p><p>ç”±äºä¸€ä¸ªunique_ptræ‹¥æœ‰å®ƒæŒ‡å‘çš„å¯¹è±¡ï¼Œå› æ­¤unique_pträ¸æ”¯æŒæ™®é€šçš„æ‹·è´æˆ–èµ‹å€¼æ“ä½œ</p><p>è™½ç„¶æˆ‘ä»¬ä¸èƒ½æ‹·è´æˆ–èµ‹å€¼unique_ptrï¼Œä½†å¯ä»¥é€šè¿‡è°ƒç”¨releaseæˆ–resetå°†æŒ‡é’ˆçš„æ‰€æœ‰æƒä»ä¸€ä¸ªï¼ˆéconstï¼‰unique_ptrè½¬ç§»ç»™å¦ä¸€ä¸ªunique</p><p><img src="/../images/C-C-Primer-Chapter-12/1726467583660.png"></p><p><strong>ä¼ é€’unique_ptrå‚æ•°å’Œè¿”å›unique_ptr</strong></p><p>ä¸èƒ½æ‹·è´unique_ptrçš„è§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–ï¼šæˆ‘ä»¬å¯ä»¥æ‹·è´æˆ–èµ‹å€¼ä¸€ä¸ªå°†è¦è¢«é”€æ¯çš„unique_ptrã€‚æœ€å¸¸è§çš„ä¾‹å­æ˜¯ä»å‡½æ•°è¿”å›ä¸€ä¸ªunique_ptr</p><p><img src="/../images/C-C-Primer-Chapter-12/1726467663330.png"></p><p>è¿˜å¯ä»¥è¿”å›ä¸€ä¸ªå±€éƒ¨å¯¹è±¡çš„æ‹·è´</p><p><img src="/../images/C-C-Primer-Chapter-12/1726467672422.png"></p><p>å¯¹äºä¸¤æ®µä»£ç ï¼Œç¼–è¯‘å™¨éƒ½çŸ¥é“è¦è¿”å›çš„å¯¹è±¡å°†è¦è¢«é”€æ¯ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨æ‰§è¡Œä¸€ç§ç‰¹æ®Šçš„â€œæ‹·è´â€ï¼Œæˆ‘ä»¬å°†åœ¨13.6.2èŠ‚ï¼ˆç¬¬473é¡µï¼‰ä¸­ä»‹ç»å®ƒã€‚</p><p><strong>å‘unique_pträ¼ é€’åˆ é™¤å™¨</strong></p><p>unique_ptrç®¡ç†åˆ é™¤å™¨çš„æ–¹å¼ä¸shared_pträ¸åŒï¼Œå…¶åŸå› æˆ‘ä»¬å°†åœ¨16.1.6èŠ‚ï¼ˆç¬¬599é¡µï¼‰ä¸­ä»‹ç»ã€‚</p><p>é‡è½½ä¸€ä¸ªunique_pträ¸­çš„åˆ é™¤å™¨ä¼šå½±å“åˆ°unique_ptrç±»å‹ä»¥åŠå¦‚ä½•æ„é€ ï¼ˆæˆ–resetï¼‰è¯¥ç±»å‹çš„å¯¹è±¡ã€‚ä¸é‡è½½å…³è”å®¹å™¨çš„æ¯”è¾ƒæ“ä½œï¼ˆå‚è§11.2.2èŠ‚ï¼Œç¬¬378é¡µï¼‰ç±»ä¼¼ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å°–æ‹¬å·ä¸­unique_ptræŒ‡å‘ç±»å‹ä¹‹åæä¾›åˆ é™¤å™¨ç±»å‹ã€‚åœ¨åˆ›å»ºæˆ–resetä¸€ä¸ªè¿™ç§unique_ptrç±»å‹çš„å¯¹è±¡æ—¶ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæŒ‡å®šç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆåˆ é™¤å™¨ï¼‰</p><p><img src="/../images/C-C-Primer-Chapter-12/1726467975308.png"></p><h3 id="12-1-6-weak-ptr"><a href="#12-1-6-weak-ptr" class="headerlink" title="12.1.6 weak_ptr"></a>12.1.6 weak_ptr</h3><p>weak_ptrï¼ˆè§è¡¨12.5ï¼‰æ˜¯ä¸€ç§ä¸æ§åˆ¶æ‰€æŒ‡å‘å¯¹è±¡ç”Ÿå­˜æœŸçš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ç”±ä¸€ä¸ªshared_ptrç®¡ç†çš„å¯¹è±¡ã€‚å°†ä¸€ä¸ªweak_ptrç»‘å®šåˆ°ä¸€ä¸ªshared_pträ¸ä¼šæ”¹å˜shared_ptrçš„å¼•ç”¨è®¡æ•°ã€‚ä¸€æ—¦æœ€åä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„shared_ptrè¢«é”€æ¯ï¼Œå¯¹è±¡å°±ä¼šè¢«é‡Šæ”¾ã€‚å³ä½¿æœ‰weak_ptræŒ‡å‘å¯¹è±¡ï¼Œå¯¹è±¡ä¹Ÿè¿˜æ˜¯ä¼šè¢«é‡Šæ”¾ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726468083703.png"></p><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªweak_ptræ—¶ï¼Œè¦ç”¨ä¸€ä¸ªshared_ptræ¥åˆå§‹åŒ–å®ƒã€‚</p><p>ç”±äºå¯¹è±¡å¯èƒ½ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨weak_ptrç›´æ¥è®¿é—®å¯¹è±¡ï¼Œè€Œå¿…é¡»è°ƒç”¨lockã€‚æ­¤å‡½æ•°æ£€æŸ¥weak_ptræŒ‡å‘çš„å¯¹è±¡æ˜¯å¦ä»å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œlockè¿”å›ä¸€ä¸ªæŒ‡å‘å…±äº«å¯¹è±¡çš„shared_ptrã€‚ä¸ä»»ä½•å…¶ä»–shared_ptrç±»ä¼¼ï¼Œåªè¦æ­¤shared_ptrå­˜åœ¨ï¼Œå®ƒæ‰€æŒ‡å‘çš„åº•å±‚å¯¹è±¡ä¹Ÿå°±ä¼šä¸€ç›´å­˜åœ¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726468125244.png"></p><h2 id="12-2-åŠ¨æ€æ•°ç»„"><a href="#12-2-åŠ¨æ€æ•°ç»„" class="headerlink" title="12.2 åŠ¨æ€æ•°ç»„"></a>12.2 åŠ¨æ€æ•°ç»„</h2><p>C++è¯­è¨€å’Œæ ‡å‡†åº“æä¾›äº†ä¸¤ç§ä¸€æ¬¡åˆ†é…ä¸€ä¸ªå¯¹è±¡æ•°ç»„çš„æ–¹æ³•ã€‚C++è¯­è¨€å®šä¹‰äº†å¦ä¸€ç§newè¡¨è¾¾å¼è¯­æ³•ï¼Œå¯ä»¥åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚æ ‡å‡†åº“ä¸­åŒ…å«ä¸€ä¸ªåä¸ºallocatorçš„ç±»ï¼Œå…è®¸æˆ‘ä»¬å°†åˆ†é…å’Œåˆå§‹åŒ–åˆ†ç¦»ã€‚ä½¿ç”¨allocatoré€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´çµæ´»çš„å†…å­˜ç®¡ç†èƒ½åŠ›ï¼ŒåŸå› æˆ‘ä»¬å°†åœ¨12.2.2èŠ‚ï¼ˆç¬¬427é¡µï¼‰ä¸­è§£é‡Šã€‚</p><p>ä½¿ç”¨å®¹å™¨çš„ç±»å¯ä»¥ä½¿ç”¨é»˜è®¤ç‰ˆæœ¬çš„æ‹·è´ã€èµ‹å€¼å’Œææ„æ“ä½œï¼ˆå‚è§7.1.5èŠ‚ï¼Œç¬¬239é¡µï¼‰ã€‚åˆ†é…åŠ¨æ€æ•°ç»„çš„ç±»åˆ™å¿…é¡»å®šä¹‰è‡ªå·±ç‰ˆæœ¬çš„æ“ä½œï¼Œåœ¨æ‹·è´ã€å¤åˆ¶ä»¥åŠé”€æ¯å¯¹è±¡æ—¶ç®¡ç†æ‰€å…³è”çš„å†…å­˜ã€‚</p><h3 id="12-2-1-newå’Œæ•°ç»„"><a href="#12-2-1-newå’Œæ•°ç»„" class="headerlink" title="12.2.1 newå’Œæ•°ç»„"></a>12.2.1 newå’Œæ•°ç»„</h3><p>ä¸ºäº†è®©newåˆ†é…ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæˆ‘ä»¬è¦åœ¨ç±»å‹åä¹‹åè·Ÿä¸€å¯¹æ–¹æ‹¬å·ï¼Œåœ¨å…¶ä¸­æŒ‡æ˜è¦åˆ†é…çš„å¯¹è±¡çš„æ•°ç›®ã€‚åœ¨ä¸‹ä¾‹ä¸­ï¼Œnewåˆ†é…è¦æ±‚æ•°é‡çš„å¯¹è±¡å¹¶ï¼ˆå‡å®šåˆ†é…æˆåŠŸåï¼‰è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆ</p><p><strong>åˆ†é…ä¸€ä¸ªæ•°ç»„ä¼šå¾—åˆ°ä¸€ä¸ªå…ƒç´ ç±»å‹çš„æŒ‡é’ˆ</strong></p><p>ç”±äºåˆ†é…çš„å†…å­˜å¹¶ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼Œå› æ­¤ä¸èƒ½å¯¹åŠ¨æ€æ•°ç»„è°ƒç”¨beginæˆ–endï¼ˆå‚è§3.5.3èŠ‚ï¼Œç¬¬106é¡µï¼‰ã€‚è¿™äº›å‡½æ•°ä½¿ç”¨æ•°ç»„ç»´åº¦ï¼ˆå›å¿†ä¸€ä¸‹ï¼Œç»´åº¦æ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼‰æ¥è¿”å›æŒ‡å‘é¦–å…ƒç´ å’Œå°¾åå…ƒç´ çš„æŒ‡é’ˆã€‚å‡ºäºç›¸åŒçš„åŸå› ï¼Œä¹Ÿä¸èƒ½ç”¨èŒƒå›´forè¯­å¥æ¥å¤„ç†ï¼ˆæ‰€è°“çš„ï¼‰åŠ¨æ€æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</p><blockquote><p>è¦è®°ä½æˆ‘ä»¬æ‰€è¯´çš„åŠ¨æ€æ•°ç»„å¹¶ä¸æ˜¯æ•°ç»„ç±»å‹ï¼Œè¿™æ˜¯å¾ˆé‡è¦çš„ã€‚</p></blockquote><p><strong>åˆå§‹åŒ–åŠ¨æ€åˆ†é…å¯¹è±¡çš„æ•°ç»„</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œnewåˆ†é…çš„å¯¹è±¡ï¼Œä¸ç®¡æ˜¯å•ä¸ªåˆ†é…çš„è¿˜æ˜¯æ•°ç»„ä¸­çš„ï¼Œéƒ½æ˜¯é»˜è®¤åˆå§‹åŒ–çš„ã€‚å¯ä»¥å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ï¼Œæ–¹æ³•æ˜¯åœ¨å¤§å°ä¹‹åè·Ÿä¸€å¯¹ç©ºæ‹¬å·ã€‚</p><p>åœ¨æ–°æ ‡å‡†ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æä¾›ä¸€ä¸ªå…ƒç´ åˆå§‹åŒ–å™¨çš„èŠ±æ‹¬å·åˆ—è¡¨ã€‚å¦‚æœåˆå§‹åŒ–å™¨æ•°ç›®å°äºå…ƒç´ æ•°ç›®ï¼Œå‰©ä½™å…ƒç´ å°†è¿›è¡Œå€¼åˆå§‹åŒ–ã€‚å¦‚æœåˆå§‹åŒ–å™¨æ•°ç›®å¤§äºå…ƒç´ æ•°ç›®ï¼Œåˆ™newè¡¨è¾¾å¼å¤±è´¥ï¼Œä¸ä¼šåˆ†é…ä»»ä½•å†…å­˜ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œnewä¼šæŠ›å‡ºä¸€ä¸ªç±»å‹ä¸ºbad_array_new_lengthçš„å¼‚å¸¸ã€‚ç±»ä¼¼bad_allocï¼Œæ­¤ç±»å‹å®šä¹‰åœ¨å¤´æ–‡ä»¶newä¸­ã€‚</p><p><strong>åŠ¨æ€åˆ†é…ä¸€ä¸ªç©ºæ•°ç»„æ˜¯åˆæ³•çš„</strong></p><p>å½“nç­‰äº0æ—¶ï¼Œè°ƒç”¨new[n]æ˜¯åˆæ³•çš„ã€‚</p><p>newè¿”å›ä¸€ä¸ªåˆæ³•çš„éç©ºæŒ‡é’ˆã€‚æ­¤æŒ‡é’ˆä¿è¯ä¸newè¿”å›çš„å…¶ä»–ä»»ä½•æŒ‡é’ˆéƒ½ä¸ç›¸åŒã€‚å¯¹äºé›¶é•¿åº¦çš„æ•°ç»„æ¥è¯´ï¼Œæ­¤æŒ‡é’ˆå°±åƒå°¾åæŒ‡é’ˆä¸€æ ·ï¼ˆå‚è§3.5.3èŠ‚ï¼Œç¬¬106é¡µï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨å°¾åè¿­ä»£å™¨ä¸€æ ·ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆã€‚å¯ä»¥ç”¨æ­¤æŒ‡é’ˆè¿›è¡Œæ¯”è¾ƒæ“ä½œï¼Œå°±åƒä¸Šé¢å¾ªç¯ä»£ç ä¸­é‚£æ ·ã€‚å¯ä»¥å‘æ­¤æŒ‡é’ˆåŠ ä¸Šï¼ˆæˆ–ä»æ­¤æŒ‡é’ˆå‡å»ï¼‰0ï¼Œä¹Ÿå¯ä»¥ä»æ­¤æŒ‡é’ˆå‡å»è‡ªèº«ä»è€Œå¾—åˆ°0ã€‚ä½†æ­¤æŒ‡é’ˆä¸èƒ½è§£å¼•ç”¨â€”â€”æ¯•ç«Ÿå®ƒä¸æŒ‡å‘ä»»ä½•å…ƒç´ ã€‚</p><p><strong>é‡Šæ”¾åŠ¨æ€æ•°ç»„</strong></p><p>ä¸ºäº†é‡Šæ”¾åŠ¨æ€æ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§ç‰¹æ®Šå½¢å¼çš„deleteâ€”â€”åœ¨æŒ‡é’ˆå‰åŠ ä¸Šä¸€ä¸ªç©ºæ–¹æ‹¬å·å¯¹</p><p><img src="/../images/C-C-Primer-Chapter-12/1726469237720.png"></p><p>æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰é€†åºé”€æ¯ï¼Œå³ï¼Œæœ€åä¸€ä¸ªå…ƒç´ é¦–å…ˆè¢«é”€æ¯ï¼Œç„¶åæ˜¯å€’æ•°ç¬¬äºŒä¸ªï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨deleteä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆæ—¶å¿½ç•¥äº†æ–¹æ‹¬å·ï¼ˆæˆ–è€…åœ¨deleteä¸€ä¸ªæŒ‡å‘å•ä¸€å¯¹è±¡çš„æŒ‡é’ˆæ—¶ä½¿ç”¨äº†æ–¹æ‹¬å·ï¼‰ï¼Œå…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p><p><strong>æ™ºèƒ½æŒ‡é’ˆå’ŒåŠ¨æ€æ•°ç»„</strong></p><p>æ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªå¯ä»¥ç®¡ç†newåˆ†é…çš„æ•°ç»„çš„unique_ptrç‰ˆæœ¬ã€‚ä¸ºäº†ç”¨ä¸€ä¸ªunique_ptrç®¡ç†åŠ¨æ€æ•°ç»„ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å¯¹è±¡ç±»å‹åé¢è·Ÿä¸€å¯¹ç©ºæ–¹æ‹¬å·</p><p><img src="/../images/C-C-Primer-Chapter-12/1726469303812.png"></p><p>æŒ‡å‘æ•°ç»„çš„unique_ptræä¾›çš„æ“ä½œä¸æˆ‘ä»¬åœ¨12.1.5èŠ‚ï¼ˆç¬¬417é¡µï¼‰ä¸­ä½¿ç”¨çš„é‚£äº›æ“ä½œæœ‰ä¸€äº›ä¸åŒ</p><p><img src="/../images/C-C-Primer-Chapter-12/1726469328221.png"></p><p>ä¸unique_pträ¸åŒï¼Œshared_pträ¸ç›´æ¥æ”¯æŒç®¡ç†åŠ¨æ€æ•°ç»„ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨shared_ptrç®¡ç†ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå¿…é¡»æä¾›è‡ªå·±å®šä¹‰çš„åˆ é™¤å™¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726469386578.png"></p><p>shared_ptræœªå®šä¹‰ä¸‹æ ‡è¿ç®—ç¬¦ï¼Œè€Œä¸”æ™ºèƒ½æŒ‡é’ˆç±»å‹ä¸æ”¯æŒæŒ‡é’ˆç®—æœ¯è¿ç®—ã€‚å› æ­¤ï¼Œä¸ºäº†è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¿…é¡»ç”¨getè·å–ä¸€ä¸ªå†…ç½®æŒ‡é’ˆï¼Œç„¶åç”¨å®ƒæ¥è®¿é—®æ•°ç»„å…ƒç´ ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726469425165.png"></p><h3 id="12-2-2-allocatorç±»"><a href="#12-2-2-allocatorç±»" class="headerlink" title="12.2.2 allocatorç±»"></a>12.2.2 allocatorç±»</h3><p>newæœ‰ä¸€äº›çµæ´»æ€§ä¸Šçš„å±€é™ï¼Œå…¶ä¸­ä¸€æ–¹é¢è¡¨ç°åœ¨å®ƒå°†å†…å­˜åˆ†é…å’Œå¯¹è±¡æ„é€ ç»„åˆåœ¨äº†ä¸€èµ·ã€‚ç±»ä¼¼çš„ï¼Œdeleteå°†å¯¹è±¡ææ„å’Œå†…å­˜é‡Šæ”¾ç»„åˆåœ¨äº†ä¸€èµ·ã€‚</p><p>å½“åˆ†é…ä¸€å¤§å—å†…å­˜æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸è®¡åˆ’åœ¨è¿™å—å†…å­˜ä¸ŠæŒ‰éœ€æ„é€ å¯¹è±¡ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å†…å­˜åˆ†é…å’Œå¯¹è±¡æ„é€ åˆ†ç¦»ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ†é…å¤§å—å†…å­˜ï¼Œä½†åªåœ¨çœŸæ­£éœ€è¦æ—¶æ‰çœŸæ­£æ‰§è¡Œå¯¹è±¡åˆ›å»ºæ“ä½œï¼ˆåŒæ—¶ä»˜å‡ºä¸€å®šå¼€é”€ï¼‰ã€‚</p><p><strong>allocatorç±»</strong></p><p>æ ‡å‡†åº“allocatorç±»å®šä¹‰åœ¨å¤´æ–‡ä»¶memoryä¸­ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬å°†å†…å­˜åˆ†é…å’Œå¯¹è±¡æ„é€ åˆ†ç¦»å¼€æ¥ã€‚å®ƒæä¾›ä¸€ç§ç±»å‹æ„ŸçŸ¥çš„å†…å­˜åˆ†é…æ–¹æ³•ï¼Œå®ƒåˆ†é…çš„å†…å­˜æ˜¯åŸå§‹çš„ã€æœªæ„é€ çš„ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726475054676.png"></p><p>ç±»ä¼¼vectorï¼Œallocatoræ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼ˆå‚è§3.3èŠ‚ï¼Œç¬¬86é¡µï¼‰ã€‚ä¸ºäº†å®šä¹‰ä¸€ä¸ªallocatorå¯¹è±¡ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡æ˜è¿™ä¸ªallocatorå¯ä»¥åˆ†é…çš„å¯¹è±¡ç±»å‹ã€‚å½“ä¸€ä¸ªallocatorå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œå®ƒä¼šæ ¹æ®ç»™å®šçš„å¯¹è±¡ç±»å‹æ¥ç¡®å®šæ°å½“çš„å†…å­˜å¤§å°å’Œå¯¹é½ä½ç½®</p><p><img src="/../images/C-C-Primer-Chapter-12/1726475061308.png"></p><p><strong>allocatoråˆ†é…æœªæ„é€ çš„å†…å­˜</strong></p><p>åœ¨æ–°æ ‡å‡†åº“ä¸­ï¼Œconstructæˆå‘˜å‡½æ•°æ¥å—ä¸€ä¸ªæŒ‡é’ˆå’Œé›¶ä¸ªæˆ–å¤šä¸ªé¢å¤–å‚æ•°ï¼Œåœ¨ç»™å®šä½ç½®æ„é€ ä¸€ä¸ªå…ƒç´ ã€‚é¢å¤–å‚æ•°ç”¨æ¥åˆå§‹åŒ–æ„é€ çš„å¯¹è±¡ã€‚</p><blockquote><p>ä¸ºäº†ä½¿ç”¨allocateè¿”å›çš„å†…å­˜ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨constructæ„é€ å¯¹è±¡ã€‚ä½¿ç”¨æœªæ„é€ çš„å†…å­˜ï¼Œå…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p></blockquote><p>å½“æˆ‘ä»¬ç”¨å®Œå¯¹è±¡åï¼Œå¿…é¡»å¯¹æ¯ä¸ªæ„é€ çš„å…ƒç´ è°ƒç”¨destroyæ¥é”€æ¯å®ƒä»¬ã€‚å‡½æ•°destroyæ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯¹æŒ‡å‘çš„å¯¹è±¡æ‰§è¡Œææ„å‡½æ•°ï¼ˆå‚è§12.1.1èŠ‚ï¼Œç¬¬402é¡µï¼‰</p><p>æˆ‘ä»¬ä¼ é€’ç»™deallocateçš„æŒ‡é’ˆä¸èƒ½ä¸ºç©ºï¼Œå®ƒå¿…é¡»æŒ‡å‘ç”±allocateåˆ†é…çš„å†…å­˜ã€‚è€Œä¸”ï¼Œä¼ é€’ç»™deallocateçš„å¤§å°å‚æ•°å¿…é¡»ä¸è°ƒç”¨allocatedåˆ†é…å†…å­˜æ—¶æä¾›çš„å¤§å°å‚æ•°å…·æœ‰ä¸€æ ·çš„å€¼ã€‚</p><p><strong>æ‹·è´å’Œå¡«å……æœªåˆå§‹åŒ–å†…å­˜çš„ç®—æ³•</strong></p><p>æ ‡å‡†åº“è¿˜ä¸ºallocatorç±»å®šä¹‰äº†ä¸¤ä¸ªä¼´éšç®—æ³•ï¼Œå¯ä»¥åœ¨æœªåˆå§‹åŒ–å†…å­˜ä¸­åˆ›å»ºå¯¹è±¡ã€‚è¡¨12.8æè¿°äº†è¿™äº›å‡½æ•°ï¼Œå®ƒä»¬éƒ½å®šä¹‰åœ¨å¤´æ–‡ä»¶memoryä¸­ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-12/1726475234959.png"></p><p>ç±»ä¼¼copyï¼Œuninitialized_copyè¿”å›ï¼ˆé€’å¢åçš„ï¼‰ç›®çš„ä½ç½®è¿­ä»£å™¨ã€‚</p><p>å› æ­¤ï¼Œä¸€æ¬¡uninitialized_copyè°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªæ„é€ çš„å…ƒç´ ä¹‹åçš„ä½ç½®ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 11</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-11/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-11/</url>
    
    <content type="html"><![CDATA[<h1 id="å…³è”å®¹å™¨"><a href="#å…³è”å®¹å™¨" class="headerlink" title="å…³è”å®¹å™¨"></a>å…³è”å®¹å™¨</h1><span id="more"></span><p>å…³è”å®¹å™¨å’Œé¡ºåºå®¹å™¨æœ‰ç€æ ¹æœ¬çš„ä¸åŒï¼šå…³è”å®¹å™¨ä¸­çš„å…ƒç´ æ˜¯æŒ‰å…³é”®å­—æ¥ä¿å­˜å’Œè®¿é—®çš„ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œé¡ºåºå®¹å™¨ä¸­çš„å…ƒç´ æ˜¯æŒ‰å®ƒä»¬åœ¨å®¹å™¨ä¸­çš„ä½ç½®æ¥é¡ºåºä¿å­˜å’Œè®¿é—®çš„ã€‚</p><p>æ ‡å‡†åº“æä¾›8ä¸ªå…³è”å®¹å™¨ï¼Œå¦‚è¡¨11.1æ‰€ç¤ºã€‚è¿™8ä¸ªå®¹å™¨é—´çš„ä¸åŒä½“ç°åœ¨ä¸‰ä¸ªç»´åº¦ä¸Šï¼šæ¯ä¸ªå®¹å™¨ï¼ˆ1ï¼‰æˆ–è€…æ˜¯ä¸€ä¸ªsetï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªmapï¼›ï¼ˆ2ï¼‰æˆ–è€…è¦æ±‚ä¸é‡å¤çš„å…³é”®å­—ï¼Œæˆ–è€…å…è®¸é‡å¤å…³é”®å­—ï¼›ï¼ˆ3ï¼‰æŒ‰é¡ºåºä¿å­˜å…ƒç´ ï¼Œæˆ–æ— åºä¿å­˜ã€‚å…è®¸é‡å¤å…³é”®å­—çš„å®¹å™¨çš„åå­—ä¸­éƒ½åŒ…å«å•è¯multiï¼›ä¸ä¿æŒå…³é”®å­—æŒ‰é¡ºåºå­˜å‚¨çš„å®¹å™¨çš„åå­—éƒ½ä»¥å•è¯unorderedå¼€å¤´ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726389168983.png"></p><h2 id="11-1-ä½¿ç”¨å…³è”å®¹å™¨"><a href="#11-1-ä½¿ç”¨å…³è”å®¹å™¨" class="headerlink" title="11.1 ä½¿ç”¨å…³è”å®¹å™¨"></a>11.1 ä½¿ç”¨å…³è”å®¹å™¨</h2><p>mapæ˜¯å…³é”®å­—-å€¼å¯¹çš„é›†åˆã€‚</p><p>mapç±»å‹é€šå¸¸è¢«ç§°ä¸ºå…³è”æ•°ç»„ï¼ˆassociative arrayï¼‰ã€‚å…³è”æ•°ç»„ä¸â€œæ­£å¸¸â€æ•°ç»„ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…¶ä¸‹æ ‡ä¸å¿…æ˜¯æ•´æ•°ã€‚</p><p>setå°±æ˜¯å…³é”®å­—çš„ç®€å•é›†åˆã€‚å½“åªæ˜¯æƒ³çŸ¥é“ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨æ—¶ï¼Œsetæ˜¯æœ€æœ‰ç”¨çš„ã€‚</p><p><strong>ä½¿ç”¨map</strong></p><p>ä¸ºäº†å®šä¹‰ä¸€ä¸ªmapï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šå…³é”®å­—å’Œå€¼çš„ç±»å‹ã€‚</p><p>å½“ä»mapä¸­æå–ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªpairç±»å‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°†åœ¨11.2.3èŠ‚ï¼ˆç¬¬379é¡µï¼‰ä»‹ç»å®ƒã€‚ç®€å•æ¥è¯´ï¼Œpairæ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»å‹ï¼Œä¿å­˜ä¸¤ä¸ªåä¸ºfirstå’Œsecondçš„ï¼ˆå…¬æœ‰ï¼‰æ•°æ®æˆå‘˜ã€‚mapæ‰€ä½¿ç”¨çš„pairç”¨firstæˆå‘˜ä¿å­˜å…³é”®å­—ï¼Œç”¨secondæˆå‘˜ä¿å­˜å¯¹åº”çš„å€¼ã€‚</p><p><strong>ä½¿ç”¨set</strong></p><p>findè°ƒç”¨è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚å¦‚æœç»™å®šå…³é”®å­—åœ¨setä¸­ï¼Œè¿­ä»£å™¨æŒ‡å‘è¯¥å…³é”®å­—ã€‚å¦åˆ™ï¼Œfindè¿”å›å°¾åè¿­ä»£å™¨ã€‚</p><h2 id="11-2-å…³è”å®¹å™¨æ¦‚è¿°"><a href="#11-2-å…³è”å®¹å™¨æ¦‚è¿°" class="headerlink" title="11.2 å…³è”å®¹å™¨æ¦‚è¿°"></a>11.2 å…³è”å®¹å™¨æ¦‚è¿°</h2><p>å…³è”å®¹å™¨ä¸æ”¯æŒé¡ºåºå®¹å™¨çš„ä½ç½®ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚push_frontæˆ–push_backã€‚åŸå› æ˜¯å…³è”å®¹å™¨ä¸­å…ƒç´ æ˜¯æ ¹æ®å…³é”®å­—å­˜å‚¨çš„ï¼Œè¿™äº›æ“ä½œå¯¹å…³è”å®¹å™¨æ²¡æœ‰æ„ä¹‰ã€‚è€Œä¸”ï¼Œå…³è”å®¹å™¨ä¹Ÿä¸æ”¯æŒæ„é€ å‡½æ•°æˆ–æ’å…¥æ“ä½œè¿™äº›æ¥å—ä¸€ä¸ªå…ƒç´ å€¼å’Œä¸€ä¸ªæ•°é‡å€¼çš„æ“ä½œã€‚</p><p>å…³è”å®¹å™¨çš„è¿­ä»£å™¨éƒ½æ˜¯åŒå‘çš„ã€‚</p><h3 id="11-2-1-å®šä¹‰å…³è”å®¹å™¨"><a href="#11-2-1-å®šä¹‰å…³è”å®¹å™¨" class="headerlink" title="11.2.1 å®šä¹‰å…³è”å®¹å™¨"></a>11.2.1 å®šä¹‰å…³è”å®¹å™¨</h3><p><strong>åˆå§‹åŒ–multimapæˆ–multiset</strong></p><h3 id="11-2-2-å…³é”®å­—ç±»å‹çš„è¦æ±‚"><a href="#11-2-2-å…³é”®å­—ç±»å‹çš„è¦æ±‚" class="headerlink" title="11.2.2 å…³é”®å­—ç±»å‹çš„è¦æ±‚"></a>11.2.2 å…³é”®å­—ç±»å‹çš„è¦æ±‚</h3><p>å¯¹äºæœ‰åºå®¹å™¨â€”â€”mapã€multimapã€setä»¥åŠmultisetï¼Œå…³é”®å­—ç±»å‹å¿…é¡»å®šä¹‰å…ƒç´ æ¯”è¾ƒçš„æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡å‡†åº“ä½¿ç”¨å…³é”®å­—ç±»å‹çš„&lt;è¿ç®—ç¬¦æ¥æ¯”è¾ƒä¸¤ä¸ªå…³é”®å­—ã€‚åœ¨é›†åˆç±»å‹ä¸­ï¼Œå…³é”®å­—ç±»å‹å°±æ˜¯å…ƒç´ ç±»å‹ï¼›åœ¨æ˜ å°„ç±»å‹ä¸­ï¼Œå…³é”®å­—ç±»å‹æ˜¯å…ƒç´ çš„ç¬¬ä¸€éƒ¨åˆ†çš„ç±»å‹ã€‚</p><p><strong>æœ‰åºå®¹å™¨çš„å…³é”®å­—ç±»å‹</strong></p><p>å¯ä»¥æä¾›è‡ªå·±å®šä¹‰çš„æ“ä½œæ¥ä»£æ›¿å…³é”®å­—ä¸Šçš„&lt;è¿ç®—ç¬¦ã€‚æ‰€æä¾›çš„æ“ä½œå¿…é¡»åœ¨å…³é”®å­—ç±»å‹ä¸Šå®šä¹‰ä¸€ä¸ªä¸¥æ ¼å¼±åºï¼ˆstrict weak orderingï¼‰ã€‚å¯ä»¥å°†ä¸¥æ ¼å¼±åºçœ‹ä½œâ€œå°äºç­‰äºâ€ï¼Œè™½ç„¶å®é™…å®šä¹‰çš„æ“ä½œå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„å‡½æ•°ã€‚æ— è®ºæˆ‘ä»¬æ€æ ·å®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œå®ƒå¿…é¡»å…·å¤‡å¦‚ä¸‹åŸºæœ¬æ€§è´¨ï¼š</p><ul><li>ä¸¤ä¸ªå…³é”®å­—ä¸èƒ½åŒæ—¶â€œå°äºç­‰äºâ€å¯¹æ–¹ï¼›å¦‚æœk1â€œå°äºç­‰äºâ€k2ï¼Œé‚£ä¹ˆk2ç»ä¸èƒ½â€œå°äºç­‰äºâ€k1ã€‚</li><li>å¦‚æœk1â€œå°äºç­‰äºâ€k2ï¼Œä¸”k2â€œå°äºç­‰äºâ€k3ï¼Œé‚£ä¹ˆk1å¿…é¡»â€œå°äºç­‰äºâ€k3ã€‚</li><li>å¦‚æœå­˜åœ¨ä¸¤ä¸ªå…³é”®å­—ï¼Œä»»ä½•ä¸€ä¸ªéƒ½ä¸â€œå°äºç­‰äºâ€å¦ä¸€ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™ä¸¤ä¸ªå…³é”®å­—æ˜¯â€œç­‰ä»·â€çš„ã€‚å¦‚æœk1â€œç­‰ä»·äºâ€k2ï¼Œä¸”k2â€œç­‰ä»·äºâ€k3ï¼Œé‚£ä¹ˆk1å¿…é¡»â€œç­‰ä»·äºâ€k3ã€‚</li></ul><p>å¦‚æœä¸¤ä¸ªå…³é”®å­—æ˜¯ç­‰ä»·çš„ï¼ˆå³ï¼Œä»»ä½•ä¸€ä¸ªéƒ½ä¸â€œå°äºç­‰äºâ€å¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆå®¹å™¨å°†å®ƒä»¬è§†ä½œç›¸ç­‰æ¥å¤„ç†ã€‚å½“ç”¨ä½œmapçš„å…³é”®å­—æ—¶ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå…ƒç´ ä¸è¿™ä¸¤ä¸ªå…³é”®å­—å…³è”ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸¤è€…ä¸­ä»»æ„ä¸€ä¸ªæ¥è®¿é—®å¯¹åº”çš„å€¼ã€‚</p><blockquote><p>åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œé‡è¦çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»å‹å®šä¹‰äº†â€œè¡Œä¸ºæ­£å¸¸â€çš„&lt;è¿ç®—ç¬¦ï¼Œåˆ™å®ƒå¯ä»¥ç”¨ä½œå…³é”®å­—ç±»å‹ã€‚</p></blockquote><p><strong>ä½¿ç”¨å…³é”®å­—ç±»å‹çš„æ¯”è¾ƒå‡½æ•°</strong></p><p>ç”¨æ¥ç»„ç»‡ä¸€ä¸ªå®¹å™¨ä¸­å…ƒç´ çš„æ“ä½œçš„ç±»å‹ä¹Ÿæ˜¯è¯¥å®¹å™¨ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚ä¸ºäº†æŒ‡å®šä½¿ç”¨è‡ªå®šä¹‰çš„æ“ä½œï¼Œå¿…é¡»åœ¨å®šä¹‰å…³è”å®¹å™¨ç±»å‹æ—¶æä¾›æ­¤æ“ä½œçš„ç±»å‹ã€‚å¦‚å‰æ‰€è¿°ï¼Œç”¨å°–æ‹¬å·æŒ‡å‡ºè¦å®šä¹‰å“ªç§ç±»å‹çš„å®¹å™¨ï¼Œè‡ªå®šä¹‰çš„æ“ä½œç±»å‹å¿…é¡»åœ¨å°–æ‹¬å·ä¸­ç´§è·Ÿç€å…ƒç´ ç±»å‹ç»™å‡ºã€‚</p><p>åœ¨å°–æ‹¬å·ä¸­å‡ºç°çš„æ¯ä¸ªç±»å‹ï¼Œå°±ä»…ä»…æ˜¯ä¸€ä¸ªç±»å‹è€Œå·²ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼ˆå¯¹è±¡ï¼‰æ—¶ï¼Œæ‰ä¼šä»¥æ„é€ å‡½æ•°å‚æ•°çš„å½¢å¼æä¾›çœŸæ­£çš„æ¯”è¾ƒæ“ä½œï¼ˆå…¶ç±»å‹å¿…é¡»ä¸åœ¨å°–æ‹¬å·ä¸­æŒ‡å®šçš„ç±»å‹ç›¸å»åˆï¼‰ã€‚</p><p>ä¸ºäº†ä½¿ç”¨è‡ªå·±å®šä¹‰çš„æ“ä½œï¼Œåœ¨å®šä¹‰multisetæ—¶æˆ‘ä»¬å¿…é¡»æä¾›ä¸¤ä¸ªç±»å‹ï¼šå…³é”®å­—ç±»å‹Sales_dataï¼Œä»¥åŠæ¯”è¾ƒæ“ä½œç±»å‹â€”â€”åº”è¯¥æ˜¯ä¸€ç§å‡½æ•°æŒ‡é’ˆç±»å‹ï¼ˆå‚è§6.7èŠ‚ï¼Œç¬¬221é¡µï¼‰ï¼Œå¯ä»¥æŒ‡å‘compareIsbnã€‚å½“å®šä¹‰æ­¤å®¹å™¨ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œéœ€è¦æä¾›æƒ³è¦ä½¿ç”¨çš„æ“ä½œçš„æŒ‡é’ˆã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726390059889.png"></p><h3 id="11-2-3-pairç±»å‹"><a href="#11-2-3-pairç±»å‹" class="headerlink" title="11.2.3 pairç±»å‹"></a>11.2.3 pairç±»å‹</h3><p>å®šä¹‰åœ¨å¤´æ–‡ä»¶utilityä¸­ã€‚</p><p>ä¸€ä¸ªpairä¿å­˜ä¸¤ä¸ªæ•°æ®æˆå‘˜ã€‚ç±»ä¼¼å®¹å™¨ï¼Œpairæ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆç‰¹å®šç±»å‹çš„æ¨¡æ¿ã€‚å½“åˆ›å»ºä¸€ä¸ªpairæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ä¸¤ä¸ªç±»å‹åï¼Œpairçš„æ•°æ®æˆå‘˜å°†å…·æœ‰å¯¹åº”çš„ç±»å‹ã€‚ä¸¤ä¸ªç±»å‹ä¸è¦æ±‚ä¸€æ ·</p><p>pairçš„é»˜è®¤æ„é€ å‡½æ•°å¯¹æ•°æ®æˆå‘˜è¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ã€‚</p><p>ä¸å…¶ä»–æ ‡å‡†åº“ç±»å‹ä¸åŒï¼Œpairçš„æ•°æ®æˆå‘˜æ˜¯publicçš„ï¼ˆå‚è§7.2èŠ‚ï¼Œç¬¬240é¡µï¼‰ã€‚ä¸¤ä¸ªæˆå‘˜åˆ†åˆ«å‘½åä¸ºfirstå’Œsecondã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726390434783.png"></p><h2 id="11-3-å…³è”å®¹å™¨æ“ä½œ"><a href="#11-3-å…³è”å®¹å™¨æ“ä½œ" class="headerlink" title="11.3 å…³è”å®¹å™¨æ“ä½œ"></a>11.3 å…³è”å®¹å™¨æ“ä½œ</h2><p>é™¤äº†è¡¨9.2ï¼ˆç¬¬295é¡µï¼‰ä¸­åˆ—å‡ºçš„ç±»å‹ï¼Œå…³è”å®¹å™¨è¿˜å®šä¹‰äº†è¡¨11.3ä¸­åˆ—å‡ºçš„ç±»å‹ã€‚è¿™äº›ç±»å‹è¡¨ç¤ºå®¹å™¨å…³é”®å­—å’Œå€¼çš„ç±»å‹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726390657794.png"></p><h3 id="11-3-1-å…³è”å®¹å™¨è¿­ä»£å™¨"><a href="#11-3-1-å…³è”å®¹å™¨è¿­ä»£å™¨" class="headerlink" title="11.3.1 å…³è”å®¹å™¨è¿­ä»£å™¨"></a>11.3.1 å…³è”å®¹å™¨è¿­ä»£å™¨</h3><p>å½“è§£å¼•ç”¨ä¸€ä¸ªå…³è”å®¹å™¨è¿­ä»£å™¨æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹ä¸ºå®¹å™¨çš„value_typeçš„å€¼çš„å¼•ç”¨ã€‚å¯¹mapè€Œè¨€ï¼Œvalue_typeæ˜¯ä¸€ä¸ªpairç±»å‹ï¼Œå…¶firstæˆå‘˜ä¿å­˜constçš„å…³é”®å­—ï¼Œsecondæˆå‘˜ä¿å­˜å€¼</p><p><strong>setçš„è¿­ä»£å™¨æ˜¯constçš„</strong></p><p>è™½ç„¶setç±»å‹åŒæ—¶å®šä¹‰äº†iteratorå’Œconst_iteratorç±»å‹ï¼Œä½†ä¸¤ç§ç±»å‹éƒ½åªå…è®¸åªè¯»è®¿é—®setä¸­çš„å…ƒç´ ã€‚ä¸ä¸èƒ½æ”¹å˜ä¸€ä¸ªmapå…ƒç´ çš„å…³é”®å­—ä¸€æ ·ï¼Œä¸€ä¸ªsetä¸­çš„å…³é”®å­—ä¹Ÿæ˜¯constçš„ã€‚å¯ä»¥ç”¨ä¸€ä¸ªsetè¿­ä»£å™¨æ¥è¯»å–å…ƒç´ çš„å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹</p><p><strong>éå†å…³è”å®¹å™¨</strong></p><blockquote><p>å½“ä½¿ç”¨ä¸€ä¸ªè¿­ä»£å™¨éå†ä¸€ä¸ªmapã€multimapã€setæˆ–multisetæ—¶ï¼Œè¿­ä»£å™¨æŒ‰å…³é”®å­—å‡åºéå†å…ƒç´ ã€‚</p></blockquote><p><strong>å…³è”å®¹å™¨å’Œç®—æ³•</strong></p><p>æˆ‘ä»¬é€šå¸¸ä¸å¯¹å…³è”å®¹å™¨ä½¿ç”¨æ³›å‹ç®—æ³•ï¼ˆå‚è§ç¬¬10ç« ï¼‰ã€‚å…³é”®å­—æ˜¯constè¿™ä¸€ç‰¹æ€§æ„å‘³ç€ä¸èƒ½å°†å…³è”å®¹å™¨ä¼ é€’ç»™ä¿®æ”¹æˆ–é‡æ’å®¹å™¨å…ƒç´ çš„ç®—æ³•ï¼Œå› ä¸ºè¿™ç±»ç®—æ³•éœ€è¦å‘å…ƒç´ å†™å…¥å€¼ï¼Œè€Œsetç±»å‹ä¸­çš„å…ƒç´ æ˜¯constçš„ï¼Œmapä¸­çš„å…ƒç´ æ˜¯pairï¼Œå…¶ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯constçš„ã€‚</p><p>å…³è”å®¹å™¨å¯ç”¨äºåªè¯»å–å…ƒç´ çš„ç®—æ³•ã€‚ä½†æ˜¯ï¼Œå¾ˆå¤šè¿™ç±»ç®—æ³•éƒ½è¦æœç´¢åºåˆ—ã€‚ç”±äºå…³è”å®¹å™¨ä¸­çš„å…ƒç´ ä¸èƒ½é€šè¿‡å®ƒä»¬çš„å…³é”®å­—è¿›è¡Œï¼ˆå¿«é€Ÿï¼‰æŸ¥æ‰¾ï¼Œå› æ­¤å¯¹å…¶ä½¿ç”¨æ³›å‹æœç´¢ç®—æ³•å‡ ä¹æ€»æ˜¯ä¸ªåä¸»æ„ã€‚</p><p>å…³è”å®¹å™¨å®šä¹‰äº†ä¸€ä¸ªåä¸ºfindçš„æˆå‘˜ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªç»™å®šçš„å…³é”®å­—ç›´æ¥è·å–å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ³›å‹findç®—æ³•æ¥æŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ­¤ç®—æ³•ä¼šè¿›è¡Œé¡ºåºæœç´¢ã€‚ä½¿ç”¨å…³è”å®¹å™¨å®šä¹‰çš„ä¸“ç”¨çš„findæˆå‘˜ä¼šæ¯”è°ƒç”¨æ³›å‹findå¿«å¾—å¤šã€‚</p><h3 id="11-3-2-æ·»åŠ å…ƒç´ "><a href="#11-3-2-æ·»åŠ å…ƒç´ " class="headerlink" title="11.3.2 æ·»åŠ å…ƒç´ "></a>11.3.2 æ·»åŠ å…ƒç´ </h3><p>å…³è”å®¹å™¨çš„insertæˆå‘˜ï¼ˆè§è¡¨11.4ï¼Œç¬¬384é¡µï¼‰å‘å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ æˆ–ä¸€ä¸ªå…ƒç´ èŒƒå›´ã€‚ç”±äºmapå’Œsetï¼ˆä»¥åŠå¯¹åº”çš„æ— åºç±»å‹ï¼‰åŒ…å«ä¸é‡å¤çš„å…³é”®å­—ï¼Œå› æ­¤æ’å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„å…ƒç´ å¯¹å®¹å™¨æ²¡æœ‰ä»»ä½•å½±å“</p><p>insertæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ¥å—ä¸€å¯¹è¿­ä»£å™¨ï¼Œæˆ–æ˜¯ä¸€ä¸ªåˆå§‹åŒ–å™¨åˆ—è¡¨ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬çš„è¡Œä¸ºç±»ä¼¼å¯¹åº”çš„æ„é€ å‡½æ•°ï¼ˆå‚è§11.2.1èŠ‚ï¼Œç¬¬376é¡µï¼‰â€”â€”å¯¹äºä¸€ä¸ªç»™å®šçš„å…³é”®å­—ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå¸¦æ­¤å…³é”®å­—çš„å…ƒç´ æ‰è¢«æ’å…¥åˆ°å®¹å™¨ä¸­ã€‚</p><p><strong>å‘mapæ·»åŠ å…ƒç´ </strong></p><p>å¯¹ä¸€ä¸ªmapè¿›è¡Œinsertæ“ä½œæ—¶ï¼Œå¿…é¡»è®°ä½å…ƒç´ ç±»å‹æ˜¯pairã€‚é€šå¸¸ï¼Œå¯¹äºæƒ³è¦æ’å…¥çš„æ•°æ®ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç°æˆçš„pairå¯¹è±¡ã€‚å¯ä»¥åœ¨insertçš„å‚æ•°åˆ—è¡¨ä¸­åˆ›å»ºä¸€ä¸ªpair</p><p><img src="/../images/C-C-Primer-Chapter-11/1726390972049.png"></p><p><strong>æ£€æµ‹insertçš„è¿”å›å€¼</strong></p><p><strong>å‘multisetæˆ–multimapæ·»åŠ å…ƒç´ </strong></p><h3 id="11-3-3-åˆ é™¤å…ƒç´ "><a href="#11-3-3-åˆ é™¤å…ƒç´ " class="headerlink" title="11.3.3 åˆ é™¤å…ƒç´ "></a>11.3.3 åˆ é™¤å…ƒç´ </h3><p>å…³è”å®¹å™¨å®šä¹‰äº†ä¸‰ä¸ªç‰ˆæœ¬çš„eraseï¼Œå¦‚è¡¨11.5æ‰€ç¤ºã€‚ä¸é¡ºåºå®¹å™¨ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ é€’ç»™eraseä¸€ä¸ªè¿­ä»£å™¨æˆ–ä¸€ä¸ªè¿­ä»£å™¨å¯¹æ¥åˆ é™¤ä¸€ä¸ªå…ƒç´ æˆ–è€…ä¸€ä¸ªå…ƒç´ èŒƒå›´ã€‚è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„eraseä¸å¯¹åº”çš„é¡ºåºå®¹å™¨çš„æ“ä½œéå¸¸ç›¸ä¼¼ï¼šæŒ‡å®šçš„å…ƒç´ è¢«åˆ é™¤ï¼Œå‡½æ•°è¿”å›voidã€‚</p><p>å…³è”å®¹å™¨æä¾›ä¸€ä¸ªé¢å¤–çš„eraseæ“ä½œï¼Œå®ƒæ¥å—ä¸€ä¸ªkey_typeå‚æ•°ã€‚æ­¤ç‰ˆæœ¬åˆ é™¤æ‰€æœ‰åŒ¹é…ç»™å®šå…³é”®å­—çš„å…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼Œè¿”å›å®é™…åˆ é™¤çš„å…ƒç´ çš„æ•°é‡ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726391205794.png"></p><h3 id="11-3-4-mapçš„ä¸‹æ ‡æ“ä½œ"><a href="#11-3-4-mapçš„ä¸‹æ ‡æ“ä½œ" class="headerlink" title="11.3.4 mapçš„ä¸‹æ ‡æ“ä½œ"></a>11.3.4 mapçš„ä¸‹æ ‡æ“ä½œ</h3><p>mapå’Œunordered_mapå®¹å™¨æä¾›äº†ä¸‹æ ‡è¿ç®—ç¬¦å’Œä¸€ä¸ªå¯¹åº”çš„atå‡½æ•°ï¼ˆå‚è§9.3.2èŠ‚ï¼Œç¬¬311é¡µï¼‰ï¼Œå¦‚è¡¨11.6æ‰€ç¤ºã€‚setç±»å‹ä¸æ”¯æŒä¸‹æ ‡ï¼Œå› ä¸ºsetä¸­æ²¡æœ‰ä¸å…³é”®å­—ç›¸å…³è”çš„â€œå€¼â€ã€‚</p><p>æˆ‘ä»¬ä¸èƒ½å¯¹ä¸€ä¸ªmultimapæˆ–ä¸€ä¸ªunordered_multimapè¿›è¡Œä¸‹æ ‡æ“ä½œï¼Œå› ä¸ºè¿™äº›å®¹å™¨ä¸­å¯èƒ½æœ‰å¤šä¸ªå€¼ä¸ä¸€ä¸ªå…³é”®å­—ç›¸å…³è”ã€‚</p><p>å¦‚æœå…³é”®å­—å¹¶ä¸åœ¨mapä¸­ï¼Œä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå…ƒç´ å¹¶æ’å…¥åˆ°mapä¸­ï¼Œå…³è”å€¼å°†è¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726391287199.png"></p><p>å°†ä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>åœ¨word_countä¸­æœç´¢å…³é”®å­—ä¸ºAnnaçš„å…ƒç´ ï¼Œæœªæ‰¾åˆ°ã€‚</li><li>å°†ä¸€ä¸ªæ–°çš„å…³é”®å­—-å€¼å¯¹æ’å…¥åˆ°word_countä¸­ã€‚å…³é”®å­—æ˜¯ä¸€ä¸ªconst stringï¼Œä¿å­˜Annaã€‚å€¼è¿›è¡Œå€¼åˆå§‹åŒ–ï¼Œåœ¨æœ¬ä¾‹ä¸­æ„å‘³ç€å€¼ä¸º0ã€‚</li><li>æå–å‡ºæ–°æ’å…¥çš„å…ƒç´ ï¼Œå¹¶å°†å€¼1èµ‹äºˆå®ƒã€‚</li></ul><p>ç”±äºä¸‹æ ‡è¿ç®—ç¬¦å¯èƒ½æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œæˆ‘ä»¬åªå¯ä»¥å¯¹éconstçš„mapä½¿ç”¨ä¸‹æ ‡æ“ä½œã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726391330440.png"></p><h3 id="11-3-5-è®¿é—®å…ƒç´ "><a href="#11-3-5-è®¿é—®å…ƒç´ " class="headerlink" title="11.3.5 è®¿é—®å…ƒç´ "></a>11.3.5 è®¿é—®å…ƒç´ </h3><p><img src="/../images/C-C-Primer-Chapter-11/1726391522187.png"></p><p><img src="/../images/C-C-Primer-Chapter-11/1726391528397.png"></p><p><strong>å¯¹mapä½¿ç”¨findä»£æ›¿ä¸‹æ ‡æ“ä½œ</strong></p><p>æˆ‘ä»¬åªæ˜¯æƒ³çŸ¥é“ä¸€ä¸ªç»™å®šå…³é”®å­—æ˜¯å¦åœ¨mapä¸­ï¼Œè€Œä¸æƒ³æ”¹å˜mapã€‚è¿™æ ·å°±ä¸èƒ½ä½¿ç”¨ä¸‹æ ‡è¿ç®—ç¬¦æ¥æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå› ä¸ºå¦‚æœå…³é”®å­—ä¸å­˜åœ¨çš„è¯ï¼Œä¸‹æ ‡è¿ç®—ç¬¦ä¼šæ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨find</p><p><strong>åœ¨multimapæˆ–multisetä¸­æŸ¥æ‰¾å…ƒç´ </strong></p><p>å¦‚æœä¸€ä¸ªmultimapæˆ–multisetä¸­æœ‰å¤šä¸ªå…ƒç´ å…·æœ‰ç»™å®šå…³é”®å­—ï¼Œåˆ™è¿™äº›å…ƒç´ åœ¨å®¹å™¨ä¸­ä¼šç›¸é‚»å­˜å‚¨ã€‚</p><p>ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªä»ä½œè€…åˆ°è‘—ä½œé¢˜ç›®çš„æ˜ å°„ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³æ‰“å°ä¸€ä¸ªç‰¹å®šä½œè€…çš„æ‰€æœ‰è‘—ä½œã€‚</p><p>å¯ä»¥ç”¨ä¸‰ç§ä¸åŒæ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æœ€ç›´è§‚çš„æ–¹æ³•æ˜¯ä½¿ç”¨findå’Œcountï¼š</p><p><img src="/../images/C-C-Primer-Chapter-11/1726391774290.png"></p><p><strong>ä¸€ç§ä¸åŒçš„ï¼Œé¢å‘è¿­ä»£å™¨çš„è§£å†³æ–¹æ³•</strong></p><p>æˆ‘ä»¬è¿˜å¯ä»¥ç”¨lower_boundå’Œupper_boundæ¥è§£å†³æ­¤é—®é¢˜ã€‚è¿™ä¸¤ä¸ªæ“ä½œéƒ½æ¥å—ä¸€ä¸ªå…³é”®å­—ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚å¦‚æœå…³é”®å­—åœ¨å®¹å™¨ä¸­ï¼Œlower_boundè¿”å›çš„è¿­ä»£å™¨å°†æŒ‡å‘ç¬¬ä¸€ä¸ªå…·æœ‰ç»™å®šå…³é”®å­—çš„å…ƒç´ ï¼Œè€Œupper_boundè¿”å›çš„è¿­ä»£å™¨åˆ™æŒ‡å‘æœ€åä¸€ä¸ªåŒ¹é…ç»™å®šå…³é”®å­—çš„å…ƒç´ ä¹‹åçš„ä½ç½®ã€‚å¦‚æœå…ƒç´ ä¸åœ¨multimapä¸­ï¼Œåˆ™lower_boundå’Œupper_boundä¼šè¿”å›ç›¸ç­‰çš„è¿­ä»£å™¨â€”â€”æŒ‡å‘ä¸€ä¸ªä¸å½±å“æ’åºçš„å…³é”®å­—æ’å…¥ä½ç½®ã€‚å› æ­¤ï¼Œç”¨ç›¸åŒçš„å…³é”®å­—è°ƒç”¨lower_boundå’Œupper_boundä¼šå¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨èŒƒå›´ï¼ˆå‚è§9.2.1èŠ‚ï¼Œç¬¬296é¡µï¼‰ï¼Œè¡¨ç¤ºæ‰€æœ‰å…·æœ‰è¯¥å…³é”®å­—çš„å…ƒç´ çš„èŒƒå›´ã€‚</p><p>è¿™ä¸¤ä¸ªæ“ä½œè¿”å›çš„è¿­ä»£å™¨å¯èƒ½æ˜¯å®¹å™¨çš„å°¾åè¿­ä»£å™¨ã€‚å¦‚æœæˆ‘ä»¬æŸ¥æ‰¾çš„å…ƒç´ å…·æœ‰å®¹å™¨ä¸­æœ€å¤§çš„å…³é”®å­—ï¼Œåˆ™æ­¤å…³é”®å­—çš„upper_boundè¿”å›å°¾åè¿­ä»£å™¨ã€‚å¦‚æœå…³é”®å­—ä¸å­˜åœ¨ï¼Œä¸”å¤§äºå®¹å™¨ä¸­ä»»ä½•å…³é”®å­—ï¼Œåˆ™lower_boundè¿”å›çš„ä¹Ÿæ˜¯å°¾åè¿­ä»£å™¨ã€‚</p><blockquote><p>lower_boundè¿”å›çš„è¿­ä»£å™¨å¯èƒ½æŒ‡å‘ä¸€ä¸ªå…·æœ‰ç»™å®šå…³é”®å­—çš„å…ƒç´ ï¼Œä½†ä¹Ÿå¯èƒ½ä¸æŒ‡å‘ã€‚å¦‚æœå…³é”®å­—ä¸åœ¨å®¹å™¨ä¸­ï¼Œåˆ™lower_boundä¼šè¿”å›å…³é”®å­—çš„ç¬¬ä¸€ä¸ªå®‰å…¨æ’å…¥ç‚¹â€”â€”ä¸å½±å“å®¹å™¨ä¸­å…ƒç´ é¡ºåºçš„æ’å…¥ä½ç½®ã€‚</p></blockquote><p><img src="/../images/C-C-Primer-Chapter-11/1726392086527.png"></p><p><strong>equal_rangeå‡½æ•°</strong></p><p>è§£å†³æ­¤é—®é¢˜çš„æœ€åä¸€ç§æ–¹æ³•æ˜¯ä¸‰ç§æ–¹æ³•ä¸­æœ€ç›´æ¥çš„ï¼šä¸å¿…å†è°ƒç”¨upper_boundå’Œlower_boundï¼Œç›´æ¥è°ƒç”¨equal_rangeå³å¯ã€‚æ­¤å‡½æ•°æ¥å—ä¸€ä¸ªå…³é”®å­—ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨pairã€‚è‹¥å…³é”®å­—å­˜åœ¨ï¼Œåˆ™ç¬¬ä¸€ä¸ªè¿­ä»£å™¨æŒ‡å‘ç¬¬ä¸€ä¸ªä¸å…³é”®å­—åŒ¹é…çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªè¿­ä»£å™¨æŒ‡å‘æœ€åä¸€ä¸ªåŒ¹é…å…ƒç´ ä¹‹åçš„ä½ç½®ã€‚è‹¥æœªæ‰¾åˆ°åŒ¹é…å…ƒç´ ï¼Œåˆ™ä¸¤ä¸ªè¿­ä»£å™¨éƒ½æŒ‡å‘å…³é”®å­—å¯ä»¥æ’å…¥çš„ä½ç½®ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726396333694.png"></p><h3 id="11-3-6-ä¸€ä¸ªå•è¯è½¬æ¢çš„map"><a href="#11-3-6-ä¸€ä¸ªå•è¯è½¬æ¢çš„map" class="headerlink" title="11.3.6 ä¸€ä¸ªå•è¯è½¬æ¢çš„map"></a>11.3.6 ä¸€ä¸ªå•è¯è½¬æ¢çš„map</h3><p>ç»™å®šä¸€ä¸ªstringï¼Œå°†å®ƒè½¬æ¢ä¸ºå¦ä¸€ä¸ªstringã€‚ç¨‹åºçš„è¾“å…¥æ˜¯ä¸¤ä¸ªæ–‡ä»¶ã€‚ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¿å­˜çš„æ˜¯ä¸€äº›è§„åˆ™ï¼Œç”¨æ¥è½¬æ¢ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­çš„æ–‡æœ¬ã€‚æ¯æ¡è§„åˆ™ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªå¯èƒ½å‡ºç°åœ¨è¾“å…¥æ–‡ä»¶ä¸­çš„å•è¯å’Œä¸€ä¸ªç”¨æ¥æ›¿æ¢å®ƒçš„çŸ­è¯­ã€‚è¡¨è¾¾çš„å«ä¹‰æ˜¯ï¼Œæ¯å½“ç¬¬ä¸€ä¸ªå•è¯å‡ºç°åœ¨è¾“å…¥ä¸­æ—¶ï¼Œæˆ‘ä»¬å°±å°†å®ƒæ›¿æ¢ä¸ºå¯¹åº”çš„çŸ­è¯­ã€‚ç¬¬äºŒä¸ªè¾“å…¥æ–‡ä»¶åŒ…å«è¦è½¬æ¢çš„æ–‡æœ¬ã€‚</p><h2 id="11-4-æ— åºå®¹å™¨"><a href="#11-4-æ— åºå®¹å™¨" class="headerlink" title="11.4 æ— åºå®¹å™¨"></a>11.4 æ— åºå®¹å™¨</h2><p>æ–°æ ‡å‡†å®šä¹‰äº†4ä¸ªæ— åºå…³è”å®¹å™¨ï¼ˆunordered associative containerï¼‰ã€‚è¿™äº›å®¹å™¨ä¸æ˜¯ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æ¥ç»„ç»‡å…ƒç´ ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆhash functionï¼‰å’Œå…³é”®å­—ç±»å‹çš„&#x3D;&#x3D;è¿ç®—ç¬¦ã€‚åœ¨å…³é”®å­—ç±»å‹çš„å…ƒç´ æ²¡æœ‰æ˜æ˜¾çš„åºå…³ç³»çš„æƒ…å†µä¸‹ï¼Œæ— åºå®¹å™¨æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œç»´æŠ¤å…ƒç´ çš„åºä»£ä»·éå¸¸é«˜æ˜‚ï¼Œæ­¤æ—¶æ— åºå®¹å™¨ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p><p><strong>ä½¿ç”¨æ— åºå®¹å™¨</strong></p><p>é€šå¸¸å¯ä»¥ç”¨ä¸€ä¸ªæ— åºå®¹å™¨æ›¿æ¢å¯¹åº”çš„æœ‰åºå®¹å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p><strong>ç®¡ç†æ¡¶</strong></p><p>æ— åºå®¹å™¨åœ¨å­˜å‚¨ä¸Šç»„ç»‡ä¸ºä¸€ç»„æ¡¶ï¼Œæ¯ä¸ªæ¡¶ä¿å­˜é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚æ— åºå®¹å™¨ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°å°†å…ƒç´ æ˜ å°„åˆ°æ¡¶ã€‚ä¸ºäº†è®¿é—®ä¸€ä¸ªå…ƒç´ ï¼Œå®¹å™¨é¦–å…ˆè®¡ç®—å…ƒç´ çš„å“ˆå¸Œå€¼ï¼Œå®ƒæŒ‡å‡ºåº”è¯¥æœç´¢å“ªä¸ªæ¡¶ã€‚å®¹å™¨å°†å…·æœ‰ä¸€ä¸ªç‰¹å®šå“ˆå¸Œå€¼çš„æ‰€æœ‰å…ƒç´ éƒ½ä¿å­˜åœ¨ç›¸åŒçš„æ¡¶ä¸­ã€‚å¦‚æœå®¹å™¨å…è®¸é‡å¤å…³é”®å­—ï¼Œæ‰€æœ‰å…·æœ‰ç›¸åŒå…³é”®å­—çš„å…ƒç´ ä¹Ÿéƒ½ä¼šåœ¨åŒä¸€ä¸ªæ¡¶ä¸­ã€‚å› æ­¤ï¼Œæ— åºå®¹å™¨çš„æ€§èƒ½ä¾èµ–äºå“ˆå¸Œå‡½æ•°çš„è´¨é‡å’Œæ¡¶çš„æ•°é‡å’Œå¤§å°ã€‚</p><p>å¯¹äºç›¸åŒçš„å‚æ•°ï¼Œå“ˆå¸Œå‡½æ•°å¿…é¡»æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚</p><p>å½“ä¸€ä¸ªæ¡¶ä¿å­˜å¤šä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦é¡ºåºæœç´¢è¿™äº›å…ƒç´ æ¥æŸ¥æ‰¾æˆ‘ä»¬æƒ³è¦çš„é‚£ä¸ªã€‚</p><p>æ— åºå®¹å™¨æä¾›äº†ä¸€ç»„ç®¡ç†æ¡¶çš„å‡½æ•°ï¼Œå¦‚è¡¨11.8æ‰€ç¤ºã€‚è¿™äº›æˆå‘˜å‡½æ•°å…è®¸æˆ‘ä»¬æŸ¥è¯¢å®¹å™¨çš„çŠ¶æ€ä»¥åŠåœ¨å¿…è¦æ—¶å¼ºåˆ¶å®¹å™¨è¿›è¡Œé‡ç»„ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-11/1726400739462.png"></p><p><strong>æ— åºå®¹å™¨å¯¹å…³é”®å­—ç±»å‹çš„è¦æ±‚</strong></p><p>æ— åºå®¹å™¨ä½¿ç”¨å…³é”®å­—ç±»å‹çš„&#x3D;&#x3D;è¿ç®—ç¬¦æ¥æ¯”è¾ƒå…ƒç´ ï¼Œå®ƒä»¬è¿˜ä½¿ç”¨ä¸€ä¸ªhash<key_type>ç±»å‹çš„å¯¹è±¡æ¥ç”Ÿæˆæ¯ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼ã€‚æ ‡å‡†åº“ä¸ºå†…ç½®ç±»å‹ï¼ˆåŒ…æ‹¬æŒ‡é’ˆï¼‰æä¾›äº†hashæ¨¡æ¿ã€‚è¿˜ä¸ºä¸€äº›æ ‡å‡†åº“ç±»å‹ï¼ŒåŒ…æ‹¬stringå’Œæˆ‘ä»¬å°†è¦åœ¨ç¬¬12ç« ä»‹ç»çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹å®šä¹‰äº†hashã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®šä¹‰å…³é”®å­—æ˜¯å†…ç½®ç±»å‹ï¼ˆåŒ…æ‹¬æŒ‡é’ˆç±»å‹ï¼‰ã€stringè¿˜æ˜¯æ™ºèƒ½æŒ‡é’ˆç±»å‹çš„æ— åºå®¹å™¨ã€‚</p><p>ä¸èƒ½ç›´æ¥å®šä¹‰å…³é”®å­—ç±»å‹ä¸ºè‡ªå®šä¹‰ç±»ç±»å‹çš„æ— åºå®¹å™¨ã€‚ä¸å®¹å™¨ä¸åŒï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨å“ˆå¸Œæ¨¡æ¿ï¼Œè€Œå¿…é¡»æä¾›æˆ‘ä»¬è‡ªå·±çš„hashæ¨¡æ¿ç‰ˆæœ¬ã€‚æˆ‘ä»¬å°†åœ¨16.5èŠ‚ï¼ˆç¬¬626é¡µï¼‰ä¸­ä»‹ç»å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>æˆ‘ä»¬ä¸ä½¿ç”¨é»˜è®¤çš„hashï¼Œè€Œæ˜¯ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œç±»ä¼¼äºä¸ºæœ‰åºå®¹å™¨é‡è½½å…³é”®å­—ç±»å‹çš„é»˜è®¤æ¯”è¾ƒæ“ä½œï¼ˆå‚è§11.2.2èŠ‚ï¼Œç¬¬378é¡µï¼‰ã€‚ä¸ºäº†èƒ½å°†Sale_dataç”¨ä½œå…³é”®å­—ï¼Œæˆ‘ä»¬éœ€è¦æä¾›å‡½æ•°æ¥æ›¿ä»£&#x3D;&#x3D;è¿ç®—ç¬¦å’Œå“ˆå¸Œå€¼è®¡ç®—å‡½æ•°ã€‚æˆ‘ä»¬ä»å®šä¹‰è¿™äº›é‡è½½å‡½æ•°å¼€å§‹</p><p><img src="/../images/C-C-Primer-Chapter-11/1726401255757.png"></p><p><img src="/../images/C-C-Primer-Chapter-11/image-20240922131357012.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 10</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-10/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-10/</url>
    
    <content type="html"><![CDATA[<h1 id="æ³›å‹ç®—æ³•"><a href="#æ³›å‹ç®—æ³•" class="headerlink" title="æ³›å‹ç®—æ³•"></a>æ³›å‹ç®—æ³•</h1><span id="more"></span><h2 id="10-1-æ¦‚è¿°"><a href="#10-1-æ¦‚è¿°" class="headerlink" title="10.1 æ¦‚è¿°"></a>10.1 æ¦‚è¿°</h2><p>å¤§å¤šæ•°ç®—æ³•éƒ½å®šä¹‰åœ¨å¤´æ–‡ä»¶algorithmä¸­ã€‚æ ‡å‡†åº“è¿˜åœ¨å¤´æ–‡ä»¶numericä¸­å®šä¹‰äº†ä¸€ç»„æ•°å€¼æ³›å‹ç®—æ³•ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™äº›ç®—æ³•å¹¶ä¸ç›´æ¥æ“ä½œå®¹å™¨ï¼Œè€Œæ˜¯éå†ç”±ä¸¤ä¸ªè¿­ä»£å™¨æŒ‡å®šçš„ä¸€ä¸ªå…ƒç´ èŒƒå›´ï¼ˆå‚è§9.2.1èŠ‚ï¼Œç¬¬296é¡µï¼‰æ¥è¿›è¡Œæ“ä½œã€‚</p><p><strong>è¿­ä»£å™¨ä»¤ç®—æ³•ä¸ä¾èµ–äºå®¹å™¨ï¼Œä½†ç®—æ³•ä¾èµ–äºå…ƒç´ ç±»å‹çš„æ“ä½œ</strong></p><p><strong>å…³é”®æ¦‚å¿µï¼šç®—æ³•æ°¸è¿œä¸ä¼šæ‰§è¡Œå®¹å™¨çš„æ“ä½œ</strong></p><p>ç®—æ³•æ°¸è¿œä¸ä¼šæ”¹å˜åº•å±‚å®¹å™¨çš„å¤§å°ã€‚ç®—æ³•å¯èƒ½æ”¹å˜å®¹å™¨ä¸­ä¿å­˜çš„å…ƒç´ çš„å€¼ï¼Œä¹Ÿå¯èƒ½åœ¨å®¹å™¨å†…ç§»åŠ¨å…ƒç´ ï¼Œä½†æ°¸è¿œä¸ä¼šç›´æ¥æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚</p><h2 id="10-2-åˆè¯†æ³›å‹ç®—æ³•"><a href="#10-2-åˆè¯†æ³›å‹ç®—æ³•" class="headerlink" title="10.2 åˆè¯†æ³›å‹ç®—æ³•"></a>10.2 åˆè¯†æ³›å‹ç®—æ³•</h2><h3 id="10-2-1-åªè¯»ç®—æ³•"><a href="#10-2-1-åªè¯»ç®—æ³•" class="headerlink" title="10.2.1 åªè¯»ç®—æ³•"></a>10.2.1 åªè¯»ç®—æ³•</h3><p>ä¸€äº›ç®—æ³•åªä¼šè¯»å–å…¶è¾“å…¥èŒƒå›´å†…çš„å…ƒç´ ï¼Œè€Œä»ä¸æ”¹å˜å…ƒç´ ã€‚</p><p>findå°±æ˜¯è¿™æ ·ä¸€ç§ç®—æ³•ï¼Œæˆ‘ä»¬åœ¨10.1èŠ‚ç»ƒä¹ ï¼ˆç¬¬337é¡µï¼‰ä¸­ä½¿ç”¨çš„countå‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦ä¸€ä¸ªåªè¯»ç®—æ³•æ˜¯accumulateï¼Œå®ƒå®šä¹‰åœ¨å¤´æ–‡ä»¶numericä¸­ã€‚accumulateå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªæŒ‡å‡ºäº†éœ€è¦æ±‚å’Œçš„å…ƒç´ çš„èŒƒå›´ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å’Œçš„åˆå€¼ã€‚accumulateçš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ç±»å‹å†³å®šäº†å‡½æ•°ä¸­ä½¿ç”¨å“ªä¸ªåŠ æ³•è¿ç®—ç¬¦ä»¥åŠè¿”å›å€¼çš„ç±»å‹ã€‚</p><p><strong>ç®—æ³•å’Œå…ƒç´ ç±»å‹</strong></p><p>å¯¹äºåªè¯»å–è€Œä¸æ”¹å˜å…ƒç´ çš„ç®—æ³•ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨cbeginï¼ˆï¼‰å’Œcendï¼ˆï¼‰ï¼ˆå‚è§9.2.3èŠ‚ï¼Œç¬¬298é¡µï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ è®¡åˆ’ä½¿ç”¨ç®—æ³•è¿”å›çš„è¿­ä»£å™¨æ¥æ”¹å˜å…ƒç´ çš„å€¼ï¼Œå°±éœ€è¦ä½¿ç”¨beginï¼ˆï¼‰å’Œendï¼ˆï¼‰çš„ç»“æœä½œä¸ºå‚æ•°ã€‚</p><p><strong>æ“ä½œä¸¤ä¸ªåºåˆ—çš„ç®—æ³•</strong></p><p>å¦ä¸€ä¸ªåªè¯»ç®—æ³•æ˜¯equalï¼Œç”¨äºç¡®å®šä¸¤ä¸ªåºåˆ—æ˜¯å¦ä¿å­˜ç›¸åŒçš„å€¼ã€‚å®ƒå°†ç¬¬ä¸€ä¸ªåºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ä¸ç¬¬äºŒä¸ªåºåˆ—ä¸­çš„å¯¹åº”å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ‰€æœ‰å¯¹åº”å…ƒç´ éƒ½ç›¸ç­‰ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚æ­¤ç®—æ³•æ¥å—ä¸‰ä¸ªè¿­ä»£å™¨ï¼šå‰ä¸¤ä¸ªï¼ˆä¸ä»¥å¾€ä¸€æ ·ï¼‰è¡¨ç¤ºç¬¬ä¸€ä¸ªåºåˆ—ä¸­çš„å…ƒç´ èŒƒå›´ï¼Œç¬¬ä¸‰ä¸ªè¡¨ç¤ºç¬¬äºŒä¸ªåºåˆ—çš„é¦–å…ƒç´ ã€‚equalåŸºäºä¸€ä¸ªéå¸¸é‡è¦çš„å‡è®¾ï¼šå®ƒå‡å®šç¬¬äºŒä¸ªåºåˆ—è‡³å°‘ä¸ç¬¬ä¸€ä¸ªåºåˆ—ä¸€æ ·é•¿ã€‚</p><blockquote><p>é‚£äº›åªæ¥å—ä¸€ä¸ªå•ä¸€è¿­ä»£å™¨æ¥è¡¨ç¤ºç¬¬äºŒä¸ªåºåˆ—çš„ç®—æ³•ï¼Œéƒ½å‡å®šç¬¬äºŒä¸ªåºåˆ—è‡³å°‘ä¸ç¬¬ä¸€ä¸ªåºåˆ—ä¸€æ ·é•¿ã€‚</p></blockquote><h3 id="10-2-2-å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•"><a href="#10-2-2-å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•" class="headerlink" title="10.2.2 å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•"></a>10.2.2 å†™å®¹å™¨å…ƒç´ çš„ç®—æ³•</h3><p>ç®—æ³•fillæ¥å—ä¸€å¯¹è¿­ä»£å™¨è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œè¿˜æ¥å—ä¸€ä¸ªå€¼ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚fillå°†ç»™å®šçš„è¿™ä¸ªå€¼èµ‹äºˆè¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726201288551.png"></p><p><strong>ç®—æ³•ä¸æ£€æŸ¥å†™æ“ä½œ</strong></p><p>å‡½æ•°fill_næ¥å—ä¸€ä¸ªå•è¿­ä»£å™¨ã€ä¸€ä¸ªè®¡æ•°å€¼å’Œä¸€ä¸ªå€¼ã€‚å®ƒå°†ç»™å®šå€¼èµ‹äºˆè¿­ä»£å™¨æŒ‡å‘çš„å…ƒç´ å¼€å§‹çš„æŒ‡å®šä¸ªå…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥ç”¨fill_nå°†ä¸€ä¸ªæ–°å€¼èµ‹äºˆvectorä¸­çš„å…ƒç´ ã€‚å‡½æ•°fill_nå‡å®šå†™å…¥æŒ‡å®šä¸ªå…ƒç´ æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>ä»‹ç»back_inserter</strong></p><p>ä¸€ç§ä¿è¯ç®—æ³•æœ‰è¶³å¤Ÿå…ƒç´ ç©ºé—´æ¥å®¹çº³è¾“å‡ºæ•°æ®çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ’å…¥è¿­ä»£å™¨ï¼ˆinsert iteratorï¼‰ã€‚æ’å…¥è¿­ä»£å™¨æ˜¯ä¸€ç§å‘å®¹å™¨ä¸­æ·»åŠ å…ƒç´ çš„è¿­ä»£å™¨ã€‚é€šå¸¸æƒ…å†µï¼Œå½“æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‘å®¹å™¨å…ƒç´ èµ‹å€¼æ—¶ï¼Œå€¼è¢«èµ‹äºˆè¿­ä»£å™¨æŒ‡å‘çš„å…ƒç´ ã€‚è€Œå½“æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ’å…¥è¿­ä»£å™¨èµ‹å€¼æ—¶ï¼Œä¸€ä¸ªä¸èµ‹å€¼å·å³ä¾§å€¼ç›¸ç­‰çš„å…ƒç´ è¢«æ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚</p><p>æˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨back_inserterï¼Œå®ƒæ˜¯å®šä¹‰åœ¨å¤´æ–‡ä»¶iteratorä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚</p><p>back_inserteræ¥å—ä¸€ä¸ªæŒ‡å‘å®¹å™¨çš„å¼•ç”¨ï¼Œè¿”å›ä¸€ä¸ªä¸è¯¥å®¹å™¨ç»‘å®šçš„æ’å…¥è¿­ä»£å™¨ã€‚å½“æˆ‘ä»¬é€šè¿‡æ­¤è¿­ä»£å™¨èµ‹å€¼æ—¶ï¼Œèµ‹å€¼è¿ç®—ç¬¦ä¼šè°ƒç”¨push_backå°†ä¸€ä¸ªå…·æœ‰ç»™å®šå€¼çš„å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­</p><p><strong>æ‹·è´ç®—æ³•</strong></p><p>æ‹·è´ï¼ˆcopyï¼‰ç®—æ³•æ˜¯å¦ä¸€ä¸ªå‘ç›®çš„ä½ç½®è¿­ä»£å™¨æŒ‡å‘çš„è¾“å‡ºåºåˆ—ä¸­çš„å…ƒç´ å†™å…¥æ•°æ®çš„ç®—æ³•ã€‚æ­¤ç®—æ³•æ¥å—ä¸‰ä¸ªè¿­ä»£å™¨ï¼Œå‰ä¸¤ä¸ªè¡¨ç¤ºä¸€ä¸ªè¾“å…¥èŒƒå›´ï¼Œç¬¬ä¸‰ä¸ªè¡¨ç¤ºç›®çš„åºåˆ—çš„èµ·å§‹ä½ç½®ã€‚</p><p>copyè¿”å›çš„æ˜¯å…¶ç›®çš„ä½ç½®è¿­ä»£å™¨ï¼ˆé€’å¢åï¼‰çš„å€¼ã€‚å³ï¼Œretæ°å¥½æŒ‡å‘æ‹·è´åˆ°a2çš„å°¾å…ƒç´ ä¹‹åçš„ä½ç½®ã€‚</p><p>å¤šä¸ªç®—æ³•éƒ½æä¾›æ‰€è°“çš„â€œæ‹·è´â€ç‰ˆæœ¬ã€‚è¿™äº›ç®—æ³•è®¡ç®—æ–°å…ƒç´ çš„å€¼ï¼Œä½†ä¸ä¼šå°†å®ƒä»¬æ”¾ç½®åœ¨è¾“å…¥åºåˆ—çš„æœ«å°¾ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°åºåˆ—ä¿å­˜è¿™äº›ç»“æœã€‚</p><p>replaceç®—æ³•è¯»å…¥ä¸€ä¸ªåºåˆ—ï¼Œå¹¶å°†å…¶ä¸­æ‰€æœ‰ç­‰äºç»™å®šå€¼çš„å…ƒç´ éƒ½æ”¹ä¸ºå¦ä¸€ä¸ªå€¼ã€‚æ­¤ç®—æ³•æ¥å—4ä¸ªå‚æ•°ï¼šå‰ä¸¤ä¸ªæ˜¯è¿­ä»£å™¨ï¼Œè¡¨ç¤ºè¾“å…¥åºåˆ—ï¼Œåä¸¤ä¸ªä¸€ä¸ªæ˜¯è¦æœç´¢çš„å€¼ï¼Œå¦ä¸€ä¸ªæ˜¯æ–°å€¼ã€‚å®ƒå°†æ‰€æœ‰ç­‰äºç¬¬ä¸€ä¸ªå€¼çš„å…ƒç´ æ›¿æ¢ä¸ºç¬¬äºŒä¸ªå€¼</p><p>æ­¤è°ƒç”¨å°†åºåˆ—ä¸­æ‰€æœ‰çš„0éƒ½æ›¿æ¢ä¸º42ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¿ç•™åŸåºåˆ—ä¸å˜ï¼Œå¯ä»¥è°ƒç”¨replace_copyã€‚æ­¤ç®—æ³•æ¥å—é¢å¤–ç¬¬ä¸‰ä¸ªè¿­ä»£å™¨å‚æ•°ï¼ŒæŒ‡å‡ºè°ƒæ•´ååºåˆ—çš„ä¿å­˜ä½ç½®</p><p><img src="/../images/C-C-Primer-Chapter-10/1726228439564.png"></p><p>æ­¤è°ƒç”¨åï¼Œilstå¹¶æœªæ”¹å˜ï¼ŒivecåŒ…å«ilstçš„ä¸€ä»½æ‹·è´ï¼Œä¸è¿‡åŸæ¥åœ¨ilstä¸­å€¼ä¸º0çš„å…ƒç´ åœ¨ivecä¸­éƒ½å˜ä¸º42ã€‚</p><h3 id="10-2-3-é‡æ’å®¹å™¨å…ƒç´ çš„ç®—æ³•"><a href="#10-2-3-é‡æ’å®¹å™¨å…ƒç´ çš„ç®—æ³•" class="headerlink" title="10.2.3 é‡æ’å®¹å™¨å…ƒç´ çš„ç®—æ³•"></a>10.2.3 é‡æ’å®¹å™¨å…ƒç´ çš„ç®—æ³•</h3><p>æŸäº›ç®—æ³•ä¼šé‡æ’å®¹å™¨ä¸­å…ƒç´ çš„é¡ºåºï¼Œä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å­æ˜¯sortã€‚è°ƒç”¨sortä¼šé‡æ’è¾“å…¥åºåˆ—ä¸­çš„å…ƒç´ ï¼Œä½¿ä¹‹æœ‰åºï¼Œå®ƒæ˜¯åˆ©ç”¨å…ƒç´ ç±»å‹çš„&lt;è¿ç®—ç¬¦æ¥å®ç°æ’åºçš„ã€‚</p><p><strong>æ¶ˆé™¤é‡å¤å•è¯</strong></p><p>ä¸ºäº†æ¶ˆé™¤é‡å¤å•è¯ï¼Œé¦–å…ˆå°†vectoræ’åºï¼Œä½¿å¾—é‡å¤çš„å•è¯éƒ½ç›¸é‚»å‡ºç°ã€‚ä¸€æ—¦vectoræ’åºå®Œæ¯•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªç§°ä¸ºuniqueçš„æ ‡å‡†åº“ç®—æ³•æ¥é‡æ’vectorï¼Œä½¿å¾—ä¸é‡å¤çš„å…ƒç´ å‡ºç°åœ¨vectorçš„å¼€å§‹éƒ¨åˆ†ã€‚ç”±äºç®—æ³•ä¸èƒ½æ‰§è¡Œå®¹å™¨çš„æ“ä½œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨vectorçš„eraseæˆå‘˜æ¥å®ŒæˆçœŸæ­£çš„åˆ é™¤æ“ä½œ</p><p><img src="/../images/C-C-Primer-Chapter-10/1726228562655.png"></p><p><strong>ä½¿ç”¨unique</strong></p><p>uniqueç®—æ³•é‡æ’è¾“å…¥åºåˆ—ï¼Œå°†ç›¸é‚»çš„é‡å¤é¡¹â€œæ¶ˆé™¤â€ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘ä¸é‡å¤å€¼èŒƒå›´æœ«å°¾çš„è¿­ä»£å™¨ã€‚</p><p>uniqueè¿”å›çš„è¿­ä»£å™¨æŒ‡å‘æœ€åä¸€ä¸ªä¸é‡å¤å…ƒç´ ä¹‹åçš„ä½ç½®ã€‚æ­¤ä½ç½®ä¹‹åçš„å…ƒç´ ä»ç„¶å­˜åœ¨ï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬çš„å€¼æ˜¯ä»€ä¹ˆã€‚</p><p><strong>ä½¿ç”¨å®¹å™¨æ“ä½œåˆ é™¤å…ƒç´ </strong></p><h2 id="10-3-å®šåˆ¶æ“ä½œ"><a href="#10-3-å®šåˆ¶æ“ä½œ" class="headerlink" title="10.3 å®šåˆ¶æ“ä½œ"></a>10.3 å®šåˆ¶æ“ä½œ</h2><h3 id="10-3-1-å‘ç®—æ³•ä¼ é€’å‡½æ•°"><a href="#10-3-1-å‘ç®—æ³•ä¼ é€’å‡½æ•°" class="headerlink" title="10.3.1 å‘ç®—æ³•ä¼ é€’å‡½æ•°"></a>10.3.1 å‘ç®—æ³•ä¼ é€’å‡½æ•°</h3><p>ä¸ºäº†æŒ‰é•¿åº¦é‡æ’vectorï¼Œæˆ‘ä»¬å°†ä½¿ç”¨sortçš„ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬æ˜¯é‡è½½è¿‡çš„ï¼Œå®ƒæ¥å—ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ­¤å‚æ•°æ˜¯ä¸€ä¸ªè°“è¯ï¼ˆpredicateï¼‰ã€‚</p><p><strong>è°“è¯</strong></p><p>è°“è¯æ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„è¡¨è¾¾å¼ï¼Œå…¶è¿”å›ç»“æœæ˜¯ä¸€ä¸ªèƒ½ç”¨ä½œæ¡ä»¶çš„å€¼ã€‚æ ‡å‡†åº“ç®—æ³•æ‰€ä½¿ç”¨çš„è°“è¯åˆ†ä¸ºä¸¤ç±»ï¼šä¸€å…ƒè°“è¯ï¼ˆunary predicateï¼Œæ„å‘³ç€å®ƒä»¬åªæ¥å—å•ä¸€å‚æ•°ï¼‰å’ŒäºŒå…ƒè°“è¯ï¼ˆbinary predicateï¼Œæ„å‘³ç€å®ƒä»¬æœ‰ä¸¤ä¸ªå‚æ•°ï¼‰ã€‚æ¥å—è°“è¯å‚æ•°çš„ç®—æ³•å¯¹è¾“å…¥åºåˆ—ä¸­çš„å…ƒç´ è°ƒç”¨è°“è¯ã€‚å› æ­¤ï¼Œå…ƒç´ ç±»å‹å¿…é¡»èƒ½è½¬æ¢ä¸ºè°“è¯çš„å‚æ•°ç±»å‹ã€‚</p><p>æ¥å—ä¸€ä¸ªäºŒå…ƒè°“è¯å‚æ•°çš„sortç‰ˆæœ¬ç”¨è¿™ä¸ªè°“è¯ä»£æ›¿&lt;æ¥æ¯”è¾ƒå…ƒç´ ã€‚æˆ‘ä»¬æä¾›ç»™sortçš„è°“è¯å¿…é¡»æ»¡è¶³å°†åœ¨11.2.2èŠ‚ï¼ˆç¬¬378é¡µï¼‰ä¸­æ‰€ä»‹ç»çš„æ¡ä»¶ã€‚</p><p><strong>æ’åºç®—æ³•</strong></p><p>ä¸ºäº†ä¿æŒç›¸åŒé•¿åº¦çš„å•è¯æŒ‰å­—å…¸åºæ’åˆ—ï¼Œå¯ä»¥ä½¿ç”¨stable_sortç®—æ³•ã€‚è¿™ç§ç¨³å®šæ’åºç®—æ³•ç»´æŒç›¸ç­‰å…ƒç´ çš„åŸæœ‰é¡ºåºã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726229177622.png"></p><p>æ ‡å‡†åº“å®šä¹‰äº†åä¸ºpartitionçš„ç®—æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªè°“è¯ï¼Œå¯¹å®¹å™¨å†…å®¹è¿›è¡Œåˆ’åˆ†ï¼Œä½¿å¾—è°“è¯ä¸ºtrueçš„å€¼ä¼šæ’åœ¨å®¹å™¨çš„å‰åŠéƒ¨åˆ†ï¼Œè€Œä½¿è°“è¯ä¸ºfalseçš„å€¼ä¼šæ’åœ¨ååŠéƒ¨åˆ†ã€‚ç®—æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªä½¿è°“è¯ä¸ºtrueçš„å…ƒç´ ä¹‹åçš„ä½ç½®ã€‚</p><h3 id="10-3-2-lambdaè¡¨è¾¾å¼"><a href="#10-3-2-lambdaè¡¨è¾¾å¼" class="headerlink" title="10.3.2 lambdaè¡¨è¾¾å¼"></a>10.3.2 lambdaè¡¨è¾¾å¼</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å‡†åº“find_ifç®—æ³•æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…·æœ‰ç‰¹å®šå¤§å°çš„å…ƒç´ ã€‚ç±»ä¼¼findï¼ˆå‚è§10.1èŠ‚ï¼Œç¬¬336é¡µï¼‰ï¼Œfind_ifç®—æ³•æ¥å—ä¸€å¯¹è¿­ä»£å™¨ï¼Œè¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚ä½†ä¸findä¸åŒçš„æ˜¯ï¼Œfind_ifçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè°“è¯ã€‚find_ifç®—æ³•å¯¹è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨ç»™å®šçš„è¿™ä¸ªè°“è¯ã€‚å®ƒè¿”å›ç¬¬ä¸€ä¸ªä½¿è°“è¯è¿”å›é0å€¼çš„å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å…ƒç´ ï¼Œåˆ™è¿”å›å°¾è¿­ä»£å™¨ã€‚</p><p>find_ifæ¥å—ä¸€å…ƒè°“è¯â€”â€”æˆ‘ä»¬ä¼ é€’ç»™find_ifçš„ä»»ä½•å‡½æ•°éƒ½å¿…é¡»ä¸¥æ ¼æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä»¥ä¾¿èƒ½ç”¨æ¥è‡ªè¾“å…¥åºåˆ—çš„ä¸€ä¸ªå…ƒç´ è°ƒç”¨å®ƒã€‚æ²¡æœ‰ä»»ä½•åŠæ³•èƒ½ä¼ é€’ç»™å®ƒç¬¬äºŒä¸ªå‚æ•°æ¥è¡¨ç¤ºé•¿åº¦ã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨å¦å¤–ä¸€äº›è¯­è¨€ç‰¹æ€§ã€‚</p><p><strong>ä»‹ç»lambda</strong></p><p>æˆ‘ä»¬å¯ä»¥å‘ä¸€ä¸ªç®—æ³•ä¼ é€’ä»»ä½•ç±»åˆ«çš„<strong>å¯è°ƒç”¨å¯¹è±¡ï¼ˆcallable objectï¼‰ã€‚</strong>å¯¹äºä¸€ä¸ªå¯¹è±¡æˆ–ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚æœå¯ä»¥å¯¹å…¶ä½¿ç”¨è°ƒç”¨è¿ç®—ç¬¦ï¼ˆå‚è§1.5.2èŠ‚ï¼Œç¬¬21é¡µï¼‰ï¼Œåˆ™ç§°å®ƒä¸ºå¯è°ƒç”¨çš„ã€‚å³ï¼Œå¦‚æœeæ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„è¡¨è¾¾å¼ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥ç¼–å†™ä»£ç eï¼ˆargsï¼‰ï¼Œå…¶ä¸­argsæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„åˆ—è¡¨ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨è¿‡çš„ä»…æœ‰çš„ä¸¤ç§å¯è°ƒç”¨å¯¹è±¡æ˜¯å‡½æ•°å’Œå‡½æ•°æŒ‡é’ˆï¼ˆå‚è§6.7èŠ‚ï¼Œç¬¬221é¡µï¼‰ã€‚è¿˜æœ‰å…¶ä»–ä¸¤ç§å¯è°ƒç”¨å¯¹è±¡ï¼šé‡è½½äº†å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„ç±»ï¼Œæˆ‘ä»¬å°†åœ¨14.8èŠ‚ï¼ˆç¬¬506é¡µï¼‰ä»‹ç»ï¼Œä»¥åŠlambdaè¡¨è¾¾å¼ï¼ˆlambda expressionï¼‰ã€‚</p><p>ä¸€ä¸ªlambdaè¡¨è¾¾å¼è¡¨ç¤ºä¸€ä¸ªå¯è°ƒç”¨çš„ä»£ç å•å…ƒã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªæœªå‘½åçš„å†…è”å‡½æ•°ã€‚ä¸ä»»ä½•å‡½æ•°ç±»ä¼¼ï¼Œä¸€ä¸ªlambdaå…·æœ‰ä¸€ä¸ªè¿”å›ç±»å‹ã€ä¸€ä¸ªå‚æ•°åˆ—è¡¨å’Œä¸€ä¸ªå‡½æ•°ä½“ã€‚ä½†ä¸å‡½æ•°ä¸åŒï¼Œlambdaå¯èƒ½å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726229740080.png"></p><p>capture listï¼ˆæ•è·åˆ—è¡¨ï¼‰æ˜¯ä¸€ä¸ªlambdaæ‰€åœ¨å‡½æ•°ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡çš„åˆ—è¡¨ï¼ˆé€šå¸¸ä¸ºç©ºï¼‰ï¼›return typeã€parameter listå’Œfunction bodyä¸ä»»ä½•æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿”å›ç±»å‹ã€å‚æ•°åˆ—è¡¨å’Œå‡½æ•°ä½“ã€‚ä½†æ˜¯ï¼Œä¸æ™®é€šå‡½æ•°ä¸åŒï¼Œlambdaå¿…é¡»ä½¿ç”¨å°¾ç½®è¿”å›ï¼ˆå‚è§6.3.3èŠ‚ï¼Œç¬¬206é¡µï¼‰æ¥æŒ‡å®šè¿”å›ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥å¿½ç•¥å‚æ•°åˆ—è¡¨å’Œè¿”å›ç±»å‹ï¼Œä½†å¿…é¡»æ°¸è¿œåŒ…å«æ•è·åˆ—è¡¨å’Œå‡½æ•°ä½“</p><blockquote><p>å¦‚æœlambdaçš„å‡½æ•°ä½“åŒ…å«ä»»ä½•å•ä¸€returnè¯­å¥ä¹‹å¤–çš„å†…å®¹ï¼Œä¸”æœªæŒ‡å®šè¿”å›ç±»å‹ï¼Œåˆ™è¿”å›voidã€‚</p></blockquote><p><strong>å‘lambdaä¼ é€’å‚æ•°</strong></p><p>lambdaä¸èƒ½æœ‰é»˜è®¤å‚æ•°ï¼ˆå‚è§6.5.1èŠ‚ï¼Œç¬¬211é¡µï¼‰ã€‚</p><p><strong>ä½¿ç”¨æ•è·åˆ—è¡¨</strong></p><p>è™½ç„¶ä¸€ä¸ªlambdaå¯ä»¥å‡ºç°åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä½¿ç”¨å…¶å±€éƒ¨å˜é‡ï¼Œä½†å®ƒåªèƒ½ä½¿ç”¨é‚£äº›æ˜ç¡®æŒ‡æ˜çš„å˜é‡ã€‚ä¸€ä¸ªlambdaé€šè¿‡å°†å±€éƒ¨å˜é‡åŒ…å«åœ¨å…¶æ•è·åˆ—è¡¨ä¸­æ¥æŒ‡å‡ºå°†ä¼šä½¿ç”¨è¿™äº›å˜é‡ã€‚æ•è·åˆ—è¡¨æŒ‡å¼•lambdaåœ¨å…¶å†…éƒ¨åŒ…å«è®¿é—®å±€éƒ¨å˜é‡æ‰€éœ€çš„ä¿¡æ¯ã€‚</p><blockquote><p>ä¸€ä¸ªlambdaåªæœ‰åœ¨å…¶æ•è·åˆ—è¡¨ä¸­æ•è·ä¸€ä¸ªå®ƒæ‰€åœ¨å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼Œæ‰èƒ½åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨è¯¥å˜é‡ã€‚</p></blockquote><p><strong>for_eachç®—æ³•</strong></p><p>æ­¤ç®—æ³•æ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå¹¶å¯¹è¾“å…¥åºåˆ—ä¸­æ¯ä¸ªå…ƒç´ è°ƒç”¨æ­¤å¯¹è±¡</p><p>ä¸€ä¸ªlambdaå¯ä»¥ç›´æ¥ä½¿ç”¨å®šä¹‰åœ¨å½“å‰å‡½æ•°ä¹‹å¤–çš„åå­—ã€‚</p><blockquote><p>æ•è·åˆ—è¡¨åªç”¨äºå±€éƒ¨éstaticå˜é‡ï¼Œlambdaå¯ä»¥ç›´æ¥ä½¿ç”¨å±€éƒ¨staticå˜é‡å’Œåœ¨å®ƒæ‰€åœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„åå­—ã€‚</p></blockquote><h3 id="10-3-3-lambdaæ•è·å’Œè¿”å›"><a href="#10-3-3-lambdaæ•è·å’Œè¿”å›" class="headerlink" title="10.3.3 lambdaæ•è·å’Œè¿”å›"></a>10.3.3 lambdaæ•è·å’Œè¿”å›</h3><p>å½“å®šä¹‰ä¸€ä¸ªlambdaæ—¶ï¼Œç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªä¸lambdaå¯¹åº”çš„æ–°çš„ï¼ˆæœªå‘½åçš„ï¼‰ç±»ç±»å‹ã€‚</p><p>å¯ä»¥è¿™æ ·ç†è§£ï¼Œå½“å‘ä¸€ä¸ªå‡½æ•°ä¼ é€’ä¸€ä¸ªlambdaæ—¶ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸€ä¸ªæ–°ç±»å‹å’Œè¯¥ç±»å‹çš„ä¸€ä¸ªå¯¹è±¡ï¼šä¼ é€’çš„å‚æ•°å°±æ˜¯æ­¤ç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»ç±»å‹çš„æœªå‘½åå¯¹è±¡ã€‚ç±»ä¼¼çš„ï¼Œå½“ä½¿ç”¨autoå®šä¹‰ä¸€ä¸ªç”¨lambdaåˆå§‹åŒ–çš„å˜é‡æ—¶ï¼Œå®šä¹‰äº†ä¸€ä¸ªä»lambdaç”Ÿæˆçš„ç±»å‹çš„å¯¹è±¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»lambdaç”Ÿæˆçš„ç±»éƒ½åŒ…å«ä¸€ä¸ªå¯¹åº”è¯¥lambdaæ‰€æ•è·çš„å˜é‡çš„æ•°æ®æˆå‘˜ã€‚ç±»ä¼¼ä»»ä½•æ™®é€šç±»çš„æ•°æ®æˆå‘˜ï¼Œlambdaçš„æ•°æ®æˆå‘˜ä¹Ÿåœ¨lambdaå¯¹è±¡åˆ›å»ºæ—¶è¢«åˆå§‹åŒ–ã€‚</p><p><strong>å€¼æ•è·</strong></p><p>ä¸ä¼ å€¼å‚æ•°ç±»ä¼¼ï¼Œé‡‡ç”¨å€¼æ•è·çš„å‰ææ˜¯å˜é‡å¯ä»¥æ‹·è´ã€‚ä¸å‚æ•°ä¸åŒï¼Œè¢«æ•è·çš„å˜é‡çš„å€¼æ˜¯åœ¨lambdaåˆ›å»ºæ—¶æ‹·è´ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶æ‹·è´</p><p><img src="/../images/C-C-Primer-Chapter-10/1726231363510.png"></p><p>ç”±äºè¢«æ•è·å˜é‡çš„å€¼æ˜¯åœ¨lambdaåˆ›å»ºæ—¶æ‹·è´ï¼Œå› æ­¤éšåå¯¹å…¶ä¿®æ”¹ä¸ä¼šå½±å“åˆ°lambdaå†…å¯¹åº”çš„å€¼ã€‚</p><p><strong>å¼•ç”¨æ•è·</strong></p><p>å¼•ç”¨æ•è·ä¸è¿”å›å¼•ç”¨ï¼ˆå‚è§6.3.2èŠ‚ï¼Œç¬¬201é¡µï¼‰æœ‰ç€ç›¸åŒçš„é—®é¢˜å’Œé™åˆ¶ã€‚å¦‚æœæˆ‘ä»¬é‡‡ç”¨å¼•ç”¨æ–¹å¼æ•è·ä¸€ä¸ªå˜é‡ï¼Œå°±<strong>å¿…é¡»ç¡®ä¿è¢«å¼•ç”¨çš„å¯¹è±¡åœ¨lambdaæ‰§è¡Œçš„æ—¶å€™æ˜¯å­˜åœ¨çš„ã€‚</strong>lambdaæ•è·çš„éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨å‡½æ•°ç»“æŸåå°±ä¸å¤å­˜åœ¨äº†ã€‚å¦‚æœlambdaå¯èƒ½åœ¨å‡½æ•°ç»“æŸåæ‰§è¡Œï¼Œæ•è·çš„å¼•ç”¨æŒ‡å‘çš„å±€éƒ¨å˜é‡å·²ç»æ¶ˆå¤±ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»ä¸€ä¸ªå‡½æ•°è¿”å›lambdaã€‚å‡½æ•°å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè¯¥ç±»å«æœ‰å¯è°ƒç”¨å¯¹è±¡çš„æ•°æ®æˆå‘˜ã€‚å¦‚æœå‡½æ•°è¿”å›ä¸€ä¸ªlambdaï¼Œåˆ™ä¸å‡½æ•°ä¸èƒ½è¿”å›ä¸€ä¸ªå±€éƒ¨å˜é‡çš„å¼•ç”¨ç±»ä¼¼ï¼Œæ­¤lambdaä¹Ÿä¸èƒ½åŒ…å«å¼•ç”¨æ•è·ã€‚</p><p><strong>å»ºè®®ï¼šå°½é‡ä¿æŒlambdaçš„å˜é‡æ•è·ç®€å•åŒ–</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘æ•è·çš„æ•°æ®é‡ï¼Œæ¥é¿å…æ½œåœ¨çš„æ•è·å¯¼è‡´çš„é—®é¢˜ã€‚è€Œä¸”ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œåº”è¯¥é¿å…æ•è·æŒ‡é’ˆæˆ–å¼•ç”¨ã€‚</p><p><strong>éšå¼æ•è·</strong></p><p>å¯ä»¥è®©ç¼–è¯‘å™¨æ ¹æ®lambdaä½“ä¸­çš„ä»£ç æ¥æ¨æ–­æˆ‘ä»¬è¦ä½¿ç”¨å“ªäº›å˜é‡ã€‚ä¸ºäº†æŒ‡ç¤ºç¼–è¯‘å™¨æ¨æ–­æ•è·åˆ—è¡¨ï¼Œåº”åœ¨æ•è·åˆ—è¡¨ä¸­å†™ä¸€ä¸ª&amp;æˆ–&#x3D;ã€‚&amp;å‘Šè¯‰ç¼–è¯‘å™¨é‡‡ç”¨æ•è·å¼•ç”¨æ–¹å¼ï¼Œ&#x3D;åˆ™è¡¨ç¤ºé‡‡ç”¨å€¼æ•è·æ–¹å¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹ä¸€éƒ¨åˆ†å˜é‡é‡‡ç”¨å€¼æ•è·ï¼Œå¯¹å…¶ä»–å˜é‡é‡‡ç”¨å¼•ç”¨æ•è·ï¼Œå¯ä»¥æ··åˆä½¿ç”¨éšå¼æ•è·å’Œæ˜¾å¼æ•è·</p><p><img src="/../images/C-C-Primer-Chapter-10/1726231669244.png"></p><p>å½“æˆ‘ä»¬æ··åˆä½¿ç”¨éšå¼æ•è·å’Œæ˜¾å¼æ•è·æ—¶ï¼Œæ•è·åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ª&amp;æˆ–&#x3D;ã€‚æ­¤ç¬¦å·æŒ‡å®šäº†é»˜è®¤æ•è·æ–¹å¼ä¸ºå¼•ç”¨æˆ–å€¼ã€‚</p><p>å½“æ··åˆä½¿ç”¨éšå¼æ•è·å’Œæ˜¾å¼æ•è·æ—¶ï¼Œæ˜¾å¼æ•è·çš„å˜é‡å¿…é¡»ä½¿ç”¨ä¸éšå¼æ•è·ä¸åŒçš„æ–¹å¼ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726231713032.png"></p><p><strong>å¯å˜lambda</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€ä¸ªå€¼è¢«æ‹·è´çš„å˜é‡ï¼Œlambdaä¸ä¼šæ”¹å˜å…¶å€¼ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›èƒ½æ”¹å˜ä¸€ä¸ªè¢«æ•è·çš„å˜é‡çš„å€¼ï¼Œå°±å¿…é¡»åœ¨å‚æ•°åˆ—è¡¨é¦–åŠ ä¸Šå…³é”®å­—mutableã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726231941506.png"></p><p>ä¸€ä¸ªå¼•ç”¨æ•è·çš„å˜é‡æ˜¯å¦ï¼ˆå¦‚å¾€å¸¸ä¸€æ ·ï¼‰å¯ä»¥ä¿®æ”¹ä¾èµ–äºæ­¤å¼•ç”¨æŒ‡å‘çš„æ˜¯ä¸€ä¸ªconstç±»å‹è¿˜æ˜¯ä¸€ä¸ªéconstç±»å‹</p><p><img src="/../images/C-C-Primer-Chapter-10/1726231959765.png"></p><p><strong>æŒ‡å®šlambdaè¿”å›ç±»å‹</strong></p><p>å‡½æ•°transformæ¥å—ä¸‰ä¸ªè¿­ä»£å™¨å’Œä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ã€‚å‰ä¸¤ä¸ªè¿­ä»£å™¨è¡¨ç¤ºè¾“å…¥åºåˆ—ï¼Œç¬¬ä¸‰ä¸ªè¿­ä»£å™¨è¡¨ç¤ºç›®çš„ä½ç½®ã€‚ç®—æ³•å¯¹è¾“å…¥åºåˆ—ä¸­æ¯ä¸ªå…ƒç´ è°ƒç”¨å¯è°ƒç”¨å¯¹è±¡ï¼Œå¹¶å°†ç»“æœå†™åˆ°ç›®çš„ä½ç½®ã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦ä¸ºä¸€ä¸ªlambdaå®šä¹‰è¿”å›ç±»å‹æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å°¾ç½®è¿”å›ç±»å‹ï¼ˆå‚è§6.3.3èŠ‚ï¼Œç¬¬206é¡µï¼‰</p><p><img src="/../images/C-C-Primer-Chapter-10/1726232047309.png"></p><h3 id="10-3-4-å‚æ•°ç»‘å®š"><a href="#10-3-4-å‚æ•°ç»‘å®š" class="headerlink" title="10.3.4 å‚æ•°ç»‘å®š"></a>10.3.4 å‚æ•°ç»‘å®š</h3><p>å¦‚æœlambdaçš„æ•è·åˆ—è¡¨ä¸ºç©ºï¼Œé€šå¸¸å¯ä»¥ç”¨å‡½æ•°æ¥ä»£æ›¿å®ƒã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºæ•è·å±€éƒ¨å˜é‡çš„lambdaï¼Œç”¨å‡½æ•°æ¥æ›¿æ¢å®ƒå°±ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“äº†ã€‚</p><p><strong>æ ‡å‡†åº“bindå‡½æ•°</strong></p><p>æˆ‘ä»¬å¯ä»¥è§£å†³å‘check_sizeä¼ é€’ä¸€ä¸ªé•¿åº¦å‚æ•°çš„é—®é¢˜ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„åä¸ºbindçš„æ ‡å‡†åº“å‡½æ•°ï¼Œå®ƒå®šä¹‰åœ¨å¤´æ–‡ä»¶functionalä¸­ã€‚å¯ä»¥å°†bindå‡½æ•°çœ‹ä½œä¸€ä¸ªé€šç”¨çš„å‡½æ•°é€‚é…å™¨ï¼ˆå‚è§9.6èŠ‚ï¼Œç¬¬329é¡µï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡æ¥â€œé€‚åº”â€åŸå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726233370917.png"></p><p>newCallableæœ¬èº«æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œarg_listæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ï¼Œå¯¹åº”ç»™å®šçš„callableçš„å‚æ•°ã€‚å³ï¼Œå½“æˆ‘ä»¬è°ƒç”¨newCallableæ—¶ï¼ŒnewCallableä¼šè°ƒç”¨callableï¼Œå¹¶ä¼ é€’ç»™å®ƒarg_listä¸­çš„å‚æ•°ã€‚</p><p>arg_listä¸­çš„å‚æ•°å¯èƒ½åŒ…å«å½¢å¦‚_nçš„åå­—ï¼Œå…¶ä¸­næ˜¯ä¸€ä¸ªæ•´æ•°ã€‚è¿™äº›å‚æ•°æ˜¯â€œå ä½ç¬¦â€ï¼Œè¡¨ç¤ºnewCallableçš„å‚æ•°ï¼Œå®ƒä»¬å æ®äº†ä¼ é€’ç»™newCallableçš„å‚æ•°çš„â€œä½ç½®â€ã€‚æ•°å€¼nè¡¨ç¤ºç”Ÿæˆçš„å¯è°ƒç”¨å¯¹è±¡ä¸­å‚æ•°çš„ä½ç½®ï¼š_1ä¸ºnewCallableçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ_2ä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726233503447.png"></p><p>æ­¤bindè°ƒç”¨åªæœ‰ä¸€ä¸ªå ä½ç¬¦ï¼Œè¡¨ç¤ºcheck6åªæ¥å—å•ä¸€å‚æ•°ã€‚å ä½ç¬¦å‡ºç°åœ¨arg_listçš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œè¡¨ç¤ºcheck6çš„æ­¤å‚æ•°å¯¹åº”check_sizeçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚æ­¤å‚æ•°æ˜¯ä¸€ä¸ªconst string&amp;ã€‚å› æ­¤ï¼Œè°ƒç”¨check6å¿…é¡»ä¼ é€’ç»™å®ƒä¸€ä¸ªstringç±»å‹çš„å‚æ•°ï¼Œcheck6ä¼šå°†æ­¤å‚æ•°ä¼ é€’ç»™check_sizeã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726233561900.png"></p><p><strong>ä½¿ç”¨placeholdersåå­—</strong></p><p>åå­—_néƒ½å®šä¹‰åœ¨ä¸€ä¸ªåä¸ºplaceholdersçš„å‘½åç©ºé—´ä¸­ï¼Œè€Œè¿™ä¸ªå‘½åç©ºé—´æœ¬èº«å®šä¹‰åœ¨stdå‘½åç©ºé—´ï¼ˆå‚è§3.1èŠ‚ï¼Œç¬¬74é¡µï¼‰ä¸­ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›åå­—ï¼Œä¸¤ä¸ªå‘½åç©ºé—´éƒ½è¦å†™ä¸Šã€‚</p><p><strong>bindçš„å‚æ•°</strong></p><p>æˆ‘ä»¬å¯ä»¥ç”¨bindä¿®æ­£å‚æ•°çš„å€¼ã€‚æ›´ä¸€èˆ¬çš„ï¼Œå¯ä»¥ç”¨bindç»‘å®šç»™å®šå¯è°ƒç”¨å¯¹è±¡ä¸­çš„å‚æ•°æˆ–é‡æ–°å®‰æ’å…¶é¡ºåºã€‚</p><p>ä¾‹å¦‚ï¼Œå‡å®šfæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒæœ‰5ä¸ªå‚æ•°ï¼Œåˆ™ä¸‹é¢å¯¹bindçš„è°ƒç”¨</p><p><img src="/../images/C-C-Primer-Chapter-10/1726233710338.png"></p><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ç”¨å ä½ç¬¦_2å’Œ_1è¡¨ç¤ºã€‚è¿™ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡å°†å®ƒè‡ªå·±çš„å‚æ•°ä½œä¸ºç¬¬ä¸‰ä¸ªå’Œç¬¬äº”ä¸ªå‚æ•°ä¼ é€’ç»™fã€‚fçš„ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªå’Œç¬¬å››ä¸ªå‚æ•°åˆ†åˆ«è¢«ç»‘å®šåˆ°ç»™å®šçš„å€¼aã€bå’Œcä¸Šã€‚ä¼ é€’ç»™gçš„å‚æ•°æŒ‰ä½ç½®ç»‘å®šåˆ°å ä½ç¬¦ã€‚å³ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç»‘å®šåˆ°_1ï¼Œç¬¬äºŒä¸ªå‚æ•°ç»‘å®šåˆ°_2ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è°ƒç”¨gæ—¶ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°å°†è¢«ä¼ é€’ç»™fä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å°†è¢«ä¼ é€’ç»™fä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p><p><strong>ç”¨bindé‡æ’å‚æ•°é¡ºåº</strong></p><p><strong>ç»‘å®šå¼•ç”¨å‚æ•°</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œbindçš„é‚£äº›ä¸æ˜¯å ä½ç¬¦çš„å‚æ•°è¢«æ‹·è´åˆ°bindè¿”å›çš„å¯è°ƒç”¨å¯¹è±¡ä¸­ã€‚ä½†æ˜¯ï¼Œä¸lambdaç±»ä¼¼ï¼Œæœ‰æ—¶å¯¹æœ‰äº›ç»‘å®šçš„å‚æ•°æˆ‘ä»¬å¸Œæœ›ä»¥å¼•ç”¨æ–¹å¼ä¼ é€’ï¼Œæˆ–æ˜¯è¦ç»‘å®šå‚æ•°çš„ç±»å‹æ— æ³•æ‹·è´ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¼ é€’ç»™bindä¸€ä¸ªå¯¹è±¡è€Œåˆä¸æ‹·è´å®ƒï¼Œå°±<strong>å¿…é¡»ä½¿ç”¨æ ‡å‡†åº“refå‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-10/1726233958032.png"></p><p>å‡½æ•°refè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç»™å®šçš„å¼•ç”¨ï¼Œæ­¤å¯¹è±¡æ˜¯å¯ä»¥æ‹·è´çš„ã€‚æ ‡å‡†åº“ä¸­è¿˜æœ‰ä¸€ä¸ªcrefå‡½æ•°ï¼Œç”Ÿæˆä¸€ä¸ªä¿å­˜constå¼•ç”¨çš„ç±»ã€‚ä¸bindä¸€æ ·ï¼Œå‡½æ•°refå’Œcrefä¹Ÿå®šä¹‰åœ¨å¤´æ–‡ä»¶functionalä¸­ã€‚</p><h2 id="10-4-å†æ¢è¿­ä»£å™¨"><a href="#10-4-å†æ¢è¿­ä»£å™¨" class="headerlink" title="10.4 å†æ¢è¿­ä»£å™¨"></a>10.4 å†æ¢è¿­ä»£å™¨</h2><p>é™¤äº†ä¸ºæ¯ä¸ªå®¹å™¨å®šä¹‰çš„è¿­ä»£å™¨ä¹‹å¤–ï¼Œæ ‡å‡†åº“åœ¨å¤´æ–‡ä»¶iteratorä¸­è¿˜å®šä¹‰äº†é¢å¤–å‡ ç§è¿­ä»£å™¨ã€‚è¿™äº›è¿­ä»£å™¨åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ã€‚</p><ul><li>æ’å…¥è¿­ä»£å™¨ï¼ˆinsert iteratorï¼‰ï¼šè¿™äº›è¿­ä»£å™¨è¢«ç»‘å®šåˆ°ä¸€ä¸ªå®¹å™¨ä¸Šï¼Œå¯ç”¨æ¥å‘å®¹å™¨æ’å…¥å…ƒç´ ã€‚</li><li>æµè¿­ä»£å™¨ï¼ˆstream iteratorï¼‰ï¼šè¿™äº›è¿­ä»£å™¨è¢«ç»‘å®šåˆ°è¾“å…¥æˆ–è¾“å‡ºæµä¸Šï¼Œå¯ç”¨æ¥éå†æ‰€å…³è”çš„IOæµã€‚</li><li>åå‘è¿­ä»£å™¨ï¼ˆreverse iteratorï¼‰ï¼šè¿™äº›è¿­ä»£å™¨å‘åè€Œä¸æ˜¯å‘å‰ç§»åŠ¨ã€‚é™¤äº†forward_listä¹‹å¤–çš„æ ‡å‡†åº“å®¹å™¨éƒ½æœ‰åå‘è¿­ä»£å™¨ã€‚</li><li>ç§»åŠ¨è¿­ä»£å™¨ï¼ˆmove iteratorï¼‰ï¼šè¿™äº›ä¸“ç”¨çš„è¿­ä»£å™¨ä¸æ˜¯æ‹·è´å…¶ä¸­çš„å…ƒç´ ï¼Œè€Œæ˜¯ç§»åŠ¨å®ƒä»¬ã€‚æˆ‘ä»¬å°†åœ¨13.6.2èŠ‚ï¼ˆç¬¬480é¡µï¼‰ä»‹ç»ç§»åŠ¨è¿­ä»£å™¨ã€‚</li></ul><h3 id="10-4-1-æ’å…¥è¿­ä»£å™¨"><a href="#10-4-1-æ’å…¥è¿­ä»£å™¨" class="headerlink" title="10.4.1 æ’å…¥è¿­ä»£å™¨"></a>10.4.1 æ’å…¥è¿­ä»£å™¨</h3><p>æ’å…¥å™¨æ˜¯ä¸€ç§è¿­ä»£å™¨é€‚é…å™¨ï¼ˆå‚è§9.6èŠ‚ï¼Œç¬¬329é¡µï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå®¹å™¨ï¼Œç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œèƒ½å®ç°å‘ç»™å®šå®¹å™¨æ·»åŠ å…ƒç´ ã€‚å½“æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ’å…¥è¿­ä»£å™¨è¿›è¡Œèµ‹å€¼æ—¶ï¼Œè¯¥è¿­ä»£å™¨è°ƒç”¨å®¹å™¨æ“ä½œæ¥å‘ç»™å®šå®¹å™¨çš„æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234353465.png"></p><p>æ’å…¥å™¨æœ‰ä¸‰ç§ç±»å‹ï¼Œå·®å¼‚åœ¨äºå…ƒç´ æ’å…¥çš„ä½ç½®ï¼š</p><ul><li>back_inserterï¼ˆå‚è§10.2.2èŠ‚ï¼Œç¬¬341é¡µï¼‰åˆ›å»ºä¸€ä¸ªä½¿ç”¨push_backçš„è¿­ä»£å™¨</li><li>front_inserteråˆ›å»ºä¸€ä¸ªä½¿ç”¨push_frontçš„è¿­ä»£å™¨ã€‚</li><li>inserteråˆ›å»ºä¸€ä¸ªä½¿ç”¨insertçš„è¿­ä»£å™¨ã€‚æ­¤å‡½æ•°æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªæŒ‡å‘ç»™å®šå®¹å™¨çš„è¿­ä»£å™¨ã€‚å…ƒç´ å°†è¢«æ’å…¥åˆ°ç»™å®šè¿­ä»£å™¨æ‰€è¡¨ç¤ºçš„å…ƒç´ ä¹‹å‰ã€‚</li></ul><blockquote><p>åªæœ‰åœ¨å®¹å™¨æ”¯æŒpush_frontçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨front_inserterã€‚ç±»ä¼¼çš„ï¼Œåªæœ‰åœ¨å®¹å™¨æ”¯æŒpush_backçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨back_inserterã€‚</p></blockquote><p>å½“è°ƒç”¨inserterï¼ˆcï¼Œiterï¼‰æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨å®ƒæ—¶ï¼Œä¼šå°†å…ƒç´ æ’å…¥åˆ°iteråŸæ¥æ‰€æŒ‡å‘çš„å…ƒç´ ä¹‹å‰çš„ä½ç½®ã€‚å³ï¼Œå¦‚æœitæ˜¯ç”±inserterç”Ÿæˆçš„è¿­ä»£å™¨ï¼Œåˆ™ä¸‹é¢è¿™æ ·çš„èµ‹å€¼è¯­å¥</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234467621.png"></p><p>å…¶æ•ˆæœä¸ä¸‹é¢ä»£ç ä¸€æ ·</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234477582.png"></p><p>front_inserterç”Ÿæˆçš„è¿­ä»£å™¨çš„è¡Œä¸ºä¸inserterç”Ÿæˆçš„è¿­ä»£å™¨å®Œå…¨ä¸ä¸€æ ·ã€‚å½“æˆ‘ä»¬ä½¿ç”¨front_inserteræ—¶ï¼Œå…ƒç´ æ€»æ˜¯æ’å…¥åˆ°å®¹å™¨ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234621651.png"></p><h3 id="10-4-2-iostreamè¿­ä»£å™¨"><a href="#10-4-2-iostreamè¿­ä»£å™¨" class="headerlink" title="10.4.2 iostreamè¿­ä»£å™¨"></a>10.4.2 iostreamè¿­ä»£å™¨</h3><p>istream_iteratorï¼ˆå‚è§è¡¨10.3ï¼‰è¯»å–è¾“å…¥æµï¼Œostream_iteratorï¼ˆå‚è§è¡¨10.4èŠ‚ï¼Œç¬¬361é¡µï¼‰å‘ä¸€ä¸ªè¾“å‡ºæµå†™æ•°æ®ã€‚è¿™äº›è¿­ä»£å™¨å°†å®ƒä»¬å¯¹åº”çš„æµå½“ä½œä¸€ä¸ªç‰¹å®šç±»å‹çš„å…ƒç´ åºåˆ—æ¥å¤„ç†ã€‚é€šè¿‡ä½¿ç”¨æµè¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ³›å‹ç®—æ³•ä»æµå¯¹è±¡è¯»å–æ•°æ®ä»¥åŠå‘å…¶å†™å…¥æ•°æ®ã€‚</p><p><strong>istream_iteratoræ“ä½œ</strong></p><p>å½“åˆ›å»ºä¸€ä¸ªæµè¿­ä»£å™¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šè¿­ä»£å™¨å°†è¦è¯»å†™çš„å¯¹è±¡ç±»å‹ã€‚</p><p>ä¸€ä¸ªistream_iteratorä½¿ç”¨&gt;&gt;æ¥è¯»å–æµã€‚å› æ­¤ï¼Œistream_iteratorè¦è¯»å–çš„ç±»å‹å¿…é¡»å®šä¹‰äº†è¾“å…¥è¿ç®—ç¬¦ã€‚å½“åˆ›å»ºä¸€ä¸ªistream_iteratoræ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒç»‘å®šåˆ°ä¸€ä¸ªæµã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é»˜è®¤åˆå§‹åŒ–è¿­ä»£å™¨ï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªå¯ä»¥å½“ä½œå°¾åå€¼ä½¿ç”¨çš„è¿­ä»£å™¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234818281.png"></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨istream_iteratorä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œå­˜å…¥ä¸€ä¸ªvectorçš„ä¾‹å­ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234827719.png"></p><p>æ­¤å¾ªç¯ä»cinè¯»å–intå€¼ï¼Œä¿å­˜åœ¨vecä¸­ã€‚åœ¨æ¯ä¸ªå¾ªç¯æ­¥ä¸­ï¼Œå¾ªç¯ä½“ä»£ç æ£€æŸ¥in_iteræ˜¯å¦ç­‰äºeofã€‚eofè¢«å®šä¹‰ä¸ºç©ºçš„istream_iteratorï¼Œä»è€Œå¯ä»¥å½“ä½œå°¾åè¿­ä»£å™¨æ¥ä½¿ç”¨ã€‚å¯¹äºä¸€ä¸ªç»‘å®šåˆ°æµçš„è¿­ä»£å™¨ï¼Œä¸€æ—¦å…¶å…³è”çš„æµé‡åˆ°æ–‡ä»¶å°¾æˆ–é‡åˆ°IOé”™è¯¯ï¼Œè¿­ä»£å™¨çš„å€¼å°±ä¸å°¾åè¿­ä»£å™¨ç›¸ç­‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†ç¨‹åºé‡å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼Œè¿™ä½“ç°äº†istream_iteratoræ›´æœ‰ç”¨çš„åœ°æ–¹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234885880.png"></p><p>è¿™ä¸ªæ„é€ å‡½æ•°ä»cinä¸­è¯»å–æ•°æ®ï¼Œç›´è‡³é‡åˆ°æ–‡ä»¶å°¾æˆ–è€…é‡åˆ°ä¸€ä¸ªä¸æ˜¯intçš„æ•°æ®ä¸ºæ­¢ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726234931737.png"></p><p><strong>ä½¿ç”¨ç®—æ³•æ“ä½œæµè¿­ä»£å™¨</strong></p><p>ç”±äºç®—æ³•ä½¿ç”¨è¿­ä»£å™¨æ“ä½œæ¥å¤„ç†æ•°æ®ï¼Œè€Œæµè¿­ä»£å™¨åˆè‡³å°‘æ”¯æŒæŸäº›è¿­ä»£å™¨æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬è‡³å°‘å¯ä»¥ç”¨æŸäº›ç®—æ³•æ¥æ“ä½œæµè¿­ä»£å™¨ã€‚æˆ‘ä»¬åœ¨10.5.1èŠ‚ï¼ˆç¬¬365é¡µï¼‰ä¼šçœ‹åˆ°å¦‚ä½•åˆ†è¾¨å“ªäº›ç®—æ³•å¯ä»¥ç”¨äºæµè¿­ä»£å™¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726300333345.png"></p><p><strong>istream_iteratorå…è®¸ä½¿ç”¨æ‡’æƒ°æ±‚å€¼</strong></p><p>å½“æˆ‘ä»¬å°†ä¸€ä¸ªistream_iteratorç»‘å®šåˆ°ä¸€ä¸ªæµæ—¶ï¼Œæ ‡å‡†åº“å¹¶ä¸ä¿è¯è¿­ä»£å™¨ç«‹å³ä»æµè¯»å–æ•°æ®ã€‚å…·ä½“å®ç°å¯ä»¥æ¨è¿Ÿä»æµä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨æ—¶æ‰çœŸæ­£è¯»å–ã€‚æ ‡å‡†åº“ä¸­çš„å®ç°æ‰€ä¿è¯çš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡è§£å¼•ç”¨è¿­ä»£å™¨ä¹‹å‰ï¼Œä»æµä¸­è¯»å–æ•°æ®çš„æ“ä½œå·²ç»å®Œæˆäº†ã€‚å¯¹äºå¤§å¤šæ•°ç¨‹åºæ¥è¯´ï¼Œç«‹å³è¯»å–è¿˜æ˜¯æ¨è¿Ÿè¯»å–æ²¡ä»€ä¹ˆå·®åˆ«ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªistream_iteratorï¼Œæ²¡æœ‰ä½¿ç”¨å°±é”€æ¯äº†ï¼Œæˆ–è€…æˆ‘ä»¬æ­£åœ¨ä»ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡åŒæ­¥è¯»å–åŒä¸€ä¸ªæµï¼Œé‚£ä¹ˆä½•æ—¶è¯»å–å¯èƒ½å°±å¾ˆé‡è¦äº†ã€‚</p><p><strong>ostream_iteratoræ“ä½œ</strong></p><p>æˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å…·æœ‰è¾“å‡ºè¿ç®—ç¬¦ï¼ˆ&lt;&lt;è¿ç®—ç¬¦ï¼‰çš„ç±»å‹å®šä¹‰ostream_iteratorã€‚å½“åˆ›å»ºä¸€ä¸ªostream_iteratoræ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ï¼ˆå¯é€‰çš„ï¼‰ç¬¬äºŒå‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨è¾“å‡ºæ¯ä¸ªå…ƒç´ åéƒ½ä¼šæ‰“å°æ­¤å­—ç¬¦ä¸²ã€‚æ­¤å­—ç¬¦ä¸²å¿…é¡»æ˜¯ä¸€ä¸ªCé£æ ¼å­—ç¬¦ä¸²ï¼ˆå³ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å¸¸é‡æˆ–è€…ä¸€ä¸ªæŒ‡å‘ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼‰ã€‚å¿…é¡»å°†ostream_iteratorç»‘å®šåˆ°ä¸€ä¸ªæŒ‡å®šçš„æµï¼Œä¸å…è®¸ç©ºçš„æˆ–è¡¨ç¤ºå°¾åä½ç½®çš„ostream_iteratorã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726300458868.png"></p><p><img src="/../images/C-C-Primer-Chapter-10/1726300619260.png"></p><p>out_iter++å®é™…ä¸å¯¹è¿­ä»£å™¨åšä»»ä½•æ“ä½œï¼Œä½†è¿˜æ˜¯æ¨èç¬¬ä¸€ç§å½¢å¼ã€‚åœ¨è¿™ç§å†™æ³•ä¸­ï¼Œæµè¿­ä»£å™¨çš„ä½¿ç”¨ä¸å…¶ä»–è¿­ä»£å™¨çš„ä½¿ç”¨ä¿æŒä¸€è‡´ã€‚å¦‚æœæƒ³å°†æ­¤å¾ªç¯æ”¹ä¸ºæ“ä½œå…¶ä»–è¿­ä»£å™¨ç±»å‹ï¼Œä¿®æ”¹èµ·æ¥éå¸¸å®¹æ˜“ã€‚è€Œä¸”ï¼Œå¯¹äºè¯»è€…æ¥è¯´ï¼Œæ­¤å¾ªç¯çš„è¡Œä¸ºä¹Ÿæ›´ä¸ºæ¸…æ™°ã€‚</p><p>å¯ä»¥é€šè¿‡è°ƒç”¨copyæ¥æ‰“å°vecä¸­çš„å…ƒç´ ï¼Œè¿™æ¯”ç¼–å†™å¾ªç¯æ›´ä¸ºç®€å•</p><p><img src="/../images/C-C-Primer-Chapter-10/1726300802026.png"></p><p><strong>ä½¿ç”¨æµè¿­ä»£å™¨å¤„ç†ç±»ç±»å‹</strong></p><h3 id="10-4-3-åå‘è¿­ä»£å™¨"><a href="#10-4-3-åå‘è¿­ä»£å™¨" class="headerlink" title="10.4.3 åå‘è¿­ä»£å™¨"></a>10.4.3 åå‘è¿­ä»£å™¨</h3><p>åå‘è¿­ä»£å™¨å°±æ˜¯åœ¨å®¹å™¨ä¸­ä»å°¾å…ƒç´ å‘é¦–å…ƒç´ åå‘ç§»åŠ¨çš„è¿­ä»£å™¨ã€‚å¯¹äºåå‘è¿­ä»£å™¨ï¼Œé€’å¢ï¼ˆä»¥åŠé€’å‡ï¼‰æ“ä½œçš„å«ä¹‰ä¼šé¢ å€’è¿‡æ¥ã€‚é€’å¢ä¸€ä¸ªåå‘è¿­ä»£å™¨ï¼ˆ++itï¼‰ä¼šç§»åŠ¨åˆ°å‰ä¸€ä¸ªå…ƒç´ ï¼›é€’å‡ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆâ€“itï¼‰ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p><p>é™¤äº†forward_listä¹‹å¤–ï¼Œå…¶ä»–å®¹å™¨éƒ½æ”¯æŒåå‘è¿­ä»£å™¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨rbeginã€rendã€crbeginå’Œcrendæˆå‘˜å‡½æ•°æ¥è·å¾—åå‘è¿­ä»£å™¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726302994585.png"></p><p>è™½ç„¶é¢ å€’é€’å¢å’Œé€’å‡è¿ç®—ç¬¦çš„å«ä¹‰å¯èƒ½çœ‹èµ·æ¥ä»¤äººæ··æ·†ï¼Œä½†è¿™æ ·åšä½¿æˆ‘ä»¬å¯ä»¥ç”¨ç®—æ³•é€æ˜åœ°å‘å‰æˆ–å‘åå¤„ç†å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡å‘sortä¼ é€’ä¸€å¯¹åå‘è¿­ä»£å™¨æ¥å°†vectoræ•´ç†ä¸ºé€’å‡åºï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726303038287.png"></p><p><strong>åå‘è¿­ä»£å™¨éœ€è¦é€’å‡è¿ç®—ç¬¦</strong></p><p>æµè¿­ä»£å™¨ä¸æ”¯æŒé€’å‡è¿ç®—ï¼Œå› ä¸ºä¸å¯èƒ½åœ¨ä¸€ä¸ªæµä¸­åå‘ç§»åŠ¨ã€‚å› æ­¤ï¼Œä¸å¯èƒ½ä»ä¸€ä¸ªforward_listæˆ–ä¸€ä¸ªæµè¿­ä»£å™¨åˆ›å»ºåå‘è¿­ä»£å™¨ã€‚</p><p><strong>åå‘è¿­ä»£å™¨å’Œå…¶ä»–è¿­ä»£å™¨é—´çš„å…³ç³»</strong></p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åå‘è¿­ä»£å™¨ï¼Œä¼šåå‘å¤„ç†stringã€‚å› æ­¤ï¼Œä¸Šè¿°è¾“å‡ºè¯­å¥ä»crbeginå¼€å§‹åå‘æ‰“å°lineä¸­å†…å®¹ã€‚è€Œæˆ‘ä»¬å¸Œæœ›æŒ‰æ­£å¸¸é¡ºåºæ‰“å°ä»rcommaå¼€å§‹åˆ°lineæœ«å°¾é—´çš„å­—ç¬¦ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨rcommaã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåå‘è¿­ä»£å™¨ï¼Œæ„å‘³ç€å®ƒä¼šåå‘æœç€stringçš„å¼€å§‹ä½ç½®ç§»åŠ¨ã€‚éœ€è¦åšçš„æ˜¯ï¼Œå°†rcommaè½¬æ¢å›ä¸€ä¸ªæ™®é€šè¿­ä»£å™¨ï¼Œèƒ½åœ¨lineä¸­æ­£å‘ç§»åŠ¨ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨reverse_iteratorçš„baseæˆå‘˜å‡½æ•°æ¥å®Œæˆè¿™ä¸€è½¬æ¢ï¼Œæ­¤æˆå‘˜å‡½æ•°ä¼šè¿”å›å…¶å¯¹åº”çš„æ™®é€šè¿­ä»£å™¨ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726303307514.png"></p><p><img src="/../images/C-C-Primer-Chapter-10/1726303318130.png" alt="1726303318130"></p><h2 id="10-5-æ³›å‹ç®—æ³•ç»“æ„"><a href="#10-5-æ³›å‹ç®—æ³•ç»“æ„" class="headerlink" title="10.5 æ³›å‹ç®—æ³•ç»“æ„"></a>10.5 æ³›å‹ç®—æ³•ç»“æ„</h2><p>ä»»ä½•ç®—æ³•çš„æœ€åŸºæœ¬çš„ç‰¹æ€§æ˜¯å®ƒè¦æ±‚å…¶è¿­ä»£å™¨æä¾›å“ªäº›æ“ä½œã€‚æŸäº›ç®—æ³•ï¼Œå¦‚findï¼Œåªè¦æ±‚é€šè¿‡è¿­ä»£å™¨è®¿é—®å…ƒç´ ã€é€’å¢è¿­ä»£å™¨ä»¥åŠæ¯”è¾ƒä¸¤ä¸ªè¿­ä»£å™¨æ˜¯å¦ç›¸ç­‰è¿™äº›èƒ½åŠ›ã€‚å…¶ä»–ä¸€äº›ç®—æ³•ï¼Œå¦‚sortï¼Œè¿˜è¦æ±‚è¯»ã€å†™å’Œéšæœºè®¿é—®å…ƒç´ çš„èƒ½åŠ›ã€‚ç®—æ³•æ‰€è¦æ±‚çš„è¿­ä»£å™¨æ“ä½œå¯ä»¥åˆ†ä¸º5ä¸ªè¿­ä»£å™¨ç±»åˆ«ï¼ˆiterator categoryï¼‰ï¼Œå¦‚è¡¨10.5æ‰€ç¤ºã€‚æ¯ä¸ªç®—æ³•éƒ½ä¼šå¯¹å®ƒçš„æ¯ä¸ªè¿­ä»£å™¨å‚æ•°æŒ‡æ˜é¡»æä¾›å“ªç±»è¿­ä»£å™¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726303617577.png"></p><p>ç¬¬äºŒç§ç®—æ³•åˆ†ç±»çš„æ–¹å¼ï¼ˆå¦‚æˆ‘ä»¬åœ¨æœ¬ç« å¼€å§‹æ‰€åšçš„ï¼‰æ˜¯æŒ‰ç…§æ˜¯å¦è¯»ã€å†™æˆ–æ˜¯é‡æ’åºåˆ—ä¸­çš„å…ƒç´ æ¥åˆ†ç±»ã€‚é™„å½•AæŒ‰è¿™ç§åˆ†ç±»æ–¹æ³•åˆ—å‡ºäº†æ‰€æœ‰ç®—æ³•ã€‚</p><h3 id="10-5-1-5ç±»è¿­ä»£å™¨"><a href="#10-5-1-5ç±»è¿­ä»£å™¨" class="headerlink" title="10.5.1 5ç±»è¿­ä»£å™¨"></a>10.5.1 5ç±»è¿­ä»£å™¨</h3><p><strong>è¿­ä»£å™¨ç±»åˆ«</strong></p><p>1.è¾“å…¥è¿­ä»£å™¨ï¼ˆinput iteratorï¼‰ï¼šå¯ä»¥è¯»å–åºåˆ—ä¸­çš„å…ƒç´ ã€‚</p><p>ä¸€ä¸ªè¾“å…¥è¿­ä»£å™¨å¿…é¡»æ”¯æŒ:</p><ul><li>ç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¿­ä»£å™¨çš„ç›¸ç­‰å’Œä¸ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ&#x3D;&#x3D;ã€ï¼&#x3D;ï¼‰</li><li>ç”¨äºæ¨è¿›è¿­ä»£å™¨çš„å‰ç½®å’Œåç½®é€’å¢è¿ç®—ï¼ˆ++ï¼‰</li><li>ç”¨äºè¯»å–å…ƒç´ çš„è§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ*ï¼‰ï¼›è§£å¼•ç”¨åªä¼šå‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„å³ä¾§</li><li>ç®­å¤´è¿ç®—ç¬¦ï¼ˆ-&gt;ï¼‰ï¼Œç­‰ä»·äºï¼ˆ*itï¼‰.memberï¼Œå³ï¼Œè§£å¼•ç”¨è¿­ä»£å™¨ï¼Œå¹¶æå–å¯¹è±¡çš„æˆå‘˜</li></ul><p>è¾“å…¥è¿­ä»£å™¨åªç”¨äºé¡ºåºè®¿é—®ã€‚å¯¹äºä¸€ä¸ªè¾“å…¥è¿­ä»£å™¨ï¼Œ*it++ä¿è¯æ˜¯æœ‰æ•ˆçš„ï¼Œä½†é€’å¢å®ƒå¯èƒ½å¯¼è‡´æ‰€æœ‰å…¶ä»–æŒ‡å‘æµçš„è¿­ä»£å™¨å¤±æ•ˆã€‚å…¶ç»“æœå°±æ˜¯ï¼Œä¸èƒ½ä¿è¯è¾“å…¥è¿­ä»£å™¨çš„çŠ¶æ€å¯ä»¥ä¿å­˜ä¸‹æ¥å¹¶ç”¨æ¥è®¿é—®å…ƒç´ ã€‚å› æ­¤ï¼Œè¾“å…¥è¿­ä»£å™¨åªèƒ½ç”¨äºå•éæ‰«æç®—æ³•ã€‚ç®—æ³•findå’Œaccumulateè¦æ±‚è¾“å…¥è¿­ä»£å™¨ï¼›è€Œistream_iteratoræ˜¯ä¸€ç§è¾“å…¥è¿­ä»£å™¨ã€‚</p><p>2.è¾“å‡ºè¿­ä»£å™¨ï¼ˆoutput iteratorï¼‰ï¼šå¯ä»¥çœ‹ä½œè¾“å…¥è¿­ä»£å™¨åŠŸèƒ½ä¸Šçš„è¡¥é›†â€”â€”åªå†™è€Œä¸è¯»å…ƒç´ ã€‚</p><p>è¾“å‡ºè¿­ä»£å™¨å¿…é¡»æ”¯æŒ</p><ul><li>ç”¨äºæ¨è¿›è¿­ä»£å™¨çš„å‰ç½®å’Œåç½®é€’å¢è¿ç®—ï¼ˆ++ï¼‰</li><li>è§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ*ï¼‰ï¼Œåªå‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„å·¦ä¾§ï¼ˆå‘ä¸€ä¸ªå·²ç»è§£å¼•ç”¨çš„è¾“å‡ºè¿­ä»£å™¨èµ‹å€¼ï¼Œå°±æ˜¯å°†å€¼å†™å…¥å®ƒæ‰€æŒ‡å‘çš„å…ƒç´ ï¼‰</li></ul><p>æˆ‘ä»¬åªèƒ½å‘ä¸€ä¸ªè¾“å‡ºè¿­ä»£å™¨èµ‹å€¼ä¸€æ¬¡ã€‚ç±»ä¼¼è¾“å…¥è¿­ä»£å™¨ï¼Œè¾“å‡ºè¿­ä»£å™¨åªèƒ½ç”¨äºå•éæ‰«æç®—æ³•ã€‚ç”¨ä½œç›®çš„ä½ç½®çš„è¿­ä»£å™¨é€šå¸¸éƒ½æ˜¯è¾“å‡ºè¿­ä»£å™¨ã€‚ä¾‹å¦‚ï¼Œcopyå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯è¾“å‡ºè¿­ä»£å™¨ã€‚ostream_iteratorç±»å‹ä¹Ÿæ˜¯è¾“å‡ºè¿­ä»£å™¨ã€‚</p><p>3.å‰å‘è¿­ä»£å™¨ï¼ˆforward iteratorï¼‰ï¼šå¯ä»¥è¯»å†™å…ƒç´ ã€‚è¿™ç±»è¿­ä»£å™¨åªèƒ½åœ¨åºåˆ—ä¸­æ²¿ä¸€ä¸ªæ–¹å‘ç§»åŠ¨ã€‚å‰å‘è¿­ä»£å™¨æ”¯æŒæ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºè¿­ä»£å™¨çš„æ“ä½œï¼Œè€Œä¸”å¯ä»¥å¤šæ¬¡è¯»å†™åŒä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜å‰å‘è¿­ä»£å™¨çš„çŠ¶æ€ï¼Œä½¿ç”¨å‰å‘è¿­ä»£å™¨çš„ç®—æ³•å¯ä»¥å¯¹åºåˆ—è¿›è¡Œå¤šéæ‰«æã€‚ç®—æ³•replaceè¦æ±‚å‰å‘è¿­ä»£å™¨ï¼Œforward_listä¸Šçš„è¿­ä»£å™¨æ˜¯å‰å‘è¿­ä»£å™¨ã€‚</p><p>4.åŒå‘è¿­ä»£å™¨ï¼ˆbidirectional iteratorï¼‰ï¼šå¯ä»¥æ­£å‘&#x2F;åå‘è¯»å†™åºåˆ—ä¸­çš„å…ƒç´ ã€‚é™¤äº†æ”¯æŒæ‰€æœ‰å‰å‘è¿­ä»£å™¨çš„æ“ä½œä¹‹å¤–ï¼ŒåŒå‘è¿­ä»£å™¨è¿˜æ”¯æŒå‰ç½®å’Œåç½®é€’å‡è¿ç®—ç¬¦ï¼ˆâ€“ï¼‰ã€‚ç®—æ³•reverseè¦æ±‚åŒå‘è¿­ä»£å™¨ï¼Œé™¤äº†forward_listä¹‹å¤–ï¼Œå…¶ä»–æ ‡å‡†åº“éƒ½æä¾›ç¬¦åˆåŒå‘è¿­ä»£å™¨è¦æ±‚çš„è¿­ä»£å™¨ã€‚</p><p>5.éšæœºè®¿é—®è¿­ä»£å™¨ï¼ˆrandom-access iteratorï¼‰ï¼šæä¾›åœ¨å¸¸é‡æ—¶é—´å†…è®¿é—®åºåˆ—ä¸­ä»»æ„å…ƒç´ çš„èƒ½åŠ›ã€‚æ­¤ç±»è¿­ä»£å™¨æ”¯æŒåŒå‘è¿­ä»£å™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ­¤å¤–è¿˜æ”¯æŒè¡¨3.7ï¼ˆç¬¬99é¡µï¼‰ä¸­çš„æ“ä½œï¼š</p><ul><li>ç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¿­ä»£å™¨ç›¸å¯¹ä½ç½®çš„å…³ç³»è¿ç®—ç¬¦ï¼ˆ&lt;ã€&lt;&#x3D;ã€&gt;å’Œ&gt;&#x3D;ï¼‰</li><li>è¿­ä»£å™¨å’Œä¸€ä¸ªæ•´æ•°å€¼çš„åŠ å‡è¿ç®—ï¼ˆ+ã€+&#x3D;ã€-å’Œ-&#x3D;ï¼‰ï¼Œè®¡ç®—ç»“æœæ˜¯è¿­ä»£å™¨åœ¨åºåˆ—ä¸­å‰è¿›ï¼ˆæˆ–åé€€ï¼‰ç»™å®šæ•´æ•°ä¸ªå…ƒç´ åçš„ä½ç½®</li><li>ç”¨äºä¸¤ä¸ªè¿­ä»£å™¨ä¸Šçš„å‡æ³•è¿ç®—ç¬¦ï¼ˆ-ï¼‰ï¼Œå¾—åˆ°ä¸¤ä¸ªè¿­ä»£å™¨çš„è·ç¦»</li><li>ä¸‹æ ‡è¿ç®—ç¬¦ï¼ˆiter[n]ï¼‰ï¼Œä¸ï¼Šï¼ˆiter[n]ï¼‰ç­‰ä»·</li></ul><p>ç®—æ³•sortè¦æ±‚éšæœºè®¿é—®è¿­ä»£å™¨ã€‚arrayã€dequeã€stringå’Œvectorçš„è¿­ä»£å™¨éƒ½æ˜¯éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œç”¨äºè®¿é—®å†…ç½®æ•°ç»„å…ƒç´ çš„æŒ‡é’ˆä¹Ÿæ˜¯ã€‚</p><h3 id="10-5-2-ç®—æ³•å½¢å‚æ¨¡å¼"><a href="#10-5-2-ç®—æ³•å½¢å‚æ¨¡å¼" class="headerlink" title="10.5.2 ç®—æ³•å½¢å‚æ¨¡å¼"></a>10.5.2 ç®—æ³•å½¢å‚æ¨¡å¼</h3><p>å¤§å¤šæ•°ç®—æ³•å…·æœ‰å¦‚ä¸‹4ç§å½¢å¼ä¹‹ä¸€ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726307764902.png"></p><p><strong>æ¥å—å•ä¸ªç›®æ ‡è¿­ä»£å™¨çš„ç®—æ³•</strong></p><p>destå‚æ•°æ˜¯ä¸€ä¸ªè¡¨ç¤ºç®—æ³•å¯ä»¥å†™å…¥çš„ç›®çš„ä½ç½®çš„è¿­ä»£å™¨ã€‚ç®—æ³•å‡å®šï¼ˆassumeï¼‰ï¼šæŒ‰å…¶éœ€è¦å†™å…¥æ•°æ®ï¼Œä¸ç®¡å†™å…¥å¤šå°‘ä¸ªå…ƒç´ éƒ½æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>æ¥å—ç¬¬äºŒä¸ªè¾“å…¥åºåˆ—çš„ç®—æ³•</strong></p><p>æ¥å—å•ç‹¬çš„beg2æˆ–æ˜¯æ¥å—beg2å’Œend2çš„ç®—æ³•ç”¨è¿™äº›è¿­ä»£å™¨è¡¨ç¤ºç¬¬äºŒä¸ªè¾“å…¥èŒƒå›´ã€‚è¿™äº›ç®—æ³•é€šå¸¸ä½¿ç”¨ç¬¬äºŒä¸ªèŒƒå›´ä¸­çš„å…ƒç´ ä¸ç¬¬ä¸€ä¸ªè¾“å…¥èŒƒå›´ç»“åˆæ¥è¿›è¡Œä¸€äº›è¿ç®—ã€‚</p><h3 id="10-5-3-ç®—æ³•å‘½åè§„èŒƒ"><a href="#10-5-3-ç®—æ³•å‘½åè§„èŒƒ" class="headerlink" title="10.5.3 ç®—æ³•å‘½åè§„èŒƒ"></a>10.5.3 ç®—æ³•å‘½åè§„èŒƒ</h3><p>ç®—æ³•è¿˜éµå¾ªä¸€å¥—å‘½åå’Œé‡è½½è§„èŒƒã€‚è¿™äº›è§„èŒƒå¤„ç†è¯¸å¦‚ï¼šå¦‚ä½•æä¾›ä¸€ä¸ªæ“ä½œä»£æ›¿é»˜è®¤çš„&lt;æˆ–&#x3D;&#x3D;è¿ç®—ç¬¦ä»¥åŠç®—æ³•æ˜¯å°†è¾“å‡ºæ•°æ®å†™å…¥è¾“å…¥åºåˆ—è¿˜æ˜¯ä¸€ä¸ªåˆ†ç¦»çš„ç›®çš„ä½ç½®ç­‰é—®é¢˜ã€‚</p><p><strong>ä¸€äº›ç®—æ³•ä½¿ç”¨é‡è½½å½¢å¼ä¼ é€’ä¸€ä¸ªè°“è¯</strong></p><p>æ¥å—è°“è¯å‚æ•°æ¥ä»£æ›¿&lt;æˆ–&#x3D;&#x3D;è¿ç®—ç¬¦çš„ç®—æ³•ï¼Œä»¥åŠé‚£äº›ä¸æ¥å—é¢å¤–å‚æ•°çš„ç®—æ³•ï¼Œé€šå¸¸éƒ½æ˜¯é‡è½½çš„å‡½æ•°ã€‚å‡½æ•°çš„ä¸€ä¸ªç‰ˆæœ¬ç”¨å…ƒç´ ç±»å‹çš„è¿ç®—ç¬¦æ¥æ¯”è¾ƒå…ƒç´ ï¼›å¦ä¸€ä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªé¢å¤–è°“è¯å‚æ•°ï¼Œæ¥ä»£æ›¿&lt;æˆ–&#x3D;&#x3D;ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726307944623.png"></p><p><strong>_ifç‰ˆæœ¬çš„ç®—æ³•</strong></p><p>æ¥å—ä¸€ä¸ªå…ƒç´ å€¼çš„ç®—æ³•é€šå¸¸æœ‰å¦ä¸€ä¸ªä¸åŒåçš„ï¼ˆä¸æ˜¯é‡è½½çš„ï¼‰ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ¥å—ä¸€ä¸ªè°“è¯ï¼ˆå‚è§10.3.1èŠ‚ï¼Œç¬¬344é¡µï¼‰ä»£æ›¿å…ƒç´ å€¼ã€‚æ¥å—è°“è¯å‚æ•°çš„ç®—æ³•éƒ½æœ‰é™„åŠ çš„_ifå‰ç¼€ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726307986000.png"></p><p><strong>åŒºåˆ†æ‹·è´å…ƒç´ çš„ç‰ˆæœ¬å’Œä¸æ‹·è´çš„ç‰ˆæœ¬</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé‡æ’å…ƒç´ çš„ç®—æ³•å°†é‡æ’åçš„å…ƒç´ å†™å›ç»™å®šçš„è¾“å…¥åºåˆ—ä¸­ã€‚è¿™äº›ç®—æ³•è¿˜æä¾›å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œå°†å…ƒç´ å†™åˆ°ä¸€ä¸ªæŒ‡å®šçš„è¾“å‡ºç›®çš„ä½ç½®ã€‚å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå†™åˆ°é¢å¤–ç›®çš„ç©ºé—´çš„ç®—æ³•éƒ½åœ¨åå­—åé¢é™„åŠ ä¸€ä¸ª_copyï¼ˆå‚è§10.2.2èŠ‚ï¼Œç¬¬341é¡µï¼‰ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726308018039.png"></p><p>ä¸€äº›ç®—æ³•åŒæ—¶æä¾›_copyå’Œ_ifç‰ˆæœ¬ã€‚è¿™äº›ç‰ˆæœ¬æ¥å—ä¸€ä¸ªç›®çš„ä½ç½®è¿­ä»£å™¨å’Œä¸€ä¸ªè°“è¯ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-10/1726308043920.png"></p><h2 id="10-6-ç‰¹å®šå®¹å™¨ç®—æ³•"><a href="#10-6-ç‰¹å®šå®¹å™¨ç®—æ³•" class="headerlink" title="10.6 ç‰¹å®šå®¹å™¨ç®—æ³•"></a>10.6 ç‰¹å®šå®¹å™¨ç®—æ³•</h2><p>ä¸å…¶ä»–å®¹å™¨ä¸åŒï¼Œé“¾è¡¨ç±»å‹listå’Œforward_listå®šä¹‰äº†å‡ ä¸ªæˆå‘˜å‡½æ•°å½¢å¼çš„ç®—æ³•ï¼Œå¦‚è¡¨10.6æ‰€ç¤ºã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒä»¬å®šä¹‰äº†ç‹¬æœ‰çš„sortã€mergeã€removeã€reverseå’Œuniqueã€‚é€šç”¨ç‰ˆæœ¬çš„sortè¦æ±‚éšæœºè®¿é—®è¿­ä»£å™¨ï¼Œå› æ­¤ä¸èƒ½ç”¨äºlistå’Œforward_listï¼Œå› ä¸ºè¿™ä¸¤ä¸ªç±»å‹åˆ†åˆ«æä¾›åŒå‘è¿­ä»£å™¨å’Œå‰å‘è¿­ä»£å™¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726308113330.png"></p><p><img src="/../images/C-C-Primer-Chapter-10/1726308167608.png"></p><p><strong>spliceæˆå‘˜</strong></p><p>æ­¤ç®—æ³•æ˜¯é“¾è¡¨æ•°æ®ç»“æ„æ‰€ç‰¹æœ‰çš„ï¼Œå› æ­¤ä¸éœ€è¦é€šç”¨ç‰ˆæœ¬ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-10/1726308197673.png"></p><p><strong>é“¾è¡¨ç‰¹æœ‰çš„æ“ä½œä¼šæ”¹å˜å®¹å™¨</strong></p><p>é“¾è¡¨ç‰¹æœ‰ç‰ˆæœ¬ä¸é€šç”¨ç‰ˆæœ¬é—´çš„ä¸€ä¸ªè‡³å…³é‡è¦çš„åŒºåˆ«æ˜¯é“¾è¡¨ç‰ˆæœ¬ä¼šæ”¹å˜åº•å±‚çš„å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œremoveçš„é“¾è¡¨ç‰ˆæœ¬ä¼šåˆ é™¤æŒ‡å®šçš„å…ƒç´ ã€‚uniqueçš„é“¾è¡¨ç‰ˆæœ¬ä¼šåˆ é™¤ç¬¬äºŒä¸ªå’Œåç»§çš„é‡å¤å…ƒç´ ã€‚</p><p>ç±»ä¼¼çš„ï¼Œmergeå’Œspliceä¼šé”€æ¯å…¶å‚æ•°ã€‚ä¾‹å¦‚ï¼Œé€šç”¨ç‰ˆæœ¬çš„mergeå°†åˆå¹¶çš„åºåˆ—å†™åˆ°ä¸€ä¸ªç»™å®šçš„ç›®çš„è¿­ä»£å™¨ï¼›ä¸¤ä¸ªè¾“å…¥åºåˆ—æ˜¯ä¸å˜çš„ã€‚è€Œé“¾è¡¨ç‰ˆæœ¬çš„mergeå‡½æ•°ä¼šé”€æ¯ç»™å®šçš„é“¾è¡¨â€”â€”å…ƒç´ ä»å‚æ•°æŒ‡å®šçš„é“¾è¡¨ä¸­åˆ é™¤ï¼Œè¢«åˆå¹¶åˆ°è°ƒç”¨mergeçš„é“¾è¡¨å¯¹è±¡ä¸­ã€‚åœ¨mergeä¹‹åï¼Œæ¥è‡ªä¸¤ä¸ªé“¾è¡¨ä¸­çš„å…ƒç´ ä»ç„¶å­˜åœ¨ï¼Œä½†å®ƒä»¬éƒ½å·²åœ¨åŒä¸€ä¸ªé“¾è¡¨ä¸­ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 9</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-9/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-9/</url>
    
    <content type="html"><![CDATA[<h1 id="é¡ºåºå®¹å™¨"><a href="#é¡ºåºå®¹å™¨" class="headerlink" title="é¡ºåºå®¹å™¨"></a>é¡ºåºå®¹å™¨</h1><span id="more"></span><p>ä¸€ä¸ªå®¹å™¨å°±æ˜¯ä¸€äº›ç‰¹å®šç±»å‹å¯¹è±¡çš„é›†åˆã€‚é¡ºåºå®¹å™¨ï¼ˆsequential containerï¼‰ä¸ºç¨‹åºå‘˜æä¾›äº†æ§åˆ¶å…ƒç´ å­˜å‚¨å’Œè®¿é—®é¡ºåºçš„èƒ½åŠ›ã€‚è¿™ç§é¡ºåºä¸ä¾èµ–äºå…ƒç´ çš„å€¼ï¼Œè€Œæ˜¯ä¸å…ƒç´ åŠ å…¥å®¹å™¨æ—¶çš„ä½ç½®ç›¸å¯¹åº”ã€‚ä¸ä¹‹ç›¸å¯¹çš„ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬11ç« ä»‹ç»çš„æœ‰åºå’Œæ— åºå…³è”å®¹å™¨ï¼Œåˆ™æ ¹æ®å…³é”®å­—çš„å€¼æ¥å­˜å‚¨å…ƒç´ ã€‚</p><h2 id="9-1-é¡ºåºå®¹å™¨æ¦‚è¿°"><a href="#9-1-é¡ºåºå®¹å™¨æ¦‚è¿°" class="headerlink" title="9.1 é¡ºåºå®¹å™¨æ¦‚è¿°"></a>9.1 é¡ºåºå®¹å™¨æ¦‚è¿°</h2><p>è¡¨9.1åˆ—å‡ºäº†æ ‡å‡†åº“ä¸­çš„é¡ºåºå®¹å™¨ï¼Œæ‰€æœ‰é¡ºåºå®¹å™¨éƒ½æä¾›äº†å¿«é€Ÿé¡ºåºè®¿é—®å…ƒç´ çš„èƒ½åŠ›ã€‚ä½†æ˜¯ï¼Œè¿™äº›å®¹å™¨åœ¨ä»¥ä¸‹æ–¹é¢éƒ½æœ‰ä¸åŒçš„æ€§èƒ½æŠ˜ä¸­ï¼š</p><ul><li>å‘å®¹å™¨æ·»åŠ æˆ–ä»å®¹å™¨ä¸­åˆ é™¤å…ƒç´ çš„ä»£ä»·</li><li>éé¡ºåºè®¿é—®å®¹å™¨ä¸­å…ƒç´ çš„ä»£ä»·</li></ul><p><img src="/../images/C-C-Primer-Chapter-9/1726125028655.png"></p><p>1.stringå’Œvector</p><p>å°†å…ƒç´ ä¿å­˜åœ¨è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ã€‚ç”±äºå…ƒç´ æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œç”±å…ƒç´ çš„ä¸‹æ ‡æ¥è®¡ç®—å…¶åœ°å€æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ä¸¤ç§å®¹å™¨çš„ä¸­é—´ä½ç½®æ·»åŠ æˆ–åˆ é™¤å…ƒç´ å°±ä¼šéå¸¸è€—æ—¶</p><p>2.listå’Œforward_list</p><p>ä½•ä½ç½®çš„æ·»åŠ å’Œåˆ é™¤æ“ä½œéƒ½å¾ˆå¿«é€Ÿã€‚ä½œä¸ºä»£ä»·ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨ä¸æ”¯æŒå…ƒç´ çš„éšæœºè®¿é—®ã€‚ä¸vectorã€dequeå’Œarrayç›¸æ¯”ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨çš„é¢å¤–å†…å­˜å¼€é”€ä¹Ÿå¾ˆå¤§ã€‚</p><p>3.deque</p><p>ä¸stringå’Œvectorç±»ä¼¼ï¼Œdequeæ”¯æŒå¿«é€Ÿçš„éšæœºè®¿é—®ã€‚ä¸stringå’Œvectorä¸€æ ·ï¼Œåœ¨dequeçš„ä¸­é—´ä½ç½®æ·»åŠ æˆ–åˆ é™¤å…ƒç´ çš„ä»£ä»·ï¼ˆå¯èƒ½ï¼‰å¾ˆé«˜ã€‚ä½†æ˜¯ï¼Œåœ¨dequeçš„ä¸¤ç«¯æ·»åŠ æˆ–åˆ é™¤å…ƒç´ éƒ½æ˜¯å¾ˆå¿«çš„ï¼Œä¸listæˆ–forward_listæ·»åŠ åˆ é™¤å…ƒç´ çš„é€Ÿåº¦ç›¸å½“ã€‚</p><p>4.forward_listå’Œarrayæ˜¯æ–°C++æ ‡å‡†å¢åŠ çš„ç±»å‹ã€‚</p><p>ä¸å†…ç½®æ•°ç»„ç›¸æ¯”ï¼Œarrayæ˜¯ä¸€ç§æ›´å®‰å…¨ã€æ›´å®¹æ˜“ä½¿ç”¨çš„æ•°ç»„ç±»å‹ã€‚ä¸å†…ç½®æ•°ç»„ç±»ä¼¼ï¼Œarrayå¯¹è±¡çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚å› æ­¤ï¼Œarrayä¸æ”¯æŒæ·»åŠ å’Œåˆ é™¤å…ƒç´ ä»¥åŠæ”¹å˜å®¹å™¨å¤§å°çš„æ“ä½œã€‚</p><p>forward_listçš„è®¾è®¡ç›®æ ‡æ˜¯è¾¾åˆ°ä¸æœ€å¥½çš„æ‰‹å†™çš„å•å‘é“¾è¡¨æ•°æ®ç»“æ„ç›¸å½“çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œforward_listæ²¡æœ‰sizeæ“ä½œï¼Œå› ä¸ºä¿å­˜æˆ–è®¡ç®—å…¶å¤§å°å°±ä¼šæ¯”æ‰‹å†™é“¾è¡¨å¤šå‡ºé¢å¤–çš„å¼€é”€ã€‚</p><p>å¯¹å…¶ä»–å®¹å™¨è€Œè¨€ï¼Œsizeä¿è¯æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„å¸¸é‡æ—¶é—´çš„æ“ä½œã€‚</p><blockquote><p>æ–°æ ‡å‡†åº“å®¹å™¨çš„æ€§èƒ½å‡ ä¹è‚¯å®šä¸æœ€ç²¾å¿ƒä¼˜åŒ–è¿‡çš„åŒç±»æ•°æ®ç»“æ„ä¸€æ ·å¥½ï¼ˆé€šå¸¸ä¼šæ›´å¥½ï¼‰ã€‚ç°ä»£C++ç¨‹åºåº”è¯¥ä½¿ç”¨æ ‡å‡†åº“å®¹å™¨ï¼Œè€Œä¸æ˜¯æ›´åŸå§‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚å†…ç½®æ•°ç»„ã€‚</p></blockquote><p><strong>ç¡®å®šä½¿ç”¨å“ªç§é¡ºåºå®¹å™¨</strong></p><p>ä»¥ä¸‹æ˜¯ä¸€äº›é€‰æ‹©å®¹å™¨çš„åŸºæœ¬åŸåˆ™ï¼š</p><ul><li>é™¤éä½ æœ‰å¾ˆå¥½çš„ç†ç”±é€‰æ‹©å…¶ä»–å®¹å™¨ï¼Œå¦åˆ™åº”ä½¿ç”¨vectorã€‚</li><li>å¦‚æœä½ çš„ç¨‹åºæœ‰å¾ˆå¤šå°çš„å…ƒç´ ï¼Œä¸”ç©ºé—´çš„é¢å¤–å¼€é”€å¾ˆé‡è¦ï¼Œåˆ™ä¸è¦ä½¿ç”¨listæˆ–forward_listã€‚</li><li>å¦‚æœç¨‹åºè¦æ±‚éšæœºè®¿é—®å…ƒç´ ï¼Œåº”ä½¿ç”¨vectoræˆ–dequeã€‚</li><li>å¦‚æœç¨‹åºè¦æ±‚åœ¨å®¹å™¨çš„ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œåº”ä½¿ç”¨listæˆ–forward_listã€‚</li><li>å¦‚æœç¨‹åºéœ€è¦åœ¨å¤´å°¾ä½ç½®æ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œä½†ä¸ä¼šåœ¨ä¸­é—´ä½ç½®è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œï¼Œåˆ™ä½¿ç”¨dequeã€‚</li><li>å¦‚æœç¨‹åºåªæœ‰åœ¨è¯»å–è¾“å…¥æ—¶æ‰éœ€è¦åœ¨å®¹å™¨ä¸­é—´ä½ç½®æ’å…¥å…ƒç´ ï¼Œéšåéœ€è¦éšæœºè®¿é—®å…ƒç´ ï¼Œåˆ™<ul><li>é¦–å…ˆï¼Œç¡®å®šæ˜¯å¦çœŸçš„éœ€è¦åœ¨å®¹å™¨ä¸­é—´ä½ç½®æ·»åŠ å…ƒç´ ã€‚å½“å¤„ç†è¾“å…¥æ•°æ®æ—¶ï¼Œé€šå¸¸å¯ä»¥å¾ˆå®¹æ˜“åœ°å‘vectorè¿½åŠ æ•°æ®ï¼Œç„¶åå†è°ƒç”¨æ ‡å‡†åº“çš„sortå‡½æ•°ï¼ˆæˆ‘ä»¬å°†åœ¨10.2.3èŠ‚ä»‹ç»sortï¼ˆç¬¬343é¡µï¼‰ï¼‰æ¥é‡æ’å®¹å™¨ä¸­çš„å…ƒç´ ï¼Œä»è€Œé¿å…åœ¨ä¸­é—´ä½ç½®æ·»åŠ å…ƒç´ ã€‚</li><li>å¦‚æœå¿…é¡»åœ¨ä¸­é—´ä½ç½®æ’å…¥å…ƒç´ ï¼Œè€ƒè™‘åœ¨è¾“å…¥é˜¶æ®µä½¿ç”¨listï¼Œä¸€æ—¦è¾“å…¥å®Œæˆï¼Œå°†listä¸­çš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªvectorä¸­ã€‚</li><li>å¦‚æœç¨‹åºæ—¢éœ€è¦éšæœºè®¿é—®å…ƒç´ ï¼Œåˆéœ€è¦åœ¨å®¹å™¨ä¸­é—´ä½ç½®æ’å…¥å…ƒç´ ï¼Œé‚£è¯¥æ€ä¹ˆåŠï¼Ÿç­”æ¡ˆå–å†³äºåœ¨listæˆ–forward_listä¸­è®¿é—®å…ƒç´ ä¸vectoræˆ–dequeä¸­æ’å…¥&#x2F;åˆ é™¤å…ƒç´ çš„ç›¸å¯¹æ€§èƒ½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨ä¸­å ä¸»å¯¼åœ°ä½çš„æ“ä½œï¼ˆæ‰§è¡Œçš„è®¿é—®æ“ä½œæ›´å¤šè¿˜æ˜¯æ’å…¥&#x2F;åˆ é™¤æ›´å¤šï¼‰å†³å®šäº†å®¹å™¨ç±»å‹çš„é€‰æ‹©ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå¯¹ä¸¤ç§å®¹å™¨åˆ†åˆ«æµ‹è¯•åº”ç”¨çš„æ€§èƒ½å¯èƒ½å°±æ˜¯å¿…è¦çš„äº†ã€‚</li></ul></li></ul><h2 id="9-2-å®¹å™¨åº“æ¦‚è§ˆ"><a href="#9-2-å®¹å™¨åº“æ¦‚è§ˆ" class="headerlink" title="9.2 å®¹å™¨åº“æ¦‚è§ˆ"></a>9.2 å®¹å™¨åº“æ¦‚è§ˆ</h2><p>å®¹å™¨ç±»å‹ä¸Šçš„æ“ä½œå½¢æˆäº†ä¸€ç§å±‚æ¬¡ï¼š</p><ul><li>æŸäº›æ“ä½œæ˜¯æ‰€æœ‰å®¹å™¨ç±»å‹éƒ½æä¾›çš„ï¼ˆå‚è§è¡¨9.2ï¼Œç¬¬295é¡µï¼‰ã€‚</li><li>å¦å¤–ä¸€äº›æ“ä½œä»…é’ˆå¯¹é¡ºåºå®¹å™¨ï¼ˆå‚è§è¡¨9.3ï¼Œç¬¬299é¡µï¼‰ã€å…³è”å®¹å™¨ï¼ˆå‚è§è¡¨11.7ï¼Œç¬¬388é¡µï¼‰æˆ–æ— åºå®¹å™¨ï¼ˆå‚è§è¡¨11.8ï¼Œç¬¬395é¡µï¼‰ã€‚</li><li>è¿˜æœ‰ä¸€äº›æ“ä½œåªé€‚ç”¨äºä¸€å°éƒ¨åˆ†å®¹å™¨ã€‚</li></ul><p>æœ¬èŠ‚ä»‹ç»å¯¹æ‰€æœ‰å®¹å™¨éƒ½é€‚ç”¨çš„æ“ä½œã€‚</p><p><strong>å¯¹å®¹å™¨å¯ä»¥ä¿å­˜çš„å…ƒç´ ç±»å‹çš„é™åˆ¶</strong></p><p>ä½†æŸäº›å®¹å™¨æ“ä½œå¯¹å…ƒç´ ç±»å‹æœ‰å…¶è‡ªå·±çš„ç‰¹æ®Šè¦æ±‚ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºä¸æ”¯æŒç‰¹å®šæ“ä½œéœ€æ±‚çš„ç±»å‹å®šä¹‰å®¹å™¨ï¼Œä½†è¿™ç§æƒ…å†µä¸‹å°±åªèƒ½ä½¿ç”¨é‚£äº›æ²¡æœ‰ç‰¹æ®Šè¦æ±‚çš„å®¹å™¨æ“ä½œäº†ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726125619215.png"></p><p><img src="/../images/C-C-Primer-Chapter-9/1726125625747.png"></p><p><img src="/../images/C-C-Primer-Chapter-9/1726125631614.png"></p><h3 id="9-2-1-è¿­ä»£å™¨"><a href="#9-2-1-è¿­ä»£å™¨" class="headerlink" title="9.2.1 è¿­ä»£å™¨"></a>9.2.1 è¿­ä»£å™¨</h3><p><strong>è¿­ä»£å™¨èŒƒå›´</strong></p><p>è¿™ç§å…ƒç´ èŒƒå›´è¢«ç§°ä¸ºå·¦é—­åˆåŒºé—´ï¼ˆleft-inclusive intervalï¼‰ï¼Œå…¶æ ‡å‡†æ•°å­¦æè¿°ä¸º</p><p><img src="/../images/C-C-Primer-Chapter-9/image-20240922131109226.png"></p><p><strong>ä½¿ç”¨å·¦é—­åˆèŒƒå›´è•´å«çš„ç¼–ç¨‹å‡å®š</strong></p><ul><li>å¦‚æœbeginä¸endç›¸ç­‰ï¼Œåˆ™èŒƒå›´ä¸ºç©º</li><li>å¦‚æœbeginä¸endä¸ç­‰ï¼Œåˆ™èŒƒå›´è‡³å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œä¸”beginæŒ‡å‘è¯¥èŒƒå›´ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>æˆ‘ä»¬å¯ä»¥å¯¹beginé€’å¢è‹¥å¹²æ¬¡ï¼Œä½¿å¾—begin&#x3D;&#x3D;end</li></ul><h3 id="9-2-2-å®¹å™¨ç±»å‹æˆå‘˜"><a href="#9-2-2-å®¹å™¨ç±»å‹æˆå‘˜" class="headerlink" title="9.2.2 å®¹å™¨ç±»å‹æˆå‘˜"></a>9.2.2 å®¹å™¨ç±»å‹æˆå‘˜</h3><p><img src="/../images/C-C-Primer-Chapter-9/1726126013015.png"></p><h3 id="9-2-3-beginå’Œendæˆå‘˜"><a href="#9-2-3-beginå’Œendæˆå‘˜" class="headerlink" title="9.2.3 beginå’Œendæˆå‘˜"></a>9.2.3 beginå’Œendæˆå‘˜</h3><blockquote><p>å½“ä¸éœ€è¦å†™è®¿é—®æ—¶ï¼Œåº”ä½¿ç”¨cbeginå’Œcendã€‚</p></blockquote><h3 id="9-2-4-å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–"><a href="#9-2-4-å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–" class="headerlink" title="9.2.4 å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–"></a>9.2.4 å®¹å™¨å®šä¹‰å’Œåˆå§‹åŒ–</h3><p><img src="/../images/C-C-Primer-Chapter-9/1726126194086.png"></p><p><strong>å°†ä¸€ä¸ªå®¹å™¨åˆå§‹åŒ–ä¸ºå¦ä¸€ä¸ªå®¹å™¨çš„æ‹·è´</strong></p><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªå®¹å™¨ä¸ºå¦ä¸€ä¸ªå®¹å™¨çš„æ‹·è´ï¼Œä¸¤ä¸ªå®¹å™¨çš„ç±»å‹åŠå…¶å…ƒç´ ç±»å‹å¿…é¡»åŒ¹é…ã€‚ä¸è¿‡ï¼Œå½“ä¼ é€’è¿­ä»£å™¨å‚æ•°æ¥æ‹·è´ä¸€ä¸ªèŒƒå›´æ—¶ï¼Œå°±ä¸è¦æ±‚å®¹å™¨ç±»å‹æ˜¯ç›¸åŒçš„äº†ã€‚è€Œä¸”ï¼Œæ–°å®¹å™¨å’ŒåŸå®¹å™¨ä¸­çš„å…ƒç´ ç±»å‹ä¹Ÿå¯ä»¥ä¸åŒï¼Œåªè¦èƒ½å°†è¦æ‹·è´çš„å…ƒç´ è½¬æ¢ï¼ˆå‚è§4.11èŠ‚ï¼Œç¬¬141é¡µï¼‰ä¸ºè¦åˆå§‹åŒ–çš„å®¹å™¨çš„å…ƒç´ ç±»å‹å³å¯ã€‚</p><p><strong>åˆ—è¡¨åˆå§‹åŒ–</strong></p><p><img src="/../images/C-C-Primer-Chapter-9/1726126304682.png"></p><p><strong>ä¸é¡ºåºå®¹å™¨å¤§å°ç›¸å…³çš„æ„é€ å‡½æ•°</strong></p><p>é¡ºåºå®¹å™¨ï¼ˆarrayé™¤å¤–ï¼‰è¿˜æä¾›å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå®¹å™¨å¤§å°å’Œä¸€ä¸ªï¼ˆå¯é€‰çš„ï¼‰å…ƒç´ åˆå§‹å€¼ã€‚å¦‚æœæˆ‘ä»¬ä¸æä¾›å…ƒç´ åˆå§‹å€¼ï¼Œåˆ™æ ‡å‡†åº“ä¼šåˆ›å»ºä¸€ä¸ªå€¼åˆå§‹åŒ–å™¨ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µ)</p><blockquote><p>åªæœ‰é¡ºåºå®¹å™¨çš„æ„é€ å‡½æ•°æ‰æ¥å—å¤§å°å‚æ•°ï¼Œå…³è”å®¹å™¨å¹¶ä¸æ”¯æŒã€‚</p></blockquote><p><strong>æ ‡å‡†åº“arrayå…·æœ‰å›ºå®šå¤§å°</strong></p><p>ä¸å†…ç½®æ•°ç»„ä¸€æ ·ï¼Œæ ‡å‡†åº“arrayçš„å¤§å°ä¹Ÿæ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚å½“å®šä¹‰ä¸€ä¸ªarrayæ—¶ï¼Œé™¤äº†æŒ‡å®šå…ƒç´ ç±»å‹ï¼Œè¿˜è¦æŒ‡å®šå®¹å™¨å¤§å°</p><p><img src="/../images/C-C-Primer-Chapter-9/1726126472765.png"></p><p>ä¸å…¶ä»–å®¹å™¨ä¸åŒï¼Œä¸€ä¸ªé»˜è®¤æ„é€ çš„arrayæ˜¯éç©ºçš„ï¼šå®ƒåŒ…å«äº†ä¸å…¶å¤§å°ä¸€æ ·å¤šçš„å…ƒç´ ã€‚è¿™äº›å…ƒç´ éƒ½è¢«é»˜è®¤åˆå§‹åŒ–ï¼ˆå‚è§2.2.1èŠ‚ï¼Œç¬¬40é¡µï¼‰ï¼Œå°±åƒä¸€ä¸ªå†…ç½®æ•°ç»„ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬102é¡µï¼‰ä¸­çš„å…ƒç´ é‚£æ ·ã€‚å¦‚æœæˆ‘ä»¬å¯¹arrayè¿›è¡Œåˆ—è¡¨åˆå§‹åŒ–ï¼Œåˆå§‹å€¼çš„æ•°ç›®å¿…é¡»ç­‰äºæˆ–å°äºarrayçš„å¤§å°ã€‚å¦‚æœåˆå§‹å€¼æ•°ç›®å°äºarrayçš„å¤§å°ï¼Œåˆ™å®ƒä»¬è¢«ç”¨æ¥åˆå§‹åŒ–arrayä¸­é å‰çš„å…ƒç´ ï¼Œæ‰€æœ‰å‰©ä½™å…ƒç´ éƒ½ä¼šè¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬ä¸èƒ½å¯¹å†…ç½®æ•°ç»„ç±»å‹è¿›è¡Œæ‹·è´æˆ–å¯¹è±¡èµ‹å€¼æ“ä½œï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬102é¡µï¼‰ï¼Œä½†arrayå¹¶æ— æ­¤é™åˆ¶</p><h3 id="9-2-5-èµ‹å€¼å’Œswap"><a href="#9-2-5-èµ‹å€¼å’Œswap" class="headerlink" title="9.2.5 èµ‹å€¼å’Œswap"></a>9.2.5 èµ‹å€¼å’Œswap</h3><p><img src="/../images/C-C-Primer-Chapter-9/1726126984472.png"></p><p><strong>ä½¿ç”¨assignï¼ˆä»…é¡ºåºå®¹å™¨ï¼‰</strong></p><p>é¡ºåºå®¹å™¨ï¼ˆarrayé™¤å¤–ï¼‰è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸ºassignçš„æˆå‘˜ï¼Œå…è®¸æˆ‘ä»¬ä»ä¸€ä¸ªä¸åŒä½†ç›¸å®¹çš„ç±»å‹èµ‹å€¼ï¼Œæˆ–è€…ä»å®¹å™¨çš„ä¸€ä¸ªå­åºåˆ—èµ‹å€¼ã€‚assignæ“ä½œç”¨å‚æ•°æ‰€æŒ‡å®šçš„å…ƒç´ ï¼ˆçš„æ‹·è´ï¼‰æ›¿æ¢å·¦è¾¹å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p><p>assignçš„ç¬¬äºŒä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªæ•´å‹å€¼å’Œä¸€ä¸ªå…ƒç´ å€¼ã€‚å®ƒç”¨æŒ‡å®šæ•°ç›®ä¸”å…·æœ‰ç›¸åŒç»™å®šå€¼çš„å…ƒç´ æ›¿æ¢å®¹å™¨ä¸­åŸæœ‰çš„å…ƒç´ ã€‚</p><p><strong>ä½¿ç”¨swap</strong></p><p>swapæ“ä½œäº¤æ¢ä¸¤ä¸ªç›¸åŒç±»å‹å®¹å™¨çš„å†…å®¹ã€‚è°ƒç”¨swapä¹‹åï¼Œä¸¤ä¸ªå®¹å™¨ä¸­çš„å…ƒç´ å°†ä¼šäº¤æ¢</p><p>é™¤arrayå¤–ï¼Œäº¤æ¢ä¸¤ä¸ªå®¹å™¨å†…å®¹çš„æ“ä½œä¿è¯ä¼šå¾ˆå¿«â€”â€”å…ƒç´ æœ¬èº«å¹¶æœªäº¤æ¢ï¼Œswapåªæ˜¯äº¤æ¢äº†ä¸¤ä¸ªå®¹å™¨çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚</p><p>é™¤arrayå¤–ï¼Œswapä¸å¯¹ä»»ä½•å…ƒç´ è¿›è¡Œæ‹·è´ã€åˆ é™¤æˆ–æ’å…¥æ“ä½œï¼Œå› æ­¤å¯ä»¥ä¿è¯åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆã€‚</p><p>å…ƒç´ ä¸ä¼šè¢«ç§»åŠ¨çš„äº‹å®æ„å‘³ç€ï¼Œ<strong>é™¤stringå¤–</strong>ï¼ŒæŒ‡å‘å®¹å™¨çš„è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆåœ¨swapæ“ä½œä¹‹åéƒ½ä¸ä¼šå¤±æ•ˆã€‚å®ƒä»¬ä»æŒ‡å‘swapæ“ä½œä¹‹å‰æ‰€æŒ‡å‘çš„é‚£äº›å…ƒç´ ã€‚ä½†æ˜¯ï¼Œåœ¨swapä¹‹åï¼Œè¿™äº›å…ƒç´ å·²ç»å±äºä¸åŒçš„å®¹å™¨äº†ã€‚ä¾‹å¦‚ï¼Œå‡å®šiteråœ¨swapä¹‹å‰æŒ‡å‘svec1[3]çš„stringï¼Œé‚£ä¹ˆåœ¨swapä¹‹åå®ƒæŒ‡å‘svec2[3]çš„å…ƒç´ ã€‚</p><p><strong>ä¸å…¶ä»–å®¹å™¨ä¸åŒ</strong>ï¼Œå¯¹ä¸€ä¸ªstringè°ƒç”¨swapä¼šå¯¼è‡´è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆå¤±æ•ˆã€‚</p><p><strong>ä¸å…¶ä»–å®¹å™¨ä¸åŒ</strong>ï¼Œswapä¸¤ä¸ªarrayä¼šçœŸæ­£äº¤æ¢å®ƒä»¬çš„å…ƒç´ ã€‚å› æ­¤ï¼Œäº¤æ¢ä¸¤ä¸ªarrayæ‰€éœ€çš„æ—¶é—´ä¸arrayä¸­å…ƒç´ çš„æ•°ç›®æˆæ­£æ¯”ã€‚å› æ­¤ï¼Œå¯¹äºarrayï¼Œåœ¨swapæ“ä½œä¹‹åï¼ŒæŒ‡é’ˆã€å¼•ç”¨å’Œè¿­ä»£å™¨æ‰€ç»‘å®šçš„å…ƒç´ ä¿æŒä¸å˜ï¼Œä½†å…ƒç´ å€¼å·²ç»ä¸å¦ä¸€ä¸ªarrayä¸­å¯¹åº”å…ƒç´ çš„å€¼è¿›è¡Œäº†äº¤æ¢ã€‚</p><blockquote><p>åœ¨æ–°æ ‡å‡†åº“ä¸­ï¼Œå®¹å™¨æ—¢æä¾›æˆå‘˜å‡½æ•°ç‰ˆæœ¬çš„swapï¼Œä¹Ÿæä¾›éæˆå‘˜ç‰ˆæœ¬çš„swapã€‚è€Œæ—©æœŸæ ‡å‡†åº“ç‰ˆæœ¬åªæä¾›æˆå‘˜å‡½æ•°ç‰ˆæœ¬çš„swapã€‚éæˆå‘˜ç‰ˆæœ¬çš„swapåœ¨æ³›å‹ç¼–ç¨‹ä¸­æ˜¯éå¸¸é‡è¦çš„ã€‚ç»Ÿä¸€ä½¿ç”¨éæˆå‘˜ç‰ˆæœ¬çš„swapæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p></blockquote><h3 id="9-2-6-å®¹å™¨å¤§å°æ“ä½œ"><a href="#9-2-6-å®¹å™¨å¤§å°æ“ä½œ" class="headerlink" title="9.2.6 å®¹å™¨å¤§å°æ“ä½œ"></a>9.2.6 å®¹å™¨å¤§å°æ“ä½œ</h3><p>æˆå‘˜å‡½æ•°sizeï¼ˆå‚è§3.2.2èŠ‚ï¼Œç¬¬78é¡µï¼‰è¿”å›å®¹å™¨ä¸­å…ƒç´ çš„æ•°ç›®ï¼›</p><p>emptyå½“sizeä¸º0æ—¶è¿”å›å¸ƒå°”å€¼trueï¼Œå¦åˆ™è¿”å›falseï¼›</p><p>max_sizeè¿”å›ä¸€ä¸ªå¤§äºæˆ–ç­‰äºè¯¥ç±»å‹å®¹å™¨æ‰€èƒ½å®¹çº³çš„æœ€å¤§å…ƒç´ æ•°çš„å€¼ã€‚</p><p>forward_listæ”¯æŒmax_sizeå’Œemptyï¼Œä½†ä¸æ”¯æŒsize</p><h3 id="9-2-7-å…³ç³»è¿ç®—ç¬¦"><a href="#9-2-7-å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="9.2.7 å…³ç³»è¿ç®—ç¬¦"></a>9.2.7 å…³ç³»è¿ç®—ç¬¦</h3><p>æ¯ä¸ªå®¹å™¨ç±»å‹éƒ½æ”¯æŒç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ&#x3D;&#x3D;å’Œï¼&#x3D;ï¼‰ï¼›é™¤äº†æ— åºå…³è”å®¹å™¨å¤–çš„æ‰€æœ‰å®¹å™¨éƒ½æ”¯æŒå…³ç³»è¿ç®—ç¬¦ï¼ˆ&gt;ã€&gt;&#x3D;ã€&lt;ã€&lt;&#x3D;ï¼‰ã€‚å…³ç³»è¿ç®—ç¬¦å·¦å³ä¸¤è¾¹çš„è¿ç®—å¯¹è±¡å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„å®¹å™¨ï¼Œä¸”å¿…é¡»ä¿å­˜ç›¸åŒç±»å‹çš„å…ƒç´ ã€‚</p><p>æ¯”è¾ƒä¸¤ä¸ªå®¹å™¨å®é™…ä¸Šæ˜¯è¿›è¡Œå…ƒç´ çš„é€å¯¹æ¯”è¾ƒã€‚è¿™äº›è¿ç®—ç¬¦çš„å·¥ä½œæ–¹å¼ä¸stringçš„å…³ç³»è¿ç®—ï¼ˆå‚è§3.2.2èŠ‚ï¼Œç¬¬79é¡µï¼‰ç±»ä¼¼</p><p><strong>å®¹å™¨çš„å…³ç³»è¿ç®—ç¬¦ä½¿ç”¨å…ƒç´ çš„å…³ç³»è¿ç®—ç¬¦å®Œæˆæ¯”è¾ƒ</strong></p><blockquote><p><strong>åªæœ‰å½“å…¶å…ƒç´ ç±»å‹ä¹Ÿå®šä¹‰äº†ç›¸åº”çš„æ¯”è¾ƒè¿ç®—ç¬¦æ—¶ï¼Œæˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦æ¥æ¯”è¾ƒä¸¤ä¸ªå®¹å™¨ã€‚</strong></p></blockquote><h2 id="9-3-é¡ºåºå®¹å™¨æ“ä½œ"><a href="#9-3-é¡ºåºå®¹å™¨æ“ä½œ" class="headerlink" title="9.3 é¡ºåºå®¹å™¨æ“ä½œ"></a>9.3 é¡ºåºå®¹å™¨æ“ä½œ</h2><h3 id="9-3-1-å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ "><a href="#9-3-1-å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ " class="headerlink" title="9.3.1 å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ "></a>9.3.1 å‘é¡ºåºå®¹å™¨æ·»åŠ å…ƒç´ </h3><p><img src="/../images/C-C-Primer-Chapter-9/1726129802754.png"></p><p><strong>ä½¿ç”¨push_back</strong></p><p>é™¤arrayå’Œforward_listä¹‹å¤–ï¼Œæ¯ä¸ªé¡ºåºå®¹å™¨ï¼ˆåŒ…æ‹¬stringç±»å‹ï¼‰éƒ½æ”¯æŒpush_backã€‚</p><p><strong>å…³é”®æ¦‚å¿µï¼šå®¹å™¨å…ƒç´ æ˜¯æ‹·è´</strong></p><p>å½“æˆ‘ä»¬ç”¨ä¸€ä¸ªå¯¹è±¡æ¥åˆå§‹åŒ–å®¹å™¨æ—¶ï¼Œæˆ–å°†ä¸€ä¸ªå¯¹è±¡æ’å…¥åˆ°å®¹å™¨ä¸­æ—¶ï¼Œå®é™…ä¸Šæ”¾å…¥åˆ°å®¹å™¨ä¸­çš„æ˜¯å¯¹è±¡å€¼çš„ä¸€ä¸ªæ‹·è´ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚å°±åƒæˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡ä¼ é€’ç»™éå¼•ç”¨å‚æ•°ï¼ˆå‚è§3.2.2èŠ‚ï¼Œç¬¬79é¡µï¼‰ä¸€æ ·ï¼Œå®¹å™¨ä¸­çš„å…ƒç´ ä¸æä¾›å€¼çš„å¯¹è±¡ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³è”ã€‚éšåå¯¹å®¹å™¨ä¸­å…ƒç´ çš„ä»»ä½•æ”¹å˜éƒ½ä¸ä¼šå½±å“åˆ°åŸå§‹å¯¹è±¡ï¼Œåä¹‹äº¦ç„¶ã€‚</p><p><strong>ä½¿ç”¨push_front</strong></p><p>listã€forward_listå’Œdequeå®¹å™¨è¿˜æ”¯æŒåä¸ºpush_frontçš„ç±»ä¼¼æ“ä½œã€‚</p><p>æ³¨æ„ï¼Œdequeåƒvectorä¸€æ ·æä¾›äº†éšæœºè®¿é—®å…ƒç´ çš„èƒ½åŠ›ï¼Œä½†å®ƒæä¾›äº†vectoræ‰€ä¸æ”¯æŒçš„push_frontã€‚dequeä¿è¯åœ¨å®¹å™¨é¦–å°¾è¿›è¡Œæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ“ä½œéƒ½åªèŠ±è´¹å¸¸æ•°æ—¶é—´ã€‚</p><p><strong>åœ¨å®¹å™¨ä¸­çš„ç‰¹å®šä½ç½®æ·»åŠ å…ƒç´ </strong></p><p>insertæˆå‘˜æä¾›äº†æ›´ä¸€èˆ¬çš„æ·»åŠ åŠŸèƒ½ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨å®¹å™¨ä¸­ä»»æ„ä½ç½®æ’å…¥0ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚vectorã€dequeã€listå’Œstringéƒ½æ”¯æŒinsertæˆå‘˜ã€‚forward_listæä¾›äº†ç‰¹æ®Šç‰ˆæœ¬çš„insertæˆå‘˜ï¼Œæˆ‘ä»¬å°†åœ¨9.3.4èŠ‚ï¼ˆç¬¬312é¡µï¼‰ä¸­ä»‹ç»ã€‚</p><p>æ¯ä¸ªinsertå‡½æ•°éƒ½æ¥å—ä¸€ä¸ªè¿­ä»£å™¨ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¿­ä»£å™¨æŒ‡å‡ºäº†åœ¨å®¹å™¨ä¸­ä»€ä¹ˆä½ç½®æ”¾ç½®æ–°å…ƒç´ ã€‚å®ƒå¯ä»¥æŒ‡å‘å®¹å™¨ä¸­ä»»ä½•ä½ç½®ï¼ŒåŒ…æ‹¬å®¹å™¨å°¾éƒ¨ä¹‹åçš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚ç”±äºè¿­ä»£å™¨å¯èƒ½æŒ‡å‘å®¹å™¨å°¾éƒ¨ä¹‹åä¸å­˜åœ¨çš„å…ƒç´ çš„ä½ç½®ï¼Œè€Œä¸”åœ¨å®¹å™¨å¼€å§‹ä½ç½®æ’å…¥å…ƒç´ æ˜¯å¾ˆæœ‰ç”¨çš„åŠŸèƒ½ï¼Œæ‰€ä»¥<strong>insertå‡½æ•°å°†å…ƒç´ æ’å…¥åˆ°è¿­ä»£å™¨æ‰€æŒ‡å®šçš„ä½ç½®</strong>ä¹‹å‰ã€‚</p><p><strong>æ’å…¥èŒƒå›´å†…å…ƒç´ </strong></p><p>æ¥å—ä¸€ä¸ªå…ƒç´ æ•°ç›®å’Œä¸€ä¸ªå€¼ï¼Œå®ƒå°†æŒ‡å®šæ•°é‡çš„å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šä½ç½®ä¹‹å‰ï¼Œè¿™äº›å…ƒç´ éƒ½æŒ‰ç»™å®šå€¼åˆå§‹åŒ–</p><p>æ¥å—ä¸€å¯¹è¿­ä»£å™¨æˆ–ä¸€ä¸ªåˆå§‹åŒ–åˆ—è¡¨çš„insertç‰ˆæœ¬å°†ç»™å®šèŒƒå›´ä¸­çš„å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®ä¹‹å‰</p><p>å¦‚æœæˆ‘ä»¬ä¼ é€’ç»™insertä¸€å¯¹è¿­ä»£å™¨ï¼Œå®ƒä»¬ä¸èƒ½æŒ‡å‘æ·»åŠ å…ƒç´ çš„ç›®æ ‡å®¹å™¨ã€‚</p><p>åœ¨æ–°æ ‡å‡†ä¸‹ï¼Œæ¥å—å…ƒç´ ä¸ªæ•°æˆ–èŒƒå›´çš„insertç‰ˆæœ¬è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªæ–°åŠ å…¥å…ƒç´ çš„è¿­ä»£å™¨ã€‚ï¼ˆåœ¨æ—§ç‰ˆæœ¬çš„æ ‡å‡†åº“ä¸­ï¼Œè¿™äº›æ“ä½œè¿”å›voidã€‚ï¼‰å¦‚æœèŒƒå›´ä¸ºç©ºï¼Œä¸æ’å…¥ä»»ä½•å…ƒç´ ï¼Œinsertæ“ä½œä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°è¿”å›ã€‚</p><p><strong>ä½¿ç”¨insertçš„è¿”å›å€¼</strong></p><p>é€šè¿‡ä½¿ç”¨insertçš„è¿”å›å€¼ï¼Œå¯ä»¥åœ¨å®¹å™¨ä¸­ä¸€ä¸ªç‰¹å®šä½ç½®åå¤æ’å…¥å…ƒç´ </p><p><img src="/../images/C-C-Primer-Chapter-9/1726151272102.png"></p><p><strong>ä½¿ç”¨emplaceæ“ä½œ</strong></p><p>å½“è°ƒç”¨pushæˆ–insertæˆå‘˜å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å°†å…ƒç´ ç±»å‹çš„å¯¹è±¡ä¼ é€’ç»™å®ƒä»¬ï¼Œè¿™äº›å¯¹è±¡è¢«æ‹·è´åˆ°å®¹å™¨ä¸­ã€‚è€Œå½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªemplaceæˆå‘˜å‡½æ•°æ—¶ï¼Œåˆ™æ˜¯å°†å‚æ•°ä¼ é€’ç»™å…ƒç´ ç±»å‹çš„æ„é€ å‡½æ•°ã€‚emplaceæˆå‘˜ä½¿ç”¨è¿™äº›å‚æ•°åœ¨å®¹å™¨ç®¡ç†çš„å†…å­˜ç©ºé—´ä¸­ç›´æ¥æ„é€ å…ƒç´ ã€‚</p><blockquote><p>emplaceå‡½æ•°åœ¨å®¹å™¨ä¸­ç›´æ¥æ„é€ å…ƒç´ ã€‚ä¼ é€’ç»™emplaceå‡½æ•°çš„å‚æ•°å¿…é¡»ä¸å…ƒç´ ç±»å‹çš„æ„é€ å‡½æ•°ç›¸åŒ¹é…ã€‚</p></blockquote><h3 id="9-3-2-è®¿é—®å…ƒç´ "><a href="#9-3-2-è®¿é—®å…ƒç´ " class="headerlink" title="9.3.2 è®¿é—®å…ƒç´ "></a>9.3.2 è®¿é—®å…ƒç´ </h3><p>å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰å…ƒç´ ï¼Œè®¿é—®æ“ä½œçš„ç»“æœæ˜¯æœªå®šä¹‰çš„ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726151419791.png"></p><p><strong>è®¿é—®æˆå‘˜å‡½æ•°è¿”å›çš„æ˜¯å¼•ç”¨</strong></p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨autoå˜é‡æ¥ä¿å­˜è¿™äº›å‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶ä¸”å¸Œæœ›ä½¿ç”¨æ­¤å˜é‡æ¥æ”¹å˜å…ƒç´ çš„å€¼ï¼Œå¿…é¡»è®°å¾—å°†å˜é‡å®šä¹‰ä¸ºå¼•ç”¨ç±»å‹ã€‚</p><p><strong>ä¸‹æ ‡æ“ä½œå’Œå®‰å…¨çš„éšæœºè®¿é—®</strong></p><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ç¡®ä¿ä¸‹æ ‡æ˜¯åˆæ³•çš„ï¼Œå¯ä»¥ä½¿ç”¨atæˆå‘˜å‡½æ•°ã€‚atæˆå‘˜å‡½æ•°ç±»ä¼¼ä¸‹æ ‡è¿ç®—ç¬¦ï¼Œä½†å¦‚æœä¸‹æ ‡è¶Šç•Œï¼Œatä¼šæŠ›å‡ºä¸€ä¸ªout_of_rangeå¼‚å¸¸ï¼ˆå‚è§5.6èŠ‚ï¼Œç¬¬173é¡µï¼‰</p><h3 id="9-3-3-åˆ é™¤å…ƒç´ "><a href="#9-3-3-åˆ é™¤å…ƒç´ " class="headerlink" title="9.3.3 åˆ é™¤å…ƒç´ "></a>9.3.3 åˆ é™¤å…ƒç´ </h3><p><img src="/../images/C-C-Primer-Chapter-9/1726151897306.png"></p><blockquote><p>åˆ é™¤å…ƒç´ çš„æˆå‘˜å‡½æ•°å¹¶ä¸æ£€æŸ¥å…¶å‚æ•°ã€‚åœ¨åˆ é™¤å…ƒç´ ä¹‹å‰ï¼Œç¨‹åºå‘˜å¿…é¡»ç¡®ä¿å®ƒï¼ˆä»¬ï¼‰æ˜¯å­˜åœ¨çš„ã€‚</p></blockquote><p><strong>pop_frontå’Œpop_backæˆå‘˜å‡½æ•°</strong></p><p>è¿™äº›æ“ä½œè¿”å›voidã€‚å¦‚æœä½ éœ€è¦å¼¹å‡ºçš„å…ƒç´ çš„å€¼ï¼Œå°±å¿…é¡»åœ¨æ‰§è¡Œå¼¹å‡ºæ“ä½œä¹‹å‰ä¿å­˜å®ƒ</p><p><strong>ä»å®¹å™¨å†…éƒ¨åˆ é™¤ä¸€ä¸ªå…ƒç´ </strong></p><p>ä¸¤ç§å½¢å¼çš„eraseéƒ½è¿”å›æŒ‡å‘åˆ é™¤çš„ï¼ˆæœ€åä¸€ä¸ªï¼‰å…ƒç´ ä¹‹åä½ç½®çš„è¿­ä»£å™¨ã€‚</p><p><strong>åˆ é™¤å¤šä¸ªå…ƒç´ </strong></p><h3 id="9-3-4-ç‰¹æ®Šçš„forward-listæ“ä½œ"><a href="#9-3-4-ç‰¹æ®Šçš„forward-listæ“ä½œ" class="headerlink" title="9.3.4 ç‰¹æ®Šçš„forward_listæ“ä½œ"></a>9.3.4 ç‰¹æ®Šçš„forward_listæ“ä½œ</h3><p>forward_listå¹¶æœªå®šä¹‰insertã€emplaceå’Œeraseï¼Œè€Œæ˜¯å®šä¹‰äº†åä¸ºinsert_afterã€emplace_afterå’Œerase_afterçš„æ“ä½œ</p><p><img src="/../images/C-C-Primer-Chapter-9/1726152308687.png"></p><p>forward_listä¹Ÿå®šä¹‰äº†before_beginï¼Œå®ƒè¿”å›ä¸€ä¸ªé¦–å‰ï¼ˆoff-the-beginningï¼‰è¿­ä»£å™¨ã€‚è¿™ä¸ªè¿­ä»£å™¨å…è®¸æˆ‘ä»¬åœ¨é“¾è¡¨é¦–å…ƒç´ ä¹‹å‰å¹¶ä¸å­˜åœ¨çš„å…ƒç´ â€œä¹‹åâ€æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ï¼ˆäº¦å³åœ¨é“¾è¡¨é¦–å…ƒç´ ä¹‹å‰æ·»åŠ åˆ é™¤å…ƒç´ ï¼‰ã€‚</p><h3 id="9-3-5-æ”¹å˜å®¹å™¨å¤§å°"><a href="#9-3-5-æ”¹å˜å®¹å™¨å¤§å°" class="headerlink" title="9.3.5 æ”¹å˜å®¹å™¨å¤§å°"></a>9.3.5 æ”¹å˜å®¹å™¨å¤§å°</h3><p>æˆ‘ä»¬å¯ä»¥ç”¨resizeæ¥å¢å¤§æˆ–ç¼©å°å®¹å™¨ï¼Œä¸å¾€å¸¸ä¸€æ ·ï¼Œarrayä¸æ”¯æŒresizeã€‚å¦‚æœå½“å‰å¤§å°å¤§äºæ‰€è¦æ±‚çš„å¤§å°ï¼Œå®¹å™¨åéƒ¨çš„å…ƒç´ ä¼šè¢«åˆ é™¤ï¼›å¦‚æœå½“å‰å¤§å°å°äºæ–°å¤§å°ï¼Œä¼šå°†æ–°å…ƒç´ æ·»åŠ åˆ°å®¹å™¨åéƒ¨</p><p>resizeæ“ä½œæ¥å—ä¸€ä¸ªå¯é€‰çš„å…ƒç´ å€¼å‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–æ·»åŠ åˆ°å®¹å™¨ä¸­çš„å…ƒç´ ã€‚å¦‚æœè°ƒç”¨è€…æœªæä¾›æ­¤å‚æ•°ï¼Œæ–°å…ƒç´ è¿›è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726152646667.png"></p><h3 id="9-3-6-å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ"><a href="#9-3-6-å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ" class="headerlink" title="9.3.6 å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ"></a>9.3.6 å®¹å™¨æ“ä½œå¯èƒ½ä½¿è¿­ä»£å™¨å¤±æ•ˆ</h3><p>åœ¨å‘å®¹å™¨æ·»åŠ å…ƒç´ åï¼š</p><ul><li>å¦‚æœå®¹å™¨æ˜¯vectoræˆ–stringï¼Œä¸”å­˜å‚¨ç©ºé—´è¢«é‡æ–°åˆ†é…ï¼Œåˆ™æŒ‡å‘å®¹å™¨çš„è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨éƒ½ä¼šå¤±æ•ˆã€‚å¦‚æœå­˜å‚¨ç©ºé—´æœªé‡æ–°åˆ†é…ï¼ŒæŒ‡å‘æ’å…¥ä½ç½®ä¹‹å‰çš„å…ƒç´ çš„è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨ä»æœ‰æ•ˆï¼Œä½†æŒ‡å‘æ’å…¥ä½ç½®ä¹‹åå…ƒç´ çš„è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨å°†ä¼šå¤±æ•ˆã€‚</li><li>å¯¹äºdequeï¼Œæ’å…¥åˆ°é™¤é¦–å°¾ä½ç½®ä¹‹å¤–çš„ä»»ä½•ä½ç½®éƒ½ä¼šå¯¼è‡´è¿­ä»£å™¨ã€æŒ‡é’ˆå’Œå¼•ç”¨å¤±æ•ˆã€‚å¦‚æœåœ¨é¦–å°¾ä½ç½®æ·»åŠ å…ƒç´ ï¼Œè¿­ä»£å™¨ä¼šå¤±æ•ˆï¼Œä½†æŒ‡å‘å­˜åœ¨çš„å…ƒç´ çš„å¼•ç”¨å’ŒæŒ‡é’ˆä¸ä¼šå¤±æ•ˆã€‚</li><li>å¯¹äºlistå’Œforward_listï¼ŒæŒ‡å‘å®¹å™¨çš„è¿­ä»£å™¨ï¼ˆåŒ…æ‹¬å°¾åè¿­ä»£å™¨å’Œé¦–å‰è¿­ä»£å™¨ï¼‰ã€æŒ‡é’ˆå’Œå¼•ç”¨ä»æœ‰æ•ˆã€‚</li></ul><p>å½“æˆ‘ä»¬åˆ é™¤ä¸€ä¸ªå…ƒç´ åï¼š</p><ul><li>å¯¹äºlistå’Œforward_listï¼ŒæŒ‡å‘å®¹å™¨å…¶ä»–ä½ç½®çš„è¿­ä»£å™¨ï¼ˆåŒ…æ‹¬å°¾åè¿­ä»£å™¨å’Œé¦–å‰è¿­ä»£å™¨ï¼‰ã€å¼•ç”¨å’ŒæŒ‡é’ˆä»æœ‰æ•ˆã€‚</li><li>å¯¹äºdequeï¼Œå¦‚æœåœ¨é¦–å°¾ä¹‹å¤–çš„ä»»ä½•ä½ç½®åˆ é™¤å…ƒç´ ï¼Œé‚£ä¹ˆæŒ‡å‘è¢«åˆ é™¤å…ƒç´ å¤–å…¶ä»–å…ƒç´ çš„è¿­ä»£å™¨ã€å¼•ç”¨æˆ–æŒ‡é’ˆä¹Ÿä¼šå¤±æ•ˆã€‚å¦‚æœæ˜¯åˆ é™¤dequeçš„å°¾å…ƒç´ ï¼Œåˆ™å°¾åè¿­ä»£å™¨ä¹Ÿä¼šå¤±æ•ˆï¼Œä½†å…¶ä»–è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆä¸å—å½±å“ï¼›å¦‚æœæ˜¯åˆ é™¤é¦–å…ƒç´ ï¼Œè¿™äº›ä¹Ÿä¸ä¼šå—å½±å“ã€‚</li><li>å¯¹äºvectorå’Œstringï¼ŒæŒ‡å‘è¢«åˆ å…ƒç´ ä¹‹å‰å…ƒç´ çš„è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆä»æœ‰æ•ˆã€‚æ³¨æ„ï¼šå½“æˆ‘ä»¬åˆ é™¤å…ƒç´ æ—¶ï¼Œå°¾åè¿­ä»£å™¨æ€»æ˜¯ä¼šå¤±æ•ˆã€‚</li></ul><p><strong>å»ºè®®ï¼šç®¡ç†è¿­ä»£å™¨</strong></p><p>å½“ä½ ä½¿ç”¨è¿­ä»£å™¨ï¼ˆæˆ–æŒ‡å‘å®¹å™¨å…ƒç´ çš„å¼•ç”¨æˆ–æŒ‡é’ˆï¼‰æ—¶ï¼Œæœ€å°åŒ–è¦æ±‚è¿­ä»£å™¨å¿…é¡»ä¿æŒæœ‰æ•ˆçš„ç¨‹åºç‰‡æ®µæ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ³•ã€‚</p><p>ç”±äºå‘è¿­ä»£å™¨æ·»åŠ å…ƒç´ å’Œä»è¿­ä»£å™¨åˆ é™¤å…ƒç´ çš„ä»£ç å¯èƒ½ä¼šä½¿è¿­ä»£å™¨å¤±æ•ˆï¼Œå› æ­¤å¿…é¡»ä¿è¯æ¯æ¬¡æ”¹å˜å®¹å™¨çš„æ“ä½œä¹‹åéƒ½æ­£ç¡®åœ°é‡æ–°å®šä½è¿­ä»£å™¨ã€‚è¿™ä¸ªå»ºè®®å¯¹vectorã€stringå’Œdequeå°¤ä¸ºé‡è¦ã€‚</p><p><strong>ç¼–å†™æ”¹å˜å®¹å™¨çš„å¾ªç¯ç¨‹åº</strong></p><p>æ·»åŠ &#x2F;åˆ é™¤vectorã€stringæˆ–dequeå…ƒç´ çš„å¾ªç¯ç¨‹åºå¿…é¡»è€ƒè™‘è¿­ä»£å™¨ã€å¼•ç”¨å’ŒæŒ‡é’ˆå¯èƒ½å¤±æ•ˆçš„é—®é¢˜ã€‚ç¨‹åºå¿…é¡»ä¿è¯æ¯ä¸ªå¾ªç¯æ­¥ä¸­éƒ½æ›´æ–°è¿­ä»£å™¨ã€å¼•ç”¨æˆ–æŒ‡é’ˆã€‚å¦‚æœå¾ªç¯ä¸­è°ƒç”¨çš„æ˜¯insertæˆ–eraseï¼Œé‚£ä¹ˆæ›´æ–°è¿­ä»£å™¨å¾ˆå®¹æ˜“ã€‚è¿™äº›æ“ä½œéƒ½è¿”å›è¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥æ›´æ–°</p><p><img src="/../images/C-C-Primer-Chapter-9/1726152845237.png"></p><p><strong>ä¸è¦ä¿å­˜endè¿”å›çš„è¿­ä»£å™¨</strong></p><p>å½“æˆ‘ä»¬æ·»åŠ &#x2F;åˆ é™¤vectoræˆ–stringçš„å…ƒç´ åï¼Œæˆ–åœ¨dequeä¸­é¦–å…ƒç´ ä¹‹å¤–ä»»ä½•ä½ç½®æ·»åŠ &#x2F;åˆ é™¤å…ƒç´ åï¼ŒåŸæ¥endè¿”å›çš„è¿­ä»£å™¨æ€»æ˜¯ä¼šå¤±æ•ˆã€‚å› æ­¤ï¼Œæ·»åŠ æˆ–åˆ é™¤å…ƒç´ çš„å¾ªç¯ç¨‹åºå¿…é¡»åå¤è°ƒç”¨endï¼Œè€Œä¸èƒ½åœ¨å¾ªç¯ä¹‹å‰ä¿å­˜endè¿”å›çš„è¿­ä»£å™¨ï¼Œä¸€ç›´å½“ä½œå®¹å™¨æœ«å°¾ä½¿ç”¨ã€‚é€šå¸¸C++æ ‡å‡†åº“çš„å®ç°ä¸­endï¼ˆï¼‰æ“ä½œéƒ½å¾ˆå¿«ï¼Œéƒ¨åˆ†å°±æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ã€‚</p><h2 id="9-4-vectorå¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„"><a href="#9-4-vectorå¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„" class="headerlink" title="9.4 vectorå¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„"></a>9.4 vectorå¯¹è±¡æ˜¯å¦‚ä½•å¢é•¿çš„</h2><p>å½“ä¸å¾—ä¸è·å–æ–°çš„å†…å­˜ç©ºé—´æ—¶ï¼Œvectorå’Œstringçš„å®ç°é€šå¸¸ä¼šåˆ†é…æ¯”æ–°çš„ç©ºé—´éœ€æ±‚æ›´å¤§çš„å†…å­˜ç©ºé—´ã€‚å®¹å™¨é¢„ç•™è¿™äº›ç©ºé—´ä½œä¸ºå¤‡ç”¨ï¼Œå¯ç”¨æ¥ä¿å­˜æ›´å¤šçš„æ–°å…ƒç´ ã€‚</p><p><strong>ç®¡ç†å®¹é‡çš„æˆå‘˜å‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-9/1726153094106.png"></p><p>åªæœ‰å½“éœ€è¦çš„å†…å­˜ç©ºé—´è¶…è¿‡å½“å‰å®¹é‡æ—¶ï¼Œreserveè°ƒç”¨æ‰ä¼šæ”¹å˜vectorçš„å®¹é‡ã€‚</p><p>å¦‚æœéœ€æ±‚å¤§å°å¤§äºå½“å‰å®¹é‡ï¼Œreserveè‡³å°‘åˆ†é…ä¸éœ€æ±‚ä¸€æ ·å¤§çš„å†…å­˜ç©ºé—´ï¼ˆå¯èƒ½æ›´å¤§ï¼‰ã€‚</p><p>å¦‚æœéœ€æ±‚å¤§å°å°äºæˆ–ç­‰äºå½“å‰å®¹é‡ï¼Œreserveä»€ä¹ˆä¹Ÿä¸åšã€‚ç‰¹åˆ«æ˜¯ï¼Œå½“éœ€æ±‚å¤§å°å°äºå½“å‰å®¹é‡æ—¶ï¼Œå®¹å™¨ä¸ä¼šé€€å›å†…å­˜ç©ºé—´ã€‚</p><p>å› æ­¤ï¼Œåœ¨è°ƒç”¨reserveä¹‹åï¼Œcapacityå°†ä¼šå¤§äºæˆ–ç­‰äºä¼ é€’ç»™reserveçš„å‚æ•°ã€‚è¿™æ ·ï¼Œè°ƒç”¨reserveæ°¸è¿œä¹Ÿä¸ä¼šå‡å°‘å®¹å™¨å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><p>ç±»ä¼¼çš„ï¼Œresizeæˆå‘˜å‡½æ•°ï¼ˆå‚è§9.3.5èŠ‚ï¼Œç¬¬314é¡µï¼‰åªæ”¹å˜å®¹å™¨ä¸­å…ƒç´ çš„æ•°ç›®ï¼Œè€Œä¸æ˜¯å®¹å™¨çš„å®¹é‡ã€‚æˆ‘ä»¬åŒæ ·ä¸èƒ½ä½¿ç”¨resizeæ¥å‡å°‘å®¹å™¨é¢„ç•™çš„å†…å­˜ç©ºé—´ã€‚</p><p>åœ¨æ–°æ ‡å‡†åº“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨shrink_to_fitæ¥è¦æ±‚dequeã€vectoræˆ–stringé€€å›ä¸éœ€è¦çš„å†…å­˜ç©ºé—´ã€‚æ­¤å‡½æ•°æŒ‡å‡ºæˆ‘ä»¬ä¸å†éœ€è¦ä»»ä½•å¤šä½™çš„å†…å­˜ç©ºé—´ã€‚ä½†æ˜¯ï¼Œå…·ä½“çš„å®ç°å¯ä»¥é€‰æ‹©å¿½ç•¥æ­¤è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨shrink_to_fitä¹Ÿå¹¶ä¸ä¿è¯ä¸€å®šé€€å›å†…å­˜ç©ºé—´ã€‚</p><p><strong>capacityå’Œsize</strong></p><p>è™½ç„¶ä¸åŒçš„å®ç°å¯ä»¥é‡‡ç”¨ä¸åŒçš„åˆ†é…ç­–ç•¥ï¼Œä½†æ‰€æœ‰å®ç°éƒ½åº”éµå¾ªä¸€ä¸ªåŸåˆ™ï¼šç¡®ä¿ç”¨push_backå‘vectoræ·»åŠ å…ƒç´ çš„æ“ä½œæœ‰é«˜æ•ˆç‡ã€‚ä»æŠ€æœ¯è§’åº¦è¯´ï¼Œå°±æ˜¯é€šè¿‡åœ¨ä¸€ä¸ªåˆå§‹ä¸ºç©ºçš„vectorä¸Šè°ƒç”¨næ¬¡push_backæ¥åˆ›å»ºä¸€ä¸ªnä¸ªå…ƒç´ çš„vectorï¼Œæ‰€èŠ±è´¹çš„æ—¶é—´ä¸èƒ½è¶…è¿‡nçš„å¸¸æ•°å€ã€‚</p><h2 id="9-5-é¢å¤–çš„stringæ“ä½œ"><a href="#9-5-é¢å¤–çš„stringæ“ä½œ" class="headerlink" title="9.5 é¢å¤–çš„stringæ“ä½œ"></a>9.5 é¢å¤–çš„stringæ“ä½œ</h2><p>åé¢ç”¨åˆ°çš„æ—¶å€™å†æ¥æŸ¥</p><h3 id="9-5-1-æ„é€ stringçš„å…¶ä»–æ–¹æ³•"><a href="#9-5-1-æ„é€ stringçš„å…¶ä»–æ–¹æ³•" class="headerlink" title="9.5.1 æ„é€ stringçš„å…¶ä»–æ–¹æ³•"></a>9.5.1 æ„é€ stringçš„å…¶ä»–æ–¹æ³•</h3><p><img src="/../images/C-C-Primer-Chapter-9/1726153366845.png"></p><p><strong>substræ“ä½œ</strong></p><p>substræ“ä½œï¼ˆå‚è§è¡¨9.12ï¼‰è¿”å›ä¸€ä¸ªstringï¼Œå®ƒæ˜¯åŸå§‹stringçš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨çš„æ‹·è´ã€‚å¯ä»¥ä¼ é€’ç»™substrä¸€ä¸ªå¯é€‰çš„å¼€å§‹ä½ç½®å’Œè®¡æ•°å€¼</p><p>å¦‚æœå¼€å§‹ä½ç½®è¶…è¿‡äº†stringçš„å¤§å°ï¼Œåˆ™substrå‡½æ•°æŠ›å‡ºä¸€ä¸ªout_of_rangeå¼‚å¸¸ï¼ˆå‚è§5.6èŠ‚ï¼Œç¬¬173é¡µï¼‰ã€‚å¦‚æœå¼€å§‹ä½ç½®åŠ ä¸Šè®¡æ•°å€¼å¤§äºstringçš„å¤§å°ï¼Œåˆ™substrä¼šè°ƒæ•´è®¡æ•°å€¼ï¼Œåªæ‹·è´åˆ°stringçš„æœ«å°¾ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726153449111.png"></p><h3 id="9-5-2-æ”¹å˜stringçš„å…¶ä»–æ–¹æ³•"><a href="#9-5-2-æ”¹å˜stringçš„å…¶ä»–æ–¹æ³•" class="headerlink" title="9.5.2 æ”¹å˜stringçš„å…¶ä»–æ–¹æ³•"></a>9.5.2 æ”¹å˜stringçš„å…¶ä»–æ–¹æ³•</h3><p>é™¤äº†æ¥å—è¿­ä»£å™¨çš„insertå’Œeraseç‰ˆæœ¬å¤–ï¼Œstringè¿˜æä¾›äº†æ¥å—ä¸‹æ ‡çš„ç‰ˆæœ¬ã€‚ä¸‹æ ‡æŒ‡å‡ºäº†å¼€å§‹åˆ é™¤çš„ä½ç½®ï¼Œæˆ–æ˜¯insertåˆ°ç»™å®šå€¼ä¹‹å‰çš„ä½ç½®</p><p><strong>appendå’Œreplaceå‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-9/1726153581945.png"></p><p><img src="/../images/C-C-Primer-Chapter-9/1726153593456.png"></p><p><strong>æ”¹å˜stringçš„å¤šç§é‡è½½å‡½æ•°</strong></p><h3 id="9-5-3-stringæœç´¢æ“ä½œ"><a href="#9-5-3-stringæœç´¢æ“ä½œ" class="headerlink" title="9.5.3 stringæœç´¢æ“ä½œ"></a>9.5.3 stringæœç´¢æ“ä½œ</h3><p>stringç±»æä¾›äº†6ä¸ªä¸åŒçš„æœç´¢å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰4ä¸ªé‡è½½ç‰ˆæœ¬ã€‚è¡¨9.14æè¿°äº†è¿™äº›æœç´¢æˆå‘˜å‡½æ•°åŠå…¶å‚æ•°ã€‚æ¯ä¸ªæœç´¢æ“ä½œéƒ½è¿”å›ä¸€ä¸ªstringï¼šï¼šsize_typeå€¼ï¼Œè¡¨ç¤ºåŒ¹é…å‘ç”Ÿä½ç½®çš„ä¸‹æ ‡ã€‚å¦‚æœæœç´¢å¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªåä¸ºstringï¼šï¼šnposçš„staticæˆå‘˜ï¼ˆå‚è§7.6èŠ‚ï¼Œç¬¬268é¡µï¼‰ã€‚æ ‡å‡†åº“å°†nposå®šä¹‰ä¸ºä¸€ä¸ªconst stringï¼šï¼šsize_typeç±»å‹ï¼Œå¹¶åˆå§‹åŒ–ä¸ºå€¼-1ã€‚ç”±äºnposæ˜¯ä¸€ä¸ªunsignedç±»å‹ï¼Œæ­¤åˆå§‹å€¼æ„å‘³ç€nposç­‰äºä»»ä½•stringæœ€å¤§çš„å¯èƒ½å¤§å°ï¼ˆå‚è§2.1.2èŠ‚ï¼Œç¬¬32é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726153688759.png"></p><p><img src="/../images/C-C-Primer-Chapter-9/1726153692156.png"></p><h3 id="9-5-4-compareå‡½æ•°"><a href="#9-5-4-compareå‡½æ•°" class="headerlink" title="9.5.4 compareå‡½æ•°"></a>9.5.4 compareå‡½æ•°</h3><p><img src="/../images/C-C-Primer-Chapter-9/1726153729745.png"></p><h3 id="9-5-5-æ•°å€¼è½¬æ¢"><a href="#9-5-5-æ•°å€¼è½¬æ¢" class="headerlink" title="9.5.5 æ•°å€¼è½¬æ¢"></a>9.5.5 æ•°å€¼è½¬æ¢</h3><p>æ–°æ ‡å‡†å¼•å…¥äº†å¤šä¸ªå‡½æ•°ï¼Œå¯ä»¥å®ç°æ•°å€¼æ•°æ®ä¸æ ‡å‡†åº“stringä¹‹é—´çš„è½¬æ¢</p><p><img src="/../images/C-C-Primer-Chapter-9/1726153770508.png"></p><p>è¦è½¬æ¢ä¸ºæ•°å€¼çš„stringä¸­ç¬¬ä¸€ä¸ªéç©ºç™½ç¬¦å¿…é¡»æ˜¯æ•°å€¼ä¸­å¯èƒ½å‡ºç°çš„å­—ç¬¦</p><p>stringå‚æ•°ä¸­ç¬¬ä¸€ä¸ªéç©ºç™½ç¬¦å¿…é¡»æ˜¯ç¬¦å·ï¼ˆ+ æˆ– -ï¼‰æˆ–æ•°å­—ã€‚å®ƒå¯ä»¥ä»¥0xæˆ–0Xå¼€å¤´æ¥è¡¨ç¤ºåå…­è¿›åˆ¶æ•°ã€‚å¯¹é‚£äº›å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹å€¼çš„å‡½æ•°ï¼Œstringå‚æ•°ä¹Ÿå¯ä»¥ä»¥å°æ•°ç‚¹ï¼ˆ.ï¼‰å¼€å¤´ï¼Œå¹¶å¯ä»¥åŒ…å«eæˆ–Eæ¥è¡¨ç¤ºæŒ‡æ•°éƒ¨åˆ†ã€‚å¯¹äºé‚£äº›å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹å€¼çš„å‡½æ•°ï¼Œæ ¹æ®åŸºæ•°ä¸åŒï¼Œstringå‚æ•°å¯ä»¥åŒ…å«å­—æ¯å­—ç¬¦ï¼Œå¯¹åº”å¤§äºæ•°å­—9çš„æ•°ã€‚</p><p>å¦‚æœstringä¸èƒ½è½¬æ¢ä¸ºä¸€ä¸ªæ•°å€¼ï¼Œè¿™äº›å‡½æ•°æŠ›å‡ºä¸€ä¸ªinvalid_argumentå¼‚å¸¸ï¼ˆå‚è§5.6èŠ‚ï¼Œç¬¬173é¡µï¼‰ã€‚å¦‚æœè½¬æ¢å¾—åˆ°çš„æ•°å€¼æ— æ³•ç”¨ä»»ä½•ç±»å‹æ¥è¡¨ç¤ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªout_of_rangeå¼‚å¸¸ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726153854406.png"></p><h2 id="9-6-å®¹å™¨é€‚é…å™¨"><a href="#9-6-å®¹å™¨é€‚é…å™¨" class="headerlink" title="9.6 å®¹å™¨é€‚é…å™¨"></a>9.6 å®¹å™¨é€‚é…å™¨</h2><p>é™¤äº†é¡ºåºå®¹å™¨å¤–ï¼Œæ ‡å‡†åº“è¿˜å®šä¹‰äº†ä¸‰ä¸ªé¡ºåºå®¹å™¨é€‚é…å™¨ï¼šstackã€queueå’Œpriority_queueã€‚é€‚é…å™¨ï¼ˆadaptorï¼‰æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªé€šç”¨æ¦‚å¿µã€‚å®¹å™¨ã€è¿­ä»£å™¨å’Œå‡½æ•°éƒ½æœ‰é€‚é…å™¨ã€‚</p><p>æœ¬è´¨ä¸Šï¼Œä¸€ä¸ªé€‚é…å™¨æ˜¯ä¸€ç§æœºåˆ¶ï¼Œèƒ½ä½¿æŸç§äº‹ç‰©çš„è¡Œä¸ºçœ‹èµ·æ¥åƒå¦å¤–ä¸€ç§äº‹ç‰©ä¸€æ ·ã€‚ä¸€ä¸ªå®¹å™¨é€‚é…å™¨æ¥å—ä¸€ç§å·²æœ‰çš„å®¹å™¨ç±»å‹ï¼Œä½¿å…¶è¡Œä¸ºçœ‹èµ·æ¥åƒä¸€ç§ä¸åŒçš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œstacké€‚é…å™¨æ¥å—ä¸€ä¸ªé¡ºåºå®¹å™¨ï¼ˆé™¤arrayæˆ–forward_listå¤–ï¼‰ï¼Œå¹¶ä½¿å…¶æ“ä½œèµ·æ¥åƒä¸€ä¸ªstackä¸€æ ·ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726153935087.png"></p><p><strong>å®šä¹‰ä¸€ä¸ªé€‚é…å™¨</strong></p><p>æ¯ä¸ªé€‚é…å™¨éƒ½å®šä¹‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼šé»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ¥å—ä¸€ä¸ªå®¹å™¨çš„æ„é€ å‡½æ•°æ‹·è´è¯¥å®¹å™¨æ¥åˆå§‹åŒ–é€‚é…å™¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>stackå’Œqueueæ˜¯åŸºäºdequeå®ç°çš„</strong>ï¼Œ<strong>priority_queueæ˜¯åœ¨vectorä¹‹ä¸Šå®ç°çš„</strong>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºä¸€ä¸ªé€‚é…å™¨æ—¶å°†ä¸€ä¸ªå‘½åçš„é¡ºåºå®¹å™¨ä½œä¸ºç¬¬äºŒä¸ªç±»å‹å‚æ•°ï¼Œæ¥é‡è½½é»˜è®¤å®¹å™¨ç±»å‹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726154019522.png"></p><p>å¯¹äºä¸€ä¸ªç»™å®šçš„é€‚é…å™¨ï¼Œå¯ä»¥ä½¿ç”¨å“ªäº›å®¹å™¨æ˜¯æœ‰é™åˆ¶çš„ã€‚æ‰€æœ‰é€‚é…å™¨éƒ½è¦æ±‚å®¹å™¨å…·æœ‰æ·»åŠ å’Œåˆ é™¤å…ƒç´ çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œé€‚é…å™¨ä¸èƒ½æ„é€ åœ¨arrayä¹‹ä¸Šã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç”¨forward_listæ¥æ„é€ é€‚é…å™¨ï¼Œå› ä¸ºæ‰€æœ‰é€‚é…å™¨éƒ½è¦æ±‚å®¹å™¨å…·æœ‰æ·»åŠ ã€åˆ é™¤ä»¥åŠè®¿é—®å°¾å…ƒç´ çš„èƒ½åŠ›ã€‚</p><p>stackåªè¦æ±‚push_backã€pop_backå’Œbackæ“ä½œï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨é™¤arrayå’Œforward_listä¹‹å¤–çš„ä»»ä½•å®¹å™¨ç±»å‹æ¥æ„é€ stackã€‚</p><p>queueé€‚é…å™¨è¦æ±‚backã€push_backã€frontå’Œpush_frontï¼Œå› æ­¤å®ƒå¯ä»¥æ„é€ äºlistæˆ–dequeä¹‹ä¸Šï¼Œä½†ä¸èƒ½åŸºäºvectoræ„é€ ã€‚</p><p>priority_queueé™¤äº†frontã€push_backå’Œpop_backæ“ä½œä¹‹å¤–è¿˜è¦æ±‚éšæœºè®¿é—®èƒ½åŠ›ï¼Œå› æ­¤å®ƒå¯ä»¥æ„é€ äºvectoræˆ–dequeä¹‹ä¸Šï¼Œä½†ä¸èƒ½åŸºäºlistæ„é€ ã€‚</p><p><strong>æ ˆé€‚é…å™¨</strong></p><p>stackç±»å‹å®šä¹‰åœ¨stackå¤´æ–‡ä»¶ä¸­ã€‚è¡¨9.18åˆ—å‡ºäº†stackæ‰€æ”¯æŒçš„æ“ä½œã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726154101439.png"></p><p><img src="/../images/C-C-Primer-Chapter-9/1726154156115.png"></p><p><strong>é˜Ÿåˆ—é€‚é…å™¨</strong></p><p>queueå’Œpriority_queueé€‚é…å™¨å®šä¹‰åœ¨queueå¤´æ–‡ä»¶ä¸­ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-9/1726154196324.png" alt="1726154196324"></p><p><img src="/../images/C-C-Primer-Chapter-9/image-20240922131124573.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 8</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-8/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-8/</url>
    
    <content type="html"><![CDATA[<h1 id="IOåº“"><a href="#IOåº“" class="headerlink" title="IOåº“"></a>IOåº“</h1><span id="more"></span><p>C++è¯­è¨€ä¸ç›´æ¥å¤„ç†è¾“å…¥è¾“å‡ºï¼Œè€Œæ˜¯é€šè¿‡ä¸€æ—å®šä¹‰åœ¨æ ‡å‡†åº“ä¸­çš„ç±»å‹æ¥å¤„ç†IOã€‚è¿™äº›ç±»å‹æ”¯æŒä»è®¾å¤‡è¯»å–æ•°æ®ã€å‘è®¾å¤‡å†™å…¥æ•°æ®çš„IOæ“ä½œï¼Œè®¾å¤‡å¯ä»¥æ˜¯æ–‡ä»¶ã€æ§åˆ¶å°çª—å£ç­‰ã€‚è¿˜æœ‰ä¸€äº›ç±»å‹å…è®¸å†…å­˜IOï¼Œå³ï¼Œä»stringè¯»å–æ•°æ®ï¼Œå‘stringå†™å…¥æ•°æ®ã€‚</p><h2 id="8-1-IOç±»"><a href="#8-1-IOç±»" class="headerlink" title="8.1 IOç±»"></a>8.1 IOç±»</h2><p><img src="/../images/C-C-Primer-Chapter-8/1726120413211.png"></p><p><strong>IOç±»å‹é—´çš„å…³ç³»</strong></p><p>ç±»å‹ifstreamå’Œistringstreaméƒ½ç»§æ‰¿è‡ªistreamã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨istreamå¯¹è±¡ä¸€æ ·æ¥ä½¿ç”¨ifstreamå’Œistringstreamå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨cinçš„ï¼Œå°±å¯ä»¥åŒæ ·åœ°ä½¿ç”¨è¿™äº›ç±»å‹çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å¯¹ä¸€ä¸ªifstreamæˆ–istringstreamå¯¹è±¡è°ƒç”¨getlineï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&gt;&gt;ä»ä¸€ä¸ªifstreamæˆ–istringstreamå¯¹è±¡ä¸­è¯»å–æ•°æ®ã€‚ç±»ä¼¼çš„ï¼Œç±»å‹ofstreamå’Œostringstreaméƒ½ç»§æ‰¿è‡ªostreamã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨coutçš„ï¼Œå°±å¯ä»¥åŒæ ·åœ°ä½¿ç”¨è¿™äº›ç±»å‹çš„å¯¹è±¡ã€‚</p><blockquote><p>æœ¬èŠ‚å‰©ä¸‹éƒ¨åˆ†æ‰€ä»‹ç»çš„æ ‡å‡†åº“æµç‰¹æ€§éƒ½å¯ä»¥æ— å·®åˆ«åœ°åº”ç”¨äºæ™®é€šæµã€æ–‡ä»¶æµå’Œstringæµï¼Œä»¥åŠcharæˆ–å®½å­—ç¬¦æµç‰ˆæœ¬ã€‚</p></blockquote><h3 id="8-1-1-IOå¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼"><a href="#8-1-1-IOå¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼" class="headerlink" title="8.1.1 IOå¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼"></a>8.1.1 IOå¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼</h3><p>æˆ‘ä»¬ä¸èƒ½æ‹·è´æˆ–å¯¹IOå¯¹è±¡èµ‹å€¼ã€‚</p><p>æˆ‘ä»¬ä¹Ÿä¸èƒ½å°†å½¢å‚æˆ–è¿”å›ç±»å‹è®¾ç½®ä¸ºæµç±»å‹ï¼ˆå‚è§6.2.1èŠ‚ï¼Œç¬¬188é¡µï¼‰ã€‚è¿›è¡ŒIOæ“ä½œçš„å‡½æ•°é€šå¸¸ä»¥å¼•ç”¨æ–¹å¼ä¼ é€’å’Œè¿”å›æµã€‚è¯»å†™ä¸€ä¸ªIOå¯¹è±¡ä¼šæ”¹å˜å…¶çŠ¶æ€ï¼Œå› æ­¤ä¼ é€’å’Œè¿”å›çš„å¼•ç”¨ä¸èƒ½æ˜¯constçš„ã€‚</p><h3 id="8-1-2-æ¡ä»¶çŠ¶æ€"><a href="#8-1-2-æ¡ä»¶çŠ¶æ€" class="headerlink" title="8.1.2 æ¡ä»¶çŠ¶æ€"></a>8.1.2 æ¡ä»¶çŠ¶æ€</h3><p><img src="/../images/C-C-Primer-Chapter-8/1726120976621.png"></p><p><img src="/../images/C-C-Primer-Chapter-8/1726120982490.png"></p><p><img src="/../images/C-C-Primer-Chapter-8/1726121084201.png"></p><p>å¦‚æœæˆ‘ä»¬åœ¨æ ‡å‡†è¾“å…¥ä¸Šé”®å…¥Booï¼Œè¯»æ“ä½œå°±ä¼šå¤±è´¥ã€‚ä»£ç ä¸­çš„è¾“å…¥è¿ç®—ç¬¦æœŸå¾…è¯»å–ä¸€ä¸ªintï¼Œä½†å´å¾—åˆ°äº†ä¸€ä¸ªå­—ç¬¦Bã€‚è¿™æ ·ï¼Œcinä¼šè¿›å…¥é”™è¯¯çŠ¶æ€ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªæ–‡ä»¶ç»“æŸæ ‡è¯†ï¼Œcinä¹Ÿä¼šè¿›å…¥é”™è¯¯çŠ¶æ€ã€‚</p><p>ä¸€ä¸ªæµä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼Œå…¶ä¸Šåç»­çš„IOæ“ä½œéƒ½ä¼šå¤±è´¥ã€‚åªæœ‰å½“ä¸€ä¸ªæµå¤„äºæ— é”™çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬æ‰å¯ä»¥ä»å®ƒè¯»å–æ•°æ®ï¼Œå‘å®ƒå†™å…¥æ•°æ®ã€‚ç”±äºæµå¯èƒ½å¤„äºé”™è¯¯çŠ¶æ€ï¼Œå› æ­¤ä»£ç é€šå¸¸åº”è¯¥åœ¨ä½¿ç”¨ä¸€ä¸ªæµä¹‹å‰æ£€æŸ¥å®ƒæ˜¯å¦å¤„äºè‰¯å¥½çŠ¶æ€ã€‚ç¡®å®šä¸€ä¸ªæµå¯¹è±¡çš„çŠ¶æ€çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†å®ƒå½“ä½œä¸€ä¸ªæ¡ä»¶æ¥ä½¿ç”¨</p><p><img src="/../images/C-C-Primer-Chapter-8/1726121103849.png"></p><p><strong>æŸ¥è¯¢æµçš„çŠ¶æ€</strong></p><p>å°†æµä½œä¸ºæ¡ä»¶ä½¿ç”¨ï¼Œåªèƒ½å‘Šè¯‰æˆ‘ä»¬æµæ˜¯å¦æœ‰æ•ˆï¼Œè€Œæ— æ³•å‘Šè¯‰æˆ‘ä»¬å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>IOåº“å®šä¹‰äº†ä¸€ä¸ªä¸æœºå™¨æ— å…³çš„iostateç±»å‹ï¼Œå®ƒæä¾›äº†è¡¨è¾¾æµçŠ¶æ€çš„å®Œæ•´åŠŸèƒ½ã€‚è¿™ä¸ªç±»å‹åº”ä½œä¸ºä¸€ä¸ªä½é›†åˆæ¥ä½¿ç”¨</p><p>IOåº“å®šä¹‰äº†4ä¸ªiostateç±»å‹çš„constexprå€¼ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬58é¡µï¼‰ï¼Œè¡¨ç¤ºç‰¹å®šçš„ä½æ¨¡å¼ã€‚è¿™äº›å€¼ç”¨æ¥è¡¨ç¤ºç‰¹å®šç±»å‹çš„IOæ¡ä»¶ï¼Œå¯ä»¥ä¸ä½è¿ç®—ç¬¦ï¼ˆå‚è§4.8èŠ‚ï¼Œç¬¬137é¡µï¼‰ä¸€èµ·ä½¿ç”¨æ¥ä¸€æ¬¡æ€§æ£€æµ‹æˆ–è®¾ç½®å¤šä¸ªæ ‡å¿—ä½ã€‚</p><p>badbitè¡¨ç¤ºç³»ç»Ÿçº§é”™è¯¯ï¼Œå¦‚ä¸å¯æ¢å¤çš„è¯»å†™é”™è¯¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€æ—¦badbitè¢«ç½®ä½ï¼Œæµå°±æ— æ³•å†ä½¿ç”¨äº†ã€‚</p><p>åœ¨å‘ç”Ÿå¯æ¢å¤é”™è¯¯åï¼Œfailbitè¢«ç½®ä½ï¼Œå¦‚æœŸæœ›è¯»å–æ•°å€¼å´è¯»å‡ºä¸€ä¸ªå­—ç¬¦ç­‰é”™è¯¯ã€‚è¿™ç§é—®é¢˜é€šå¸¸æ˜¯å¯ä»¥ä¿®æ­£çš„ï¼Œæµè¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p><p>å¦‚æœåˆ°è¾¾æ–‡ä»¶ç»“æŸä½ç½®ï¼Œeofbitå’Œfailbitéƒ½ä¼šè¢«ç½®ä½ã€‚</p><p>goodbitçš„å€¼ä¸º0ï¼Œè¡¨ç¤ºæµæœªå‘ç”Ÿé”™è¯¯ã€‚å¦‚æœbadbitã€failbitå’Œeofbitä»»ä¸€ä¸ªè¢«ç½®ä½ï¼Œåˆ™æ£€æµ‹æµçŠ¶æ€çš„æ¡ä»¶ä¼šå¤±è´¥ã€‚</p><p>æ“ä½œgoodåœ¨æ‰€æœ‰é”™è¯¯ä½å‡æœªç½®ä½çš„æƒ…å†µä¸‹è¿”å›trueï¼Œè€Œbadã€failå’Œeofåˆ™åœ¨å¯¹åº”é”™è¯¯ä½è¢«ç½®ä½æ—¶è¿”å›trueã€‚æ­¤å¤–ï¼Œåœ¨badbitè¢«ç½®ä½æ—¶ï¼Œfailä¹Ÿä¼šè¿”å›trueã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨goodæˆ–failæ˜¯ç¡®å®šæµçš„æ€»ä½“çŠ¶æ€çš„æ­£ç¡®æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å°†æµå½“ä½œæ¡ä»¶ä½¿ç”¨çš„ä»£ç å°±ç­‰ä»·äºï¼failï¼ˆï¼‰ã€‚è€Œeofå’Œbadæ“ä½œåªèƒ½è¡¨ç¤ºç‰¹å®šçš„é”™è¯¯ã€‚</p><p><strong>ç®¡ç†æ¡ä»¶çŠ¶æ€</strong></p><p>æµå¯¹è±¡çš„rdstateæˆå‘˜è¿”å›ä¸€ä¸ªiostateå€¼ï¼Œå¯¹åº”æµçš„å½“å‰çŠ¶æ€ã€‚setstateæ“ä½œå°†ç»™å®šæ¡ä»¶ä½ç½®ä½ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†å¯¹åº”é”™è¯¯ã€‚clearæˆå‘˜æ˜¯ä¸€ä¸ªé‡è½½çš„æˆå‘˜ï¼ˆå‚è§6.4èŠ‚ï¼Œç¬¬206é¡µï¼‰ï¼šå®ƒæœ‰ä¸€ä¸ªä¸æ¥å—å‚æ•°çš„ç‰ˆæœ¬ï¼Œè€Œå¦ä¸€ä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªiostateç±»å‹çš„å‚æ•°ã€‚clearä¸æ¥å—å‚æ•°çš„ç‰ˆæœ¬æ¸…é™¤ï¼ˆå¤ä½ï¼‰æ‰€æœ‰é”™è¯¯æ ‡å¿—ä½ã€‚æ‰§è¡Œclearï¼ˆï¼‰åï¼Œè°ƒç”¨goodä¼šè¿”å›trueã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨è¿™äº›æˆå‘˜ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-8/1726121320970.png"></p><p>å¸¦å‚æ•°çš„clearç‰ˆæœ¬æ¥å—ä¸€ä¸ªiostateå€¼ï¼Œè¡¨ç¤ºæµçš„æ–°çŠ¶æ€ã€‚ä¸ºäº†å¤ä½å•ä¸€çš„æ¡ä»¶çŠ¶æ€ä½ï¼Œæˆ‘ä»¬é¦–å…ˆç”¨rdstateè¯»å‡ºå½“å‰æ¡ä»¶çŠ¶æ€ï¼Œç„¶åç”¨ä½æ“ä½œå°†æ‰€éœ€ä½å¤ä½æ¥ç”Ÿæˆæ–°çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å°†failbitå’Œbadbitå¤ä½ï¼Œä½†ä¿æŒeofbitä¸å˜ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-8/1726121388256.png"></p><h3 id="8-1-3-ç®¡ç†è¾“å‡ºç¼“å†²"><a href="#8-1-3-ç®¡ç†è¾“å‡ºç¼“å†²" class="headerlink" title="8.1.3 ç®¡ç†è¾“å‡ºç¼“å†²"></a>8.1.3 ç®¡ç†è¾“å‡ºç¼“å†²</h3><p>æ¯ä¸ªè¾“å‡ºæµéƒ½ç®¡ç†ä¸€ä¸ªç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜ç¨‹åºè¯»å†™çš„æ•°æ®ã€‚</p><p>å¯¼è‡´ç¼“å†²åˆ·æ–°ï¼ˆå³ï¼Œæ•°æ®çœŸæ­£å†™åˆ°è¾“å‡ºè®¾å¤‡æˆ–æ–‡ä»¶ï¼‰çš„åŸå› æœ‰å¾ˆå¤šï¼š</p><ul><li>ç¨‹åºæ­£å¸¸ç»“æŸï¼Œä½œä¸ºmainå‡½æ•°çš„returnæ“ä½œçš„ä¸€éƒ¨åˆ†ï¼Œç¼“å†²åˆ·æ–°è¢«æ‰§è¡Œã€‚</li><li>ç¼“å†²åŒºæ»¡æ—¶ï¼Œéœ€è¦åˆ·æ–°ç¼“å†²ï¼Œè€Œåæ–°çš„æ•°æ®æ‰èƒ½ç»§ç»­å†™å…¥ç¼“å†²åŒºã€‚</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ“çºµç¬¦å¦‚endlï¼ˆå‚è§1.2èŠ‚ï¼Œç¬¬6é¡µï¼‰æ¥æ˜¾å¼åˆ·æ–°ç¼“å†²åŒºã€‚</li><li>åœ¨æ¯ä¸ªè¾“å‡ºæ“ä½œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ“çºµç¬¦unitbufè®¾ç½®æµçš„å†…éƒ¨çŠ¶æ€ï¼Œæ¥æ¸…ç©ºç¼“å†²åŒºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹cerræ˜¯è®¾ç½®unitbufçš„ï¼Œå› æ­¤å†™åˆ°cerrçš„å†…å®¹éƒ½æ˜¯ç«‹å³åˆ·æ–°çš„ã€‚</li><li>ä¸€ä¸ªè¾“å‡ºæµå¯èƒ½è¢«å…³è”åˆ°å¦ä¸€ä¸ªæµã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“è¯»å†™è¢«å…³è”çš„æµæ—¶ï¼Œå…³è”åˆ°çš„æµçš„ç¼“å†²åŒºä¼šè¢«åˆ·æ–°ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œcinå’Œcerréƒ½å…³è”åˆ°coutã€‚å› æ­¤ï¼Œè¯»cinæˆ–å†™cerréƒ½ä¼šå¯¼è‡´coutçš„ç¼“å†²åŒºè¢«åˆ·æ–°ã€‚</li></ul><p><strong>åˆ·æ–°è¾“å‡ºç¼“å†²åŒº</strong></p><p>æˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡æ“çºµç¬¦endlï¼Œå®ƒå®Œæˆæ¢è¡Œå¹¶åˆ·æ–°ç¼“å†²åŒºçš„å·¥ä½œã€‚IOåº“ä¸­è¿˜æœ‰ä¸¤ä¸ªç±»ä¼¼çš„æ“çºµç¬¦ï¼šflushå’Œendsã€‚flushåˆ·æ–°ç¼“å†²åŒºï¼Œä½†ä¸è¾“å‡ºä»»ä½•é¢å¤–çš„å­—ç¬¦ï¼›endså‘ç¼“å†²åŒºæ’å…¥ä¸€ä¸ªç©ºå­—ç¬¦ï¼Œç„¶ååˆ·æ–°ç¼“å†²åŒº</p><p><img src="/../images/C-C-Primer-Chapter-8/1726121607348.png"></p><p><strong>unitbufæ“çºµç¬¦</strong></p><p>å¦‚æœæƒ³åœ¨æ¯æ¬¡è¾“å‡ºæ“ä½œåéƒ½åˆ·æ–°ç¼“å†²åŒºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨unitbufæ“çºµç¬¦ã€‚å®ƒå‘Šè¯‰æµåœ¨æ¥ä¸‹æ¥çš„æ¯æ¬¡å†™æ“ä½œä¹‹åéƒ½è¿›è¡Œä¸€æ¬¡flushæ“ä½œã€‚è€Œnounitbufæ“çºµç¬¦åˆ™é‡ç½®æµï¼Œä½¿å…¶æ¢å¤ä½¿ç”¨æ­£å¸¸çš„ç³»ç»Ÿç®¡ç†çš„ç¼“å†²åŒºåˆ·æ–°æœºåˆ¶</p><p><img src="/../images/C-C-Primer-Chapter-8/1726121637902.png"></p><blockquote><p>è­¦å‘Šï¼šå¦‚æœç¨‹åºå´©æºƒï¼Œè¾“å‡ºç¼“å†²åŒºä¸ä¼šè¢«åˆ·æ–°</p></blockquote><p><strong>å…³è”è¾“å…¥å’Œè¾“å‡ºæµ</strong></p><p>å½“ä¸€ä¸ªè¾“å…¥æµè¢«å…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµæ—¶ï¼Œä»»ä½•è¯•å›¾ä»è¾“å…¥æµè¯»å–æ•°æ®çš„æ“ä½œéƒ½ä¼šå…ˆåˆ·æ–°å…³è”çš„è¾“å‡ºæµã€‚æ ‡å‡†åº“å°†coutå’Œcinå…³è”åœ¨ä¸€èµ·ã€‚</p><blockquote><p>äº¤äº’å¼ç³»ç»Ÿé€šå¸¸åº”è¯¥å…³è”è¾“å…¥æµå’Œè¾“å‡ºæµã€‚è¿™æ„å‘³ç€æ‰€æœ‰è¾“å‡ºï¼ŒåŒ…æ‹¬ç”¨æˆ·æç¤ºä¿¡æ¯ï¼Œéƒ½ä¼šåœ¨è¯»æ“ä½œä¹‹å‰è¢«æ‰“å°å‡ºæ¥ã€‚</p></blockquote><p>tieæœ‰ä¸¤ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼ˆå‚è§6.4èŠ‚ï¼Œç¬¬206é¡µï¼‰ï¼šä¸€ä¸ªç‰ˆæœ¬ä¸å¸¦å‚æ•°ï¼Œè¿”å›æŒ‡å‘è¾“å‡ºæµçš„æŒ‡é’ˆã€‚å¦‚æœæœ¬å¯¹è±¡å½“å‰å…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµï¼Œåˆ™è¿”å›çš„å°±æ˜¯æŒ‡å‘è¿™ä¸ªæµçš„æŒ‡é’ˆï¼Œå¦‚æœå¯¹è±¡æœªå…³è”åˆ°æµï¼Œåˆ™è¿”å›ç©ºæŒ‡é’ˆã€‚tieçš„ç¬¬äºŒä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªæŒ‡å‘ostreamçš„æŒ‡é’ˆï¼Œå°†è‡ªå·±å…³è”åˆ°æ­¤ostreamã€‚å³ï¼Œx.tieï¼ˆ&amp;oï¼‰å°†æµxå…³è”åˆ°è¾“å‡ºæµoã€‚</p><p>æˆ‘ä»¬æ—¢å¯ä»¥å°†ä¸€ä¸ªistreamå¯¹è±¡å…³è”åˆ°å¦ä¸€ä¸ªostreamï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ªostreamå…³è”åˆ°å¦ä¸€ä¸ªostreamï¼š</p><p><img src="/../images/C-C-Primer-Chapter-8/1726122679237.png"></p><p>æ¯ä¸ªæµåŒæ—¶æœ€å¤šå…³è”åˆ°ä¸€ä¸ªæµï¼Œä½†å¤šä¸ªæµå¯ä»¥åŒæ—¶å…³è”åˆ°åŒä¸€ä¸ªostreamã€‚</p><h2 id="8-2-æ–‡ä»¶è¾“å…¥è¾“å‡º"><a href="#8-2-æ–‡ä»¶è¾“å…¥è¾“å‡º" class="headerlink" title="8.2 æ–‡ä»¶è¾“å…¥è¾“å‡º"></a>8.2 æ–‡ä»¶è¾“å…¥è¾“å‡º</h2><p>é™¤äº†ç»§æ‰¿è‡ªiostreamç±»å‹çš„è¡Œä¸ºä¹‹å¤–ï¼Œfstreamä¸­å®šä¹‰çš„ç±»å‹è¿˜å¢åŠ äº†ä¸€äº›æ–°çš„æˆå‘˜æ¥ç®¡ç†ä¸æµå…³è”çš„æ–‡ä»¶ã€‚åœ¨è¡¨8.3ä¸­åˆ—å‡ºäº†è¿™äº›æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å¯¹fstreamã€ifstreamå’Œofstreamå¯¹è±¡è°ƒç”¨è¿™äº›æ“ä½œï¼Œä½†ä¸èƒ½å¯¹å…¶ä»–IOç±»å‹è°ƒç”¨è¿™äº›æ“ä½œã€‚</p><p><img src="/../images/C-C-Primer-Chapter-8/1726122800709.png"></p><h3 id="8-2-1-ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡"><a href="#8-2-1-ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡" class="headerlink" title="8.2.1 ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡"></a>8.2.1 ä½¿ç”¨æ–‡ä»¶æµå¯¹è±¡</h3><p>å½“æˆ‘ä»¬æƒ³è¦è¯»å†™ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæ–‡ä»¶æµå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡ä¸æ–‡ä»¶å…³è”èµ·æ¥ã€‚</p><p>åˆ›å»ºæ–‡ä»¶æµå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›æ–‡ä»¶åï¼ˆå¯é€‰çš„ï¼‰ã€‚å¦‚æœæä¾›äº†ä¸€ä¸ªæ–‡ä»¶åï¼Œåˆ™openä¼šè‡ªåŠ¨è¢«è°ƒç”¨ã€‚</p><p><strong>ç”¨fstreamä»£æ›¿iostream&amp;</strong></p><p>å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªostream&amp;å‚æ•°ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œå¯ä»¥ä¼ é€’ç»™å®ƒä¸€ä¸ªofstreamå¯¹è±¡ï¼Œå¯¹istream&amp;å’Œifstreamä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p><p><strong>æˆå‘˜å‡½æ•°openå’Œclose</strong></p><p>å¦‚æœè°ƒç”¨openå¤±è´¥ï¼Œfailbitä¼šè¢«ç½®ä½ï¼ˆå‚è§8.1.2èŠ‚ï¼Œç¬¬280é¡µï¼‰ã€‚å› ä¸ºè°ƒç”¨openå¯èƒ½å¤±è´¥ï¼Œè¿›è¡Œopenæ˜¯å¦æˆåŠŸçš„æ£€æµ‹é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-8/1726123055436.png"></p><p><img src="/../images/C-C-Primer-Chapter-8/1726123059038.png"></p><p>å¯¹ä¸€ä¸ªå·²ç»æ‰“å¼€çš„æ–‡ä»¶æµè°ƒç”¨openä¼šå¤±è´¥ï¼Œå¹¶ä¼šå¯¼è‡´failbitè¢«ç½®ä½ã€‚éšåçš„è¯•å›¾ä½¿ç”¨æ–‡ä»¶æµçš„æ“ä½œéƒ½ä¼šå¤±è´¥ã€‚ä¸ºäº†å°†æ–‡ä»¶æµå…³è”åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¿…é¡»é¦–å…ˆå…³é—­å·²ç»å…³è”çš„æ–‡ä»¶ã€‚</p><p><strong>è‡ªåŠ¨æ„é€ å’Œææ„</strong></p><p><img src="/../images/C-C-Primer-Chapter-8/1726123162740.png"></p><p>å½“ä¸€ä¸ªfstreamå¯¹è±¡ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶ï¼Œä¸ä¹‹å…³è”çš„æ–‡ä»¶ä¼šè‡ªåŠ¨å…³é—­ã€‚åœ¨ä¸‹ä¸€æ­¥å¾ªç¯ä¸­ï¼Œinputä¼šå†æ¬¡è¢«åˆ›å»ºã€‚</p><blockquote><p>å½“ä¸€ä¸ªfstreamå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œcloseä¼šè‡ªåŠ¨è¢«è°ƒç”¨ã€‚</p></blockquote><h3 id="8-2-2-æ–‡ä»¶æ¨¡å¼"><a href="#8-2-2-æ–‡ä»¶æ¨¡å¼" class="headerlink" title="8.2.2 æ–‡ä»¶æ¨¡å¼"></a>8.2.2 æ–‡ä»¶æ¨¡å¼</h3><p>æ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªå…³è”çš„æ–‡ä»¶æ¨¡å¼ï¼ˆfile modeï¼‰ï¼Œç”¨æ¥æŒ‡å‡ºå¦‚ä½•ä½¿ç”¨æ–‡ä»¶ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-8/1726123208713.png"></p><p>æŒ‡å®šæ–‡ä»¶æ¨¡å¼æœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p><ul><li>åªå¯ä»¥å¯¹ofstreamæˆ–fstreamå¯¹è±¡è®¾å®šoutæ¨¡å¼ã€‚</li><li>åªå¯ä»¥å¯¹ifstreamæˆ–fstreamå¯¹è±¡è®¾å®šinæ¨¡å¼ã€‚</li><li>åªæœ‰å½“outä¹Ÿè¢«è®¾å®šæ—¶æ‰å¯è®¾å®štruncæ¨¡å¼ã€‚</li><li>åªè¦truncæ²¡è¢«è®¾å®šï¼Œå°±å¯ä»¥è®¾å®šappæ¨¡å¼ã€‚åœ¨appæ¨¡å¼ä¸‹ï¼Œå³ä½¿æ²¡æœ‰æ˜¾å¼æŒ‡å®šoutæ¨¡å¼ï¼Œæ–‡ä»¶ä¹Ÿæ€»æ˜¯ä»¥è¾“å‡ºæ–¹å¼è¢«æ‰“å¼€ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰æŒ‡å®štruncï¼Œä»¥outæ¨¡å¼æ‰“å¼€çš„æ–‡ä»¶ä¹Ÿä¼šè¢«æˆªæ–­ã€‚ä¸ºäº†ä¿ç•™ä»¥outæ¨¡å¼æ‰“å¼€çš„æ–‡ä»¶çš„å†…å®¹ï¼Œæˆ‘ä»¬å¿…é¡»åŒæ—¶æŒ‡å®šappæ¨¡å¼ï¼Œè¿™æ ·åªä¼šå°†æ•°æ®è¿½åŠ å†™åˆ°æ–‡ä»¶æœ«å°¾ï¼›æˆ–è€…åŒæ—¶æŒ‡å®šinæ¨¡å¼ï¼Œå³æ‰“å¼€æ–‡ä»¶åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œï¼ˆå‚è§17.5.3èŠ‚ï¼Œç¬¬676é¡µï¼Œå°†ä»‹ç»å¯¹åŒä¸€ä¸ªæ–‡ä»¶æ—¢è¿›è¡Œè¾“å…¥åˆè¿›è¡Œè¾“å‡ºçš„æ–¹æ³•ï¼‰ã€‚</li><li>ateå’Œbinaryæ¨¡å¼å¯ç”¨äºä»»ä½•ç±»å‹çš„æ–‡ä»¶æµå¯¹è±¡ï¼Œä¸”å¯ä»¥ä¸å…¶ä»–ä»»ä½•æ–‡ä»¶æ¨¡å¼ç»„åˆä½¿ç”¨ã€‚</li></ul><p>æ¯ä¸ªæ–‡ä»¶æµç±»å‹éƒ½å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤çš„æ–‡ä»¶æ¨¡å¼ï¼Œå½“æˆ‘ä»¬æœªæŒ‡å®šæ–‡ä»¶æ¨¡å¼æ—¶ï¼Œå°±ä½¿ç”¨æ­¤é»˜è®¤æ¨¡å¼ã€‚ä¸ifstreamå…³è”çš„æ–‡ä»¶é»˜è®¤ä»¥inæ¨¡å¼æ‰“å¼€ï¼›ä¸ofstreamå…³è”çš„æ–‡ä»¶é»˜è®¤ä»¥outæ¨¡å¼æ‰“å¼€ï¼›ä¸fstreamå…³è”çš„æ–‡ä»¶é»˜è®¤ä»¥inå’Œoutæ¨¡å¼æ‰“å¼€ã€‚</p><p><strong>ä»¥outæ¨¡å¼æ‰“å¼€æ–‡ä»¶ä¼šä¸¢å¼ƒå·²æœ‰æ•°æ®</strong></p><p><img src="/../images/C-C-Primer-Chapter-8/1726123354564.png"></p><blockquote><p>ä¿ç•™è¢«ofstreamæ‰“å¼€çš„æ–‡ä»¶ä¸­å·²æœ‰æ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯æ˜¾å¼æŒ‡å®šappæˆ–inæ¨¡å¼ã€‚</p></blockquote><p><strong>æ¯æ¬¡è°ƒç”¨openæ—¶éƒ½ä¼šç¡®å®šæ–‡ä»¶æ¨¡å¼</strong></p><p>å¯¹äºä¸€ä¸ªç»™å®šæµï¼Œæ¯å½“æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œéƒ½å¯ä»¥æ”¹å˜å…¶æ–‡ä»¶æ¨¡å¼ã€‚</p><h2 id="8-3-stringæµ"><a href="#8-3-stringæµ" class="headerlink" title="8.3 stringæµ"></a>8.3 stringæµ</h2><p>istringstreamä»stringè¯»å–æ•°æ®ï¼Œostringstreamå‘stringå†™å…¥æ•°æ®ï¼Œè€Œå¤´æ–‡ä»¶stringstreamæ—¢å¯ä»stringè¯»æ•°æ®ä¹Ÿå¯å‘stringå†™æ•°æ®ã€‚</p><p>é™¤äº†ç»§æ‰¿å¾—æ¥çš„æ“ä½œï¼Œsstreamä¸­å®šä¹‰çš„ç±»å‹è¿˜å¢åŠ äº†ä¸€äº›æˆå‘˜æ¥ç®¡ç†ä¸æµç›¸å…³è”çš„stringã€‚</p><p><img src="/../images/C-C-Primer-Chapter-8/1726123827260.png"></p><h3 id="8-3-1-ä½¿ç”¨istringstream"><a href="#8-3-1-ä½¿ç”¨istringstream" class="headerlink" title="8.3.1 ä½¿ç”¨istringstream"></a>8.3.1 ä½¿ç”¨istringstream</h3><p>å½“æˆ‘ä»¬çš„æŸäº›å·¥ä½œæ˜¯å¯¹æ•´è¡Œæ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œè€Œå…¶ä»–ä¸€äº›å·¥ä½œæ˜¯å¤„ç†è¡Œå†…çš„å•ä¸ªå•è¯æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨istringstreamã€‚</p><p><img src="/../images/C-C-Primer-Chapter-8/1726124057228.png"></p><h3 id="8-3-2-ä½¿ç”¨ostringstream"><a href="#8-3-2-ä½¿ç”¨ostringstream" class="headerlink" title="8.3.2 ä½¿ç”¨ostringstream"></a>8.3.2 ä½¿ç”¨ostringstream</h3><p>å½“æˆ‘ä»¬é€æ­¥æ„é€ è¾“å‡ºï¼Œå¸Œæœ›æœ€åä¸€èµ·æ‰“å°æ—¶ï¼Œostringstreamæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-8/image-20240922130926153.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 7</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-7/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-7/</url>
    
    <content type="html"><![CDATA[<h1 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h1><span id="more"></span><p>ç±»çš„åŸºæœ¬æ€æƒ³æ˜¯æ•°æ®æŠ½è±¡ï¼ˆdata abstractionï¼‰å’Œå°è£…ï¼ˆencapsulationï¼‰ã€‚æ•°æ®æŠ½è±¡æ˜¯ä¸€ç§ä¾èµ–äºæ¥å£ï¼ˆinterfaceï¼‰å’Œå®ç°ï¼ˆimplementationï¼‰åˆ†ç¦»çš„ç¼–ç¨‹ï¼ˆä»¥åŠè®¾è®¡ï¼‰æŠ€æœ¯ã€‚</p><p>ç±»çš„æ¥å£åŒ…æ‹¬ç”¨æˆ·æ‰€èƒ½æ‰§è¡Œçš„æ“ä½œï¼›ç±»çš„å®ç°åˆ™åŒ…æ‹¬ç±»çš„æ•°æ®æˆå‘˜ã€è´Ÿè´£æ¥å£å®ç°çš„å‡½æ•°ä½“ä»¥åŠå®šä¹‰ç±»æ‰€éœ€çš„å„ç§ç§æœ‰å‡½æ•°ã€‚</p><p>ç±»è¦æƒ³å®ç°æ•°æ®æŠ½è±¡å’Œå°è£…ï¼Œéœ€è¦é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡æ•°æ®ç±»å‹ï¼ˆabstract data typeï¼‰ã€‚åœ¨æŠ½è±¡æ•°æ®ç±»å‹ä¸­ï¼Œç”±ç±»çš„è®¾è®¡è€…è´Ÿè´£è€ƒè™‘ç±»çš„å®ç°è¿‡ç¨‹ï¼›ä½¿ç”¨è¯¥ç±»çš„ç¨‹åºå‘˜åˆ™åªéœ€è¦æŠ½è±¡åœ°æ€è€ƒç±»å‹åšäº†ä»€ä¹ˆï¼Œè€Œæ— é¡»äº†è§£ç±»å‹çš„å·¥ä½œç»†èŠ‚ã€‚</p><h2 id="7-1-å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹"><a href="#7-1-å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="7.1 å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹"></a>7.1 å®šä¹‰æŠ½è±¡æ•°æ®ç±»å‹</h2><h3 id="7-1-1-è®¾è®¡Sales-dataç±»"><a href="#7-1-1-è®¾è®¡Sales-dataç±»" class="headerlink" title="7.1.1 è®¾è®¡Sales_dataç±»"></a>7.1.1 è®¾è®¡Sales_dataç±»</h3><p>ç”±äº14.1èŠ‚ï¼ˆç¬¬490é¡µï¼‰å°†è¦è§£é‡Šçš„åŸå› ï¼Œæ‰§è¡ŒåŠ æ³•å’ŒIOçš„å‡½æ•°ä¸ä½œä¸ºSales_dataçš„æˆå‘˜ï¼Œç›¸åçš„ï¼Œæˆ‘ä»¬å°†å…¶å®šä¹‰æˆæ™®é€šå‡½æ•°ï¼›æ‰§è¡Œå¤åˆèµ‹å€¼è¿ç®—çš„å‡½æ•°æ˜¯æˆå‘˜å‡½æ•°ã€‚</p><h3 id="7-1-2-å®šä¹‰æ”¹è¿›çš„Sales-dataç±»"><a href="#7-1-2-å®šä¹‰æ”¹è¿›çš„Sales-dataç±»" class="headerlink" title="7.1.2 å®šä¹‰æ”¹è¿›çš„Sales_dataç±»"></a>7.1.2 å®šä¹‰æ”¹è¿›çš„Sales_dataç±»</h3><p><strong>å¼•å…¥this</strong></p><p>thisæ˜¯ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆï¼ŒæŒ‡å‘â€œè¿™ä¸ªâ€å¯¹è±¡ã€‚</p><p><strong>å¼•å…¥constæˆå‘˜å‡½æ•°</strong></p><p>æŠŠconstå…³é”®å­—æ”¾åœ¨æˆå‘˜å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¹‹åï¼Œæ­¤æ—¶ï¼Œç´§è·Ÿåœ¨å‚æ•°åˆ—è¡¨åé¢çš„constè¡¨ç¤ºthisæ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆã€‚åƒè¿™æ ·ä½¿ç”¨constçš„æˆå‘˜å‡½æ•°è¢«ç§°ä½œå¸¸é‡æˆå‘˜å‡½æ•°ï¼ˆconst member functionï¼‰ã€‚</p><blockquote><p>å¸¸é‡å¯¹è±¡ï¼Œä»¥åŠå¸¸é‡å¯¹è±¡çš„å¼•ç”¨æˆ–æŒ‡é’ˆéƒ½åªèƒ½è°ƒç”¨å¸¸é‡æˆå‘˜å‡½æ•°ã€‚</p></blockquote><p><strong>ç±»ä½œç”¨åŸŸå’Œæˆå‘˜å‡½æ•°</strong></p><p>ç¼–è¯‘å™¨åˆ†ä¸¤æ­¥å¤„ç†ç±»ï¼šé¦–å…ˆç¼–è¯‘æˆå‘˜çš„å£°æ˜ï¼Œç„¶åæ‰è½®åˆ°æˆå‘˜å‡½æ•°ä½“ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å› æ­¤ï¼Œæˆå‘˜å‡½æ•°ä½“å¯ä»¥éšæ„ä½¿ç”¨ç±»ä¸­çš„å…¶ä»–æˆå‘˜è€Œæ— é¡»åœ¨æ„è¿™äº›æˆå‘˜å‡ºç°çš„æ¬¡åºã€‚</p><p><strong>åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰æˆå‘˜å‡½æ•°</strong></p><p><strong>å®šä¹‰ä¸€ä¸ªè¿”å›thiså¯¹è±¡çš„å‡½æ•°</strong></p><p>å†…ç½®çš„èµ‹å€¼è¿ç®—ç¬¦æŠŠå®ƒçš„å·¦ä¾§è¿ç®—å¯¹è±¡å½“æˆ<strong>å·¦å€¼</strong>è¿”å›ï¼ˆå‚è§4.4èŠ‚ï¼Œç¬¬129é¡µï¼‰ï¼Œå› æ­¤ä¸ºäº†ä¸å®ƒä¿æŒä¸€è‡´ï¼Œcombineå‡½æ•°ï¼ˆé‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼‰å¿…é¡»è¿”å›å¼•ç”¨ç±»å‹ï¼ˆå‚è§6.3.2èŠ‚ï¼Œç¬¬202é¡µï¼‰ã€‚å› ä¸ºæ­¤æ—¶çš„å·¦ä¾§è¿ç®—å¯¹è±¡æ˜¯ä¸€ä¸ªSales_dataçš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿”å›ç±»å‹åº”è¯¥æ˜¯Sales_data&amp;ã€‚</p><h3 id="7-1-3-å®šä¹‰ç±»ç›¸å…³çš„éæˆå‘˜å‡½æ•°"><a href="#7-1-3-å®šä¹‰ç±»ç›¸å…³çš„éæˆå‘˜å‡½æ•°" class="headerlink" title="7.1.3 å®šä¹‰ç±»ç›¸å…³çš„éæˆå‘˜å‡½æ•°"></a>7.1.3 å®šä¹‰ç±»ç›¸å…³çš„éæˆå‘˜å‡½æ•°</h3><p>æˆ‘ä»¬å®šä¹‰éæˆå‘˜å‡½æ•°çš„æ–¹å¼ä¸å®šä¹‰å…¶ä»–å‡½æ•°ä¸€æ ·ï¼Œé€šå¸¸æŠŠå‡½æ•°çš„å£°æ˜å’Œå®šä¹‰åˆ†ç¦»å¼€æ¥ï¼ˆå‚è§6.1.2èŠ‚ï¼Œç¬¬168é¡µï¼‰ã€‚å¦‚æœå‡½æ•°åœ¨æ¦‚å¿µä¸Šå±äºç±»ä½†æ˜¯ä¸å®šä¹‰åœ¨ç±»ä¸­ï¼Œåˆ™å®ƒä¸€èˆ¬åº”ä¸ç±»å£°æ˜ï¼ˆè€Œéå®šä¹‰ï¼‰åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶å†…ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œç”¨æˆ·ä½¿ç”¨æ¥å£çš„ä»»ä½•éƒ¨åˆ†éƒ½åªéœ€è¦å¼•å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœéæˆå‘˜å‡½æ•°æ˜¯ç±»æ¥å£çš„ç»„æˆéƒ¨åˆ†ï¼Œåˆ™è¿™äº›å‡½æ•°çš„å£°æ˜åº”è¯¥ä¸ç±»åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶å†…ã€‚</p></blockquote><p><strong>å®šä¹‰readå’Œprintå‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-7/1726041043380.png"></p><p>ç¬¬ä¸€ç‚¹ï¼Œreadå’Œprintåˆ†åˆ«æ¥å—ä¸€ä¸ªå„è‡ªIOç±»å‹çš„å¼•ç”¨ä½œä¸ºå…¶å‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºIOç±»å±äºä¸èƒ½è¢«æ‹·è´çš„ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½é€šè¿‡å¼•ç”¨æ¥ä¼ é€’å®ƒä»¬ï¼ˆå‚è§6.2.2èŠ‚ï¼Œç¬¬188é¡µï¼‰ã€‚è€Œä¸”ï¼Œå› ä¸ºè¯»å–å’Œå†™å…¥çš„æ“ä½œä¼šæ”¹å˜æµçš„å†…å®¹ï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°æ¥å—çš„éƒ½æ˜¯æ™®é€šå¼•ç”¨ï¼Œè€Œéå¯¹å¸¸é‡çš„å¼•ç”¨ã€‚</p><p>ç¬¬äºŒç‚¹ï¼Œprintå‡½æ•°ä¸è´Ÿè´£æ¢è¡Œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œè¾“å‡ºä»»åŠ¡çš„å‡½æ•°åº”è¯¥å°½é‡å‡å°‘å¯¹æ ¼å¼çš„æ§åˆ¶ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç”±ç”¨æˆ·ä»£ç æ¥å†³å®šæ˜¯å¦æ¢è¡Œã€‚</p><p><strong>å®šä¹‰addå‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-7/1726041120522.png"></p><h3 id="7-1-4-æ„é€ å‡½æ•°"><a href="#7-1-4-æ„é€ å‡½æ•°" class="headerlink" title="7.1.4 æ„é€ å‡½æ•°"></a>7.1.4 æ„é€ å‡½æ•°</h3><p>æ¯ä¸ªç±»éƒ½åˆ†åˆ«å®šä¹‰äº†å®ƒçš„å¯¹è±¡è¢«åˆå§‹åŒ–çš„æ–¹å¼ï¼Œç±»é€šè¿‡ä¸€ä¸ªæˆ–å‡ ä¸ªç‰¹æ®Šçš„æˆå‘˜å‡½æ•°æ¥æ§åˆ¶å…¶å¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™äº›å‡½æ•°å«åšæ„é€ å‡½æ•°ï¼ˆconstructorï¼‰ã€‚</p><p>ä¸åŒäºå…¶ä»–æˆå‘˜å‡½æ•°ï¼Œæ„é€ å‡½æ•°ä¸èƒ½è¢«å£°æ˜æˆconstçš„ï¼ˆå‚è§7.1.2èŠ‚ï¼Œç¬¬231é¡µï¼‰ã€‚</p><p><strong>åˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°</strong></p><p>ç±»é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„æ„é€ å‡½æ•°æ¥æ§åˆ¶é»˜è®¤åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ä¸ªå‡½æ•°å«åšé»˜è®¤æ„é€ å‡½æ•°ï¼ˆdefault constructorï¼‰ã€‚é»˜è®¤æ„é€ å‡½æ•°æ— é¡»ä»»ä½•å®å‚ã€‚</p><p>å¦‚æœæˆ‘ä»¬çš„ç±»æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šä¸ºæˆ‘ä»¬éšå¼åœ°å®šä¹‰ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ã€‚ç¼–è¯‘å™¨åˆ›å»ºçš„æ„é€ å‡½æ•°åˆè¢«ç§°ä¸ºåˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°ï¼ˆsynthesized default constructorï¼‰ã€‚å¯¹äºå¤§å¤šæ•°ç±»æ¥è¯´ï¼Œè¿™ä¸ªåˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°å°†æŒ‰ç…§å¦‚ä¸‹è§„åˆ™åˆå§‹åŒ–ç±»çš„æ•°æ®æˆå‘˜ï¼š</p><p>å¦‚æœå­˜åœ¨ç±»å†…çš„åˆå§‹å€¼ï¼ˆå‚è§2.6.1èŠ‚ï¼Œç¬¬64é¡µï¼‰ï¼Œç”¨å®ƒæ¥åˆå§‹åŒ–æˆå‘˜ã€‚</p><p>å¦åˆ™ï¼Œé»˜è®¤åˆå§‹åŒ–ï¼ˆå‚è§2.2.1èŠ‚ï¼Œç¬¬40é¡µï¼‰è¯¥æˆå‘˜ã€‚</p><p><strong>æŸäº›ç±»ä¸èƒ½ä¾èµ–äºåˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°</strong></p><blockquote><p>åªæœ‰å½“ç±»æ²¡æœ‰å£°æ˜ä»»ä½•æ„é€ å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨æ‰ä¼šè‡ªåŠ¨åœ°ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ã€‚</p></blockquote><blockquote><p>å¦‚æœç±»åŒ…å«æœ‰å†…ç½®ç±»å‹æˆ–è€…å¤åˆç±»å‹çš„æˆå‘˜ï¼Œåˆ™åªæœ‰å½“è¿™äº›æˆå‘˜å…¨éƒ½è¢«èµ‹äºˆäº†ç±»å†…çš„åˆå§‹å€¼æ—¶ï¼Œè¿™ä¸ªç±»æ‰é€‚åˆäºä½¿ç”¨åˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°ã€‚</p></blockquote><p>å¦‚æœç±»ä¸­åŒ…å«ä¸€ä¸ªå…¶ä»–ç±»ç±»å‹çš„æˆå‘˜ä¸”è¿™ä¸ªæˆå‘˜çš„ç±»å‹æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°†æ— æ³•åˆå§‹åŒ–è¯¥æˆå‘˜ã€‚</p><p><strong>&#x3D; defaultçš„å«ä¹‰</strong></p><p>åœ¨C++11æ–°æ ‡å‡†ä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦é»˜è®¤çš„è¡Œä¸ºï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åœ¨å‚æ•°åˆ—è¡¨åé¢å†™ä¸Š&#x3D; defaultæ¥è¦æ±‚ç¼–è¯‘å™¨ç”Ÿæˆæ„é€ å‡½æ•°ã€‚å…¶ä¸­ï¼Œ&#x3D; defaultæ—¢å¯ä»¥å’Œå£°æ˜ä¸€èµ·å‡ºç°åœ¨ç±»çš„å†…éƒ¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå®šä¹‰å‡ºç°åœ¨ç±»çš„å¤–éƒ¨ã€‚å’Œå…¶ä»–å‡½æ•°ä¸€æ ·ï¼Œå¦‚æœ&#x3D; defaultåœ¨ç±»çš„å†…éƒ¨ï¼Œåˆ™é»˜è®¤æ„é€ å‡½æ•°æ˜¯å†…è”çš„ï¼›å¦‚æœå®ƒåœ¨ç±»çš„å¤–éƒ¨ï¼Œåˆ™è¯¥æˆå‘˜é»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯å†…è”çš„ã€‚</p><p><strong>æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨</strong></p><blockquote><p>æ„é€ å‡½æ•°ä¸åº”è¯¥è½»æ˜“è¦†ç›–æ‰ç±»å†…çš„åˆå§‹å€¼ï¼Œé™¤éæ–°èµ‹çš„å€¼ä¸åŸå€¼ä¸åŒã€‚å¦‚æœä½ ä¸èƒ½ä½¿ç”¨ç±»å†…åˆå§‹å€¼ï¼Œåˆ™æ‰€æœ‰æ„é€ å‡½æ•°éƒ½åº”è¯¥æ˜¾å¼åœ°åˆå§‹åŒ–æ¯ä¸ªå†…ç½®ç±»å‹çš„æˆå‘˜ã€‚</p></blockquote><h3 id="7-1-5-æ‹·è´ã€èµ‹å€¼å’Œææ„"><a href="#7-1-5-æ‹·è´ã€èµ‹å€¼å’Œææ„" class="headerlink" title="7.1.5 æ‹·è´ã€èµ‹å€¼å’Œææ„"></a>7.1.5 æ‹·è´ã€èµ‹å€¼å’Œææ„</h3><h2 id="7-2-è®¿é—®æ§åˆ¶ä¸å°è£…"><a href="#7-2-è®¿é—®æ§åˆ¶ä¸å°è£…" class="headerlink" title="7.2 è®¿é—®æ§åˆ¶ä¸å°è£…"></a>7.2 è®¿é—®æ§åˆ¶ä¸å°è£…</h2><p>åœ¨C++è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è®¿é—®è¯´æ˜ç¬¦ï¼ˆaccess specifiersï¼‰åŠ å¼ºç±»çš„å°è£…æ€§</p><p>å®šä¹‰åœ¨publicè¯´æ˜ç¬¦ä¹‹åçš„æˆå‘˜åœ¨æ•´ä¸ªç¨‹åºå†…å¯è¢«è®¿é—®ï¼Œpublicæˆå‘˜å®šä¹‰ç±»çš„æ¥å£ã€‚</p><p>å®šä¹‰åœ¨privateè¯´æ˜ç¬¦ä¹‹åçš„æˆå‘˜å¯ä»¥è¢«ç±»çš„æˆå‘˜å‡½æ•°è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½è¢«ä½¿ç”¨è¯¥ç±»çš„ä»£ç è®¿é—®ï¼Œprivateéƒ¨åˆ†å°è£…äº†ï¼ˆå³éšè—äº†ï¼‰ç±»çš„å®ç°ç»†èŠ‚ã€‚</p><h3 id="7-2-1-å‹å…ƒ"><a href="#7-2-1-å‹å…ƒ" class="headerlink" title="7.2.1 å‹å…ƒ"></a>7.2.1 å‹å…ƒ</h3><p>ç±»å¯ä»¥å…è®¸å…¶ä»–ç±»æˆ–è€…å‡½æ•°è®¿é—®å®ƒçš„éå…¬æœ‰æˆå‘˜ï¼Œæ–¹æ³•æ˜¯ä»¤å…¶ä»–ç±»æˆ–è€…å‡½æ•°æˆä¸ºå®ƒçš„å‹å…ƒï¼ˆfriendï¼‰ã€‚å¦‚æœç±»æƒ³æŠŠä¸€ä¸ªå‡½æ•°ä½œä¸ºå®ƒçš„å‹å…ƒï¼Œåªéœ€è¦å¢åŠ ä¸€æ¡ä»¥friendå…³é”®å­—å¼€å§‹çš„å‡½æ•°å£°æ˜è¯­å¥å³å¯</p><p><img src="/../images/C-C-Primer-Chapter-7/1726041734487.png"></p><p>å‹å…ƒå£°æ˜åªèƒ½å‡ºç°åœ¨ç±»å®šä¹‰çš„å†…éƒ¨ï¼Œä½†æ˜¯åœ¨ç±»å†…å‡ºç°çš„å…·ä½“ä½ç½®ä¸é™ã€‚å‹å…ƒä¸æ˜¯ç±»çš„æˆå‘˜ä¹Ÿä¸å—å®ƒæ‰€åœ¨åŒºåŸŸè®¿é—®æ§åˆ¶çº§åˆ«çš„çº¦æŸã€‚</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œæœ€å¥½åœ¨ç±»å®šä¹‰å¼€å§‹æˆ–ç»“æŸå‰çš„ä½ç½®é›†ä¸­å£°æ˜å‹å…ƒã€‚</p></blockquote><p><strong>å…³é”®æ¦‚å¿µï¼šå°è£…çš„ç›Šå¤„</strong></p><p>å°è£…æœ‰ä¸¤ä¸ªé‡è¦çš„ä¼˜ç‚¹ï¼š</p><p>ç¡®ä¿ç”¨æˆ·ä»£ç ä¸ä¼šæ— æ„é—´ç ´åå°è£…å¯¹è±¡çš„çŠ¶æ€ã€‚</p><p>è¢«å°è£…çš„ç±»çš„å…·ä½“å®ç°ç»†èŠ‚å¯ä»¥éšæ—¶æ”¹å˜ï¼Œè€Œæ— é¡»è°ƒæ•´ç”¨æˆ·çº§åˆ«çš„ä»£ç ã€‚</p><p><strong>å‹å…ƒçš„å£°æ˜</strong></p><p>å‹å…ƒçš„å£°æ˜ä»…ä»…æŒ‡å®šäº†è®¿é—®çš„æƒé™ï¼Œè€Œéä¸€ä¸ªé€šå¸¸æ„ä¹‰ä¸Šçš„å‡½æ•°å£°æ˜ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ç±»çš„ç”¨æˆ·èƒ½å¤Ÿè°ƒç”¨æŸä¸ªå‹å…ƒå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»åœ¨å‹å…ƒå£°æ˜ä¹‹å¤–å†ä¸“é—¨å¯¹å‡½æ•°è¿›è¡Œä¸€æ¬¡å£°æ˜ã€‚</p><p>ä¸ºäº†ä½¿å‹å…ƒå¯¹ç±»çš„ç”¨æˆ·å¯è§ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠå‹å…ƒçš„å£°æ˜ä¸ç±»æœ¬èº«æ”¾ç½®åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ï¼ˆç±»çš„å¤–éƒ¨ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„Sales_dataå¤´æ–‡ä»¶åº”è¯¥ä¸ºreadã€printå’Œaddæä¾›ç‹¬ç«‹çš„å£°æ˜ï¼ˆé™¤äº†ç±»å†…éƒ¨çš„å‹å…ƒå£°æ˜ä¹‹å¤–ï¼‰ã€‚</p><h2 id="7-3-ç±»çš„å…¶ä»–ç‰¹æ€§"><a href="#7-3-ç±»çš„å…¶ä»–ç‰¹æ€§" class="headerlink" title="7.3 ç±»çš„å…¶ä»–ç‰¹æ€§"></a>7.3 ç±»çš„å…¶ä»–ç‰¹æ€§</h2><h3 id="7-3-1-ç±»æˆå‘˜å†æ¢"><a href="#7-3-1-ç±»æˆå‘˜å†æ¢" class="headerlink" title="7.3.1 ç±»æˆå‘˜å†æ¢"></a>7.3.1 ç±»æˆå‘˜å†æ¢</h3><p>é™¤äº†å®šä¹‰æ•°æ®å’Œå‡½æ•°æˆå‘˜ä¹‹å¤–ï¼Œç±»è¿˜å¯ä»¥è‡ªå®šä¹‰æŸç§ç±»å‹åœ¨ç±»ä¸­çš„åˆ«åã€‚ç”±ç±»å®šä¹‰çš„ç±»å‹åå­—å’Œå…¶ä»–æˆå‘˜ä¸€æ ·å­˜åœ¨è®¿é—®é™åˆ¶ï¼Œå¯ä»¥æ˜¯publicæˆ–è€…privateä¸­çš„ä¸€ç§ã€‚ç”¨æ¥å®šä¹‰ç±»å‹çš„æˆå‘˜å¿…é¡»å…ˆå®šä¹‰åä½¿ç”¨ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-7/1726041953519.png"></p><p><strong>ä»¤æˆå‘˜ä½œä¸ºå†…è”å‡½æ•°</strong></p><p>æˆ‘ä»¬å¯ä»¥åœ¨ç±»çš„å†…éƒ¨æŠŠinlineä½œä¸ºå£°æ˜çš„ä¸€éƒ¨åˆ†æ˜¾å¼åœ°å£°æ˜æˆå‘˜å‡½æ•°ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿèƒ½åœ¨ç±»çš„å¤–éƒ¨ç”¨inlineå…³é”®å­—ä¿®é¥°å‡½æ•°çš„å®šä¹‰ï¼šè™½ç„¶æˆ‘ä»¬æ— é¡»åœ¨å£°æ˜å’Œå®šä¹‰çš„åœ°æ–¹åŒæ—¶è¯´æ˜inlineï¼Œä½†è¿™ä¹ˆåšå…¶å®æ˜¯åˆæ³•çš„ã€‚ä¸è¿‡ï¼Œ<strong>æœ€å¥½</strong>åªåœ¨ç±»å¤–éƒ¨å®šä¹‰çš„åœ°æ–¹è¯´æ˜inlineï¼Œè¿™æ ·å¯ä»¥ä½¿ç±»æ›´å®¹æ˜“ç†è§£ã€‚</p><blockquote><p>inlineæˆå‘˜å‡½æ•°ä¹Ÿåº”è¯¥ä¸ç›¸åº”çš„ç±»å®šä¹‰åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ã€‚</p></blockquote><p><strong>é‡è½½æˆå‘˜å‡½æ•°</strong></p><p><strong>å¯å˜æ•°æ®æˆå‘˜</strong></p><p>æœ‰æ—¶ï¼ˆä½†å¹¶ä¸é¢‘ç¹ï¼‰ä¼šå‘ç”Ÿè¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½ä¿®æ”¹ç±»çš„æŸä¸ªæ•°æ®æˆå‘˜ï¼Œå³ä½¿æ˜¯åœ¨ä¸€ä¸ªconstæˆå‘˜å‡½æ•°å†…ã€‚å¯ä»¥é€šè¿‡åœ¨å˜é‡çš„å£°æ˜ä¸­åŠ å…¥mutableå…³é”®å­—åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ä¸€ä¸ªå¯å˜æ•°æ®æˆå‘˜ï¼ˆmutable data memberï¼‰æ°¸è¿œä¸ä¼šæ˜¯constï¼Œå³ä½¿å®ƒæ˜¯constå¯¹è±¡çš„æˆå‘˜ã€‚</p><p><strong>ç±»æ•°æ®æˆå‘˜çš„åˆå§‹å€¼</strong></p><p>ç±»å†…åˆå§‹å€¼å¿…é¡»ä½¿ç”¨&#x3D;çš„åˆå§‹åŒ–å½¢å¼ï¼ˆåˆå§‹åŒ–Screençš„æ•°æ®æˆå‘˜æ—¶æ‰€ç”¨çš„ï¼‰æˆ–è€…èŠ±æ‹¬å·æ‹¬èµ·æ¥çš„ç›´æ¥åˆå§‹åŒ–å½¢å¼ï¼ˆåˆå§‹åŒ–screensæ‰€ç”¨çš„ï¼‰ã€‚</p><blockquote><p>å½“æˆ‘ä»¬æä¾›ä¸€ä¸ªç±»å†…åˆå§‹å€¼æ—¶ï¼Œå¿…é¡»ä»¥ç¬¦å·&#x3D;æˆ–è€…èŠ±æ‹¬å·è¡¨ç¤ºã€‚</p></blockquote><h3 id="7-3-2-è¿”å›-thisçš„æˆå‘˜å‡½æ•°"><a href="#7-3-2-è¿”å›-thisçš„æˆå‘˜å‡½æ•°" class="headerlink" title="7.3.2 è¿”å›*thisçš„æˆå‘˜å‡½æ•°"></a>7.3.2 è¿”å›*thisçš„æˆå‘˜å‡½æ•°</h3><p><strong>ä»constæˆå‘˜å‡½æ•°è¿”å›ï¼Šthis</strong></p><blockquote><p>ä¸€ä¸ªconstæˆå‘˜å‡½æ•°å¦‚æœä»¥å¼•ç”¨çš„å½¢å¼è¿”å›ï¼Šthisï¼Œé‚£ä¹ˆå®ƒçš„è¿”å›ç±»å‹å°†æ˜¯å¸¸é‡å¼•ç”¨ã€‚</p></blockquote><p><strong>åŸºäºconstçš„é‡è½½</strong></p><p>é€šè¿‡åŒºåˆ†æˆå‘˜å‡½æ•°æ˜¯å¦æ˜¯constçš„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œé‡è½½</p><p><img src="/../images/C-C-Primer-Chapter-7/1726042483856.png"></p><p><strong>å»ºè®®ï¼šå¯¹äºå…¬å…±ä»£ç ä½¿ç”¨ç§æœ‰åŠŸèƒ½å‡½æ•°</strong></p><h3 id="7-3-3-ç±»ç±»å‹"><a href="#7-3-3-ç±»ç±»å‹" class="headerlink" title="7.3.3 ç±»ç±»å‹"></a>7.3.3 ç±»ç±»å‹</h3><p>æ¯ä¸ªç±»å®šä¹‰äº†å”¯ä¸€çš„ç±»å‹ã€‚å¯¹äºä¸¤ä¸ªç±»æ¥è¯´ï¼Œå³ä½¿å®ƒä»¬çš„æˆå‘˜å®Œå…¨ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªç±»ä¹Ÿæ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚</p><p><strong>ç±»çš„å£°æ˜</strong></p><p>æˆ‘ä»¬ä¹Ÿèƒ½ä»…ä»…å£°æ˜ç±»è€Œæš‚æ—¶ä¸å®šä¹‰å®ƒ</p><p>è¿™ç§å£°æ˜æœ‰æ—¶è¢«ç§°ä½œå‰å‘å£°æ˜ï¼ˆforward declarationï¼‰ï¼Œå®ƒå‘ç¨‹åºä¸­å¼•å…¥äº†åå­—Screenå¹¶ä¸”æŒ‡æ˜Screenæ˜¯ä¸€ç§ç±»ç±»å‹ã€‚å¯¹äºç±»å‹Screenæ¥è¯´ï¼Œåœ¨å®ƒå£°æ˜ä¹‹åå®šä¹‰ä¹‹å‰æ˜¯ä¸€ä¸ªä¸å®Œå…¨ç±»å‹ï¼ˆincomplete typeï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶æˆ‘ä»¬å·²çŸ¥Screenæ˜¯ä¸€ä¸ªç±»ç±»å‹ï¼Œä½†æ˜¯ä¸æ¸…æ¥šå®ƒåˆ°åº•åŒ…å«å“ªäº›æˆå‘˜ã€‚</p><p>ä¸å®Œå…¨ç±»å‹åªèƒ½åœ¨éå¸¸æœ‰é™çš„æƒ…æ™¯ä¸‹ä½¿ç”¨ï¼šå¯ä»¥å®šä¹‰æŒ‡å‘è¿™ç§ç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥å£°æ˜ï¼ˆä½†æ˜¯ä¸èƒ½å®šä¹‰ï¼‰ä»¥ä¸å®Œå…¨ç±»å‹ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›ç±»å‹çš„å‡½æ•°ã€‚</p><p>ä¸€ä¸ªç±»çš„æˆå‘˜ç±»å‹ä¸èƒ½æ˜¯è¯¥ç±»è‡ªå·±ã€‚ç„¶è€Œï¼Œä¸€æ—¦ä¸€ä¸ªç±»çš„åå­—å‡ºç°åï¼Œå®ƒå°±è¢«è®¤ä¸ºæ˜¯å£°æ˜è¿‡äº†ï¼ˆä½†å°šæœªå®šä¹‰ï¼‰ï¼Œå› æ­¤ç±»å…è®¸åŒ…å«æŒ‡å‘å®ƒè‡ªèº«ç±»å‹çš„å¼•ç”¨æˆ–æŒ‡é’ˆ</p><h3 id="7-3-4-å‹å…ƒå†æ¢"><a href="#7-3-4-å‹å…ƒå†æ¢" class="headerlink" title="7.3.4 å‹å…ƒå†æ¢"></a>7.3.4 å‹å…ƒå†æ¢</h3><p>ç±»è¿˜å¯ä»¥æŠŠå…¶ä»–çš„ç±»å®šä¹‰æˆå‹å…ƒï¼Œä¹Ÿå¯ä»¥æŠŠå…¶ä»–ç±»ï¼ˆä¹‹å‰å·²å®šä¹‰è¿‡çš„ï¼‰çš„æˆå‘˜å‡½æ•°å®šä¹‰æˆå‹å…ƒã€‚æ­¤å¤–ï¼Œå‹å…ƒå‡½æ•°èƒ½å®šä¹‰åœ¨ç±»çš„å†…éƒ¨ï¼Œè¿™æ ·çš„å‡½æ•°æ˜¯éšå¼å†…è”çš„ã€‚</p><p><strong>ç±»ä¹‹é—´çš„å‹å…ƒå…³ç³»</strong></p><p>å‹å…ƒå…³ç³»ä¸å­˜åœ¨ä¼ é€’æ€§ã€‚</p><p><strong>ä»¤æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒ</strong></p><p>é™¤äº†ä»¤æ•´ä¸ªWindow_mgrä½œä¸ºå‹å…ƒä¹‹å¤–ï¼ŒScreenè¿˜å¯ä»¥åªä¸ºclearæä¾›è®¿é—®æƒé™ã€‚å½“æŠŠä¸€ä¸ªæˆå‘˜å‡½æ•°å£°æ˜æˆå‹å…ƒæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ç¡®æŒ‡å‡ºè¯¥æˆå‘˜å‡½æ•°å±äºå“ªä¸ªç±»</p><p><img src="/../images/C-C-Primer-Chapter-7/1726042842056.png"></p><p>é¦–å…ˆå®šä¹‰Window_mgrç±»ï¼Œå…¶ä¸­å£°æ˜clearå‡½æ•°ï¼Œä½†æ˜¯ä¸èƒ½å®šä¹‰å®ƒã€‚åœ¨clearä½¿ç”¨Screençš„æˆå‘˜ä¹‹å‰å¿…é¡»å…ˆå£°æ˜Screenã€‚</p><p>æ¥ä¸‹æ¥å®šä¹‰Screenï¼ŒåŒ…æ‹¬å¯¹äºclearçš„å‹å…ƒå£°æ˜ã€‚</p><p>æœ€åå®šä¹‰clearï¼Œæ­¤æ—¶å®ƒæ‰å¯ä»¥ä½¿ç”¨Screençš„æˆå‘˜ã€‚</p><p><strong>å‡½æ•°é‡è½½å’Œå‹å…ƒ</strong></p><p>å°½ç®¡é‡è½½å‡½æ•°çš„åå­—ç›¸åŒï¼Œä½†å®ƒä»¬ä»ç„¶æ˜¯ä¸åŒçš„å‡½æ•°ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªç±»æƒ³æŠŠä¸€ç»„é‡è½½å‡½æ•°å£°æ˜æˆå®ƒçš„å‹å…ƒï¼Œå®ƒéœ€è¦å¯¹è¿™ç»„å‡½æ•°ä¸­çš„æ¯ä¸€ä¸ªåˆ†åˆ«å£°æ˜</p><p><strong>å‹å…ƒå£°æ˜å’Œä½œç”¨åŸŸ</strong></p><p>ç±»å’Œéæˆå‘˜å‡½æ•°çš„å£°æ˜ä¸æ˜¯å¿…é¡»åœ¨å®ƒä»¬çš„å‹å…ƒå£°æ˜ä¹‹å‰ã€‚å½“ä¸€ä¸ªåå­—ç¬¬ä¸€æ¬¡å‡ºç°åœ¨ä¸€ä¸ªå‹å…ƒå£°æ˜ä¸­æ—¶ï¼Œæˆ‘ä»¬éšå¼åœ°å‡å®šè¯¥åå­—åœ¨å½“å‰ä½œç”¨åŸŸä¸­æ˜¯å¯è§çš„ã€‚ç„¶è€Œï¼Œå‹å…ƒæœ¬èº«ä¸ä¸€å®šçœŸçš„å£°æ˜åœ¨å½“å‰ä½œç”¨åŸŸä¸­ï¼ˆå‚è§7.2.1èŠ‚ï¼Œç¬¬241é¡µï¼‰ã€‚</p><p>ç”šè‡³å°±ç®—åœ¨ç±»çš„å†…éƒ¨å®šä¹‰è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åœ¨ç±»çš„å¤–éƒ¨æä¾›ç›¸åº”çš„å£°æ˜ä»è€Œä½¿å¾—å‡½æ•°å¯è§ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿æˆ‘ä»¬ä»…ä»…æ˜¯ç”¨å£°æ˜å‹å…ƒçš„ç±»çš„æˆå‘˜è°ƒç”¨è¯¥å‹å…ƒå‡½æ•°ï¼Œå®ƒä¹Ÿå¿…é¡»æ˜¯è¢«å£°æ˜è¿‡çš„</p><p><img src="/../images/C-C-Primer-Chapter-7/1726043654206.png"></p><p>å‹å…ƒå£°æ˜çš„ä½œç”¨æ˜¯å½±å“è®¿é—®æƒé™ï¼Œå®ƒæœ¬èº«å¹¶éæ™®é€šæ„ä¹‰ä¸Šçš„å£°æ˜ã€‚</p><h2 id="7-4-ç±»çš„ä½œç”¨åŸŸ"><a href="#7-4-ç±»çš„ä½œç”¨åŸŸ" class="headerlink" title="7.4 ç±»çš„ä½œç”¨åŸŸ"></a>7.4 ç±»çš„ä½œç”¨åŸŸ</h2><p><strong>ä½œç”¨åŸŸå’Œå®šä¹‰åœ¨ç±»å¤–éƒ¨çš„æˆå‘˜</strong></p><p>ä¸€æ—¦é‡åˆ°äº†ç±»åï¼Œå®šä¹‰çš„å‰©ä½™éƒ¨åˆ†å°±åœ¨ç±»çš„ä½œç”¨åŸŸä¹‹å†…äº†ï¼Œè¿™é‡Œçš„å‰©ä½™éƒ¨åˆ†åŒ…æ‹¬å‚æ•°åˆ—è¡¨å’Œå‡½æ•°ä½“ã€‚</p><p>å‡½æ•°çš„è¿”å›ç±»å‹é€šå¸¸å‡ºç°åœ¨å‡½æ•°åä¹‹å‰ã€‚å› æ­¤å½“æˆå‘˜å‡½æ•°å®šä¹‰åœ¨ç±»çš„å¤–éƒ¨æ—¶ï¼Œè¿”å›ç±»å‹ä¸­ä½¿ç”¨çš„åå­—éƒ½ä½äºç±»çš„ä½œç”¨åŸŸä¹‹å¤–ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-7/1726044971921.png"></p><h3 id="7-4-1-åå­—æŸ¥æ‰¾ä¸ç±»çš„ä½œç”¨åŸŸ"><a href="#7-4-1-åå­—æŸ¥æ‰¾ä¸ç±»çš„ä½œç”¨åŸŸ" class="headerlink" title="7.4.1 åå­—æŸ¥æ‰¾ä¸ç±»çš„ä½œç”¨åŸŸ"></a>7.4.1 åå­—æŸ¥æ‰¾ä¸ç±»çš„ä½œç”¨åŸŸ</h3><blockquote><p>ç¼–è¯‘å™¨å¤„ç†å®Œç±»ä¸­çš„å…¨éƒ¨å£°æ˜åæ‰ä¼šå¤„ç†æˆå‘˜å‡½æ•°çš„å®šä¹‰ã€‚</p></blockquote><p><strong>ç”¨äºç±»æˆå‘˜å£°æ˜çš„åå­—æŸ¥æ‰¾</strong></p><p>è¿™ç§ä¸¤é˜¶æ®µçš„å¤„ç†æ–¹å¼åªé€‚ç”¨äºæˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨çš„åå­—ã€‚å£°æ˜ä¸­ä½¿ç”¨çš„åå­—ï¼ŒåŒ…æ‹¬è¿”å›ç±»å‹æˆ–è€…å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨çš„åå­—ï¼Œéƒ½å¿…é¡»åœ¨ä½¿ç”¨å‰ç¡®ä¿å¯è§ã€‚</p><p><strong>ç±»å‹åè¦ç‰¹æ®Šå¤„ç†</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå†…å±‚ä½œç”¨åŸŸå¯ä»¥é‡æ–°å®šä¹‰å¤–å±‚ä½œç”¨åŸŸä¸­çš„åå­—ï¼Œå³ä½¿è¯¥åå­—å·²ç»åœ¨å†…å±‚ä½œç”¨åŸŸä¸­ä½¿ç”¨è¿‡ã€‚ç„¶è€Œåœ¨ç±»ä¸­ï¼Œå¦‚æœæˆå‘˜ä½¿ç”¨äº†å¤–å±‚ä½œç”¨åŸŸä¸­çš„æŸä¸ªåå­—ï¼Œè€Œè¯¥åå­—ä»£è¡¨ä¸€ç§ç±»å‹ï¼Œåˆ™ç±»ä¸èƒ½åœ¨ä¹‹åé‡æ–°å®šä¹‰è¯¥åå­—</p><p><img src="/../images/C-C-Primer-Chapter-7/1726045253509.png"></p><blockquote><p>ç±»å‹åçš„å®šä¹‰é€šå¸¸å‡ºç°åœ¨ç±»çš„å¼€å§‹å¤„ï¼Œè¿™æ ·å°±èƒ½ç¡®ä¿æ‰€æœ‰ä½¿ç”¨è¯¥ç±»å‹çš„æˆå‘˜éƒ½å‡ºç°åœ¨ç±»åçš„å®šä¹‰ä¹‹åã€‚</p></blockquote><p><strong>æˆå‘˜å®šä¹‰ä¸­çš„æ™®é€šå—ä½œç”¨åŸŸçš„åå­—æŸ¥æ‰¾</strong></p><p>æˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨çš„åå­—æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è§£æï¼š</p><p>é¦–å…ˆï¼Œåœ¨æˆå‘˜å‡½æ•°å†…æŸ¥æ‰¾è¯¥åå­—çš„å£°æ˜ã€‚å’Œå‰é¢ä¸€æ ·ï¼Œåªæœ‰åœ¨å‡½æ•°ä½¿ç”¨ä¹‹å‰å‡ºç°çš„å£°æ˜æ‰è¢«è€ƒè™‘ã€‚</p><p>å¦‚æœåœ¨æˆå‘˜å‡½æ•°å†…æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åœ¨ç±»å†…ç»§ç»­æŸ¥æ‰¾ï¼Œè¿™æ—¶ç±»çš„æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥è¢«è€ƒè™‘ã€‚</p><p>å¦‚æœç±»å†…ä¹Ÿæ²¡æ‰¾åˆ°è¯¥åå­—çš„å£°æ˜ï¼Œåœ¨æˆå‘˜å‡½æ•°å®šä¹‰ä¹‹å‰çš„ä½œç”¨åŸŸå†…ç»§ç»­æŸ¥æ‰¾ã€‚</p><p><strong>ç±»ä½œç”¨åŸŸä¹‹åï¼Œåœ¨å¤–å›´çš„ä½œç”¨åŸŸä¸­æŸ¥</strong></p><blockquote><p>å°½ç®¡å¤–å±‚çš„å¯¹è±¡è¢«éšè—æ‰äº†ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦è®¿é—®å®ƒã€‚</p></blockquote><h2 id="7-5-æ„é€ å‡½æ•°å†æ¢"><a href="#7-5-æ„é€ å‡½æ•°å†æ¢" class="headerlink" title="7.5 æ„é€ å‡½æ•°å†æ¢"></a>7.5 æ„é€ å‡½æ•°å†æ¢</h2><h3 id="7-5-1-æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨"><a href="#7-5-1-æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨" class="headerlink" title="7.5.1 æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨"></a>7.5.1 æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨</h3><p>éšç€æ„é€ å‡½æ•°ä½“ä¸€å¼€å§‹æ‰§è¡Œï¼Œåˆå§‹åŒ–å°±å®Œæˆäº†ã€‚</p><p><strong>å»ºè®®ï¼šä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹å€¼</strong></p><p>åœ¨å¾ˆå¤šç±»ä¸­ï¼Œåˆå§‹åŒ–å’Œèµ‹å€¼çš„åŒºåˆ«äº‹å…³åº•å±‚æ•ˆç‡é—®é¢˜ï¼šå‰è€…ç›´æ¥åˆå§‹åŒ–æ•°æ®æˆå‘˜ï¼Œåè€…åˆ™å…ˆåˆå§‹åŒ–å†èµ‹å€¼ã€‚</p><p><strong>æˆå‘˜åˆå§‹åŒ–çš„é¡ºåº</strong></p><p>æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨åªè¯´æ˜ç”¨äºåˆå§‹åŒ–æˆå‘˜çš„å€¼ï¼Œè€Œä¸é™å®šåˆå§‹åŒ–çš„å…·ä½“æ‰§è¡Œé¡ºåºã€‚</p><p>æˆå‘˜çš„åˆå§‹åŒ–é¡ºåºä¸å®ƒä»¬åœ¨ç±»å®šä¹‰ä¸­çš„å‡ºç°é¡ºåºä¸€è‡´ï¼šç¬¬ä¸€ä¸ªæˆå‘˜å…ˆè¢«åˆå§‹åŒ–ï¼Œç„¶åç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æ¨ã€‚æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸­åˆå§‹å€¼çš„å‰åä½ç½®å…³ç³»ä¸ä¼šå½±å“å®é™…çš„åˆå§‹åŒ–é¡ºåºã€‚</p><blockquote><p>æœ€å¥½ä»¤æ„é€ å‡½æ•°åˆå§‹å€¼çš„é¡ºåºä¸æˆå‘˜å£°æ˜çš„é¡ºåºä¿æŒä¸€è‡´ã€‚è€Œä¸”å¦‚æœå¯èƒ½çš„è¯ï¼Œå°½é‡é¿å…ä½¿ç”¨æŸäº›æˆå‘˜åˆå§‹åŒ–å…¶ä»–æˆå‘˜ã€‚</p></blockquote><p><strong>é»˜è®¤å®å‚å’Œæ„é€ å‡½æ•°</strong></p><h3 id="7-5-2-å§”æ‰˜æ„é€ å‡½æ•°"><a href="#7-5-2-å§”æ‰˜æ„é€ å‡½æ•°" class="headerlink" title="7.5.2 å§”æ‰˜æ„é€ å‡½æ•°"></a>7.5.2 å§”æ‰˜æ„é€ å‡½æ•°</h3><p>C++11æ–°æ ‡å‡†æ‰©å±•äº†æ„é€ å‡½æ•°åˆå§‹å€¼çš„åŠŸèƒ½ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å®šä¹‰æ‰€è°“çš„å§”æ‰˜æ„é€ å‡½æ•°ï¼ˆdelegating constructorï¼‰ã€‚ä¸€ä¸ªå§”æ‰˜æ„é€ å‡½æ•°ä½¿ç”¨å®ƒæ‰€å±ç±»çš„å…¶ä»–æ„é€ å‡½æ•°æ‰§è¡Œå®ƒè‡ªå·±çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæˆ–è€…è¯´å®ƒæŠŠå®ƒè‡ªå·±çš„ä¸€äº›ï¼ˆæˆ–è€…å…¨éƒ¨ï¼‰èŒè´£å§”æ‰˜ç»™äº†å…¶ä»–æ„é€ å‡½æ•°ã€‚</p><p>å½“è¿™äº›å—å§”æ‰˜çš„æ„é€ å‡½æ•°æ‰§è¡Œå®Œåï¼Œæ¥ç€æ‰§è¡Œistream&amp;æ„é€ å‡½æ•°ä½“çš„å†…å®¹ã€‚</p><h3 id="7-5-3-é»˜è®¤æ„é€ å‡½æ•°çš„ä½œç”¨"><a href="#7-5-3-é»˜è®¤æ„é€ å‡½æ•°çš„ä½œç”¨" class="headerlink" title="7.5.3 é»˜è®¤æ„é€ å‡½æ•°çš„ä½œç”¨"></a>7.5.3 é»˜è®¤æ„é€ å‡½æ•°çš„ä½œç”¨</h3><p>é»˜è®¤åˆå§‹åŒ–åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿï¼š</p><p>å½“æˆ‘ä»¬åœ¨å—ä½œç”¨åŸŸå†…ä¸ä½¿ç”¨ä»»ä½•åˆå§‹å€¼å®šä¹‰ä¸€ä¸ªéé™æ€å˜é‡ï¼ˆå‚è§2.2.1èŠ‚ï¼Œç¬¬39é¡µï¼‰æˆ–è€…æ•°ç»„æ—¶ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬101é¡µï¼‰ã€‚</p><p>å½“ä¸€ä¸ªç±»æœ¬èº«å«æœ‰ç±»ç±»å‹çš„æˆå‘˜ä¸”ä½¿ç”¨åˆæˆçš„é»˜è®¤æ„é€ å‡½æ•°æ—¶ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬235é¡µï¼‰ã€‚</p><p>å½“ç±»ç±»å‹çš„æˆå‘˜æ²¡æœ‰åœ¨æ„é€ å‡½æ•°åˆå§‹å€¼åˆ—è¡¨ä¸­æ˜¾å¼åœ°åˆå§‹åŒ–æ—¶ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬237é¡µï¼‰ã€‚</p><p>å€¼åˆå§‹åŒ–åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å‘ç”Ÿï¼š</p><p>åœ¨æ•°ç»„åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­å¦‚æœæˆ‘ä»¬æä¾›çš„åˆå§‹å€¼æ•°é‡å°‘äºæ•°ç»„çš„å¤§å°æ—¶ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬101é¡µï¼‰ã€‚</p><p>å½“æˆ‘ä»¬ä¸ä½¿ç”¨åˆå§‹å€¼å®šä¹‰ä¸€ä¸ªå±€éƒ¨é™æ€å˜é‡æ—¶ï¼ˆå‚è§6.1.1èŠ‚ï¼Œç¬¬185é¡µï¼‰ã€‚</p><p>å½“æˆ‘ä»¬é€šè¿‡ä¹¦å†™å½¢å¦‚Tï¼ˆ ï¼‰çš„è¡¨è¾¾å¼æ˜¾å¼åœ°è¯·æ±‚å€¼åˆå§‹åŒ–æ—¶ï¼Œå…¶ä¸­Tæ˜¯ç±»å‹åï¼ˆvectorçš„ä¸€ä¸ªæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªå®å‚ç”¨äºè¯´æ˜vectorå¤§å°ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ï¼Œå®ƒå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªè¿™ç§å½¢å¼çš„å®å‚æ¥å¯¹å®ƒçš„å…ƒç´ åˆå§‹åŒ–å™¨è¿›è¡Œå€¼åˆå§‹åŒ–ï¼‰ã€‚</p><h3 id="7-5-4-éšå¼çš„ç±»ç±»å‹è½¬æ¢"><a href="#7-5-4-éšå¼çš„ç±»ç±»å‹è½¬æ¢" class="headerlink" title="7.5.4 éšå¼çš„ç±»ç±»å‹è½¬æ¢"></a>7.5.4 éšå¼çš„ç±»ç±»å‹è½¬æ¢</h3><p>å¦‚æœæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªå®å‚ï¼Œåˆ™å®ƒå®é™…ä¸Šå®šä¹‰äº†è½¬æ¢ä¸ºæ­¤ç±»ç±»å‹çš„éšå¼è½¬æ¢æœºåˆ¶ï¼Œæœ‰æ—¶æˆ‘ä»¬æŠŠè¿™ç§æ„é€ å‡½æ•°ç§°ä½œè½¬æ¢æ„é€ å‡½æ•°ï¼ˆconverting constructorï¼‰ã€‚</p><blockquote><p>èƒ½é€šè¿‡ä¸€ä¸ªå®å‚è°ƒç”¨çš„æ„é€ å‡½æ•°å®šä¹‰äº†ä¸€æ¡ä»æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹å‘ç±»ç±»å‹éšå¼è½¬æ¢çš„è§„åˆ™ã€‚</p></blockquote><p><strong>åªå…è®¸ä¸€æ­¥ç±»ç±»å‹è½¬æ¢</strong></p><p>ç¼–è¯‘å™¨åªä¼šè‡ªåŠ¨åœ°æ‰§è¡Œä¸€æ­¥ç±»å‹è½¬æ¢</p><p><strong>æŠ‘åˆ¶æ„é€ å‡½æ•°å®šä¹‰çš„éšå¼è½¬æ¢</strong></p><p>å…³é”®å­—explicitåªå¯¹ä¸€ä¸ªå®å‚çš„æ„é€ å‡½æ•°æœ‰æ•ˆã€‚éœ€è¦å¤šä¸ªå®å‚çš„æ„é€ å‡½æ•°ä¸èƒ½ç”¨äºæ‰§è¡Œéšå¼è½¬æ¢ï¼Œæ‰€ä»¥æ— é¡»å°†è¿™äº›æ„é€ å‡½æ•°æŒ‡å®šä¸ºexplicitçš„ã€‚åªèƒ½åœ¨ç±»å†…å£°æ˜æ„é€ å‡½æ•°æ—¶ä½¿ç”¨explicitå…³é”®å­—ï¼Œåœ¨ç±»å¤–éƒ¨å®šä¹‰æ—¶ä¸åº”é‡å¤</p><p><strong>explicitæ„é€ å‡½æ•°åªèƒ½ç”¨äºç›´æ¥åˆå§‹åŒ–</strong></p><p>å‘ç”Ÿéšå¼è½¬æ¢çš„ä¸€ç§æƒ…å†µæ˜¯å½“æˆ‘ä»¬æ‰§è¡Œæ‹·è´å½¢å¼çš„åˆå§‹åŒ–æ—¶ï¼ˆä½¿ç”¨&#x3D;ï¼‰ï¼ˆå‚è§3.2.1èŠ‚ï¼Œç¬¬76é¡µï¼‰ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨ç›´æ¥åˆå§‹åŒ–è€Œä¸èƒ½ä½¿ç”¨explicitæ„é€ å‡½æ•°</p><p><img src="/../images/C-C-Primer-Chapter-7/1726047200089.png"></p><p><strong>ä¸ºè½¬æ¢æ˜¾å¼åœ°ä½¿ç”¨æ„é€ å‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-7/1726047246654.png"></p><h3 id="7-5-5-èšåˆç±»"><a href="#7-5-5-èšåˆç±»" class="headerlink" title="7.5.5 èšåˆç±»"></a>7.5.5 èšåˆç±»</h3><p>èšåˆç±»ï¼ˆaggregate classï¼‰ä½¿å¾—ç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®å…¶æˆå‘˜ï¼Œå¹¶ä¸”å…·æœ‰ç‰¹æ®Šçš„åˆå§‹åŒ–è¯­æ³•å½¢å¼ã€‚å½“ä¸€ä¸ªç±»æ»¡è¶³å¦‚ä¸‹æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒæ˜¯èšåˆçš„ï¼š</p><p>æ‰€æœ‰æˆå‘˜éƒ½æ˜¯publicçš„ã€‚</p><p>æ²¡æœ‰å®šä¹‰ä»»ä½•æ„é€ å‡½æ•°ã€‚</p><p>æ²¡æœ‰ç±»å†…åˆå§‹å€¼ï¼ˆå‚è§2.6.1èŠ‚ï¼Œç¬¬64é¡µï¼‰ã€‚</p><p>æ²¡æœ‰åŸºç±»ï¼Œä¹Ÿæ²¡æœ‰virtualå‡½æ•°</p><p>æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªèŠ±æ‹¬å·æ‹¬èµ·æ¥çš„æˆå‘˜åˆå§‹å€¼åˆ—è¡¨ï¼Œå¹¶ç”¨å®ƒåˆå§‹åŒ–èšåˆç±»çš„æ•°æ®æˆå‘˜</p><p><img src="/../images/C-C-Primer-Chapter-7/1726047334451.png"></p><p>åˆå§‹å€¼çš„é¡ºåºå¿…é¡»ä¸å£°æ˜çš„é¡ºåºä¸€è‡´ï¼Œå¦‚æœåˆå§‹å€¼åˆ—è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°å°‘äºç±»çš„æˆå‘˜æ•°é‡ï¼Œåˆ™é åçš„æˆå‘˜è¢«å€¼åˆå§‹åŒ–ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬101é¡µï¼‰ã€‚</p><h3 id="7-5-6-å­—é¢å€¼å¸¸é‡ç±»"><a href="#7-5-6-å­—é¢å€¼å¸¸é‡ç±»" class="headerlink" title="7.5.6 å­—é¢å€¼å¸¸é‡ç±»"></a>7.5.6 å­—é¢å€¼å¸¸é‡ç±»</h3><p>æ•°æ®æˆå‘˜éƒ½æ˜¯å­—é¢å€¼ç±»å‹çš„èšåˆç±»ï¼ˆå‚è§7.5.5èŠ‚ï¼Œç¬¬266é¡µï¼‰æ˜¯å­—é¢å€¼å¸¸é‡ç±»ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»ä¸æ˜¯èšåˆç±»ï¼Œä½†å®ƒç¬¦åˆä¸‹è¿°è¦æ±‚ï¼Œåˆ™å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå­—é¢å€¼å¸¸é‡ç±»ï¼š</p><p>æ•°æ®æˆå‘˜éƒ½å¿…é¡»æ˜¯å­—é¢å€¼ç±»å‹ã€‚</p><p>ç±»å¿…é¡»è‡³å°‘å«æœ‰ä¸€ä¸ªconstexpræ„é€ å‡½æ•°ã€‚</p><p>å¦‚æœä¸€ä¸ªæ•°æ®æˆå‘˜å«æœ‰ç±»å†…åˆå§‹å€¼ï¼Œåˆ™å†…ç½®ç±»å‹æˆå‘˜çš„åˆå§‹å€¼å¿…é¡»æ˜¯ä¸€æ¡å¸¸é‡è¡¨è¾¾å¼ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬58é¡µï¼‰ï¼›æˆ–è€…å¦‚æœæˆå‘˜å±äºæŸç§ç±»ç±»å‹ï¼Œåˆ™åˆå§‹å€¼å¿…é¡»ä½¿ç”¨æˆå‘˜è‡ªå·±çš„constexpræ„é€ å‡½æ•°ã€‚</p><p>ç±»å¿…é¡»ä½¿ç”¨ææ„å‡½æ•°çš„é»˜è®¤å®šä¹‰ï¼Œè¯¥æˆå‘˜è´Ÿè´£é”€æ¯ç±»çš„å¯¹è±¡ï¼ˆå‚è§7.1.5èŠ‚ï¼Œç¬¬239é¡µï¼‰ã€‚</p><p><strong>constexpræ„é€ å‡½æ•°</strong></p><p>å°½ç®¡æ„é€ å‡½æ•°ä¸èƒ½æ˜¯constçš„ï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬235é¡µï¼‰ï¼Œä½†æ˜¯å­—é¢å€¼å¸¸é‡ç±»çš„æ„é€ å‡½æ•°å¯ä»¥æ˜¯constexprï¼ˆå‚è§6.5.2èŠ‚ï¼Œç¬¬213é¡µï¼‰å‡½æ•°ã€‚äº‹å®ä¸Šï¼Œä¸€ä¸ªå­—é¢å€¼å¸¸é‡ç±»å¿…é¡»è‡³å°‘æä¾›ä¸€ä¸ªconstexpræ„é€ å‡½æ•°ã€‚</p><p>constexpræ„é€ å‡½æ•°å¯ä»¥å£°æ˜æˆ&#x3D; defaultï¼ˆå‚è§7.1.4èŠ‚ï¼Œç¬¬237é¡µï¼‰çš„å½¢å¼ï¼ˆæˆ–è€…æ˜¯åˆ é™¤å‡½æ•°çš„å½¢å¼ï¼Œæˆ‘ä»¬å°†åœ¨13.1.6èŠ‚ï¼ˆç¬¬449é¡µï¼‰ä»‹ç»ç›¸å…³çŸ¥è¯†ï¼‰ã€‚å¦åˆ™ï¼Œconstexpræ„é€ å‡½æ•°å°±å¿…é¡»æ—¢ç¬¦åˆæ„é€ å‡½æ•°çš„è¦æ±‚ï¼ˆæ„å‘³ç€ä¸èƒ½åŒ…å«è¿”å›è¯­å¥ï¼‰ï¼Œåˆç¬¦åˆconstexprå‡½æ•°çš„è¦æ±‚ï¼ˆæ„å‘³ç€å®ƒèƒ½æ‹¥æœ‰çš„å”¯ä¸€å¯æ‰§è¡Œè¯­å¥å°±æ˜¯è¿”å›è¯­å¥ï¼ˆå‚è§6.5.2èŠ‚ï¼Œç¬¬214é¡µï¼‰ï¼‰ã€‚ç»¼åˆè¿™ä¸¤ç‚¹å¯çŸ¥ï¼Œconstexpræ„é€ å‡½æ•°ä½“ä¸€èˆ¬æ¥è¯´åº”è¯¥æ˜¯ç©ºçš„ã€‚æˆ‘ä»¬é€šè¿‡å‰ç½®å…³é”®å­—constexprå°±å¯ä»¥å£°æ˜ä¸€ä¸ªconstexpræ„é€ å‡½æ•°äº†</p><p><img src="/../images/C-C-Primer-Chapter-7/1726047654646.png"></p><p>constexpræ„é€ å‡½æ•°å¿…é¡»åˆå§‹åŒ–æ‰€æœ‰æ•°æ®æˆå‘˜ï¼Œåˆå§‹å€¼æˆ–è€…ä½¿ç”¨constexpræ„é€ å‡½æ•°ï¼Œæˆ–è€…æ˜¯ä¸€æ¡å¸¸é‡è¡¨è¾¾å¼ã€‚constexpræ„é€ å‡½æ•°ç”¨äºç”Ÿæˆconstexprå¯¹è±¡ä»¥åŠconstexprå‡½æ•°çš„å‚æ•°æˆ–è¿”å›ç±»å‹</p><p><img src="/../images/C-C-Primer-Chapter-7/1726047729145.png"></p><h2 id="7-6-ç±»çš„é™æ€æˆå‘˜"><a href="#7-6-ç±»çš„é™æ€æˆå‘˜" class="headerlink" title="7.6 ç±»çš„é™æ€æˆå‘˜"></a>7.6 ç±»çš„é™æ€æˆå‘˜</h2><p><strong>å£°æ˜é™æ€æˆå‘˜</strong></p><p>æˆ‘ä»¬é€šè¿‡åœ¨æˆå‘˜çš„å£°æ˜ä¹‹å‰åŠ ä¸Šå…³é”®å­—staticä½¿å¾—å…¶ä¸ç±»å…³è”åœ¨ä¸€èµ·ã€‚å’Œå…¶ä»–æˆå‘˜ä¸€æ ·ï¼Œé™æ€æˆå‘˜å¯ä»¥æ˜¯publicçš„æˆ–privateçš„ã€‚é™æ€æ•°æ®æˆå‘˜çš„ç±»å‹å¯ä»¥æ˜¯å¸¸é‡ã€å¼•ç”¨ã€æŒ‡é’ˆã€ç±»ç±»å‹ç­‰ã€‚</p><p>ç±»çš„é™æ€æˆå‘˜å­˜åœ¨äºä»»ä½•å¯¹è±¡ä¹‹å¤–ï¼Œå¯¹è±¡ä¸­ä¸åŒ…å«ä»»ä½•ä¸é™æ€æ•°æ®æˆå‘˜æœ‰å…³çš„æ•°æ®ã€‚</p><p>é™æ€æˆå‘˜å‡½æ•°ä¹Ÿä¸ä¸ä»»ä½•å¯¹è±¡ç»‘å®šåœ¨ä¸€èµ·ï¼Œå®ƒä»¬ä¸åŒ…å«thisæŒ‡é’ˆã€‚ä½œä¸ºç»“æœï¼Œé™æ€æˆå‘˜å‡½æ•°ä¸èƒ½å£°æ˜æˆconstçš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿä¸èƒ½åœ¨staticå‡½æ•°ä½“å†…ä½¿ç”¨thisæŒ‡é’ˆã€‚</p><p><strong>ä½¿ç”¨ç±»çš„é™æ€æˆå‘˜</strong></p><p>ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦ç›´æ¥è®¿é—®é™æ€æˆå‘˜ã€‚</p><p><strong>å®šä¹‰é™æ€æˆå‘˜</strong></p><p>å½“åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰é™æ€æˆå‘˜æ—¶ï¼Œä¸èƒ½é‡å¤staticå…³é”®å­—ï¼Œè¯¥å…³é”®å­—åªå‡ºç°åœ¨ç±»å†…éƒ¨çš„å£°æ˜è¯­å¥</p><p>å› ä¸ºé™æ€æ•°æ®æˆå‘˜ä¸å±äºç±»çš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬å¹¶ä¸æ˜¯åœ¨åˆ›å»ºç±»çš„å¯¹è±¡æ—¶è¢«å®šä¹‰çš„ã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¸æ˜¯ç”±ç±»çš„æ„é€ å‡½æ•°åˆå§‹åŒ–çš„ã€‚è€Œä¸”ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ç±»çš„å†…éƒ¨åˆå§‹åŒ–é™æ€æˆå‘˜ã€‚ç›¸åçš„ï¼Œå¿…é¡»åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰å’Œåˆå§‹åŒ–æ¯ä¸ªé™æ€æˆå‘˜ã€‚å’Œå…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œä¸€ä¸ªé™æ€æ•°æ®æˆå‘˜åªèƒ½å®šä¹‰ä¸€æ¬¡ã€‚é™æ€æ•°æ®æˆå‘˜å®šä¹‰åœ¨ä»»ä½•å‡½æ•°ä¹‹å¤–ã€‚å› æ­¤ä¸€æ—¦å®ƒè¢«å®šä¹‰ï¼Œå°±å°†ä¸€ç›´å­˜åœ¨äºç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ã€‚</p><blockquote><p>è¦æƒ³ç¡®ä¿å¯¹è±¡åªå®šä¹‰ä¸€æ¬¡ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯æŠŠé™æ€æ•°æ®æˆå‘˜çš„å®šä¹‰ä¸å…¶ä»–éå†…è”å‡½æ•°çš„å®šä¹‰æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p></blockquote><p><strong>é™æ€æˆå‘˜çš„ç±»å†…åˆå§‹åŒ–</strong></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç±»çš„é™æ€æˆå‘˜ä¸åº”è¯¥åœ¨ç±»çš„å†…éƒ¨åˆå§‹åŒ–ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºé™æ€æˆå‘˜æä¾›constæ•´æ•°ç±»å‹çš„ç±»å†…åˆå§‹å€¼ï¼Œä¸è¿‡è¦æ±‚é™æ€æˆå‘˜å¿…é¡»æ˜¯å­—é¢å€¼å¸¸é‡ç±»å‹çš„constexprï¼ˆå‚è§7.5.6èŠ‚ï¼Œç¬¬267é¡µï¼‰ã€‚åˆå§‹å€¼å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œå› ä¸ºè¿™äº›æˆå‘˜æœ¬èº«å°±æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œæ‰€ä»¥å®ƒä»¬èƒ½ç”¨åœ¨æ‰€æœ‰é€‚åˆäºå¸¸é‡è¡¨è¾¾å¼çš„åœ°æ–¹ã€‚</p><blockquote><p>å³ä½¿ä¸€ä¸ªå¸¸é‡é™æ€æ•°æ®æˆå‘˜åœ¨ç±»å†…éƒ¨è¢«åˆå§‹åŒ–äº†ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¹Ÿåº”è¯¥åœ¨ç±»çš„å¤–éƒ¨å®šä¹‰ä¸€ä¸‹è¯¥æˆå‘˜ã€‚</p></blockquote><p><strong>é™æ€æˆå‘˜èƒ½ç”¨äºæŸäº›åœºæ™¯ï¼Œè€Œæ™®é€šæˆå‘˜ä¸èƒ½</strong></p><p>é™æ€æ•°æ®æˆå‘˜å¯ä»¥æ˜¯ä¸å®Œå…¨ç±»å‹ï¼ˆå‚è§7.3.3èŠ‚ï¼Œç¬¬249é¡µï¼‰ã€‚ç‰¹åˆ«çš„ï¼Œé™æ€æ•°æ®æˆå‘˜çš„ç±»å‹å¯ä»¥å°±æ˜¯å®ƒæ‰€å±çš„ç±»ç±»å‹ã€‚è€Œéé™æ€æ•°æ®æˆå‘˜åˆ™å—åˆ°é™åˆ¶ï¼Œåªèƒ½å£°æ˜æˆå®ƒæ‰€å±ç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨</p><p><img src="/../images/C-C-Primer-Chapter-7/1726054107164.png"></p><p>é™æ€æˆå‘˜å’Œæ™®é€šæˆå‘˜çš„å¦å¤–ä¸€ä¸ªåŒºåˆ«æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é™æ€æˆå‘˜ä½œä¸ºé»˜è®¤å®å‚</p><p><img src="/../images/C-C-Primer-Chapter-7/image-20240922130807902.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 6</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-6/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-6/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><span id="more"></span><h3 id="6-1-å‡½æ•°åŸºç¡€"><a href="#6-1-å‡½æ•°åŸºç¡€" class="headerlink" title="6.1 å‡½æ•°åŸºç¡€"></a>6.1 å‡½æ•°åŸºç¡€</h3><p>å‡½æ•°çš„è°ƒç”¨å®Œæˆä¸¤é¡¹å·¥ä½œï¼šä¸€æ˜¯ç”¨å®å‚åˆå§‹åŒ–å‡½æ•°å¯¹åº”çš„å½¢å‚ï¼ŒäºŒæ˜¯å°†æ§åˆ¶æƒè½¬ç§»ç»™è¢«è°ƒç”¨å‡½æ•°ã€‚æ­¤æ—¶ï¼Œä¸»è°ƒå‡½æ•°ï¼ˆcalling functionï¼‰çš„æ‰§è¡Œè¢«æš‚æ—¶ä¸­æ–­ï¼Œè¢«è°ƒå‡½æ•°ï¼ˆcalled functionï¼‰å¼€å§‹æ‰§è¡Œã€‚</p><p>æ‰§è¡Œå‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯ï¼ˆéšå¼åœ°ï¼‰å®šä¹‰å¹¶åˆå§‹åŒ–å®ƒçš„å½¢å‚ã€‚å› æ­¤ï¼Œå½“è°ƒç”¨factå‡½æ•°æ—¶ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸ºvalçš„intå˜é‡ï¼Œç„¶åå°†å®ƒåˆå§‹åŒ–ä¸ºè°ƒç”¨æ—¶æ‰€ç”¨çš„å®å‚5ã€‚</p><p>å½“é‡åˆ°ä¸€æ¡returnè¯­å¥æ—¶å‡½æ•°ç»“æŸæ‰§è¡Œè¿‡ç¨‹ã€‚å’Œå‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œreturnè¯­å¥ä¹Ÿå®Œæˆä¸¤é¡¹å·¥ä½œï¼šä¸€æ˜¯è¿”å›returnè¯­å¥ä¸­çš„å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼ŒäºŒæ˜¯å°†æ§åˆ¶æƒä»è¢«è°ƒå‡½æ•°è½¬ç§»å›ä¸»è°ƒå‡½æ•°ã€‚å‡½æ•°çš„è¿”å›å€¼ç”¨äºåˆå§‹åŒ–è°ƒç”¨è¡¨è¾¾å¼çš„ç»“æœï¼Œä¹‹åç»§ç»­å®Œæˆè°ƒç”¨æ‰€åœ¨çš„è¡¨è¾¾å¼çš„å‰©ä½™éƒ¨åˆ†ã€‚</p><p><strong>å½¢å‚å’Œå®å‚</strong></p><p>å®å‚æ˜¯å½¢å‚çš„åˆå§‹å€¼ã€‚ç¬¬ä¸€ä¸ªå®å‚åˆå§‹åŒ–ç¬¬ä¸€ä¸ªå½¢å‚ï¼Œç¬¬äºŒä¸ªå®å‚åˆå§‹åŒ–ç¬¬äºŒä¸ªå½¢å‚ï¼Œä»¥æ­¤ç±»æ¨ã€‚å°½ç®¡å®å‚ä¸å½¢å‚å­˜åœ¨å¯¹åº”å…³ç³»ï¼Œä½†æ˜¯<strong>å¹¶æ²¡æœ‰è§„å®šå®å‚çš„æ±‚å€¼é¡ºåº</strong>ï¼ˆå‚è§4.1.3èŠ‚ï¼Œç¬¬123é¡µï¼‰ã€‚ç¼–è¯‘å™¨èƒ½ä»¥ä»»æ„å¯è¡Œçš„é¡ºåºå¯¹å®å‚æ±‚å€¼ã€‚</p><h3 id="6-1-1-å±€éƒ¨å¯¹è±¡"><a href="#6-1-1-å±€éƒ¨å¯¹è±¡" class="headerlink" title="6.1.1 å±€éƒ¨å¯¹è±¡"></a>6.1.1 å±€éƒ¨å¯¹è±¡</h3><p>åœ¨C++è¯­è¨€ä¸­ï¼Œåå­—æœ‰ä½œç”¨åŸŸï¼ˆå‚è§2.2.4èŠ‚ï¼Œç¬¬43é¡µï¼‰ï¼Œå¯¹è±¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼ˆlifetimeï¼‰ã€‚ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µéå¸¸é‡è¦ã€‚</p><p>åå­—çš„ä½œç”¨åŸŸæ˜¯ç¨‹åºæ–‡æœ¬çš„ä¸€éƒ¨åˆ†ï¼Œåå­—åœ¨å…¶ä¸­å¯è§ã€‚</p><p>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¯¥å¯¹è±¡å­˜åœ¨çš„ä¸€æ®µæ—¶é—´ã€‚</p><p>åœ¨æ‰€æœ‰å‡½æ•°ä½“ä¹‹å¤–å®šä¹‰çš„å¯¹è±¡å­˜åœ¨äºç¨‹åºçš„æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ã€‚æ­¤ç±»å¯¹è±¡åœ¨ç¨‹åºå¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œç›´åˆ°ç¨‹åºç»“æŸæ‰ä¼šé”€æ¯ã€‚å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¾èµ–äºå®šä¹‰çš„æ–¹å¼ã€‚</p><p><strong>è‡ªåŠ¨å¯¹è±¡</strong></p><p>å¯¹äºæ™®é€šå±€éƒ¨å˜é‡å¯¹åº”çš„å¯¹è±¡æ¥è¯´ï¼Œå½“å‡½æ•°çš„æ§åˆ¶è·¯å¾„ç»è¿‡å˜é‡å®šä¹‰è¯­å¥æ—¶åˆ›å»ºè¯¥å¯¹è±¡ï¼Œå½“åˆ°è¾¾å®šä¹‰æ‰€åœ¨çš„å—æœ«å°¾æ—¶é”€æ¯å®ƒã€‚æˆ‘ä»¬æŠŠåªå­˜åœ¨äºå—æ‰§è¡ŒæœŸé—´çš„å¯¹è±¡ç§°ä¸ºè‡ªåŠ¨å¯¹è±¡ï¼ˆautomatic objectï¼‰ã€‚å½“å—çš„æ‰§è¡Œç»“æŸåï¼Œå—ä¸­åˆ›å»ºçš„è‡ªåŠ¨å¯¹è±¡çš„å€¼å°±å˜æˆæœªå®šä¹‰çš„äº†ã€‚</p><p><strong>å±€éƒ¨é™æ€å¯¹è±¡</strong></p><p>æŸäº›æ—¶å€™ï¼Œæœ‰å¿…è¦ä»¤å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸè´¯ç©¿å‡½æ•°è°ƒç”¨åŠä¹‹åçš„æ—¶é—´ã€‚å¯ä»¥å°†å±€éƒ¨å˜é‡å®šä¹‰æˆstaticç±»å‹ä»è€Œè·å¾—è¿™æ ·çš„å¯¹è±¡ã€‚<strong>å±€éƒ¨é™æ€å¯¹è±¡ï¼ˆlocal static objectï¼‰</strong>åœ¨ç¨‹åºçš„æ‰§è¡Œè·¯å¾„ç¬¬ä¸€æ¬¡ç»è¿‡å¯¹è±¡å®šä¹‰è¯­å¥æ—¶åˆå§‹åŒ–ï¼Œå¹¶ä¸”ç›´åˆ°ç¨‹åºç»ˆæ­¢æ‰è¢«é”€æ¯ï¼Œåœ¨æ­¤æœŸé—´å³ä½¿å¯¹è±¡æ‰€åœ¨çš„å‡½æ•°ç»“æŸæ‰§è¡Œä¹Ÿä¸ä¼šå¯¹å®ƒæœ‰å½±å“ã€‚</p><h3 id="6-1-2-å‡½æ•°å£°æ˜"><a href="#6-1-2-å‡½æ•°å£°æ˜" class="headerlink" title="6.1.2 å‡½æ•°å£°æ˜"></a>6.1.2 å‡½æ•°å£°æ˜</h3><p>å‡½æ•°çš„ä¸‰è¦ç´ ï¼ˆè¿”å›ç±»å‹ã€å‡½æ•°åã€å½¢å‚ç±»å‹ï¼‰æè¿°äº†å‡½æ•°çš„æ¥å£ï¼Œè¯´æ˜äº†è°ƒç”¨è¯¥å‡½æ•°æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚å‡½æ•°å£°æ˜ä¹Ÿç§°ä½œå‡½æ•°åŸå‹ï¼ˆfunction prototypeï¼‰ã€‚</p><p><strong>åœ¨å¤´æ–‡ä»¶ä¸­è¿›è¡Œå‡½æ•°å£°æ˜</strong></p><p>æˆ‘ä»¬å»ºè®®å˜é‡åœ¨å¤´æ–‡ä»¶ï¼ˆå‚è§2.6.3èŠ‚ï¼Œç¬¬68é¡µï¼‰ä¸­å£°æ˜ï¼Œåœ¨æºæ–‡ä»¶ä¸­å®šä¹‰ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œå‡½æ•°ä¹Ÿåº”è¯¥åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜è€Œåœ¨æºæ–‡ä»¶ä¸­å®šä¹‰ã€‚</p><blockquote><p>å®šä¹‰å‡½æ•°çš„æºæ–‡ä»¶åº”è¯¥æŠŠå«æœ‰å‡½æ•°å£°æ˜çš„å¤´æ–‡ä»¶åŒ…å«è¿›æ¥ï¼Œç¼–è¯‘å™¨è´Ÿè´£éªŒè¯å‡½æ•°çš„å®šä¹‰å’Œå£°æ˜æ˜¯å¦åŒ¹é…ã€‚</p></blockquote><h3 id="6-1-3-åˆ†ç¦»å¼ç¼–è¯‘"><a href="#6-1-3-åˆ†ç¦»å¼ç¼–è¯‘" class="headerlink" title="6.1.3 åˆ†ç¦»å¼ç¼–è¯‘"></a>6.1.3 åˆ†ç¦»å¼ç¼–è¯‘</h3><p>åˆ†ç¦»å¼ç¼–è¯‘å…è®¸æˆ‘ä»¬æŠŠç¨‹åºåˆ†å‰²åˆ°å‡ ä¸ªæ–‡ä»¶ä¸­å»ï¼Œæ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹ç¼–è¯‘ã€‚</p><p><strong>ç¼–è¯‘å’Œé“¾æ¥å¤šä¸ªæºæ–‡ä»¶</strong></p><p>å‡è®¾factå‡½æ•°çš„å®šä¹‰ä½äºä¸€ä¸ªåä¸ºfact.ccçš„æ–‡ä»¶ä¸­ï¼Œå®ƒçš„å£°æ˜ä½äºåä¸ºChapter6.hçš„å¤´æ–‡ä»¶ä¸­ã€‚æ˜¾ç„¶ä¸å…¶ä»–æ‰€æœ‰ç”¨åˆ°factå‡½æ•°çš„æ–‡ä»¶ä¸€æ ·ï¼Œfact.ccåº”è¯¥åŒ…å«Chapter6.hå¤´æ–‡ä»¶ã€‚å¦å¤–ï¼Œæˆ‘ä»¬åœ¨åä¸ºfactMain.ccçš„æ–‡ä»¶ä¸­åˆ›å»ºmainå‡½æ•°ï¼Œmainå‡½æ•°å°†è°ƒç”¨factå‡½æ•°ã€‚è¦ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆexecutable fileï¼‰ï¼Œå¿…é¡»å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘ä»¬ç”¨åˆ°çš„ä»£ç åœ¨å“ªé‡Œã€‚</p><h2 id="6-2-å‚æ•°ä¼ é€’"><a href="#6-2-å‚æ•°ä¼ é€’" class="headerlink" title="6.2 å‚æ•°ä¼ é€’"></a>6.2 å‚æ•°ä¼ é€’</h2><p>æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶éƒ½ä¼šé‡æ–°åˆ›å»ºå®ƒçš„å½¢å‚ï¼Œå¹¶ç”¨ä¼ å…¥çš„å®å‚å¯¹å½¢å‚è¿›è¡Œåˆå§‹åŒ–ã€‚</p><blockquote><p>å½¢å‚åˆå§‹åŒ–çš„æœºç†ä¸å˜é‡åˆå§‹åŒ–ä¸€æ ·ã€‚</p></blockquote><h3 id="6-2-1-ä¼ å€¼å‚æ•°"><a href="#6-2-1-ä¼ å€¼å‚æ•°" class="headerlink" title="6.2.1 ä¼ å€¼å‚æ•°"></a>6.2.1 ä¼ å€¼å‚æ•°</h3><blockquote><p>åœ¨C++è¯­è¨€ä¸­ï¼Œå»ºè®®ä½¿ç”¨å¼•ç”¨ç±»å‹çš„å½¢å‚æ›¿ä»£æŒ‡é’ˆã€‚</p></blockquote><h3 id="6-2-2-ä¼ å¼•ç”¨å‚æ•°"><a href="#6-2-2-ä¼ å¼•ç”¨å‚æ•°" class="headerlink" title="6.2.2 ä¼ å¼•ç”¨å‚æ•°"></a>6.2.2 ä¼ å¼•ç”¨å‚æ•°</h3><p><strong>ä½¿ç”¨å¼•ç”¨é¿å…æ‹·è´</strong></p><p>æ‹·è´å¤§çš„ç±»ç±»å‹å¯¹è±¡æˆ–è€…å®¹å™¨å¯¹è±¡æ¯”è¾ƒä½æ•ˆï¼Œç”šè‡³æœ‰çš„ç±»ç±»å‹ï¼ˆåŒ…æ‹¬IOç±»å‹åœ¨å†…ï¼‰æ ¹æœ¬å°±ä¸æ”¯æŒæ‹·è´æ“ä½œã€‚å½“æŸç§ç±»å‹ä¸æ”¯æŒæ‹·è´æ“ä½œæ—¶ï¼Œå‡½æ•°åªèƒ½é€šè¿‡å¼•ç”¨å½¢å‚è®¿é—®è¯¥ç±»å‹çš„å¯¹è±¡ã€‚</p><p><strong>ä½¿ç”¨å¼•ç”¨å½¢å‚è¿”å›é¢å¤–ä¿¡æ¯</strong></p><h3 id="6-2-3-constå½¢å‚å’Œå®å‚"><a href="#6-2-3-constå½¢å‚å’Œå®å‚" class="headerlink" title="6.2.3 constå½¢å‚å’Œå®å‚"></a>6.2.3 constå½¢å‚å’Œå®å‚</h3><p><strong>å°½é‡ä½¿ç”¨å¸¸é‡å¼•ç”¨</strong></p><p>æŠŠå‡½æ•°ä¸ä¼šæ”¹å˜çš„å½¢å‚å®šä¹‰æˆï¼ˆæ™®é€šçš„ï¼‰å¼•ç”¨æ˜¯ä¸€ç§æ¯”è¾ƒå¸¸è§çš„é”™è¯¯ï¼Œè¿™ä¹ˆåšå¸¦ç»™å‡½æ•°çš„è°ƒç”¨è€…ä¸€ç§è¯¯å¯¼ï¼Œå³å‡½æ•°å¯ä»¥ä¿®æ”¹å®ƒçš„å®å‚çš„å€¼ã€‚æ­¤å¤–ï¼Œä½¿ç”¨å¼•ç”¨è€Œéå¸¸é‡å¼•ç”¨ä¹Ÿä¼šæå¤§åœ°é™åˆ¶å‡½æ•°æ‰€èƒ½æ¥å—çš„å®å‚ç±»å‹ã€‚å°±åƒåˆšåˆšçœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠconstå¯¹è±¡ã€å­—é¢å€¼æˆ–è€…éœ€è¦ç±»å‹è½¬æ¢çš„å¯¹è±¡ä¼ é€’ç»™æ™®é€šçš„å¼•ç”¨å½¢å‚ã€‚</p><p>å½“ä¸€ä¸ªaå‡½æ•°çš„å½¢å‚æ˜¯constï¼Œaå‡½æ•°è¦å°†è¿™ä¸ªå‚æ•°ä½œä¸ºå®å‚ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªbå‡½æ•°ï¼Œæœ€ç†æƒ³çš„æ–¹æ³•æ˜¯bå‡½æ•°çš„å‚æ•°åº”è¯¥ä¹Ÿæ˜¯constï¼Œå¦‚æœæ— æ³•æ»¡è¶³ï¼Œæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯åœ¨aå‡½æ•°å†…éƒ¨å®šä¹‰ä¸€ä¸ªå±€éƒ¨å¯¹è±¡ï¼Œæ‹·è´ä¸€ä»½è¿™ä¸ªå½¢å‚ï¼Œç„¶åå°†å±€éƒ¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™bå‡½æ•°ã€‚</p><h3 id="6-2-4-æ•°ç»„å½¢å‚"><a href="#6-2-4-æ•°ç»„å½¢å‚" class="headerlink" title="6.2.4 æ•°ç»„å½¢å‚"></a>6.2.4 æ•°ç»„å½¢å‚</h3><p>æ•°ç»„çš„ä¸¤ä¸ªç‰¹æ®Šæ€§è´¨å¯¹æˆ‘ä»¬å®šä¹‰å’Œä½¿ç”¨ä½œç”¨åœ¨æ•°ç»„ä¸Šçš„å‡½æ•°æœ‰å½±å“ï¼Œè¿™ä¸¤ä¸ªæ€§è´¨åˆ†åˆ«æ˜¯ï¼šä¸å…è®¸æ‹·è´æ•°ç»„ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬102é¡µï¼‰ä»¥åŠä½¿ç”¨æ•°ç»„æ—¶ï¼ˆé€šå¸¸ï¼‰ä¼šå°†å…¶è½¬æ¢æˆæŒ‡é’ˆï¼ˆå‚è§3.5.3èŠ‚ï¼Œç¬¬105é¡µï¼‰ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-6/1725946405478.png"></p><p>å°½ç®¡è¡¨ç°å½¢å¼ä¸åŒï¼Œä½†ä¸Šé¢çš„ä¸‰ä¸ªå‡½æ•°æ˜¯ç­‰ä»·çš„ï¼šæ¯ä¸ªå‡½æ•°çš„å”¯ä¸€å½¢å‚éƒ½æ˜¯const intï¼Šç±»å‹çš„ã€‚å½“ç¼–è¯‘å™¨å¤„ç†å¯¹printå‡½æ•°çš„è°ƒç”¨æ—¶ï¼Œåªæ£€æŸ¥ä¼ å…¥çš„å‚æ•°æ˜¯å¦æ˜¯const intï¼Šç±»å‹</p><p>ç®¡ç†æŒ‡é’ˆå½¢å‚æœ‰ä¸‰ç§å¸¸ç”¨çš„æŠ€æœ¯ï¼š</p><p><strong>ä½¿ç”¨æ ‡è®°æŒ‡å®šæ•°ç»„é•¿åº¦</strong></p><p>ç®¡ç†æ•°ç»„å®å‚çš„ç¬¬ä¸€ç§æ–¹æ³•æ˜¯è¦æ±‚æ•°ç»„æœ¬èº«åŒ…å«ä¸€ä¸ªç»“æŸæ ‡è®°ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•çš„å…¸å‹ç¤ºä¾‹æ˜¯Cé£æ ¼å­—ç¬¦ä¸²ï¼ˆå‚è§3.5.4èŠ‚ï¼Œç¬¬109é¡µï¼‰ã€‚Cé£æ ¼å­—ç¬¦ä¸²å­˜å‚¨åœ¨å­—ç¬¦æ•°ç»„ä¸­ï¼Œå¹¶ä¸”åœ¨æœ€åä¸€ä¸ªå­—ç¬¦åé¢è·Ÿç€ä¸€ä¸ªç©ºå­—ç¬¦ã€‚å‡½æ•°åœ¨å¤„ç†Cé£æ ¼å­—ç¬¦ä¸²æ—¶é‡åˆ°ç©ºå­—ç¬¦åœæ­¢</p><p><img src="/../images/C-C-Primer-Chapter-6/1725946548477.png"></p><p><strong>ä½¿ç”¨æ ‡å‡†åº“è§„èŒƒ</strong></p><p>ç®¡ç†æ•°ç»„å®å‚çš„ç¬¬äºŒç§æŠ€æœ¯æ˜¯ä¼ é€’æŒ‡å‘æ•°ç»„é¦–å…ƒç´ å’Œå°¾åå…ƒç´ çš„æŒ‡é’ˆï¼Œè¿™ç§æ–¹æ³•å—åˆ°äº†æ ‡å‡†åº“æŠ€æœ¯çš„å¯å‘ï¼Œå…³äºå…¶ç»†èŠ‚å°†åœ¨ç¬¬IIéƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹å½¢å¼è¾“å‡ºå…ƒç´ å†…å®¹</p><p><img src="/../images/C-C-Primer-Chapter-6/1725946542490.png"></p><p><strong>æ˜¾å¼ä¼ é€’ä¸€ä¸ªè¡¨ç¤ºæ•°ç»„å¤§å°çš„å½¢å‚</strong></p><p>ç¬¬ä¸‰ç§ç®¡ç†æ•°ç»„å®å‚çš„æ–¹æ³•æ˜¯ä¸“é—¨å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºæ•°ç»„å¤§å°çš„å½¢å‚ï¼Œåœ¨Cç¨‹åºå’Œè¿‡å»çš„C++ç¨‹åºä¸­å¸¸å¸¸ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¯ä»¥å°†printå‡½æ•°é‡å†™æˆå¦‚ä¸‹å½¢å¼</p><p><img src="/../images/C-C-Primer-Chapter-6/1725946585366.png"></p><p><strong>æ•°ç»„å½¢å‚å’Œconst</strong></p><p>å½“å‡½æ•°ä¸éœ€è¦å¯¹æ•°ç»„å…ƒç´ æ‰§è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œæ•°ç»„å½¢å‚åº”è¯¥æ˜¯æŒ‡å‘constçš„æŒ‡é’ˆï¼ˆå‚è§2.4.2èŠ‚ï¼Œç¬¬56é¡µï¼‰ã€‚åªæœ‰å½“å‡½æ•°ç¡®å®è¦æ”¹å˜å…ƒç´ å€¼çš„æ—¶å€™ï¼Œæ‰æŠŠå½¢å‚å®šä¹‰æˆæŒ‡å‘éå¸¸é‡çš„æŒ‡é’ˆ</p><p><strong>æ•°ç»„å¼•ç”¨å½¢å‚</strong></p><p>C++è¯­è¨€å…è®¸å°†å˜é‡å®šä¹‰æˆæ•°ç»„çš„å¼•ç”¨ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬101é¡µï¼‰ï¼ŒåŸºäºåŒæ ·çš„é“ç†ï¼Œå½¢å‚ä¹Ÿå¯ä»¥æ˜¯æ•°ç»„çš„å¼•ç”¨ã€‚æ­¤æ—¶ï¼Œå¼•ç”¨å½¢å‚ç»‘å®šåˆ°å¯¹åº”çš„å®å‚ä¸Šï¼Œä¹Ÿå°±æ˜¯ç»‘å®šåˆ°æ•°ç»„ä¸Š</p><p><img src="/../images/C-C-Primer-Chapter-6/1725946674459.png"></p><p>å› ä¸ºæ•°ç»„çš„å¤§å°æ˜¯æ„æˆæ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥åªè¦ä¸è¶…è¿‡ç»´åº¦ï¼Œåœ¨å‡½æ•°ä½“å†…å°±å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨æ•°ç»„ã€‚ä½†æ˜¯ï¼Œè¿™ä¸€ç”¨æ³•ä¹Ÿæ— å½¢ä¸­é™åˆ¶äº†printå‡½æ•°çš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬åªèƒ½å°†å‡½æ•°ä½œç”¨äºå¤§å°ä¸º10çš„æ•°ç»„</p><p>16.1.1èŠ‚ï¼ˆç¬¬578é¡µï¼‰å°†è¦ä»‹ç»æˆ‘ä»¬åº”è¯¥å¦‚ä½•ç¼–å†™è¿™ä¸ªå‡½æ•°ï¼Œä½¿å…¶å¯ä»¥ç»™å¼•ç”¨ç±»å‹çš„å½¢å‚ä¼ é€’ä»»æ„å¤§å°çš„æ•°ç»„</p><p><strong>ä¼ é€’å¤šç»´æ•°ç»„</strong></p><p>å½“å°†å¤šç»´æ•°ç»„ä¼ é€’ç»™å‡½æ•°æ—¶ï¼ŒçœŸæ­£ä¼ é€’çš„æ˜¯æŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆï¼ˆå‚è§3.6èŠ‚ï¼Œç¬¬115é¡µï¼‰ã€‚å› ä¸ºæˆ‘ä»¬å¤„ç†çš„æ˜¯æ•°ç»„çš„æ•°ç»„ï¼Œæ‰€ä»¥é¦–å…ƒç´ æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆã€‚æ•°ç»„ç¬¬äºŒç»´ï¼ˆä»¥åŠåé¢æ‰€æœ‰ç»´åº¦ï¼‰çš„å¤§å°éƒ½æ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸èƒ½çœç•¥</p><p><img src="/../images/C-C-Primer-Chapter-6/1725946770314.png"></p><p><img src="/../images/C-C-Primer-Chapter-6/1725946799107.png"></p><h3 id="6-2-5-mainï¼šå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹"><a href="#6-2-5-mainï¼šå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹" class="headerlink" title="6.2.5 mainï¼šå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹"></a>6.2.5 mainï¼šå¤„ç†å‘½ä»¤è¡Œé€‰é¡¹</h3><p><img src="/../images/C-C-Primer-Chapter-6/1725946835300.png"></p><p>ç¬¬äºŒä¸ªå½¢å‚argvæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„å…ƒç´ æ˜¯æŒ‡å‘Cé£æ ¼å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼›ç¬¬ä¸€ä¸ªå½¢å‚argcè¡¨ç¤ºæ•°ç»„ä¸­å­—ç¬¦ä¸²çš„æ•°é‡ã€‚</p><p>å½“å®å‚ä¼ ç»™mainå‡½æ•°ä¹‹åï¼Œargvçš„ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘ç¨‹åºçš„åå­—æˆ–è€…ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œæ¥ä¸‹æ¥çš„å…ƒç´ ä¾æ¬¡ä¼ é€’å‘½ä»¤è¡Œæä¾›çš„å®å‚ã€‚æœ€åä¸€ä¸ªæŒ‡é’ˆä¹‹åçš„å…ƒç´ å€¼ä¿è¯ä¸º0</p><blockquote><p>å½“ä½¿ç”¨argvä¸­çš„å®å‚æ—¶ï¼Œä¸€å®šè¦è®°å¾—å¯é€‰çš„å®å‚ä»argv[1]å¼€å§‹ï¼›argv[0]ä¿å­˜ç¨‹åºçš„åå­—ï¼Œè€Œéç”¨æˆ·è¾“å…¥ã€‚</p></blockquote><h3 id="6-2-6-å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°"><a href="#6-2-6-å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°" class="headerlink" title="6.2.6 å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°"></a>6.2.6 å«æœ‰å¯å˜å½¢å‚çš„å‡½æ•°</h3><p>ä¸ºäº†ç¼–å†™èƒ½å¤„ç†ä¸åŒæ•°é‡å®å‚çš„å‡½æ•°ï¼ŒC++11æ–°æ ‡å‡†æä¾›äº†ä¸¤ç§ä¸»è¦çš„æ–¹æ³•ï¼šå¦‚æœæ‰€æœ‰çš„å®å‚ç±»å‹ç›¸åŒï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªåä¸ºinitializer_listçš„æ ‡å‡†åº“ç±»å‹ï¼›å¦‚æœå®å‚çš„ç±»å‹ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å¯å˜å‚æ•°æ¨¡æ¿ï¼Œå…³äºå®ƒçš„ç»†èŠ‚å°†åœ¨16.4èŠ‚ï¼ˆç¬¬618é¡µï¼‰ä»‹ç»ã€‚</p><p>C++è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„å½¢å‚ç±»å‹ï¼ˆå³çœç•¥ç¬¦ï¼‰ï¼Œå¯ä»¥ç”¨å®ƒä¼ é€’å¯å˜æ•°é‡çš„å®å‚ã€‚æœ¬èŠ‚å°†ç®€è¦ä»‹ç»çœç•¥ç¬¦å½¢å‚ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§åŠŸèƒ½ä¸€èˆ¬åªç”¨äºä¸Cå‡½æ•°äº¤äº’çš„æ¥å£ç¨‹åºã€‚</p><p><strong>initializer_listå½¢å‚</strong></p><p>å¦‚æœå‡½æ•°çš„å®å‚æ•°é‡æœªçŸ¥ä½†æ˜¯å…¨éƒ¨å®å‚çš„ç±»å‹éƒ½ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨initializer_listç±»å‹çš„å½¢å‚ã€‚initializer_listæ˜¯ä¸€ç§æ ‡å‡†åº“ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæŸç§ç‰¹å®šç±»å‹çš„å€¼çš„æ•°ç»„ï¼ˆå‚è§3.5èŠ‚ï¼Œç¬¬101é¡µï¼‰ã€‚initializer_listç±»å‹å®šä¹‰åœ¨åŒåçš„å¤´æ–‡ä»¶ä¸­ï¼Œå®ƒæä¾›çš„æ“ä½œå¦‚è¡¨6.1æ‰€ç¤ºã€‚</p><p><img src="/../images/C-C-Primer-Chapter-6/1725947030833.png"></p><p>initializer_listå¯¹è±¡ä¸­çš„<strong>å…ƒç´ æ°¸è¿œæ˜¯å¸¸é‡å€¼</strong>ï¼Œæˆ‘ä»¬æ— æ³•æ”¹å˜initializer_listå¯¹è±¡ä¸­å…ƒç´ çš„å€¼ã€‚</p><p>å¦‚æœæƒ³å‘initializer_listå½¢å‚ä¸­ä¼ é€’ä¸€ä¸ªå€¼çš„åºåˆ—ï¼Œåˆ™å¿…é¡»æŠŠåºåˆ—æ”¾åœ¨ä¸€å¯¹èŠ±æ‹¬å·å†…</p><p><strong>çœç•¥ç¬¦å½¢å‚</strong></p><p>çœç•¥ç¬¦å½¢å‚æ˜¯ä¸ºäº†ä¾¿äºC++ç¨‹åºè®¿é—®æŸäº›ç‰¹æ®Šçš„Cä»£ç è€Œè®¾ç½®çš„ï¼Œè¿™äº›ä»£ç ä½¿ç”¨äº†åä¸ºvarargsçš„Cæ ‡å‡†åº“åŠŸèƒ½ã€‚é€šå¸¸ï¼Œçœç•¥ç¬¦å½¢å‚ä¸åº”ç”¨äºå…¶ä»–ç›®çš„ã€‚ä½ çš„Cç¼–è¯‘å™¨æ–‡æ¡£ä¼šæè¿°å¦‚ä½•ä½¿ç”¨varargsã€‚</p><blockquote><p>çœç•¥ç¬¦å½¢å‚åº”è¯¥ä»…ä»…ç”¨äºCå’ŒC++é€šç”¨çš„ç±»å‹ã€‚ç‰¹åˆ«åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œå¤§å¤šæ•°ç±»ç±»å‹çš„å¯¹è±¡åœ¨ä¼ é€’ç»™çœç•¥ç¬¦å½¢å‚æ—¶éƒ½æ— æ³•æ­£ç¡®æ‹·è´ã€‚</p></blockquote><p>çœç•¥ç¬¦å½¢å‚åªèƒ½å‡ºç°åœ¨å½¢å‚åˆ—è¡¨çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œå®ƒçš„å½¢å¼æ— å¤–ä¹ä»¥ä¸‹ä¸¤ç§</p><p><img src="/../images/C-C-Primer-Chapter-6/1725947187334.png"></p><h2 id="6-3-è¿”å›ç±»å‹å’Œreturnè¯­å¥"><a href="#6-3-è¿”å›ç±»å‹å’Œreturnè¯­å¥" class="headerlink" title="6.3 è¿”å›ç±»å‹å’Œreturnè¯­å¥"></a>6.3 è¿”å›ç±»å‹å’Œreturnè¯­å¥</h2><h3 id="6-3-1-æ— è¿”å›å€¼å‡½æ•°"><a href="#6-3-1-æ— è¿”å›å€¼å‡½æ•°" class="headerlink" title="6.3.1 æ— è¿”å›å€¼å‡½æ•°"></a>6.3.1 æ— è¿”å›å€¼å‡½æ•°</h3><h3 id="6-3-2-æœ‰è¿”å›å€¼å‡½æ•°"><a href="#6-3-2-æœ‰è¿”å›å€¼å‡½æ•°" class="headerlink" title="6.3.2 æœ‰è¿”å›å€¼å‡½æ•°"></a>6.3.2 æœ‰è¿”å›å€¼å‡½æ•°</h3><blockquote><p>åœ¨å«æœ‰returnè¯­å¥çš„å¾ªç¯åé¢åº”è¯¥ä¹Ÿæœ‰ä¸€æ¡returnè¯­å¥ï¼Œå¦‚æœæ²¡æœ‰çš„è¯è¯¥ç¨‹åºå°±æ˜¯é”™è¯¯çš„ã€‚å¾ˆå¤šç¼–è¯‘å™¨éƒ½æ— æ³•å‘ç°æ­¤ç±»é”™è¯¯ã€‚è¿è¡Œæ—¶çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p></blockquote><p><strong>å€¼æ˜¯å¦‚ä½•è¢«è¿”å›çš„</strong></p><p>è¿”å›çš„å€¼ç”¨äºåˆå§‹åŒ–è°ƒç”¨ç‚¹çš„ä¸€ä¸ªä¸´æ—¶é‡ï¼Œè¯¥ä¸´æ—¶é‡å°±æ˜¯å‡½æ•°è°ƒç”¨çš„ç»“æœã€‚</p><p><strong>ä¸è¦è¿”å›å±€éƒ¨å¯¹è±¡çš„å¼•ç”¨æˆ–æŒ‡é’ˆ</strong></p><p><strong>è¿”å›ç±»ç±»å‹çš„å‡½æ•°å’Œè°ƒç”¨è¿ç®—ç¬¦</strong></p><p><strong>å¼•ç”¨è¿”å›å·¦å€¼</strong></p><p><strong>åˆ—è¡¨åˆå§‹åŒ–è¿”å›å€¼</strong></p><p>C++11æ–°æ ‡å‡†è§„å®šï¼Œå‡½æ•°å¯ä»¥è¿”å›èŠ±æ‹¬å·åŒ…å›´çš„å€¼çš„åˆ—è¡¨ã€‚ç±»ä¼¼äºå…¶ä»–è¿”å›ç»“æœï¼Œæ­¤å¤„çš„åˆ—è¡¨ä¹Ÿç”¨æ¥å¯¹è¡¨ç¤ºå‡½æ•°è¿”å›çš„ä¸´æ—¶é‡è¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œä¸´æ—¶é‡æ‰§è¡Œå€¼åˆå§‹åŒ–ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ï¼›å¦åˆ™ï¼Œè¿”å›çš„å€¼ç”±å‡½æ•°çš„è¿”å›ç±»å‹å†³å®šã€‚</p><p><strong>ä¸»å‡½æ•°mainçš„è¿”å›å€¼</strong></p><p>ä¸ºäº†ä½¿è¿”å›å€¼ä¸æœºå™¨æ— å…³ï¼Œcstdlibå¤´æ–‡ä»¶å®šä¹‰äº†ä¸¤ä¸ªé¢„å¤„ç†å˜é‡ï¼ˆå‚è§2.3.2èŠ‚ï¼Œç¬¬49é¡µï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªå˜é‡åˆ†åˆ«è¡¨ç¤ºæˆåŠŸä¸å¤±è´¥</p><p><img src="/../images/C-C-Primer-Chapter-6/1725947537988.png"></p><p><strong>é€’å½’</strong></p><p>å¦‚æœä¸€ä¸ªå‡½æ•°è°ƒç”¨äº†å®ƒè‡ªèº«ï¼Œä¸ç®¡è¿™ç§è°ƒç”¨æ˜¯ç›´æ¥çš„è¿˜æ˜¯é—´æ¥çš„ï¼Œéƒ½ç§°è¯¥å‡½æ•°ä¸ºé€’å½’å‡½æ•°ï¼ˆrecursive functionï¼‰ã€‚</p><h3 id="6-3-3-è¿”å›æ•°ç»„æŒ‡é’ˆ"><a href="#6-3-3-è¿”å›æ•°ç»„æŒ‡é’ˆ" class="headerlink" title="6.3.3 è¿”å›æ•°ç»„æŒ‡é’ˆ"></a>6.3.3 è¿”å›æ•°ç»„æŒ‡é’ˆ</h3><p>å› ä¸ºæ•°ç»„ä¸èƒ½è¢«æ‹·è´ï¼Œæ‰€ä»¥å‡½æ•°ä¸èƒ½è¿”å›æ•°ç»„ã€‚ä¸è¿‡ï¼Œå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼ˆå‚è§3.5.1èŠ‚ï¼Œç¬¬102é¡µï¼‰ã€‚è™½ç„¶ä»è¯­æ³•ä¸Šæ¥è¯´ï¼Œè¦æƒ³å®šä¹‰ä¸€ä¸ªè¿”å›æ•°ç»„çš„æŒ‡é’ˆæˆ–å¼•ç”¨çš„å‡½æ•°æ¯”è¾ƒçƒ¦çï¼Œä½†æ˜¯æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥ç®€åŒ–è¿™ä¸€ä»»åŠ¡ï¼Œå…¶ä¸­æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç±»å‹åˆ«åï¼ˆå‚è§2.5.1èŠ‚ï¼Œç¬¬60é¡µï¼‰</p><p><img src="/../images/C-C-Primer-Chapter-6/1725947623474.png"></p><p><strong>å£°æ˜ä¸€ä¸ªè¿”å›æ•°ç»„æŒ‡é’ˆçš„å‡½æ•°</strong></p><p><img src="/../images/C-C-Primer-Chapter-6/1725947705178.png"></p><p><strong>ä½¿ç”¨å°¾ç½®è¿”å›ç±»å‹</strong></p><p>åœ¨C++11æ–°æ ‡å‡†ä¸­è¿˜æœ‰ä¸€ç§å¯ä»¥ç®€åŒ–ä¸Šè¿°funcå£°æ˜çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨å°¾ç½®è¿”å›ç±»å‹ï¼ˆtrailing return typeï¼‰ã€‚ä»»ä½•å‡½æ•°çš„å®šä¹‰éƒ½èƒ½ä½¿ç”¨å°¾ç½®è¿”å›ï¼Œä½†æ˜¯è¿™ç§å½¢å¼å¯¹äºè¿”å›ç±»å‹æ¯”è¾ƒå¤æ‚çš„å‡½æ•°æœ€æœ‰æ•ˆï¼Œæ¯”å¦‚è¿”å›ç±»å‹æ˜¯æ•°ç»„çš„æŒ‡é’ˆæˆ–è€…æ•°ç»„çš„å¼•ç”¨ã€‚</p><p>å°¾ç½®è¿”å›ç±»å‹è·Ÿåœ¨å½¢å‚åˆ—è¡¨åé¢å¹¶ä»¥ä¸€ä¸ª-&gt;ç¬¦å·å¼€å¤´ã€‚ä¸ºäº†è¡¨ç¤ºå‡½æ•°çœŸæ­£çš„è¿”å›ç±»å‹è·Ÿåœ¨å½¢å‚åˆ—è¡¨ä¹‹åï¼Œæˆ‘ä»¬åœ¨æœ¬åº”è¯¥å‡ºç°è¿”å›ç±»å‹çš„åœ°æ–¹æ”¾ç½®ä¸€ä¸ªauto</p><p><img src="/../images/C-C-Primer-Chapter-6/1725947829947.png"></p><p><strong>ä½¿ç”¨decltype</strong></p><p>å¦‚æœæˆ‘ä»¬çŸ¥é“å‡½æ•°è¿”å›çš„æŒ‡é’ˆå°†æŒ‡å‘å“ªä¸ªæ•°ç»„ï¼Œå°±å¯ä»¥ä½¿ç”¨decltypeå…³é”®å­—å£°æ˜è¿”å›ç±»å‹ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-6/1725947866943.png"></p><p>arrPträ½¿ç”¨å…³é”®å­—decltypeè¡¨ç¤ºå®ƒçš„è¿”å›ç±»å‹æ˜¯ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸”è¯¥æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡ä¸oddçš„ç±»å‹ä¸€è‡´ã€‚å› ä¸ºoddæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥arrPtrè¿”å›ä¸€ä¸ªæŒ‡å‘å«æœ‰5ä¸ªæ•´æ•°çš„æ•°ç»„çš„æŒ‡é’ˆã€‚<strong>æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š</strong>decltypeå¹¶ä¸è´Ÿè´£æŠŠæ•°ç»„ç±»å‹è½¬æ¢æˆå¯¹åº”çš„æŒ‡é’ˆï¼Œæ‰€ä»¥decltypeçš„ç»“æœæ˜¯ä¸ªæ•°ç»„ï¼Œè¦æƒ³è¡¨ç¤ºarrPtrè¿”å›æŒ‡é’ˆè¿˜å¿…é¡»åœ¨å‡½æ•°å£°æ˜æ—¶åŠ ä¸€ä¸ªï¼Šç¬¦å·ã€‚</p><h2 id="6-4-å‡½æ•°é‡è½½"><a href="#6-4-å‡½æ•°é‡è½½" class="headerlink" title="6.4 å‡½æ•°é‡è½½"></a>6.4 å‡½æ•°é‡è½½</h2><p>å¦‚æœåŒä¸€ä½œç”¨åŸŸå†…çš„å‡ ä¸ªå‡½æ•°åå­—ç›¸åŒä½†å½¢å‚åˆ—è¡¨ä¸åŒï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé‡è½½ï¼ˆoverloadedï¼‰å‡½æ•°ã€‚</p><p><strong>å®šä¹‰é‡è½½å‡½æ•°</strong></p><p>å¯¹äºé‡è½½çš„å‡½æ•°æ¥è¯´ï¼Œå®ƒä»¬åº”è¯¥åœ¨å½¢å‚æ•°é‡æˆ–å½¢å‚ç±»å‹ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><p>ä¸å…è®¸ä¸¤ä¸ªå‡½æ•°é™¤äº†è¿”å›ç±»å‹å¤–å…¶ä»–æ‰€æœ‰çš„è¦ç´ éƒ½ç›¸åŒã€‚</p><p><strong>é‡è½½å’Œconstå½¢å‚</strong></p><p>ä¸€ä¸ªæ‹¥æœ‰é¡¶å±‚constçš„å½¢å‚æ— æ³•å’Œå¦ä¸€ä¸ªæ²¡æœ‰é¡¶å±‚constçš„å½¢å‚åŒºåˆ†å¼€æ¥</p><p>å¦‚æœå½¢å‚æ˜¯æŸç§ç±»å‹çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œåˆ™é€šè¿‡åŒºåˆ†å…¶æŒ‡å‘çš„æ˜¯å¸¸é‡å¯¹è±¡è¿˜æ˜¯éå¸¸é‡å¯¹è±¡å¯ä»¥å®ç°å‡½æ•°é‡è½½ï¼Œæ­¤æ—¶çš„constæ˜¯åº•å±‚çš„</p><p>å½“æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªéå¸¸é‡å¯¹è±¡æˆ–è€…æŒ‡å‘éå¸¸é‡å¯¹è±¡çš„æŒ‡é’ˆæ—¶ï¼Œç¼–è¯‘å™¨ä¼šä¼˜å…ˆé€‰ç”¨éå¸¸é‡ç‰ˆæœ¬çš„å‡½æ•°ã€‚</p><p><strong>const_castå’Œé‡è½½</strong></p><p>const_caståœ¨é‡è½½å‡½æ•°çš„æƒ…æ™¯ä¸­æœ€æœ‰ç”¨</p><p><img src="/../images/C-C-Primer-Chapter-6/1725948182712.png"></p><p>è¿™ä¸ªå‡½æ•°çš„å‚æ•°å’Œè¿”å›ç±»å‹éƒ½æ˜¯const stringçš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥å¯¹ä¸¤ä¸ªéå¸¸é‡çš„stringå®å‚è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½†è¿”å›çš„ç»“æœä»ç„¶æ˜¯const stringçš„å¼•ç”¨ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æ–°çš„shorterStringå‡½æ•°ï¼Œå½“å®ƒçš„å®å‚ä¸æ˜¯å¸¸é‡æ—¶ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ªæ™®é€šçš„å¼•ç”¨ï¼Œä½¿ç”¨const_castå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹</p><p><img src="/../images/C-C-Primer-Chapter-6/1725948295464.png"></p><p>åœ¨è¿™ä¸ªç‰ˆæœ¬çš„å‡½æ•°ä¸­ï¼Œé¦–å…ˆå°†å®ƒçš„å®å‚å¼ºåˆ¶è½¬æ¢æˆå¯¹constçš„å¼•ç”¨ï¼Œç„¶åè°ƒç”¨äº†shorterStringå‡½æ•°çš„constç‰ˆæœ¬ã€‚constç‰ˆæœ¬è¿”å›å¯¹const stringçš„å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨äº‹å®ä¸Šç»‘å®šåœ¨äº†æŸä¸ªåˆå§‹çš„éå¸¸é‡å®å‚ä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†å°†å…¶è½¬æ¢å›ä¸€ä¸ªæ™®é€šçš„string&amp;ï¼Œè¿™æ˜¾ç„¶æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>è°ƒç”¨é‡è½½çš„å‡½æ•°</strong></p><p>å½“è°ƒç”¨é‡è½½å‡½æ•°æ—¶æœ‰ä¸‰ç§å¯èƒ½çš„ç»“æœï¼š</p><p>1.ç¼–è¯‘å™¨æ‰¾åˆ°ä¸€ä¸ªä¸å®å‚æœ€ä½³åŒ¹é…ï¼ˆbest matchï¼‰çš„å‡½æ•°ï¼Œå¹¶ç”Ÿæˆè°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç ã€‚</p><p>2.æ‰¾ä¸åˆ°ä»»ä½•ä¸€ä¸ªå‡½æ•°ä¸è°ƒç”¨çš„å®å‚åŒ¹é…ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨å‘å‡ºæ— åŒ¹é…ï¼ˆno matchï¼‰çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>3.æœ‰å¤šäºä¸€ä¸ªå‡½æ•°å¯ä»¥åŒ¹é…ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªéƒ½ä¸æ˜¯æ˜æ˜¾çš„æœ€ä½³é€‰æ‹©ã€‚æ­¤æ—¶ä¹Ÿå°†å‘ç”Ÿé”™è¯¯ï¼Œç§°ä¸ºäºŒä¹‰æ€§è°ƒç”¨ï¼ˆambiguous callï¼‰ã€‚</p><h3 id="6-4-1-é‡è½½ä¸ä½œç”¨åŸŸ"><a href="#6-4-1-é‡è½½ä¸ä½œç”¨åŸŸ" class="headerlink" title="6.4.1 é‡è½½ä¸ä½œç”¨åŸŸ"></a>6.4.1 é‡è½½ä¸ä½œç”¨åŸŸ</h3><p>å¦‚æœæˆ‘ä»¬åœ¨å†…å±‚ä½œç”¨åŸŸä¸­å£°æ˜åå­—ï¼Œå®ƒå°†éšè—å¤–å±‚ä½œç”¨åŸŸä¸­å£°æ˜çš„åŒåå®ä½“ã€‚åœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­æ— æ³•é‡è½½å‡½æ•°å</p><h2 id="6-5-ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§"><a href="#6-5-ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§" class="headerlink" title="6.5 ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§"></a>6.5 ç‰¹æ®Šç”¨é€”è¯­è¨€ç‰¹æ€§</h2><h3 id="6-5-1-é»˜è®¤å®å‚"><a href="#6-5-1-é»˜è®¤å®å‚" class="headerlink" title="6.5.1 é»˜è®¤å®å‚"></a>6.5.1 é»˜è®¤å®å‚</h3><p>æˆ‘ä»¬å¯ä»¥ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå½¢å‚å®šä¹‰é»˜è®¤å€¼ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦æŸä¸ªå½¢å‚è¢«èµ‹äºˆäº†é»˜è®¤å€¼ï¼Œå®ƒåé¢çš„æ‰€æœ‰å½¢å‚éƒ½å¿…é¡»æœ‰é»˜è®¤å€¼ã€‚</p><p><strong>ä½¿ç”¨é»˜è®¤å®å‚è°ƒç”¨å‡½æ•°</strong></p><p>å°½é‡è®©ä¸æ€ä¹ˆä½¿ç”¨é»˜è®¤å€¼çš„å½¢å‚å‡ºç°åœ¨å‰é¢ï¼Œè€Œè®©é‚£äº›ç»å¸¸ä½¿ç”¨é»˜è®¤å€¼çš„å½¢å‚å‡ºç°åœ¨åé¢ã€‚</p><p><strong>é»˜è®¤å®å‚å£°æ˜</strong></p><p>åœ¨ç»™å®šçš„ä½œç”¨åŸŸä¸­ä¸€ä¸ªå½¢å‚åªèƒ½è¢«èµ‹äºˆä¸€æ¬¡é»˜è®¤å®å‚ã€‚æ¢å¥è¯è¯´ï¼Œå‡½æ•°çš„åç»­å£°æ˜åªèƒ½ä¸ºä¹‹å‰é‚£äº›æ²¡æœ‰é»˜è®¤å€¼çš„å½¢å‚æ·»åŠ é»˜è®¤å®å‚ï¼Œè€Œä¸”è¯¥å½¢å‚å³ä¾§çš„æ‰€æœ‰å½¢å‚å¿…é¡»éƒ½æœ‰é»˜è®¤å€¼ã€‚</p><blockquote><p>é€šå¸¸ï¼Œåº”è¯¥åœ¨å‡½æ•°å£°æ˜ä¸­æŒ‡å®šé»˜è®¤å®å‚ï¼Œå¹¶å°†è¯¥å£°æ˜æ”¾åœ¨åˆé€‚çš„å¤´æ–‡ä»¶ä¸­ã€‚</p></blockquote><p><strong>é»˜è®¤å®å‚åˆå§‹å€¼</strong></p><p>å±€éƒ¨å˜é‡ä¸èƒ½ä½œä¸ºé»˜è®¤å®å‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåªè¦è¡¨è¾¾å¼çš„ç±»å‹èƒ½è½¬æ¢æˆå½¢å‚æ‰€éœ€çš„ç±»å‹ï¼Œè¯¥è¡¨è¾¾å¼å°±èƒ½ä½œä¸ºé»˜è®¤å®å‚</p><h3 id="6-5-2-å†…è”å‡½æ•°å’Œconstexprå‡½æ•°"><a href="#6-5-2-å†…è”å‡½æ•°å’Œconstexprå‡½æ•°" class="headerlink" title="6.5.2 å†…è”å‡½æ•°å’Œconstexprå‡½æ•°"></a>6.5.2 å†…è”å‡½æ•°å’Œconstexprå‡½æ•°</h3><p><strong>å†…è”å‡½æ•°å¯é¿å…å‡½æ•°è°ƒç”¨çš„å¼€é”€</strong></p><p>å°†å‡½æ•°æŒ‡å®šä¸ºå†…è”å‡½æ•°ï¼ˆinlineï¼‰ï¼Œé€šå¸¸å°±æ˜¯å°†å®ƒåœ¨æ¯ä¸ªè°ƒç”¨ç‚¹ä¸Šâ€œå†…è”åœ°â€å±•å¼€ã€‚</p><blockquote><p>å†…è”è¯´æ˜åªæ˜¯å‘ç¼–è¯‘å™¨å‘å‡ºçš„ä¸€ä¸ªè¯·æ±‚ï¼Œç¼–è¯‘å™¨å¯ä»¥é€‰æ‹©å¿½ç•¥è¿™ä¸ªè¯·æ±‚ã€‚</p></blockquote><p><strong>constexprå‡½æ•°</strong></p><p>constexprå‡½æ•°ï¼ˆconstexpr functionï¼‰æ˜¯æŒ‡èƒ½ç”¨äºå¸¸é‡è¡¨è¾¾å¼ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬58é¡µï¼‰çš„å‡½æ•°ã€‚</p><p>å®šä¹‰constexprå‡½æ•°çš„æ–¹æ³•ä¸å…¶ä»–å‡½æ•°ç±»ä¼¼ï¼Œä¸è¿‡è¦éµå¾ªå‡ é¡¹çº¦å®šï¼šå‡½æ•°çš„è¿”å›ç±»å‹åŠæ‰€æœ‰å½¢å‚çš„ç±»å‹éƒ½å¾—æ˜¯å­—é¢å€¼ç±»å‹ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬59é¡µï¼‰ï¼Œè€Œä¸”å‡½æ•°ä½“ä¸­å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€æ¡returnè¯­å¥</p><p><img src="/../images/C-C-Primer-Chapter-6/1725949081206.png"></p><p>constexprå‡½æ•°ä½“å†…ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–è¯­å¥ï¼Œåªè¦è¿™äº›è¯­å¥åœ¨è¿è¡Œæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œå°±è¡Œã€‚ä¾‹å¦‚ï¼Œconstexprå‡½æ•°ä¸­å¯ä»¥æœ‰ç©ºè¯­å¥ã€ç±»å‹åˆ«åï¼ˆå‚è§2.5.1èŠ‚ï¼Œç¬¬60é¡µï¼‰ä»¥åŠusingå£°æ˜ã€‚</p><blockquote><p>constexprå‡½æ•°ä¸ä¸€å®šè¿”å›å¸¸é‡è¡¨è¾¾å¼ã€‚</p></blockquote><p><strong>æŠŠå†…è”å‡½æ•°å’Œconstexprå‡½æ•°æ”¾åœ¨å¤´æ–‡ä»¶å†…</strong></p><p>å’Œå…¶ä»–å‡½æ•°ä¸ä¸€æ ·ï¼Œå†…è”å‡½æ•°å’Œconstexprå‡½æ•°å¯ä»¥åœ¨ç¨‹åºä¸­å¤šæ¬¡å®šä¹‰ã€‚æ¯•ç«Ÿï¼Œç¼–è¯‘å™¨è¦æƒ³å±•å¼€å‡½æ•°ä»…æœ‰å‡½æ•°å£°æ˜æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦å‡½æ•°çš„å®šä¹‰ã€‚ä¸è¿‡ï¼Œå¯¹äºæŸä¸ªç»™å®šçš„å†…è”å‡½æ•°æˆ–è€…constexprå‡½æ•°æ¥è¯´ï¼Œå®ƒçš„å¤šä¸ªå®šä¹‰å¿…é¡»å®Œå…¨ä¸€è‡´ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼Œå†…è”å‡½æ•°å’Œconstexprå‡½æ•°é€šå¸¸å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­ã€‚</p><h3 id="6-5-3-è°ƒè¯•å¸®åŠ©"><a href="#6-5-3-è°ƒè¯•å¸®åŠ©" class="headerlink" title="6.5.3 è°ƒè¯•å¸®åŠ©"></a>6.5.3 è°ƒè¯•å¸®åŠ©</h3><p>C++ç¨‹åºå‘˜æœ‰æ—¶ä¼šç”¨åˆ°ä¸€ç§ç±»ä¼¼äºå¤´æ–‡ä»¶ä¿æŠ¤ï¼ˆå‚è§2.6.3èŠ‚ï¼Œç¬¬67é¡µï¼‰çš„æŠ€æœ¯ï¼Œä»¥ä¾¿æœ‰é€‰æ‹©åœ°æ‰§è¡Œè°ƒè¯•ä»£ç ã€‚åŸºæœ¬æ€æƒ³æ˜¯ï¼Œç¨‹åºå¯ä»¥åŒ…å«ä¸€äº›ç”¨äºè°ƒè¯•çš„ä»£ç ï¼Œä½†æ˜¯è¿™äº›ä»£ç åªåœ¨å¼€å‘ç¨‹åºæ—¶ä½¿ç”¨ã€‚å½“åº”ç”¨ç¨‹åºç¼–å†™å®Œæˆå‡†å¤‡å‘å¸ƒæ—¶ï¼Œè¦å…ˆå±è”½æ‰è°ƒè¯•ä»£ç ã€‚è¿™ç§æ–¹æ³•ç”¨åˆ°ä¸¤é¡¹é¢„å¤„ç†åŠŸèƒ½ï¼šassertå’ŒNDEBUGã€‚</p><p><strong>asserté¢„å¤„ç†å®</strong></p><p>assertæ˜¯ä¸€ç§é¢„å¤„ç†å®ï¼ˆpreprocessor marcoï¼‰ã€‚æ‰€è°“é¢„å¤„ç†å®å…¶å®æ˜¯ä¸€ä¸ªé¢„å¤„ç†å˜é‡ï¼Œå®ƒçš„è¡Œä¸ºæœ‰ç‚¹ç±»ä¼¼äºå†…è”å‡½æ•°ã€‚assertå®ä½¿ç”¨ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºå®ƒçš„æ¡ä»¶ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-6/image-20240922130516672.png"></p><p>é¦–å…ˆå¯¹expræ±‚å€¼ï¼Œå¦‚æœè¡¨è¾¾å¼ä¸ºå‡ï¼ˆå³0ï¼‰ï¼Œassertè¾“å‡ºä¿¡æ¯å¹¶ç»ˆæ­¢ç¨‹åºçš„æ‰§è¡Œã€‚å¦‚æœè¡¨è¾¾å¼ä¸ºçœŸï¼ˆå³é0ï¼‰ï¼Œassertä»€ä¹ˆä¹Ÿä¸åšã€‚</p><p><strong>NDEBUGé¢„å¤„ç†å˜é‡</strong></p><p>assertçš„è¡Œä¸ºä¾èµ–äºä¸€ä¸ªåä¸ºNDEBUGçš„é¢„å¤„ç†å˜é‡çš„çŠ¶æ€ã€‚å¦‚æœå®šä¹‰äº†NDEBUGï¼Œåˆ™assertä»€ä¹ˆä¹Ÿä¸åšã€‚é»˜è®¤çŠ¶æ€ä¸‹æ²¡æœ‰å®šä¹‰NDEBUGï¼Œæ­¤æ—¶assertå°†æ‰§è¡Œè¿è¡Œæ—¶æ£€æŸ¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª#defineè¯­å¥å®šä¹‰NDEBUGï¼Œä»è€Œå…³é—­è°ƒè¯•çŠ¶æ€ã€‚åŒæ—¶ï¼Œå¾ˆå¤šç¼–è¯‘å™¨éƒ½æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ä½¿æˆ‘ä»¬å¯ä»¥å®šä¹‰é¢„å¤„ç†å˜é‡ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-6/1725949430286.png"></p><p>è¿™æ¡å‘½ä»¤çš„ä½œç”¨ç­‰ä»·äºåœ¨main.cæ–‡ä»¶çš„ä¸€å¼€å§‹å†™#define NDEBUGã€‚</p><p>assertåº”è¯¥ä»…ç”¨äºéªŒè¯é‚£äº›ç¡®å®ä¸å¯èƒ½å‘ç”Ÿçš„äº‹æƒ…ã€‚æˆ‘ä»¬å¯ä»¥æŠŠassertå½“æˆè°ƒè¯•ç¨‹åºçš„ä¸€ç§è¾…åŠ©æ‰‹æ®µï¼Œä½†æ˜¯ä¸èƒ½ç”¨å®ƒæ›¿ä»£çœŸæ­£çš„è¿è¡Œæ—¶é€»è¾‘æ£€æŸ¥ï¼Œä¹Ÿä¸èƒ½æ›¿ä»£ç¨‹åºæœ¬èº«åº”è¯¥åŒ…å«çš„é”™è¯¯æ£€æŸ¥ã€‚</p><p>é™¤äº†ç”¨äºassertå¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨NDEBUGç¼–å†™è‡ªå·±çš„æ¡ä»¶è°ƒè¯•ä»£ç ã€‚å¦‚æœNDEBUGæœªå®šä¹‰ï¼Œå°†æ‰§è¡Œ#ifndefå’Œ#endifä¹‹é—´çš„ä»£ç ï¼›å¦‚æœå®šä¹‰äº†NDEBUGï¼Œè¿™äº›ä»£ç å°†è¢«å¿½ç•¥æ‰ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-6/1725949488042.png"></p><p>æˆ‘ä»¬ä½¿ç”¨å˜é‡__func__è¾“å‡ºå½“å‰è°ƒè¯•çš„å‡½æ•°çš„åå­—ã€‚ç¼–è¯‘å™¨ä¸ºæ¯ä¸ªå‡½æ•°éƒ½å®šä¹‰äº†__func__ï¼Œå®ƒæ˜¯const charçš„ä¸€ä¸ªé™æ€æ•°ç»„ï¼Œç”¨äºå­˜æ”¾å‡½æ•°çš„åå­—ã€‚</p><p>é™¤äº†C++ç¼–è¯‘å™¨å®šä¹‰çš„__func__å¤–ï¼Œé¢„å¤„ç†å™¨è¿˜å®šä¹‰äº†å¦å¤–4ä¸ªå¯¹äºç¨‹åºè°ƒè¯•å¾ˆæœ‰ç”¨çš„åå­—ï¼š</p><p>__FILE__å­˜æ”¾æ–‡ä»¶åçš„å­—ç¬¦ä¸²å­—é¢å€¼ã€‚</p><p>__LINE__å­˜æ”¾å½“å‰è¡Œå·çš„æ•´å‹å­—é¢å€¼ã€‚</p><p>__TIME__å­˜æ”¾æ–‡ä»¶ç¼–è¯‘æ—¶é—´çš„å­—ç¬¦ä¸²å­—é¢å€¼ã€‚</p><p>__DATE__å­˜æ”¾æ–‡ä»¶ç¼–è¯‘æ—¥æœŸçš„å­—ç¬¦ä¸²å­—é¢å€¼ã€‚</p><h2 id="6-6-å‡½æ•°åŒ¹é…"><a href="#6-6-å‡½æ•°åŒ¹é…" class="headerlink" title="6.6 å‡½æ•°åŒ¹é…"></a>6.6 å‡½æ•°åŒ¹é…</h2><p><strong>ç¡®å®šå€™é€‰å‡½æ•°å’Œå¯è¡Œå‡½æ•°</strong></p><p>å‡½æ•°åŒ¹é…çš„ç¬¬ä¸€æ­¥æ˜¯é€‰å®šæœ¬æ¬¡è°ƒç”¨å¯¹åº”çš„é‡è½½å‡½æ•°é›†ï¼Œé›†åˆä¸­çš„å‡½æ•°ç§°ä¸ºå€™é€‰å‡½æ•°ï¼ˆcandidate functionï¼‰ã€‚å€™é€‰å‡½æ•°å…·å¤‡ä¸¤ä¸ªç‰¹å¾ï¼šä¸€æ˜¯ä¸è¢«è°ƒç”¨çš„å‡½æ•°åŒåï¼ŒäºŒæ˜¯å…¶å£°æ˜åœ¨è°ƒç”¨ç‚¹å¯è§ã€‚</p><p>ç¬¬äºŒæ­¥è€ƒå¯Ÿæœ¬æ¬¡è°ƒç”¨æä¾›çš„å®å‚ï¼Œç„¶åä»å€™é€‰å‡½æ•°ä¸­é€‰å‡ºèƒ½è¢«è¿™ç»„å®å‚è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™äº›æ–°é€‰å‡ºçš„å‡½æ•°ç§°ä¸ºå¯è¡Œå‡½æ•°ï¼ˆviable functionï¼‰ã€‚å¯è¡Œå‡½æ•°ä¹Ÿæœ‰ä¸¤ä¸ªç‰¹å¾ï¼šä¸€æ˜¯å…¶å½¢å‚æ•°é‡ä¸æœ¬æ¬¡è°ƒç”¨æä¾›çš„å®å‚æ•°é‡ç›¸ç­‰ï¼ŒäºŒæ˜¯æ¯ä¸ªå®å‚çš„ç±»å‹ä¸å¯¹åº”çš„å½¢å‚ç±»å‹ç›¸åŒï¼Œæˆ–è€…èƒ½è½¬æ¢æˆå½¢å‚çš„ç±»å‹ã€‚</p><p>åœ¨ä½¿ç”¨å®å‚æ•°é‡åˆæ­¥åˆ¤åˆ«äº†å€™é€‰å‡½æ•°åï¼Œæ¥ä¸‹æ¥è€ƒå¯Ÿå®å‚çš„ç±»å‹æ˜¯å¦ä¸å½¢å‚åŒ¹é…ã€‚å’Œä¸€èˆ¬çš„å‡½æ•°è°ƒç”¨ç±»ä¼¼ï¼Œå®å‚ä¸å½¢å‚åŒ¹é…çš„å«ä¹‰å¯èƒ½æ˜¯å®ƒä»¬å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼Œä¹Ÿå¯èƒ½æ˜¯å®å‚ç±»å‹å’Œå½¢å‚ç±»å‹æ»¡è¶³è½¬æ¢è§„åˆ™ã€‚</p><p><strong>å¯»æ‰¾æœ€ä½³åŒ¹é…ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</strong></p><p>å¦‚æœåœ¨æ£€æŸ¥äº†æ‰€æœ‰å®å‚ä¹‹åæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå‡½æ•°è„±é¢–è€Œå‡ºï¼Œåˆ™è¯¥è°ƒç”¨æ˜¯é”™è¯¯çš„ã€‚ç¼–è¯‘å™¨å°†æŠ¥å‘ŠäºŒä¹‰æ€§è°ƒç”¨çš„ä¿¡æ¯ã€‚</p><blockquote><p>è°ƒç”¨é‡è½½å‡½æ•°æ—¶åº”å°½é‡é¿å…å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚å¦‚æœåœ¨å®é™…åº”ç”¨ä¸­ç¡®å®éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œåˆ™è¯´æ˜æˆ‘ä»¬è®¾è®¡çš„å½¢å‚é›†åˆä¸åˆç†ã€‚</p></blockquote><h3 id="6-6-1-å®å‚ç±»å‹è½¬æ¢"><a href="#6-6-1-å®å‚ç±»å‹è½¬æ¢" class="headerlink" title="6.6.1 å®å‚ç±»å‹è½¬æ¢"></a>6.6.1 å®å‚ç±»å‹è½¬æ¢</h3><p>æœ‰æ—¶é—´å†çœ‹ã€‚</p><h2 id="6-7-å‡½æ•°æŒ‡é’ˆ"><a href="#6-7-å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="6.7 å‡½æ•°æŒ‡é’ˆ"></a>6.7 å‡½æ•°æŒ‡é’ˆ</h2><p>å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å‡½æ•°è€Œéå¯¹è±¡ã€‚å’Œå…¶ä»–æŒ‡é’ˆä¸€æ ·ï¼Œå‡½æ•°æŒ‡é’ˆæŒ‡å‘æŸç§ç‰¹å®šç±»å‹ã€‚å‡½æ•°çš„ç±»å‹ç”±å®ƒçš„è¿”å›ç±»å‹å’Œå½¢å‚ç±»å‹å…±åŒå†³å®šï¼Œä¸å‡½æ•°åæ— å…³ã€‚</p><p>è¦æƒ³å£°æ˜ä¸€ä¸ªå¯ä»¥æŒ‡å‘è¯¥å‡½æ•°çš„æŒ‡é’ˆï¼Œåªéœ€è¦ç”¨æŒ‡é’ˆæ›¿æ¢å‡½æ•°åå³å¯</p><p><img src="/../images/C-C-Primer-Chapter-6/1725950202450.png"></p><p><strong>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ</strong></p><p>å½“æˆ‘ä»¬æŠŠå‡½æ•°åä½œä¸ºä¸€ä¸ªå€¼ä½¿ç”¨æ—¶ï¼Œè¯¥å‡½æ•°è‡ªåŠ¨åœ°è½¬æ¢æˆæŒ‡é’ˆã€‚</p><p><img src="/../images/C-C-Primer-Chapter-6/1725950254391.png"></p><p>æˆ‘ä»¬è¿˜èƒ½ç›´æ¥ä½¿ç”¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆè°ƒç”¨è¯¥å‡½æ•°ï¼Œæ— é¡»æå‰è§£å¼•ç”¨æŒ‡é’ˆ</p><p><strong>é‡è½½å‡½æ•°çš„æŒ‡é’ˆ</strong></p><p>ç¼–è¯‘å™¨é€šè¿‡æŒ‡é’ˆç±»å‹å†³å®šé€‰ç”¨å“ªä¸ªå‡½æ•°ï¼ŒæŒ‡é’ˆç±»å‹å¿…é¡»ä¸é‡è½½å‡½æ•°ä¸­çš„æŸä¸€ä¸ªç²¾ç¡®åŒ¹é…</p><p><strong>å‡½æ•°æŒ‡é’ˆå½¢å‚</strong></p><p>è™½ç„¶ä¸èƒ½å®šä¹‰å‡½æ•°ç±»å‹çš„å½¢å‚ï¼Œä½†æ˜¯å½¢å‚å¯ä»¥æ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚æ­¤æ—¶ï¼Œå½¢å‚çœ‹èµ·æ¥æ˜¯å‡½æ•°ç±»å‹ï¼Œå®é™…ä¸Šå´æ˜¯å½“æˆæŒ‡é’ˆä½¿ç”¨</p><p><img src="/../images/C-C-Primer-Chapter-6/1725950359746.png"></p><p>ç›´æ¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆç±»å‹æ˜¾å¾—å†—é•¿è€Œçƒ¦çã€‚ç±»å‹åˆ«åï¼ˆå‚è§2.5.1èŠ‚ï¼Œç¬¬60é¡µï¼‰å’Œdecltypeï¼ˆå‚è§2.5.3èŠ‚ï¼Œç¬¬62é¡µï¼‰èƒ½è®©æˆ‘ä»¬ç®€åŒ–ä½¿ç”¨äº†å‡½æ•°æŒ‡é’ˆçš„ä»£ç </p><p><img src="/../images/C-C-Primer-Chapter-6/1725950417865.png"></p><p><strong>è¿”å›æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ</strong></p><p>è™½ç„¶ä¸èƒ½è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯èƒ½è¿”å›æŒ‡å‘å‡½æ•°ç±»å‹çš„æŒ‡é’ˆã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¿…é¡»æŠŠè¿”å›ç±»å‹å†™æˆæŒ‡é’ˆå½¢å¼ï¼Œç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨åœ°å°†å‡½æ•°è¿”å›ç±»å‹å½“æˆå¯¹åº”çš„æŒ‡é’ˆç±»å‹å¤„ç†ã€‚</p><p>è¦æƒ³å£°æ˜ä¸€ä¸ªè¿”å›å‡½æ•°æŒ‡é’ˆçš„å‡½æ•°ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯ä½¿ç”¨ç±»å‹åˆ«å</p><p><img src="/../images/C-C-Primer-Chapter-6/1725950505765.png"></p><p>å’Œå‡½æ•°ç±»å‹çš„å½¢å‚ä¸ä¸€æ ·ï¼Œè¿”å›ç±»å‹ä¸ä¼šè‡ªåŠ¨åœ°è½¬æ¢æˆæŒ‡é’ˆã€‚æˆ‘ä»¬å¿…é¡»æ˜¾å¼åœ°å°†è¿”å›ç±»å‹æŒ‡å®šä¸ºæŒ‡é’ˆ</p><p><img src="/../images/C-C-Primer-Chapter-6/1725950529974.png"></p><p><img src="/../images/C-C-Primer-Chapter-6/1725950564265.png"></p><p><img src="/../images/C-C-Primer-Chapter-6/1725950558981.png"></p><p><strong>å°†autoå’Œdecltypeç”¨äºå‡½æ•°æŒ‡é’ˆç±»å‹</strong></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 5</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-5/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-5/</url>
    
    <content type="html"><![CDATA[<h1 id="è¯­å¥"><a href="#è¯­å¥" class="headerlink" title="è¯­å¥"></a>è¯­å¥</h1><span id="more"></span><h2 id="5-1-ç®€å•è¯­å¥"><a href="#5-1-ç®€å•è¯­å¥" class="headerlink" title="5.1 ç®€å•è¯­å¥"></a>5.1 ç®€å•è¯­å¥</h2><h2 id="5-2-è¯­å¥ä½œç”¨åŸŸ"><a href="#5-2-è¯­å¥ä½œç”¨åŸŸ" class="headerlink" title="5.2 è¯­å¥ä½œç”¨åŸŸ"></a>5.2 è¯­å¥ä½œç”¨åŸŸ</h2><h2 id="5-3-æ¡ä»¶è¯­å¥"><a href="#5-3-æ¡ä»¶è¯­å¥" class="headerlink" title="5.3 æ¡ä»¶è¯­å¥"></a>5.3 æ¡ä»¶è¯­å¥</h2><h3 id="5-3-1-ifè¯­å¥"><a href="#5-3-1-ifè¯­å¥" class="headerlink" title="5.3.1 ifè¯­å¥"></a>5.3.1 ifè¯­å¥</h3><h3 id="5-3-2-switchè¯­å¥"><a href="#5-3-2-switchè¯­å¥" class="headerlink" title="5.3.2 switchè¯­å¥"></a>5.3.2 switchè¯­å¥</h3><p>switchè¯­å¥ï¼ˆswitch statementï¼‰æä¾›äº†ä¸€æ¡ä¾¿åˆ©çš„é€”å¾„ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨è‹¥å¹²å›ºå®šé€‰é¡¹ä¸­åšå‡ºé€‰æ‹©ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725942532319.png"></p><p>caseå…³é”®å­—å’Œå®ƒå¯¹åº”çš„å€¼ä¸€èµ·è¢«ç§°ä¸ºcaseæ ‡ç­¾ï¼ˆcase labelï¼‰ã€‚caseæ ‡ç­¾å¿…é¡»æ˜¯æ•´å‹å¸¸é‡è¡¨è¾¾å¼ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725942502014.png"></p><p>å³ä½¿ä¸å‡†å¤‡åœ¨defaultæ ‡ç­¾ä¸‹åšä»»ä½•å·¥ä½œï¼Œå®šä¹‰ä¸€ä¸ªdefaultæ ‡ç­¾ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚å…¶ç›®çš„åœ¨äºå‘Šè¯‰ç¨‹åºçš„è¯»è€…ï¼Œæˆ‘ä»¬å·²ç»è€ƒè™‘åˆ°äº†é»˜è®¤çš„æƒ…å†µï¼Œåªæ˜¯ç›®å‰ä»€ä¹ˆä¹Ÿæ²¡åšã€‚</p><p><strong>switchå†…éƒ¨çš„å˜é‡å®šä¹‰</strong></p><p>switchçš„æ‰§è¡Œæµç¨‹æœ‰å¯èƒ½ä¼šè·¨è¿‡æŸäº›caseæ ‡ç­¾ã€‚å¦‚æœç¨‹åºè·³è½¬åˆ°äº†æŸä¸ªç‰¹å®šçš„caseï¼Œåˆ™switchç»“æ„ä¸­è¯¥caseæ ‡ç­¾ä¹‹å‰çš„éƒ¨åˆ†ä¼šè¢«å¿½ç•¥æ‰ã€‚è¿™ç§å¿½ç•¥æ‰ä¸€éƒ¨åˆ†ä»£ç çš„è¡Œä¸ºå¼•å‡ºäº†ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼šå¦‚æœè¢«ç•¥è¿‡çš„ä»£ç ä¸­å«æœ‰å˜é‡çš„å®šä¹‰è¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼šå¦‚æœåœ¨æŸå¤„ä¸€ä¸ªå¸¦æœ‰åˆå€¼çš„å˜é‡ä½äºä½œç”¨åŸŸä¹‹å¤–ï¼Œåœ¨å¦ä¸€å¤„è¯¥å˜é‡ä½äºä½œç”¨åŸŸä¹‹å†…ï¼Œåˆ™ä»å‰ä¸€å¤„è·³è½¬åˆ°åä¸€å¤„çš„è¡Œä¸ºæ˜¯éæ³•è¡Œä¸ºã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725942726914.png"></p><p>å¦‚æœéœ€è¦ä¸ºæŸä¸ªcaseåˆ†æ”¯å®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå˜é‡å®šä¹‰åœ¨å—å†…ï¼Œä»è€Œç¡®ä¿åé¢çš„æ‰€æœ‰caseæ ‡ç­¾éƒ½åœ¨å˜é‡çš„ä½œç”¨åŸŸä¹‹å¤–ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725942745906.png"></p><h2 id="5-4-è¿­ä»£è¯­å¥"><a href="#5-4-è¿­ä»£è¯­å¥" class="headerlink" title="5.4 è¿­ä»£è¯­å¥"></a>5.4 è¿­ä»£è¯­å¥</h2><h3 id="5-4-1-whileè¯­å¥"><a href="#5-4-1-whileè¯­å¥" class="headerlink" title="5.4.1 whileè¯­å¥"></a>5.4.1 whileè¯­å¥</h3><p><img src="/../images/C-C-Primer-Chapter-5/1725942801324.png"></p><blockquote><p>å®šä¹‰åœ¨whileæ¡ä»¶éƒ¨åˆ†æˆ–è€…whileå¾ªç¯ä½“å†…çš„å˜é‡æ¯æ¬¡è¿­ä»£éƒ½ç»å†ä»åˆ›å»ºåˆ°é”€æ¯çš„è¿‡ç¨‹ã€‚</p></blockquote><h3 id="5-4-2-forè¯­å¥"><a href="#5-4-2-forè¯­å¥" class="headerlink" title="5.4.2 forè¯­å¥"></a>5.4.2 forè¯­å¥</h3><p><img src="/../images/C-C-Primer-Chapter-5/1725942926719.png"></p><p>init-statementå¿…é¡»æ˜¯ä»¥ä¸‹ä¸‰ç§å½¢å¼ä¸­çš„ä¸€ç§ï¼šå£°æ˜è¯­å¥ã€è¡¨è¾¾å¼è¯­å¥æˆ–è€…ç©ºè¯­å¥</p><p>init-statementè´Ÿè´£åˆå§‹åŒ–ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°†éšç€å¾ªç¯çš„è¿›è¡Œè€Œæ”¹å˜ã€‚conditionä½œä¸ºå¾ªç¯æ§åˆ¶çš„æ¡ä»¶ï¼Œåªè¦conditionä¸ºçœŸï¼Œå°±æ‰§è¡Œä¸€æ¬¡statementã€‚å¦‚æœconditionç¬¬ä¸€æ¬¡çš„æ±‚å€¼ç»“æœå°±æ˜¯falseï¼Œåˆ™statementä¸€æ¬¡ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚expressionè´Ÿè´£ä¿®æ”¹init-statementåˆå§‹åŒ–çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ­£å¥½å°±æ˜¯conditionæ£€æŸ¥çš„å¯¹è±¡ï¼Œä¿®æ”¹å‘ç”Ÿåœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¹‹åã€‚</p><h3 id="5-4-3-èŒƒå›´forè¯­å¥"><a href="#5-4-3-èŒƒå›´forè¯­å¥" class="headerlink" title="5.4.3 èŒƒå›´forè¯­å¥"></a>5.4.3 èŒƒå›´forè¯­å¥</h3><p><img src="/../images/C-C-Primer-Chapter-5/1725943065748.png"></p><p>expressionè¡¨ç¤ºçš„å¿…é¡»æ˜¯ä¸€ä¸ªåºåˆ—ï¼Œæ¯”å¦‚ç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥çš„åˆå§‹å€¼åˆ—è¡¨ï¼ˆå‚è§3.3.1èŠ‚ï¼Œç¬¬88é¡µï¼‰ã€æ•°ç»„ï¼ˆå‚è§3.5èŠ‚ï¼Œç¬¬101é¡µï¼‰æˆ–è€…vectoræˆ–stringç­‰ç±»å‹çš„å¯¹è±¡ï¼Œè¿™äº›ç±»å‹çš„å…±åŒç‰¹ç‚¹æ˜¯æ‹¥æœ‰èƒ½è¿”å›è¿­ä»£å™¨çš„beginå’Œendæˆå‘˜ï¼ˆå‚è§3.4èŠ‚ï¼Œç¬¬95é¡µï¼‰ã€‚</p><p>åœ¨èŒƒå›´forè¯­å¥ä¸­ï¼Œé¢„å­˜äº†endï¼ˆï¼‰çš„å€¼ã€‚ä¸€æ—¦åœ¨åºåˆ—ä¸­æ·»åŠ ï¼ˆåˆ é™¤ï¼‰å…ƒç´ ï¼Œendå‡½æ•°çš„å€¼å°±å¯èƒ½å˜å¾—æ— æ•ˆäº†ï¼ˆå‚è§3.4.1èŠ‚ï¼Œç¬¬98é¡µï¼‰ã€‚</p><h3 id="5-4-4-do-whileè¯­å¥"><a href="#5-4-4-do-whileè¯­å¥" class="headerlink" title="5.4.4 do whileè¯­å¥"></a>5.4.4 do whileè¯­å¥</h3><p><img src="/../images/C-C-Primer-Chapter-5/1725943185144.png"></p><h2 id="5-5-è·³è½¬è¯­å¥"><a href="#5-5-è·³è½¬è¯­å¥" class="headerlink" title="5.5 è·³è½¬è¯­å¥"></a>5.5 è·³è½¬è¯­å¥</h2><p>è·³è½¬è¯­å¥ä¸­æ–­å½“å‰çš„æ‰§è¡Œè¿‡ç¨‹ã€‚C++è¯­è¨€æä¾›äº†4ç§è·³è½¬è¯­å¥ï¼šbreakã€continueã€gotoå’Œreturnã€‚</p><h3 id="5-5-1-breakè¯­å¥"><a href="#5-5-1-breakè¯­å¥" class="headerlink" title="5.5.1 breakè¯­å¥"></a>5.5.1 breakè¯­å¥</h3><h3 id="5-5-2-continueè¯­å¥"><a href="#5-5-2-continueè¯­å¥" class="headerlink" title="5.5.2 continueè¯­å¥"></a>5.5.2 continueè¯­å¥</h3><h3 id="5-5-3-gotoè¯­å¥"><a href="#5-5-3-gotoè¯­å¥" class="headerlink" title="5.5.3 gotoè¯­å¥"></a>5.5.3 gotoè¯­å¥</h3><p><img src="/../images/C-C-Primer-Chapter-5/1725943324855.png"></p><p>å…¶ä¸­ï¼Œlabelæ˜¯ç”¨äºæ ‡è¯†ä¸€æ¡è¯­å¥çš„æ ‡ç¤ºç¬¦ã€‚å¸¦æ ‡ç­¾è¯­å¥ï¼ˆlabeled statementï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­å¥ï¼Œåœ¨å®ƒä¹‹å‰æœ‰ä¸€ä¸ªæ ‡ç¤ºç¬¦ä»¥åŠä¸€ä¸ªå†’å·ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-5/1725943337648.png"></p><blockquote><p>ä¸è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨gotoè¯­å¥ï¼Œå› ä¸ºå®ƒä½¿å¾—ç¨‹åºæ—¢éš¾ç†è§£åˆéš¾ä¿®æ”¹ã€‚</p></blockquote><h2 id="5-2-tryè¯­å¥å—å’Œå¼‚å¸¸å¤„ç†"><a href="#5-2-tryè¯­å¥å—å’Œå¼‚å¸¸å¤„ç†" class="headerlink" title="5.2 tryè¯­å¥å—å’Œå¼‚å¸¸å¤„ç†"></a>5.2 tryè¯­å¥å—å’Œå¼‚å¸¸å¤„ç†</h2><p>å¼‚å¸¸æ˜¯æŒ‡å­˜åœ¨äºè¿è¡Œæ—¶çš„åå¸¸è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºè¶…å‡ºäº†å‡½æ•°æ­£å¸¸åŠŸèƒ½çš„èŒƒå›´ã€‚å…¸å‹çš„å¼‚å¸¸åŒ…æ‹¬å¤±å»æ•°æ®åº“è¿æ¥ä»¥åŠé‡åˆ°æ„å¤–è¾“å…¥ç­‰ã€‚å¤„ç†åå¸¸è¡Œä¸ºå¯èƒ½æ˜¯è®¾è®¡æ‰€æœ‰ç³»ç»Ÿæœ€éš¾çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨C++è¯­è¨€ä¸­ï¼Œå¼‚å¸¸å¤„ç†åŒ…æ‹¬ï¼š</p><p><strong>throwè¡¨è¾¾å¼ï¼ˆthrow expressionï¼‰</strong>ï¼Œå¼‚å¸¸æ£€æµ‹éƒ¨åˆ†ä½¿ç”¨throwè¡¨è¾¾å¼æ¥è¡¨ç¤ºå®ƒé‡åˆ°äº†æ— æ³•å¤„ç†çš„é—®é¢˜ã€‚æˆ‘ä»¬è¯´throwå¼•å‘ï¼ˆraiseï¼‰äº†å¼‚å¸¸ã€‚</p><p><strong>tryè¯­å¥å—ï¼ˆtry blockï¼‰</strong>ï¼Œå¼‚å¸¸å¤„ç†éƒ¨åˆ†ä½¿ç”¨tryè¯­å¥å—å¤„ç†å¼‚å¸¸ã€‚tryè¯­å¥å—ä»¥å…³é”®å­—tryå¼€å§‹ï¼Œå¹¶ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªcatchå­å¥ï¼ˆcatch clauseï¼‰ç»“æŸã€‚tryè¯­å¥å—ä¸­ä»£ç æŠ›å‡ºçš„å¼‚å¸¸é€šå¸¸ä¼šè¢«æŸä¸ªcatchå­å¥å¤„ç†ã€‚å› ä¸ºcatchå­å¥â€œå¤„ç†â€å¼‚å¸¸ï¼Œæ‰€ä»¥å®ƒä»¬ä¹Ÿè¢«ç§°ä½œå¼‚å¸¸å¤„ç†ä»£ç ï¼ˆexception handlerï¼‰ã€‚</p><p><strong>ä¸€å¥—å¼‚å¸¸ç±»ï¼ˆexception classï¼‰</strong>ï¼Œç”¨äºåœ¨throwè¡¨è¾¾å¼å’Œç›¸å…³çš„catchå­å¥ä¹‹é—´ä¼ é€’å¼‚å¸¸çš„å…·ä½“ä¿¡æ¯ã€‚</p><h3 id="5-6-1-throwè¡¨è¾¾å¼"><a href="#5-6-1-throwè¡¨è¾¾å¼" class="headerlink" title="5.6.1 throwè¡¨è¾¾å¼"></a>5.6.1 throwè¡¨è¾¾å¼</h3><p>throwè¡¨è¾¾å¼åŒ…å«å…³é”®å­—throwå’Œç´§éšå…¶åçš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶ä¸­è¡¨è¾¾å¼çš„ç±»å‹å°±æ˜¯æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚throwè¡¨è¾¾å¼åé¢é€šå¸¸ç´§è·Ÿä¸€ä¸ªåˆ†å·ï¼Œä»è€Œæ„æˆä¸€æ¡è¡¨è¾¾å¼è¯­å¥ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725943584527.png"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœISBNä¸ä¸€æ ·å°±æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸æ˜¯ç±»å‹runtime_errorçš„å¯¹è±¡ã€‚æŠ›å‡ºå¼‚å¸¸å°†ç»ˆæ­¢å½“å‰çš„å‡½æ•°ï¼Œå¹¶æŠŠæ§åˆ¶æƒè½¬ç§»ç»™èƒ½å¤„ç†è¯¥å¼‚å¸¸çš„ä»£ç ã€‚</p><p>ç±»å‹runtime_erroræ˜¯æ ‡å‡†åº“å¼‚å¸¸ç±»å‹çš„ä¸€ç§ï¼Œå®šä¹‰åœ¨stdexceptå¤´æ–‡ä»¶ä¸­ã€‚å…³äºæ ‡å‡†åº“å¼‚å¸¸ç±»å‹æ›´å¤šçš„çŸ¥è¯†å°†åœ¨5.6.3èŠ‚ï¼ˆç¬¬176é¡µï¼‰ä»‹ç»ã€‚æˆ‘ä»¬å¿…é¡»åˆå§‹åŒ–runtime_errorçš„å¯¹è±¡ï¼Œæ–¹å¼æ˜¯ç»™å®ƒæä¾›ä¸€ä¸ªstringå¯¹è±¡æˆ–è€…ä¸€ä¸ªCé£æ ¼çš„å­—ç¬¦ä¸²ï¼ˆå‚è§3.5.4èŠ‚ï¼Œç¬¬109é¡µï¼‰ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä¸­æœ‰ä¸€äº›å…³äºå¼‚å¸¸çš„è¾…åŠ©ä¿¡æ¯ã€‚</p><h3 id="5-6-2-tryè¯­å¥å—"><a href="#5-6-2-tryè¯­å¥å—" class="headerlink" title="5.6.2 tryè¯­å¥å—"></a>5.6.2 tryè¯­å¥å—</h3><p><img src="/../images/C-C-Primer-Chapter-5/1725943641521.png"></p><p>tryè¯­å¥å—çš„ä¸€å¼€å§‹æ˜¯å…³é”®å­—tryï¼Œéšåç´§è·Ÿç€ä¸€ä¸ªå—ï¼Œè¿™ä¸ªå—å°±åƒå¤§å¤šæ•°æ—¶å€™é‚£æ ·æ˜¯èŠ±æ‹¬å·æ‹¬èµ·æ¥çš„è¯­å¥åºåˆ—ã€‚</p><p>è·Ÿåœ¨tryå—ä¹‹åçš„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªcatchå­å¥ã€‚catchå­å¥åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šå…³é”®å­—catchã€æ‹¬å·å†…ä¸€ä¸ªï¼ˆå¯èƒ½æœªå‘½åçš„ï¼‰å¯¹è±¡çš„å£°æ˜ï¼ˆç§°ä½œå¼‚å¸¸å£°æ˜ï¼Œexception declarationï¼‰ä»¥åŠä¸€ä¸ªå—ã€‚å½“é€‰ä¸­äº†æŸä¸ªcatchå­å¥å¤„ç†å¼‚å¸¸ä¹‹åï¼Œæ‰§è¡Œä¸ä¹‹å¯¹åº”çš„å—ã€‚catchä¸€æ—¦å®Œæˆï¼Œç¨‹åºè·³è½¬åˆ°tryè¯­å¥å—æœ€åä¸€ä¸ªcatchå­å¥ä¹‹åçš„é‚£æ¡è¯­å¥ç»§ç»­æ‰§è¡Œã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725943730068.png"></p><p>æ¯ä¸ªæ ‡å‡†åº“å¼‚å¸¸ç±»éƒ½å®šä¹‰äº†åä¸ºwhatçš„æˆå‘˜å‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œè¿”å›å€¼æ˜¯Cé£æ ¼å­—ç¬¦ä¸²ï¼ˆå³const charï¼Šï¼‰ã€‚å…¶ä¸­ï¼Œruntime_errorçš„whatæˆå‘˜è¿”å›çš„æ˜¯åˆå§‹åŒ–ä¸€ä¸ªå…·ä½“å¯¹è±¡æ—¶æ‰€ç”¨çš„stringå¯¹è±¡çš„å‰¯æœ¬ã€‚</p><p>åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œç¨‹åºåœ¨é‡åˆ°æŠ›å‡ºå¼‚å¸¸çš„ä»£ç å‰ï¼Œå…¶æ‰§è¡Œè·¯å¾„å¯èƒ½å·²ç»ç»è¿‡äº†å¤šä¸ªtryè¯­å¥å—ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªtryè¯­å¥å—å¯èƒ½è°ƒç”¨äº†åŒ…å«å¦ä¸€ä¸ªtryè¯­å¥å—çš„å‡½æ•°ï¼Œæ–°çš„tryè¯­å¥å—å¯èƒ½è°ƒç”¨äº†åŒ…å«åˆä¸€ä¸ªtryè¯­å¥å—çš„æ–°å‡½æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>å¯»æ‰¾å¤„ç†ä»£ç çš„è¿‡ç¨‹ä¸å‡½æ•°è°ƒç”¨é“¾åˆšå¥½ç›¸åã€‚å½“å¼‚å¸¸è¢«æŠ›å‡ºæ—¶ï¼Œé¦–å…ˆæœç´¢æŠ›å‡ºè¯¥å¼‚å¸¸çš„å‡½æ•°ã€‚å¦‚æœæ²¡æ‰¾åˆ°åŒ¹é…çš„catchå­å¥ï¼Œç»ˆæ­¢è¯¥å‡½æ•°ï¼Œå¹¶åœ¨è°ƒç”¨è¯¥å‡½æ•°çš„å‡½æ•°ä¸­ç»§ç»­å¯»æ‰¾ã€‚å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„catchå­å¥ï¼Œè¿™ä¸ªæ–°çš„å‡½æ•°ä¹Ÿè¢«ç»ˆæ­¢ï¼Œç»§ç»­æœç´¢è°ƒç”¨å®ƒçš„å‡½æ•°ã€‚ä»¥æ­¤ç±»æ¨ï¼Œæ²¿ç€ç¨‹åºçš„æ‰§è¡Œè·¯å¾„é€å±‚å›é€€ï¼Œç›´åˆ°æ‰¾åˆ°é€‚å½“ç±»å‹çš„catchå­å¥ä¸ºæ­¢ã€‚å¦‚æœæœ€ç»ˆè¿˜æ˜¯æ²¡èƒ½æ‰¾åˆ°ä»»ä½•åŒ¹é…çš„catchå­å¥ï¼Œç¨‹åºè½¬åˆ°åä¸ºterminateçš„æ ‡å‡†åº“å‡½æ•°ã€‚è¯¥å‡½æ•°çš„è¡Œä¸ºä¸ç³»ç»Ÿæœ‰å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‰§è¡Œè¯¥å‡½æ•°å°†å¯¼è‡´ç¨‹åºéæ­£å¸¸é€€å‡ºã€‚</p><p>å¯¹äºé‚£äº›æ²¡æœ‰ä»»ä½•tryè¯­å¥å—å®šä¹‰çš„å¼‚å¸¸ï¼Œä¹ŸæŒ‰ç…§ç±»ä¼¼çš„æ–¹å¼å¤„ç†ï¼šæ¯•ç«Ÿï¼Œæ²¡æœ‰tryè¯­å¥å—ä¹Ÿå°±æ„å‘³ç€æ²¡æœ‰åŒ¹é…çš„catchå­å¥ã€‚å¦‚æœä¸€æ®µç¨‹åºæ²¡æœ‰tryè¯­å¥å—ä¸”å‘ç”Ÿäº†å¼‚å¸¸ï¼Œç³»ç»Ÿä¼šè°ƒç”¨terminateå‡½æ•°å¹¶ç»ˆæ­¢å½“å‰ç¨‹åºçš„æ‰§è¡Œã€‚</p><p><strong>ç¼–å†™å¼‚å¸¸å®‰å…¨çš„ä»£ç éå¸¸å›°éš¾</strong></p><p>å¼‚å¸¸ä¸­æ–­äº†ç¨‹åºçš„æ­£å¸¸æµç¨‹ã€‚å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œè°ƒç”¨è€…è¯·æ±‚çš„ä¸€éƒ¨åˆ†è®¡ç®—å¯èƒ½å·²ç»å®Œæˆäº†ï¼Œå¦ä¸€éƒ¨åˆ†åˆ™å°šæœªå®Œæˆã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç•¥è¿‡éƒ¨åˆ†ç¨‹åºæ„å‘³ç€æŸäº›å¯¹è±¡å¤„ç†åˆ°ä¸€åŠå°±æˆ›ç„¶è€Œæ­¢ï¼Œä»è€Œå¯¼è‡´å¯¹è±¡å¤„äºæ— æ•ˆæˆ–æœªå®Œæˆçš„çŠ¶æ€ï¼Œæˆ–è€…èµ„æºæ²¡æœ‰æ­£å¸¸é‡Šæ”¾ï¼Œç­‰ç­‰ã€‚</p><p>é‚£äº›åœ¨å¼‚å¸¸å‘ç”ŸæœŸé—´æ­£ç¡®æ‰§è¡Œäº†â€œæ¸…ç†â€å·¥ä½œçš„ç¨‹åºè¢«ç§°ä½œå¼‚å¸¸å®‰å…¨ï¼ˆexception safeï¼‰çš„ä»£ç ã€‚ç„¶è€Œç»éªŒè¡¨æ˜ï¼Œç¼–å†™å¼‚å¸¸å®‰å…¨çš„ä»£ç éå¸¸å›°éš¾ï¼Œè¿™éƒ¨åˆ†çŸ¥è¯†ä¹Ÿï¼ˆè¿œè¿œï¼‰è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ã€‚å¯¹äºä¸€äº›ç¨‹åºæ¥è¯´ï¼Œå½“å¼‚å¸¸å‘ç”Ÿæ—¶åªæ˜¯ç®€å•åœ°ç»ˆæ­¢ç¨‹åºã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸æ€ä¹ˆéœ€è¦æ‹…å¿ƒå¼‚å¸¸å®‰å…¨çš„é—®é¢˜ã€‚ä½†æ˜¯å¯¹äºé‚£äº›ç¡®å®è¦å¤„ç†å¼‚å¸¸å¹¶ç»§ç»­æ‰§è¡Œçš„ç¨‹åºï¼Œå°±è¦åŠ å€æ³¨æ„äº†ã€‚æˆ‘ä»¬å¿…é¡»æ—¶åˆ»æ¸…æ¥šå¼‚å¸¸ä½•æ—¶å‘ç”Ÿï¼Œå¼‚å¸¸å‘ç”Ÿåç¨‹åºåº”å¦‚ä½•ç¡®ä¿å¯¹è±¡æœ‰æ•ˆã€èµ„æºæ— æ³„æ¼ã€ç¨‹åºå¤„äºåˆç†çŠ¶æ€ï¼Œç­‰ç­‰ã€‚</p><h3 id="5-6-3-æ ‡å‡†å¼‚å¸¸"><a href="#5-6-3-æ ‡å‡†å¼‚å¸¸" class="headerlink" title="5.6.3 æ ‡å‡†å¼‚å¸¸"></a>5.6.3 æ ‡å‡†å¼‚å¸¸</h3><p>C++æ ‡å‡†åº“å®šä¹‰äº†ä¸€ç»„ç±»ï¼Œç”¨äºæŠ¥å‘Šæ ‡å‡†åº“å‡½æ•°é‡åˆ°çš„é—®é¢˜ã€‚è¿™äº›å¼‚å¸¸ç±»ä¹Ÿå¯ä»¥åœ¨ç”¨æˆ·ç¼–å†™çš„ç¨‹åºä¸­ä½¿ç”¨ï¼Œå®ƒä»¬åˆ†åˆ«å®šä¹‰åœ¨4ä¸ªå¤´æ–‡ä»¶ä¸­</p><p>exceptionå¤´æ–‡ä»¶å®šä¹‰äº†æœ€é€šç”¨çš„å¼‚å¸¸ç±»exceptionã€‚å®ƒåªæŠ¥å‘Šå¼‚å¸¸çš„å‘ç”Ÿï¼Œä¸æä¾›ä»»ä½•é¢å¤–ä¿¡æ¯ã€‚</p><p>stdexceptå¤´æ–‡ä»¶å®šä¹‰äº†å‡ ç§å¸¸ç”¨çš„å¼‚å¸¸ç±»ï¼Œè¯¦ç»†ä¿¡æ¯åœ¨è¡¨5.1ä¸­åˆ—å‡ºã€‚</p><p><img src="/../images/C-C-Primer-Chapter-5/1725944160121.png"></p><p>newå¤´æ–‡ä»¶å®šä¹‰äº†bad_allocå¼‚å¸¸ç±»å‹ï¼Œè¿™ç§ç±»å‹å°†åœ¨12.1.2èŠ‚ï¼ˆç¬¬407é¡µï¼‰è¯¦ç»†ä»‹ç»ã€‚</p><p>type_infoå¤´æ–‡ä»¶å®šä¹‰äº†bad_castå¼‚å¸¸ç±»å‹ï¼Œè¿™ç§ç±»å‹å°†åœ¨19.2èŠ‚ï¼ˆç¬¬731é¡µï¼‰è¯¦ç»†ä»‹ç»ã€‚</p><p>æˆ‘ä»¬åªèƒ½ä»¥é»˜è®¤åˆå§‹åŒ–ï¼ˆå‚è§2.2.1èŠ‚ï¼Œç¬¬40é¡µï¼‰çš„æ–¹å¼åˆå§‹åŒ–exceptionã€bad_allocå’Œbad_castå¯¹è±¡ï¼Œä¸å…è®¸ä¸ºè¿™äº›å¯¹è±¡æä¾›åˆå§‹å€¼ã€‚</p><p>å…¶ä»–å¼‚å¸¸ç±»å‹çš„è¡Œä¸ºåˆ™æ°å¥½ç›¸åï¼šåº”è¯¥ä½¿ç”¨stringå¯¹è±¡æˆ–è€…Cé£æ ¼å­—ç¬¦ä¸²åˆå§‹åŒ–è¿™äº›ç±»å‹çš„å¯¹è±¡ï¼Œä½†æ˜¯ä¸å…è®¸ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–çš„æ–¹å¼ã€‚å½“åˆ›å»ºæ­¤ç±»å¯¹è±¡æ—¶ï¼Œå¿…é¡»æä¾›åˆå§‹å€¼ï¼Œè¯¥åˆå§‹å€¼å«æœ‰é”™è¯¯ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p>å¼‚å¸¸ç±»å‹åªå®šä¹‰äº†ä¸€ä¸ªåä¸ºwhatçš„æˆå‘˜å‡½æ•°ï¼Œè¯¥å‡½æ•°æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘Cé£æ ¼å­—ç¬¦ä¸²ï¼ˆå‚è§3.5.4èŠ‚ï¼Œç¬¬109é¡µï¼‰çš„const charï¼Šã€‚è¯¥å­—ç¬¦ä¸²çš„ç›®çš„æ˜¯æä¾›å…³äºå¼‚å¸¸çš„ä¸€äº›æ–‡æœ¬ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 4</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-4/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-4/</url>
    
    <content type="html"><![CDATA[<h1 id="è¡¨è¾¾å¼"><a href="#è¡¨è¾¾å¼" class="headerlink" title="è¡¨è¾¾å¼"></a>è¡¨è¾¾å¼</h1><span id="more"></span><h2 id="4-1-åŸºç¡€"><a href="#4-1-åŸºç¡€" class="headerlink" title="4.1 åŸºç¡€"></a>4.1 åŸºç¡€</h2><h3 id="4-1-1-åŸºæœ¬æ¦‚å¿µ"><a href="#4-1-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="4.1.1 åŸºæœ¬æ¦‚å¿µ"></a>4.1.1 åŸºæœ¬æ¦‚å¿µ</h3><p><strong>å·¦å€¼å’Œå³å€¼</strong></p><p>åœ¨C++è¯­è¨€ä¸­ï¼ŒäºŒè€…çš„åŒºåˆ«å°±æ²¡é‚£ä¹ˆç®€å•äº†ã€‚ä¸€ä¸ªå·¦å€¼è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœæ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…ä¸€ä¸ªå‡½æ•°ï¼Œç„¶è€Œä»¥å¸¸é‡å¯¹è±¡ä¸ºä»£è¡¨çš„æŸäº›å·¦å€¼å®é™…ä¸Šä¸èƒ½ä½œä¸ºèµ‹å€¼è¯­å¥çš„å·¦ä¾§è¿ç®—å¯¹è±¡ã€‚æ­¤å¤–ï¼Œè™½ç„¶æŸäº›è¡¨è¾¾å¼çš„æ±‚å€¼ç»“æœæ˜¯å¯¹è±¡ï¼Œä½†å®ƒä»¬æ˜¯å³å€¼è€Œéå·¦å€¼ã€‚å¯ä»¥åšä¸€ä¸ªç®€å•çš„å½’çº³ï¼š<strong>å½“ä¸€ä¸ªå¯¹è±¡è¢«ç”¨ä½œå³å€¼çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯å¯¹è±¡çš„å€¼ï¼ˆå†…å®¹ï¼‰ï¼›å½“å¯¹è±¡è¢«ç”¨ä½œå·¦å€¼çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯å¯¹è±¡çš„èº«ä»½ï¼ˆåœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼‰ã€‚</strong></p><h3 id="4-1-2-ä¼˜å…ˆçº§ä¸ç»“åˆå¾‹"><a href="#4-1-2-ä¼˜å…ˆçº§ä¸ç»“åˆå¾‹" class="headerlink" title="4.1.2 ä¼˜å…ˆçº§ä¸ç»“åˆå¾‹"></a>4.1.2 ä¼˜å…ˆçº§ä¸ç»“åˆå¾‹</h3><h3 id="4-1-3-æ±‚å€¼é¡ºåº"><a href="#4-1-3-æ±‚å€¼é¡ºåº" class="headerlink" title="4.1.3 æ±‚å€¼é¡ºåº"></a>4.1.3 æ±‚å€¼é¡ºåº</h3><p>ä¼˜å…ˆçº§è§„å®šäº†è¿ç®—å¯¹è±¡çš„ç»„åˆæ–¹å¼ï¼Œä½†æ˜¯æ²¡æœ‰è¯´æ˜è¿ç®—å¯¹è±¡æŒ‰ç…§ä»€ä¹ˆé¡ºåºæ±‚å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸ä¼šæ˜ç¡®æŒ‡å®šæ±‚å€¼çš„é¡ºåºã€‚å¯¹äºå¦‚ä¸‹çš„è¡¨è¾¾å¼</p><p><img src="/../images/C-C-Primer-Chapter-4/1725501309710.png"></p><p>æˆ‘ä»¬çŸ¥é“f1å’Œf2ä¸€å®šä¼šåœ¨æ‰§è¡Œä¹˜æ³•ä¹‹å‰è¢«è°ƒç”¨ï¼Œå› ä¸ºæ¯•ç«Ÿç›¸ä¹˜çš„æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°çš„è¿”å›å€¼ã€‚ä½†æ˜¯æˆ‘ä»¬æ— æ³•çŸ¥é“åˆ°åº•f1åœ¨f2ä¹‹å‰è°ƒç”¨è¿˜æ˜¯f2åœ¨f1ä¹‹å‰è°ƒç”¨ã€‚</p><p>æœ‰4ç§è¿ç®—ç¬¦<strong>æ˜ç¡®è§„å®šäº†è¿ç®—å¯¹è±¡çš„æ±‚å€¼é¡ºåº</strong>ï¼š</p><p>1.é€»è¾‘ä¸ï¼ˆ&amp;&amp;ï¼‰è¿ç®—ç¬¦ï¼Œå®ƒè§„å®šå…ˆæ±‚å·¦ä¾§è¿ç®—å¯¹è±¡çš„å€¼ï¼Œåªæœ‰å½“å·¦ä¾§è¿ç®—å¯¹è±¡çš„å€¼ä¸ºçœŸæ—¶æ‰ç»§ç»­æ±‚å³ä¾§è¿ç®—å¯¹è±¡çš„å€¼ã€‚</p><p>2.é€»è¾‘æˆ–ï¼ˆ||ï¼‰è¿ç®—ç¬¦ï¼ˆå‚è§4.3èŠ‚ï¼Œç¬¬126é¡µï¼‰ã€</p><p>3.æ¡ä»¶ï¼ˆï¼Ÿï¼šï¼‰è¿ç®—ç¬¦ï¼ˆå‚è§4.7èŠ‚ï¼Œç¬¬134é¡µï¼‰</p><p>4.é€—å·ï¼ˆï¼Œï¼‰è¿ç®—ç¬¦ï¼ˆå‚è§4.10èŠ‚ï¼Œç¬¬140é¡µï¼‰ã€‚</p><h2 id="4-2-ç®—æœ¯è¿ç®—ç¬¦"><a href="#4-2-ç®—æœ¯è¿ç®—ç¬¦" class="headerlink" title="4.2 ç®—æœ¯è¿ç®—ç¬¦"></a>4.2 ç®—æœ¯è¿ç®—ç¬¦</h2><p>C++11æ–°æ ‡å‡†åˆ™è§„å®šå•†ä¸€å¾‹å‘0å–æ•´ï¼ˆå³ç›´æ¥åˆ‡é™¤å°æ•°éƒ¨åˆ†ï¼‰ã€‚</p><h2 id="4-3-é€»è¾‘å’Œå…³ç³»è¿ç®—ç¬¦"><a href="#4-3-é€»è¾‘å’Œå…³ç³»è¿ç®—ç¬¦" class="headerlink" title="4.3ã€€é€»è¾‘å’Œå…³ç³»è¿ç®—ç¬¦"></a>4.3ã€€é€»è¾‘å’Œå…³ç³»è¿ç®—ç¬¦</h2><h2 id="4-4-èµ‹å€¼è¿ç®—ç¬¦"><a href="#4-4-èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="4.4ã€€èµ‹å€¼è¿ç®—ç¬¦"></a>4.4ã€€èµ‹å€¼è¿ç®—ç¬¦</h2><p>èµ‹å€¼è¿ç®—è¿”å›çš„æ˜¯å…¶å·¦ä¾§çš„è¿ç®—å¯¹è±¡</p><p><strong>èµ‹å€¼è¿ç®—æ»¡è¶³å³ç»“åˆå¾‹</strong></p><h2 id="4-5-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"><a href="#4-5-é€’å¢å’Œé€’å‡è¿ç®—ç¬¦" class="headerlink" title="4.5 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦"></a>4.5 é€’å¢å’Œé€’å‡è¿ç®—ç¬¦</h2><p>é€’å¢å’Œé€’å‡è¿ç®—ç¬¦æœ‰ä¸¤ç§å½¢å¼ï¼šå‰ç½®ç‰ˆæœ¬å’Œåç½®ç‰ˆæœ¬ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ¬ä¹¦ä½¿ç”¨çš„éƒ½æ˜¯å‰ç½®ç‰ˆæœ¬ï¼Œè¿™ç§å½¢å¼çš„è¿ç®—ç¬¦é¦–å…ˆå°†è¿ç®—å¯¹è±¡åŠ 1ï¼ˆæˆ–å‡1ï¼‰ï¼Œç„¶åå°†æ”¹å˜åçš„å¯¹è±¡ä½œä¸ºæ±‚å€¼ç»“æœã€‚åç½®ç‰ˆæœ¬ä¹Ÿä¼šå°†è¿ç®—å¯¹è±¡åŠ 1ï¼ˆæˆ–å‡1ï¼‰ï¼Œä½†æ˜¯æ±‚å€¼ç»“æœæ˜¯è¿ç®—å¯¹è±¡æ”¹å˜ä¹‹å‰é‚£ä¸ªå€¼çš„å‰¯æœ¬</p><p>è¿™ä¸¤ç§è¿ç®—ç¬¦å¿…é¡»ä½œç”¨äºå·¦å€¼è¿ç®—å¯¹è±¡ã€‚å‰ç½®ç‰ˆæœ¬å°†å¯¹è±¡æœ¬èº«ä½œä¸ºå·¦å€¼è¿”å›ï¼Œåç½®ç‰ˆæœ¬åˆ™å°†å¯¹è±¡åŸå§‹å€¼çš„å‰¯æœ¬ä½œä¸ºå³å€¼è¿”å›ã€‚</p><blockquote><p>å»ºè®®ï¼šé™¤éå¿…é¡»ï¼Œå¦åˆ™ä¸ç”¨é€’å¢é€’å‡è¿ç®—ç¬¦çš„åç½®ç‰ˆæœ¬</p></blockquote><p><strong>è¿ç®—å¯¹è±¡å¯æŒ‰ä»»æ„é¡ºåºæ±‚å€¼</strong></p><p>å¤§å¤šæ•°è¿ç®—ç¬¦éƒ½æ²¡æœ‰è§„å®šè¿ç®—å¯¹è±¡çš„æ±‚å€¼é¡ºåºï¼ˆå‚è§4.1.3èŠ‚ï¼Œç¬¬123é¡µï¼‰ï¼Œè¿™åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€æ¡å­è¡¨è¾¾å¼æ”¹å˜äº†æŸä¸ªè¿ç®—å¯¹è±¡çš„å€¼ï¼Œå¦ä¸€æ¡å­è¡¨è¾¾å¼åˆè¦ä½¿ç”¨è¯¥å€¼çš„è¯ï¼Œè¿ç®—å¯¹è±¡çš„æ±‚å€¼é¡ºåºå°±å¾ˆå…³é”®äº†ã€‚å› ä¸ºé€’å¢è¿ç®—ç¬¦å’Œé€’å‡è¿ç®—ç¬¦ä¼šæ”¹å˜è¿ç®—å¯¹è±¡çš„å€¼ï¼Œæ‰€ä»¥è¦æé˜²åœ¨å¤åˆè¡¨è¾¾å¼ä¸­é”™ç”¨è¿™ä¸¤ä¸ªè¿ç®—ç¬¦ã€‚</p><h2 id="4-6-æˆå‘˜è®¿é—®è¿ç®—ç¬¦"><a href="#4-6-æˆå‘˜è®¿é—®è¿ç®—ç¬¦" class="headerlink" title="4.6 æˆå‘˜è®¿é—®è¿ç®—ç¬¦"></a>4.6 æˆå‘˜è®¿é—®è¿ç®—ç¬¦</h2><h2 id="4-7-æ¡ä»¶è¿ç®—ç¬¦"><a href="#4-7-æ¡ä»¶è¿ç®—ç¬¦" class="headerlink" title="4.7 æ¡ä»¶è¿ç®—ç¬¦"></a>4.7 æ¡ä»¶è¿ç®—ç¬¦</h2><p><img src="/../images/C-C-Primer-Chapter-4/1725504101689.png"></p><p>å…¶ä¸­condæ˜¯åˆ¤æ–­æ¡ä»¶çš„è¡¨è¾¾å¼ï¼Œè€Œexpr1å’Œexpr2æ˜¯ä¸¤ä¸ªç±»å‹ç›¸åŒæˆ–å¯èƒ½è½¬æ¢ä¸ºæŸä¸ªå…¬å…±ç±»å‹çš„è¡¨è¾¾å¼ã€‚æ¡ä»¶è¿ç®—ç¬¦çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼šé¦–å…ˆæ±‚condçš„å€¼ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸå¯¹expr1æ±‚å€¼å¹¶è¿”å›è¯¥å€¼ï¼Œå¦åˆ™å¯¹expr2æ±‚å€¼å¹¶è¿”å›è¯¥å€¼ã€‚</p><p>å½“æ¡ä»¶è¿ç®—ç¬¦çš„ä¸¤ä¸ªè¡¨è¾¾å¼éƒ½æ˜¯å·¦å€¼æˆ–è€…èƒ½è½¬æ¢æˆåŒä¸€ç§å·¦å€¼ç±»å‹æ—¶ï¼Œè¿ç®—çš„ç»“æœæ˜¯å·¦å€¼ï¼›å¦åˆ™è¿ç®—çš„ç»“æœæ˜¯å³å€¼ã€‚</p><h2 id="4-8-ä½è¿ç®—ç¬¦ã€"><a href="#4-8-ä½è¿ç®—ç¬¦ã€" class="headerlink" title="4.8 ä½è¿ç®—ç¬¦ã€"></a>4.8 ä½è¿ç®—ç¬¦ã€</h2><p>ä½è¿ç®—ç¬¦ä½œç”¨äºæ•´æ•°ç±»å‹çš„è¿ç®—å¯¹è±¡æˆ–è€…bitsetç±»å‹</p><p><img src="/../images/C-C-Primer-Chapter-4/1725504481938.png"></p><p>å…³äºç¬¦å·ä½å¦‚ä½•å¤„ç†æ²¡æœ‰æ˜ç¡®çš„è§„å®šï¼Œæ‰€ä»¥å¼ºçƒˆå»ºè®®ä»…å°†ä½è¿ç®—ç¬¦ç”¨äºå¤„ç†æ— ç¬¦å·ç±»å‹ã€‚</p><p>å¦‚æœè¿ç®—å¯¹è±¡æ˜¯â€œå°æ•´å‹â€ï¼Œåˆ™å®ƒçš„å€¼ä¼šè¢«è‡ªåŠ¨æå‡ï¼ˆå‚è§4.11.1èŠ‚ï¼Œç¬¬142é¡µï¼‰æˆè¾ƒå¤§çš„æ•´æ•°ç±»å‹ã€‚</p><p><strong>ç§»ä½è¿ç®—ç¬¦</strong></p><p>å·¦ç§»è¿ç®—ç¬¦ï¼ˆ&lt;&lt;ï¼‰åœ¨å³ä¾§æ’å…¥å€¼ä¸º0çš„äºŒè¿›åˆ¶ä½ã€‚å³ç§»è¿ç®—ç¬¦ï¼ˆ&gt;&gt;ï¼‰çš„è¡Œä¸ºåˆ™ä¾èµ–äºå…¶å·¦ä¾§è¿ç®—å¯¹è±¡çš„ç±»å‹ï¼šå¦‚æœè¯¥è¿ç®—å¯¹è±¡æ˜¯æ— ç¬¦å·ç±»å‹ï¼Œåœ¨å·¦ä¾§æ’å…¥å€¼ä¸º0çš„äºŒè¿›åˆ¶ä½ï¼›å¦‚æœè¯¥è¿ç®—å¯¹è±¡æ˜¯å¸¦ç¬¦å·ç±»å‹ï¼Œåœ¨å·¦ä¾§æ’å…¥ç¬¦å·ä½çš„å‰¯æœ¬æˆ–å€¼ä¸º0çš„äºŒè¿›åˆ¶ä½ï¼Œå¦‚ä½•é€‰æ‹©è¦è§†å…·ä½“ç¯å¢ƒè€Œå®šã€‚</p><h2 id="4-9-sizeofè¿ç®—ç¬¦"><a href="#4-9-sizeofè¿ç®—ç¬¦" class="headerlink" title="4.9 sizeofè¿ç®—ç¬¦"></a>4.9 sizeofè¿ç®—ç¬¦</h2><p>sizeofè¿ç®—ç¬¦è¿”å›ä¸€æ¡è¡¨è¾¾å¼æˆ–ä¸€ä¸ªç±»å‹åå­—æ‰€å çš„å­—èŠ‚æ•°ã€‚sizeofè¿ç®—ç¬¦æ»¡è¶³å³ç»“åˆå¾‹ï¼Œå…¶æ‰€å¾—çš„å€¼æ˜¯ä¸€ä¸ªsize_tç±»å‹ï¼ˆå‚è§3.5.2èŠ‚ï¼Œç¬¬103é¡µï¼‰çš„<strong>å¸¸é‡è¡¨è¾¾å¼</strong>ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬58é¡µï¼‰ã€‚</p><p>sizeofå¹¶ä¸å®é™…è®¡ç®—å…¶è¿ç®—å¯¹è±¡çš„å€¼ã€‚å› ä¸ºsizeofä¸ä¼šå®é™…æ±‚è¿ç®—å¯¹è±¡çš„å€¼ï¼Œæ‰€ä»¥å³ä½¿pæ˜¯ä¸€ä¸ªæ— æ•ˆï¼ˆå³æœªåˆå§‹åŒ–ï¼‰çš„æŒ‡é’ˆï¼ˆå‚è§2.3.2èŠ‚ï¼Œç¬¬47é¡µï¼‰ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚åœ¨sizeofçš„è¿ç®—å¯¹è±¡ä¸­è§£å¼•ç”¨ä¸€ä¸ªæ— æ•ˆæŒ‡é’ˆä»ç„¶æ˜¯ä¸€ç§å®‰å…¨çš„è¡Œä¸ºï¼Œå› ä¸ºæŒ‡é’ˆå®é™…ä¸Šå¹¶æ²¡æœ‰è¢«çœŸæ­£ä½¿ç”¨ã€‚sizeofä¸éœ€è¦çœŸçš„è§£å¼•ç”¨æŒ‡é’ˆä¹Ÿèƒ½çŸ¥é“å®ƒæ‰€æŒ‡å¯¹è±¡çš„ç±»å‹ã€‚</p><p>sizeofè¿ç®—ç¬¦çš„ç»“æœéƒ¨åˆ†åœ°ä¾èµ–äºå…¶ä½œç”¨çš„ç±»å‹ï¼š</p><p>Â· å¯¹charæˆ–è€…ç±»å‹ä¸ºcharçš„è¡¨è¾¾å¼æ‰§è¡Œsizeofè¿ç®—ï¼Œç»“æœå¾—1ã€‚</p><p>Â· å¯¹å¼•ç”¨ç±»å‹æ‰§è¡Œsizeofè¿ç®—å¾—åˆ°è¢«å¼•ç”¨å¯¹è±¡æ‰€å ç©ºé—´çš„å¤§å°ã€‚</p><p>Â· å¯¹æŒ‡é’ˆæ‰§è¡Œsizeofè¿ç®—å¾—åˆ°æŒ‡é’ˆæœ¬èº«æ‰€å ç©ºé—´çš„å¤§å°ã€‚</p><p>Â· å¯¹è§£å¼•ç”¨æŒ‡é’ˆæ‰§è¡Œsizeofè¿ç®—å¾—åˆ°æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡æ‰€å ç©ºé—´çš„å¤§å°ï¼ŒæŒ‡é’ˆä¸éœ€æœ‰æ•ˆã€‚</p><p>Â· å¯¹æ•°ç»„æ‰§è¡Œsizeofè¿ç®—å¾—åˆ°æ•´ä¸ªæ•°ç»„æ‰€å ç©ºé—´çš„å¤§å°ï¼Œç­‰ä»·äºå¯¹æ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ å„æ‰§è¡Œä¸€æ¬¡sizeofè¿ç®—å¹¶å°†æ‰€å¾—ç»“æœæ±‚å’Œã€‚æ³¨æ„ï¼Œsizeofè¿ç®—ä¸ä¼šæŠŠæ•°ç»„è½¬æ¢æˆæŒ‡é’ˆæ¥å¤„ç†ã€‚</p><p>Â· å¯¹stringå¯¹è±¡æˆ–vectorå¯¹è±¡æ‰§è¡Œsizeofè¿ç®—åªè¿”å›è¯¥ç±»å‹å›ºå®šéƒ¨åˆ†çš„å¤§å°ï¼Œä¸ä¼šè®¡ç®—å¯¹è±¡ä¸­çš„å…ƒç´ å ç”¨äº†å¤šå°‘ç©ºé—´ã€‚</p><h2 id="4-10-é€—å·è¿ç®—ç¬¦"><a href="#4-10-é€—å·è¿ç®—ç¬¦" class="headerlink" title="4.10 é€—å·è¿ç®—ç¬¦"></a>4.10 é€—å·è¿ç®—ç¬¦</h2><p>é€—å·è¿ç®—ç¬¦ï¼ˆcomma operatorï¼‰å«æœ‰ä¸¤ä¸ªè¿ç®—å¯¹è±¡ï¼ŒæŒ‰ç…§ä»å·¦å‘å³çš„é¡ºåºä¾æ¬¡æ±‚å€¼ã€‚å’Œé€»è¾‘ä¸ã€é€»è¾‘æˆ–ä»¥åŠæ¡ä»¶è¿ç®—ç¬¦ä¸€æ ·ï¼Œé€—å·è¿ç®—ç¬¦ä¹Ÿè§„å®šäº†è¿ç®—å¯¹è±¡æ±‚å€¼çš„é¡ºåºã€‚</p><p>å¯¹äºé€—å·è¿ç®—ç¬¦æ¥è¯´ï¼Œé¦–å…ˆå¯¹å·¦ä¾§çš„è¡¨è¾¾å¼æ±‚å€¼ï¼Œç„¶åå°†æ±‚å€¼ç»“æœä¸¢å¼ƒæ‰ã€‚é€—å·è¿ç®—ç¬¦çœŸæ­£çš„ç»“æœæ˜¯å³ä¾§è¡¨è¾¾å¼çš„å€¼ã€‚å¦‚æœå³ä¾§è¿ç®—å¯¹è±¡æ˜¯å·¦å€¼ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„æ±‚å€¼ç»“æœä¹Ÿæ˜¯å·¦å€¼ã€‚</p><h2 id="4-11-ç±»å‹è½¬æ¢"><a href="#4-11-ç±»å‹è½¬æ¢" class="headerlink" title="4.11 ç±»å‹è½¬æ¢"></a>4.11 ç±»å‹è½¬æ¢</h2><p>ç®—æœ¯ç±»å‹ä¹‹é—´çš„éšå¼è½¬æ¢è¢«è®¾è®¡å¾—å°½å¯èƒ½é¿å…æŸå¤±ç²¾åº¦ã€‚</p><p><strong>ä½•æ—¶å‘ç”Ÿéšå¼ç±»å‹è½¬æ¢</strong></p><p>åœ¨å¤§å¤šæ•°è¡¨è¾¾å¼ä¸­ï¼Œæ¯”intç±»å‹å°çš„æ•´å‹å€¼é¦–å…ˆæå‡ä¸ºè¾ƒå¤§çš„æ•´æ•°ç±»å‹ã€‚</p><p>åœ¨æ¡ä»¶ä¸­ï¼Œéå¸ƒå°”å€¼è½¬æ¢æˆå¸ƒå°”ç±»å‹</p><p>åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œåˆå§‹å€¼è½¬æ¢æˆå˜é‡çš„ç±»å‹ï¼›åœ¨èµ‹å€¼è¯­å¥ä¸­ï¼Œå³ä¾§è¿ç®—å¯¹è±¡è½¬æ¢æˆå·¦ä¾§è¿ç®—å¯¹è±¡çš„ç±»å‹ã€‚</p><p>å¦‚æœç®—æœ¯è¿ç®—æˆ–å…³ç³»è¿ç®—çš„è¿ç®—å¯¹è±¡æœ‰å¤šç§ç±»å‹ï¼Œéœ€è¦è½¬æ¢æˆåŒä¸€ç§ç±»å‹ã€‚</p><h3 id="4-11-1-ç®—æœ¯è½¬æ¢"><a href="#4-11-1-ç®—æœ¯è½¬æ¢" class="headerlink" title="4.11.1 ç®—æœ¯è½¬æ¢"></a>4.11.1 ç®—æœ¯è½¬æ¢</h3><p><strong>æ•´å‹æå‡</strong></p><p>æ•´å‹æå‡ï¼ˆintegral promotionï¼‰è´Ÿè´£æŠŠå°æ•´æ•°ç±»å‹è½¬æ¢æˆè¾ƒå¤§çš„æ•´æ•°ç±»å‹ã€‚å¯¹äºboolã€charã€signed charã€unsigned charã€shortå’Œunsigned shortç­‰ç±»å‹æ¥è¯´ï¼Œåªè¦å®ƒä»¬æ‰€æœ‰å¯èƒ½çš„å€¼éƒ½èƒ½å­˜åœ¨inté‡Œï¼Œå®ƒä»¬å°±ä¼šæå‡æˆintç±»å‹ï¼›å¦åˆ™ï¼Œæå‡æˆunsigned intç±»å‹ã€‚å°±å¦‚æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ï¼Œå¸ƒå°”å€¼falseæå‡æˆ0ã€trueæå‡æˆ1ã€‚</p><p>è¾ƒå¤§çš„charç±»å‹ï¼ˆwchar_tã€char16_tã€char32_tï¼‰æå‡æˆintã€unsigned intã€longã€unsigned longã€long longå’Œunsigned long longä¸­æœ€å°çš„ä¸€ç§ç±»å‹ï¼Œå‰ææ˜¯è½¬æ¢åçš„ç±»å‹è¦èƒ½å®¹çº³åŸç±»å‹æ‰€æœ‰å¯èƒ½çš„å€¼ã€‚</p><p><strong>æ— ç¬¦å·ç±»å‹çš„è¿ç®—å¯¹è±¡</strong></p><p>å¦‚æœæŸä¸ªè¿ç®—ç¬¦çš„è¿ç®—å¯¹è±¡ç±»å‹ä¸ä¸€è‡´ï¼Œè¿™äº›è¿ç®—å¯¹è±¡å°†è½¬æ¢æˆåŒä¸€ç§ç±»å‹ã€‚ä½†æ˜¯å¦‚æœæŸä¸ªè¿ç®—å¯¹è±¡çš„ç±»å‹æ˜¯æ— ç¬¦å·ç±»å‹ï¼Œé‚£ä¹ˆè½¬æ¢çš„ç»“æœå°±è¦ä¾èµ–äºæœºå™¨ä¸­å„ä¸ªæ•´æ•°ç±»å‹çš„ç›¸å¯¹å¤§å°äº†ã€‚</p><p>åƒå¾€å¸¸ä¸€æ ·ï¼Œé¦–å…ˆæ‰§è¡Œæ•´å‹æå‡ã€‚å¦‚æœç»“æœçš„ç±»å‹åŒ¹é…ï¼Œæ— é¡»è¿›è¡Œè¿›ä¸€æ­¥çš„è½¬æ¢ã€‚</p><p>å¦‚æœä¸¤ä¸ªï¼ˆæå‡åçš„ï¼‰è¿ç®—å¯¹è±¡çš„ç±»å‹è¦ä¹ˆéƒ½æ˜¯å¸¦ç¬¦å·çš„ã€è¦ä¹ˆéƒ½æ˜¯æ— ç¬¦å·çš„ï¼Œåˆ™å°ç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆè¾ƒå¤§çš„ç±»å‹ã€‚</p><p>å¦‚æœä¸€ä¸ªè¿ç®—å¯¹è±¡æ˜¯æ— ç¬¦å·ç±»å‹ã€å¦å¤–ä¸€ä¸ªè¿ç®—å¯¹è±¡æ˜¯å¸¦ç¬¦å·ç±»å‹ï¼Œè€Œä¸”å…¶ä¸­çš„æ— ç¬¦å·ç±»å‹ä¸å°äºå¸¦ç¬¦å·ç±»å‹ï¼Œé‚£ä¹ˆå¸¦ç¬¦å·çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆæ— ç¬¦å·çš„ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸¤ä¸ªç±»å‹åˆ†åˆ«æ˜¯unsigned intå’Œintï¼Œåˆ™intç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆunsigned intç±»å‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœintå‹çš„å€¼æ°å¥½ä¸ºè´Ÿå€¼ï¼Œå…¶ç»“æœå°†ä»¥2.1.2èŠ‚ï¼ˆç¬¬32é¡µï¼‰ä»‹ç»çš„æ–¹æ³•è½¬æ¢ï¼Œå¹¶å¸¦æ¥è¯¥èŠ‚æè¿°çš„æ‰€æœ‰å‰¯ä½œç”¨ã€‚</p><p>å‰©ä¸‹çš„ä¸€ç§æƒ…å†µæ˜¯å¸¦ç¬¦å·ç±»å‹å¤§äºæ— ç¬¦å·ç±»å‹ï¼Œæ­¤æ—¶è½¬æ¢çš„ç»“æœä¾èµ–äºæœºå™¨ã€‚</p><p>å¦‚æœæ— ç¬¦å·ç±»å‹çš„æ‰€æœ‰å€¼éƒ½èƒ½å­˜åœ¨è¯¥å¸¦ç¬¦å·ç±»å‹ä¸­ï¼Œåˆ™æ— ç¬¦å·ç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆå¸¦ç¬¦å·ç±»å‹ã€‚</p><p>å¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆå¸¦ç¬¦å·ç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆæ— ç¬¦å·ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªè¿ç®—å¯¹è±¡çš„ç±»å‹åˆ†åˆ«æ˜¯longå’Œunsigned intï¼Œå¹¶ä¸”intå’Œlongçš„å¤§å°ç›¸åŒï¼Œåˆ™longç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆunsigned intç±»å‹ï¼›å¦‚æœlongç±»å‹å ç”¨çš„ç©ºé—´æ¯”intæ›´å¤šï¼Œåˆ™unsigned intç±»å‹çš„è¿ç®—å¯¹è±¡è½¬æ¢æˆlongç±»å‹ã€‚</p><h3 id="4-11-2-å…¶ä»–éšå¼ç±»å‹è½¬æ¢"><a href="#4-11-2-å…¶ä»–éšå¼ç±»å‹è½¬æ¢" class="headerlink" title="4.11.2ã€€å…¶ä»–éšå¼ç±»å‹è½¬æ¢"></a>4.11.2ã€€å…¶ä»–éšå¼ç±»å‹è½¬æ¢</h3><p><strong>æ•°ç»„è½¬æ¢æˆæŒ‡é’ˆ</strong></p><p>åœ¨å¤§å¤šæ•°ç”¨åˆ°æ•°ç»„çš„è¡¨è¾¾å¼ä¸­ï¼Œæ•°ç»„è‡ªåŠ¨è½¬æ¢æˆæŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆ</p><p>å½“æ•°ç»„è¢«ç”¨ä½œdecltypeå…³é”®å­—çš„å‚æ•°ï¼Œæˆ–è€…ä½œä¸ºå–åœ°å€ç¬¦ï¼ˆ&amp;ï¼‰ã€sizeofåŠtypeidï¼ˆç¬¬19.2.2èŠ‚ï¼Œ732é¡µå°†ä»‹ç»ï¼‰ç­‰è¿ç®—ç¬¦çš„è¿ç®—å¯¹è±¡æ—¶ï¼Œä¸Šè¿°è½¬æ¢ä¸ä¼šå‘ç”Ÿã€‚</p><h3 id="4-11-3-æ˜¾å¼è½¬æ¢"><a href="#4-11-3-æ˜¾å¼è½¬æ¢" class="headerlink" title="4.11.3 æ˜¾å¼è½¬æ¢"></a>4.11.3 æ˜¾å¼è½¬æ¢</h3><p><strong>å‘½åçš„å¼ºåˆ¶ç±»å‹è½¬æ¢</strong></p><p><img src="/../images/C-C-Primer-Chapter-4/1725505896584.png"></p><p>ypeæ˜¯è½¬æ¢çš„ç›®æ ‡ç±»å‹è€Œexpressionæ˜¯è¦è½¬æ¢çš„å€¼ã€‚å¦‚æœtypeæ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™ç»“æœæ˜¯å·¦å€¼ã€‚cast-nameæ˜¯static_castã€dynamic_castã€const_castå’Œreinterpret_castä¸­çš„ä¸€ç§ã€‚</p><p><strong>static_cast</strong></p><p>ä»»ä½•å…·æœ‰æ˜ç¡®å®šä¹‰çš„ç±»å‹è½¬æ¢ï¼Œåªè¦ä¸åŒ…å«åº•å±‚constï¼Œéƒ½å¯ä»¥ä½¿ç”¨static_castã€‚</p><p>ç”¨å¤„ï¼š</p><p>1.å½“éœ€è¦æŠŠä¸€ä¸ªè¾ƒå¤§çš„ç®—æœ¯ç±»å‹èµ‹å€¼ç»™è¾ƒå°çš„ç±»å‹æ—¶ï¼Œstatic_castéå¸¸æœ‰ç”¨ã€‚æ­¤æ—¶ï¼Œå¼ºåˆ¶ç±»å‹è½¬æ¢å‘Šè¯‰ç¨‹åºçš„è¯»è€…å’Œç¼–è¯‘å™¨ï¼šæˆ‘ä»¬çŸ¥é“å¹¶ä¸”ä¸åœ¨ä¹æ½œåœ¨çš„ç²¾åº¦æŸå¤±ã€‚</p><p>2.static_castå¯¹äºç¼–è¯‘å™¨æ— æ³•è‡ªåŠ¨æ‰§è¡Œçš„ç±»å‹è½¬æ¢ä¹Ÿéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨static_castæ‰¾å›å­˜åœ¨äºvoidï¼ŠæŒ‡é’ˆï¼ˆå‚è§2.3.2èŠ‚ï¼Œç¬¬50é¡µï¼‰ä¸­çš„å€¼</p><p><strong>const_cast</strong></p><p><img src="/../images/C-C-Primer-Chapter-4/1725506017345.png"></p><p>ç”¨å¤„ï¼š</p><p>const_castå¸¸å¸¸ç”¨äºæœ‰å‡½æ•°é‡è½½çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå…³äºå‡½æ•°é‡è½½å°†åœ¨6.4èŠ‚ï¼ˆç¬¬208é¡µï¼‰è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><p><strong>reinterpret_cast</strong></p><p>reinterpret_casté€šå¸¸ä¸ºè¿ç®—å¯¹è±¡çš„ä½æ¨¡å¼æä¾›è¾ƒä½å±‚æ¬¡ä¸Šçš„é‡æ–°è§£é‡Šã€‚</p><p><img src="/../images/C-C-Primer-Chapter-4/1725506142397.png"></p><h2 id="4-12-è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨"><a href="#4-12-è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨" class="headerlink" title="4.12 è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨"></a>4.12 è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨</h2><p><img src="/../images/C-C-Primer-Chapter-4/1725506197060.png"></p><p><img src="/../images/C-C-Primer-Chapter-4/1725506211875.png"></p><p><img src="/../images/C-C-Primer-Chapter-4/image-20240922122249300.png"></p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 3</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-3/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-3/</url>
    
    <content type="html"><![CDATA[<h1 id="å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„"><a href="#å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„" class="headerlink" title="å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„"></a>å­—ç¬¦ä¸²ã€å‘é‡å’Œæ•°ç»„</h1><span id="more"></span><h2 id="3-1-å‘½åç©ºé—´çš„usingå£°æ˜"><a href="#3-1-å‘½åç©ºé—´çš„usingå£°æ˜" class="headerlink" title="3.1 å‘½åç©ºé—´çš„usingå£°æ˜"></a>3.1 å‘½åç©ºé—´çš„usingå£°æ˜</h2><h2 id="3-2-æ ‡å‡†åº“ç±»å‹string"><a href="#3-2-æ ‡å‡†åº“ç±»å‹string" class="headerlink" title="3.2 æ ‡å‡†åº“ç±»å‹string"></a>3.2 æ ‡å‡†åº“ç±»å‹string</h2><h3 id="3-2-1-å®šä¹‰å’Œåˆå§‹åŒ–stringå¯¹è±¡"><a href="#3-2-1-å®šä¹‰å’Œåˆå§‹åŒ–stringå¯¹è±¡" class="headerlink" title="3.2.1 å®šä¹‰å’Œåˆå§‹åŒ–stringå¯¹è±¡"></a>3.2.1 å®šä¹‰å’Œåˆå§‹åŒ–stringå¯¹è±¡</h3><p><img src="/../images/C-C-Primer-Chapter-3/1720604744927.png"></p><p><strong>ç›´æ¥åˆå§‹åŒ–å’Œæ‹·è´åˆå§‹åŒ–</strong></p><h3 id="3-2-2-stringå¯¹è±¡ä¸Šçš„æ“ä½œ"><a href="#3-2-2-stringå¯¹è±¡ä¸Šçš„æ“ä½œ" class="headerlink" title="3.2.2 stringå¯¹è±¡ä¸Šçš„æ“ä½œ"></a>3.2.2 stringå¯¹è±¡ä¸Šçš„æ“ä½œ</h3><p><img src="/../images/C-C-Primer-Chapter-3/1720604877481.png"></p><p><strong>è¯»å†™stringå¯¹è±¡</strong></p><p>ä»æµè¯»ï¼šåœ¨æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œstringå¯¹è±¡ä¼šè‡ªåŠ¨å¿½ç•¥å¼€å¤´çš„ç©ºç™½ï¼ˆå³ç©ºæ ¼ç¬¦ã€æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰å¹¶ä»ç¬¬ä¸€ä¸ªçœŸæ­£çš„å­—ç¬¦å¼€å§‹è¯»èµ·ï¼Œç›´åˆ°é‡è§ä¸‹ä¸€å¤„ç©ºç™½ä¸ºæ­¢ã€‚</p><p>getlineå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè¾“å…¥æµå’Œä¸€ä¸ªstringå¯¹è±¡ï¼Œå‡½æ•°ä»ç»™å®šçš„è¾“å…¥æµä¸­è¯»å…¥å†…å®¹ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦ä¸ºæ­¢ï¼ˆæ³¨æ„æ¢è¡Œç¬¦ä¹Ÿè¢«è¯»è¿›æ¥äº†ï¼‰ï¼Œç„¶åæŠŠæ‰€è¯»çš„å†…å®¹å­˜å…¥åˆ°é‚£ä¸ªstringå¯¹è±¡ä¸­å»ï¼ˆæ³¨æ„ä¸å­˜æ¢è¡Œç¬¦ï¼‰ã€‚</p><p>getlineä¹Ÿä¼šè¿”å›å®ƒçš„æµå‚æ•°ã€‚å› æ­¤æ—¢ç„¶è¾“å…¥è¿ç®—ç¬¦èƒ½ä½œä¸ºåˆ¤æ–­çš„æ¡ä»¶ï¼ˆå‚è§1.4.3èŠ‚ï¼Œç¬¬13é¡µï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç”¨getlineçš„ç»“æœä½œä¸ºæ¡ä»¶ã€‚</p><p><strong>stringï¼šï¼šsize_typeç±»å‹</strong></p><p>å®ƒæ˜¯ä¸€ä¸ªæ— ç¬¦å·ç±»å‹çš„å€¼ï¼ˆå‚è§2.1.1èŠ‚ï¼Œç¬¬30é¡µï¼‰è€Œä¸”èƒ½è¶³å¤Ÿå­˜æ”¾ä¸‹ä»»ä½•stringå¯¹è±¡çš„å¤§å°ã€‚æ‰€æœ‰ç”¨äºå­˜æ”¾stringç±»çš„sizeå‡½æ•°è¿”å›å€¼çš„å˜é‡ï¼Œéƒ½åº”è¯¥æ˜¯stringï¼šï¼šsize_typeç±»å‹çš„ã€‚</p><p><strong>æ¯”è¾ƒstringå¯¹è±¡</strong></p><p>1.å¦‚æœä¸¤ä¸ªstringå¯¹è±¡çš„é•¿åº¦ä¸åŒï¼Œè€Œä¸”è¾ƒçŸ­stringå¯¹è±¡çš„æ¯ä¸ªå­—ç¬¦éƒ½ä¸è¾ƒé•¿stringå¯¹è±¡å¯¹åº”ä½ç½®ä¸Šçš„å­—ç¬¦ç›¸åŒï¼Œå°±è¯´è¾ƒçŸ­stringå¯¹è±¡å°äºè¾ƒé•¿stringå¯¹è±¡ã€‚</p><p>2.å¦‚æœä¸¤ä¸ªstringå¯¹è±¡åœ¨æŸäº›å¯¹åº”çš„ä½ç½®ä¸Šä¸ä¸€è‡´ï¼Œåˆ™stringå¯¹è±¡æ¯”è¾ƒçš„ç»“æœå…¶å®æ˜¯stringå¯¹è±¡ä¸­ç¬¬ä¸€å¯¹ç›¸å¼‚å­—ç¬¦æ¯”è¾ƒçš„ç»“æœã€‚</p><h3 id="3-2-3-å¤„ç†stringå¯¹è±¡ä¸­çš„å­—ç¬¦"><a href="#3-2-3-å¤„ç†stringå¯¹è±¡ä¸­çš„å­—ç¬¦" class="headerlink" title="3.2.3ã€€å¤„ç†stringå¯¹è±¡ä¸­çš„å­—ç¬¦"></a>3.2.3ã€€å¤„ç†stringå¯¹è±¡ä¸­çš„å­—ç¬¦</h3><p><img src="/../images/C-C-Primer-Chapter-3/1725353182437.png"></p><h2 id="3-3-æ ‡å‡†åº“ç±»å‹vector"><a href="#3-3-æ ‡å‡†åº“ç±»å‹vector" class="headerlink" title="3.3 æ ‡å‡†åº“ç±»å‹vector"></a>3.3 æ ‡å‡†åº“ç±»å‹vector</h2><h3 id="3-3-1-å®šä¹‰å’Œåˆå§‹åŒ–vectorå¯¹è±¡"><a href="#3-3-1-å®šä¹‰å’Œåˆå§‹åŒ–vectorå¯¹è±¡" class="headerlink" title="3.3.1ã€€å®šä¹‰å’Œåˆå§‹åŒ–vectorå¯¹è±¡"></a>3.3.1ã€€å®šä¹‰å’Œåˆå§‹åŒ–vectorå¯¹è±¡</h3><p><img src="/../images/C-C-Primer-Chapter-3/1725416150548.png"></p><h3 id="3-3-2-å‘vectorå¯¹è±¡ä¸­æ·»åŠ å…ƒç´ "><a href="#3-3-2-å‘vectorå¯¹è±¡ä¸­æ·»åŠ å…ƒç´ " class="headerlink" title="3.3.2ã€€å‘vectorå¯¹è±¡ä¸­æ·»åŠ å…ƒç´ "></a>3.3.2ã€€å‘vectorå¯¹è±¡ä¸­æ·»åŠ å…ƒç´ </h3><blockquote><p>èŒƒå›´forè¯­å¥ä½“å†…ä¸åº”æ”¹å˜å…¶æ‰€éå†åºåˆ—çš„å¤§å°ã€‚</p></blockquote><h3 id="3-3-3-å…¶ä»–vectoræ“ä½œ"><a href="#3-3-3-å…¶ä»–vectoræ“ä½œ" class="headerlink" title="3.3.3ã€€å…¶ä»–vectoræ“ä½œ"></a>3.3.3ã€€å…¶ä»–vectoræ“ä½œ</h3><p><img src="/../images/C-C-Primer-Chapter-3/1725416497671.png"></p><h2 id="3-4-è¿­ä»£å™¨ä»‹ç»"><a href="#3-4-è¿­ä»£å™¨ä»‹ç»" class="headerlink" title="3.4 è¿­ä»£å™¨ä»‹ç»"></a>3.4 è¿­ä»£å™¨ä»‹ç»</h2><h3 id="3-4-1-ä½¿ç”¨è¿­ä»£å™¨"><a href="#3-4-1-ä½¿ç”¨è¿­ä»£å™¨" class="headerlink" title="3.4.1 ä½¿ç”¨è¿­ä»£å™¨"></a>3.4.1 ä½¿ç”¨è¿­ä»£å™¨</h3><p><strong>beginå’Œendè¿ç®—ç¬¦</strong></p><p>beginå’Œendè¿”å›çš„å…·ä½“ç±»å‹ç”±å¯¹è±¡æ˜¯å¦æ˜¯å¸¸é‡å†³å®šï¼Œå¦‚æœå¯¹è±¡æ˜¯å¸¸é‡ï¼Œbeginå’Œendè¿”å›const_iteratorï¼›å¦‚æœå¯¹è±¡ä¸æ˜¯å¸¸é‡ï¼Œè¿”å›iterator</p><p>ä¸ºäº†ä¾¿äºä¸“é—¨å¾—åˆ°const_iteratorç±»å‹çš„è¿”å›å€¼ï¼ŒC++11æ–°æ ‡å‡†å¼•å…¥äº†ä¸¤ä¸ªæ–°å‡½æ•°ï¼Œåˆ†åˆ«æ˜¯cbeginå’Œcend</p><p>å·²çŸ¥çš„ä¸€ä¸ªé™åˆ¶æ˜¯ä¸èƒ½åœ¨èŒƒå›´forå¾ªç¯ä¸­å‘vectorå¯¹è±¡æ·»åŠ å…ƒç´ ã€‚å¦å¤–ä¸€ä¸ªé™åˆ¶æ˜¯ä»»ä½•ä¸€ç§å¯èƒ½æ”¹å˜vectorå¯¹è±¡å®¹é‡çš„æ“ä½œï¼Œæ¯”å¦‚push_backï¼Œéƒ½ä¼šä½¿è¯¥vectorå¯¹è±¡çš„è¿­ä»£å™¨å¤±æ•ˆ</p><p><img src="/../images/C-C-Primer-Chapter-3/1726125798970.png"></p><h3 id="3-4-2-è¿­ä»£å™¨è¿ç®—"><a href="#3-4-2-è¿­ä»£å™¨è¿ç®—" class="headerlink" title="3.4.2 è¿­ä»£å™¨è¿ç®—"></a>3.4.2 è¿­ä»£å™¨è¿ç®—</h3><p><img src="/../images/C-C-Primer-Chapter-3/1725417124401.png"></p><p>åªè¦ä¸¤ä¸ªè¿­ä»£å™¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå®¹å™¨ä¸­çš„å…ƒç´ æˆ–è€…å°¾å…ƒç´ çš„ä¸‹ä¸€ä½ç½®ï¼Œå°±èƒ½å°†å…¶ç›¸å‡ï¼Œæ‰€å¾—ç»“æœæ˜¯ä¸¤ä¸ªè¿­ä»£å™¨çš„è·ç¦»ã€‚æ‰€è°“è·ç¦»æŒ‡çš„æ˜¯å³ä¾§çš„è¿­ä»£å™¨å‘å‰ç§»åŠ¨å¤šå°‘ä½ç½®å°±èƒ½è¿½ä¸Šå·¦ä¾§çš„è¿­ä»£å™¨ï¼Œå…¶ç±»å‹æ˜¯åä¸ºdifference_typeçš„å¸¦ç¬¦å·æ•´å‹æ•°ã€‚stringå’Œvectoréƒ½å®šä¹‰äº†difference_typeï¼Œå› ä¸ºè¿™ä¸ªè·ç¦»å¯æ­£å¯è´Ÿï¼Œæ‰€ä»¥difference_typeæ˜¯å¸¦ç¬¦å·ç±»å‹çš„ã€‚</p><h2 id="3-5-æ•°ç»„"><a href="#3-5-æ•°ç»„" class="headerlink" title="3.5 æ•°ç»„"></a>3.5 æ•°ç»„</h2><p>æ•°ç»„çš„å¤§å°ç¡®å®šä¸å˜ï¼Œä¸èƒ½éšæ„å‘æ•°ç»„ä¸­å¢åŠ å…ƒç´ ã€‚å› ä¸ºæ•°ç»„çš„å¤§å°å›ºå®šï¼Œå› æ­¤å¯¹æŸäº›ç‰¹æ®Šçš„åº”ç”¨æ¥è¯´ç¨‹åºçš„è¿è¡Œæ—¶æ€§èƒ½è¾ƒå¥½ï¼Œä½†æ˜¯ç›¸åº”åœ°ä¹ŸæŸå¤±äº†ä¸€äº›çµæ´»æ€§ã€‚</p><blockquote><p>å¦‚æœä¸æ¸…æ¥šå…ƒç´ çš„ç¡®åˆ‡ä¸ªæ•°ï¼Œä½¿ç”¨vector</p></blockquote><h3 id="3-5-1-å®šä¹‰å’Œåˆå§‹åŒ–å†…ç½®æ•°ç»„"><a href="#3-5-1-å®šä¹‰å’Œåˆå§‹åŒ–å†…ç½®æ•°ç»„" class="headerlink" title="3.5.1ã€€å®šä¹‰å’Œåˆå§‹åŒ–å†…ç½®æ•°ç»„"></a>3.5.1ã€€å®šä¹‰å’Œåˆå§‹åŒ–å†…ç½®æ•°ç»„</h3><p>æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ä¹Ÿå±äºæ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œç¼–è¯‘çš„æ—¶å€™ç»´åº¦åº”è¯¥æ˜¯å·²çŸ¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»´åº¦å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼ˆå‚è§2.4.4èŠ‚ï¼Œç¬¬58é¡µï¼‰</p><p><strong>å­—ç¬¦æ•°ç»„çš„ç‰¹æ®Šæ€§</strong></p><p>æˆ‘ä»¬å¯ä»¥ç”¨å­—ç¬¦ä¸²å­—é¢å€¼ï¼ˆå‚è§2.1.3èŠ‚ï¼Œç¬¬36é¡µï¼‰å¯¹æ­¤ç±»æ•°ç»„åˆå§‹åŒ–ã€‚å½“ä½¿ç”¨è¿™ç§æ–¹å¼æ—¶ï¼Œä¸€å®šè¦æ³¨æ„å­—ç¬¦ä¸²å­—é¢å€¼çš„ç»“å°¾å¤„è¿˜æœ‰ä¸€ä¸ªç©ºå­—ç¬¦ï¼Œè¿™ä¸ªç©ºå­—ç¬¦ä¹Ÿä¼šåƒå­—ç¬¦ä¸²çš„å…¶ä»–å­—ç¬¦ä¸€æ ·è¢«æ‹·è´åˆ°å­—ç¬¦æ•°ç»„ä¸­å»</p><p><strong>ä¸å…è®¸æ‹·è´å’Œèµ‹å€¼</strong></p><p>ä¸èƒ½å°†æ•°ç»„çš„å†…å®¹æ‹·è´ç»™å…¶ä»–æ•°ç»„ä½œä¸ºå…¶åˆå§‹å€¼ï¼Œä¹Ÿä¸èƒ½ç”¨æ•°ç»„ä¸ºå…¶ä»–æ•°ç»„èµ‹å€¼</p><p><strong>ç†è§£å¤æ‚çš„æ•°ç»„å£°æ˜</strong></p><p><img src="/../images/C-C-Primer-Chapter-3/1725418297827.png"></p><p>è¦æƒ³ç†è§£æ•°ç»„å£°æ˜çš„å«ä¹‰ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯ä»æ•°ç»„çš„åå­—å¼€å§‹æŒ‰ç…§ç”±å†…å‘å¤–çš„é¡ºåºé˜…è¯»ã€‚</p><h3 id="3-5-2-è®¿é—®æ•°ç»„å…ƒç´ "><a href="#3-5-2-è®¿é—®æ•°ç»„å…ƒç´ " class="headerlink" title="3.5.2 è®¿é—®æ•°ç»„å…ƒç´ "></a>3.5.2 è®¿é—®æ•°ç»„å…ƒç´ </h3><p>æ•°ç»„çš„å…ƒç´ ä¹Ÿèƒ½ä½¿ç”¨èŒƒå›´forè¯­å¥æˆ–ä¸‹æ ‡è¿ç®—ç¬¦æ¥è®¿é—®ã€‚</p><p>åœ¨ä½¿ç”¨æ•°ç»„ä¸‹æ ‡çš„æ—¶å€™ï¼Œé€šå¸¸å°†å…¶å®šä¹‰ä¸ºsize_tç±»å‹ã€‚size_tæ˜¯ä¸€ç§æœºå™¨ç›¸å…³çš„æ— ç¬¦å·ç±»å‹ï¼Œå®ƒè¢«è®¾è®¡å¾—è¶³å¤Ÿå¤§ä»¥ä¾¿èƒ½è¡¨ç¤ºå†…å­˜ä¸­ä»»æ„å¯¹è±¡çš„å¤§å°ã€‚åœ¨cstddefå¤´æ–‡ä»¶ä¸­å®šä¹‰äº†size_tç±»å‹ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯Cæ ‡å‡†åº“stddef.hå¤´æ–‡ä»¶çš„C++è¯­è¨€ç‰ˆæœ¬ã€‚</p><h3 id="3-5-3-æŒ‡é’ˆå’Œæ•°ç»„"><a href="#3-5-3-æŒ‡é’ˆå’Œæ•°ç»„" class="headerlink" title="3.5.3 æŒ‡é’ˆå’Œæ•°ç»„"></a>3.5.3 æŒ‡é’ˆå’Œæ•°ç»„</h3><p>ä½¿ç”¨æ•°ç»„çš„æ—¶å€™ç¼–è¯‘å™¨ä¸€èˆ¬ä¼šæŠŠå®ƒè½¬æ¢æˆæŒ‡é’ˆã€‚</p><p>åœ¨å¾ˆå¤šç”¨åˆ°æ•°ç»„åå­—çš„åœ°æ–¹ï¼Œç¼–è¯‘å™¨éƒ½ä¼šè‡ªåŠ¨åœ°å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªæŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆ</p><p><img src="/../images/C-C-Primer-Chapter-3/1725418997234.png"></p><p>å½“ä½¿ç”¨æ•°ç»„ä½œä¸ºä¸€ä¸ªautoï¼ˆå‚è§2.5.2èŠ‚ï¼Œç¬¬61é¡µï¼‰å˜é‡çš„åˆå§‹å€¼æ—¶ï¼Œæ¨æ–­å¾—åˆ°çš„ç±»å‹æ˜¯æŒ‡é’ˆè€Œéæ•°ç»„</p><p>å½“ä½¿ç”¨decltypeå…³é”®å­—ï¼ˆå‚è§2.5.3èŠ‚ï¼Œç¬¬62é¡µï¼‰æ—¶ä¸Šè¿°è½¬æ¢ä¸ä¼šå‘ç”Ÿï¼Œdecltypeï¼ˆiaï¼‰è¿”å›çš„ç±»å‹æ˜¯ç”±10ä¸ªæ•´æ•°æ„æˆçš„æ•°ç»„</p><p><strong>æ ‡å‡†åº“å‡½æ•°beginå’Œend</strong></p><p>C++11æ–°æ ‡å‡†å¼•å…¥äº†ä¸¤ä¸ªåä¸ºbeginå’Œendçš„å‡½æ•°ã€‚è¿™ä¸¤ä¸ªå‡½æ•°ä¸å®¹å™¨ä¸­çš„ä¸¤ä¸ªåŒåæˆå‘˜ï¼ˆå‚è§3.4.1èŠ‚ï¼Œç¬¬95é¡µï¼‰åŠŸèƒ½ç±»ä¼¼ï¼Œä¸è¿‡æ•°ç»„æ¯•ç«Ÿä¸æ˜¯ç±»ç±»å‹ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå‡½æ•°ä¸æ˜¯æˆå‘˜å‡½æ•°ã€‚æ­£ç¡®çš„ä½¿ç”¨å½¢å¼æ˜¯å°†æ•°ç»„ä½œä¸ºå®ƒä»¬çš„å‚æ•°</p><p><img src="/../images/C-C-Primer-Chapter-3/1725419199440.png"></p><p>ä¸¤ä¸ªæŒ‡é’ˆç›¸å‡çš„ç»“æœçš„ç±»å‹æ˜¯ä¸€ç§åä¸ºptrdiff_tçš„æ ‡å‡†åº“ç±»å‹ï¼Œå’Œsize_tä¸€æ ·ï¼Œptrdiff_tä¹Ÿæ˜¯ä¸€ç§å®šä¹‰åœ¨cstddefå¤´æ–‡ä»¶ä¸­çš„æœºå™¨ç›¸å…³çš„ç±»å‹ã€‚å› ä¸ºå·®å€¼å¯èƒ½ä¸ºè´Ÿå€¼ï¼Œæ‰€ä»¥ptrdiff_tæ˜¯ä¸€ç§å¸¦ç¬¦å·ç±»å‹</p><p>å†…ç½®çš„ä¸‹æ ‡è¿ç®—ç¬¦æ‰€ç”¨çš„ç´¢å¼•å€¼ä¸æ˜¯æ— ç¬¦å·ç±»å‹ï¼Œè¿™ä¸€ç‚¹ä¸vectorå’Œstringä¸ä¸€æ ·ã€‚</p><h3 id="3-5-4-Cé£æ ¼å­—ç¬¦ä¸²"><a href="#3-5-4-Cé£æ ¼å­—ç¬¦ä¸²" class="headerlink" title="3.5.4 Cé£æ ¼å­—ç¬¦ä¸²"></a>3.5.4 Cé£æ ¼å­—ç¬¦ä¸²</h3><p>Cé£æ ¼å­—ç¬¦ä¸²ä¸æ˜¯ä¸€ç§ç±»å‹ï¼Œè€Œæ˜¯ä¸ºäº†è¡¨è¾¾å’Œä½¿ç”¨å­—ç¬¦ä¸²è€Œå½¢æˆçš„ä¸€ç§çº¦å®šä¿—æˆçš„å†™æ³•ã€‚æŒ‰æ­¤ä¹ æƒ¯ä¹¦å†™çš„å­—ç¬¦ä¸²å­˜æ”¾åœ¨å­—ç¬¦æ•°ç»„ä¸­å¹¶ä»¥ç©ºå­—ç¬¦ç»“æŸï¼ˆnull terminatedï¼‰ã€‚ä»¥ç©ºå­—ç¬¦ç»“æŸçš„æ„æ€æ˜¯åœ¨å­—ç¬¦ä¸²æœ€åä¸€ä¸ªå­—ç¬¦åé¢è·Ÿç€ä¸€ä¸ªç©ºå­—ç¬¦ï¼ˆâ€™\0â€™ï¼‰ã€‚ä¸€èˆ¬åˆ©ç”¨æŒ‡é’ˆæ¥æ“ä½œè¿™äº›å­—ç¬¦ä¸²ã€‚</p><p><img src="/../images/C-C-Primer-Chapter-3/1725419546643.png"></p><h3 id="3-5-5-ä¸æ—§ä»£ç çš„æ¥å£"><a href="#3-5-5-ä¸æ—§ä»£ç çš„æ¥å£" class="headerlink" title="3.5.5 ä¸æ—§ä»£ç çš„æ¥å£"></a>3.5.5 ä¸æ—§ä»£ç çš„æ¥å£</h3><p>å¦‚æœæ‰§è¡Œå®Œc_strï¼ˆï¼‰å‡½æ•°åç¨‹åºæƒ³ä¸€ç›´éƒ½èƒ½ä½¿ç”¨å…¶è¿”å›çš„æ•°ç»„ï¼Œæœ€å¥½å°†è¯¥æ•°ç»„é‡æ–°æ‹·è´ä¸€ä»½ã€‚</p><p><strong>ä½¿ç”¨æ•°ç»„åˆå§‹åŒ–vectorå¯¹è±¡</strong></p><p>å…è®¸ä½¿ç”¨æ•°ç»„æ¥åˆå§‹åŒ–vectorå¯¹è±¡ã€‚è¦å®ç°è¿™ä¸€ç›®çš„ï¼Œåªéœ€æŒ‡æ˜è¦æ‹·è´åŒºåŸŸçš„é¦–å…ƒç´ åœ°å€å’Œå°¾ååœ°å€å°±å¯ä»¥äº†ï¼š</p><p><img src="/../images/C-C-Primer-Chapter-3/1725420062654.png"></p><h2 id="3-6-å¤šç»´æ•°ç»„"><a href="#3-6-å¤šç»´æ•°ç»„" class="headerlink" title="3.6 å¤šç»´æ•°ç»„"></a>3.6 å¤šç»´æ•°ç»„</h2><p>è¦ä½¿ç”¨èŒƒå›´forè¯­å¥å¤„ç†å¤šç»´æ•°ç»„ï¼Œé™¤äº†æœ€å†…å±‚çš„å¾ªç¯å¤–ï¼Œå…¶ä»–æ‰€æœ‰å¾ªç¯çš„æ§åˆ¶å˜é‡éƒ½åº”è¯¥æ˜¯å¼•ç”¨ç±»å‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 2</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-2/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-2/</url>
    
    <content type="html"><![CDATA[<h1 id="å˜é‡å’ŒåŸºæœ¬ç±»å‹"><a href="#å˜é‡å’ŒåŸºæœ¬ç±»å‹" class="headerlink" title="å˜é‡å’ŒåŸºæœ¬ç±»å‹"></a>å˜é‡å’ŒåŸºæœ¬ç±»å‹</h1><span id="more"></span><h2 id="2-1-åŸºæœ¬å†…ç½®ç±»å‹"><a href="#2-1-åŸºæœ¬å†…ç½®ç±»å‹" class="headerlink" title="2.1 åŸºæœ¬å†…ç½®ç±»å‹"></a>2.1 åŸºæœ¬å†…ç½®ç±»å‹</h2><p>C++å®šä¹‰äº†ä¸€å¥—åŒ…æ‹¬ç®—æœ¯ç±»å‹ï¼ˆarithmetic typeï¼‰å’Œç©ºç±»å‹ï¼ˆvoidï¼‰åœ¨å†…çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚å…¶ä¸­ç®—æœ¯ç±»å‹åŒ…å«äº†å­—ç¬¦ã€æ•´å‹æ•°ã€å¸ƒå°”å€¼å’Œæµ®ç‚¹æ•°ã€‚ç©ºç±»å‹ä¸å¯¹åº”å…·ä½“çš„å€¼ï¼Œä»…ç”¨äºä¸€äº›ç‰¹æ®Šçš„åœºåˆã€‚</p><h3 id="2-1-1-ç®—æœ¯ç±»å‹"><a href="#2-1-1-ç®—æœ¯ç±»å‹" class="headerlink" title="2.1.1 ç®—æœ¯ç±»å‹"></a>2.1.1 ç®—æœ¯ç±»å‹</h3><p>åŒ…æ‹¬æ•´å‹ï¼ˆintegral typeï¼ŒåŒ…æ‹¬å­—ç¬¦å’Œå¸ƒå°”ç±»å‹åœ¨å†…ï¼‰å’Œæµ®ç‚¹å‹ã€‚</p><h3 id="2-1-3-å­—é¢å€¼å¸¸é‡"><a href="#2-1-3-å­—é¢å€¼å¸¸é‡" class="headerlink" title="2.1.3 å­—é¢å€¼å¸¸é‡"></a>2.1.3 å­—é¢å€¼å¸¸é‡</h3><p>ä¸€ä¸ªå½¢å¦‚42çš„å€¼è¢«ç§°ä½œå­—é¢å€¼å¸¸é‡ï¼ˆliteralï¼‰ï¼Œè¿™æ ·çš„å€¼ä¸€æœ›è€ŒçŸ¥ã€‚æ¯ä¸ªå­—é¢å€¼å¸¸é‡éƒ½å¯¹åº”ä¸€ç§æ•°æ®ç±»å‹ï¼Œå­—é¢å€¼å¸¸é‡çš„å½¢å¼å’Œå€¼å†³å®šäº†å®ƒçš„æ•°æ®ç±»å‹ã€‚</p><p><strong>1.æ•´å‹å’Œæµ®ç‚¹å‹å­—é¢å€¼</strong></p><ul><li>æ•´å‹å­—é¢å€¼å…·ä½“çš„æ•°æ®ç±»å‹ç”±å®ƒçš„å€¼å’Œç¬¦å·å†³å®šã€‚</li><li>é»˜è®¤çš„ï¼Œæµ®ç‚¹å‹å­—é¢å€¼æ˜¯ä¸€ä¸ªdoubleã€‚</li></ul><p><strong>2.å­—ç¬¦å’Œå­—ç¬¦ä¸²å­—é¢å€¼</strong></p><ul><li>ç”±å•å¼•å·æ‹¬èµ·æ¥çš„ä¸€ä¸ªå­—ç¬¦ç§°ä¸ºcharå‹å­—é¢å€¼ï¼ŒåŒå¼•å·æ‹¬èµ·æ¥çš„é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦åˆ™æ„æˆå­—ç¬¦ä¸²å‹å­—é¢å€¼ã€‚</li><li>å­—ç¬¦ä¸²å­—é¢å€¼çš„ç±»å‹å®é™…ä¸Šæ˜¯ç”±å¸¸é‡å­—ç¬¦æ„æˆçš„æ•°ç»„ï¼ˆarrayï¼‰</li><li>ç¼–è¯‘å™¨åœ¨æ¯ä¸ªå­—ç¬¦ä¸²çš„ç»“å°¾å¤„æ·»åŠ ä¸€ä¸ªç©ºå­—ç¬¦ï¼ˆâ€²\0â€²ï¼‰ï¼Œå› æ­¤ï¼Œå­—ç¬¦ä¸²å­—é¢å€¼çš„å®é™…é•¿åº¦è¦æ¯”å®ƒçš„å†…å®¹å¤š1ã€‚</li></ul><p><strong>3.å¸ƒå°”å­—é¢å€¼å’ŒæŒ‡é’ˆå­—é¢å€¼</strong></p><ul><li>trueå’Œfalseæ˜¯å¸ƒå°”ç±»å‹çš„å­—é¢å€¼</li><li>nullptræ˜¯æŒ‡é’ˆå­—é¢å€¼</li></ul><h2 id="2-2-å˜é‡"><a href="#2-2-å˜é‡" class="headerlink" title="2.2 å˜é‡"></a>2.2 å˜é‡</h2><p>å˜é‡æä¾›ä¸€ä¸ªå…·åçš„ã€å¯ä¾›ç¨‹åºæ“ä½œçš„å­˜å‚¨ç©ºé—´ã€‚</p><h3 id="2-2-1-å˜é‡å®šä¹‰"><a href="#2-2-1-å˜é‡å®šä¹‰" class="headerlink" title="2.2.1 å˜é‡å®šä¹‰"></a>2.2.1 å˜é‡å®šä¹‰</h3><p><strong>1.åˆ—è¡¨åˆå§‹åŒ–</strong></p><ul><li>å½“ç”¨äºå†…ç½®ç±»å‹çš„å˜é‡æ—¶ï¼Œè¿™ç§åˆå§‹åŒ–å½¢å¼æœ‰ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ï¼šå¦‚æœæˆ‘ä»¬ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–ä¸”åˆå§‹å€¼å­˜åœ¨ä¸¢å¤±ä¿¡æ¯çš„é£é™©ï¼Œåˆ™ç¼–è¯‘å™¨å°†æŠ¥é”™</li></ul><p><strong>2.é»˜è®¤åˆå§‹åŒ–</strong></p><ul><li>é»˜è®¤å€¼åˆ°åº•æ˜¯ä»€ä¹ˆç”±å˜é‡ç±»å‹å†³å®šï¼ŒåŒæ—¶å®šä¹‰å˜é‡çš„ä½ç½®ä¹Ÿä¼šå¯¹æ­¤æœ‰å½±å“ã€‚</li><li>å¦‚æœæ˜¯å†…ç½®ç±»å‹çš„å˜é‡æœªè¢«æ˜¾å¼åˆå§‹åŒ–ï¼Œå®ƒçš„å€¼ç”±å®šä¹‰çš„ä½ç½®å†³å®šã€‚</li><li>å®šä¹‰äºä»»ä½•å‡½æ•°ä½“ä¹‹å¤–çš„å˜é‡è¢«åˆå§‹åŒ–ä¸º0ã€‚</li><li>å®šä¹‰åœ¨å‡½æ•°ä½“å†…éƒ¨çš„å†…ç½®ç±»å‹å˜é‡å°†ä¸è¢«åˆå§‹åŒ–ï¼ˆuninitializedï¼‰ã€‚</li></ul><h3 id="2-2-2-å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»"><a href="#2-2-2-å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»" class="headerlink" title="2.2.2 å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»"></a>2.2.2 å˜é‡å£°æ˜å’Œå®šä¹‰çš„å…³ç³»</h3><p><strong>å£°æ˜ï¼ˆdeclarationï¼‰</strong>ä½¿å¾—åå­—ä¸ºç¨‹åºæ‰€çŸ¥ï¼Œä¸€ä¸ªæ–‡ä»¶å¦‚æœæƒ³ä½¿ç”¨åˆ«å¤„å®šä¹‰çš„åå­—åˆ™å¿…é¡»åŒ…å«å¯¹é‚£ä¸ªåå­—çš„å£°æ˜ã€‚è€Œ<strong>å®šä¹‰ï¼ˆdefinitionï¼‰</strong>è´Ÿè´£åˆ›å»ºä¸åå­—å…³è”çš„å®ä½“ã€‚</p><ul><li>å¦‚æœæƒ³å£°æ˜ä¸€ä¸ªå˜é‡è€Œéå®šä¹‰å®ƒï¼Œå°±åœ¨å˜é‡åå‰æ·»åŠ å…³é”®å­—externï¼Œè€Œä¸”ä¸è¦æ˜¾å¼åœ°åˆå§‹åŒ–å˜é‡</li><li>å¦‚æœè¦åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨åŒä¸€ä¸ªå˜é‡ï¼Œå°±å¿…é¡»å°†å£°æ˜å’Œå®šä¹‰åˆ†ç¦»ã€‚æ­¤æ—¶ï¼Œ<strong>å˜é‡çš„å®šä¹‰</strong>å¿…é¡»å‡ºç°åœ¨ä¸”åªèƒ½å‡ºç°åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œå…¶ä»–ç”¨åˆ°è¯¥å˜é‡çš„æ–‡ä»¶å¿…é¡»å¯¹å…¶è¿›è¡Œå£°æ˜ï¼Œå´ç»å¯¹ä¸èƒ½é‡å¤å®šä¹‰ã€‚</li></ul><blockquote><p>é™æ€ç±»å‹</p><p>C++æ˜¯ä¸€ç§é™æ€ç±»å‹ï¼ˆstatically typedï¼‰è¯­è¨€ï¼Œå…¶å«ä¹‰æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µæ£€æŸ¥ç±»å‹ã€‚å…¶ä¸­ï¼Œæ£€æŸ¥ç±»å‹çš„è¿‡ç¨‹ç§°ä¸ºç±»å‹æ£€æŸ¥ï¼ˆtype checkingï¼‰ã€‚åœ¨C++è¯­è¨€ä¸­ï¼Œç¼–è¯‘å™¨è´Ÿè´£æ£€æŸ¥æ•°æ®ç±»å‹æ˜¯å¦æ”¯æŒè¦æ‰§è¡Œçš„è¿ç®—ï¼Œå¦‚æœè¯•å›¾æ‰§è¡Œç±»å‹ä¸æ”¯æŒçš„è¿ç®—ï¼Œç¼–è¯‘å™¨å°†æŠ¥é”™å¹¶ä¸”ä¸ä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚ç¨‹åºè¶Šå¤æ‚ï¼Œé™æ€ç±»å‹æ£€æŸ¥è¶Šæœ‰åŠ©äºå‘ç°é—®é¢˜ã€‚</p></blockquote><h3 id="2-2-3-æ ‡è¯†ç¬¦"><a href="#2-2-3-æ ‡è¯†ç¬¦" class="headerlink" title="2.2.3 æ ‡è¯†ç¬¦"></a>2.2.3 æ ‡è¯†ç¬¦</h3><h3 id="2-2-4-åå­—çš„ä½œç”¨åŸŸ"><a href="#2-2-4-åå­—çš„ä½œç”¨åŸŸ" class="headerlink" title="2.2.4 åå­—çš„ä½œç”¨åŸŸ"></a>2.2.4 åå­—çš„ä½œç”¨åŸŸ</h3><h2 id="2-3-å¤åˆç±»å‹"><a href="#2-3-å¤åˆç±»å‹" class="headerlink" title="2.3 å¤åˆç±»å‹"></a>2.3 å¤åˆç±»å‹</h2><p>å¤åˆç±»å‹ï¼ˆcompound typeï¼‰æ˜¯æŒ‡åŸºäºå…¶ä»–ç±»å‹å®šä¹‰çš„ç±»å‹ã€‚</p><h3 id="2-3-1-å¼•ç”¨"><a href="#2-3-1-å¼•ç”¨" class="headerlink" title="2.3.1 å¼•ç”¨"></a>2.3.1 å¼•ç”¨</h3><blockquote><p>å¼•ç”¨å³åˆ«å</p></blockquote><blockquote><p>å¼•ç”¨å¹¶éå¯¹è±¡ï¼Œç›¸åçš„ï¼Œå®ƒåªæ˜¯ä¸ºä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡æ‰€èµ·çš„å¦å¤–ä¸€ä¸ªåå­—ã€‚</p></blockquote><h3 id="2-3-2-æŒ‡é’ˆ"><a href="#2-3-2-æŒ‡é’ˆ" class="headerlink" title="2.3.2 æŒ‡é’ˆ"></a>2.3.2 æŒ‡é’ˆ</h3><h4 id="æŒ‡é’ˆå¼•ç”¨å¯¹æ¯”"><a href="#æŒ‡é’ˆå¼•ç”¨å¯¹æ¯”" class="headerlink" title="æŒ‡é’ˆå¼•ç”¨å¯¹æ¯”"></a>æŒ‡é’ˆå¼•ç”¨å¯¹æ¯”</h4><ul><li>æŒ‡é’ˆæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…è®¸å¯¹æŒ‡é’ˆèµ‹å€¼å’Œæ‹·è´ï¼Œè€Œä¸”åœ¨æŒ‡é’ˆçš„ç”Ÿå‘½å‘¨æœŸå†…å®ƒå¯ä»¥å…ˆåæŒ‡å‘å‡ ä¸ªä¸åŒçš„å¯¹è±¡ã€‚</li><li>æŒ‡é’ˆæ— é¡»åœ¨å®šä¹‰æ—¶èµ‹åˆå€¼ã€‚å’Œå…¶ä»–å†…ç½®ç±»å‹ä¸€æ ·ï¼Œåœ¨å—ä½œç”¨åŸŸå†…å®šä¹‰çš„æŒ‡é’ˆå¦‚æœæ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œä¹Ÿå°†æ‹¥æœ‰ä¸€ä¸ªä¸ç¡®å®šçš„å€¼ã€‚</li></ul><h4 id="void-æŒ‡é’ˆ"><a href="#void-æŒ‡é’ˆ" class="headerlink" title="void*æŒ‡é’ˆ"></a>void*æŒ‡é’ˆ</h4><ul><li>voidï¼Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„æŒ‡é’ˆç±»å‹ï¼Œå¯ç”¨äºå­˜æ”¾ä»»æ„å¯¹è±¡çš„åœ°å€ã€‚</li><li>åˆ©ç”¨voidï¼ŠæŒ‡é’ˆèƒ½åšçš„äº‹å„¿æ¯”è¾ƒæœ‰é™ï¼šæ‹¿å®ƒå’Œåˆ«çš„æŒ‡é’ˆæ¯”è¾ƒã€ä½œä¸ºå‡½æ•°çš„è¾“å…¥æˆ–è¾“å‡ºï¼Œæˆ–è€…èµ‹ç»™å¦å¤–ä¸€ä¸ªvoidï¼ŠæŒ‡é’ˆã€‚ä¸èƒ½ç›´æ¥æ“ä½œvoidï¼ŠæŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¿™ä¸ªå¯¹è±¡åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¹Ÿå°±æ— æ³•ç¡®å®šèƒ½åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šåšå“ªäº›æ“ä½œã€‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> i = <span class="hljs-number">42</span>;<br><span class="hljs-type">int</span> pi = &amp;i;<br><span class="hljs-type">int</span> *&amp;r = pi;<br></code></pre></td></tr></table></figure><p>ä»å³å‘å·¦é˜…è¯»rçš„å®šä¹‰ã€‚ç¦»å˜é‡åæœ€è¿‘çš„ç¬¦å·ï¼ˆæ­¤ä¾‹ä¸­æ˜¯&amp;rçš„ç¬¦å·&amp;ï¼‰å¯¹å˜é‡çš„ç±»å‹æœ‰æœ€ç›´æ¥çš„å½±å“ï¼Œå› æ­¤ræ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚å£°æ˜ç¬¦çš„å…¶ä½™éƒ¨åˆ†ç”¨ä»¥ç¡®å®šrå¼•ç”¨çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæ­¤ä¾‹ä¸­çš„ç¬¦å·ï¼Šè¯´æ˜rå¼•ç”¨çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚æœ€åï¼Œå£°æ˜çš„åŸºæœ¬æ•°æ®ç±»å‹éƒ¨åˆ†æŒ‡å‡ºrå¼•ç”¨çš„æ˜¯ä¸€ä¸ªintæŒ‡é’ˆã€‚</p><h2 id="2-4-consté™å®šç¬¦"><a href="#2-4-consté™å®šç¬¦" class="headerlink" title="2.4 consté™å®šç¬¦"></a>2.4 consté™å®šç¬¦</h2><p>å› ä¸ºconstå¯¹è±¡ä¸€æ—¦åˆ›å»ºåå…¶å€¼å°±ä¸èƒ½å†æ”¹å˜ï¼Œæ‰€ä»¥constå¯¹è±¡å¿…é¡»åˆå§‹åŒ–ã€‚</p><h4 id="é»˜è®¤çŠ¶æ€ä¸‹ï¼Œconstå¯¹è±¡ä»…åœ¨æ–‡ä»¶å†…æœ‰æ•ˆ"><a href="#é»˜è®¤çŠ¶æ€ä¸‹ï¼Œconstå¯¹è±¡ä»…åœ¨æ–‡ä»¶å†…æœ‰æ•ˆ" class="headerlink" title="é»˜è®¤çŠ¶æ€ä¸‹ï¼Œconstå¯¹è±¡ä»…åœ¨æ–‡ä»¶å†…æœ‰æ•ˆ"></a><strong>é»˜è®¤çŠ¶æ€ä¸‹ï¼Œconstå¯¹è±¡ä»…åœ¨æ–‡ä»¶å†…æœ‰æ•ˆ</strong></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">int</span> buffSize = <span class="hljs-number">512</span>;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨å°†åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æŠŠç”¨åˆ°è¯¥å˜é‡çš„åœ°æ–¹éƒ½æ›¿æ¢æˆå¯¹åº”çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨ä¼šæ‰¾åˆ°ä»£ç ä¸­æ‰€æœ‰ç”¨åˆ°bufSizeçš„åœ°æ–¹ï¼Œç„¶åç”¨512æ›¿æ¢ã€‚</p><p>ä¸ºäº†æ‰§è¡Œä¸Šè¿°æ›¿æ¢ï¼Œç¼–è¯‘å™¨å¿…é¡»çŸ¥é“å˜é‡çš„åˆå§‹å€¼ã€‚å¦‚æœç¨‹åºåŒ…å«å¤šä¸ªæ–‡ä»¶ï¼Œåˆ™æ¯ä¸ªç”¨äº†constå¯¹è±¡çš„æ–‡ä»¶éƒ½å¿…é¡»å¾—èƒ½è®¿é—®åˆ°å®ƒçš„åˆå§‹å€¼æ‰è¡Œã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±å¿…é¡»åœ¨æ¯ä¸€ä¸ªç”¨åˆ°å˜é‡çš„æ–‡ä»¶ä¸­éƒ½æœ‰å¯¹å®ƒçš„å®šä¹‰ï¼ˆå‚è§2.2.2èŠ‚ï¼Œç¬¬41é¡µï¼‰ã€‚ä¸ºäº†æ”¯æŒè¿™ä¸€ç”¨æ³•ï¼ŒåŒæ—¶é¿å…å¯¹åŒä¸€å˜é‡çš„é‡å¤å®šä¹‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œconstå¯¹è±¡è¢«è®¾å®šä¸ºä»…åœ¨æ–‡ä»¶å†…æœ‰æ•ˆã€‚å½“å¤šä¸ªæ–‡ä»¶ä¸­å‡ºç°äº†åŒåçš„constå˜é‡æ—¶ï¼Œå…¶å®ç­‰åŒäºåœ¨ä¸åŒæ–‡ä»¶ä¸­åˆ†åˆ«å®šä¹‰äº†ç‹¬ç«‹çš„å˜é‡ã€‚</p><p>æŸäº›æ—¶å€™æœ‰è¿™æ ·ä¸€ç§constå˜é‡ï¼Œå®ƒçš„åˆå§‹å€¼ä¸æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œä½†åˆç¡®å®æœ‰å¿…è¦åœ¨æ–‡ä»¶é—´å…±äº«ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç¼–è¯‘å™¨ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†åˆ«ç”Ÿæˆç‹¬ç«‹çš„å˜é‡ã€‚ç›¸åï¼Œæˆ‘ä»¬æƒ³è®©è¿™ç±»constå¯¹è±¡åƒå…¶ä»–ï¼ˆéå¸¸é‡ï¼‰å¯¹è±¡ä¸€æ ·å·¥ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰constï¼Œè€Œåœ¨å…¶ä»–å¤šä¸ªæ–‡ä»¶ä¸­å£°æ˜å¹¶ä½¿ç”¨å®ƒã€‚è§£å†³çš„åŠæ³•æ˜¯ï¼Œå¯¹äºconstå˜é‡ä¸ç®¡æ˜¯å£°æ˜è¿˜æ˜¯å®šä¹‰éƒ½æ·»åŠ externå…³é”®å­—ï¼Œè¿™æ ·åªéœ€å®šä¹‰ä¸€æ¬¡å°±å¯ä»¥äº†</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// file1.cc</span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> buffSize = <span class="hljs-built_in">fcn</span>();<br><span class="hljs-comment">// file1.h</span><br><span class="hljs-keyword">extern</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> buffSize;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¿°ç¨‹åºæ‰€ç¤ºï¼Œfile_1.ccå®šä¹‰å¹¶åˆå§‹åŒ–äº†bufSizeã€‚å› ä¸ºè¿™æ¡è¯­å¥åŒ…å«äº†åˆå§‹å€¼ï¼Œæ‰€ä»¥å®ƒï¼ˆæ˜¾ç„¶ï¼‰æ˜¯ä¸€æ¬¡å®šä¹‰ã€‚ç„¶è€Œï¼Œå› ä¸ºbufSizeæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¿…é¡»ç”¨externåŠ ä»¥é™å®šä½¿å…¶è¢«å…¶ä»–æ–‡ä»¶ä½¿ç”¨ã€‚file_1.hå¤´æ–‡ä»¶ä¸­çš„å£°æ˜ä¹Ÿç”±externåšäº†é™å®šï¼Œå…¶ä½œç”¨æ˜¯æŒ‡æ˜bufSizeå¹¶éæœ¬æ–‡ä»¶æ‰€ç‹¬æœ‰ï¼Œå®ƒçš„å®šä¹‰å°†åœ¨åˆ«å¤„å‡ºç°ã€‚</p><h3 id="2-4-1-constçš„å¼•ç”¨"><a href="#2-4-1-constçš„å¼•ç”¨" class="headerlink" title="2.4.1 constçš„å¼•ç”¨"></a>2.4.1 constçš„å¼•ç”¨</h3><p>å¯¹å¸¸é‡çš„å¼•ç”¨ï¼Œç®€ç§°ä¸ºå¸¸é‡å¼•ç”¨ï¼Œå¯¹å¸¸é‡çš„å¼•ç”¨å¿…é¡»æ·»åŠ consté™å®šç¬¦ã€‚</p><h4 id="åˆå§‹åŒ–å’Œå¯¹constçš„å¼•ç”¨"><a href="#åˆå§‹åŒ–å’Œå¯¹constçš„å¼•ç”¨" class="headerlink" title="åˆå§‹åŒ–å’Œå¯¹constçš„å¼•ç”¨"></a>åˆå§‹åŒ–å’Œå¯¹constçš„å¼•ç”¨</h4><p>åœ¨åˆå§‹åŒ–å¸¸é‡å¼•ç”¨æ—¶å…è®¸ç”¨ä»»æ„è¡¨è¾¾å¼ä½œä¸ºåˆå§‹å€¼ï¼Œåªè¦è¯¥è¡¨è¾¾å¼çš„ç»“æœèƒ½è½¬æ¢æˆï¼ˆå‚è§2.1.2èŠ‚ï¼Œç¬¬32é¡µï¼‰å¼•ç”¨çš„ç±»å‹å³å¯ã€‚å°¤å…¶æ˜¯ï¼Œå…è®¸ä¸ºä¸€ä¸ªå¸¸é‡å¼•ç”¨ç»‘å®šéå¸¸é‡çš„å¯¹è±¡ã€å­—é¢å€¼ï¼Œç”šè‡³æ˜¯ä¸ªä¸€èˆ¬è¡¨è¾¾å¼</p><h3 id="2-4-2-æŒ‡é’ˆå’Œconst"><a href="#2-4-2-æŒ‡é’ˆå’Œconst" class="headerlink" title="2.4.2 æŒ‡é’ˆå’Œconst"></a>2.4.2 æŒ‡é’ˆå’Œconst</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆ</span><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> i = <span class="hljs-number">42</span>;<br><span class="hljs-type">const</span> <span class="hljs-type">int</span> *p = &amp;i;<br><br><span class="hljs-comment">// å¸¸é‡æŒ‡é’ˆ</span><br><span class="hljs-type">int</span> *<span class="hljs-type">const</span> q = &amp;i;<br></code></pre></td></tr></table></figure><h3 id="2-4-3-é¡¶å±‚const"><a href="#2-4-3-é¡¶å±‚const" class="headerlink" title="2.4.3 é¡¶å±‚const"></a>2.4.3 é¡¶å±‚const</h3><p>é¡¶å±‚constï¼ˆtop-level constï¼‰è¡¨ç¤ºæŒ‡é’ˆæœ¬èº«æ˜¯ä¸ªå¸¸é‡</p><p>åº•å±‚constï¼ˆlow-level constï¼‰è¡¨ç¤ºæŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚</p><h3 id="2-4-4-constexprå’Œå¸¸é‡è¡¨è¾¾å¼"><a href="#2-4-4-constexprå’Œå¸¸é‡è¡¨è¾¾å¼" class="headerlink" title="2.4.4 constexprå’Œå¸¸é‡è¡¨è¾¾å¼"></a>2.4.4 constexprå’Œå¸¸é‡è¡¨è¾¾å¼</h3><p>å¸¸é‡è¡¨è¾¾å¼ï¼ˆconst expressionï¼‰æ˜¯æŒ‡å€¼ä¸ä¼šæ”¹å˜å¹¶ä¸”åœ¨ç¼–è¯‘è¿‡ç¨‹å°±èƒ½å¾—åˆ°è®¡ç®—ç»“æœçš„è¡¨è¾¾å¼ã€‚</p><p>æ˜¾ç„¶ï¼Œå­—é¢å€¼å±äºå¸¸é‡è¡¨è¾¾å¼ï¼Œç”¨å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–çš„constå¯¹è±¡ä¹Ÿæ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚</p><p><strong>constexprå˜é‡</strong></p><p>C++11æ–°æ ‡å‡†è§„å®šï¼Œå…è®¸å°†å˜é‡å£°æ˜ä¸ºconstexprç±»å‹ä»¥ä¾¿ç”±ç¼–è¯‘å™¨æ¥éªŒè¯å˜é‡çš„å€¼æ˜¯å¦æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ã€‚å£°æ˜ä¸ºconstexprçš„å˜é‡ä¸€å®šæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè€Œä¸”å¿…é¡»ç”¨å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–</p><p><strong>å­—é¢å€¼ç±»å‹</strong></p><p>å¸¸é‡è¡¨è¾¾å¼çš„å€¼éœ€è¦åœ¨ç¼–è¯‘æ—¶å°±å¾—åˆ°è®¡ç®—ï¼Œå› æ­¤å¯¹å£°æ˜constexpræ—¶ç”¨åˆ°çš„ç±»å‹å¿…é¡»æœ‰æ‰€é™åˆ¶ã€‚å› ä¸ºè¿™äº›ç±»å‹ä¸€èˆ¬æ¯”è¾ƒç®€å•ï¼Œå€¼ä¹Ÿæ˜¾è€Œæ˜“è§ã€å®¹æ˜“å¾—åˆ°ï¼Œå°±æŠŠå®ƒä»¬ç§°ä¸ºâ€œå­—é¢å€¼ç±»å‹â€ï¼ˆliteral typeï¼‰ã€‚</p><p>ç®—æœ¯ç±»å‹ã€å¼•ç”¨å’ŒæŒ‡é’ˆéƒ½å±äºå­—é¢å€¼ç±»å‹ã€‚è‡ªå®šä¹‰ç±»Sales_itemã€IOåº“ã€stringç±»å‹åˆ™ä¸å±äºå­—é¢å€¼ç±»å‹ï¼Œä¹Ÿå°±ä¸èƒ½è¢«å®šä¹‰æˆconstexprã€‚</p><p>å°½ç®¡æŒ‡é’ˆå’Œå¼•ç”¨éƒ½èƒ½å®šä¹‰æˆconstexprï¼Œä½†å®ƒä»¬çš„åˆå§‹å€¼å´å—åˆ°ä¸¥æ ¼é™åˆ¶ã€‚ä¸€ä¸ªconstexpræŒ‡é’ˆçš„åˆå§‹å€¼å¿…é¡»æ˜¯nullptræˆ–è€…0ï¼Œæˆ–è€…æ˜¯å­˜å‚¨äºæŸä¸ªå›ºå®šåœ°å€ä¸­çš„å¯¹è±¡ã€‚</p><p>å‡½æ•°ä½“å†…å®šä¹‰çš„å˜é‡ä¸€èˆ¬æ¥è¯´å¹¶éå­˜æ”¾åœ¨å›ºå®šåœ°å€ä¸­ï¼Œå› æ­¤constexpræŒ‡é’ˆä¸èƒ½æŒ‡å‘è¿™æ ·çš„å˜é‡ã€‚ç›¸åçš„ï¼Œå®šä¹‰äºæ‰€æœ‰å‡½æ•°ä½“ä¹‹å¤–çš„å¯¹è±¡å…¶åœ°å€å›ºå®šä¸å˜ï¼Œèƒ½ç”¨æ¥åˆå§‹åŒ–constexpræŒ‡é’ˆã€‚</p><p><strong>æŒ‡é’ˆå’Œconstexpr</strong></p><p>å¿…é¡»æ˜ç¡®ä¸€ç‚¹ï¼Œåœ¨constexprå£°æ˜ä¸­å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œé™å®šç¬¦constexprä»…å¯¹æŒ‡é’ˆæœ‰æ•ˆï¼Œä¸æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡æ— å…³</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">int</span> *p = <span class="hljs-literal">nullptr</span>;<br><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> *q = <span class="hljs-literal">nullptr</span>;<br></code></pre></td></tr></table></figure><p>pæ˜¯åº•å±‚constï¼Œqæ˜¯é¡¶å±‚const</p><h2 id="2-5-å¤„ç†ç±»å‹"><a href="#2-5-å¤„ç†ç±»å‹" class="headerlink" title="2.5 å¤„ç†ç±»å‹"></a>2.5 å¤„ç†ç±»å‹</h2><h3 id="2-5-1-ç±»å‹åˆ«å"><a href="#2-5-1-ç±»å‹åˆ«å" class="headerlink" title="2.5.1 ç±»å‹åˆ«å"></a>2.5.1 ç±»å‹åˆ«å</h3><p>typedefå’Œusing</p><p>ä¸è¦æŠŠåŸå§‹ç±»å‹æ›¿æ¢è¿›å»ï¼Œè¿™ç§ç†è§£æ˜¯é”™è¯¯çš„ã€‚</p><h3 id="2-5-2-autoç±»å‹è¯´æ˜ç¬¦"><a href="#2-5-2-autoç±»å‹è¯´æ˜ç¬¦" class="headerlink" title="2.5.2 autoç±»å‹è¯´æ˜ç¬¦"></a>2.5.2 autoç±»å‹è¯´æ˜ç¬¦</h3><p>1.ä½¿ç”¨å¼•ç”¨å…¶å®æ˜¯ä½¿ç”¨å¼•ç”¨çš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯å½“å¼•ç”¨è¢«ç”¨ä½œåˆå§‹å€¼æ—¶ï¼ŒçœŸæ­£å‚ä¸åˆå§‹åŒ–çš„å…¶å®æ˜¯å¼•ç”¨å¯¹è±¡çš„å€¼ã€‚æ­¤æ—¶ç¼–è¯‘å™¨ä»¥å¼•ç”¨å¯¹è±¡çš„ç±»å‹ä½œä¸ºautoçš„ç±»å‹</p><p>2.autoä¸€èˆ¬ä¼šå¿½ç•¥æ‰é¡¶å±‚constï¼ŒåŒæ—¶åº•å±‚conståˆ™ä¼šä¿ç•™ä¸‹æ¥ï¼Œæ¯”å¦‚å½“åˆå§‹å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆæ—¶ã€‚å¦‚æœå¸Œæœ›æ¨å¯¼å‡ºé¡¶å±‚constï¼Œéœ€è¦æ˜¾ç¤ºå£°æ˜ã€‚</p><h3 id="2-5-3-decltypeç±»å‹æŒ‡ç¤ºç¬¦"><a href="#2-5-3-decltypeç±»å‹æŒ‡ç¤ºç¬¦" class="headerlink" title="2.5.3 decltypeç±»å‹æŒ‡ç¤ºç¬¦"></a>2.5.3 decltypeç±»å‹æŒ‡ç¤ºç¬¦</h3><p>å®ƒçš„ä½œç”¨æ˜¯é€‰æ‹©å¹¶è¿”å›æ“ä½œæ•°çš„æ•°æ®ç±»å‹ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨åˆ†æè¡¨è¾¾å¼å¹¶å¾—åˆ°å®ƒçš„ç±»å‹ï¼Œå´ä¸å®é™…è®¡ç®—è¡¨è¾¾å¼çš„å€¼ã€‚</p><p>decltypeå¤„ç†é¡¶å±‚constå’Œå¼•ç”¨çš„æ–¹å¼ä¸autoæœ‰äº›è®¸ä¸åŒã€‚å¦‚æœdecltypeä½¿ç”¨çš„è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåˆ™decltypeè¿”å›è¯¥å˜é‡çš„ç±»å‹ï¼ˆåŒ…æ‹¬é¡¶å±‚constå’Œå¼•ç”¨åœ¨å†…ï¼‰ã€‚</p><blockquote><p>decltypeï¼ˆï¼ˆvariableï¼‰ï¼‰ï¼ˆæ³¨æ„æ˜¯åŒå±‚æ‹¬å·ï¼‰çš„ç»“æœæ°¸è¿œæ˜¯å¼•ç”¨ï¼Œè€Œdecltypeï¼ˆvariableï¼‰ç»“æœåªæœ‰å½“variableæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¼•ç”¨æ—¶æ‰æ˜¯å¼•ç”¨ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[C++]C++Primer Chapter 1</title>
    <link href="/2024/09/22/C-C-Primer-Chapter-1/"/>
    <url>/2024/09/22/C-C-Primer-Chapter-1/</url>
    
    <content type="html"><![CDATA[<h1 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h1><span id="more"></span><h2 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h2><ul><li>æ¯ä¸ªC++ç¨‹åºéƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ï¼ˆfunctionï¼‰ï¼Œå…¶ä¸­ä¸€ä¸ªå¿…é¡»å‘½åä¸ºmainã€‚æ“ä½œç³»ç»Ÿé€šè¿‡è°ƒç”¨mainæ¥è¿è¡ŒC++ç¨‹åºã€‚</li><li>å‡½æ•° &lt; è¿”å›ç±»å‹ + å‡½æ•°å + å½¢å‚åˆ—è¡¨ + å‡½æ•°ä½“&gt;</li><li>å†…ç½®ç±»å‹ï¼ˆbuilt-in typeï¼‰ï¼Œè¯­è¨€è‡ªèº«å®šä¹‰çš„ç±»å‹ã€‚</li></ul><h2 id="1-2-è¾“å…¥è¾“å‡º"><a href="#1-2-è¾“å…¥è¾“å‡º" class="headerlink" title="1.2 è¾“å…¥è¾“å‡º"></a>1.2 è¾“å…¥è¾“å‡º</h2><ul><li>c++ç”±æ ‡å‡†åº“æ¥æä¾›IOæœºåˆ¶ã€‚</li><li>æ ‡å‡†åº“å®šä¹‰äº†4ä¸ªIOå¯¹è±¡ <code>&lt;cin cout cerr clog&gt;</code></li></ul><h2 id="1-4-æ§åˆ¶æµ"><a href="#1-4-æ§åˆ¶æµ" class="headerlink" title="1.4 æ§åˆ¶æµ"></a>1.4 æ§åˆ¶æµ</h2><ul><li>å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªistreamå¯¹è±¡ä½œä¸ºæ¡ä»¶æ—¶ï¼Œå…¶æ•ˆæœæ˜¯æ£€æµ‹æµçš„çŠ¶æ€ã€‚å¦‚æœæµæ˜¯æœ‰æ•ˆçš„ï¼Œå³æµæœªé‡åˆ°é”™è¯¯ï¼Œé‚£ä¹ˆæ£€æµ‹æˆåŠŸã€‚å½“é‡åˆ°æ–‡ä»¶ç»“æŸç¬¦ï¼ˆend-of-fileï¼‰ï¼Œæˆ–é‡åˆ°ä¸€ä¸ªæ— æ•ˆè¾“å…¥æ—¶ï¼ˆä¾‹å¦‚è¯»å…¥çš„å€¼ä¸æ˜¯ä¸€ä¸ªæ•´æ•°ï¼‰ï¼Œistreamå¯¹è±¡çš„çŠ¶æ€ä¼šå˜ä¸ºæ— æ•ˆã€‚å¤„äºæ— æ•ˆçŠ¶æ€çš„istreamå¯¹è±¡ä¼šä½¿æ¡ä»¶å˜ä¸ºå‡ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç¼–ç¨‹è¯­è¨€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C++</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[MIT 6.S081]Lab1 Xv6 and Unix utilities</title>
    <link href="/2024/09/21/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/"/>
    <url>/2024/09/21/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/</url>
    
    <content type="html"><![CDATA[<h2 id="1-é€šè¿‡gdbè°ƒè¯•"><a href="#1-é€šè¿‡gdbè°ƒè¯•" class="headerlink" title="1 é€šè¿‡gdbè°ƒè¯•"></a>1 é€šè¿‡gdbè°ƒè¯•</h2><p>å‚è€ƒé“¾æ¥</p><ul><li><a href="https://web.archive.org/web/20190308091152/http://zoo.cs.yale.edu:80/classes/cs422/2011/lec/l2-hw">Homework: running and debugging xv6 (archive.org)</a></li><li><a href="https://www.cnblogs.com/KatyuMarisaBlog/p/13727565.html">MIT 6.S081 xv6è°ƒè¯•ä¸å®Œå…¨æŒ‡åŒ— - KatyuMarisa - åšå®¢å›­ (cnblogs.com)</a></li><li><a href="https://gabriellesc.github.io/teaching/resources/GDB-cheat-sheet.pdf">GDB-cheat-sheet.pdf (gabriellesc.github.io)</a></li></ul><span id="more"></span><h2 id="2-sleepï¼ˆeasyï¼‰"><a href="#2-sleepï¼ˆeasyï¼‰" class="headerlink" title="2 sleepï¼ˆeasyï¼‰"></a>2 sleepï¼ˆeasyï¼‰</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240919005050483.png" alt="å›¾2-1"></p><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921092721550.png" alt="å›¾2-2"></p><h2 id="3-pingpong-easy"><a href="#3-pingpong-easy" class="headerlink" title="3 pingpong(easy)"></a>3 pingpong(easy)</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240919005125509.png" alt="å›¾3-1"></p><p>æœ¬é¢˜è€ƒæŸ¥çš„æ˜¯ç®¡é“é€šä¿¡ç›¸å…³å†…å®¹çš„ç†è§£ã€‚</p><blockquote><p>If no data is available, a read on a pipe waits for either data to be written or for all file descriptors referring to the write end to be closed; in the latter case, read will return 1, just as if the end of a data file had been reached.</p></blockquote><p>xv6ä¹¦ä¸­æŒ‡å‡ºï¼Œ<code>read</code>ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æ•°æ®è¢«å†™å…¥ç®¡é“æˆ–è€…æ‰€æœ‰æŒ‡å‘ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦éƒ½è¢«å…³é—­ã€‚</p><p>ä¸€ç§ç®€å•çš„å®ç°æ˜¯åˆ›å»ºä¸¤ä¸ªç®¡é“ï¼Œä¸€ä¸ªç®¡é“çš„æµå‘ä¸ºçˆ¶è¿›ç¨‹åˆ°å­è¿›ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªçš„æµå‘ä¸ºå­è¿›ç¨‹åˆ°çˆ¶è¿›ç¨‹ã€‚</p><p>å¦å¤–ä¸€ç§å®ç°åªéœ€è¦åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œä½†æ˜¯ç”±äºçˆ¶å­è¿›ç¨‹è¯»å†™çš„éƒ½æ˜¯åŒä¸€ä¸ªç®¡é“ï¼Œéœ€è¦é€šè¿‡waitæ¥åŒæ­¥çˆ¶å­è¿›ç¨‹è¯»å†™çš„é¡ºåºï¼Œé˜²æ­¢å‡ºç°æ­»é”çš„æƒ…å†µã€‚ä»£ç å¦‚ä¸‹ï¼Œæ³¨æ„55è¡Œçš„ <code>wait((int*)0)</code>ï¼Œçˆ¶è¿›ç¨‹ä¸€å®šè¦ç­‰å¾…å­è¿›ç¨‹é€€å‡ºåï¼Œæ‰å¯ä»¥ä»ç®¡é“ä¸­è¯»å–æ•°æ®ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°çˆ¶è¿›ç¨‹è‡ªå†™è‡ªè¯»çš„æƒ…å†µï¼Œå¯¼è‡´å­è¿›ç¨‹é˜»å¡åœ¨21è¡Œå¤„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-type">int</span> p[<span class="hljs-number">2</span>];<br>    pipe(p);<br><br>    <span class="hljs-type">int</span> pid = fork();<br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-comment">// fork failed</span><br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;fork failure\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-type">char</span> buf = <span class="hljs-string">&#x27;1&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>) <br>    &#123;<br>        <span class="hljs-comment">// child </span><br>        pid = getpid(); <span class="hljs-comment">// acquire the pid of the child process</span><br><br>        <span class="hljs-comment">// read a byte from pipe</span><br>        <span class="hljs-keyword">if</span> (read(p[<span class="hljs-number">0</span>], &amp;buf, <span class="hljs-keyword">sizeof</span>(buf)) != <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;child process read failed\n&quot;</span>);<br>            close(p[<span class="hljs-number">0</span>]);<br>            close(p[<span class="hljs-number">1</span>]);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125; <br>        close(p[<span class="hljs-number">0</span>]);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d: received ping\n&quot;</span>, pid); <br>        <span class="hljs-comment">// write a byte to pipe</span><br>        <span class="hljs-keyword">if</span> (write(p[<span class="hljs-number">1</span>], &amp;buf, <span class="hljs-keyword">sizeof</span>(buf)) != <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;child process write failed\n&quot;</span>);<br>            close(p[<span class="hljs-number">1</span>]);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125; <br>        close(p[<span class="hljs-number">1</span>]);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <br>    &#123;<br>        <span class="hljs-comment">// father</span><br>        pid = getpid(); <span class="hljs-comment">// acquire the pid of the parent process</span><br>        <span class="hljs-comment">// write a byte to pipe</span><br>        <span class="hljs-keyword">if</span> (write(p[<span class="hljs-number">1</span>], &amp;buf, <span class="hljs-keyword">sizeof</span>(buf)) != <span class="hljs-number">1</span>) <br>        &#123;<br>            close(p[<span class="hljs-number">0</span>]);<br>            close(p[<span class="hljs-number">1</span>]);<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;parent process write failed\n&quot;</span>);<br>            wait((<span class="hljs-type">int</span>*)<span class="hljs-number">0</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        close(p[<span class="hljs-number">1</span>]);<br><br>        wait((<span class="hljs-type">int</span>*)<span class="hljs-number">0</span>);<br><br>        <span class="hljs-comment">// read a byte from pipe</span><br>        <span class="hljs-keyword">if</span> (read(p[<span class="hljs-number">0</span>], &amp;buf, <span class="hljs-keyword">sizeof</span>(buf)) != <span class="hljs-number">1</span>) <br>        &#123;<br>            close(p[<span class="hljs-number">0</span>]);<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;father process read failed\n&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>        close(p[<span class="hljs-number">0</span>]);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d:received pong\n&quot;</span>, pid);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921092958561.png" alt="å›¾3-2"></p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921152718120.png" alt="å›¾3-3"></p><h2 id="4-primes-moderate-hard"><a href="#4-primes-moderate-hard" class="headerlink" title="4 primes (moderate)&#x2F;(hard)"></a>4 primes (<a href="https://pdos.csail.mit.edu/6.828/2021/labs/guidance.html">moderate</a>)&#x2F;(<a href="https://pdos.csail.mit.edu/6.828/2021/labs/guidance.html">hard</a>)</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240919005317618.png" alt="å›¾4-1"></p><p>è¿™é“é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯åˆ©ç”¨ <code>fork</code> è¿›è¡Œå¤šè¿›ç¨‹ç¼–ç¨‹ã€‚</p><p>é‡ç‚¹æ˜¯ç†è§£ä¸‹é¢çš„å›¾å’Œä¼ªä»£ç ã€‚æœ¬é¢˜ç”¨åˆ°äº†ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼ˆ<a href="https://swtch.com/~rsc/thread/">Bell Labs and CSP Threads (swtch.com)</a>ï¼‰ï¼Œé€šè¿‡æœªç¼“å†²çš„å‘½åçš„é€šé“æ¥åŒæ—¶è¿›è¡Œé€šä¿¡å’ŒåŒæ­¥ã€‚å› ä¸ºç®¡é“æœªç¼“å†²ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¯»å†™é˜»å¡æ¥è¿›è¡ŒåŒæ­¥ã€‚</p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240919005607473.png" alt="å›¾4-2"></p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240919005544805.png" alt="å›¾4-3"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-type">int</span> left[<span class="hljs-number">2</span>];<br>    <span class="hljs-type">int</span> right[<span class="hljs-number">2</span>];<br>    <span class="hljs-type">int</span> start = <span class="hljs-number">2</span>;<br>    <span class="hljs-type">int</span> end = <span class="hljs-number">35</span>;<br><br>    pipe(left);<br><br>    <span class="hljs-type">int</span> pid = fork();<br><br>    <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;fork failed pid = &lt;%d&gt;\n&quot;</span>, getpid());<br>        close(left[<span class="hljs-number">0</span>]);<br>        close(left[<span class="hljs-number">1</span>]);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-comment">// child</span><br>        close(left[<span class="hljs-number">1</span>]); <br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-comment">// parent</span><br>        close(left[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num = start; num &lt;= end; ++num)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (write(left[<span class="hljs-number">1</span>], &amp;num, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)) != <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))<br>            &#123;<br>                <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;write failed pid = &lt;%d&gt;\n&quot;</span>, getpid());<br>                close(left[<span class="hljs-number">1</span>]);<br>                wait((<span class="hljs-type">int</span>*)<span class="hljs-number">0</span>);<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br><br>        close(left[<span class="hljs-number">1</span>]);<br>        wait((<span class="hljs-type">int</span>*)<span class="hljs-number">0</span>); <span class="hljs-comment">// waits for its child to exit</span><br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-type">int</span> num, prime, ret_r = <span class="hljs-number">0</span>, ret_w = <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>);<br>    <span class="hljs-comment">// if there is any number in the left pipe</span><br>    <span class="hljs-comment">// the first number must be a prime</span><br>    <span class="hljs-keyword">while</span> ((ret_r = read(left[<span class="hljs-number">0</span>], &amp;prime, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))) == <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;primes %d\n&quot;</span>, prime);<br>        <span class="hljs-comment">// if there is still any number in the left pipe</span><br>        <span class="hljs-keyword">if</span> ((ret_r = read(left[<span class="hljs-number">0</span>], &amp;num, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))) == <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))<br>        &#123;<br>            pipe(right);<br>            <span class="hljs-keyword">if</span> ((pid = fork()) == <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-comment">// child</span><br>                <span class="hljs-comment">// the parent&#x27;s right is the child&#x27;s left</span><br>                <span class="hljs-comment">// note that the sequence of the next 4 lines cannot be changed </span><br>                <span class="hljs-comment">// first close the read end of the left pipe</span><br>                <span class="hljs-comment">// cuz it is the parent&#x27;s left pipe which the child doesn&#x27;t need</span><br>                close(left[<span class="hljs-number">0</span>]); <br>                <span class="hljs-comment">// then change the child&#x27;s left to its right pipe</span><br>                <span class="hljs-comment">// cuz the right pipe right now is the parent&#x27;s right pipe </span><br>                <span class="hljs-comment">// which is also the child&#x27;s left pipe</span><br>                left[<span class="hljs-number">0</span>] = right[<span class="hljs-number">0</span>];<br>                left[<span class="hljs-number">1</span>] = right[<span class="hljs-number">1</span>];<br>                <span class="hljs-comment">// close the write end of the left pipe </span><br>                close(left[<span class="hljs-number">1</span>]);<br>                <span class="hljs-comment">// continue the loop</span><br>                <span class="hljs-keyword">continue</span>;   <br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>)<br>            &#123;<br>                <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;fork failed pid = &lt;%d&gt;\n&quot;</span>, getpid());<br>                close(right[<span class="hljs-number">0</span>]);<br>                close(right[<span class="hljs-number">1</span>]);<br>                close(left[<span class="hljs-number">0</span>]);<br>                <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-comment">// parent</span><br>                close(right[<span class="hljs-number">0</span>]);<br>                <span class="hljs-keyword">do</span> &#123;<br>                    <span class="hljs-keyword">if</span> (num % prime == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((ret_w = write(right[<span class="hljs-number">1</span>], &amp;num, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))) == <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>)) <span class="hljs-keyword">continue</span>;<br>                    <span class="hljs-keyword">else</span> <br>                    &#123;<br>                        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;write failed pid = &lt;%d&gt;\n&quot;</span>, getpid());<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">while</span>((ret_r = read(left[<span class="hljs-number">0</span>], &amp;num, <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>))) == <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br>                close(left[<span class="hljs-number">0</span>]);<br>                close(right[<span class="hljs-number">1</span>]);<br>                wait((<span class="hljs-type">int</span>*)<span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">if</span> (ret_r) <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;read failed pid = &lt;%d&gt;\n&quot;</span>, getpid());<br>                ret_r == <span class="hljs-number">0</span> &amp;&amp; ret_w == <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>) ? <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>) : <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-comment">// only the last process in the pipeline will excute here</span><br>    close(left[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">if</span> (ret_r) <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;read failed pid = &lt;%d&gt;\n&quot;</span>, getpid());<br>    ret_r == <span class="hljs-number">0</span> ? <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>) : <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921093230617.png" alt="å›¾4-4"></p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921152817290.png" alt="å›¾4-5"></p><h2 id="5-find-moderate"><a href="#5-find-moderate" class="headerlink" title="5 find (moderate)"></a>5 find (<a href="https://pdos.csail.mit.edu/6.828/2021/labs/guidance.html">moderate</a>)</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240919165143206.png" alt="å›¾5-1"></p><p>è¿™é“é¢˜ç›®è€ƒå¯Ÿçš„æ˜¯å¯¹xv6æ–‡ä»¶ç³»ç»Ÿçš„ç†è§£ï¼Œæ¯”è¾ƒç®€å•ï¼Œå‚è€ƒ <code>user/ls.c</code> å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/fs.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/fcntl.h&quot;</span></span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">find</span><span class="hljs-params">(<span class="hljs-type">char</span> *dir, <span class="hljs-type">char</span>* file)</span><br>&#123;   <br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">512</span>], *p;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strlen</span>(dir) + <span class="hljs-number">1</span> + DIRSIZ + <span class="hljs-number">1</span> &gt; <span class="hljs-keyword">sizeof</span> buf)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: path too long\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-type">int</span> fd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> <span class="hljs-title">de</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span><br><br>    <span class="hljs-keyword">if</span> ((fd = open(dir, O_RDONLY)) &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot open %s\n&quot;</span>, dir);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fstat(fd, &amp;st) &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, dir);<br>        close(fd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (st.type != T_DIR)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: %s is not a directory\n&quot;</span>, dir);<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Usage: find [directory] &lt;filename&gt;\n&quot;</span>);<br>        close(fd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <br>    <span class="hljs-built_in">strcpy</span>(buf, dir);<br>    p = buf + <span class="hljs-built_in">strlen</span>(dir);<br>    *p++ = <span class="hljs-string">&#x27;/&#x27;</span>;<br><br>    <span class="hljs-keyword">while</span> (read(fd, &amp;de, <span class="hljs-keyword">sizeof</span>(de)) == <span class="hljs-keyword">sizeof</span>(de))<br>    &#123;<br>        <span class="hljs-comment">// skip invalid dir entry</span><br>        <span class="hljs-keyword">if</span> (de.inum == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">&quot;.&quot;</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">&quot;..&quot;</span>) == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br><br>        memmove(p, de.name, DIRSIZ);<br>        p[DIRSIZ] = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(de.name, file) == <span class="hljs-number">0</span>)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buf);<br>        <br>        <span class="hljs-keyword">if</span> (stat(buf, &amp;st) &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, buf);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (st.type == T_DIR) find(buf, file);<br>    &#125;<br>    close(fd);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span> &amp;&amp; argc != <span class="hljs-number">3</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Usage: find [directory] &lt;filename&gt;\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">2</span>) find(<span class="hljs-string">&quot;.&quot;</span>, argv[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">else</span> find(argv[<span class="hljs-number">1</span>], argv[<span class="hljs-number">2</span>]);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921093608610.png" alt="å›¾5-2"></p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921152930352.png" alt="å›¾5-3"></p><h2 id="6-xargs-moderate"><a href="#6-xargs-moderate" class="headerlink" title="6 xargs (moderate)"></a>6 xargs (<a href="https://pdos.csail.mit.edu/6.828/2021/labs/guidance.html">moderate</a>)</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240920200532745.png" alt="å›¾6-1"></p><p>è¿™é“é¢˜ç›®çš„éš¾ç‚¹ä¸»è¦åœ¨äºå¯¹cè¯­è¨€æ•°ç»„çš„å¤„ç†ã€‚</p><p>å¤§è‡´æ€è·¯å¦‚ä¸‹ï¼š</p><p>1.é¦–å…ˆå°†<code>xargs</code>çš„å‚æ•°æ‹·è´åˆ°æ•°ç»„çš„å‰æ®µã€‚</p><p>2.ç„¶åä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€è¡Œçš„å†…å®¹ä½œä¸ºé¢å¤–å‚æ•°æ‹¼æ¥åˆ°æ•°ç»„åé¢ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸€è¡Œçš„å†…å®¹åªä½œä¸ºä¸€ä¸ªå‚æ•°å¤„ç†ã€‚</p><p>3.<code>fork</code>ä¸€ä¸ªå­è¿›ç¨‹å‡ºæ¥è°ƒç”¨<code>exec</code>æ‰§è¡Œå‘½ä»¤</p><p>4.çˆ¶è¿›ç¨‹è°ƒç”¨<code>wait</code>ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¹‹åè·³è½¬åˆ°2ç»§ç»­æ‰§è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/param.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">char</span> *cmd[MAXARG + <span class="hljs-number">5</span>];<br>    <span class="hljs-type">int</span> args_cnter = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨echoå‘½ä»¤ </span><br>        cmd[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;echo&quot;</span>;<br>        args_cnter = <span class="hljs-number">2</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (; args_cnter &lt; argc; ++args_cnter) <br>    &#123;<br>        <span class="hljs-comment">// å°†å‚æ•°æ‹·è´åˆ°å‘½ä»¤æ•°ç»„ä¸­</span><br>        <span class="hljs-comment">// shallow copy</span><br>        cmd[args_cnter] = argv[args_cnter];<br>    &#125;<br><br><br>    <span class="hljs-comment">// b - æ¯æ¬¡è¯»å–çš„èµ·å§‹ä½ç½® </span><br>    <span class="hljs-comment">// e - æ¯æ¬¡è¯»å–å®Œæˆåçš„æœ€åæœ‰æ•ˆä½çš„ä¸‹ä¸€ä½ </span><br>    <span class="hljs-comment">// r - æ¯æ¬¡è¯»å–äº†å¤šå°‘å­—èŠ‚ </span><br>    <span class="hljs-comment">// s - æ¯è¡Œå‚æ•°çš„èµ·å§‹ </span><br>    <span class="hljs-comment">// æ¯æ¬¡å°†æ•°æ®è¯»å–åˆ°buf[b, e)ä¸­ buf[0, b)ä¸ºä¸Šæ¬¡æœªå¤„ç†å®Œçš„å†…å®¹ </span><br>    <span class="hljs-type">int</span> b = <span class="hljs-number">0</span>, e = <span class="hljs-number">0</span>, r = <span class="hljs-number">0</span>, s;<br>    <span class="hljs-keyword">while</span> ((r = read(<span class="hljs-number">0</span>, buf + b, <span class="hljs-number">256</span> - b)) &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        e = b + r;<br>        s = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; e; ++i)<br>        &#123;<br>            <span class="hljs-comment">// å¦‚æœé‡åˆ°äº†æ¢è¡Œç¬¦</span><br>            <span class="hljs-keyword">if</span> (buf[i] == <span class="hljs-string">&#x27;\n&#x27;</span>)<br>            &#123;<br>                <span class="hljs-comment">// å°†å‚æ•°æ‹·è´åˆ°æ•°ç»„ä¸­</span><br>                <span class="hljs-comment">// deep copy</span><br>                buf[i] = <span class="hljs-number">0</span>;<br>                <span class="hljs-type">char</span> *p = (<span class="hljs-type">char</span>*) <span class="hljs-built_in">malloc</span>(i - s + <span class="hljs-number">1</span>);<br><br>                <span class="hljs-keyword">if</span> (!p)<br>                &#123;<br>                    <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;malloc failed\n&quot;</span>);<br>                    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>                &#125;<br><br>                memmove(p, buf + s, i - s + <span class="hljs-number">1</span>);<br>                cmd[args_cnter++] = p;<br>                <span class="hljs-comment">// æ›´æ–°s</span><br>                s = i + <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">if</span> (fork() == <span class="hljs-number">0</span>)<br>                &#123;<br>                    <span class="hljs-comment">// child</span><br>                    cmd[args_cnter] = <span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">if</span> (exec(cmd[<span class="hljs-number">1</span>], cmd + <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;exec failed&quot;</span>);<br>                        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">else</span>    <br>                &#123;<br>                    <span class="hljs-comment">// parent</span><br>                    wait((<span class="hljs-type">int</span>*)<span class="hljs-number">0</span>);<br>                    <span class="hljs-built_in">free</span>(cmd[--args_cnter]);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// å°†æœªå¤„ç†å®Œçš„å†…å®¹ç§»åŠ¨åˆ°æ•°ç»„é¦–éƒ¨</span><br>        memmove(buf, buf + s, e - s);<br>        b = e - s;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (r &lt; <span class="hljs-number">0</span>) <br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;read failed\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921154626369.png" alt="å›¾6-2"></p><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921154654189.png" alt="å›¾6-3"></p><h2 id="7-æµ‹è¯•ç»“æœ"><a href="#7-æµ‹è¯•ç»“æœ" class="headerlink" title="7 æµ‹è¯•ç»“æœ"></a>7 æµ‹è¯•ç»“æœ</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921160442352.png" alt="å›¾7-1"></p><h2 id="8-uptimeï¼ˆeasyï¼‰"><a href="#8-uptimeï¼ˆeasyï¼‰" class="headerlink" title="8 uptimeï¼ˆeasyï¼‰"></a>8 uptimeï¼ˆeasyï¼‰</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240920203828103.png" alt="å›¾8-1"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;uptime&lt;%d&gt;\n&quot;</span>, uptime());<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-improve-findï¼ˆeasyï¼‰"><a href="#9-improve-findï¼ˆeasyï¼‰" class="headerlink" title="9 improve findï¼ˆeasyï¼‰"></a>9 improve findï¼ˆeasyï¼‰</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240920205838353.png" alt="å›¾9-1"></p><p>è¿™é“é¢˜ç›®ç›´æ¥å‚è€ƒ<code>grep.c</code>ï¼ŒæŠŠå…¶ä¸­æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„ä»£ç æ‹¿è¿‡æ¥ï¼Œä¿®æ”¹<code>find</code>ä¸­åˆ¤æ–­åŒ¹é…çš„æ¡ä»¶å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/types.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/stat.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;user/user.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/fs.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kernel/fcntl.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">match</span><span class="hljs-params">(<span class="hljs-type">char</span>*, <span class="hljs-type">char</span>*)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">find</span><span class="hljs-params">(<span class="hljs-type">char</span> *dir, <span class="hljs-type">char</span>* pattern)</span><br>&#123;   <br>    <span class="hljs-type">char</span> buf[<span class="hljs-number">512</span>], *p;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strlen</span>(dir) + <span class="hljs-number">1</span> + DIRSIZ + <span class="hljs-number">1</span> &gt; <span class="hljs-keyword">sizeof</span> buf)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: path too long\n&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-type">int</span> fd;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> <span class="hljs-title">de</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">st</span>;</span><br><br>    <span class="hljs-keyword">if</span> ((fd = open(dir, O_RDONLY)) &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot open %s\n&quot;</span>, dir);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fstat(fd, &amp;st) &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, dir);<br>        close(fd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (st.type != T_DIR)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: %s is not a directory\n&quot;</span>, dir);<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Usage: find [directory] &lt;pattern&gt;\n&quot;</span>);<br>        close(fd);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <br>    <span class="hljs-built_in">strcpy</span>(buf, dir);<br>    p = buf + <span class="hljs-built_in">strlen</span>(dir);<br>    *p++ = <span class="hljs-string">&#x27;/&#x27;</span>;<br><br>    <span class="hljs-keyword">while</span> (read(fd, &amp;de, <span class="hljs-keyword">sizeof</span>(de)) == <span class="hljs-keyword">sizeof</span>(de))<br>    &#123;<br>        <span class="hljs-comment">// skip invalid dir entry</span><br>        <span class="hljs-keyword">if</span> (de.inum == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">&quot;.&quot;</span>) == <span class="hljs-number">0</span> || <span class="hljs-built_in">strcmp</span>(de.name, <span class="hljs-string">&quot;..&quot;</span>) == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br><br>        memmove(p, de.name, DIRSIZ);<br>        p[DIRSIZ] = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-comment">// if (strcmp(de.name, file) == 0)</span><br>        <span class="hljs-comment">//     printf(&quot;%s\n&quot;, buf);</span><br><br>        <span class="hljs-keyword">if</span> (match(pattern, de.name)) <br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buf);<br><br>        <span class="hljs-keyword">if</span> (stat(buf, &amp;st) &lt; <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;find: cannot stat %s\n&quot;</span>, buf);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (st.type == T_DIR) find(buf, pattern);<br>    &#125;<br>    close(fd);<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span> &amp;&amp; argc != <span class="hljs-number">3</span>)<br>    &#123;<br>        <span class="hljs-built_in">fprintf</span>(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;Usage: find [directory] &lt;pattern&gt;\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">2</span>) find(<span class="hljs-string">&quot;.&quot;</span>, argv[<span class="hljs-number">1</span>]);<br>    <span class="hljs-keyword">else</span> find(argv[<span class="hljs-number">1</span>], argv[<span class="hljs-number">2</span>]);<br><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br><br><span class="hljs-comment">// Regexp matcher from Kernighan &amp; Pike,</span><br><span class="hljs-comment">// The Practice of Programming, Chapter 9.</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">matchhere</span><span class="hljs-params">(<span class="hljs-type">char</span>*, <span class="hljs-type">char</span>*)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">matchstar</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">char</span>*, <span class="hljs-type">char</span>*)</span>;<br><br><span class="hljs-type">int</span><br><span class="hljs-title function_">match</span><span class="hljs-params">(<span class="hljs-type">char</span> *re, <span class="hljs-type">char</span> *text)</span><br>&#123;<br>  <span class="hljs-keyword">if</span>(re[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;^&#x27;</span>)<br>    <span class="hljs-keyword">return</span> matchhere(re+<span class="hljs-number">1</span>, text);<br>  <span class="hljs-keyword">do</span>&#123;  <span class="hljs-comment">// must look at empty string</span><br>    <span class="hljs-keyword">if</span>(matchhere(re, text))<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<span class="hljs-keyword">while</span>(*text++ != <span class="hljs-string">&#x27;\0&#x27;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// matchhere: search for re at beginning of text</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">matchhere</span><span class="hljs-params">(<span class="hljs-type">char</span> *re, <span class="hljs-type">char</span> *text)</span><br>&#123;<br>  <span class="hljs-keyword">if</span>(re[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span>(re[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;*&#x27;</span>)<br>    <span class="hljs-keyword">return</span> matchstar(re[<span class="hljs-number">0</span>], re+<span class="hljs-number">2</span>, text);<br>  <span class="hljs-keyword">if</span>(re[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;$&#x27;</span> &amp;&amp; re[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>    <span class="hljs-keyword">return</span> *text == <span class="hljs-string">&#x27;\0&#x27;</span>;<br>  <span class="hljs-keyword">if</span>(*text!=<span class="hljs-string">&#x27;\0&#x27;</span> &amp;&amp; (re[<span class="hljs-number">0</span>]==<span class="hljs-string">&#x27;.&#x27;</span> || re[<span class="hljs-number">0</span>]==*text))<br>    <span class="hljs-keyword">return</span> matchhere(re+<span class="hljs-number">1</span>, text+<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// matchstar: search for c*re at beginning of text</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">matchstar</span><span class="hljs-params">(<span class="hljs-type">int</span> c, <span class="hljs-type">char</span> *re, <span class="hljs-type">char</span> *text)</span><br>&#123;<br>  <span class="hljs-keyword">do</span>&#123;  <span class="hljs-comment">// a * matches zero or more instances</span><br>    <span class="hljs-keyword">if</span>(matchhere(re, text))<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<span class="hljs-keyword">while</span>(*text!=<span class="hljs-string">&#x27;\0&#x27;</span> &amp;&amp; (*text++==c || c==<span class="hljs-string">&#x27;.&#x27;</span>));<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="10-improve-shellï¼ˆeasy-moderateï¼‰"><a href="#10-improve-shellï¼ˆeasy-moderateï¼‰" class="headerlink" title="10 improve shellï¼ˆeasy&#x2F;moderateï¼‰"></a>10 improve shellï¼ˆeasy&#x2F;moderateï¼‰</h2><p><img src="/../images/MIT-6-S081-Lab1-Xv6-and-Unix-utilities/image-20240921160546811.png" alt="å›¾10-1"></p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MIT 6.1810</tag>
      
    </tags>
    
  </entry>
  
  
  
  
  
  
  <entry>
    <title>about</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[.index-card {  transition: all 0.5s;  transform: scale(calc(1.5 - 0.5 * var(--state)));  opacity: var(--state);  margin-bottom: 2rem;}.index-img img {  margin: 20px 0;}]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>categories</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[#board {  -webkit-backdrop-filter: blur(5px);  backdrop-filter: blur(5px);}]]></content>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[// document//   .querySelector('#web_bg')//   .setAttribute('style', `background-image: ${document.querySelector('.banner').style.background.split(' ')[0]};position: fixed;width: 100%;height: 100%;z-index: -1;background-size: cover;`);// document//   .querySelector("#banner")//   .setAttribute('style', 'background-image: url()')// document//   .querySelector("#banner .mask")//   .setAttribute('style', 'background-color:rgba(0,0,0,0)')]]></content>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[const cards = document.querySelectorAll('.index-card')if (cards.length) {  document.querySelector('.row').setAttribute('style', 'overflow: hidden;')  const coefficient = document.documentElement.clientWidth > 768 ? .5 : .3  const origin = document.documentElement.clientHeight - cards[0].getBoundingClientRect().height * coefficient  function throttle(fn, wait) {    let timer = null;    return function () {      const context = this;      const args = arguments;      if (!timer) {        timer = setTimeout(function () {          fn.apply(context, args);          timer = null;        }, wait)      }    }  }  function handle() {    cards.forEach(card => {      card.setAttribute('style', `--state: ${(card.getBoundingClientRect().top - origin) < 0 ? 1 : 0};`)    })    console.log(1)  }  document.addEventListener("scroll", throttle(handle, 100));}]]></content>
    
  </entry>
  
  
  
</search>
